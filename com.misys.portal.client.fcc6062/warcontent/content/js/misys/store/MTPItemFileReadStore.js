/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.store.MTPItemFileReadStore"]){dojo._hasResource["misys.store.MTPItemFileReadStore"]=true;dojo.provide("misys.store.MTPItemFileReadStore");dojo.experimental("misys.store.MTPItemFileReadStore");dojo.require("dojo.data.ItemFileReadStore");dojo.declare("misys.store.MTPItemFileReadStore",[dojo.data.ItemFileReadStore],{contentType:"",constructor:function(_1){if(_1.contentType!==undefined){this.contentType=_1.contentType;}else{this.contentType="text/plain; charset=utf-8";}},fetchItemByIdentity:function(_2){var _3;var _4;if(!this._loadFinished){var _5=this;if(this._jsonFileUrl!==this._ccUrl){dojo.deprecated("dojo.data.ItemFileReadStore: ","To change the url, set the url property of the store,"+" not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0");this._ccUrl=this._jsonFileUrl;this.url=this._jsonFileUrl;}else{if(this.url!==this._ccUrl){this._jsonFileUrl=this.url;this._ccUrl=this.url;}}if(this.data!=null&&this._jsonData==null){this._jsonData=this.data;this.data=null;}if(this._jsonFileUrl){if(this._loadInProgress){this._queuedFetches.push({args:_2});}else{this._loadInProgress=true;var _6={url:_5._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk,headers:{"content-type":this.contentType}};var _7=misys.xhrGet(_6);_7.addCallback(function(_8){var _9=_2.scope?_2.scope:dojo.global;try{_5._getItemsFromLoadedData(_8);_5._loadFinished=true;_5._loadInProgress=false;_3=_5._getItemByIdentity(_2.identity);if(_2.onItem){_2.onItem.call(_9,_3);}_5._handleQueuedFetches();}catch(error){_5._loadInProgress=false;if(_2.onError){_2.onError.call(_9,error);}}});_7.addErrback(function(_a){_5._loadInProgress=false;if(_2.onError){var _b=_2.scope?_2.scope:dojo.global;_2.onError.call(_b,_a);}});}}else{if(this._jsonData){_5._getItemsFromLoadedData(_5._jsonData);_5._jsonData=null;_5._loadFinished=true;_3=_5._getItemByIdentity(_2.identity);if(_2.onItem){_4=_2.scope?_2.scope:dojo.global;_2.onItem.call(_4,_3);}}}}else{_3=this._getItemByIdentity(_2.identity);if(_2.onItem){_4=_2.scope?_2.scope:dojo.global;_2.onItem.call(_4,_3);}}},_fetchItems:function(_c,_d,_e){var _f=this;var _10=function(_11,_12){var _13=[];var i,key;if(_11.query){var _14;var _15=_11.queryOptions?_11.queryOptions.ignoreCase:false;var _16={};for(key in _11.query){if(_11.query.hasOwnProperty(key)){_14=_11.query[key];if(dojo.isString(_14)){_16[key]=dojo.data.util.filter.patternToRegExp(_14,_15);}else{if(_14 instanceof RegExp){_16[key]=_14;}}}}for(i=0,len=_12.length;i<len;++i){var _17=true;var _18=_12[i];if(_18===null){_17=false;}else{for(key in _11.query){if(_11.query.hasOwnProperty(key)){_14=_11.query[key];if(!_f._containsValue(_18,key,_14,_16[key])){_17=false;}}}}if(_17){_13.push(_18);}}_d(_13,_11);}else{for(i=0,len=_12.length;i<len;++i){var _19=_12[i];if(_19!==null){_13.push(_19);}}_d(_13,_11);}};if(this._loadFinished){_10(_c,this._getItemsArray(_c.queryOptions));}else{if(this._jsonFileUrl!==this._ccUrl){dojo.deprecated("dojo.data.ItemFileReadStore: ","To change the url, set the url property of the store,"+" not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0");this._ccUrl=this._jsonFileUrl;this.url=this._jsonFileUrl;}else{if(this.url!==this._ccUrl){this._jsonFileUrl=this.url;this._ccUrl=this.url;}}if(this.data!=null&&this._jsonData==null){this._jsonData=this.data;this.data=null;}if(this._jsonFileUrl){if(this._loadInProgress){this._queuedFetches.push({args:_c,filter:_10});}else{this._loadInProgress=true;var _1a={url:_f._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk,headers:{"content-type":this.contentType}};var _1b=misys.xhrGet(_1a);_1b.addCallback(function(_1c){try{_f._getItemsFromLoadedData(_1c);_f._loadFinished=true;_f._loadInProgress=false;_10(_c,_f._getItemsArray(_c.queryOptions));_f._handleQueuedFetches();}catch(e){_f._loadFinished=true;_f._loadInProgress=false;_e(e,_c);}});_1b.addErrback(function(_1d){_f._loadInProgress=false;_e(_1d,_c);});var _1e=null;if(_c.abort){_1e=_c.abort;}_c.abort=function(){var df=_1b;if(df&&df.fired===-1){df.cancel();df=null;}if(_1e){_1e.call(_c);}};}}else{if(this._jsonData){try{this._loadFinished=true;this._getItemsFromLoadedData(this._jsonData);this._jsonData=null;_10(_c,this._getItemsArray(_c.queryOptions));}catch(e){_e(e,_c);}}else{_e(new Error("dojo.data.ItemFileReadStore: No JSON source data was provided as either URL or a nested Javascript object."),_c);}}}},_forceLoad:function(){var _1f=this;if(this._jsonFileUrl!==this._ccUrl){dojo.deprecated("dojo.data.ItemFileReadStore: ","To change the url, set the url property of the store,"+" not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0");this._ccUrl=this._jsonFileUrl;this.url=this._jsonFileUrl;}else{if(this.url!==this._ccUrl){this._jsonFileUrl=this.url;this._ccUrl=this.url;}}if(this.data!=null&&this._jsonData==null){this._jsonData=this.data;this.data=null;}if(this._jsonFileUrl){var _20={url:this._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk,sync:true,headers:{"content-type":this.contentType}};var _21=misys.xhrGet(_20);_21.addCallback(function(_22){try{if(_1f._loadInProgress!==true&&!_1f._loadFinished){_1f._getItemsFromLoadedData(_22);_1f._loadFinished=true;}else{if(_1f._loadInProgress){throw new Error("dojo.data.ItemFileReadStore:  Unable to perform a synchronous load, an async load is in progress.");}}}catch(e){throw e;}});_21.addErrback(function(_23){throw _23;});}else{if(this._jsonData){_1f._getItemsFromLoadedData(_1f._jsonData);_1f._jsonData=null;_1f._loadFinished=true;}}}});}