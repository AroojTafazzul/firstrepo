/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.calendar.BusinessDatesCalendar"]){dojo._hasResource["misys.calendar.BusinessDatesCalendar"]=true;dojo.provide("misys.calendar.BusinessDatesCalendar");dojo.experimental("misys.calendar.BusinessDatesCalendar");dojo.require("dijit.Calendar");var _isError=false;var _countOfDates=0;function _currencyCode(){if(dijit.byId(misys.curCodeWidgetId)){return dijit.byId(misys.curCodeWidgetId).get("value");}else{return "";}};function _countryCode(){if(dijit.byId(misys.countryWidgetId)){return dijit.byId(misys.countryWidgetId).get("value");}else{return "";}};function _productCode(){if(dijit.byId(misys.productCodeWidgetId)){return dijit.byId(misys.productCodeWidgetId).get("value");}else{return "";}};function _subProductCode(){if(dijit.byId(misys.subProductCodeWidgetId)){return dijit.byId(misys.subProductCodeWidgetId).get("value");}else{return "";}};function _bankAbbvName(){if(dijit.byId(misys.bankAbbvNameWidgetId)){return dijit.byId(misys.bankAbbvNameWidgetId).get("value");}else{return "";}};dojo.declare("misys.calendar.BusinessDatesCalendar",[dijit.Calendar],{getClassForDate:function(_1,_2){var _3=_1.getDate();var _4=_1.getMonth();_4=_4+1;var _5=_1.getFullYear();var _6=_1;var _7=dojo.date.locale.format(_6,{selector:"date",datePattern:misys.getLocalization("g_strGlobalDateFormat")});var _8=_7;if(!_7){_8=_3+"/"+_4+"/"+_5;}var _9=false;misys._config=misys._config||{};if(!misys._config.dateCache){dojo.mixin(misys._config,{dateCache:[],dateStatusCache:[]});}if(misys._config.dateCache.length===0||dojo.indexOf(misys._config.dateCache,_8)===-1){_countOfDates++;if(!_isError){_9=this._getHolidays(_8);_countOfDates--;}else{if(_countOfDates==50){_9=this._getHolidays(_8);_countOfDates=0;}}if(_9){if(misys._config.dateStatusCache[dojo.indexOf(misys._config.dateCache,_8)]=="false"){return "dijitCalendarDisabledDate";}else{return " ";}}else{return "dijitCalendarDisabledDate";}}else{if(misys._config.dateStatusCache[dojo.indexOf(misys._config.dateCache,_8)]=="false"){return "dijitCalendarDisabledDate";}else{return "";}}},_getHolidays:function(_a){var _b=true;misys.xhrPost({url:misys.getServletURL("/screen/AjaxScreen/action/GetHolidaysForBusinessCalendar"),handleAs:"json",sync:true,content:{productCode:misys._config.productCode,subProductCode:_subProductCode(),currencyCode:_currencyCode(),countryCode:_countryCode(),bankAbbvName:_bankAbbvName(),date:_a},load:function(_c,_d){misys._config=misys._config||{};if(!misys._config.dateCache){dojo.mixin(misys._config,{dateCache:_c.calendarDays,dateStatusCache:_c.statusCalendarDays});}else{misys._config.dateCache=_c.calendarDays;misys._config.dateStatusCache=_c.statusCalendarDays;}_isError=false;_b=true;},error:function(_e,_f){console.error("[misys.Calendar.BusinessDatesCalendar] Technical error while getting holidays for Business Calendar");console.error(_e);_isError=true;_b=false;misys._config=misys._config||{};if(!misys._config.dateCache){dojo.mixin(misys._config,{dateCache:[],dateStatusCache:[]});}else{misys._config.dateCache=[];misys._config.dateStatusCache=[];}}});if(!_b){var _10=this.id;var _11=_10.replace("_popup","");var _12=dijit.byId(_11).domNode;var _13=misys.getLocalization("businessCalendarTechnicalError");dijit.hideTooltip(_12);dijit.showTooltip(_13,_12,0);}return _b;}});}