/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.report.widget.Criteria"]){dojo._hasResource["misys.report.widget.Criteria"]=true;dojo.provide("misys.report.widget.Criteria");dojo.experimental("misys.report.widget.Criteria");dojo.require("dijit._Contained");dojo.require("misys.grid.GridMultipleItems");dojo.require("misys.report.widget.Criterium");(function(d,dj,m){dojo.declare("misys.report.widget.Criteria",[misys.grid.GridMultipleItems,dijit._Contained],{openDialogFromExistingItemInitFunction:misys.criteriumOpenDialogFromExistingItemInitFunction,data:{identifier:"store_id",label:"store_id",items:[]},templatePath:null,templateString:dojo.byId("criteria-template").innerHTML,dialogId:"criterium-dialog-template",xmlTagName:"criteria",xmlSubTagName:"criterium",name:"",gridColumns:["column","column_type","operator","value_type","parameter","string_value","number_value","amount_value","date_value","values_set","default_string_value","default_number_value","default_amount_value","default_values_set","default_date_type","default_date_report_exec_date_offset","default_date_report_exec_date_offset_days","default_date_first_day_of_month_offset","default_date_first_day_of_month_offset_days","default_date_last_day_of_month_offset","default_date_last_day_of_month_offset_days","default_date_value"],propertiesMap:{column:{_fieldName:"criterium_column"},column_type:{_fieldName:"criterium_column_type"},operator:{_fieldName:"criterium_operator"},value_type:{_fieldName:"criterium_operand_type"},parameter:{_fieldName:"criterium_parameter"},string_value:{_fieldName:"criterium_string_value"},number_value:{_fieldName:"criterium_number_value"},amount_value:{_fieldName:"criterium_amount_value"},date_value:{_fieldName:"criterium_date_value"},values_set:{_fieldName:"criterium_values_set"},default_string_value:{_fieldName:"criterium_parameter_default_string_value"},default_number_value:{_fieldName:"criterium_parameter_default_number_value"},default_amount_value:{_fieldName:"criterium_parameter_default_amount_value"},default_values_set:{_fieldName:"criterium_parameter_default_values_set"},default_date_type:{_fieldName:"criterium_parameter_default_date_type"},default_date_report_exec_date_offset:{_fieldName:"criterium_parameter_default_date_report_exec_date_offset"},default_date_report_exec_date_offset_days:{_fieldName:"criterium_parameter_default_date_report_exec_date_offset_days"},default_date_first_day_of_month_offset:{_fieldName:"criterium_parameter_default_date_first_day_of_month_offset"},default_date_first_day_of_month_offset_days:{_fieldName:"criterium_parameter_default_date_first_day_of_month_offset_days"},default_date_last_day_of_month_offset:{_fieldName:"criterium_parameter_default_date_last_day_of_month_offset"},default_date_last_day_of_month_offset_days:{_fieldName:"criterium_parameter_default_date_last_day_of_month_offset_days"},default_date_value:{_fieldName:"criterium_parameter_default_date_value"}},layout:[{name:m.getLocalization("column"),field:"column",formatter:misys.getColumnDecode,width:"35%"},{name:m.getLocalization("operator"),field:"operator",formatter:misys.getCriteriaOperatorDecode,width:"20%"},{name:m.getLocalization("value"),get:misys.getCriteriumOperand,width:"35%"},{name:" ",field:"actions",formatter:misys.grid.formatReportActions,width:"10%"}],_showHideSections:function(_1){var _2=dojo.isArray(_1.value_type)?_1.value_type[0]:_1.value_type;var _3=dojo.isArray(_1.column)?_1.column[0]:_1.column;dojo.byId("criterium_parameter_section").style.display=(_2=="01"?"block":"none");dojo.byId("criterium_string_section").style.display=(_2=="02"&&arrColumn[_3][0]=="String"?"block":"none");dojo.byId("criterium_number_section").style.display=(_2=="02"&&arrColumn[_3][0]=="Number"?"block":"none");dojo.byId("criterium_amount_section").style.display=(_2=="02"&&arrColumn[_3][0]=="Amount"?"block":"none");dojo.byId("criterium_date_section").style.display=(_2=="02"&&arrColumn[_3][0]=="Date"?"block":"none");dojo.byId("criterium_values_set_section").style.display=(_2=="02"&&arrConstrainedParameterType.indexOf(arrColumn[_3][0])!==-1?"block":"none");},startup:function(){if(this._started){return;}this.name=this.id;this.dataList=[];if(this.hasChildren()){dojo.forEach(this.getChildren(),function(_4){var _5=_4.get("column");var _6=_4.get("string_value");var _7=_4.get("operator");var _8=_4.get("parameter");var _9=_4.get("value_type");var _a=_4.get("default_string_value");var _b=_4.get("default_date_type");var _c=_4.get("default_date_report_exec_date_offset");var _d=_4.get("default_date_report_exec_date_offset_days");var _e=_4.get("default_date_first_day_of_month_offset");var _f=_4.get("default_date_first_day_of_month_offset_days");var _10=_4.get("default_date_last_day_of_month_offset");var _11=_4.get("default_date_last_day_of_month_offset_days");var _12={column:_5,column_type:arrColumn[_5][0],operator:_7,value_type:_9=="parameter"?(_b!=""?"03":"01"):"02",parameter:_8,string_value:_9=="string"&&arrColumn[_5][0]=="String"?_6:"",number_value:_9=="string"&&arrColumn[_5][0]=="Number"?_6:"",amount_value:_9=="string"&&arrColumn[_5][0]=="Amount"?_4.get("amount_value"):"",date_value:_9=="string"&&arrColumn[_5][0]=="Date"?_6:"",values_set:_9=="string"&&arrConstrainedParameterType.indexOf(arrColumn[_5][0])!==-1?_6:"",default_string_value:arrColumn[_5][0]=="String"?_a:"",default_number_value:arrColumn[_5][0]=="Number"?_a:"",default_amount_value:arrColumn[_5][0]=="Amount"?_a:"",default_values_set:arrConstrainedParameterType.indexOf(arrColumn[_5][0])!==-1?_a:"",default_date_type:_b,default_date_report_exec_date_offset:_c,default_date_report_exec_date_offset_days:_d,default_date_first_day_of_month_offset:_e,default_date_first_day_of_month_offset_days:_f,default_date_last_day_of_month_offset:_10,default_date_last_day_of_month_offset_days:_11,default_date_value:arrColumn[_5][0]=="Date"?_a:""};this.dataList.push(_12);},this);}this.inherited(arguments);},openDialogFromExistingItem:function(_13,_14){misys.dialog.isActive=false;var _15=_13[0];var _16=dojo.isArray(_15.column)?_15.column[0]:_15.column;misys.setCriteriumOperatorsList(_16);var _17=dojo.isArray(_15.parameter)?_15.parameter[0]:_15.parameter;misys.setCriteriumParametersList(_17);this._showHideSections(_15);var _18=dojo.isArray(_15.column_type)?_15.column_type[0]:_15.column_type;if(arrConstrainedParameterType.indexOf(_18)!==-1){misys.setCriteriumValuesSetList(_16);}this.inherited(arguments);misys.toggleCriteriumParameterDefaultDate();},addItem:function(_19){misys.dialog.isActive=false;this.inherited(arguments);misys.setCriteriumOperatorsList();misys.setCriteriumParametersList();dojo.byId("criterium_parameter_section").style.display="none";dojo.byId("criterium_string_section").style.display="none";dojo.byId("criterium_number_section").style.display="none";dojo.byId("criterium_amount_section").style.display="none";dojo.byId("criterium_values_set_section").style.display="none";document.body.style.overflow="hidden";},updateData:function(_1a){this.inherited(arguments);var _1b=dijit.byId("criterium_parameter").get("value");if(_1b!=""){var _1c=dijit.byId("parameters");if(_1c.grid&&_1c.grid.store){_1c.grid.store.fetch({query:{name:_1b},onComplete:function(_1d,_1e){if(_1d.length==1){var _1f=function(_20,_21){var _22="";var _23=dojo.query("[name='"+_20+"']",_21);dojo.some(_23,function(_24){var _25=dijit.byNode(_24.parentNode);var _26=_25.get("checked");if(_26){_22=_25.params.value;return true;}});return _22;};var _27=_1d[0];var _28=dojo.byId("criterium_parameter_default_date_section");_1c.grid.store.setValue(_27,"default_string_value",dijit.byId("criterium_parameter_default_string_value").get("value"));_1c.grid.store.setValue(_27,"default_number_value",dijit.byId("criterium_parameter_default_number_value").get("value"));_1c.grid.store.setValue(_27,"default_amount_value",dijit.byId("criterium_parameter_default_amount_value").get("value"));_1c.grid.store.setValue(_27,"default_date_type",_1f("criterium_parameter_default_date_type",_28));_1c.grid.store.setValue(_27,"current_date_offset_type",_1f("criterium_parameter_default_date_report_exec_date_offset",_28));_1c.grid.store.setValue(_27,"current_date_offset_days",dijit.byId("criterium_parameter_default_date_report_exec_date_offset_days").get("displayedValue"));_1c.grid.store.setValue(_27,"first_day_offset_type",_1f("criterium_parameter_default_date_first_day_of_month_offset",_28));_1c.grid.store.setValue(_27,"first_day_offset_days",dijit.byId("criterium_parameter_default_date_first_day_of_month_offset_days").get("displayedValue"));_1c.grid.store.setValue(_27,"last_day_offset_type",_1f("criterium_parameter_default_date_last_day_of_month_offset",_28));_1c.grid.store.setValue(_27,"last_day_offset_days",dijit.byId("criterium_parameter_default_date_last_day_of_month_offset_days").get("displayedValue"));_1c.grid.store.setValue(_27,"default_date_value",dijit.byId("criterium_parameter_default_date_value").get("displayedValue"));}}});_1c.grid.store.save();}}}});})(dojo,dijit,misys);}