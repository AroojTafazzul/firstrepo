/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.report.widget.Products"]){dojo._hasResource["misys.report.widget.Products"]=true;dojo.provide("misys.report.widget.Products");dojo.experimental("misys.report.widget.Products");dojo.require("misys.grid.GridMultipleItems");dojo.require("dojo.data.ItemFileWriteStore");dojo.declare("misys.report.widget.Products",[misys.grid.GridMultipleItems],{data:{identifier:"store_id",label:"store_id",items:[]},templatePath:null,templateString:dojo.byId("products-template").innerHTML,dialogId:"product-dialog-template",xmlTagName:"products",xmlSubTagName:"product",gridColumns:["product"],propertiesMap:{},layout:[{name:"Product",field:"product",formatter:misys.getProductDecode,width:"90%"},{name:" ",field:"actions",formatter:misys.grid.formatReportActions,width:"10%"}],dialogExecute:function(_1){setTimeout(function(){var _2=dijit.byId("multi_product");if(_2&&_2.get("checked")){dijit.byId("product-dialog-template").gridMultipleItemsWidget.updateData();}},100);document.body.style.overflow="visible";},addItem:function(_3){this.inherited(arguments);this._buildProductDataStore();document.body.style.overflow="hidden";},openDialogFromExistingItem:function(_4,_5){misys.dialog.isActive=false;this.inherited(arguments);this._buildProductDataStore(_4[0].product);},_buildProductDataStore:function(_6){if(availableProductCodes){var _7={};var _8=false;var _9=false;var _a=false;var _b=false;if(this.grid&&this.grid.store){this.grid.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(this,function(_c,_d){if(_c.length>0){_8=true;_9=this._isTransactionProduct(dojo.isArray(_c[0].product)?_c[0].product[0]:_c[0].product);_a=this._isTemplateProduct(dojo.isArray(_c[0].product)?_c[0].product[0]:_c[0].product);_b=this._isMasterProduct(dojo.isArray(_c[0].product)?_c[0].product[0]:_c[0].product);for(var i=0;i<_c.length;i++){var _e=_c[i];_7[_e.product]=_e.product;}}})});}var _f=[];for(var i=0;i<availableProductCodes.length;i++){var _10=availableProductCodes[i].product;var _11=availableProductCodes[i].description;if(!_8){_f.push({code:_10,name:_11});}else{if(!_7[_10]&&((_9&&this._isTransactionProduct(_10))||(_a&&this._isTemplateProduct(_10))||(_b&&this._isMasterProduct(_10)))){_f.push({code:_10,name:_11});}else{if(_6&&_6==_10){_f.push({code:_10,name:_11});}}}}var _12=new dojo.data.ItemFileReadStore({data:{identifier:"code",items:_f}});dijit.byId("product").set("searchAttr","name");dijit.byId("product").store=_12;if(_6){dijit.byId("product").set("value",_6);}}},_isTransactionProduct:function(_13){return (_13.match("Tnx$")=="Tnx");},_isTemplateProduct:function(_14){return (_14.match("Template$")=="Template");},_isMasterProduct:function(_15){return !this._isTransactionProduct(_15)&&!this._isTemplateProduct(_15);},startup:function(){this.dataList=[];if(this.hasChildren()){dojo.forEach(this.getChildren(),function(_16){this.dataList.push({product:_16.get("product")});},this);}this.inherited(arguments);}});}