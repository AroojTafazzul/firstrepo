/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


var parmtrs="misys.report.widget.Parameters";dojo.provide(parmtrs);dojo.experimental(parmtrs);dojo.require("misys.grid.GridMultipleItems");dojo.declare(parmtrs,[misys.grid.GridMultipleItems],{data:{identifier:"store_id",label:"store_id",items:[]},templatePath:null,templateString:dojo.byId("parameters-template").innerHTML,dialogId:"parameter-dialog-template",xmlTagName:"parameters",xmlSubTagName:"parameter",gridColumns:["parameter_name","label_en","label_fr","label_ar","label_us","label_it","label_nl","label_pt","label_br","label_de","label_zh","label_ca","label_es","label_th","mandatory"],propertiesMap:{parameter_name:{_fieldName:"parameter_name"},label_en:{_fieldName:"parameter_label_en"},label_fr:{_fieldName:"parameter_label_fr"},label_ar:{_fieldName:"parameter_label_ar"},label_us:{_fieldName:"parameter_label_us"},label_it:{_fieldName:"parameter_label_it"},label_nl:{_fieldName:"parameter_label_nl"},label_pt:{_fieldName:"parameter_label_pt"},label_br:{_fieldName:"parameter_label_br"},label_de:{_fieldName:"parameter_label_de"},label_zh:{_fieldName:"parameter_label_zh"},label_ca:{_fieldName:"parameter_label_ca"},label_es:{_fieldName:"parameter_label_es"},label_th:{_fieldName:"parameter_label_th"},mandatory:{_fieldName:"parameter_mandatory"},default_string_value:{_fieldName:"parameter_default_string_value"},default_number_value:{_fieldName:"parameter_default_number_value"},default_amount_value:{_fieldName:"parameter_default_amount_value"},default_values_set:{_fieldName:"parameter_default_values_set"},default_date_type:{_fieldName:"parameter_default_date_type"},current_date_offset_type:{_fieldName:"parameter_current_date_offset_type"},current_date_offset_days:{_fieldName:"parameter_current_date_offset_days"},first_day_offset_type:{_fieldName:"parameter_first_day_offset_type"},first_day_offset_days:{_fieldName:"parameter_first_day_offset_days"},last_day_offset_type:{_fieldName:"parameter_last_day_offset_type"},last_day_offset_days:{_fieldName:"parameter_last_day_offset_days"},default_date_value:{_fieldName:"parameter_default_date_value"}},layout:[{name:"Parameter",field:"parameter_name",width:"45%"},{name:"Description",field:"label_en",width:"45%"},{name:" ",field:"actions",formatter:misys.grid.formatReportActions,width:"10%"}],startup:function(){this.layout[1].field="label_"+language;this.dataList=[];if(this.hasChildren()){dojo.forEach(this.getChildren(),function(_1){var _2={parameter_name:_1.get("parameter_name"),mandatory:_1.get("mandatory"),default_string_value:_1.get("default_string_value"),default_number_value:_1.get("default_number_value"),default_amount_value:_1.get("default_amount_value"),default_values_set:_1.get("default_values_set"),default_date_type:_1.get("default_date_type"),current_date_offset_type:_1.get("current_date_offset_type"),current_date_offset_days:_1.get("current_date_offset_days"),first_day_offset_type:_1.get("first_day_offset_type"),first_day_offset_days:_1.get("first_day_offset_days"),last_day_offset_type:_1.get("last_day_offset_type"),last_day_offset_days:_1.get("last_day_offset_days"),default_date_value:_1.get("default_date_value")};for(var i=0,_3=languages.length;i<_3;i++){_2["label_"+languages[i]]=_1.get("label_"+languages[i]);}this.dataList.push(_2);},this);}this.inherited(arguments);dojo.subscribe("ready",function(){var _4=dijit.byId("parameters");if(_4&&_4.grid&&_4.grid.store){_4.grid.store.fetch({query:{store_id:"*"},onComplete:function(_5,_6){dojo.forEach(_5,function(_7){var _8=dojo.isArray(_7.default_string_value)?_7.default_string_value[0]:_7.default_string_value;if(_8!=""){var _9=dojo.isArray(_7.parameter_name)?_7.parameter_name[0]:_7.parameter_name;dijit.registry.byClass("misys.report.widget.Criteria").forEach(function(_a){if(_a.grid&&_a.grid.store){_a.grid.store.fetch({query:{parameter:_9},onItem:function(_b,_c){var _d=dojo.isArray(_b.column_type)?_b.column_type[0]:_b.column_type;if(_d=="Date"){_4.grid.store.setValue(_7,"default_date_value",_8);_4.grid.store.setValue(_7,"default_date_type","07");_4.grid.store.setValue(_7,"default_string_value","");}else{if(_d=="Number"){_4.grid.store.setValue(_7,"default_number_value",_8);_4.grid.store.setValue(_7,"default_string_value","");}else{if(_d=="Amount"){var _e=_8.substring(0,_8.indexOf("@"));var _f=_8.substring(_8.indexOf("@")+1,_8.length);_4.grid.store.setValue(_7,"default_amount_value",_e);_4.grid.store.setValue(_7,"default_string_value","");}}}}});}});}});}});}});},createDataGrid:function(){this.inherited(arguments);this.grid.onDelete=function(_10){var _11=this;var _12=this.store._arrayOfTopLevelItems[_10.rowIndex].store_id;_12=dojo.isArray(_12)?_12[0]:_12;this.store.fetch({query:{store_id:_12},onComplete:function(_13,_14){if(_13.length>0){var _15=_13[0];var _16=dojo.isArray(_15.parameter_name)?_15.parameter_name[0]:_15.parameter_name;var _17=function(){var _18=_11.selection.getSelected();if(_18.length){dojo.forEach(_18,function(_19){if(_19!==null){_11.selection.setSelected(_19,false);}},_11);}_11.selection.setSelected(_10.rowIndex,true);_18=_11.selection.getSelected();if(_18.length){dojo.forEach(_18,function(_1a){if(_1a!==null){_11.store.deleteItem(_1a);}},_11);_11.store.save();}setTimeout(dojo.hitch(_11.gridMultipleItemsWidget,"renderSections"),100);};var _1b=false;dijit.registry.byClass("misys.report.widget.Criteria").forEach(function(_1c){_1b=true;if(_1c.grid&&_1c.grid.store){_1c.grid.store.fetch({query:{parameter:_16},onComplete:dojo.hitch(this,function(_1d,_1e){if(_1d.length<=0){misys.dialog.show("CONFIRMATION",misys.getLocalization("confirmDeletionGridRecord"),"",_17);}else{var _1f=_1d[0];var _20=function(){_17();_1c.grid.store.deleteItem(_1f);_1c.grid.store.save();setTimeout(function(){_1c.renderSections();_1c.grid.render();},200);};misys.dialog.show("CONFIRMATION",misys.getLocalization("parameterAlreadyUsedInCriterionConfirmation",[_16]),"",_20);}})});}else{misys.dialog.show("CONFIRMATION",misys.getLocalization("confirmDeletionGridRecord"),"",_17);}});if(!_1b){misys.dialog.show("CONFIRMATION",misys.getLocalization("confirmDeletionGridRecord"),"",_17);}}}});};}});