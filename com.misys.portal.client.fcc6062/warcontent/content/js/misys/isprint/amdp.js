/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


var amdp={};amdp.encrypt=function(_1,_2,_3,_4){var _5={};if(typeof _1=="string"){try{_5=JSON.parse(_1);}catch(err){amdp.log(err);throw err;}}if(typeof _5.hash=="undefined"){_5.hash=false;}if(typeof _5.hashAlgo=="undefined"||_5.hashAlgo.length==0){_5.hashAlgo="SHA-256";}if(typeof _5.symmetric=="undefined"){_5.symmetric=false;}if(typeof _5.symmetricAlgo=="undefined"||_5.symmetricAlgo.length==0){_5.symmetricAlgo="AES";}if(typeof _5.symmetricKeyLength=="undefined"||_5.symmetricKeyLength==0){_5.symmetricKeyLength=128;}amdp.log(_5.hash);amdp.log(_5.hashAlgo);amdp.log(_5.symmetric);amdp.log(_5.symmetricAlgo);amdp.log(_5.symmetricKeyLength);if(_5.hash&&_5.symmetric&&_5.symmetricAlgo=="AES"){return amdp._encrypt_aes_sha(_5,_2,_3,_4);}var _6=_2.split(",",2);var _7=amUtil.str2bin(_4);var _8=[];if(_5.hash){_8=amHash.sha256(_7);amdp.log("hash="+amUtil.hexEncode(_8));_7=_7.concat(_8);}var _9=amUtil.hexDecode(_3);_7=_7.concat(_9);var _a;try{_a=amRsa.oaep.encryptAndGenLabel(_6[0],_6[1],_7);amdp.log("rsaCipherText="+_a);}catch(err){amdp.log("Exception when encrypting using RSA-OAEP, msg="+err);throw err;}var _b=_a;return _b;};amdp._encrypt_aes_sha=function(_c,_d,_e,_f){var _10=_d.split(",",2);var _11=amUtil.str2bin(_f);var _12=amUtil.hexDecode(_e);amdp.log("modulus="+_10[0]);amdp.log("modulusLength(bits)="+(_10[0].length*8/2));amdp.log("exponent="+_10[1]);amdp.log("rn="+_e);var _13=new Array(_c.symmetricKeyLength/8);var rnd=new amUtil.SecureRandom();rnd.nextBytes(_13);var iv=new Array(16);rnd=new amUtil.SecureRandom();rnd.nextBytes(iv);var _14;var _15;try{_14=amAes.CbcPkcs7.encrypt(_11,_13,iv);_15=amUtil.hexEncode(_14);amdp.log("symCipherText="+_15);}catch(err){amdp.log("Exception when encrypting using AES, msg="+err);throw err;}var _16=iv.concat(_14);var _17;try{_17=amHash.sha256(_16);var _18=amUtil.hexEncode(_17);amdp.log("hash="+_18);}catch(err){amdp.log("Exception when generating hash, msg="+err);throw err;}var _19=_13;_19=_19.concat(_17);_19=_19.concat(_12);_19=_19.concat(iv);var _1a;try{_1a=amRsa.oaep.encryptAndGenLabel(_10[0],_10[1],_19);amdp.log("rsaCipherText="+_1a);var _1b=_1a.split(":",2);var _1c=_1b[0];_1a=_1b[1];}catch(err){amdp.log("Exception when encrypting using RSA-OAEP, msg="+err);throw err;}var _1d="02";_1d=_1d.concat(amUtil.hexEncode(amUtil.int2bin(_1c.length/2,1)));_1d=_1d.concat(_1c);_1d=_1d.concat(amUtil.hexEncode(amUtil.int2bin(_1a.length/2,2)));_1d=_1d.concat(_1a);_1d=_1d.concat(_15);return _1d;};amdp.multivalues=new Array();amdp.addValue=function(_1e){amdp.multivalues[amdp.multivalues.length]=_1e;};amdp.clearMultiValues=function(_1f){amdp.multivalues.splice(amdp.multivalues.length);amdp.multivalues=new Array();};amdp.encryptMultiValues=function(_20,_21,_22){var _23=JSON.stringify(amdp.multivalues);return amdp.encrypt(_20,_21,_22,_23);};amdp.log=function(log){try{document.testform.debug.value=document.testform.debug.value+log+"\n";}catch(err){}};