/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.widget.BookmarkMenu"]){dojo._hasResource["misys.widget.BookmarkMenu"]=true;dojo.provide("misys.widget.BookmarkMenu");dojo.require("dijit.form.DropDownButton");dojo.require("dijit.TooltipDialog");(function(d,dj,m){function _1(_2,_3,_4){var _5="";var _6=["<?xml version=\"1.0\" encoding=\"UTF-8\"?><bookmark>"];var _7=dijit.byId("sendBookmark");dojo.forEach(_7.getDescendants(),function(_8){_6.push("<",_8.get("name"),">",_8.get("value"),"</",_8.get("name"),">");});if(dijit.byId("bookmarkName")){_6.push("<bookmark_name>",dijit.byId("bookmarkName").get("value"),"</bookmark_name>");}_6.push("<bookmark_url>","**","</bookmark_url>");_6.push("<bookmark_source>","**","</bookmark_source>");_6.push("<bookmark_id>",_2,"</bookmark_id>");_6.push("<action>",_2,"</action></bookmark>");var _9=misys.xhrPost({url:misys.getServletURL("/screen/BookmarkMenuScreen"),handleAs:"json",content:{formContent:_6.join(""),bookmarkAction:"SAVE",currentActionCode:_3,currentScreen:_4},load:function(_a){_5=_a.content[0];}});_9.then(function(){var _b=dojo.byId("favorites");if(!dijit.byId("sendBookmark")){dojo.parser.parse(dojo.byId("favorites"));}misys.animate("wipeOut",_b,function(){dijit.byId("sendBookmark").destroyRecursive(true);var _c=dj.findWidgets(dojo.byId("favorites"));dojo.forEach(_c,function(w){w.destroyRecursive(false);});dojo.empty("favorites");_b.innerHTML=_5.substring(20,_5.length-6);dojo.parser.parse(dojo.byId("favorites"));misys.animate("wipeIn",_b);});});return _9;};function _d(id,_e,_f,_10){var _11=["<?xml version=\"1.0\" encoding=\"UTF-8\"?><bookmark>"];var _12=dijit.byId("sendBookmark");dojo.forEach(_12.getDescendants(),function(_13){if(_13.id!=="bookmark_"+id&&_13.id!=="bookmark_name_"+id&&_13.id!=="bookmark_source_"+id&&_13.id!=="bookmark_url_"+id){_11.push("<",_13.get("name"),">",_13.get("value"),"</",_13.get("name"),">");}});_11.push("<action>",_e,"</action></bookmark>");var _14="";var _15=misys.xhrPost({url:misys.getServletURL("/screen/BookmarkMenuScreen"),handleAs:"json",content:{formContent:_11.join(""),bookmarkAction:"DELETE",currentActionCode:_f,currentScreen:_10},load:function(_16){_14=_16.content[0];}});_15.then(function(){var _17=dojo.byId("favorites");if(!dijit.byId("sendBookmark")){dojo.parser.parse(dojo.byId("favorites"));}misys.animate("wipeOut",_17,function(){dijit.byId("sendBookmark").destroyRecursive(true);var _18=dj.findWidgets(dojo.byId("favorites"));dojo.forEach(_18,function(w){w.destroyRecursive(false);});dojo.empty("favorites");_17.innerHTML=_14.substring(20,_14.length-6);dojo.parser.parse(dojo.byId("favorites"));misys.animate("wipeIn",_17);});});return _15;};d.mixin(m,{doBookmarkAction:function(_19,_1a,id,_1b,_1c){if(!dijit.byId("sendBookmark")){dojo.parser.parse("favorites");}if(_19==="SAVE"){_1(_1a,_1b,_1c);}else{_d(id,_1a,_1b,_1c);}}});})(dojo,dijit,misys);}