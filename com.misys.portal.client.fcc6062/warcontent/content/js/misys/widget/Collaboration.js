/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.widget.Collaboration"]){dojo._hasResource["misys.widget.Collaboration"]=true;dojo.provide("misys.widget.Collaboration");dojo.require("misys.widget.Dialog");dojo.require("dijit.TitlePane");dojo.require("dijit.form.Button");dojo.require("dijit.form.CheckBox");dojo.require("misys.layout.FloatingPane");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.grid._base");(function(d,dj,m){function _1(_2){var _3,id;do{m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/GetTaskId"),sync:true,load:function(_4,_5){id=_4;},error:function(_6){throw {name:"CollaborationError",message:"An error occurred when retrieving a Collaboration "+"task ID "+_6};}});if(id==="false"||id===_3){throw {name:"CollaborationError",message:"An error occurred when retrieving a Collaboration "+"task ID "+response};}_3=id;}while(d.byId(_2+"_row_"+id));return id;};function _7(_8,id,_9,_a){var _b=dj.byId("public_task_details_assignee_type_nosend_1"),_c=dj.byId("public_task_details_assignee_type_nosend_2"),_d=dj.byId("public_task_details_assignee_type_nosend_3"),_e=dj.byId("public_task_details_assignee_type_nosend_4"),_f;_9=_9?_9:"N";_8=_8.toLowerCase();var _10=dj.byId("tnx_id"),_11=dj.byId("ref_id"),_12=dj.byId("old_inp_dttm"),_13=dj.byId("todo_list_id").get("value"),_14=[dj.byId("sentence_posted_by").get("value")," ",dj.byId("sentence_you").get("value")," "],_15="01",_16=d.byId(_8+"_master_list"),_17,_18,li,_19;if(!_10||!_11||!_12){m.dialog.show("ERROR",m.getLocalization("generalCollaborationError"));return false;}switch(_8){case "private_tasks":_17=_1a(id);_18=dj.byId("private_description_nosend").get("value");break;case "public_tasks":_17=_1b(id);_15="02";if(dj.byId("public_task_details_type_nosend_3").get("checked")){_15="03";}_18=dj.byId("public_task_details_description_nosend").get("value");break;default:_17=_1c(id);_15="03";_14.push(dj.byId("sentence_to").get("value")," ");_14.push(dj.byId("notification_task_details_other_user_assignee_login_id_nosend").get("value")," ");_18=dj.byId("notification_description_nosend").get("value");break;}var _1d;if(d.byId(id+"_container")){_1d=d.byId(id+"_container");}else{_1d=d.create("div",{id:id+"_container"});}_17.push({name:"task_id",id:"task_id_"+id,value:id},{name:"tnx_id",id:"tnx_id_"+id,value:_10.get("value")},{name:"ref_id",id:"ref_id_"+id,value:_11.get("value")},{name:"todo_list_id",id:"todo_list_id_"+id,value:_13},{name:"old_inp_dttm",id:"old_inp_dttm_"+id,value:_12.get("value")},{name:"postSave",id:"postSave_"+id,value:_9});if(_a){d.forEach(_17,function(_1e){if(dj.byId(_1e.id||_1e.name)){dj.byId(_1e.id||_1e.name).destroy();}});}d.forEach(_17,function(_1f){new dj.form.TextBox({id:_1f.id||_1f.name,name:_1f.name,readOnly:true,value:_1f.value,type:"hidden"}).placeAt(_1d);});dojo.place(_1d,dojo.byId(_8+"_form"));_f=m.formToXML({selector:"#"+_8+"_form",xmlRoot:_8,ignoreDisabled:true});m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/SaveTask"),content:{xml_string:_f}});if(_15==="03"){_14.push(dj.byId("sentence_to").get("value")," ");if(_b&&_b.get("checked")){_14.push(dj.byId("public_task_details_other_user_assignee_login_id_nosend").get("value")," ");}else{if(_c&&_c.get("checked")){_14.push(dj.byId("public_task_details_bank_assignee_name_nosend").get("value")," ");_14.push(dj.byId("public_task_details_bank_assignee_abbv_name_nosend").get("value")," ");}else{if(_d&&_d.get("checked")){_14.push(dj.byId("public_task_details_counterparty_assignee_name_nosend").get("value")," ");_14.push(dj.byId("public_task_details_counterparty_assignee_abbv_name_nosend").get("value")," ");}else{if(_e&&_e.get("checked")){_14.push(dj.byId("public_details_bank_other_user_assignee_first_name_nosend").get("value")," ");_14.push(dj.byId("public_details_bank_other_user_assignee_last_name_nosend").get("value")," ");}}}}}if(d.style(_16,"display")==="none"||d.style(_16,"opacity")===0){d.style(_16,"opacity",0);m.animate("fadeIn",_16);}_19=["<label for='",_8,"_dismiss_",id,"' id='",_8,"_dismiss_",id,"_label'>","<span id='",_8,"_desc_",id,"'>",m.grid.sanitizeHTMLDataForUI(_18),"</span></label>","<span class='taskInfo'>",_14.join(""),"</span>","<span class='commentInfo' id='","task_edit_",id,"'>"," | ","<a href=\"javascript:void(0)\" onClick=\"misys.openTaskForUpdate(",id,")\">",m.getLocalization("Edit"),"</a></span>","<span class='commentInfo'>"," | ","<a href=\"javascript:void(0)\" onClick=\"misys.openCollaborationComment('",_8,"',",id,")\">",m.getLocalization("comments")," (<span id=\"",_8,"_comment_count_",id,"\">0</span>)</a></span>"];if(!_a){li=d.create("li",{id:_8+"_item_"+id,style:"display:none;opacity:0",innerHTML:_19.join("")},_16);}else{dj.byId(_8+"_dismiss_"+id).destroy();li=d.byId(_8+"_item_"+id);li.innerHTML=_19.join("");}new dj.form.CheckBox({id:_8+"_dismiss_"+id,name:_8+"_dismiss_"+id,onClick:function(){m.finishCollaborationTask(this,_8,id);}}).placeAt(_8+"_dismiss_"+id+"_label","first");if(!_a){var ol=d.create("ol",{id:_8+"_comments_"+id,style:"display:none"},_8+"_comment_fields","first");d.addClass(ol,"comment-list");}m.animate("fadeIn",li,function(){d.style(d.byId(_8+"_notice"),"display","none");});d.forEach(dijit.findWidgets(_1d),function(w){if(w){w.destroyRecursive();}});return true;};function _20(){var _21=dj.byId("entity");if(_21&&!_21.get("value")){m.dialog.show("ERROR",m.getLocalization("mandatoryEntityMessage"));return false;}return true;};function _22(){var _23=dj.byId("public_task_details_assignee_type_nosend_1"),_24=dj.byId("public_task_details_assignee_type_nosend_2"),_25=dj.byId("public_task_details_assignee_type_nosend_3"),_26=dj.byId("public_task_details_type_nosend_3"),_27=(_26)?_26.get("checked"):false,_28=d.byId("assigneeTypeFields");m.toggleFields(_27,["public_task_details_assignee_type_nosend_1","public_task_details_assignee_type_nosend_2","public_task_details_assignee_type_nosend_3","public_task_details_assignee_type_nosend_4"]);if(_27){var _29=[{id:"public_task_details_assignee_type_nosend_1",description:"user_to_user"},{id:"public_task_details_assignee_type_nosend_2",description:"user_to_bank"},{id:"public_task_details_assignee_type_nosend_3",description:"counterparty"},{id:"public_task_details_assignee_type_nosend_4",description:"bank"}];m.preDisplayAssigneeType=m.preDisplayAssigneeType||function(){return true;};m.preDisplayAssigneeType(_29);}if(_27){m.animate("fadeIn",_28,function(){_4f();_2a();_20();},false,{duration:20});}else{m.animate("fadeOut",_28,function(){if(_23){_23.set("checked",false);}if(_24){_24.set("checked",false);}if(_25){_25.set("checked",false);}_2a();},false,{duration:20});}};function _2a(){var _2b=dj.byId("public_task_details_assignee_type_nosend_1")?dj.byId("public_task_details_assignee_type_nosend_1").get("checked"):false,_2c=dj.byId("public_task_details_assignee_type_nosend_2")?dj.byId("public_task_details_assignee_type_nosend_2").get("checked"):false,_2d=dj.byId("public_task_details_assignee_type_nosend_3")?dj.byId("public_task_details_assignee_type_nosend_3").get("checked"):false,_2e=dj.byId("public_task_details_assignee_type_nosend_4")?dj.byId("public_task_details_assignee_type_nosend_4").get("checked"):false,_2f=d.byId("notifyBankFields"),_30=d.byId("notifyUserFields"),_31=d.byId("notifyCounterpartyFields"),_32=d.byId("bankAssigneeTasks");m.toggleFields(_2b,null,["public_task_details_other_user_assignee_login_id_nosend"]);m.toggleFields(_2c,null,["public_task_details_bank_assignee_name_nosend"],true,true);m.toggleFields(_2d,null,["public_task_details_counterparty_assignee_name_nosend"],true,true);m.toggleFields(_2e,null,["public_task_details_bank_other_user_assignee_login_id_nosend","public_task_details_bank_other_user_assignee_email_nosend"],true,true);dj.byId("public_task_details_other_user_assignee_login_id_nosend").set("readonly",true);dj.byId("public_task_details_other_user_assignee_login_id_nosend").set("disabled",true);m.animate("fadeOut",[_2f,_30,_31],function(){if(_2b){m.animate("fadeIn",_30);}else{if(_2c){m.animate("fadeIn",_2f,function(){var _33=dj.byId("public_task_details_assignee_type_nosend_2").get("checked");if(_33){dj.byId("public_task_details_bank_assignee_name_nosend").set("readonly",true);dj.byId("public_task_details_bank_assignee_name_nosend").set("disabled",true);}},false,{duration:1});}else{if(_2d){m.animate("fadeIn",_31);var _34=dj.byId("access_opened"),_35=dj.byId("public_task_details_counterparty_assignee_name_nosend"),_36=dj.byId("product_code").get("value"),_37=null,_38=dj.byId("counterparty_email_id_hidden"),_39=dj.byId("public_task_details_counterparty_assignee_abbv_name_nosend");if(_36&&(_36==="IP"||_36==="CR")){_37=dj.byId("seller_name")?dj.byId("seller_name"):dj.byId("seller_abbv_name");}else{if(_36&&(_36==="IN"||_36==="CN")){_37=dj.byId("buyer_name")?dj.byId("buyer_name"):dj.byId("buyer_abbv_name");}}if(_34&&_37){if(_37.get("value")!==""){if(_34.get("value")==="Y"){_35.set("value",_37.get("value"));_38.set("value",dj.byId("transaction_counterparty_email").get("value"));_39.set("value",dj.byId("ben_company_abbv_name").get("value"));}else{_35.set("value","");_39.set("value","");m.dialog.show("ERROR",m.getLocalization("errorCounterpartyCollaborationNotEnabled"));m.animate("fadeOut",_31);}}else{_35.set("value","");_39.set("value","");m.dialog.show("ERROR",m.getLocalization("errorSelectCounterpartyCollaboration"));m.animate("fadeOut",_31);}}}else{if(_2e){m.animate("fadeIn",_32);}}}}_3a();_3b();},false,{duration:20});};function _3c(){var _3d=[{name:"public_task_details_description_nosend",value:""}];if(dj.byId("public_task_details_email_notification_nosend").get("checked")){_3d.push({name:"public_task_details_email_nosend",value:""});}if(dj.byId("public_task_details_assignee_type_nosend_1").get("checked")){_3d.push({name:"public_task_details_other_user_assignee_login_id_nosend",value:""});}if(dj.byId("public_task_details_assignee_type_nosend_2")&&dj.byId("public_task_details_assignee_type_nosend_2").get("checked")){_3d.push({name:"public_task_details_bank_assignee_name_nosend",value:""});}if(dj.byId("public_task_details_assignee_type_nosend_3")&&dj.byId("public_task_details_assignee_type_nosend_3").get("checked")){_3d.push({name:"public_task_details_counterparty_assignee_name_nosend",value:""});if(dj.byId("public_task_details_counterparty_assignee_email_notification_nosend").get("checked")){_3d.push({name:"public_task_details_counterparty_assignee_email_nosend",value:""});}}if(dj.byId("public_task_details_assignee_type_nosend_4")&&dj.byId("public_task_details_assignee_type_nosend_4").get("checked")){_3d.push({name:"public_task_details_bank_other_user_assignee_login_id_nosend",value:""});if(dj.byId("public_task_details_bank_other_user_assignee_email_notification_nosend").get("checked")){_3d.push({name:"public_task_details_bank_other_user_assignee_email_nosend",value:""});}}return _3d;};function _3e(){var _3f=[{name:"notification_task_details_other_user_assignee_login_id_nosend",value:""},{name:"notification_description_nosend",value:""}];if(dj.byId("notification_task_details_email_notification_nosend").get("checked")){_3f.push({name:"notification_task_details_email_nosend",value:""});}return _3f;};function _40(){return [{name:"private_description_nosend",value:""}];};function _1b(id){var _41="N",_42="02",_43="N",_44="N",_45="N",_46;if(dj.byId("public_task_details_email_notification_nosend")&&dj.byId("public_task_details_email_notification_nosend").get("checked")){_41="Y";}if(dj.byId("public_task_details_type_nosend_3")&&dj.byId("public_task_details_type_nosend_3").get("checked")){_42="03";}if(dj.byId("public_task_details_counterparty_assignee_email_notification_nosend")&&dj.byId("public_task_details_counterparty_assignee_email_notification_nosend").get("checked")){_43="Y";}if(dj.byId("public_task_details_other_user_assignee_email_notification_nosend")&&dj.byId("public_task_details_other_user_assignee_email_notification_nosend").get("checked")){_44="Y";}if(dj.byId("public_task_details_assignee_type_nosend_1")&&dj.byId("public_task_details_assignee_type_nosend_1").get("checked")){_46="01";}else{if(dj.byId("public_task_details_assignee_type_nosend_2")&&dj.byId("public_task_details_assignee_type_nosend_2").get("checked")){_46="02";}else{if(dj.byId("public_task_details_assignee_type_nosend_3")&&dj.byId("public_task_details_assignee_type_nosend_3").get("checked")){_46="03";}else{if(dj.byId("public_task_details_assignee_type_nosend_4")&&dj.byId("public_task_details_assignee_type_nosend_4").get("checked")){_46="04";}}}}if(dj.byId("public_task_details_bank_assignee_email_notification_nosend")&&dj.byId("public_task_details_bank_assignee_email_notification_nosend").get("checked")){_45="Y";}var _47=[{name:"public_task_details_task_id_"+id,value:id},{name:"public_task_details_issue_user_id_"+id,value:dj.byId("connected_user_id").get("value")},{name:"public_task_details_issue_company_abbv_name_"+id,value:dj.byId("connected_company_abbv_name").get("value")},{name:"public_task_details_description_"+id,value:dj.byId("public_task_details_description_nosend").get("value")},{name:"public_task_details_email_notification_"+id,value:_41},{name:"public_task_details_email_"+id,value:dj.byId("public_task_details_email_nosend").get("value")},{name:"public_task_details_type_"+id,id:"",value:_42},{name:"public_task_details_assignee_type_"+id,id:"",value:_46},{name:"public_task_details_counterparty_assignee_name_"+id,value:dj.byId("public_task_details_counterparty_assignee_name_nosend").get("value")},{name:"public_task_details_counterparty_assignee_abbv_name_"+id,value:dj.byId("public_task_details_counterparty_assignee_abbv_name_nosend").get("value")},{name:"public_task_details_counterparty_assignee_email_notification_"+id,value:_43},{name:"public_task_details_counterparty_assignee_email_"+id,value:dj.byId("public_task_details_counterparty_assignee_email_nosend").get("value")},{name:"public_task_details_other_user_assignee_login_id_"+id,value:dj.byId("public_task_details_other_user_assignee_login_id_nosend").get("value")},{name:"public_task_details_other_user_assignee_user_id_"+id,value:dj.byId("public_task_details_other_user_assignee_user_id_nosend").get("value")},{name:"public_task_details_other_user_assignee_email_notification_"+id,value:_44},{name:"public_task_details_other_user_assignee_email_"+id,value:dj.byId("public_task_details_other_user_assignee_email_nosend").get("value")},{name:"public_task_details_bank_assignee_name_"+id,value:dj.byId("public_task_details_bank_assignee_name_nosend").get("value")},{name:"public_task_details_bank_assignee_abbv_name_"+id,value:dj.byId("public_task_details_bank_assignee_abbv_name_nosend").get("value")},{name:"public_task_details_bank_assignee_email_notification_"+id,value:_45},{name:"public_tasks_details_issue_date_"+id,value:""},{name:"public_tasks_details_bank_other_user_assignee_user_id_"+id,value:""}];if(_46=="04"){_47.push({name:"public_task_details_bank_other_user_assignee_login_id_"+id,value:dj.byId("public_task_details_bank_other_user_assignee_login_id_nosend").get("value")});var _48="N";if(dj.byId("public_task_details_bank_other_user_assignee_email_notification_nosend")&&dj.byId("public_task_details_bank_other_user_assignee_email_notification_nosend").get("checked")){_48="Y";}_47.push({name:"public_task_details_bank_other_user_assignee_email_notification_"+id,value:_48});_47.push({name:"public_task_details_bank_other_user_assignee_email_"+id,value:dj.byId("public_task_details_bank_other_user_assignee_email_nosend").get("value")});}return _47;};function _1c(id){var _49="N",_4a="01",_4b="03";if(dj.byId("notification_task_details_email_notification_nosend")&&dj.byId("notification_task_details_email_notification_nosend").get("checked")){_49="Y";}var _4c=[{name:"public_task_details_task_id_"+id,id:"",value:id},{name:"public_task_details_issue_user_id_"+id,id:"",value:dj.byId("connected_user_id").get("value")},{name:"public_task_details_issue_company_abbv_name_"+id,id:"",value:dj.byId("connected_company_abbv_name").get("value")},{name:"public_task_details_description_"+id,id:"public_task_details_description_nosend",value:dj.byId("notification_description_nosend").get("value")},{name:"public_task_details_email_notification_"+id,id:"",value:_49},{name:"public_task_details_email_"+id,id:"public_task_details_email_nosend",value:dj.byId("notification_task_details_email_nosend").get("value")},{name:"public_task_details_type_"+id,id:"",value:_4b},{name:"public_task_details_assignee_type_"+id,id:"",value:_4a},{name:"public_task_details_other_user_assignee_login_id_"+id,id:"public_task_details_other_user_assignee_login_id_nosend",value:dj.byId("notification_task_details_other_user_assignee_login_id_nosend").get("value")},{name:"public_tasks_details_issue_date_"+id,id:"",value:""},{name:"public_tasks_details_bank_other_user_assignee_user_id_"+id,id:"public_tasks_details_bank_other_user_assignee_user_id_nosend",value:dj.byId("notification_task_details_other_user_assignee_user_id_nosend").get("value")}];return _4c;};function _1a(id){var _4d="01";var _4e=[{name:"private_task_details_task_id_"+id,id:"",value:id},{name:"public_tasks_details_issue_date_"+id,id:"",value:""},{name:"private_task_details_issue_user_id_"+id,id:"",value:dj.byId("connected_user_id").get("value")},{name:"private_task_details_issue_company_abbv_name_"+id,id:"",value:dj.byId("connected_company_abbv_name").get("value")},{name:"private_task_details_description_"+id,id:"private_task_details_description_nosend",value:dj.byId("private_description_nosend").get("value")},{name:"public_task_details_type_"+id,id:"",value:_4d}];return _4e;};function _4f(){var _50=dj.byId("public_task_details_assignee_type_nosend_1"),_51=dj.byId("public_task_details_assignee_type_nosend_2"),_52=dj.byId("public_task_details_assignee_type_nosend_3");if(!_50){_50.set("checked",false);if(_51){_51.set("checked",true);_50.set("checked",false);if(_52){_52.set("checked",false);}}else{if(_52){_52.set("checked",true);_50.set("checked",false);}else{_50.set("checked",false);}}}else{_50.set("checked",true);if(_51){_51.set("checked",false);}if(_52){_52.set("checked",false);}}};function _53(_54,_55,_56,_57){var _58=dj.byId(_57).get("value");if(dj.byId(_54).get("checked")){m.animate("fadeIn",d.byId(_56),function(){if(_58){dj.byId(_55).set("value",_58);dj.byId(_55).set("readonly",true);dj.byId(_55).set("disabled",true);}},false,{duration:20});}else{m.animate("fadeOut",_56,function(){dj.byId(_55).set("value","");},false,{duration:20});}};function _3a(){var _59,_5a,_5b,_5c;if(dj.byId("public_task_details_assignee_type_nosend_2")&&dj.byId("public_task_details_assignee_type_nosend_2").get("checked")){if(dj.byId("bank_abbv_name_widget_id_hidden")&&dj.byId("bank_name_widget_id_hidden")){_59=dj.byId("bank_abbv_name_widget_id_hidden").get("value");_5b=dj.byId("bank_name_widget_id_hidden").get("value");if(dj.byId(_59)){_5a=dj.byId(_59);dj.byId("public_task_details_bank_assignee_abbv_name_nosend").set("value",_5a.get("value"));}if(dj.byId(_5b)){_5c=dj.byId(_5b);dj.byId("public_task_details_bank_assignee_name_nosend").set("value",_5c.get("value"));}}}else{dj.byId("public_task_details_bank_assignee_name_nosend").set("value","");dj.byId("public_task_details_bank_assignee_abbv_name_nosend").set("value","");}};function _3b(){var _5d=dj.byId("public_task_details_type_nosend_2"),_5e=dj.byId("public_task_details_type_nosend_3"),_5f=dj.byId("public_task_details_assignee_type_nosend_1"),_60=dj.byId("public_task_details_assignee_type_nosend_2"),_61=dj.byId("public_task_details_assignee_type_nosend_3");if(_5d.get("checked")){m.animate("fadeOut",[d.byId("counterparty_email_input_field_div"),d.byId("other_user_email_input_field_div")],function(){dj.byId("public_task_details_other_user_assignee_login_id_nosend").reset();dj.byId("public_task_details_other_user_assignee_email_notification_nosend").set("checked",false);dj.byId("other_user_email_id_hidden").reset();dj.byId("public_task_details_other_user_assignee_user_id_nosend").reset();dj.byId("public_task_details_other_user_assignee_email_nosend").reset();dj.byId("public_task_details_counterparty_assignee_name_nosend").reset();dj.byId("public_task_details_counterparty_assignee_abbv_name_nosend").reset();dj.byId("public_task_details_counterparty_assignee_email_notification_nosend").set("checked",false);dj.byId("counterparty_email_id_hidden").reset();dj.byId("public_task_details_counterparty_assignee_email_nosend").reset();dj.byId("public_task_details_bank_assignee_email_notification_nosend").set("checked",false);dj.byId("public_task_details_bank_assignee_name_nosend").reset();},false,{duration:20});}else{if(_5f&&!_5f.get("checked")){m.animate("fadeOut",d.byId("other_user_email_input_field_div"),function(){dj.byId("public_task_details_other_user_assignee_login_id_nosend").reset();dj.byId("public_task_details_other_user_assignee_email_notification_nosend").set("checked",false);dj.byId("public_task_details_other_user_assignee_user_id_nosend").reset();dj.byId("other_user_email_id_hidden").reset();dj.byId("public_task_details_other_user_assignee_email_nosend").reset();});}if(_60&&!_60.get("checked")){dj.byId("public_task_details_bank_assignee_email_notification_nosend").set("checked",false);dj.byId("public_task_details_bank_assignee_name_nosend").reset();}if(_61&&!_61.get("checked")){m.animate("fadeOut",d.byId("counterparty_email_input_field_div"),function(){dj.byId("public_task_details_counterparty_assignee_name_nosend").reset();dj.byId("public_task_details_counterparty_assignee_email_notification_nosend").set("checked",false);dj.byId("counterparty_email_id_hidden").reset();dj.byId("public_task_details_counterparty_assignee_abbv_name_nosend").reset();dj.byId("public_task_details_counterparty_assignee_email_nosend").reset();});}}};function _62(_63){var _64=null;if(dj.byId(_63)){var _65=dj.byId(_63).get("value");if((_65.indexOf("<")!=-1)||(_65.indexOf(">")!=-1)){_64=m.getLocalization("invalidContent");dj.byId(_63).set("state","Error");dj.hideTooltip(dj.byId(_63).domNode);dj.showTooltip(_64,dj.byId(_63).domNode,0);}}};var _66=[];d.mixin(m,{bindCollaboration:function(){m.setValidation("public_task_details_email_nosend",m.validateEmailAddr);m.setValidation("public_task_details_bank_other_user_assignee_email_nosend",m.validateEmailAddr);m.setValidation("public_task_details_counterparty_assignee_email_nosend",m.validateEmailAddr);m.connect("public_task_details_email_notification_nosend","onClick",function(){m.toggleFields(this.get("checked"),null,["public_task_details_email_nosend"]);_53(this,"public_task_details_email_nosend","email_input_field_div","user_email_id_hidden");});m.connect("notification_task_details_email_notification_nosend","onClick",function(){m.toggleFields(this.get("checked"),null,["notification_task_details_email_nosend"]);});m.connect("public_task_details_counterparty_assignee_email_notification_nosend","onClick",function(){m.toggleFields(this.get("checked"),null,["public_task_details_counterparty_assignee_email_nosend"]);if(!dj.byId("public_task_details_counterparty_assignee_name_nosend").get("value")){dj.byId("counterparty_email_id_hidden").set("value","");dj.byId("public_task_details_counterparty_assignee_email_notification_nosend").set("checked",false);}else{_53(this,"public_task_details_counterparty_assignee_email_nosend","counterparty_email_input_field_div","counterparty_email_id_hidden");}});m.connect("public_task_details_other_user_assignee_email_notification_nosend","onClick",function(){m.toggleFields(this.get("checked"),null,["public_task_details_other_user_assignee_email_nosend"]);if(!dj.byId("public_task_details_other_user_assignee_login_id_nosend").get("value")){dj.byId("other_user_email_id_hidden").set("value","");dj.byId("public_task_details_other_user_assignee_email_notification_nosend").set("checked",false);}else{_53(this,"public_task_details_other_user_assignee_email_nosend","other_user_email_input_field_div","other_user_email_id_hidden");}});_66.push(m.connect("public_task_details_type_nosend_2","onClick",_22));_66.push(m.connect("public_task_details_type_nosend_3","onClick",_22));_66.push(m.connect("public_task_details_assignee_type_nosend_1","onClick",_20));_66.push(m.connect("public_task_details_assignee_type_nosend_1","onClick",_2a));_66.push(m.connect("public_task_details_assignee_type_nosend_2","onClick",_2a));_66.push(m.connect("public_task_details_assignee_type_nosend_3","onClick",_2a));_66.push(m.connect("public_task_details_assignee_type_nosend_4","onClick",_2a));m.connect("public_task_details_description_nosend","onBlur",function(){_62("public_task_details_description_nosend");});m.connect("private_description_nosend","onBlur",function(){_62("private_description_nosend");});m.connect("public_tasks_description_nosend","onBlur",function(){_62("public_tasks_description_nosend");});m.connect("private_tasks_description_nosend","onBlur",function(){_62("private_tasks_description_nosend");});m.connect("notification_description_nosend","onBlur",function(){_62("notification_description_nosend");});m.connect("notification_tasks_description_nosend","onBlur",function(){_62("notification_tasks_description_nosend");});m.connect("public_task_details_description_nosend","onBlur",function(){_62("public_task_details_description_nosend");});},cancelCollaborationTask:function(_67){if(dj.byId("public_task_id_nosend")){dj.byId("public_task_id_nosend").set("value","");}dj.byId("public_tasks_dialog").hide();},addCollaborationTask:function(_68,_69){if(dj.byId(_68+"_description_nosend")&&dj.byId(_68+"_description_nosend").state!=="Error"){var _6a=[],_6b=false,id="",_6c=true,_6d=dj.byId(_68+"_dialog"),_6e,_6f,_70;_68=_68.toLowerCase();switch(_68){case "private_tasks":_6a=_40();id=dj.byId("private_task_id_nosend").get("value");break;case "public_tasks":_6a=_3c();id=dj.byId("public_task_id_nosend").get("value");break;default:_6a=_3e();id=dj.byId("notification_task_id_nosend").get("value");break;}if(id===""){id=_1(_68);_6c=false;}_6b=d.every(_6a,function(_71){_6e=dj.byId(_71.name);if(_6e){_6f=_6e.declaredClass;_70=_6e.get("displayedValue");if(/NumberTextBox/.test(_6f)||(/CurrencyTextBox/.test(_6f))){_70=_6e.get("value");_70=isNaN(_70)?"":_70;}else{if(_6e.id){_62(_6e.id);}}if(_68==="private_tasks"&&_6e.state==="Error"){return false;}if(!_70||_6e.state==="Error"){m.showTooltip(_6e.invalidMessage,_6e.domNode);m.setFieldState(_6e,false);return false;}}return true;});if(!_6b){return false;}_7(_68,id,_69,_6c);if(_6d){_6d.hide();}d.query("#"+_68+"_fields *[id^="+_68+"]").forEach(function(_72){var _73=dj.byId(_72.id);if(_73){_73.reset();}});m._config.taskEditMode=false;m._config.currentTaskID="";if(_6c){switch(_68){case "private_tasks":if(dj.byId("private_task_id_nosend")){dj.byId("private_task_id_nosend").set("value","");}break;case "public_tasks":if(dj.byId("public_task_id_nosend")){dj.byId("public_task_id_nosend").set("value","");}break;default:if(dj.byId("notification_task_id_nosend")){dj.byId("notification_task_id_nosend").set("value","");}break;}}return true;}},finishCollaborationTask:function(_74,_75,id){var _76=dj.byId(_74),_77=d.byId("old_inp_dttm")?d.byId("old_inp_dttm").value:"",_78=_76.get("checked"),_79;if(d.byId("task_edit_"+id)){var _7a=d.byId("task_edit_"+id);d.style(_7a,"display",_78?"none":"inline");}m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/SetPerformed?taskid="+id+"&performed="+(_78?"Y":"N")+"&inputdate="+_77),load:function(_7b,_7c){_79=d.byId(_75+"_desc_"+id);if(_78){d.style(_79,"textDecoration","line-through");d.style(_79,"color","#999");}else{d.style(_79,"textDecoration","none");d.style(_79,"color","black");}}});},openCollaborationComment:function(_7d,id){var _7e=dj.byId(_7d+"_comments_dialog"),_7f,_80;if(!_7e){d.parser.parse(_7d+"_comments_div");_7e=dj.byId(_7d+"_comments_dialog");m.bindCollaboration();}_7f=dj.byId(_7d+"_comments_current_id_nosend");dj.byId(_7d+"_description_nosend").set("value","");_80=_7f.get("value");if(_80){d.style(d.byId(_7d+"_comments_"+_80),"display","none");}_7f.set("value",id);_7e.show();d.style(d.byId(_7d+"_comments_"+id),"display","block");d.style(d.byId(_7d+"_comments_"+id),"width","425px");d.style(d.byId(_7d+"_comments_"+id),"height","173px");d.style(d.byId(_7d+"_comments_"+id),"overflow","auto");},addCollaborationComment:function(_81){if(dj.byId(_81+"_description_nosend")&&dj.byId(_81+"_description_nosend").state!=="Error"){var _82=dj.byId(_81+"_description_nosend").get("value"),xml=["<?xml version='1.0' encoding='UTF-8'?><comment>"],_83=dj.byId("old_inp_dttm").get("value"),_84,id;if((_82)&&(_82.length<=204)){id=dj.byId(_81+"_comments_current_id_nosend").get("value");xml.push("<description>",m.grid.sanitizeHTMLDataForUI(dj.byId(_81+"_description_nosend").get("value")),"</description>");xml.push("<task_id>",id,"</task_id>");xml.push("<old_inp_dttm>",_83,"</old_inp_dttm></comment>");xml=xml.join("");m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/SaveComment"),content:{xml_string:xml},load:function(_85,_86){var _87=d.byId(_81+"_comments_"+id),_88=_87.getElementsByTagName("li").length,_89=dj.byId(_81+"_description_nosend"),_8a=dj.byId("sentence_posted_by").get("value")+" "+dj.byId("sentence_you").get("value");d.create("li",{id:_81+"_comment_"+id+"_"+_88,innerHTML:_89.get("value")+"<br><div class='taskInfo'>"+_8a+"</div>"},_87);var _8b=parseInt(d.byId(_81+"_comment_count_"+id).innerHTML,10);_8b++;d.byId(_81+"_comment_count_"+id).innerHTML=_8b;_89.set("value","");},error:function(_8c,_8d){console.error("[collaboration] Technical error while saving Comment");console.error(_8c);}});}}},openPublicTaskDialog:function(){var _8e=dj.byId("public_tasks_dialog");if(!_8e){d.parser.parse("public-tasks-fields");_8e=dj.byId("public_tasks_dialog");m.bindCollaboration();}var _8f=[];_8f.push(d.byId("collaboration_type_view_div"));_8f.push(d.byId("email_input_field_div"));_8f.push(d.byId("counterparty_email_input_field_div"));_8f.push(d.byId("other_user_email_input_field_div"));m.animate("fadeOut",_8f,function(){_8e.show();},false,{duration:20});dj.byId("public_task_details_description_nosend").reset();dj.byId("public_task_details_other_user_assignee_user_id_nosend").reset();dj.byId("public_task_details_email_nosend").reset();dj.byId("public_task_details_email_notification_nosend").set("checked",false);if(dj.byId("public_task_details_email_notification_nosend")){m.toggleFields(dj.byId("public_task_details_email_notification_nosend").get("checked"),null,["public_task_details_email_nosend"]);}dj.byId("public_task_details_type_nosend_2").set("checked",true);dj.byId("public_task_details_type_nosend_3").set("checked",false);_22();dj.byId("public_task_details_other_user_assignee_login_id_nosend").reset();dj.byId("public_task_details_bank_assignee_name_nosend").reset();dj.byId("public_task_details_bank_assignee_abbv_name_nosend").reset();dj.byId("public_task_details_bank_assignee_email_notification_nosend").set("checked",false);dj.byId("public_task_details_counterparty_assignee_name_nosend").reset();dj.byId("public_task_details_counterparty_assignee_email_notification_nosend").set("checked",false);dj.byId("public_task_details_counterparty_assignee_email_nosend").set("disabled",true);},openNotificationTaskDialog:function(){var _90=dj.byId("notification_tasks_dialog");if(!_90){d.parser.parse("notification-task-fields");_90=dj.byId("notification_tasks_dialog");m.bindCollaboration();}if(dj.byId("notification_task_details_email_notification_nosend")){m.toggleFields(dj.byId("notification_task_details_email_notification_nosend").get("checked"),null,["notification_task_details_email_nosend"]);}dj.byId("notification_task_details_other_user_assignee_login_id_nosend").reset();dj.byId("notification_description_nosend").reset();_90.show();},openPrivateTaskDialog:function(){var _91=dj.byId("private_tasks_dialog");if(!_91){d.parser.parse("private-task-fields");_91=dj.byId("private_tasks_dialog");m.bindCollaboration();}_91.show();dj.byId("private_description_nosend").reset();},openTaskForUpdate:function(_92){m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/GetTask?taskid="+_92),load:function(_93,_94){_93=d.fromJson(_93);if(_93.type[1]==="01"){m.openPrivateTaskDialog();dj.byId("private_task_id_nosend").set("value",_93.task_id);dj.byId("private_description_nosend").set("value",_93.description);}else{_22=function(){};_2a=function(){};m.openPublicTaskDialog();d.forEach(_66,function(_95){d.disconnect(_95);});dj.byId("public_task_id_nosend").set("value",_93.task_id);dj.byId("public_task_details_description_nosend").set("value",_93.description);dj.byId("public_task_details_email_notification_nosend").set("checked",_93.email_notification==="Y");dj.byId("public_task_details_email_nosend").set("value",_93.email);dj.byId("public_task_details_type_nosend_2").set("checked",_93.type[1]==="02");dj.byId("public_task_details_type_nosend_3").set("checked",_93.type[1]==="03");if(_93.type[1]==="03"){m.toggleFields(true,["public_task_details_assignee_type_nosend_1","public_task_details_assignee_type_nosend_2","public_task_details_assignee_type_nosend_3"]);d.style("assigneeTypeFields","display","block");if(dj.byId("public_task_details_assignee_type_nosend_1")){dj.byId("public_task_details_assignee_type_nosend_1").set("checked",_93.assignee_type[1]==="01");}if(dj.byId("public_task_details_assignee_type_nosend_2")){dj.byId("public_task_details_assignee_type_nosend_2").set("checked",_93.assignee_type[1]==="02");}if(dj.byId("public_task_details_assignee_type_nosend_3")){dj.byId("public_task_details_assignee_type_nosend_3").set("checked",_93.assignee_type[1]==="03");}if(_93.assignee_type[1]==="01"){d.style("notifyUserFields","display","block");dj.byId("public_task_details_other_user_assignee_login_id_nosend").set("value",_93.dest_user_login_id);dj.byId("public_task_details_other_user_assignee_user_id_nosend").set("value",_93.dest_user_id);dj.byId("public_task_details_other_user_assignee_email_notification_nosend").set("value",_93.dest_user_email_notif==="Y");dj.byId("public_task_details_other_user_assignee_email_nosend").set("value",_93.dest_user_email);dj.byId("other_user_email_id_hidden").set("value",_93.dest_user_email);if(_93.dest_user_email_notif==="Y"){d.style("other_user_email_input_field_div","display","block");m.toggleFields(true,null,["public_task_details_other_user_assignee_email_nosend"]);_53(dj.byId("public_task_details_other_user_assignee_email_notification_nosend"),"public_task_details_other_user_assignee_email_nosend","other_user_email_input_field_div","other_user_email_id_hidden");}}if(_93.assignee_type[1]==="02"){d.style("notifyBankFields","display","block");dj.byId("public_task_details_bank_assignee_name_nosend").set("value",_93.dest_company_name);dj.byId("public_task_details_bank_assignee_abbv_name_nosend").set("value",_93.dest_company_abbv_name);dj.byId("public_task_details_bank_assignee_email_notification_nosend").set("checked",_93.dest_company_email_notif==="Y");}if(_93.assignee_type[1]==="03"){d.style("notifyCounterpartyFields","display","block");dj.byId("public_task_details_counterparty_assignee_name_nosend").set("value",_93.dest_company_name);dj.byId("public_task_details_counterparty_assignee_abbv_name_nosend").set("value",_93.dest_company_abbv_name);dj.byId("public_task_details_counterparty_assignee_email_notification_nosend").set("checked",_93.dest_company_email_notif==="Y");}var _96=dj.byId("public_task_details_assignee_type_nosend_1"),_97=dj.byId("public_task_details_assignee_type_nosend_2"),_98=dj.byId("public_task_details_assignee_type_nosend_3"),_99=dj.byId("public_task_details_type_nosend_3"),_9a=(_99)?_99.get("checked"):false,_9b=d.byId("assigneeTypeFields");if(_9a){var _9c=[{id:"public_task_details_assignee_type_nosend_1",description:"user_to_user"},{id:"public_task_details_assignee_type_nosend_2",description:"user_to_bank"},{id:"public_task_details_assignee_type_nosend_3",description:"counterparty"},{id:"public_task_details_assignee_type_nosend_4",description:"bank"}];m.preDisplayAssigneeType=m.preDisplayAssigneeType||function(){return true;};m.preDisplayAssigneeType(_9c);}}_22=function(){var _9d=dj.byId("public_task_details_assignee_type_nosend_1"),_97=dj.byId("public_task_details_assignee_type_nosend_2"),_98=dj.byId("public_task_details_assignee_type_nosend_3"),_99=dj.byId("public_task_details_type_nosend_3"),_9a=(_99)?_99.get("checked"):false,_9b=d.byId("assigneeTypeFields");m.toggleFields(_9a,["public_task_details_assignee_type_nosend_1","public_task_details_assignee_type_nosend_2","public_task_details_assignee_type_nosend_3","public_task_details_assignee_type_nosend_4"]);if(_9a){var _9e=[{id:"public_task_details_assignee_type_nosend_1",description:"user_to_user"},{id:"public_task_details_assignee_type_nosend_2",description:"user_to_bank"},{id:"public_task_details_assignee_type_nosend_3",description:"counterparty"},{id:"public_task_details_assignee_type_nosend_4",description:"bank"}];m.preDisplayAssigneeType=m.preDisplayAssigneeType||function(){return true;};m.preDisplayAssigneeType(_9e);}if(_9a){m.animate("fadeIn",_9b,function(){if(_97&&_97.get("checked")){_97.set("checked",true);m.animate("fadeOut",d.byId("notifyUserFields"),function(){},false,{duration:20});m.animate("fadeOut",d.byId("notifyCounterpartyFields"),function(){},false,{duration:20});m.animate("fadeIn",d.byId("notifyBankFields"));}else{if(_9d&&_9d.get("checked")){_9d.set("checked",true);m.animate("fadeOut",d.byId("notifyBankFields"),function(){},false,{duration:20});m.animate("fadeOut",d.byId("notifyCounterpartyFields"),function(){},false,{duration:20});m.animate("fadeIn",d.byId("notifyUserFields"));}else{if(_98&&_98.get("checked")){_98.set("checked",true);m.animate("fadeOut",d.byId("notifyUserFields"),function(){},false,{duration:20});m.animate("fadeOut",d.byId("notifyBankFields"),function(){},false,{duration:20});m.animate("fadeIn",d.byId("notifyCounterpartyFields"));}else{_9d.set("checked",true);m.animate("fadeOut",d.byId("notifyBankFields"),function(){},false,{duration:20});m.animate("fadeOut",d.byId("notifyCounterpartyFields"),function(){},false,{duration:20});m.animate("fadeIn",d.byId("notifyUserFields"));}}}},false,{duration:20});}else{m.animate("fadeOut",_9b,function(){if(_9d){_9d.set("checked",false);}if(_97){_97.set("checked",false);}if(_98){_98.set("checked",false);}_2a();},false,{duration:20});}};_2a=function(){var _9f=dj.byId("public_task_details_assignee_type_nosend_1")?dj.byId("public_task_details_assignee_type_nosend_1").get("checked"):false,_a0=dj.byId("public_task_details_assignee_type_nosend_2")?dj.byId("public_task_details_assignee_type_nosend_2").get("checked"):false,_a1=dj.byId("public_task_details_assignee_type_nosend_3")?dj.byId("public_task_details_assignee_type_nosend_3").get("checked"):false,_a2=dj.byId("public_task_details_assignee_type_nosend_4")?dj.byId("public_task_details_assignee_type_nosend_4").get("checked"):false,_a3=d.byId("notifyBankFields"),_a4=d.byId("notifyUserFields"),_a5=d.byId("notifyCounterpartyFields"),_a6=d.byId("bankAssigneeTasks");m.toggleFields(_9f,null,["public_task_details_other_user_assignee_login_id_nosend"]);m.toggleFields(_a0,null,["public_task_details_bank_assignee_name_nosend"],true,true);m.toggleFields(_a1,null,["public_task_details_counterparty_assignee_name_nosend"],true,true);m.toggleFields(_a2,null,["public_task_details_bank_other_user_assignee_login_id_nosend","public_task_details_bank_other_user_assignee_email_nosend"],true,true);dj.byId("public_task_details_other_user_assignee_login_id_nosend").set("readonly",true);dj.byId("public_task_details_other_user_assignee_login_id_nosend").set("disabled",true);m.animate("fadeOut",[_a3,_a4,_a5],function(){if(_9f){m.animate("fadeIn",_a4);}else{if(_a0){m.animate("fadeIn",_a3);}else{if(_a1){m.animate("fadeIn",_a5);var _a7=dj.byId("access_opened"),_a8=dj.byId("public_task_details_counterparty_assignee_name_nosend"),_a9=dj.byId("product_code").get("value"),_aa=null,_ab=dj.byId("counterparty_email_id_hidden"),_ac=dj.byId("public_task_details_counterparty_assignee_abbv_name_nosend");if(_a9&&_a9=="IP"){_aa=dj.byId("seller_name")?dj.byId("seller_name"):dj.byId("seller_abbv_name");}else{if(_a9&&_a9=="IN"){_aa=dj.byId("buyer_name")?dj.byId("buyer_name"):dj.byId("buyer_abbv_name");}}if(_a7&&_aa){if(_aa.get("value")!==""){if(_a7.get("value")==="Y"){_a8.set("value",_aa.get("value"));_ab.set("value",dj.byId("transaction_counterparty_email").get("value"));_ac.set("value",dj.byId("ben_company_abbv_name").get("value"));}else{_a8.set("value","");_ac.set("value","");m.dialog.show("ERROR",m.getLocalization("errorCounterpartyCollaborationNotEnabled"));m.animate("fadeOut",_a5);}}else{_a8.set("value","");_ac.set("value","");m.dialog.show("ERROR",m.getLocalization("errorSelectCounterpartyCollaboration"));m.animate("fadeOut",_a5);}}}else{if(_a2){m.animate("fadeIn",_a6);}}}}_3a();_3b();},false,{duration:20});};_66=[];_66.push(m.connect("public_task_details_type_nosend_2","onClick",_22));_66.push(m.connect("public_task_details_type_nosend_3","onClick",_22));_66.push(m.connect("public_task_details_assignee_type_nosend_1","onClick",_20));_66.push(m.connect("public_task_details_assignee_type_nosend_1","onClick",_2a));_66.push(m.connect("public_task_details_assignee_type_nosend_2","onClick",_2a));_66.push(m.connect("public_task_details_assignee_type_nosend_3","onClick",_2a));_66.push(m.connect("public_task_details_assignee_type_nosend_4","onClick",_2a));if(_93.type[1]==="02"){dj.byId("public_task_details_type_nosend_2").onClick();}else{dj.byId("public_task_details_type_nosend_3").onClick();}}}});},showCollaborationTaskDetails:function(){m.animate("fadeIn",d.byId("collaboration-more-tasks"),function(){m.animate("fadeOut",d.byId("show-tasks-details-link"),false,{duration:20});},false,{duration:20});}});})(dojo,dijit,misys);}