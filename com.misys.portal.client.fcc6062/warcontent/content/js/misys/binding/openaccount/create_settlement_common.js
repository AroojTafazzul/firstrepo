/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.openaccount.create_settlement_common"]){dojo._hasResource["misys.binding.openaccount.create_settlement_common"]=true;dojo.provide("misys.binding.openaccount.create_settlement_common");dojo.require("misys.validation.common");(function(d,dj,m){_getValueAsNumber=function(_1){if(d.isString(_1)){var _2=d.number.parse(_1);return _2;}return _1;};function _3(_4){if(_4.get("type")==="hidden"){return d.date.locale.format(m.localizeDate(_4),{selector:"date"});}return _4.get("displayedValue");};d.mixin(m,{setFXConversion:function(){var _5=dj.byId("product_code").get("value");if(m._config.fxParamData&&m._config.fxParamData[_5]&&m._config.fxParamData[_5].fxParametersData.isFXEnabled==="Y"){m.connect("fx_exchange_rate_cur_code","onChange",function(){var _6=dj.byId("fx_exchange_rate");var _7=dj.byId("fx_exchange_rate_amt");if(_6){_6.set("value","");}if(_7){_7.set("value","");}dj.byId("fx_exchange_rate_amt").set("value","");m.setSettlementCurrency(this,["fx_exchange_rate_amt"]);if(dj.byId("fx_exchange_rate_cur_code").get("value")!==""){m.fireFXAction();}});}else{if(d.byId("fx-section")){d.style("fx-section","display","none");}}},fireFXAction:function(){var _8=dj.byId("product_code");if(m._config.fxParamData&&_8&&_8.get("value")!==""){var _9=m._config.fxParamData[_8.get("value")];if(m._config.fxParamData&&_9.fxParametersData.isFXEnabled==="Y"){var _a,_b="";var _c;if(dj.byId("fx_exchange_rate_cur_code")){_b=dj.byId("fx_exchange_rate_cur_code").get("value");}if(dj.byId("settlement_amt")){_c=dj.byId("settlement_amt").get("value");}if(dj.byId("liab_total_net_cur_code")){_a=dj.byId("liab_total_net_cur_code").get("value");}var _d=m._config.productCode;var _e="";if(dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""){_e=dj.byId("issuing_bank_abbv_name").get("value");}if(dj.byId("liab_total_net_cur_code")){var _f=dj.byId("liab_total_net_cur_code").get("value");}_f=_a;if(d.byId("fx-section")&&(d.style(d.byId("fx-section"),"display")==="none")){m.animate("wipeIn",d.byId("fx-section"));}m.fetchFXDetails(_a,_b,_c,_d,_e,_f,false);if(_a&&_a!==""&&_b&&_b!==""&&_a===_b){dj.byId("fx_exchange_rate").set("value","1");dj.byId("fx_exchange_rate_cur_code").set("value",dj.byId("settlement_cur_code").get("value"));dj.byId("fx_exchange_rate_amt").set("value",dj.byId("settlement_amt").get("value"));}if(isNaN(_c)){dj.byId("fx_exchange_rate_amt").set("value","");}}}},setCommonSettlementDetails:function(){m.initializeSettlementDetails();m.setCurrency("liab_total_net_cur_code",["liab_total_net_amt"]);m.setSettlementCurrency("settlement_cur_code",["settlement_amt"]);var _10=dj.byId("fx_exchange_rate_amt");if(_10){_10.set("readonly",true);}var _11=dj.byId("liab_total_net_cur_code");var _12=dj.byId("fx_exchange_rate_cur_code");if(m._config.fxParamData&&dj.byId("product_code")&&dj.byId("product_code").get("value")!==""){m.initializeFX(dj.byId("product_code").get("value"));m.onloadFXActions();}m.fireFXAction();},collectionValidateInvoiceDateFrom:function(){if(this.get("value")===null){return true;}var _13=dj.byId("iss_date2");if(!m.compareDateFields(this,_13)){var _14=dj.byId("iss_date");displayMessage=misys.getLocalization("InvoiceIssueDateFromLesserThanInvoiceIssueDateTo");_14.focus();_14.set("state","Error");dj.hideTooltip(_14.domNode);dj.showTooltip(displayMessage,_14.domNode,0);}return true;},collectionValidateInvoiceDateTo:function(){if(this.get("value")===null){return true;}var _15=dj.byId("iss_date");if(!m.compareDateFields(_15,this)){var _16=dj.byId("iss_date2");displayMessage=misys.getLocalization("InvoiceIssueDateToGreaterThanInvoiceIssueDateFrom");_16.focus();_16.set("state","Error");dj.hideTooltip(_16.domNode);dj.showTooltip(displayMessage,_16.domNode,0);return false;}return true;},collectionValidateDueDateFrom:function(){if(this.get("value")===null){return true;}var _17=dj.byId("due_date2");if(!m.compareDateFields(this,_17)){var _18=dj.byId("due_date"),_19=misys.getLocalization("InvoiceDueDateFromGreaterThanInvoiceDueDateTo");_18.focus();_18.set("state","Error");dj.hideTooltip(_18.domNode);dj.showTooltip(_19,_18.domNode,0);dj.showTooltip(_19,domNode,0);return false;}return true;},collectionValidateDueDateTo:function(){if(this.get("value")===null){return true;}var _1a=dj.byId("due_date");if(!m.compareDateFields(_1a,this)){var _1b=dj.byId("due_date2");displayMessage=misys.getLocalization("InvoiceDueDateToLesserThanInvoiceDueDateFrom");_1b.focus();_1b.set("state","Error");dj.hideTooltip(_1b.domNode);dj.showTooltip(displayMessage,_1b.domNode,0);}return true;},setSettlementAmt:function(){var _1c;var _1d=true;if(dj.byId("invoice_outstanding_amt")){_1c=_getValueAsNumber(dj.byId("invoice_outstanding_amt").get("value"));}var _1e=_getValueAsNumber(dj.byId("settlement_amt").get("value"));var _1f=dj.byId("settlement_percentage");var _20=_1f.get("value");var _21="^[0-9]{1,3}(?:.[0-9]{1,2})?$";var _22=_getValueAsNumber(_20);var _23=new RegExp(_21);var _24=dj.byId("collectionAmountConfig").get("value");if(_24){var _25=dj.byId("threshold_amount").get("value");var _26=_getValueAsNumber(_25);var _27=dj.byId("collections_amt").get("value");var _28=_getValueAsNumber(_27);var _29=dj.byId("invoice_outstanding_amt").get("value");var _2a=_getValueAsNumber(_29);var _2b=_26-(_28-_2a);var _2c=_getValueAsNumber(_2b);var _2d=parseFloat((_2c*100)/_2a).toFixed(2);var _2e=_getValueAsNumber(_2d);var _2f=parseFloat(_22).toFixed(2);var _30;_30=m.getLocalization("settlementPercentageError",[_22,_2e]);if(_2e&&(_2e!=="0"&&_2e>=_22)){_1e=(_20*_1c)/100;dj.byId("settlement_amt").set("value",_1e);}else{if(_2e<_22){misys.dialog.show("ERROR",_30);dj.byId("settlement_percentage").set("value","");}}}else{if(_20!==null&&!isNaN(_20)&&parseFloat(_20)>0&&_23.test(_20)){_1e=(_20*_1c)/100;dj.byId("settlement_amt").set("value",_1e);}else{if(_22===0){displayMessage=misys.getLocalization("settlementPercentageCantBeZero");_1d=false;}else{displayMessage=misys.getLocalization("incorrectPercentage");_1d=false;}}if(!_1d){_1f.set("value","");_1f.set("state","Error");dj.hideTooltip(_1f.domNode);dj.showTooltip(displayMessage,_1f.domNode,0);}}},setSettlementPercentage:function(){var _31=dj.byId("settlement_amt");var _32=_getValueAsNumber(dj.byId("settlement_amt").get("value"));var _33;var _34;var _35=dj.byId("settlement_percentage");if(dj.byId("invoice_outstanding_amt")){_33=_getValueAsNumber(dj.byId("invoice_outstanding_amt").get("value"));}if(_32&&_32!=="0"&&_33){_34=parseFloat((_32*100)/_33).toFixed(2);}if(_32===0){misys.dialog.show("ERROR",misys.getLocalization("settlementAmtCantBeZero"));_31.set("value","");_31.set("state","Error");}var _36=dj.byId("collectionAmountConfig").get("value");if(_36){var _37=dj.byId("threshold_amount").get("value");var _38=_getValueAsNumber(_37);var _39=dj.byId("collections_amt").get("value");var _3a=_getValueAsNumber(_39);var _3b=dj.byId("invoice_outstanding_amt").get("value");var _3c=_getValueAsNumber(_3b);var _3d=_38-(_3a-_3c);var _3e=_getValueAsNumber(_3d);var _3f=parseFloat((_3e*100)/_3c).toFixed(2);var _40;_40=m.getLocalization("settlementAmountError",[_32,_3e]);if(_3e&&_3e>=_32){dj.byId("settlement_percentage").set("value",_34);}else{misys.dialog.show("ERROR",_40);dj.byId("settlement_amt").set("value","");}}else{if(_34&&(_34==="0"||parseFloat(_34)>999.99)){displayMessage=misys.getLocalization("incorrectPercentage");_35.set("value","");_35.set("state","Error");dj.hideTooltip(_35.domNode);dj.showTooltip(displayMessage,_35.domNode,0);}else{dj.byId("settlement_percentage").set("value",_34);}}},setSettlementCurrency:function(_41,arr,_42){var _43=dj.byId(_41),_44=d.isArray(arr)?arr:[arr],_45,_46,_47;if(_43&&_43.get("value")!==""&&_43.state!=="Error"){_45=_43.get("value");d.forEach(_44,function(id){_46=dj.byId(id);if(_46){_47=d.cldr.monetary.getData(_45);var _48={round:_47.round,places:_47.places,max:999999999999.99,min:0.01};if(_47.places===2){_48={round:_47.round,places:_47.places,min:0,max:999999999999.99};}else{if(_47.places===3){_48={round:_47.round,places:_47.places,min:0,max:999999999999.999};}else{if(_47.places===0){_48={round:_47.round,places:_47.places,min:0,max:9999999999999};}}}d.mixin(_48,_42);_46.set("constraints",_48);_46.set("value",_46.get("value"));}});}},initializeSettlementDetails:function(){var _49=dj.byId("liab_total_net_amt");var _4a=dj.byId("liab_total_net_cur_code");var _4b=dj.byId("total_net_cur_code");var _4c=dj.byId("settlement_amt");var _4d=dj.byId("settlement_cur_code");var _4e=dj.byId("settlement_percentage");var _4f=dj.byId("invoice_outstanding_amt");var _50=dj.byId("prod_stat_code").get("value");if(("E1"===_50||"E5"===_50||"46"===_50||"47"===_50||"08"===_50)&&("P"!==dj.byId("collection_req_flag").get("value"))){var _51=dj.byId("cashCustomizationEnable").get("value");if((_51==="true"&&dj.byId("total_discount")&&dj.byId("total_discount").get("value")!=null)&&("Y"!==dj.byId("collection_discount_flag").get("value"))){var _52=Number(dj.byId("total_discount").get("value"));_4c.set("value",(_49.get("value")-(_52)));_4d.set("value",_4a.get("value"));_4e.set("value",100);_49.set("value",0);}else{_4c.set("value",_49.get("value"));_4d.set("value",_4a.get("value"));_4e.set("value",100);_49.set("value",0);}}var _53=dj.byId("settlement_cur_code");_49.set("disabled",true);_4a.set("disabled",true);_4c.set("disabled",false);_4e.set("disabled",false);_53.set("disabled",true);},calculateOutstandingSettlementAmt:function(){var _54=dj.byId("liab_total_net_amt");var _55=_getValueAsNumber(dijit.byId("settlement_amt").get("value"));var _56;if(dijit.byId("invoice_outstanding_amt")){_56=_getValueAsNumber(dijit.byId("invoice_outstanding_amt").get("value"));}if(_54){var _57=_56-(_55);if(_57<0){_57=0;}_54.set("value",_57);}},validateSettlementDateWithInvoiceDates:function(){if(!this.get("value")){return true;}var _58=dj.byId("inv_date");if(!m.compareDateFields(_58,this)){this.invalidMessage=m.getLocalization("settlementDateGreaterThanInvoiceDate",[_3(this),_3(_58)]);return false;}return true;}});})(dojo,dijit,misys);}