/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.openaccount.create_ip_bk"]){dojo._hasResource["misys.binding.openaccount.create_ip_bk"]=true;dojo.provide("misys.binding.openaccount.create_ip_bk");dojo.require("misys.openaccount.FormOpenAccountEvents");dojo.require("misys.form.common");(function(d,dj,m){d.mixin(m._config,{xmlTransform:function(_1){var _2="<bk_tnx_record>";if(_1.indexOf(_2)!==-1){var _3=m._config.xmlTagName,_4=_3?["<",_3,">"]:[],_5="</bk_tnx_record>",_6="",_7=-1;_6=_1.substring(_2.length,(_1.length-_5.length));_4.push(_6);if(dj.byId("invoicePayablesGrid")){_4.push("<invoice_payable_items>");var _8=dj.byId("invoicePayablesGrid");var _9=_8.rowCount;for(var i=0;i<_9;i++){var _a=_8.getItem(i);_4.push("<invoice_payable>");_4.push("<invoice_payable_ref_id>",_8.store.getValue(_a,"REFERENCEID"),"</invoice_payable_ref_id>");_4.push("</invoice_payable>");}_4.push("</invoice_payable_items>");}if(_3){_4.push("</",_3,">");}return _4.join("");}else{return _1;}},initReAuthParams:function(){var _b=dj.byId("entity")?dj.byId("entity").get("value"):"";var _c={productCode:"BK",subProductCode:dj.byId("sub_product_code")?dj.byId("sub_product_code").get("value"):"",transactionTypeCode:"01",entity:_b,currency:dj.byId("bk_total_amt_cur_code")?dj.byId("bk_total_amt_cur_code").get("value"):"",amount:dj.byId("bk_total_amt")?m.trimAmount(dj.byId("bk_total_amt").get("value")):"",es_field1:dj.byId("bk_total_amt")?m.trimAmount(dj.byId("bk_total_amt").get("value")):"",es_field2:""};return _c;}});d.mixin(m,{bind:function(){m.connect("invoice_payable_lookup","onClick",function(){if(dj.byId("entity")&&(dj.byId("entity").get("value")==="")){m.dialog.show("ERROR",m.getLocalization("selectEntityFirst"));return false;}var _d=dj.byId("issuing_bank_customer_reference");if(_d&&(_d.get("value")==="")){m.dialog.show("ERROR",m.getLocalization("selectIssuerReferenceForInvoicePayable"));return false;}m.getInvoicePayablesForBulk("IP");return true;});m.connect("entity","onChange",function(){var _e=dj.byId("entity").get("value");var _f=dj.byId("entity_hidden").get("value");if(_f==""){dijit.byId("entity_hidden").set("value",_e);return;}var _10=function(){dijit.byId("entity_hidden").set("value",_e);m.clearInvoicePayablesGrid();};var _11=function(){dijit.byId("entity").set("value",_f);};var _12=dj.byId("invoicePayablesGrid");if(_e!=_f&&_12&&_12.rowCount>0){m.dialog.show("CONFIRMATION",m.getLocalization("removebulkinvoice"),"","","","",_10,_11);}if(dj.byId("issuing_bank_abbv_name")){dj.byId("issuing_bank_abbv_name").onChange();}});m.connect("issuing_bank_abbv_name","onChange",m.populateReferences);m.connect("issuing_bank_customer_reference","onChange",m.setApplicantReference);m.connect("issuing_bank_customer_reference","onChange",function(){var _13=dj.byId("issuing_bank_customer_reference").get("value");var _14=dj.byId("issuing_bank_customer_reference_hidden").get("value");var _15=dj.byId("invoicePayablesGrid");var _16=function(){dijit.byId("issuing_bank_customer_reference_hidden").set("value",_13);m.clearInvoicePayablesGrid();};var _17=function(){dijit.byId("issuing_bank_customer_reference").set("value",_14);dijit.byId("issuing_bank_customer_reference_hidden").set("value",_14);};if(_13&&_13!==_14&&_15&&_15.rowCount>0){m.dialog.show("CONFIRMATION",m.getLocalization("removebulkinvoiceForCustomerReference"),"","","","",_16,_17);}if(_13!==""){dijit.byId("issuing_bank_customer_reference_hidden").set("value",_13);dijit.byId("issuing_bank_customer_reference").set("value",_13);}});},onFormLoad:function(){var _18=dj.byId("invoicePayablesGrid");if(invoiceItems&&_18&&invoiceItems.length>0){var _19=new dojo.data.ItemFileWriteStore({data:{"identifier":"REFERENCEID","items":[]}});if(dj.byId("invoicePayablesGrid")&&invoiceItems&&invoiceItems.length>0){for(var i=0;i<invoiceItems.length;i++){var _1a="";var _1b=invoiceItems[i];var _1c=_1b.REFERENCEID.slice().toString();var _1d=_1b.ENTITY.toString();var _1e=_1b.PROGRAM_NAME.slice().toString();var _1f=_1b.SELLER_NAME.toString();var _20=_1b.CURCODE.toString();var _21=_1b.AMOUNT.toString();var _22=_1b.OS_AMOUNT.toString();var _23=_1b.INVOICE_DATE.toString();var _24=_1b.INVOICE_DUE_DATE.toString();var _25=_1b.STATUS;var _26=_1b.FIN_REQUESTED_PERCENT;var _27="<img src="+misys.getContextualURL("/content/images/delete.png")+" onClick =\"javascript:misys.deleteInvoicePayableRecord('"+_1b.REFERENCEID+"')\"/>";var _28={"REFERENCEID":_1c,"ENTITY":_1d,"PROGRAM_NAME":_1e,"SELLER_NAME":_1f,"CURCODE":_20,"AMOUNT":_21,"OS_AMOUNT":_22,"INVOICE_DATE":_23,"INVOICE_DUE_DATE":_24,"STATUS":_25,"FIN_REQUESTED_PERCENT":_26,"ACTION":_27};_19.newItem(_28);}}_18.setStore(_19);dojo.style(_18.domNode,"display","");_18.resize();}else{if(dj.byId("invoicePayablesGrid")){m.getInvoicePayablesForBulkLinkedFiltered();}}var _29=dj.byId("issuing_bank_abbv_name");if(_29){_29.onChange();}var _2a=dj.byId("issuing_bank_customer_reference");var _2b=dj.byId("issuing_bank_customer_reference_hidden");if(_2b&&_2a){_2b.set("value",_2a.get("value"));}},beforeSubmitValidations:function(){if(dj.byId("invoicePayablesGrid")){var _2c=dj.byId("invoicePayablesGrid");var _2d=_2c.rowCount;if(_2d<=1){m._config.onSubmitErrorMsg=m.getLocalization("recordsShouldBePresent");return false;}}return true;},beforeSaveValidations:function(){var _2e=dj.byId("entity");if(_2e&&_2e.get("value")===""){return false;}else{return true;}}});})(dojo,dijit,misys);dojo.require("misys.client.binding.openaccount.create_ip_bk_client");}