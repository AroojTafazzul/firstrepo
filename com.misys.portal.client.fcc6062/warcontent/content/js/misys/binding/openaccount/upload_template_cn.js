/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.openaccount.upload_template_cn"]){dojo._hasResource["misys.binding.openaccount.upload_template_cn"]=true;dojo.provide("misys.binding.openaccount.upload_template_cn");dojo.require("dojo.data.ItemFileReadStore");dojo.require("dijit.form.FilteringSelect");dojo.require("misys.validation.login");dojo.require("misys.validation.password");dojo.require("misys.form.MultiSelect");dojo.require("dijit.form.Select");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.ValidationTextBox");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("dojox.xml.DomParser");(function(d,dj,m){d.mixin(m,{bind:function(){misys.connect("mapping_fixed","onClick",_1);misys.connect("mapping_delimited","onClick",_1);misys.connect("delimiter","onChange",_2);misys.connect("user_list","onClick",_3);misys.connect("start","onBlur",_4);m.connect("start","onBlur",function(){if(isNaN(dj.byId("start").get("value"))){dj.byId("start").focus();displayMessage=m.getLocalization("invalidNumber");dj.byId("start").set("value","");dj.byId("start").set("state","Error");dijit.hideTooltip(dj.byId("start").domNode);dijit.showTooltip(displayMessage,dj.byId("start").domNode,0);return false;}});m.connect("format_length","onBlur",function(){if(isNaN(dj.byId("format_length").get("value"))){dj.byId("format_length").focus();displayMessage=m.getLocalization("invalidNumber");dj.byId("format_length").set("value","");dj.byId("format_length").set("state","Error");dijit.hideTooltip(dj.byId("format_length").domNode);dijit.showTooltip(displayMessage,dj.byId("format_length").domNode,0);return false;}});misys.connect("format_length","onBlur",_4);misys.connect("amount_format_select","onChange",_4);misys.connect("amount_format_other","onBlur",_4);misys.connect("add_column","onClick",_5);misys.connect("remove_column","onClick",_6);if(dj.byId("mapping_fixed").get("checked")===false&&dj.byId("mapping_delimited").get("checked")===false){dj.byId("mapping_fixed").set("checked",true);dj.byId("mapping_fixed").onClick();}else{if(dj.byId("mapping_fixed").get("checked")===true){dj.byId("mapping_fixed").onClick();}else{if(dj.byId("mapping_delimited").get("checked")===true){dj.byId("mapping_delimited").onClick();}}}misys.connect("move_column_up_img","onClick",_7);misys.connect("move_column_down_img","onClick",_7);},onFormLoad:function(){var _8=dj.byId("hidden_delimiter").get("value"),_9=dj.byId("mapping_fixed"),_a=misys._config.matchedColumn;if(_a==="Y"){_b(d.byId("column_amount_format_div"));_b(d.byId("column_start_length_div"));_c();if(_9.get("checked")===true){_9.onClick();}else{if("S"+_8!=="S"){dj.byId("delimiter").onChange();if(_8!=="comma"&&_8!==";"&&_8!=="tab"&&_8!==";;"){dj.byId("delimiter").set("value","OTHER");dj.byId("delimiter_text").set("value",_8);}}else{dj.byId("delimiter").set("value","OTHER");dj.byId("delimiter_text").set("value",_8);}}}else{if(d.byId("disclaimer")){d.byId("disclaimer").style.display="block";}}},beforeSubmitValidations:function(){var _d=true,_e=dj.byId("mapping_delimited"),_f=dj.byId("mapping_fixed"),_10=dj.byId("delimiter"),_11=dj.byId("delimiter_text");if(_e.get("checked")===true){if("S"+_10.get("value")==="S"){displayMessage=misys.getLocalization("uploadTemplateDelimiterRequired");_10.set("state","Error");dj.hideTooltip(_10.domNode);dj.showTooltip(displayMessage,_10.domNode,0);return false;}if(_10.get("value")==="OTHER"&&"S"+_11.get("value")==="S"){displayMessage=misys.getLocalization("uploadTemplateDelimiterTextRequired");_11.set("state","Error");dj.hideTooltip(_11.domNode);dj.showTooltip(displayMessage,_11.domNode,0);return false;}}if(!_12()){return false;}if(_f.get("checked")===true){if(!_13()){return false;}}return _d;}});d.mixin(m._config,{xmlTransform:function(xml){var _14=m._config.xmlTagName,_15=_14?["<",_14,">"]:[],dom=dojox.xml.DomParser.parse(xml),_16=dj.byId("user_list");_15.push("<brch_code>","00001","</brch_code>");_15.push(m.getDomNode(dom,"upload_template_id"));_15.push(m.getDomNode(dom,"name"));_15.push(m.getDomNode(dom,"description"));_15.push(m.getDomNode(dom,"mapping"));_15.push(m.getDomNode(dom,"delimiter"));_15.push(m.getDomNode(dom,"delimiter_text"));_15.push(m.getDomNode(dom,"executable"));d.forEach(d.query("option",_16.domNode),function(_17){_15.push("<column>",_17.value,"</column>");});_15.push(_18(_16));_15.push(m.getDomNode(dom,"product_code"));if(_14){_15.push("</",_14,">");}return _15.join("");}});d.ready(function(){m._config.clearOnSecondCall=false;});function _2(){var _19=dj.byId("delimiter"),_1a=dj.byId("delimiter_text"),_1b=d.byId("delimiter_text_div");if(_19.get("value")==="OTHER"){_1c(_1b);}else{_b(_1b);_1a.set("value","");}};function _5(){var _1d=dj.byId("avail_mapped_columns_list_nosend"),_1e=dj.byId("user_list"),_1f=_1d.domNode.selectedIndex,_20,_21;if(_1f===-1){return;}else{while(_1f!=-1){_20=_1d.domNode[_1f];_21=_20.value;d.byId("user_list").appendChild(_20);m._config.mappedColumns[_21].dataType=m._config.arrColumn[_21][0];m._config.mappedColumns[_21].key=m._config.arrColumn[_21][1];_1f=_1d.domNode.selectedIndex;}}};function _6(){var _22=dj.byId("avail_mapped_columns_list_nosend"),_23=dj.byId("user_list"),_24=d.byId("column_start_length_div"),_25=d.byId("column_amount_format_div"),_26=d.byId("column_date_format_div"),_27=_23.domNode.selectedIndex,_28,_29;if(_27==-1){return;}else{_28=_23.domNode.options[_27];_29=_28.value;}if(_29.indexOf("ignored_column")===-1){_22.addSelected(_23);}else{_23.containerNode.remove(_27);}_2a(_24);_2a(_25);};function _3(){var _2b=dj.byId("start"),_2c=dj.byId("format_length"),_2d=dj.byId("date_format_other"),_2e=dj.byId("amount_format_select"),_2f=dj.byId("amount_format_other"),_30=d.byId("column_start_length_div"),_31=d.byId("column_amount_format_div"),_32=d.byId("unit_code_div"),_33=d.byId("payment_term_code_div"),_34=this.containerNode.options.selectedIndex,_35,_36,_37;if(_34==-1){_2a(_30);_b(_31);return;}else{_35=this.domNode.options[_34];_36=_35.value;_37=m._config.mappedColumns[_36];}if(dj.byId("mapping_fixed").get("checked")===true){_38(_30);}else{_2a(_30);}if(_37){_2b.set("value",_37.start);_2c.set("value",_37.formatLength);_2e.set("value",_37.amountFormat);_2f.set("value",_37.amountFormatText);_39(_37.dataType);}};function _4(){var _3a=this.get("name"),_3b=dj.byId("user_list"),_3c=dj.byId("start"),_3d=_3b.domNode.selectedIndex,_3e,_3f,_40;if(_3d==-1){return;}else{_3e=_3b.domNode.options[_3d];_3f=_3e.value;_40=m._config.mappedColumns[_3f];}if(_40){switch(_3a){case "start":_40.start=this.get("value");break;case "format_length":_40.formatLength=this.get("value");break;case "date_format_other":_40.dateFormatText=this.get("value");break;case "amount_format_select":_40.amountFormat=this.get("value");_41(this);break;case "amount_format_other":_40.amountFormatText=this.get("value");break;default:undefined;break;}}};function _39(_42){var _43=d.byId("column_amount_format_div"),_44=dj.byId("user_list"),_45=_44.domNode.selectedIndex,_46=_44.domNode.options[_45],_47=_46.value;if(_42==="Number"){_1c(_43);dj.byId("amount_format_select").onChange();}else{_b(_43);}};function _41(_48){var _49=d.byId(_48.get("name")+"_other_div");if(_48.get("name")==="amount_format_select"){if(_48.get("value")==="OTHER"){d.removeClass(_49,"hide");}else{d.addClass(_49,"hide");}}};function _1(){var _4a=d.byId("column_start_length_div"),_4b=dj.byId("user_list"),_4c=_4b.domNode.selectedIndex,_4d=d.byId("delimiter_select_div"),_4e=d.byId("delimiter_text_div");if(this.get("checked")===true){if(this.get("value")==="fixed"){if(_4c!==-1){_38(_4a);}else{_2a(_4a);}_b(_4d);_b(_4e);}else{if(this.get("value")==="delimited"){_2a(_4a);_1c(_4d);if(m._config.clearOnSecondCall){dj.byId("delimiter").set("value","");dj.byId("delimiter_text").set("value","");}m._config.clearOnSecondCall=true;}}}};function _c(){var _4f=dj.byId("avail_mapped_columns_list_nosend"),_50=dj.byId("user_list");d.forEach(_4f.domNode.options,function(_51){if(m._config.arrColumn[_51.value]&&m._config.arrColumn[_51.value][1]===true){_51.className="ipUploadTemplateMandatoryColumn";}});d.forEach(_50.domNode.options,function(_52){if(m._config.arrColumn[_52.value]&&m._config.arrColumn[_52.value][1]===true){_52.className="ipUploadTemplateMandatoryColumn";}});};function _7(){var _53=dj.byId("user_list"),_54=_53.domNode.selectedIndex,_55,_56;if(_54!==-1){_55=_53.domNode.options[_54];_56=_55.value;}if(this.id==="move_column_up_img"){if(_54===-1||_54===0){return;}_53.containerNode.remove(_54);if(dojo.isIE){_53.containerNode.add(_55,_54-1);}else{_53.containerNode.add(_55,_53.domNode.options[_54-1]);}}else{if(this.id==="move_column_down_img"){if(_54===-1||_54===_53.domNode.length-1){return;}_53.containerNode.remove(_54);if(_54>_53.domNode.length){_53.containerNode.appendChild(_55);}else{if(dojo.isIE){_53.containerNode.add(_55,_54+1);}else{_53.containerNode.add(_55,_53.domNode.options[_54+1]);}}}}};function _b(div){d.removeClass(div,"inlineBlock");d.addClass(div,"hide");};function _1c(div){d.removeClass(div,"hide");d.addClass(div,"inlineBlock");};function _2a(div){d.removeClass(div,"inline-group");d.addClass(div,"hide");};function _38(div){d.removeClass(div,"hide");d.addClass(div,"inline-group");};function _18(_57){var _58=[];d.forEach(d.query("option",_57.domNode),function(_59){_58.push("<",_59.value,"_key>",m._config.mappedColumns[_59.value].key,"</",_59.value,"_key>");_58.push("<",_59.value,"_type>",m._config.mappedColumns[_59.value].dataType,"</",_59.value,"_type>");_58.push("<",_59.value,"_start>",m._config.mappedColumns[_59.value].start,"</",_59.value,"_start>");_58.push("<",_59.value,"_length>",m._config.mappedColumns[_59.value].formatLength,"</",_59.value,"_length>");_58.push("<",_59.value,"_minlength>",m._config.mappedColumns[_59.value].minLength,"</",_59.value,"_minlength>");_58.push("<",_59.value,"_maxlength>",m._config.mappedColumns[_59.value].maxLength,"</",_59.value,"_maxlength>");if(m._config.mappedColumns[_59.value].dataType==="Date"){_58.push("<",_59.value,"_format>",m._config.mappedColumns[_59.value].dateFormat,"</",_59.value,"_format>");_58.push("<",_59.value,"_format_text>",m._config.mappedColumns[_59.value].dateFormatText,"</",_59.value,"_format_text>");}else{if(m._config.mappedColumns[_59.value].dataType==="Number"){_58.push("<",_59.value,"_format>",m._config.mappedColumns[_59.value].amountFormat,"</",_59.value,"_format>");_58.push("<",_59.value,"_format_text>",m._config.mappedColumns[_59.value].amountFormatText,"</",_59.value,"_format_text>");}}});return _58.join("");};function _12(){var _5a=dj.byId("avail_mapped_columns_list_nosend"),_5b=[],_5c=true;d.forEach(d.query("option",_5a.domNode),function(_5d){if(m._config.arrColumn[_5d.value][1]===true){_5b.push(_5d.value);}});if(_5b.length>0){_5c=false;displayMessage=misys.getLocalization("selectAllUploadTemplateKeyColumns");dj.hideTooltip(_5a.domNode);dj.showTooltip(displayMessage,_5a.domNode,0);var _5e=function(){dj.hideTooltip(_5a.domNode);};setTimeout(_5e,2000);}else{dj.hideTooltip(_5a.domNode);}return _5c;};function _13(){var _5f=dj.byId("user_list"),_60=true,_61=dj.byId("start"),_62=dj.byId("format_length"),_63=dj.byId("amount_format_select"),_64=dj.byId("date_format_other"),_65=dj.byId("amount_format_other"),_66=false;d.some(d.query("option",_5f.domNode),function(_67,_68){var _69=[];if("S"+m._config.mappedColumns[_67.value].start==="S"){_69.push(_61);_66=true;_60=false;}if("S"+m._config.mappedColumns[_67.value].length==="S"){_69.push(_62);_66=true;_60=false;}if(m._config.mappedColumns[_67.value].dataType==="Date"){if("S"+m._config.mappedColumns[_67.value].dateFormat==="S"){_69.push(dateFormatSelectField);_66=true;_60=false;}else{if(m._config.mappedColumns[_67.value].dateFormat==="OTHER"&&("S"+m._config.mappedColumns[_67.value].dateFormatText==="S")){_69.push(_64);_66=true;_60=false;}}}else{if(m._config.mappedColumns[_67.value].dataType==="Number"){if("S"+m._config.mappedColumns[_67.value].amountFormat==="S"){_69.push(_63);_66=true;_60=false;}else{if(m._config.mappedColumns[_67.value].amountFormat==="OTHER"&&("S"+m._config.mappedColumns[_67.value].amountFormatText==="S")){_69.push(_65);_66=true;_60=false;}}}}if(_66){dj.byId("user_list").domNode.options.selectedIndex=_68;dj.byId("user_list").onClick();_6a(_69);}return _66;});return _60;};function _6a(_6b){var _6c=misys.getLocalization("uploadTemplateValueRequired");d.forEach(_6b,function(_6d){_6d.set("state","Error");dj.hideTooltip(_6d.domNode);dj.showTooltip(_6c,_6d.domNode,0);});};})(dojo,dijit,misys);dojo.require("misys.client.binding.openaccount.upload_template_cn_client");}