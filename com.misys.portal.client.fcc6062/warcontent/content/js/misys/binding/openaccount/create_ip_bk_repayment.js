/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.openaccount.create_ip_bk_repayment"]){dojo._hasResource["misys.binding.openaccount.create_ip_bk_repayment"]=true;dojo.provide("misys.binding.openaccount.create_ip_bk_repayment");dojo.require("misys.openaccount.BulkRepaymentEvents");dojo.require("misys.form.common");(function(d,dj,m){d.mixin(m._config,{xmlTransform:function(_1){var _2="<bk_tnx_record>";if(_1.indexOf(_2)!==-1){var _3=m._config.xmlTagName,_4=_3?["<",_3,">"]:[],_5="</bk_tnx_record>",_6="",_7=-1;_6=_1.substring(_2.length,(_1.length-_5.length));_4.push(_6);if(dj.byId("invoicePayablesGrid")){_4.push("<invoice_payable_items>");var _8=dj.byId("invoicePayablesGrid");var _9=_8.rowCount;for(var i=0;i<_9;i++){var _a=_8.getItem(i);_4.push("<invoice_payable>");_4.push("<invoice_payable_ref_id>",_8.store.getValue(_a,"REFERENCEID"),"</invoice_payable_ref_id>");_4.push("</invoice_payable>");}_4.push("</invoice_payable_items>");}if(_3){_4.push("</",_3,">");}return _4.join("");}else{return _1;}},initReAuthParams:function(){var _b=dj.byId("entity")?dj.byId("entity").get("value"):"";var _c={productCode:"BK",subProductCode:dj.byId("sub_product_code")?dj.byId("sub_product_code").get("value"):"",transactionTypeCode:"01",entity:_b,currency:dj.byId("bk_total_amt_cur_code")?dj.byId("bk_total_amt_cur_code").get("value"):"",amount:dj.byId("bk_total_amt")?m.trimAmount(dj.byId("bk_total_amt").get("value")):"",es_field1:dj.byId("bk_total_amt")?m.trimAmount(dj.byId("bk_total_amt").get("value")):"",es_field2:""};return _c;}});d.mixin(m,{bind:function(){m.connect("finance_lookup","onClick",function(){var _d=dj.byId("entity");if(_d&&(_d.get("value")==="")){m.dialog.show("ERROR",m.getLocalization("selectEntityFirst"));return false;}var _e=dj.byId("issuing_bank_customer_reference");if(_e&&(_e.get("value")==="")){m.dialog.show("ERROR",m.getLocalization("selectIssuerReference"));return false;}m.getFinancesForBulkRepayment("IP",_d);return true;});m.setValidation("bk_repay_date",m.validateRepayDate);m.connect("invoicePayablesGrid","_onFetchComplete",function(){m.setTotalRepaymentAmount("invoicePayablesGrid");});m.connect("entity","onChange",function(){var _f=dj.byId("entity").get("value");var _10=dj.byId("entity_hidden").get("value");if(_10==""){dijit.byId("entity_hidden").set("value",_f);return;}var _11=function(){dijit.byId("entity_hidden").set("value",_f);m.clearInvoiceGrid("invoicePayablesGrid");};var _12=function(){dijit.byId("entity").set("value",_10);};var _13=dj.byId("invoicePayablesGrid");if(_f!=_10&&_13&&_13.rowCount>0){m.dialog.show("CONFIRMATION",m.getLocalization("removebulkinvoice"),"","","","",_11,_12);}if(dj.byId("issuing_bank_abbv_name")){dj.byId("issuing_bank_abbv_name").onChange();}});m.connect("issuing_bank_abbv_name","onChange",m.populateReferences);m.connect("issuing_bank_customer_reference","onChange",m.setApplicantReference);m.connect("issuing_bank_customer_reference","onChange",function(){var _14=dj.byId("issuing_bank_customer_reference").get("value");var _15=dj.byId("issuing_bank_customer_reference_hidden").get("value");var _16=dj.byId("invoicePayablesGrid");var _17=function(){dijit.byId("issuing_bank_customer_reference_hidden").set("value",_14);m.clearInvoiceGrid("invoicePayablesGrid");};var _18=function(){dijit.byId("issuing_bank_customer_reference").set("value",_15);dijit.byId("issuing_bank_customer_reference_hidden").set("value",_15);};if(_14&&_14!==_15&&_16&&_16.rowCount>0){m.dialog.show("CONFIRMATION",m.getLocalization("removebulkinvoiceForCustomerReference"),"","","","",_17,_18);}if(_14!==""){dijit.byId("issuing_bank_customer_reference_hidden").set("value",_14);dijit.byId("issuing_bank_customer_reference").set("value",_14);}});},onFormLoad:function(){var _19=dj.byId("invoicePayablesGrid");if(invoiceItems&&_19&&invoiceItems.length>0){var _1a=new dojo.data.ItemFileWriteStore({data:{"identifier":"REFERENCEID","items":[]}});if(dj.byId("invoicePayablesGrid")&&invoiceItems&&invoiceItems.length>0){for(var i=0;i<invoiceItems.length;i++){var _1b="";var _1c=invoiceItems[i];var _1d=_1c.REFERENCEID.slice().toString();var _1e=_1c.ENTITY.toString();var _1f=_1c.BUYER_NAME.toString();var _20=_1c.SELLER_NAME.toString();var _21=_1c.PROGRAM_NAME.slice().toString();var _22=_1c.CURCODE.toString();var _23=_1c.FINANCE_AMOUNT.toString();var _24=_1c.OUTSTANDING_REPAY_AMOUNT.toString();var _25=_1c.TOTAL_REPAID_AMOUNT.toString();var _26=_1c.FINANCE_ISSUE_DATE.toString();var _27=_1c.FINANCE_DUE_DATE.toString();var _28=_1c.STATUS;var _29="<img src="+misys.getContextualURL("/content/images/delete.png")+" onClick =\"javascript:misys.deleteInvoicePayableRecord('"+_1c.REFERENCEID+"')\"/>";var _2a={"REFERENCEID":_1d,"ENTITY":_1e,"BUYER_NAME":_1f,"SELLER_NAME":_20,"PROGRAM_NAME":_21,"CURCODE":_22,"FINANCE_AMOUNT":_23,"OUTSTANDING_REPAY_AMOUNT":_24,"TOTAL_REPAID_AMOUNT":_25,"FINANCE_ISSUE_DATE":_26,"FINANCE_DUE_DATE":_27,"STATUS":_28,"ACTION":_29};_1a.newItem(_2a);}}_19.setStore(_1a);dojo.style(_19.domNode,"display","");_19.resize();}else{if(dj.byId("invoicePayablesGrid")&&dj.byId("displaymode")&&dj.byId("displaymode").get("value")==="edit"){m.getFinancesSelectedForBulkRepayment("IP");}}var _2b=dj.byId("issuing_bank_abbv_name");if(_2b){_2b.onChange();}var _2c=dj.byId("issuing_bank_customer_reference");var _2d=dj.byId("issuing_bank_customer_reference_hidden");if(_2d&&_2c){_2d.set("value",_2c.get("value"));}},beforeSubmitValidations:function(){var _2e="";var _2f=true;if(dj.byId("invoicePayablesGrid")){var _30=dj.byId("invoicePayablesGrid");var _31=_30.rowCount;if(_31<=1){_2e=m.getLocalization("recordsShouldBePresent");_2f=false;}if(dj.byId("bk_repay_date")&&!m.validateRepayDate()){_2e=m.getLocalization("repayDateNotGreaterThanCurrentDate");_2f=false;}}m._config.onSubmitErrorMsg=_2e;return _2f;},beforeSaveValidations:function(){var _32=dj.byId("entity");if(_32&&_32.get("value")===""){return false;}else{return true;}}});})(dojo,dijit,misys);dojo.require("misys.client.binding.openaccount.create_ip_bk_repayment_client");}