/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.openaccount.create_ea"]){dojo._hasResource["misys.binding.openaccount.create_ea"]=true;dojo.provide("misys.binding.openaccount.create_ea");dojo.require("dojo.parser");dojo.require("dijit.layout.BorderContainer");dojo.require("dijit.Dialog");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dojo.data.ItemFileWriteStore");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.form.FilteringSelect");dojo.require("dijit.form.Form");dojo.require("dijit.layout.ContentPane");dojo.require("dijit.layout.TabContainer");dojo.require("dojo.io.iframe");dojo.require("dijit.ProgressBar");dojo.require("dojo.behavior");dojo.require("dojo.date.locale");dojo.require("dijit.Tooltip");dojo.require("misys.openaccount.FormOpenAccountEvents");dojo.require("misys.grid.DataGrid");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("misys.layout.FloatingPane");dojo.require("misys.openaccount.widget.LineItems");dojo.require("misys.openaccount.widget.LineItem");dojo.require("misys.openaccount.widget.ProductIdentifiers");dojo.require("misys.openaccount.widget.ProductIdentifier");dojo.require("misys.openaccount.widget.ProductCategories");dojo.require("misys.openaccount.widget.ProductCategory");dojo.require("misys.openaccount.widget.ProductCharacteristics");dojo.require("misys.openaccount.widget.ProductCharacteristic");dojo.require("misys.openaccount.widget.Adjustments");dojo.require("misys.openaccount.widget.Adjustment");dojo.require("misys.openaccount.widget.PaymentTerms");dojo.require("misys.openaccount.widget.PaymentTerm");dojo.require("misys.openaccount.widget.Taxes");dojo.require("misys.openaccount.widget.Tax");dojo.require("misys.openaccount.widget.FreightCharges");dojo.require("misys.openaccount.widget.FreightCharge");dojo.require("misys.openaccount.widget.Incoterms");dojo.require("misys.openaccount.widget.Incoterm");dojo.require("misys.openaccount.widget.CommercialDatasetDetails");dojo.require("misys.openaccount.widget.CommercialDatasetDetail");dojo.require("misys.openaccount.widget.TransportDatasetDetails");dojo.require("misys.openaccount.widget.TransportDatasetDetail");dojo.require("misys.openaccount.widget.PaymentTransportDatasetDetails");dojo.require("misys.openaccount.widget.PaymentTransportDatasetDetail");dojo.require("misys.openaccount.widget.InsuranceDatasetDetails");dojo.require("misys.openaccount.widget.InsuranceDatasetDetail");dojo.require("misys.openaccount.widget.PaymentObligations");dojo.require("misys.openaccount.widget.PaymentObligation");dojo.require("misys.openaccount.widget.CertificateDatasetDetails");dojo.require("misys.openaccount.widget.CertificateDatasetDetail");dojo.require("misys.openaccount.widget.OtherCertificateDatasetDetails");dojo.require("misys.openaccount.widget.OtherCertificateDatasetDetail");dojo.require("misys.openaccount.widget.ContactDetails");dojo.require("misys.openaccount.widget.ContactDetail");dojo.require("misys.openaccount.widget.SUserInformations");dojo.require("misys.openaccount.widget.SUserInformation");dojo.require("misys.openaccount.widget.BUserInformations");dojo.require("misys.openaccount.widget.BUserInformation");dojo.require("misys.openaccount.widget.TransportByAirDeptDetails");dojo.require("misys.openaccount.widget.TransportByAirDeptDetail");dojo.require("misys.openaccount.widget.TransportByAirDestDetails");dojo.require("misys.openaccount.widget.TransportByAirDestDetail");dojo.require("misys.openaccount.widget.TransportBySeaLoadingPortDetails");dojo.require("misys.openaccount.widget.TransportBySeaLoadingPortDetail");dojo.require("misys.openaccount.widget.TransportBySeaDischargePortDetails");dojo.require("misys.openaccount.widget.TransportBySeaDischargePortDetail");dojo.require("misys.openaccount.widget.TransportByRailReceiptPlaceDetail");dojo.require("misys.openaccount.widget.TransportByRailReceiptPlaceDetails");dojo.require("misys.openaccount.widget.TransportByRailDeliveryPlaceDetail");dojo.require("misys.openaccount.widget.TransportByRailDeliveryPlaceDetails");dojo.require("misys.openaccount.widget.TransportByRoadReceiptPlaceDetail");dojo.require("misys.openaccount.widget.TransportByRoadReceiptPlaceDetails");dojo.require("misys.openaccount.widget.TransportByRoadDeliveryPlaceDetail");dojo.require("misys.openaccount.widget.TransportByRoadDeliveryPlaceDetails");dojo.require("misys.openaccount.widget.RoutingSummary");dojo.require("misys.openaccount.widget.AirRoutingSummaries");dojo.require("misys.openaccount.widget.SeaRoutingSummaries");dojo.require("misys.openaccount.widget.RailRoutingSummaries");dojo.require("misys.openaccount.widget.RoadRoutingSummaries");(function(d,dj,m){var _1="false";var _2={};var _3="";d.mixin(m._config,{xmlTransform:function(_4){var _5=dj.byId("close_tnx")?dj.byId("close_tnx").get("checked"):false;var _6=dj.byId("close_comments")?dj.byId("close_comments").get("value"):"";var _7=_3.indexOf("<close_comments>");var _8=_3.indexOf("</close_comments>")+17;var _9=_3.substring(0,_7);var _a=_3.substring(_8,_3.length);var _b,_c,_d;if(_4.indexOf("<reauth_password>")>-1){_b=_4.substring(_4.indexOf("<reauth_password>")+17,_4.indexOf("</reauth_password>"));_d=_9+_b+_a;}else{_d=_9+_a;}if(_5&&_d!==""&&_6!==""){var _e=_4.substring(_4.indexOf("<close_comments>"),_4.indexOf("</close_comments>")+17);if(_4.indexOf("<reauth_password>")>-1){_c=_4.substring(_4.indexOf("<reauth_password>"),_4.indexOf("</reauth_password>")+18);_7=_d.indexOf("<reauth_password>");_8=_d.indexOf("</reauth_password>")+18;_d=_d.substring(0,_7)+_d.substring(_8,_d.length);}var _f=_4.substring(_4.indexOf("<iss_date>")+10,_4.indexOf("</iss_date>"));var _10=_4.substring(_4.indexOf("<exp_date>")+10,_4.indexOf("</exp_date>"));var _11="<ea_tnx_record>",_12=[_11],_13="</ea_tnx_record>",_14="";_7=_d.indexOf("<iss_date>")+10;_8=_d.indexOf("</iss_date>");_d=_d.substring(0,_7)+_f+_d.substring(_8,_d.length);_7=_d.indexOf("<exp_date>")+10;_8=_d.indexOf("</exp_date>");_d=_d.substring(0,_7)+_10+_d.substring(_8,_d.length);_14=_d.substring(_11.length,(_d.length-_13.length));_12.push(_14);_12.push(_e);if(_c&&_c!==""){_12.push(_c);}_12.push(_13);return _12.join("");}else{return _4;}}});_obligorAndRecipientBICsShouldBeDiff=function(_15){var _16=dj.byId("recipient_bank");var _17=dj.byId("obligor_bank");var _18="";_18=m.getLocalization("obligorRecipientSameBICError");if(_17&&(_15===true)){if(_17.get("value")&&_16.get("value")&&_16.get("value")===_17.get("value")){_17.set("state","Error");dj.hideTooltip(_17.domNode);dj.showTooltip(_18,_17.domNode,0);setTimeout(function(){dj.hideTooltip(_17.domNode);},5000);}else{_17.set("state","");_16.set("state","");}if(_16.get("disabled")){_16.set("state","");_16.set("required",false);}if(_17.get("disabled")){_17.set("state","");_17.set("required",false);}}if(_16&&(_15===false)){if(_17.get("value")&&_16.get("value")&&_16.get("value")===_17.get("value")){_16.set("state","Error");dj.hideTooltip(_16.domNode);dj.showTooltip(_18,_16.domNode,0);setTimeout(function(){dj.hideTooltip(_16.domNode);},5000);}else{_17.set("state","");_16.set("state","");}if(_16.get("disabled")){_16.set("state","");_16.set("required",false);}if(_17.get("disabled")){_17.set("state","");_17.set("required",false);}}};d.mixin(m._config,{initReAuthParams:function(){var _19={productCode:"EA",subProductCode:"",transactionTypeCode:"01",entity:dj.byId("entity")?dj.byId("entity").get("value"):"",currency:"",amount:"",es_field1:"",es_field2:""};return _19;},_hasLineItemShipmentDate:function(){if(dj.byId("line-items").store!=null){var _1a=dj.byId("line-items").store._arrayOfAllItems;for(i=0;i<_1a.length;i++){if(_1a[i]&&(_1a[i].last_ship_date!=""||_1a[i].earliest_ship_date!="")){dj.byId("earliest_ship_date").set("value",null);dj.byId("earliest_ship_date").set("disabled",true);dj.byId("last_ship_date").set("value",null);dj.byId("last_ship_date").set("disabled",true);break;}else{dj.byId("earliest_ship_date").set("disabled",false);dj.byId("last_ship_date").set("disabled",false);}}}}});d.mixin(m,{bind:function(){m.setValidation("ids_match_issuer_country_country",m.validateCountry);m.setValidation("ceds_match_issuer_country_country",m.validateCountry);m.setValidation("ceds_match_mf_issuer_country_country",m.validateCountry);m.setValidation("creditor_country",m.validateCountry);m.setValidation("buyer_country",m.validateCountry);m.setValidation("seller_country",m.validateCountry);m.setValidation("line_item_product_orgn_country",m.validateCountry);m.setValidation("applicable_law_country",m.validateCountry);m.setValidation("payment_jurisdiction_country",m.validateCountry);m.setValidation("payment_tds_country",m.validateCountry);m.setValidation("invoice_iss_date",m.validateIssueDate);m.setValidation("pymnt_due_date",m.validatePaymentDueDate);if((dj.byId("tnxtype")&&(dj.byId("tnxtype").get("value")!=="38"))||(dj.byId("close_tnx")&&(dj.byId("close_tnx").get("checked")===false))){m.setValidation("exp_date",m.validateFutureDate);m.setValidation("iss_date",m.validateIssueDate);m.oaCommonBindEvents();}m.connect("bill_to_name","onChange",m.enableRequiredTab);m.connect("ship_to_name","onChange",m.enableRequiredTab);m.connect("consgn_name","onChange",m.enableRequiredTab);m.connect("bill_to_post_code","onChange",m.enableRequiredTab);m.connect("ship_to_post_code","onChange",m.enableRequiredTab);m.connect("consgn_post_code","onChange",m.enableRequiredTab);m.connect("bill_to_town_name","onChange",m.enableRequiredTab);m.connect("ship_to_town_name","onChange",m.enableRequiredTab);m.connect("consgn_town_name","onChange",m.enableRequiredTab);m.connect("bill_to_country","onChange",m.enableRequiredTab);m.connect("ship_to_country","onChange",m.enableRequiredTab);m.connect("consgn_country","onChange",m.enableRequiredTab);m.setValidation("line_item_last_ship_date",m.validateOALastShipmentDate);m.setValidation("template_id",m.validateTemplateId);m.setValidation("contact_email",m.validateEmailAddr);m.setValidation("buyer_bei",m.validateBEIFormat);m.setValidation("buyer_submitting_bank_bic",m.validateBICFormat);m.setValidation("seller_submitting_bank_bic",m.validateBICFormat);m.setValidation("total_cur_code",m.validateCurrency);m.setValidation("fake_total_cur_code",m.validateCurrency);m.setValidation("total_net_cur_code",m.validateCurrency);m.setValidation("line_item_price_cur_code",m.validateCurrency);m.setValidation("line_item_total_net_cur_code",m.validateCurrency);m.setValidation("adjustment_cur_code",m.validateCurrency);m.setValidation("tax_cur_code",m.validateCurrency);m.setValidation("freight_charge_cur_code",m.validateCurrency);m.setValidation("contact_bic",m.validateBICFormat);m.setValidation("seller_bank_bic",m.validateBICFormat);m.setValidation("buyer_bank_bic",m.validateBICFormat);m.setValidation("creditor_account_cur_code",m.validateCurrency);m.setValidation("seller_account_cur_code",m.validateCurrency);m.connect("buyer_bank_bic","onBlur",m.checkBICExistence);m.connect("buyer_submitting_bank_bic","onBlur",m.checkBICExistence);m.connect("seller_submitting_bank_bic","onBlur",m.checkBICExistence);m.connect("fin_inst_bic","onBlur",m.checkBICExistence);m.connect("obligor_bank","onBlur",m.checkBICExistenceForWidgets);m.connect("recipient_bank","onBlur",m.checkBICExistenceForWidgets);m.connect("creditor_agent_bic","onBlur",m.checkBICExistenceForWidgets);m.connect("contact_bic","onBlur",m.checkBICExistenceForWidgets);m.connect("cds_bic","onBlur",m.checkBICExistenceForWidgets);m.connect("tds_bic","onBlur",m.checkBICExistenceForWidgets);m.connect("ids_bic","onBlur",m.checkBICExistenceForWidgets);m.connect("ceds_bic","onBlur",m.checkBICExistenceForWidgets);m.connect("ocds_bic","onBlur",m.checkBICExistenceForWidgets);m.connect("buyer_bank_bic","onChange",m.checkBICExistence);m.connect("buyer_submitting_bank_bic","onChange",m.checkBICExistence);m.connect("seller_submitting_bank_bic","onChange",m.checkBICExistence);m.connect("fin_inst_bic","onChange",m.checkBICExistence);m.connect("obligor_bank","onChange",m.checkBICExistenceForWidgets);m.connect("recipient_bank","onChange",m.checkBICExistenceForWidgets);m.connect("creditor_agent_bic","onChange",m.checkBICExistenceForWidgets);m.connect("contact_bic","onChange",m.checkBICExistenceForWidgets);m.connect("cds_bic","onChange",m.checkBICExistenceForWidgets);m.connect("tds_bic","onChange",m.checkBICExistenceForWidgets);m.connect("ids_bic","onChange",m.checkBICExistenceForWidgets);m.connect("ceds_bic","onChange",m.checkBICExistenceForWidgets);m.connect("ocds_bic","onChange",m.checkBICExistenceForWidgets);m.connect("total_cur_code","onChange",m.toggleDisableButtons);m.connect("freight_charges_type","onChange",m.manageFreightButton);m.connect("total_cur_code","onChange",m.managePOCurrency);m.connect("total_cur_code","onBlur",function(){var _1b=dj.byId("prodstatus");var _1c=dj.byId("tnxtype");if((_1b&&_1b.get("value")!=="43"&&_1b.get("value")!=="")||(_1c&&_1c.get("value")!=="03")){_6a();}});m.connect("adjustment_type","onChange",function(){m.toggleMutuallyExclusiveMandatoryFields(["adjustment_rate","adjustment_amt"]);});m.connect("adjustment_amt","onChange",function(){m.toggleMutuallyExclusiveMandatoryFields(["adjustment_rate","adjustment_amt"]);});m.connect("adjustment_rate","onChange",function(){m.toggleMutuallyExclusiveMandatoryFields(["adjustment_rate","adjustment_amt"]);});m.connect("freight_charge_type","onChange",function(){m.toggleMutuallyExclusiveMandatoryFields(["freight_charge_rate","freight_charge_amt"]);});m.connect("freight_charge_amt","onChange",function(){m.toggleMutuallyExclusiveMandatoryFields(["freight_charge_rate","freight_charge_amt"]);});m.connect("freight_charge_rate","onChange",function(){m.toggleMutuallyExclusiveMandatoryFields(["freight_charge_rate","freight_charge_amt"]);});m.connect("tax_type","onChange",function(){m.toggleMutuallyExclusiveMandatoryFields(["tax_amt","tax_rate"]);});m.connect("tax_amt","onChange",function(){m.toggleMutuallyExclusiveMandatoryFields(["tax_amt","tax_rate"]);});m.connect("tax_rate","onChange",function(){m.toggleMutuallyExclusiveMandatoryFields(["tax_amt","tax_rate"]);});m.connect("display_other_parties","onClick",m.showHideOtherParties);m.connect("total_cur_code","onFocus",m.saveOldPOCurrency);m.connect("transport_type","onChange",m.onChangeTranportType);m.connect("payment_terms_type_1","onClick",m.onClickCheckPaymentTerms);m.connect("payment_terms_type_2","onClick",m.onClickCheckPaymentTerms);m.connect("seller_account_type","onChange",function(){m.onChangeSellerAccountType("form_settlement","seller_account_value","seller_account_type");});m.connect("seller_account_value","onFocus",m.onFocusSellerAccount);m.connect("line_item_qty_val","onBlur",m.computeLineItemAmount);m.connect("line_item_price_amt","onBlur",m.computeLineItemAmount);if(d.byId("line_item_qty_unit_measr_other_row")&&d.byId("line_item_qty_unit_measr_code")){if(dj.byId("line_item_qty_unit_measr_code").get("value")==="OTHR"){m.animate("fadeIn","line_item_qty_unit_measr_other_row");}else{m.animate("fadeOut","line_item_qty_unit_measr_other_row");}}m.connect("line_item_qty_unit_measr_code","onChange",function(){m.toggleFields((this.get("value")==="OTHR"),null,["line_item_qty_unit_measr_other"]);if(d.byId("line_item_qty_unit_measr_other_row")){if(this.get("value")==="OTHR"){m.animate("fadeIn","line_item_qty_unit_measr_other_row");}else{m.animate("fadeOut","line_item_qty_unit_measr_other_row");}}});m.connect("fake_total_cur_code","onChange",function(){m.setCurrency(this,["fake_total_amt"]);});m.connect("total_net_cur_code","onChange",function(){m.setCurrency(this,["total_net_amt"]);});m.connect("line_item_price_cur_code","onChange",function(){m.setCurrency(this,["line_item_price_amt"]);});m.connect("details_cur_code","onChange",function(){m.setCurrency(this,["details_amt"]);});m.connect("fake_total_amt","onChange",function(){m.setTnxAmt(this.get("value"));});m.connect("fake_total_amt","onChange",m.setEAAmounts);m.connect("total_net_amt","onChange",m.setEAAmounts);m.connect("line_item_total_cur_code","onChange",function(){m.setCurrency(this,["line_item_total_amt"]);});m.connect("line_item_total_net_cur_code","onChange",function(){m.setCurrency(this,["line_item_total_net_amt"]);});m.connect("adjustment_cur_code","onChange",function(){m.setCurrency(this,["adjustment_amt"]);});m.connect("tax_cur_code","onChange",function(){m.setCurrency(this,["tax_amt"]);});m.connect("freight_charge_cur_code","onChange",function(){m.setCurrency(this,["freight_charge_amt"]);});m.connect("issuing_bank_abbv_name","onChange",m.populateReferences);m.connect("issuing_bank_abbv_name","onChange",function(){var _1d=dj.byId("bank-payment-obligations");if(_1==="true"&&dj.byId("issuing_bank_abbv_name").get("value")!=""&&_1d&&_1d.store){m.dialog.show("ALERT",m.getLocalization("alertDeleteBuyerBankRow"),"",null,null,"",function(){if(_1d&&_1d.store&&_1d.store._arrayOfTopLevelItems.length>0){_1d.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(_1d,function(_1e,_1f){dojo.forEach(_1e,function(_20){if(_20.buyer_bank_bpo[0]==="Y"){_20.buyer_bank_bpo[0]="N";dj.byId("buyer_bank_bpo_added").set("value","false");}});})});if(dj.byId("buyer_bank_bic")&&dj.byId("buyer_bank_bic").get("value")!=""){_1d.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(_1d,function(_21,_22){dojo.forEach(_21,function(_23){if(_23.obligor_bank[0]===dj.byId("buyer_bank_bic").get("value")){_23.buyer_bank_bpo[0]="Y";dj.byId("buyer_bank_bpo_added").set("value","true");}});})});}}},function(){dj.byId("issuing_bank_abbv_name").set("value","");dj.byId("buyer_bank_bic").set("value","");});}});if(dj.byId("issuing_bank_abbv_name")){m.connect("entity","onChange",function(){dj.byId("issuing_bank_abbv_name").onChange();});}m.connect("issuing_bank_customer_reference","onChange",m.setSellerReference);m.connect(dj.byId("line_item_qty_unit_measr_code"),"onChange",function(){dj.byId("line_item_price_unit_measr_code").set("value",this.get("value"));});m.connect(dj.byId("line_item_qty_unit_measr_code"),"onChange",function(){dj.byId("line_item_qty_unit_measr_label").set("value",this.get("displayedValue"));});m.connect(dj.byId("product_identifier_code"),"onChange",function(){dj.byId("product_identifier_code_label").set("value",this.get("displayedValue"));});m.connect(dj.byId("product_category_code"),"onChange",function(){dj.byId("product_category_code_label").set("value",this.get("displayedValue"));});m.connect(dj.byId("product_characteristic_code"),"onChange",function(){dj.byId("product_characteristic_code_label").set("value",this.get("displayedValue"));});m.connect(dj.byId("adjustment_type"),"onChange",function(){dj.byId("adjustment_type_label").set("value",this.get("displayedValue"));});m.connect(dj.byId("tax_type"),"onChange",function(){dj.byId("tax_type_label").set("value",this.get("displayedValue"));});m.connect(dj.byId("freight_charge_type"),"onChange",function(){dj.byId("freight_charge_type_label").set("value",this.get("displayedValue"));});m.connect(dj.byId("incoterm_code"),"onChange",function(){dj.byId("incoterm_code_label").set("value",this.get("displayedValue"));});m.connect(dj.byId("pmt_tds_qty_unit_measr_code"),"onChange",function(){dj.byId("pmt_tds_qty_unit_measr_label").set("value",this.get("displayedValue"));});m.connect(dj.byId("pmt_tds_vol_unit_measr_code"),"onChange",function(){dj.byId("pmt_tds_vol_unit_measr_label").set("value",this.get("displayedValue"));});m.connect(dj.byId("pmt_tds_weight_unit_measr_code"),"onChange",function(){dj.byId("pmt_tds_weight_unit_measr_label").set("value",this.get("displayedValue"));});if(d.byId("adjustment_other_type_row")&&d.byId("adjustment_type")){if(dj.byId("adjustment_type").get("value")==="OTHR"){m.animate("fadeIn","adjustment_other_type_row");}else{m.animate("fadeOut","adjustment_other_type_row");}}if(d.byId("tax_other_type_row")&&d.byId("tax_type")){if(dj.byId("tax_type").get("value")==="OTHR"){m.animate("fadeIn","tax_other_type_row");}else{m.animate("fadeOut","tax_other_type_row");}}m.connect("adjustment_type","onChange",function(){m.toggleFields((this.get("value")==="OTHR"),null,["adjustment_other_type"]);if(dojo.byId("adjustment_other_type_row")){if(this.get("value")==="OTHR"){m.animate("fadeIn","adjustment_other_type_row");}else{m.animate("fadeOut","adjustment_other_type_row");}}});m.connect("ceds_cert_type","onChange",function(){if(dj.byId("ceds_cert_type_hidden")){dj.byId("ceds_cert_type_hidden").set("value",this.get("displayedValue"));}});m.connect("ocds_cert_type","onChange",function(){if(dj.byId("ocds_cert_type_hidden")){dj.byId("ocds_cert_type_hidden").set("value",this.get("displayedValue"));}});m.connect("ids_clauses_required","onChange",function(){if(dj.byId("ids_clauses_required_hidden")){dj.byId("ids_clauses_required_hidden").set("value",this.get("displayedValue"));}});m.connect("tax_type","onChange",function(){m.toggleFields((this.get("value")==="OTHR"),null,["tax_other_type"]);if(dojo.byId("tax_other_type_row")){if(this.get("value")==="OTHR"){m.animate("fadeIn","tax_other_type_row");}else{m.animate("fadeOut","tax_other_type_row");}}});if(d.byId("product_category_other_code_row")&&d.byId("product_category_code")){if(dj.byId("product_category_code").get("value")==="OTHR"){m.animate("fadeIn","product_category_other_code_row");}else{m.animate("fadeOut","product_category_other_code_row");}}if(d.byId("product_characteristic_other_code_row")&&d.byId("product_characteristic_code")){if(dj.byId("product_characteristic_code").get("value")==="OTHR"){m.animate("fadeIn","product_characteristic_other_code_row");}else{m.animate("fadeOut","product_characteristic_other_code_row");}}if(d.byId("product_identifier_other_code_row")&&d.byId("product_identifier_code")){if(dj.byId("product_identifier_code").get("value")==="OTHR"){m.animate("fadeIn","product_identifier_other_code_row");}else{m.animate("fadeOut","product_identifier_other_code_row");}}if(d.byId("incoterm_other_row")&&d.byId("incoterm_code")){if(dj.byId("incoterm_code").get("value")==="OTHR"){m.animate("fadeIn","incoterm_other_row");}else{m.animate("fadeOut","incoterm_other_row");}}if(d.byId("freight_charge_other_type_row")&&d.byId("freight_charge_type")){if(dj.byId("freight_charge_type").get("value")==="OTHR"){m.animate("fadeIn","freight_charge_other_type_row");}else{m.animate("fadeOut","freight_charge_other_type_row");}}if(d.byId("pmt_tds_qty_unit_measr_other_row")&&d.byId("pmt_tds_qty_unit_measr_code")){if(dj.byId("pmt_tds_qty_unit_measr_code").get("value")==="OTHR"){m.animate("fadeIn","pmt_tds_qty_unit_measr_other_row");}else{m.animate("fadeOut","pmt_tds_qty_unit_measr_other_row");}}if(d.byId("pmt_tds_vol_unit_measr_other_row")&&d.byId("pmt_tds_vol_unit_measr_code")){if(dj.byId("pmt_tds_vol_unit_measr_code").get("value")==="OTHR"){m.animate("fadeIn","pmt_tds_vol_unit_measr_other_row");}else{m.animate("fadeOut","pmt_tds_vol_unit_measr_other_row");}}if(d.byId("pmt_tds_weight_unit_measr_other_row")&&d.byId("pmt_tds_weight_unit_measr_code")){if(dj.byId("pmt_tds_weight_unit_measr_code").get("value")==="OTHR"){m.animate("fadeIn","pmt_tds_weight_unit_measr_other_row");}else{m.animate("fadeOut","pmt_tds_weight_unit_measr_other_row");}}m.connect("pmt_tds_qty_unit_measr_code","onChange",function(){m.toggleFields((this.get("value")==="OTHR"),null,["pmt_tds_qty_unit_measr_other"]);if(d.byId("pmt_tds_qty_unit_measr_other_row")){if(this.get("value")==="OTHR"){m.animate("fadeIn","pmt_tds_qty_unit_measr_other_row");}else{m.animate("fadeOut","pmt_tds_qty_unit_measr_other_row");}}});m.connect("pmt_tds_vol_unit_measr_code","onChange",function(){m.toggleFields((this.get("value")==="OTHR"),null,["pmt_tds_vol_unit_measr_other"]);if(d.byId("pmt_tds_vol_unit_measr_other_row")){if(this.get("value")==="OTHR"){m.animate("fadeIn","pmt_tds_vol_unit_measr_other_row");}else{m.animate("fadeOut","pmt_tds_vol_unit_measr_other_row");}}});m.connect("pmt_tds_weight_unit_measr_code","onChange",function(){m.toggleFields((this.get("value")==="OTHR"),null,["pmt_tds_weight_unit_measr_other"]);if(d.byId("pmt_tds_weight_unit_measr_other_row")){if(this.get("value")==="OTHR"){m.animate("fadeIn","pmt_tds_weight_unit_measr_other_row");}else{m.animate("fadeOut","pmt_tds_weight_unit_measr_other_row");}}});m.connect("freight_charge_type","onChange",function(){m.toggleFields((this.get("value")==="OTHR"),null,["freight_charge_other_type"]);if(dojo.byId("freight_charge_other_type_row")){if(this.get("value")==="OTHR"){m.animate("fadeIn","freight_charge_other_type_row");}else{m.animate("fadeOut","freight_charge_other_type_row");}}});m.connect("incoterm_code","onChange",function(){m.toggleFields((this.get("value")==="OTHR"),null,["incoterm_other"]);if(dojo.byId("incoterm_other_row")){if(this.get("value")==="OTHR"){m.animate("fadeIn","incoterm_other_row");}else{m.animate("fadeOut","incoterm_other_row");}}});m.connect("product_identifier_code","onChange",function(){m.toggleFields((this.get("value")==="OTHR"),null,["product_identifier_other_code"]);if(dojo.byId("product_identifier_other_code_row")){if(this.get("value")==="OTHR"){m.animate("fadeIn","product_identifier_other_code_row");}else{m.animate("fadeOut","product_identifier_other_code_row");}}});m.connect("product_characteristic_code","onChange",function(){m.toggleFields((this.get("value")==="OTHR"),null,["product_characteristic_other_code"]);if(dojo.byId("product_characteristic_other_code_row")){if(this.get("value")==="OTHR"){m.animate("fadeIn","product_characteristic_other_code_row");}else{m.animate("fadeOut","product_characteristic_other_code_row");}}});m.connect("product_category_code","onChange",function(){m.toggleFields((this.get("value")==="OTHR"),null,["product_category_other_code"]);if(d.byId("product_characteristic_other_code_row")){if(this.get("value")==="OTHR"){m.animate("fadeIn","product_category_other_code_row");}else{m.animate("fadeOut","product_category_other_code_row");}}});m.connect("contact_type","onChange",m.setContactDetails);m.connect(dj.byId("obligor_bank"),"onBlur",function(){var _24=false,_25=dj.byId("bank-payment-obligations");m.validateBpoBICFormat(dj.byId("obligor_bank"));var _26=this.get("value");var _27=dj.byId("obligor_bank_hidden").get("value");if(_26!=_27){if(_25&&_25.store&&_25.store._arrayOfTopLevelItems.length>0&&_26!=""){_25.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(_25,function(_28,_29){dojo.forEach(_28,function(_2a){if(_2a.obligor_bank[0]===_26){_24=true;}});})});if(_24){this.set("value","");displayMessage=misys.getLocalization("duplicateBicIdImportOpenAccount",[this.get("value")]);this.focus();this.set("state","Error");dj.hideTooltip(this.domNode);dj.showTooltip(displayMessage,this.domNode,0);}}}_obligorAndRecipientBICsShouldBeDiff(true);});m.connect("settlement_bic","onClick",function(){if(dj.byId("creditor_agent_name")&&dj.byId("creditor_agent_bic")&&dj.byId("creditor_street_name")&&dj.byId("creditor_post_code_identification")&&dj.byId("creditor_town_name")&&dj.byId("creditor_country_sub_div")&&dj.byId("creditor_country")&&dj.byId("settlement_bic")&&dj.byId("settlement_bic").get("checked")==true){dj.byId("creditor_agent_bic").set("disabled",false);dj.byId("creditor_agent_name").set("value","");dj.byId("creditor_street_name").set("value","");dj.byId("creditor_post_code_identification").set("value","");dj.byId("creditor_town_name").set("value","");dj.byId("creditor_country_sub_div").set("value","");dj.byId("creditor_country").set("value","");dj.byId("creditor_street_name").set("disabled",true);dj.byId("creditor_post_code_identification").set("disabled",true);dj.byId("creditor_town_name").set("disabled",true);dj.byId("creditor_country_sub_div").set("disabled",true);dj.byId("creditor_country").set("disabled",true);dj.byId("creditor_agent_name").set("disabled",true);}});m.connect("settlement_name_address","onClick",function(){if(dj.byId("creditor_agent_name")&&dj.byId("creditor_agent_bic")&&dj.byId("creditor_street_name")&&dj.byId("creditor_post_code_identification")&&dj.byId("creditor_town_name")&&dj.byId("creditor_country_sub_div")&&dj.byId("creditor_country")&&dj.byId("settlement_name_address")&&dj.byId("settlement_name_address").get("checked")==true){dj.byId("creditor_agent_name").set("disabled",false);dj.byId("creditor_street_name").set("disabled",false);dj.byId("creditor_post_code_identification").set("disabled",false);dj.byId("creditor_town_name").set("disabled",false);dj.byId("creditor_country_sub_div").set("disabled",false);dj.byId("creditor_country").set("disabled",false);dj.byId("creditor_agent_bic").set("value","");dj.byId("creditor_agent_bic").set("disabled",true);}});m.connect("payment_obligation_amount","onBlur",function(){if(dj.byId("total_net_amt")&&dj.byId("oblg_amt")){var _2b=dj.byId("total_net_amt").get("value");var _2c=dj.byId("payment_obligation_amount").get("value");if(_2c>_2b){errorMessage=m.getLocalization("bpoAmountGreaterThanTotalAmtError");dj.byId("payment_obligation_amount").set("state","Error");dj.hideTooltip(dj.byId("payment_obligation_amount").domNode);dj.showTooltip(errorMessage,dj.byId("payment_obligation_amount").domNode,0);}}});m.connect("bpo_used_status","onChange",function(){if(dj.byId("bpo_used_status")&&dj.byId("add_bpo_button")&&dj.byId("bpo_used_status").get("checked")===true){dj.byId("add_bpo_button").set("disabled",false);}else{if(dj.byId("bpo_used_status")&&dj.byId("add_bpo_button")&&dj.byId("bpo_used_status").get("checked")===false){dj.byId("add_bpo_button").set("disabled",true);if(dj.byId("bank-payment-obligations")){dj.byId("bank-payment-obligations").clear();}}}});m.connect("payment_obligation_amount","onChange",function(){m.validateAmount(dj.byId("payment_obligation_amount"));});m.connect("payment_obligation_percent","onChange",function(){m.validateAmount(dj.byId("payment_obligation_percent"));});m.connect("payment_charges_amount","onChange",function(){m.validateAmount(dj.byId("payment_charges_amount"));});m.connect("payment_charges_percent","onChange",function(){m.validateAmount(dj.byId("payment_charges_percent"));});m.connect("payment_amount","onChange",function(){m.validateAmount(dj.byId("payment_amount"));});m.connect("payment_percent","onChange",function(){m.validateAmount(dj.byId("payment_percent"));});m.connect("cds_bic","onBlur",function(){m.validateBpoBICFormat(dj.byId("cds_bic"));});m.connect("tds_bic","onBlur",function(){m.validateBpoBICFormat(dj.byId("tds_bic"));});m.connect("payment_tds_bic","onBlur",function(){m.validateBpoBICFormat(dj.byId("payment_tds_bic"));});m.connect("ids_bic","onBlur",function(){m.validateBpoBICFormat(dj.byId("ids_bic"));});m.connect("ceds_bic","onBlur",function(){m.validateBpoBICFormat(dj.byId("ceds_bic"));});m.connect("ocds_bic","onBlur",function(){m.validateBpoBICFormat(dj.byId("ocds_bic"));});m.connect("recipient_bank","onBlur",function(){m.validateBpoBICFormat(dj.byId("recipient_bank"));_obligorAndRecipientBICsShouldBeDiff(false);});m.connect("creditor_agent_bic","onBlur",function(){m.validateBpoBICFormat(dj.byId("creditor_agent_bic"));});m.connect("buyer_bank_bpo","onClick",function(){if(dj.byId("buyer_bank_bpo_added")&&dj.byId("buyer_bank_bpo_added").get("value")!="true"&&dj.byId("buyer_bank_bpo").get("checked")===true){if(dj.byId("obligor_bank")&&dj.byId("buyer_bank_bic")&&dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!=""){dj.byId("obligor_bank").set("value",dj.byId("buyer_bank_bic").get("value"));dj.byId("obligor_bank").set("disabled",true);}else{if(dj.byId("obligor_bank")&&dj.byId("buyer_bank_bic")&&dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")===""){dj.byId("buyer_bank_bpo").set("checked",false);m.dialog.show("ERROR",m.getLocalization("selectBuyerBank"),"",function(){});}}}else{if(dj.byId("buyer_bank_bpo_added")&&dj.byId("buyer_bank_bpo_added").get("value")!="true"&&dj.byId("buyer_bank_bpo").get("checked")===false){dj.byId("obligor_bank").set("value","");dj.byId("obligor_bank").set("disabled",false);}else{if(dj.byId("buyer_bank_bpo_added")&&dj.byId("buyer_bank_bpo_added").get("value")!="false"&&dj.byId("buyer_bank_bpo").get("checked")===false){dj.byId("buyer_bank_bpo_added").set("value",false);dj.byId("obligor_bank").set("value","");dj.byId("obligor_bank").set("disabled",false);}}}});if(dj.byId("tnxtype")&&dj.byId("tnxtype").get("value")==="38"&&dj.byId("close_tnx")){dj.byId("close_tnx").set("checked",true);d.style(d.byId("transactionDetails"),"display","none");d.style(d.byId("buyerSellerDetails"),"display","none");d.style(d.byId("closeComments"),"display","block");if(dj.byId("exp_date")){dj.byId("exp_date").set("readOnly",true);}if(dj.byId("bpo_used_status")){dj.byId("bpo_used_status").set("disabled",true);}}if(dj.byId("tnxtype")&&dj.byId("tnxtype").get("value")==="38"){d.style(d.byId("transactionDetails"),"display","none");d.style(d.byId("buyerSellerDetails"),"display","none");d.style(d.byId("closeComments"),"display","block");}m.connect("close_tnx","onClick",function(){var _2d=["bill_to_name","bill_to_town_name","bill_to_post_code","bill_to_country","ship_to_name","ship_to_town_name","ship_to_post_code","ship_to_country","consgn_name","consgn_town_name","consgn_post_code","consgn_country","issuing_bank_customer_reference","total_cur_code","total_net_amt","fin_inst_bic","fin_inst_name","fin_inst_post_code","fin_inst_town_name","fin_inst_country","seller_account_iban","seller_account_bban","seller_account_upic","seller_account_id","seller_account_type_code","seller_account_type_prop"];if(dj.byId("close_tnx")&&(dj.byId("close_tnx").get("checked")===true)){_2={};d.style(d.byId("transactionDetails"),"display","none");d.style(d.byId("buyerSellerDetails"),"display","none");d.style(d.byId("closeComments"),"display","block");dj.byId("tnxtype").set("value","38");dj.byId("exp_date").set("readOnly",true);dj.byId("exp_date").set("value",null);dj.byId("bpo_used_status").set("disabled",true);for(var i in _2d){if(dj.byId(_2d[i])){_2[_2d[i]]=dj.byId(_2d[i]).get("required");m.toggleRequired(_2d[i],false);}}misys._config.warningMessages=[];}else{if(dj.byId("close_tnx")&&(dj.byId("close_tnx").get("checked")===false)){var _2e=m.getMaxBPOExpDate();d.style(d.byId("transactionDetails"),"display","block");d.style(d.byId("buyerSellerDetails"),"display","block");d.style(d.byId("closeComments"),"display","none");dj.byId("tnxtype").set("value","31");dj.byId("exp_date").set("readOnly",false);dj.byId("exp_date").set("value",_2e);dj.byId("bpo_used_status").set("disabled",false);for(var j in _2){if(dj.byId(j)){m.toggleRequired(j,_2[j]);}}m.validateResubmissionCount();m.resizeGrids();}}});m.connect("settlement_bic","onChange",function(){if(dj.byId("settlement_bic")&&dj.byId("settlement_bic").get("checked")===true){d.style(d.byId("CreditorAgentBIC"),"display","block");dj.byId("creditor_agent_bic").set("required",true);d.style(d.byId("CreditorAgentName"),"display","none");dj.byId("creditor_agent_name").set("required",false);dj.byId("creditor_post_code_identification").set("required",false);dj.byId("creditor_town_name").set("required",false);dj.byId("creditor_country").set("required",false);}});m.connect("settlement_name_address","onChange",function(){if(dj.byId("settlement_name_address")&&dj.byId("settlement_name_address").get("checked")===true){d.style(d.byId("CreditorAgentName"),"display","block");dj.byId("creditor_agent_name").set("required",true);dj.byId("creditor_post_code_identification").set("required",true);dj.byId("creditor_town_name").set("required",true);dj.byId("creditor_country").set("required",true);d.style(d.byId("CreditorAgentBIC"),"display","none");dj.byId("creditor_agent_bic").set("required",false);}});m.connect("creditor_account_iban","onChange",function(){if(dj.byId("creditor_account_iban")&&dj.byId("creditor_account_iban").get("checked")===true){dojo.style(dojo.byId("creditor_account_id_iban_row"),"display","block");dj.byId("creditor_account_id_prop").set("required",true);dojo.style(dojo.byId("creditor_account_id_bban_row"),"display","none");dj.byId("creditor_account_id_bban").set("value","");dj.byId("creditor_account_id_bban").set("required",false);dojo.style(dojo.byId("creditor_account_id_upic_row"),"display","none");dj.byId("creditor_account_id_upic").set("value","");dj.byId("creditor_account_id_upic").set("required",false);dojo.style(dojo.byId("creditor_account_id_prop_row"),"display","none");dj.byId("creditor_account_id_prop").set("value","");dj.byId("creditor_account_id_prop").set("required",false);}});m.connect("creditor_account_bban","onChange",function(){if(dj.byId("creditor_account_bban")&&dj.byId("creditor_account_bban").get("checked")===true){d.style(d.byId("creditor_account_id_iban_row"),"display","none");dj.byId("creditor_account_id_iban").set("value","");dj.byId("creditor_account_id_iban").set("required",false);d.style(d.byId("creditor_account_id_bban_row"),"display","block");dj.byId("creditor_account_id_bban").set("required",true);dj.byId("creditor_account_id_upic").set("value","");dj.byId("creditor_account_id_upic").set("required",false);d.style(d.byId("creditor_account_id_upic_row"),"display","none");dj.byId("creditor_account_id_prop").set("value","");dj.byId("creditor_account_id_prop").set("required",false);dojo.style(dojo.byId("creditor_account_id_prop_row"),"display","none");}});m.connect("creditor_account_upic","onChange",function(){if(dj.byId("creditor_account_upic")&&dj.byId("creditor_account_upic").get("checked")===true){d.style(dojo.byId("creditor_account_id_iban_row"),"display","none");dj.byId("creditor_account_id_iban").set("value","");dj.byId("creditor_account_id_iban").set("required",false);d.style(d.byId("creditor_account_id_bban_row"),"display","none");dj.byId("creditor_account_id_bban").set("value","");dj.byId("creditor_account_id_bban").set("required",false);d.style(d.byId("creditor_account_id_upic_row"),"display","block");dj.byId("creditor_account_id_upic").set("required",true);d.style(d.byId("creditor_account_id_prop_row"),"display","none");dj.byId("creditor_account_id_prop").set("value","");dj.byId("creditor_account_id_prop").set("required",false);}});m.connect("creditor_account_prop","onChange",function(){if(dj.byId("creditor_account_prop")&&dj.byId("creditor_account_prop").get("checked")===true){dojo.style(dojo.byId("creditor_account_id_iban_row"),"display","none");dj.byId("creditor_account_id_iban").set("value","");dj.byId("creditor_account_id_iban").set("required",false);dojo.style(dojo.byId("creditor_account_id_bban_row"),"display","none");dj.byId("creditor_account_id_bban").set("value","");dj.byId("creditor_account_id_bban").set("required",false);dojo.style(dojo.byId("creditor_account_id_upic_row"),"display","none");dj.byId("creditor_account_id_upic").set("value","");dj.byId("creditor_account_id_upic").set("required",false);dojo.style(dojo.byId("creditor_account_id_prop_row"),"display","block");dj.byId("creditor_account_id_prop").set("required",true);}});m.connect("creditor_act_type_code","onChange",function(){if(dj.byId("creditor_act_type_code")&&dj.byId("creditor_act_type_code").get("checked")===true){dojo.style(dojo.byId("creditor_account_type_prop_row"),"display","none");dj.byId("creditor_account_type_prop").set("value","");dj.byId("creditor_account_type_prop").set("required",false);dojo.style(dojo.byId("creditor_account_type_code_row"),"display","block");dj.byId("creditor_account_type_code").set("required",true);}});m.connect("creditor_act_type_prop","onChange",function(){if(dj.byId("creditor_act_type_prop")&&dj.byId("creditor_act_type_prop").get("checked")===true){dojo.style(dojo.byId("creditor_account_type_prop_row"),"display","block");dj.byId("creditor_account_type_prop").set("required",true);dj.byId("creditor_account_type_code").set("value","");dj.byId("creditor_account_type_code").set("required",false);dojo.style(dojo.byId("creditor_account_type_code_row"),"display","none");}});m.connect("pmt_code","onChange",function(){if(dj.byId("pmt_code")&&dj.byId("pmt_code").get("checked")===true){dojo.style(dojo.byId("paymentCode"),"display","block");dj.byId("payment_nb_days").set("disabled",false);dj.byId("payment_code").set("disabled",false);dj.byId("payment_code").set("required",true);dj.byId("payment_other_term").set("required",false);dj.byId("payment_other_term").set("value","");dojo.style(dojo.byId("payment_other_term_row"),"display","none");}});m.connect("pmt_other_term_code","onChange",function(){if(dj.byId("pmt_other_term_code")&&dj.byId("pmt_other_term_code").get("checked")===true){dojo.style(dojo.byId("paymentCode"),"display","none");dj.byId("payment_code").set("value","");dj.byId("payment_nb_days").set("value","");dojo.style(dojo.byId("payment_other_term_row"),"display","block");dj.byId("payment_other_term").set("disabled",false);dj.byId("payment_code").set("required",false);dj.byId("payment_other_term").set("required",true);}});m.connect("payment_obligation_amount","onChange",function(){m.toggleMutuallyExclusiveMandatoryFields(["payment_obligation_amount","payment_obligation_percent"]);});m.connect("payment_obligation_amount","onBlur",function(){m.toggleMutuallyExclusiveMandatoryFields(["payment_obligation_amount","payment_obligation_percent"]);});m.connect("payment_obligation_percent","onChange",function(){m.toggleMutuallyExclusiveMandatoryFields(["payment_obligation_amount","payment_obligation_percent"]);});m.connect("payment_obligation_percent","onBlur",function(){m.toggleMutuallyExclusiveMandatoryFields(["payment_obligation_amount","payment_obligation_percent"]);});m.connect("payment_charges_amount","onChange",function(){m.toggleMutuallyExclusiveFields(["payment_charges_amount","payment_charges_percent"]);});m.connect("payment_charges_amount","onBlur",function(){m.toggleMutuallyExclusiveFields(["payment_charges_amount","payment_charges_percent"]);});m.connect("payment_charges_percent","onChange",function(){m.toggleMutuallyExclusiveFields(["payment_charges_amount","payment_charges_percent"]);});m.connect("payment_charges_percent","onBlur",function(){m.toggleMutuallyExclusiveFields(["payment_charges_amount","payment_charges_percent"]);});m.connect("payment_amount","onChange",function(){m.toggleMutuallyExclusiveMandatoryFields(["payment_amount","payment_percent"]);});m.connect("payment_amount","onBlur",function(){m.toggleMutuallyExclusiveMandatoryFields(["payment_amount","payment_percent"]);});m.connect("payment_percent","onChange",function(){m.toggleMutuallyExclusiveMandatoryFields(["payment_amount","payment_percent"]);});m.connect("payment_percent","onBlur",function(){m.toggleMutuallyExclusiveMandatoryFields(["payment_amount","payment_percent"]);});m.connect("seller_name","onChange",function(){if(dj.byId("seller_name")&&dj.byId("seller_name").get("value")!==""&&(dj.byId("tnxtype")&&dj.byId("tnxtype").get("value")==="01")){dj.byId("seller_name").set("readOnly",false);dj.byId("seller_street_name").set("readOnly",false);dj.byId("seller_town_name").set("readOnly",false);dj.byId("seller_country_sub_div").set("readOnly",false);dj.byId("seller_post_code").set("readOnly",false);}});if(dj.byId("tnxtype")&&dj.byId("tnxtype").get("value")!=="38"){m.validateResubmissionCount();}},onFormLoad:function(){_3=m.formToXML();var _2f=dj.byId("prodstatus");var _30=dj.byId("tnxtype");if((_2f&&_2f.get("value")==="43")||(_30&&_30.get("value")==="03")){if(dj.byId("provisional_status")){dj.byId("provisional_status").set("value","Y");}if(dj.byId("buyer_name")){dj.byId("buyer_name").set("readOnly",true);}if(dj.byId("buyer_country")){dj.byId("buyer_country").set("readOnly",true);}if(dj.byId("seller_country")){dj.byId("seller_country").set("readOnly",true);}if(dj.byId("seller_name")){dj.byId("seller_name").set("readOnly",true);}}var _31=dj.byId("display_other_parties");if(_31){m.showHideOtherParties();misys.toggleCountryFields(false,["bill_to_country","ship_to_country","consgn_country"]);}m.toggleDisableButtons();if(dj.byId("add_payment_term_button")&&!((dj.byId("payment_terms_type_1")&&dj.byId("payment_terms_type_1").get("checked"))||(dj.byId("payment_terms_type_2")&&dj.byId("payment_terms_type_2").get("checked")))){dj.byId("add_payment_term_button").set("disabled",true);}var _32=dj.byId("issuing_bank_abbv_name");if(_32){_32.onChange();}var _33=dj.byId("issuing_bank_customer_reference");if(_33){_33.onChange();_33.set("value",_33._resetValue);}var _34=dj.byId("accpt_total_amt");var _35=dj.byId("accpt_total_net_amt");var _36=dj.byId("pending_total_amt");var _37=dj.byId("pending_total_net_amt");var _38=dj.byId("accpted_amt");var _39=dj.byId("pending_amt");var _3a=dj.byId("paid_total_net_amt");var _3b=dj.byId("outstanding_amt");var _3c=dj.byId("outstanding_amt_cur_code");var _3d=dj.byId("accpted_amt_cur_code");var _3e=dj.byId("pending_amt_cur_code");var _3f=dj.byId("paid_amt_cur_code");if(_34){if(isNaN(_34.get("value"))){_34.set("value",0);}else{_34.set("value",_34.get("value"));}}if(_35){if(isNaN(_35.get("value"))){_35.set("value",0);}else{_35.set("value",_35.get("value"));}}if(_36){_36.set("value",0);}if(_37){_37.set("value",0);}if(_38){_38.set("value",0);}if(_39){_39.set("value",0);}if(_3a){_3a.set("value",0);}if(_3b){_3b.set("value",0);}if(_3c){_3c.set("value",dj.byId("total_net_cur_code").get("value"));}if(_3d){_3d.set("value",dj.byId("total_net_cur_code").get("value"));}if(_3e){_3e.set("value",dj.byId("total_net_cur_code").get("value"));}if(_3f){_3f.set("value",dj.byId("total_net_cur_code").get("value"));}m.computePOTotalAmount();m.managePOCurrency();if(dj.byId("finance_cur_code")&&dj.byId("finance_amt")&&isNaN(dj.byId("finance_amt").get("value"))){if(dj.byId("intent_to_pay_amt")&&dj.byId("intent_to_pay_amt").get("value")!=""){dj.byId("finance_cur_code").set("value",dj.byId("total_net_cur_code").get("value"));dj.byId("finance_amt").set("value",dj.byId("intent_to_pay_amt").get("value"));}else{dj.byId("finance_cur_code").set("value",dj.byId("total_net_cur_code").get("value"));dj.byId("finance_amt").set("value",dj.byId("total_net_amt").get("value"));}}if(dj.byId("payment_obligation_amount")&&dj.byId("payment_obligation_amount").get("value")!==""){dj.byId("payment_obligation_amount").set("disabled",false);}else{dj.byId("payment_obligation_amount").set("disabled",true);}if(dj.byId("payment_obligation_percent")&&dj.byId("payment_obligation_percent").get("value")!==""){dj.byId("payment_obligation_percent").set("disabled",false);}else{dj.byId("payment_obligation_percent").set("disabled",true);}if(dj.byId("isCopyFrom")&&dj.byId("isCopyFrom").get("value")==="Y"){m.clearBpoExpiryDateOnLoad();}if(dj.byId("creditor_agent_bic")&&dj.byId("settlement_bic")&&(dj.byId("settlement_bic").get("checked")!=true)){dj.byId("creditor_agent_bic").set("disabled",true);dj.byId("creditor_agent_bic").set("required",false);}else{if(dj.byId("creditor_agent_bic")){dj.byId("creditor_agent_bic").set("disabled",false);}}if(dj.byId("creditor_agent_name")&&dj.byId("creditor_street_name")&&dj.byId("creditor_post_code_identification")&&dj.byId("creditor_town_name")&&dj.byId("creditor_country_sub_div")&&dj.byId("creditor_country")&&dj.byId("settlement_name_address")&&(dj.byId("settlement_name_address").get("checked")!=true)){dj.byId("creditor_agent_name").set("disabled",true);dj.byId("creditor_street_name").set("disabled",true);dj.byId("creditor_post_code_identification").set("disabled",true);dj.byId("creditor_town_name").set("disabled",true);dj.byId("creditor_country_sub_div").set("disabled",true);dj.byId("creditor_country").set("disabled",true);dj.byId("creditor_agent_name").set("required",false);dj.byId("creditor_post_code_identification").set("required",false);dj.byId("creditor_town_name").set("required",false);dj.byId("creditor_country").set("required",false);}else{if(dj.byId("creditor_agent_name")&&dj.byId("creditor_street_name")&&dj.byId("creditor_post_code_identification")&&dj.byId("creditor_town_name")&&dj.byId("creditor_country_sub_div")&&dj.byId("creditor_country")){dj.byId("creditor_agent_name").set("disabled",false);dj.byId("creditor_street_name").set("disabled",false);dj.byId("creditor_post_code_identification").set("disabled",false);dj.byId("creditor_town_name").set("disabled",false);dj.byId("creditor_country_sub_div").set("disabled",false);dj.byId("creditor_country").set("disabled",false);}}if(dj.byId("creditor_account_iban")&&dj.byId("creditor_account_iban").get("checked")===true){dojo.style(dojo.byId("creditor_account_id_iban_row"),"display","block");dj.byId("creditor_account_id_iban").set("required",true);}else{if(dj.byId("creditor_account_iban")){dojo.style(dojo.byId("creditor_account_id_iban_row"),"display","none");dj.byId("creditor_account_id_iban").set("required",false);}}if(dj.byId("creditor_account_bban")&&dj.byId("creditor_account_bban").get("checked")===true){dojo.style(dojo.byId("creditor_account_id_bban_row"),"display","block");dj.byId("creditor_account_id_bban").set("required",true);}else{if(dj.byId("creditor_account_bban")){dojo.style(dojo.byId("creditor_account_id_bban_row"),"display","none");dj.byId("creditor_account_id_bban").set("required",false);}}if(dj.byId("creditor_account_upic")&&dj.byId("creditor_account_upic").get("checked")===true){dojo.style(dojo.byId("creditor_account_id_upic_row"),"display","block");dj.byId("creditor_account_id_upic").set("required",true);}else{if(dj.byId("creditor_account_upic")){dojo.style(dojo.byId("creditor_account_id_upic_row"),"display","none");dj.byId("creditor_account_id_upic").set("required",false);}}if(dj.byId("creditor_account_prop")&&dj.byId("creditor_account_prop").get("checked")===true){dojo.style(dojo.byId("creditor_account_id_prop_row"),"display","block");dj.byId("creditor_account_id_prop").set("required",true);}else{if(dj.byId("creditor_account_prop")){dojo.style(dojo.byId("creditor_account_id_prop_row"),"display","none");dj.byId("creditor_account_id_prop").set("required",false);}}if(dj.byId("pmt_other_term_code")&&dj.byId("pmt_other_term_code").get("checked")===true){dojo.style(dojo.byId("payment_other_term_row"),"display","block");dj.byId("payment_other_term").set("required",true);}else{if(dj.byId("pmt_other_term_code")){dojo.style(dojo.byId("payment_other_term_row"),"display","none");dj.byId("payment_other_term").set("required",false);}}if(dj.byId("pmt_code")&&dj.byId("pmt_code").get("checked")===true){dojo.style(dojo.byId("paymentCode"),"display","block");dj.byId("payment_code").set("required",true);}else{if(dj.byId("pmt_code")){dojo.style(dojo.byId("paymentCode"),"display","none");dj.byId("payment_code").set("required",false);}}if(dj.byId("creditor_act_type_prop")&&dj.byId("creditor_act_type_prop").get("checked")===true){dojo.style(dojo.byId("creditor_account_type_prop_row"),"display","block");dj.byId("creditor_account_type_prop").set("required",true);}else{if(dj.byId("creditor_act_type_prop")){dojo.style(dojo.byId("creditor_account_type_prop_row"),"display","none");dj.byId("creditor_account_type_prop").set("required",false);}}if(dj.byId("creditor_act_type_code")&&dj.byId("creditor_act_type_code").get("checked")===true){dojo.style(dojo.byId("creditor_account_type_code_row"),"display","block");dj.byId("creditor_account_type_code").set("required",true);}else{if(dj.byId("creditor_act_type_code")){dojo.style(dojo.byId("creditor_account_type_code_row"),"display","none");dj.byId("creditor_account_type_code").set("required",false);}}m.oaOnLoadActions();if(dj.byId("bpo_used_status")&&dj.byId("add_bpo_button")&&dj.byId("bpo_used_status").get("checked")===true){dj.byId("add_bpo_button").set("disabled",false);}else{if(dj.byId("bpo_used_status")&&dj.byId("add_bpo_button")&&dj.byId("bpo_used_status").get("checked")===false){dj.byId("add_bpo_button").set("disabled",true);}}var _40=dj.byId("bank-payment-obligations");var _41=false;if(_40&&_40.store&&_40.store._arrayOfTopLevelItems){_40.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(_40,function(_42,_43){dojo.forEach(_42,function(_44){if(_44.buyer_bank_bpo[0]==="Y"){dj.byId("buyer_bank_bpo_added").set("value",true);_41=true;}});})});if(!_41){dj.byId("buyer_bank_bpo_added").set("value",false);}}_obligorAndRecipientBICsShouldBeDiff(true);_1="true";},beforeSaveValidations:function(){var _45=true;var _46="";var _47=dj.byId("entity");if(_47&&_47.get("value")===""){_45=false;}return _45;},beforeSubmitValidations:function(){var _48=true,_49="",_4a=dj.byId("po-payments"),_4b=dj.byId("line-items"),_4c=dj.byId("bank-payment-obligations"),_4d=dj.byId("commercial-ds"),_4e=0,_4f=dj.byId("total_net_amt"),_50=dj.byId("contact-details"),_51=false,_52=false,_53=dj.byId("part_ship_2")?dj.byId("part_ship_2").get("checked"):false,_54=dj.byId("buyer_bank_bic"),_55=dj.byId("seller_bank_bic");if(dj.byId("tnxtype")&&dj.byId("tnxtype").get("value")==="38"){closeComments=dj.byId("close_comments");if(closeComments&&dojo.string.trim(closeComments.get("value"))===""){closeComments.set("required",true);_48=false;_49=m.getLocalization("closeCommentsMandatory");}m._config.onSubmitErrorMsg=_49;return _48;}else{m.checkPoReferenceExistsIO();if(dj.byId("issuer_ref_id")&&dj.byId("issuer_ref_id").get("state")==="Error"){_49+=m.getLocalization("mandatoryPOReferenceError");_48=false;}if(!_4a||!_4a.store||_4a.store._arrayOfTopLevelItems.length<=0){_49+=m.getLocalization("mandatoryPaymentTermError");_48=false;}if(!_4b||!_4b.store||_4b.store._arrayOfTopLevelItems.length<=0){if(_49!==""){_49+="<br>";}_49+=misys.getLocalization("mandatoryLineItemError");_48=false;}if(dj.byId("tnxtype")&&dj.byId("tnxtype").get("value")!=="61"){if(!_50||!_50.store||_50.store._arrayOfTopLevelItems.length<=0){if(_49!==""){_49+="<br>";}_49+=misys.getLocalization("mandatoryContactBuyerOrSellerBankError");_48=false;}if(_50&&_50.store!==null&&_50.store._arrayOfTopLevelItems.length>0){var _56=true;var _57=_50.store._arrayOfTopLevelItems.length;for(var i=0;i<_57;i++){var _58=_50.store._arrayOfTopLevelItems[i];if(_58!==null&&(_58.type[0]==="04"||_58.type[0]==="03")){_56=false;}}if(_56===true){if(_49!==""){_49+="<br>";}_49+=misys.getLocalization("mandatoryContactBuyerOrSellerBankError");_48=false;}}}if(_4f&&_4a.store&&_4a.store._arrayOfTopLevelItems.length>0){var _59=0;var Amt=0;var _5a=parseFloat(dijit.byId("total_net_amt").get("value"));_4a.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(_4a,function(_5b,_5c){dojo.forEach(_5b,function(_5d){if(_5d.amt[0]!=""){_59=_59+parseFloat(_5d.amt[0].replace(",",""));}else{if(_5d.pct[0]!=""){Amt=(parseFloat(_5d.pct[0])/100)*_5a;_59=_59+Amt;}}});})});if(_59!=_5a){if(_49!==""){_49+="<br>";}_49+=misys.getLocalization("paymentAmtOrPercentage");_48=false;}}if(dj.byId("tnxtype")&&dj.byId("tnxtype").get("value")!=="61"){if(_53&&_4a.store&&_4a.store._arrayOfTopLevelItems.length>1){if(_49!==""){_49+="<br>";}_49+=misys.getLocalization("multiplePaymentTermsError");_48=false;}if(!_4d||!_4d.store||_4d.store._arrayOfTopLevelItems.length<=0){if(_49!==""){_49+="<br>";}_49+=misys.getLocalization("mandatoryCommercialDatasetError");_48=false;}if(dj.byId("seller_bank_bic")&&_4d&&_4d.store&&_4d.store._arrayOfTopLevelItems.length>0){var _5e=dj.byId("seller_bank_bic").get("value");_4d.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(_4d,function(_5f,_60){dojo.forEach(_5f,function(_61){if(_61.BIC[0]!==_5e){_49+=misys.getLocalization("commercialDatasetBicSellerBicError");_48=false;}});})});}}if(_4f&&_4c&&_4c.store&&_4c.store._arrayOfTopLevelItems){var _62=_4f.get("value");_4c.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(_4c,function(_63,_64){dojo.forEach(_63,function(_65){if(_65.payment_obligation_amount[0]!==""){_4e=_4e+parseInt(_65.payment_obligation_amount[0],10);}else{if(_65.payment_obligation_percent[0]!==""){paymentOblgAmt=(parseInt(_65.payment_obligation_percent[0],10)/100)*parseInt(_62,10);_4e=_4e+paymentOblgAmt;}}if(_65.payment_expiry_date[0]===""){_51=true;}if(_65.creditor_account_id_iban[0]===""&&_65.creditor_account_id_bban[0]===""&&_65.creditor_account_id_upic[0]===""&&_65.creditor_account_id_prop[0]===""){_52=true;}});})});if(_4e>_62){_48=false;_49=m.getLocalization("BpoSumMoreThanEaAmount");}if(_51){if(_49!==""){_49+="<br>";}_49+=m.getLocalization("bpoExpiryDateNotPresent");_48=false;}if(_52){if(_49!==""){_49+="<br>";}_49+=m.getLocalization("bpoCreditorAccIdTypeError");_48=false;}}if(_54&&_55&&(_54.get("value")===_55.get("value"))){if(_49!==""){_49+="<br>";}_49+=m.getLocalization("buyerAndSellerBicSameError");_48=false;}if(dj.byId("tnxtype")&&dj.byId("tnxtype").get("value")==="31"){var _66=m.compareDateIsGreater("exp_date",["iss_date","appl_date"]);if(!_66){_49+=m._config.onSubmitErrorMsg;_48=false;}}var _67=dj.byId("taking_in_charge");var _68=dj.byId("final_dest_place");if((_67&&_67.value!=="")&&(_68&&_68.value==="")){_49+=misys.getLocalization("multimodalDetMandatoryError");_48=false;}else{if((_68&&_68.value!=="")&&(_67&&_67.value==="")){_49+=misys.getLocalization("multimodalDetMandatoryError");_48=false;}}if(!m.validateCreditorAccountIdType()){if(_49!==""){_49+="<br>";}_49+=misys.getLocalization("creditorAccIdTypeError");_48=false;}if((_4b&&_4b.store&&_4b.store._arrayOfTopLevelItems.length>0)&&(m.hasIncotermsInAllLineItems()||m.hasLastShipmentInAllLineItems()||m.hasRoutingSummaryInAllLineItems())){if(_49!==""){_49+="<br>";}_49+=misys.getLocalization("incotermRoutingShipmentDateNotInAllLineItemError");_48=false;}var _69=m.isValidContact();if(_69!=""){_49=_69;_48=false;}m._config.onSubmitErrorMsg=_49;}return _48;}});function _6a(){var _6b=misys.getLocalization("resetExportOpenAccountCurrency");if(dj.byId("line-items")&&dj.byId("line-items").store&&dj.byId("line-items").store!=null&&dj.byId("line-items").store._arrayOfAllItems.length>0){for(var i=0,_6c=dj.byId("line-items").store._arrayOfAllItems.length;i<_6c;i++){var _6d=dj.byId("line-items").store._arrayOfAllItems[i];if(_6d!=null&&_6d.price_cur_code!==dj.byId("total_cur_code").get("value")){var _6e=function(){if(dj.byId("line-items").grid&&dj.byId("line-items").grid.store){dj.byId("line-items").grid.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(dj.byId("total_cur_code"),function(_6f,_70){d.forEach(_6f,function(_71){dj.byId("line-items").grid.store.setValue(_71,"price_cur_code",dj.byId("total_cur_code").get("value"));dj.byId("line-items").grid.store.setValue(_71,"total_cur_code",dj.byId("total_cur_code").get("value"));dj.byId("line-items").grid.store.setValue(_71,"total_net_cur_code",dj.byId("total_cur_code").get("value"));if(_71.taxes&&_71.taxes.length>0){dj.byId("tax_cur_code").set("value",dj.byId("total_cur_code").get("value"));if(_71.taxes[0]._values!=""&&_71.taxes[0]._values.length>0){for(i=0;i<_71.taxes[0]._values.length;i++){_71.taxes[0]._values[i].cur_code=dj.byId("total_cur_code").get("value");}}}if(_71.adjustments&&_71.adjustments.length>0){dj.byId("adjustment_cur_code").set("value",dj.byId("total_cur_code").get("value"));if(_71.adjustments[0]._values!=""&&_71.adjustments[0]._values.length>0){for(i=0;i<_71.adjustments[0]._values.length;i++){_71.adjustments[0]._values[i].cur_code=dj.byId("total_cur_code").get("value");}}}if(_71.freight_charges&&_71.freight_charges.length>0){dj.byId("freight_charge_cur_code").set("value",dj.byId("total_cur_code").get("value"));if(_71.freight_charges[0]._values!=""&&_71.freight_charges[0]._values.length>0){for(i=0;i<_71.freight_charges[0]._values.length;i++){_71.freight_charges[0]._values[i].cur_code=dj.byId("total_cur_code").get("value");}}}},dj.byId("line-items"));})});dj.byId("line-items").grid.store.save();var _72=dj.byId("line-items");setTimeout(function(){_72.renderSections();_72.grid.render();},200);}if(dj.byId("po-adjustments")&&dj.byId("po-adjustments").store&&dj.byId("po-adjustments").store!=null&&dj.byId("po-adjustments").store._arrayOfAllItems.length>0){if(dj.byId("po-adjustments").grid&&dj.byId("po-adjustments").grid.store){dj.byId("po-adjustments").grid.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(dj.byId("total_cur_code"),function(_73,_74){d.forEach(_73,function(_75){dj.byId("po-adjustments").grid.store.setValue(_75,"cur_code",dj.byId("total_cur_code").get("value"));},dj.byId("po-adjustments"));})});}}if(dj.byId("po-taxes")&&dj.byId("po-taxes").store&&dj.byId("po-taxes").store!=null&&dj.byId("po-taxes").store._arrayOfAllItems.length>0){if(dj.byId("po-taxes").grid&&dj.byId("po-taxes").grid.store){dj.byId("po-taxes").grid.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(dj.byId("total_cur_code"),function(_76,_77){d.forEach(_76,function(_78){dj.byId("po-taxes").grid.store.setValue(_78,"cur_code",dj.byId("total_cur_code").get("value"));},dj.byId("po-taxes"));})});}}if(dj.byId("po-freight-charges")&&dj.byId("po-freight-charges").store&&dj.byId("po-freight-charges").store!=null&&dj.byId("po-freight-charges").store._arrayOfAllItems.length>0){if(dj.byId("po-freight-charges").grid&&dj.byId("po-freight-charges").grid.store){dj.byId("po-freight-charges").grid.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(dj.byId("total_cur_code"),function(_79,_7a){d.forEach(_79,function(_7b){dj.byId("po-freight-charges").grid.store.setValue(_7b,"cur_code",dj.byId("total_cur_code").get("value"));},dj.byId("po-freight-charges"));})});}}};var _7c=function(){dj.byId("total_cur_code").set("value",dj.byId("line-items").store._arrayOfAllItems[0].price_cur_code);};m.dialog.show("CONFIRMATION",_6b,"","","","",_6e,_7c);}}}};})(dojo,dijit,misys);dojo.require("misys.client.binding.openaccount.create_ea_client");}