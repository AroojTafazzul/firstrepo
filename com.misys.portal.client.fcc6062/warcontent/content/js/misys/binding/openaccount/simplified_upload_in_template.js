/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.openaccount.simplified_upload_in_template"]){dojo._hasResource["misys.binding.openaccount.simplified_upload_in_template"]=true;dojo.provide("misys.binding.openaccount.simplified_upload_in_template");dojo.require("dojo.data.ItemFileReadStore");dojo.require("dijit.form.FilteringSelect");dojo.require("misys.validation.login");dojo.require("misys.validation.password");dojo.require("misys.form.MultiSelect");dojo.require("dijit.form.Select");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.ValidationTextBox");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("dojox.xml.DomParser");dojo.require("misys.openaccount.FormOpenAccountEvents");(function(d,dj,m){d.mixin(m,{bind:function(){misys.connect("name","onBlur",_1);misys.connect("mapping_fixed","onClick",_2);misys.connect("mapping_delimited","onClick",_2);misys.connect("delimiter","onChange",_3);misys.connect("user_list","onClick",_4);misys.connect("start","onBlur",_5);misys.connect("format_length","onBlur",_5);misys.connect("date_format_select","onChange",_5);misys.connect("amount_format_select","onChange",_5);misys.connect("date_format_other","onBlur",_5);misys.connect("amount_format_other","onBlur",_5);misys.connect("add_column","onClick",_6);misys.connect("remove_column","onClick",_7);m.connect("delimiter","onChange",function(){if(dj.byId("amount_format_select")){m.changeAmountFormatSelectField();}});var _8=dj.byId("mapping_fixed");var _9=dj.byId("mapping_delimited");if(_8&&_8.get("checked")===false&&dj.byId("mapping_delimited").get("checked")===false){_8.set("checked",true);_8.onClick();}else{if(_8&&_8.get("checked")===true){_8.onClick();}else{if(_9&&_9.get("checked")===true){_9.onClick();}}}misys.connect("move_column_up_img","onClick",_a);misys.connect("move_column_down_img","onClick",_a);},onFormLoad:function(){var _b=dj.byId("hidden_delimiter").get("value"),_c=dj.byId("mapping_fixed"),_d=misys._config.matchedColumn;amountFormatField=dj.byId("amount_format_select");if(_d==="Y"){_e(d.byId("column_amount_format_div"));_e(d.byId("column_date_format_div"));_e(d.byId("column_start_length_div"));_f();dj.byId("date_format_select").onChange();if(_c&&_c.get("checked")===true){_c.onClick();}else{var _10=dj.byId("delimiter");var _11=dj.byId("delimiter_text");if("S"+_b!=="S"){_10?_10.onChange():null;if(_10&&_b!=="comma"&&_b!==";"&&_b!=="tab"&&_b!==";;"){_10.set("value","OTHER");_11.set("value",_b);}}else{if(_10&&_11){_10.set("value","OTHER");_11.set("value",_b);}}}}else{if(d.byId("disclaimer")){d.byId("disclaimer").style.display="block";}}},beforeSubmitValidations:function(){var _12=true,_13=dj.byId("mapping_delimited"),_14=dj.byId("mapping_fixed"),_15=dj.byId("delimiter"),_16=dj.byId("delimiter_text"),_17=dj.byId("user_list");if(_18()){m._config.onSubmitErrorMsg=m.getLocalization("selectAdjustmentExpiry");return false;}if(_13&&_13.get("checked")===true){if("S"+_15.get("value")==="S"){displayMessage=misys.getLocalization("uploadTemplateDelimiterRequired");_15.set("state","Error");dj.hideTooltip(_15.domNode);dj.showTooltip(displayMessage,_15.domNode,0);return false;}if(_15.get("value")==="OTHER"&&"S"+_16.get("value")==="S"){displayMessage=misys.getLocalization("uploadTemplateDelimiterTextRequired");_16.set("state","Error");dj.hideTooltip(_16.domNode);dj.showTooltip(displayMessage,_16.domNode,0);return false;}}if(!_19()){return false;}if(_13&&_13.get("checked")&&!m.validateDateAmountFormatFields()){return false;}if(_14&&_14.get("checked")&&!_1a()){return false;}return _12;}});d.mixin(m._config,{xmlTransform:function(xml){var _1b=m._config.xmlTagName,_1c=_1b?["<",_1b,">"]:[],dom=dojox.xml.DomParser.parse(xml),_1d=dj.byId("user_list");_1c.push("<brch_code>","00001","</brch_code>");_1c.push(m.getDomNode(dom,"upload_template_id"));_1c.push(m.getDomNode(dom,"name"));_1c.push(m.getDomNode(dom,"description"));_1c.push(m.getDomNode(dom,"mapping"));_1c.push(m.getDomNode(dom,"delimiter"));_1c.push(m.getDomNode(dom,"delimiter_text"));_1c.push(m.getDomNode(dom,"executable"));d.forEach(d.query("option",_1d.domNode),function(_1e){_1c.push("<column>",_1e.value,"</column>");});_1c.push(_1f(_1d));_1c.push(m.getDomNode(dom,"product_code"));if(_1b){_1c.push("</",_1b,">");}return _1c.join("");}});d.ready(function(){m._config.clearOnSecondCall=false;});function _3(){var _20=dj.byId("delimiter"),_21=dj.byId("delimiter_text"),_22=d.byId("delimiter_text_div");if(_20.get("value")==="OTHER"){_23(_22);}else{_e(_22);_21.set("value","");}};function _6(){var _24=dj.byId("avail_mapped_columns_list_nosend"),_25=dj.byId("user_list"),_26=_24.domNode.selectedIndex,_27,_28;if(_26===-1){return;}else{while(_26!==-1){_27=_24.domNode[_26];_28=_27.value;if(_28!=="ignored_column"){d.byId("user_list").appendChild(_27);}else{var c=dojo.doc.createElement("option");c.innerHTML=_27.innerHTML;c.value=_28;c.className=_27.className;c.text=_27.text;d.byId("user_list").appendChild(c);_24.domNode[_26].selected=false;}m._config.mappedColumns[_28].dataType=m._config.arrColumn[_28][0];m._config.mappedColumns[_28].key=m._config.arrColumn[_28][1];_26=_24.domNode.selectedIndex;}}};function _7(){var _29=dj.byId("avail_mapped_columns_list_nosend"),_2a=dj.byId("user_list"),_2b=d.byId("column_start_length_div"),_2c=d.byId("column_amount_format_div"),_2d=d.byId("column_date_format_div"),_2e=_2a.domNode.selectedIndex,_2f,_30;if(_2e===-1){return;}else{_2f=_2a.domNode.options[_2e];_30=_2f.value;}if(_30.indexOf("ignored_column")===-1){_29.addSelected(_2a);}else{_2a.containerNode.remove(_2e);}_31(_2b);_31(_2c);_31(_2d);};function _4(){var _32=dj.byId("start"),_33=dj.byId("format_length"),_34=dj.byId("date_format_select"),_35=dj.byId("date_format_other"),_36=dj.byId("amount_format_select"),_37=dj.byId("amount_format_other"),_38=d.byId("column_start_length_div"),_39=d.byId("column_amount_format_div"),_3a=d.byId("column_date_format_div"),_3b=d.byId("unit_code_div"),_3c=d.byId("payment_term_code_div"),_3d=d.byId("fscm_programme_code_div"),_3e=this.containerNode.options.selectedIndex,_3f,_40,_41;if(_3e===-1){_31(_38);_e(_39);_e(_3a);return;}else{_3f=this.domNode.options[_3e];_40=_3f.value;_41=m._config.mappedColumns[_40];}if(dj.byId("mapping_fixed")&&dj.byId("mapping_fixed").get("checked")){_42(_38);}else{_31(_38);}if(_41){_32.set("value",_41.start);_33.set("value",_41.formatLength);_34.set("value",_41.dateFormat);_35.set("value",_41.dateFormatText);_36.set("value",_41.amountFormat);_37.set("value",_41.amountFormatText);_43(_41.dataType);}};function _5(){var _44=this.get("name"),_45=dj.byId("user_list"),_46=dj.byId("start"),_47=_45.domNode.selectedIndex,_48,_49,_4a;if(_47===-1){return;}else{_48=_45.domNode.options[_47];_49=_48.value;_4a=m._config.mappedColumns[_49];}if(_4a){switch(_44){case "start":_4a.start=this.get("value");break;case "format_length":_4a.formatLength=this.get("value");break;case "date_format_select":_4a.dateFormat=this.get("value");_4b(this);break;case "date_format_other":_4a.dateFormatText=this.get("value");break;case "amount_format_select":if(this.get("value")!==""){_4a.amountFormat=this.get("value");}else{dijit.byId("delimiter").onChange();}_4b(this);break;case "amount_format_other":_4a.amountFormatText=this.get("value");break;default:undefined;break;}}};function _43(_4c){var _4d=d.byId("column_amount_format_div"),_4e=d.byId("column_date_format_div"),_4f=dj.byId("user_list"),_50=_4f.domNode.selectedIndex,_51=_4f.domNode.options[_50],_52=_51.value;if(_4c==="Date"){_23(_4e);_e(_4d);dj.byId("date_format_select").onChange();}else{if(_4c==="Number"&&_52!=="line_item_qty_val"&&_52!=="payment_term_nb_days"){_23(_4d);_e(_4e);dj.byId("amount_format_select").onChange();}else{_e(_4d);_e(_4e);}}};function _4b(_53){var _54=d.byId(_53.get("name")+"_other_div");if(_53.get("name")==="date_format_select"){if(_53.get("value")==="OTHER"){dojo.removeClass(_54,"hide");}else{d.addClass(_54,"hide");}}else{if(_53.get("name")==="amount_format_select"){if(_53.get("value")==="OTHER"){d.removeClass(_54,"hide");}else{d.addClass(_54,"hide");}}}};function _1(){var _55;if(dj.byId("name")){_55=dj.byId("name");}if(_55&&_55.get("value")!==""&&!m.checkUploadTemplateNameExists()){var _56=m.getLocalization("uploadTemplateNameExists",[_55.get("value")]);_55.focus();_55.set("state","Error");dj.hideTooltip(_55.domNode);dj.showTooltip(_56,_55.domNode,0);}};function _2(){var _57=d.byId("column_start_length_div"),_58=dj.byId("user_list"),_59=_58.domNode.selectedIndex,_5a=d.byId("delimiter_select_div"),_5b=d.byId("delimiter_text_div");if(this.get("checked")===true){if(this.get("value")==="fixed"){if(_59!==-1){_42(_57);}else{_31(_57);}_e(_5a);_e(_5b);}else{if(this.get("value")==="delimited"){_31(_57);_23(_5a);if(m._config.clearOnSecondCall){dj.byId("delimiter").set("value","");dj.byId("delimiter_text").set("value","");}m._config.clearOnSecondCall=true;}}}};function _f(){var _5c=dj.byId("avail_mapped_columns_list_nosend"),_5d=dj.byId("user_list");d.forEach(_5c.domNode.options,function(_5e){if(m._config.arrColumn[_5e.value]&&m._config.arrColumn[_5e.value][1]===true){_5e.className="ipUploadTemplateMandatoryColumn";}});d.forEach(_5d.domNode.options,function(_5f){if(m._config.arrColumn[_5f.value]&&m._config.arrColumn[_5f.value][1]===true){_5f.className="ipUploadTemplateMandatoryColumn";}});};function _a(){var _60=dj.byId("user_list"),_61=_60.domNode.selectedIndex,_62,_63;if(_61!==-1){_62=_60.domNode.options[_61];_63=_62.value;}if(this.id==="move_column_up_img"){if(_61===-1||_61===0){return;}_60.containerNode.remove(_61);if(dojo.isIE){_60.containerNode.add(_62,_61-1);}else{_60.containerNode.add(_62,_60.domNode.options[_61-1]);}}else{if(this.id==="move_column_down_img"){if(_61===-1||_61===_60.domNode.length-1){return;}_60.containerNode.remove(_61);if(_61>_60.domNode.length){_60.containerNode.appendChild(_62);}else{if(dojo.isIE){_60.containerNode.add(_62,_61+1);}else{_60.containerNode.add(_62,_60.domNode.options[_61+1]);}}}}};function _e(div){d.removeClass(div,"inlineBlock");d.addClass(div,"hide");};function _23(div){d.removeClass(div,"hide");d.addClass(div,"inlineBlock");};function _31(div){d.removeClass(div,"inline-group");d.addClass(div,"hide");};function _42(div){d.removeClass(div,"hide");d.addClass(div,"inline-group");};function _1f(_64){var _65=[];d.forEach(d.query("option",_64.domNode),function(_66){_65.push("<",_66.value,"_key>",m._config.mappedColumns[_66.value].key,"</",_66.value,"_key>");_65.push("<",_66.value,"_type>",m._config.mappedColumns[_66.value].dataType,"</",_66.value,"_type>");_65.push("<",_66.value,"_start>",m._config.mappedColumns[_66.value].start,"</",_66.value,"_start>");_65.push("<",_66.value,"_length>",m._config.mappedColumns[_66.value].formatLength,"</",_66.value,"_length>");_65.push("<",_66.value,"_minlength>",m._config.mappedColumns[_66.value].minLength,"</",_66.value,"_minlength>");_65.push("<",_66.value,"_maxlength>",m._config.mappedColumns[_66.value].maxLength,"</",_66.value,"_maxlength>");if(m._config.mappedColumns[_66.value].dataType==="Date"){_65.push("<",_66.value,"_format>",m._config.mappedColumns[_66.value].dateFormat,"</",_66.value,"_format>");_65.push("<",_66.value,"_format_text>",m._config.mappedColumns[_66.value].dateFormatText,"</",_66.value,"_format_text>");}else{if(m._config.mappedColumns[_66.value].dataType==="Number"){_65.push("<",_66.value,"_format>",m._config.mappedColumns[_66.value].amountFormat,"</",_66.value,"_format>");_65.push("<",_66.value,"_format_text>",m._config.mappedColumns[_66.value].amountFormatText,"</",_66.value,"_format_text>");}}});return _65.join("");};function _19(){var _67=dj.byId("avail_mapped_columns_list_nosend"),_68=[],_69=true;d.forEach(d.query("option",_67.domNode),function(_6a){if(m._config.arrColumn[_6a.value]&&m._config.arrColumn[_6a.value][1]===true){_68.push(_6a.value);}});if(_68.length>0){_69=false;displayMessage=misys.getLocalization("selectAllUploadTemplateKeyColumns");dj.hideTooltip(_67.domNode);dj.showTooltip(displayMessage,_67.domNode,0);}else{dj.hideTooltip(_67.domNode);}return _69;};function _6b(){var _6c=dj.byId("user_list");if(_6c){if((_6c.get("value").indexOf("payment_term_cur_code")!==-1&&_6c.get("value").indexOf("payment_term_amt")!==-1&&_6c.get("value").indexOf("payment_term_pct")===-1)){m._config.arrColumn["payment_term_pct"][1]=false;}else{if(_6c.get("value").indexOf("payment_term_pct")!==-1&&_6c.get("value").indexOf("payment_term_cur_code")===-1&&_6c.get("value").indexOf("payment_term_amt")===-1){m._config.arrColumn["payment_term_cur_code"][1]=false;m._config.arrColumn["payment_term_amt"][1]=false;}}}};function _1a(){var _6d=dj.byId("user_list"),_6e=true,_6f=dj.byId("start"),_70=dj.byId("format_length"),_71=dj.byId("date_format_select"),_72=dj.byId("amount_format_select"),_73=dj.byId("date_format_other"),_74=dj.byId("amount_format_other"),_75=false;d.some(d.query("option",_6d.domNode),function(_76,_77){var _78=[];if("S"+m._config.mappedColumns[_76.value].start==="S"){_78.push(_6f);_75=true;_6e=false;}if("S"+m._config.mappedColumns[_76.value].length==="S"){_78.push(_70);_75=true;_6e=false;}if(m._config.mappedColumns[_76.value].dataType==="Date"){if("S"+m._config.mappedColumns[_76.value].dateFormat==="S"){_78.push(_71);_75=true;_6e=false;}else{if(m._config.mappedColumns[_76.value].dateFormat==="OTHER"&&("S"+m._config.mappedColumns[_76.value].dateFormatText==="S")){_78.push(_73);_75=true;_6e=false;}}}else{if(m._config.mappedColumns[_76.value].dataType==="Number"){if("S"+m._config.mappedColumns[_76.value].amountFormat==="S"){_78.push(_72);_75=true;_6e=false;}else{if(m._config.mappedColumns[_76.value].amountFormat==="OTHER"&&("S"+m._config.mappedColumns[_76.value].amountFormatText==="S")){_78.push(_74);_75=true;_6e=false;}}}}if(_75){dj.byId("user_list").domNode.options.selectedIndex=_77;dj.byId("user_list").onClick();m.markErrorFields(_78);}return _75;});return _6e;};function _18(){var _79=dj.byId("avail_mapped_columns_list_nosend"),_7a=dj.byId("user_list");if((_7a.get("value").indexOf("discount_exp_date")===-1&&_79.get("value").indexOf("discount_exp_date")===-1)||((_7a.get("value").indexOf("total_adjustments")===-1&&_7a.get("value").indexOf("discount_exp_date")===-1)||(_7a.get("value").indexOf("total_adjustments")!=-1&&_7a.get("value").indexOf("discount_exp_date")!=-1))){return false;}return true;};})(dojo,dijit,misys);dojo.require("misys.client.binding.openaccount.simplified_upload_in_template_client");}