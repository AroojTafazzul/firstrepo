/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.openaccount.upload_template"]){dojo._hasResource["misys.binding.openaccount.upload_template"]=true;dojo.provide("misys.binding.openaccount.upload_template");dojo.require("dojo.data.ItemFileReadStore");dojo.require("dijit.form.FilteringSelect");dojo.require("misys.validation.login");dojo.require("misys.validation.password");dojo.require("misys.form.MultiSelect");dojo.require("dijit.form.Select");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.ValidationTextBox");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("dojox.xml.DomParser");dojo.require("misys.openaccount.FormOpenAccountEvents");(function(d,dj,m){d.mixin(m,{bind:function(){misys.connect("name","onBlur",_1);misys.connect("mapping_fixed","onClick",_2);misys.connect("mapping_delimited","onClick",_2);misys.connect("delimiter","onChange",_3);misys.connect("user_list","onClick",_4);misys.connect("start","onBlur",_5);misys.connect("format_length","onBlur",_5);misys.connect("date_format_select","onChange",_5);misys.connect("amount_format_select","onChange",_5);misys.connect("date_format_other","onBlur",_5);misys.connect("amount_format_other","onBlur",_5);misys.connect("add_column","onClick",_6);misys.connect("remove_column","onClick",_7);var _8=dj.byId("mapping_fixed");var _9=dj.byId("mapping_delimited");if(_8&&_8.get("checked")===false&&dj.byId("mapping_delimited").get("checked")===false){_8.set("checked",true);_8.onClick();}else{if(_8&&_8.get("checked")===true){_8.onClick();}else{if(_9&&_9.get("checked")===true){_9.onClick();}}}misys.connect("move_column_up_img","onClick",_a);misys.connect("move_column_down_img","onClick",_a);},onFormLoad:function(){var _b=dj.byId("hidden_delimiter").get("value"),_c=dj.byId("mapping_fixed"),_d=misys._config.matchedColumn;if(_d==="Y"){_e(d.byId("column_amount_format_div"));_e(d.byId("column_date_format_div"));_e(d.byId("column_start_length_div"));_f();dj.byId("date_format_select").onChange();if(_c&&_c.get("checked")===true){_c.onClick();}else{var _10=dj.byId("delimiter");var _11=dj.byId("delimiter_text");if("S"+_b!=="S"){_10?_10.onChange():null;if(_10&&_b!=="comma"&&_b!==";"&&_b!=="tab"&&_b!==";;"){_10.set("value","OTHER");_11.set("value",_b);}}else{if(_10&&_11){_10.set("value","OTHER");_11.set("value",_b);}}}}else{if(d.byId("disclaimer")){d.byId("disclaimer").style.display="block";}}},beforeSubmitValidations:function(){var _12=true,_13=dj.byId("mapping_delimited"),_14=dj.byId("mapping_fixed"),_15=dj.byId("delimiter"),_16=dj.byId("delimiter_text");if(_13&&_13.get("checked")===true){if("S"+_15.get("value")==="S"){displayMessage=misys.getLocalization("uploadTemplateDelimiterRequired");_15.set("state","Error");dj.hideTooltip(_15.domNode);dj.showTooltip(displayMessage,_15.domNode,0);return false;}if(_15.get("value")==="OTHER"&&"S"+_16.get("value")==="S"){displayMessage=misys.getLocalization("uploadTemplateDelimiterTextRequired");_16.set("state","Error");dj.hideTooltip(_16.domNode);dj.showTooltip(displayMessage,_16.domNode,0);return false;}}_17();_18();if(_19()){m._config.onSubmitErrorMsg=m.getLocalization("selectTaxDetails");return false;}if(_1a()){m._config.onSubmitErrorMsg=m.getLocalization("selectFreightChargeDetails");return false;}if(!_1b()){return false;}if(_14&&_14.get("checked")===true){if(!_1c()){return false;}}if(_13&&_13.get("checked")&&(!m.validateDateAmountFormatFields())){return false;}return _12;},helpQuantityCodesDialog:function(){m.dialog.show("HTML",d.byId("quantity_code_help_container").innerHTML,m.getLocalization("helpQuantityCodesDialogTitle"));},helpPaymentTermCodesDialog:function(){m.dialog.show("HTML",d.byId("payment_term_code_help_container").innerHTML,m.getLocalization("helpPaymentTermCodesDialogTitle"));},helpAdjustmentTypesDialog:function(){m.dialog.show("HTML",d.byId("adjustment_type_help_container").innerHTML,m.getLocalization("helpAdjustmentTypesDialogTitle"));},helpAdjustmentDirectionDialog:function(){m.dialog.show("HTML",d.byId("adjustment_dir_help_container").innerHTML,m.getLocalization("helpAdjustmentDirectionDialogTitle"));},helpTaxTypeDialog:function(){m.dialog.show("HTML",d.byId("tax_type_help_container").innerHTML,m.getLocalization("helpTaxTypeDialogTitle"));},helpFreightChargeTypeDialog:function(){m.dialog.show("HTML",d.byId("freight_charge_type_help_container").innerHTML,m.getLocalization("helpFreightChargeTypeDialogTitle"));},helpFSCMProgCodesDialog:function(){m.dialog.show("HTML",d.byId("fscm_programme_code_help_container").innerHTML,m.getLocalization("helpFSCMProgCodesDialogTitle"));}});d.mixin(m._config,{xmlTransform:function(xml){var _1d=m._config.xmlTagName,_1e=_1d?["<",_1d,">"]:[],dom=dojox.xml.DomParser.parse(xml),_1f=dj.byId("user_list");_1e.push("<brch_code>","00001","</brch_code>");_1e.push(m.getDomNode(dom,"upload_template_id"));_1e.push(m.getDomNode(dom,"name"));_1e.push(m.getDomNode(dom,"description"));_1e.push(m.getDomNode(dom,"mapping"));_1e.push(m.getDomNode(dom,"delimiter"));_1e.push(m.getDomNode(dom,"delimiter_text"));_1e.push(m.getDomNode(dom,"executable"));d.forEach(d.query("option",_1f.domNode),function(_20){_1e.push("<column>",_20.value,"</column>");});_1e.push(_21(_1f));_1e.push(m.getDomNode(dom,"product_code"));if(_1d){_1e.push("</",_1d,">");}return _1e.join("");}});d.ready(function(){m._config.clearOnSecondCall=false;});function _3(){var _22=dj.byId("delimiter"),_23=dj.byId("delimiter_text"),_24=d.byId("delimiter_text_div");if(_22.get("value")==="OTHER"){_25(_24);}else{_e(_24);_23.set("value","");}};function _6(){var _26=dj.byId("avail_mapped_columns_list_nosend"),_27=dj.byId("user_list"),_28=_26.domNode.selectedIndex,_29,_2a;if(_28===-1){return;}else{while(_28!=-1){_29=_26.domNode[_28];_2a=_29.value;if(_2a!="ignored_column"){if(_2a==="payment_term_pct"&&(_27.get("value").indexOf("payment_term_cur_code")!=-1||_27.get("value").indexOf("payment_term_amt")!=-1)){m.dialog.show("ERROR",misys.getLocalization("selectPaymentTerm"),"Error");return;}else{if(_2a==="payment_term_cur_code"&&_27.get("value").indexOf("payment_term_pct")!=-1){m.dialog.show("ERROR",misys.getLocalization("selectPaymentTerm"),"Error");return;}else{if(_2a==="payment_term_amt"&&_27.get("value").indexOf("payment_term_pct")!=-1){m.dialog.show("ERROR",misys.getLocalization("selectPaymentTerm"),"Error");return;}else{if(_2a==="adjustment_percentage"&&(_27.get("value").indexOf("adjustment_cur_code")!=-1||_27.get("value").indexOf("adjustment_amt")!=-1)){m.dialog.show("ERROR",misys.getLocalization("selectAdjustment"),"Error");return;}else{if(_2a==="adjustment_cur_code"&&_27.get("value").indexOf("adjustment_percentage")!=-1){m.dialog.show("ERROR",misys.getLocalization("selectAdjustment"),"Error");return;}else{if(_2a==="adjustment_amt"&&_27.get("value").indexOf("adjustment_percentage")!=-1){m.dialog.show("ERROR",misys.getLocalization("selectAdjustment"),"Error");return;}else{if(_2a==="tax_percentage"&&(_27.get("value").indexOf("tax_cur_code")!=-1||_27.get("value").indexOf("tax_amt")!=-1)){m.dialog.show("ERROR",misys.getLocalization("selectTax"),"Error");return;}else{if(_2a==="tax_cur_code"&&_27.get("value").indexOf("tax_percentage")!=-1){m.dialog.show("ERROR",misys.getLocalization("selectTax"),"Error");return;}else{if(_2a==="tax_amt"&&_27.get("value").indexOf("tax_percentage")!=-1){m.dialog.show("ERROR",misys.getLocalization("selectTax"),"Error");return;}else{if(_2a==="freight_charge_percentage"&&(_27.get("value").indexOf("freight_charge_cur_code")!=-1||_27.get("value").indexOf("freight_charge_amt")!=-1)){m.dialog.show("ERROR",misys.getLocalization("selectFreightCharge"),"Error");return;}else{if(_2a==="freight_charge_cur_code"&&_27.get("value").indexOf("freight_charge_percentage")!=-1){m.dialog.show("ERROR",misys.getLocalization("selectFreightCharge"),"Error");return;}else{if(_2a==="freight_charge_amt"&&_27.get("value").indexOf("freight_charge_percentage")!=-1){m.dialog.show("ERROR",misys.getLocalization("selectFreightCharge"),"Error");return;}else{d.byId("user_list").appendChild(_29);}}}}}}}}}}}}}else{var c=dojo.doc.createElement("option");c.innerHTML=_29.innerHTML;c.value=_2a;c.className=_29.className;c.text=_29.text;d.byId("user_list").appendChild(c);_26.domNode[_28].selected=false;}m._config.mappedColumns[_2a].dataType=m._config.arrColumn[_2a][0];m._config.mappedColumns[_2a].key=m._config.arrColumn[_2a][1];_28=_26.domNode.selectedIndex;}}};function _7(){var _2b=dj.byId("avail_mapped_columns_list_nosend"),_2c=dj.byId("user_list"),_2d=d.byId("column_start_length_div"),_2e=d.byId("column_amount_format_div"),_2f=d.byId("column_date_format_div"),_30=_2c.domNode.selectedIndex,_31,_32;if(_30==-1){return;}else{_31=_2c.domNode.options[_30];_32=_31.value;}if(_32.indexOf("ignored_column")===-1){_2b.addSelected(_2c);}else{_2c.containerNode.remove(_30);}_33(_2d);_33(_2e);_33(_2f);};function _4(){var _34=dj.byId("start"),_35=dj.byId("format_length"),_36=dj.byId("date_format_select"),_37=dj.byId("date_format_other"),_38=dj.byId("amount_format_select"),_39=dj.byId("amount_format_other"),_3a=d.byId("column_start_length_div"),_3b=d.byId("column_amount_format_div"),_3c=d.byId("column_date_format_div"),_3d=d.byId("unit_code_div"),_3e=d.byId("payment_term_code_div"),_3f=d.byId("adjustment_type_div"),_40=d.byId("adjustment_dir_div"),_41=d.byId("fscm_programme_code_div"),_42=d.byId("tax_type_div"),_43=d.byId("freight_charge_type_div"),_44=this.containerNode.options.selectedIndex,_45,_46,_47;if(_44==-1){_33(_3a);_e(_3b);_e(_3c);return;}else{_45=this.domNode.options[_44];_46=_45.value;if(_46==="line_item_qty_unit_measr_code"){_48(_3d);}else{_33(_3d);}if(_46==="payment_term_code"){_48(_3e);}else{_33(_3e);}if(_46==="adjustment_type"){_48(_3f);}else{_33(_3f);}if(_46==="adjustment_direction"){_48(_40);}else{_33(_40);}if(_46==="fscm_programme_code"){_48(_41);}else{_33(_41);}if(_46==="tax_type"){_48(_42);}else{_33(_42);}if(_46==="freight_charge_type"){_48(_43);}else{_33(_43);}_47=m._config.mappedColumns[_46];}if(dj.byId("mapping_fixed")&&dj.byId("mapping_fixed").get("checked")){_48(_3a);}else{_33(_3a);}if(_47){_34.set("value",_47.start);_35.set("value",_47.formatLength);_36.set("value",_47.dateFormat);_37.set("value",_47.dateFormatText);_38.set("value",_47.amountFormat);_39.set("value",_47.amountFormatText);_49(_47.dataType);}};function _5(){var _4a=this.get("name"),_4b=dj.byId("user_list"),_4c=dj.byId("start"),_4d=_4b.domNode.selectedIndex,_4e,_4f,_50;if(_4d==-1){return;}else{_4e=_4b.domNode.options[_4d];_4f=_4e.value;_50=m._config.mappedColumns[_4f];}if(_50){switch(_4a){case "start":_50.start=this.get("value");break;case "format_length":_50.formatLength=this.get("value");break;case "date_format_select":_50.dateFormat=this.get("value");_51(this);break;case "date_format_other":_50.dateFormatText=this.get("value");break;case "amount_format_select":_50.amountFormat=this.get("value");_51(this);break;case "amount_format_other":_50.amountFormatText=this.get("value");break;default:undefined;break;}}};function _49(_52){var _53=d.byId("column_amount_format_div"),_54=d.byId("column_date_format_div"),_55=dj.byId("user_list"),_56=_55.domNode.selectedIndex,_57=_55.domNode.options[_56],_58=_57.value;if(_52==="Date"){_25(_54);_e(_53);dj.byId("date_format_select").onChange();}else{if(_52==="Number"&&_58!=="payment_term_nb_days"){_25(_53);_e(_54);dj.byId("amount_format_select").onChange();}else{_e(_53);_e(_54);}}};function _51(_59){var _5a=d.byId(_59.get("name")+"_other_div");if(_59.get("name")==="date_format_select"){if(_59.get("value")==="OTHER"){dojo.removeClass(_5a,"hide");}else{d.addClass(_5a,"hide");}}else{if(_59.get("name")==="amount_format_select"){if(_59.get("value")==="OTHER"){d.removeClass(_5a,"hide");}else{d.addClass(_5a,"hide");}}}};function _1(){var _5b;if(dj.byId("name")){_5b=dj.byId("name");}if(_5b&&_5b.get("value")!==""&&!m.checkUploadTemplateNameExists()){var _5c=m.getLocalization("uploadTemplateNameExists",[_5b.get("value")]);_5b.focus();_5b.set("state","Error");dj.hideTooltip(_5b.domNode);dj.showTooltip(_5c,_5b.domNode,0);}};function _2(){var _5d=d.byId("column_start_length_div"),_5e=dj.byId("user_list"),_5f=_5e.domNode.selectedIndex,_60=d.byId("delimiter_select_div"),_61=d.byId("delimiter_text_div");if(this.get("checked")===true){if(this.get("value")==="fixed"){if(_5f!==-1){_48(_5d);}else{_33(_5d);}_e(_60);_e(_61);}else{if(this.get("value")==="delimited"){_33(_5d);_25(_60);if(m._config.clearOnSecondCall){dj.byId("delimiter").set("value","");dj.byId("delimiter_text").set("value","");}m._config.clearOnSecondCall=true;}}}};function _f(){var _62=dj.byId("avail_mapped_columns_list_nosend"),_63=dj.byId("user_list");d.forEach(_62.domNode.options,function(_64){if(m._config.arrColumn[_64.value]&&m._config.arrColumn[_64.value][1]===true){_64.className="ipUploadTemplateMandatoryColumn";}});d.forEach(_63.domNode.options,function(_65){if(m._config.arrColumn[_65.value]&&m._config.arrColumn[_65.value][1]===true){_65.className="ipUploadTemplateMandatoryColumn";}});};function _a(){var _66=dj.byId("user_list"),_67=_66.domNode.selectedIndex,_68,_69;if(_67!==-1){_68=_66.domNode.options[_67];_69=_68.value;}if(this.id==="move_column_up_img"){if(_67===-1||_67===0){return;}_66.containerNode.remove(_67);if(dojo.isIE){_66.containerNode.add(_68,_67-1);}else{_66.containerNode.add(_68,_66.domNode.options[_67-1]);}}else{if(this.id==="move_column_down_img"){if(_67===-1||_67===_66.domNode.length-1){return;}_66.containerNode.remove(_67);if(_67>_66.domNode.length){_66.containerNode.appendChild(_68);}else{if(dojo.isIE){_66.containerNode.add(_68,_67+1);}else{_66.containerNode.add(_68,_66.domNode.options[_67+1]);}}}}};function _e(div){d.removeClass(div,"inlineBlock");d.addClass(div,"hide");};function _25(div){d.removeClass(div,"hide");d.addClass(div,"inlineBlock");};function _33(div){d.removeClass(div,"inline-group");d.addClass(div,"hide");};function _48(div){d.removeClass(div,"hide");d.addClass(div,"inline-group");};function _21(_6a){var _6b=[];d.forEach(d.query("option",_6a.domNode),function(_6c){_6b.push("<",_6c.value,"_key>",m._config.mappedColumns[_6c.value].key,"</",_6c.value,"_key>");_6b.push("<",_6c.value,"_type>",m._config.mappedColumns[_6c.value].dataType,"</",_6c.value,"_type>");_6b.push("<",_6c.value,"_start>",m._config.mappedColumns[_6c.value].start,"</",_6c.value,"_start>");_6b.push("<",_6c.value,"_length>",m._config.mappedColumns[_6c.value].formatLength,"</",_6c.value,"_length>");_6b.push("<",_6c.value,"_minlength>",m._config.mappedColumns[_6c.value].minLength,"</",_6c.value,"_minlength>");_6b.push("<",_6c.value,"_maxlength>",m._config.mappedColumns[_6c.value].maxLength,"</",_6c.value,"_maxlength>");if(m._config.mappedColumns[_6c.value].dataType==="Date"){_6b.push("<",_6c.value,"_format>",m._config.mappedColumns[_6c.value].dateFormat,"</",_6c.value,"_format>");_6b.push("<",_6c.value,"_format_text>",m._config.mappedColumns[_6c.value].dateFormatText,"</",_6c.value,"_format_text>");}else{if(m._config.mappedColumns[_6c.value].dataType==="Number"){_6b.push("<",_6c.value,"_format>",m._config.mappedColumns[_6c.value].amountFormat,"</",_6c.value,"_format>");_6b.push("<",_6c.value,"_format_text>",m._config.mappedColumns[_6c.value].amountFormatText,"</",_6c.value,"_format_text>");}}});return _6b.join("");};function _1b(){var _6d=dj.byId("avail_mapped_columns_list_nosend"),_6e=[],_6f=true;d.forEach(d.query("option",_6d.domNode),function(_70){if(m._config.arrColumn[_70.value]&&m._config.arrColumn[_70.value][1]===true){_6e.push(_70.value);}});if(_6e.length>0){_6f=false;displayMessage=misys.getLocalization("selectAllUploadTemplateKeyColumns");dj.hideTooltip(_6d.domNode);dj.showTooltip(displayMessage,_6d.domNode,0);}else{dj.hideTooltip(_6d.domNode);}return _6f;};function _17(){var _71=dj.byId("user_list");if(_71){if((_71.get("value").indexOf("payment_term_cur_code")!=-1&&_71.get("value").indexOf("payment_term_amt")!=-1&&_71.get("value").indexOf("payment_term_pct")===-1)){m._config.arrColumn["payment_term_pct"][1]=false;}else{if(_71.get("value").indexOf("payment_term_pct")!=-1&&_71.get("value").indexOf("payment_term_cur_code")===-1&&_71.get("value").indexOf("payment_term_amt")===-1){m._config.arrColumn["payment_term_cur_code"][1]=false;m._config.arrColumn["payment_term_amt"][1]=false;}}}};function _18(){var _72=dj.byId("user_list");if(_72){if((_72.get("value").indexOf("adjustment_cur_code")!=-1&&_72.get("value").indexOf("adjustment_amt")!=-1&&_72.get("value").indexOf("adjustment_percentage")===-1)){m._config.arrColumn["adjustment_percentage"][1]=false;}else{if(_72.get("value").indexOf("adjustment_percentage")!=-1&&_72.get("value").indexOf("adjustment_cur_code")===-1&&_72.get("value").indexOf("adjustment_amt")===-1){m._config.arrColumn["adjustment_cur_code"][1]=false;m._config.arrColumn["adjustment_amt"][1]=false;}}}};function _1c(){var _73=dj.byId("user_list"),_74=true,_75=dj.byId("start"),_76=dj.byId("format_length"),_77=dj.byId("date_format_select"),_78=dj.byId("amount_format_select"),_79=dj.byId("date_format_other"),_7a=dj.byId("amount_format_other"),_7b=false;d.some(d.query("option",_73.domNode),function(_7c,_7d){var _7e=[];if("S"+m._config.mappedColumns[_7c.value].start==="S"){_7e.push(_75);_7b=true;_74=false;}if("S"+m._config.mappedColumns[_7c.value].length==="S"){_7e.push(_76);_7b=true;_74=false;}if(m._config.mappedColumns[_7c.value].dataType==="Date"){if("S"+m._config.mappedColumns[_7c.value].dateFormat==="S"){_7e.push(_77);_7b=true;_74=false;}else{if(m._config.mappedColumns[_7c.value].dateFormat==="OTHER"&&("S"+m._config.mappedColumns[_7c.value].dateFormatText==="S")){_7e.push(_79);_7b=true;_74=false;}}}else{if(m._config.mappedColumns[_7c.value].dataType==="Number"){if("S"+m._config.mappedColumns[_7c.value].amountFormat==="S"){_7e.push(_78);_7b=true;_74=false;}else{if(m._config.mappedColumns[_7c.value].amountFormat==="OTHER"&&("S"+m._config.mappedColumns[_7c.value].amountFormatText==="S")){_7e.push(_7a);_7b=true;_74=false;}}}}if(_7b){dj.byId("user_list").domNode.options.selectedIndex=_7d;dj.byId("user_list").onClick();_7f(_7e);}return _7b;});return _74;};function _7f(_80){var _81=misys.getLocalization("uploadTemplateValueRequired");d.forEach(_80,function(_82){_82.set("state","Error");dj.hideTooltip(_82.domNode);dj.showTooltip(_81,_82.domNode,0);});};function _19(){var _83=dj.byId("avail_mapped_columns_list_nosend"),_84=dj.byId("user_list");if(dj.byId("product_code")&&dj.byId("product_code").getValue()==="PO"){if(_84.get("value").indexOf("tax_percentage")===-1&&_84.get("value").indexOf("tax_direction")===-1&&_84.get("value").indexOf("tax_type")===-1){return false;}if(_84.get("value").indexOf("tax_amt")===-1&&_84.get("value").indexOf("tax_cur_code")===-1&&_84.get("value").indexOf("tax_type")===-1){return false;}if(_84.get("value").indexOf("tax_type")!=-1&&_84.get("value").indexOf("tax_amt")!=-1&&_84.get("value").indexOf("tax_cur_code")!=-1){return false;}if(_84.get("value").indexOf("tax_percentage")!=-1&&_84.get("value").indexOf("tax_type")!=-1){return false;}else{return true;}}else{return false;}};function _1a(){var _85=dj.byId("avail_mapped_columns_list_nosend"),_86=dj.byId("user_list");if(dj.byId("product_code")&&dj.byId("product_code").getValue()==="PO"){if(_86.get("value").indexOf("freight_charge_percentage")===-1&&_86.get("value").indexOf("freight_charge_type")===-1){return false;}if(_86.get("value").indexOf("freight_charge_amt")===-1&&_86.get("value").indexOf("freight_charge_cur_code")===-1&&_86.get("value").indexOf("freight_charge_type")===-1){return false;}if(_86.get("value").indexOf("freight_charge_type")!=-1&&_86.get("value").indexOf("freight_charge_amt")!=-1&&_86.get("value").indexOf("freight_charge_cur_code")!=-1){return false;}if(_86.get("value").indexOf("freight_charge_percentage")!=-1&&_86.get("value").indexOf("freight_charge_type")!=-1){return false;}else{return true;}}else{return false;}};})(dojo,dijit,misys);dojo.require("misys.client.binding.openaccount.upload_template_client");}