/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.openaccount.payment_oa"]){dojo._hasResource["misys.binding.openaccount.payment_oa"]=true;dojo.provide("misys.binding.openaccount.payment_oa");dojo.require("dojo.parser");dojo.require("dijit.layout.BorderContainer");dojo.require("dijit.Dialog");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dojo.data.ItemFileWriteStore");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.form.FilteringSelect");dojo.require("dijit.form.Form");dojo.require("dijit.layout.ContentPane");dojo.require("dijit.layout.TabContainer");dojo.require("dojo.io.iframe");dojo.require("dijit.ProgressBar");dojo.require("dojo.behavior");dojo.require("dojo.date.locale");dojo.require("dijit.Tooltip");dojo.require("misys.openaccount.FormOpenAccountEvents");dojo.require("misys.grid.DataGrid");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("misys.layout.FloatingPane");dojo.require("misys.openaccount.widget.LineItems");dojo.require("misys.openaccount.widget.LineItem");dojo.require("misys.openaccount.widget.ProductIdentifiers");dojo.require("misys.openaccount.widget.ProductIdentifier");dojo.require("misys.openaccount.widget.ProductCategories");dojo.require("misys.openaccount.widget.ProductCategory");dojo.require("misys.openaccount.widget.ProductCharacteristics");dojo.require("misys.openaccount.widget.ProductCharacteristic");dojo.require("misys.openaccount.widget.Adjustments");dojo.require("misys.openaccount.widget.Adjustment");dojo.require("misys.openaccount.widget.PaymentTerms");dojo.require("misys.openaccount.widget.PaymentTerm");dojo.require("misys.openaccount.widget.Taxes");dojo.require("misys.openaccount.widget.Tax");dojo.require("misys.openaccount.widget.FreightCharges");dojo.require("misys.openaccount.widget.FreightCharge");dojo.require("misys.openaccount.widget.Incoterms");dojo.require("misys.openaccount.widget.Incoterm");dojo.require("misys.openaccount.widget.CommercialDatasetDetails");dojo.require("misys.openaccount.widget.CommercialDatasetDetail");dojo.require("misys.openaccount.widget.PaymentObligations");dojo.require("misys.openaccount.widget.PaymentObligation");dojo.require("misys.openaccount.widget.ContactDetails");dojo.require("misys.openaccount.widget.ContactDetail");dojo.require("misys.openaccount.widget.SUserInformations");dojo.require("misys.openaccount.widget.SUserInformation");dojo.require("misys.openaccount.widget.BUserInformations");dojo.require("misys.openaccount.widget.BUserInformation");dojo.require("misys.openaccount.widget.TransportDocumentReferences");dojo.require("misys.openaccount.widget.TransportDocumentReference");dojo.require("misys.openaccount.widget.TransportedGoodsDetails");dojo.require("misys.openaccount.widget.TransportedGoodsDetail");dojo.require("misys.openaccount.widget.PaymentTransportFreightCharge");dojo.require("misys.openaccount.widget.PaymentTransportFreightCharges");dojo.require("misys.openaccount.widget.PaymentInsuranceRequiredClauses");dojo.require("misys.openaccount.widget.PaymentInsuranceRequiredClause");dojo.require("misys.openaccount.widget.PaymentInsuranceRequiredConditions");dojo.require("misys.openaccount.widget.PaymentInsuranceRequiredCondition");dojo.require("misys.openaccount.widget.PaymentOtherCertificateDataset");dojo.require("misys.openaccount.widget.PaymentOtherCertificateDatasets");dojo.require("misys.openaccount.widget.PaymentCertificateDatasetDetail");dojo.require("misys.openaccount.widget.PaymentCertificateDatasetDetails");dojo.require("misys.openaccount.widget.PaymentRoutingSummary");dojo.require("misys.openaccount.widget.PaymentAirRoutingSummaries");dojo.require("misys.openaccount.widget.PaymentSeaRoutingSummaries");dojo.require("misys.openaccount.widget.PaymentRoadRoutingSummaries");dojo.require("misys.openaccount.widget.PaymentRailRoutingSummaries");(function(d,dj,m){var _1="";var _2="false";var _3={};d.mixin(m._config,{initReAuthParams:function(){var _4={productCode:"IO",subProductCode:"",transactionTypeCode:"01",entity:dj.byId("entity")?dj.byId("entity").get("value"):"",currency:"",amount:"",es_field1:"",es_field2:""};return _4;},_hasLineItemShipmentDate:function(){if(dj.byId("line-items").store!=null){var _5=dj.byId("line-items").store._arrayOfAllItems;for(var i=0;i<_5.length;i++){if(_5[i]&&(_5[i].last_ship_date!==""||_5[i].earliest_ship_date!=="")){dj.byId("earliest_ship_date").set("value",null);dj.byId("earliest_ship_date").set("disabled",true);dj.byId("last_ship_date").set("value",null);dj.byId("last_ship_date").set("disabled",true);break;}else{dj.byId("earliest_ship_date").set("disabled",false);dj.byId("last_ship_date").set("disabled",false);}}}}});d.mixin(m,{bind:function(){m.setValidation("bill_to_country",m.validateCountry);m.setValidation("ship_to_country",m.validateCountry);m.setValidation("consgn_country",m.validateCountry);m.setValidation("ids_match_issuer_country_country",m.validateCountry);m.setValidation("ceds_match_issuer_country_country",m.validateCountry);m.setValidation("ceds_match_mf_issuer_country_country",m.validateCountry);m.setValidation("creditor_country",m.validateCountry);m.setValidation("buyer_country",m.validateCountry);m.setValidation("seller_country",m.validateCountry);m.setValidation("line_item_product_orgn_country",m.validateCountry);m.setValidation("applicable_law_country",m.validateCountry);m.setValidation("payment_jurisdiction_country",m.validateCountry);m.setValidation("iss_date",m.validateIssueDate);m.connect("bill_to_name","onChange",m.enableRequiredTab);m.connect("ship_to_name","onChange",m.enableRequiredTab);m.connect("consgn_name","onChange",m.enableRequiredTab);m.connect("bill_to_post_code","onChange",m.enableRequiredTab);m.connect("ship_to_post_code","onChange",m.enableRequiredTab);m.connect("consgn_post_code","onChange",m.enableRequiredTab);m.connect("bill_to_town_name","onChange",m.enableRequiredTab);m.connect("ship_to_town_name","onChange",m.enableRequiredTab);m.connect("consgn_town_name","onChange",m.enableRequiredTab);m.connect("bill_to_country","onChange",m.enableRequiredTab);m.connect("ship_to_country","onChange",m.enableRequiredTab);m.connect("consgn_country","onChange",m.enableRequiredTab);m.setValidation("template_id",m.validateTemplateId);m.setValidation("contact_email",m.validateEmailAddr);m.setValidation("buyer_bei",m.validateBEIFormat);m.setValidation("buyer_submitting_bank_bic",m.validateBICFormat);m.setValidation("seller_submitting_bank_bic",m.validateBICFormat);m.setValidation("total_cur_code",m.validateCurrency);m.setValidation("fake_total_cur_code",m.validateCurrency);m.setValidation("total_net_cur_code",m.validateCurrency);m.setValidation("line_item_price_cur_code",m.validateCurrency);m.setValidation("line_item_total_net_cur_code",m.validateCurrency);m.setValidation("adjustment_cur_code",m.validateCurrency);m.setValidation("tax_cur_code",m.validateCurrency);m.setValidation("freight_charge_cur_code",m.validateCurrency);m.setValidation("contact_bic",m.validateBICFormat);m.setValidation("seller_bank_bic",m.validateBICFormat);m.setValidation("buyer_bank_bic",m.validateBICFormat);m.setValidation("creditor_account_cur_code",m.validateCurrency);m.connect("seller_bank_bic","onBlur",m.checkBICExistence);m.connect("buyer_submitting_bank_bic","onBlur",m.checkBICExistence);m.connect("seller_submitting_bank_bic","onBlur",m.checkBICExistence);m.connect("fin_inst_bic","onBlur",m.checkBICExistence);m.connect("obligor_bank","onBlur",m.checkBICExistenceForWidgets);m.connect("recipient_bank","onBlur",m.checkBICExistenceForWidgets);m.connect("creditor_agent_bic","onBlur",m.checkBICExistenceForWidgets);m.connect("contact_bic","onBlur",m.checkBICExistenceForWidgets);m.connect("cds_bic","onBlur",m.checkBICExistenceForWidgets);m.connect("tds_bic","onBlur",m.checkBICExistenceForWidgets);m.connect("ids_bic","onBlur",m.checkBICExistenceForWidgets);m.connect("ceds_bic","onBlur",m.checkBICExistenceForWidgets);m.connect("ocds_bic","onBlur",m.checkBICExistenceForWidgets);m.connect("seller_bank_bic","onChange",m.checkBICExistence);m.connect("buyer_submitting_bank_bic","onChange",m.checkBICExistence);m.connect("seller_submitting_bank_bic","onChange",m.checkBICExistence);m.connect("fin_inst_bic","onChange",m.checkBICExistence);m.connect("obligor_bank","onChange",m.checkBICExistenceForWidgets);m.connect("recipient_bank","onChange",m.checkBICExistenceForWidgets);m.connect("creditor_agent_bic","onChange",m.checkBICExistenceForWidgets);m.connect("contact_bic","onChange",m.checkBICExistenceForWidgets);m.connect("cds_bic","onChange",m.checkBICExistenceForWidgets);m.connect("tds_bic","onChange",m.checkBICExistenceForWidgets);m.connect("ids_bic","onChange",m.checkBICExistenceForWidgets);m.connect("ceds_bic","onChange",m.checkBICExistenceForWidgets);m.connect("ocds_bic","onChange",m.checkBICExistenceForWidgets);m.connect("total_cur_code","onChange",m.toggleDisableButtons);m.connect("freight_charges_type","onChange",m.manageFreightButton);m.connect("total_cur_code","onChange",m.managePOCurrency);m.connect("total_cur_code","onBlur",function(){var _6=dj.byId("prodstatus");var _7=dj.byId("tnxtype");if((_6&&_6.get("value")!=="43"&&_6.get("value")!=="")||(_7&&_7.get("value")!=="03")){_4a();}});m.connect("adjustment_type","onChange",function(){m.toggleMutuallyExclusiveMandatoryFields(["adjustment_rate","adjustment_amt"]);});m.connect("adjustment_amt","onChange",function(){m.toggleMutuallyExclusiveMandatoryFields(["adjustment_rate","adjustment_amt"]);});m.connect("adjustment_rate","onChange",function(){m.toggleMutuallyExclusiveMandatoryFields(["adjustment_rate","adjustment_amt"]);});m.connect("freight_charge_type","onChange",function(){m.toggleMutuallyExclusiveMandatoryFields(["freight_charge_rate","freight_charge_amt"]);});m.connect("freight_charge_amt","onChange",function(){m.toggleMutuallyExclusiveMandatoryFields(["freight_charge_rate","freight_charge_amt"]);});m.connect("freight_charge_rate","onChange",function(){m.toggleMutuallyExclusiveMandatoryFields(["freight_charge_rate","freight_charge_amt"]);});m.connect("tax_type","onChange",function(){m.toggleMutuallyExclusiveMandatoryFields(["tax_amt","tax_rate"]);});m.connect("tax_amt","onChange",function(){m.toggleMutuallyExclusiveMandatoryFields(["tax_amt","tax_rate"]);});m.connect("tax_rate","onChange",function(){m.toggleMutuallyExclusiveMandatoryFields(["tax_amt","tax_rate"]);});m.connect("display_other_parties","onClick",m.showHideOtherParties);m.connect("total_cur_code","onFocus",m.saveOldPOCurrency);m.connect("transport_type","onChange",m.onChangeTranportType);m.connect("payment_terms_type_1","onClick",m.onClickCheckPaymentTerms);m.connect("payment_terms_type_2","onClick",m.onClickCheckPaymentTerms);m.connect("seller_account_type","onChange",function(){m.onChangeSellerAccountType("form_settlement","seller_account_value","seller_account_type");});m.connect("seller_account_value","onFocus",m.onFocusSellerAccount);m.connect("line_item_qty_val","onBlur",m.computeLineItemAmount);m.connect("line_item_price_amt","onBlur",m.computeLineItemAmount);if(d.byId("line_item_qty_unit_measr_other_row")&&d.byId("line_item_qty_unit_measr_code")){if(dj.byId("line_item_qty_unit_measr_code").get("value")==="OTHR"){m.animate("fadeIn","line_item_qty_unit_measr_other_row");}else{m.animate("fadeOut","line_item_qty_unit_measr_other_row");}}m.connect("line_item_qty_unit_measr_code","onChange",function(){m.toggleFields((this.get("value")==="OTHR"),null,["line_item_qty_unit_measr_other"]);if(d.byId("line_item_qty_unit_measr_other_row")){if(this.get("value")==="OTHR"){m.animate("fadeIn","line_item_qty_unit_measr_other_row");}else{m.animate("fadeOut","line_item_qty_unit_measr_other_row");}}});m.connect("fake_total_cur_code","onChange",function(){m.setCurrency(this,["fake_total_amt"]);});m.connect("total_net_cur_code","onChange",function(){m.setCurrency(this,["total_net_amt"]);});m.connect("line_item_price_cur_code","onChange",function(){m.setCurrency(this,["line_item_price_amt"]);});m.connect("fake_total_amt","onChange",function(){m.setTnxAmt(this.get("value"));});m.connect("line_item_total_cur_code","onChange",function(){m.setCurrency(this,["line_item_total_amt"]);});m.connect("line_item_total_net_cur_code","onChange",function(){m.setCurrency(this,["line_item_total_net_amt"]);});m.connect("adjustment_cur_code","onChange",function(){m.setCurrency(this,["adjustment_amt"]);});m.connect("tax_cur_code","onChange",function(){m.setCurrency(this,["tax_amt"]);});m.connect("freight_charge_cur_code","onChange",function(){m.setCurrency(this,["freight_charge_amt"]);});m.connect("issuing_bank_abbv_name","onChange",m.populateReferences);m.connect("issuing_bank_abbv_name","onChange",function(){var _8=dj.byId("bank-payment-obligations");if(_2==="true"&&dj.byId("issuing_bank_abbv_name").get("value")!==""&&_8&&_8.store){m.dialog.show("ALERT",m.getLocalization("alertDeleteBuyerBankRow"),"",null,null,"",function(){if(_8&&_8.store&&_8.store._arrayOfTopLevelItems.length>0){_8.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(_8,function(_9,_a){dojo.forEach(_9,function(_b){if(_b.buyer_bank_bpo[0]==="Y"){_b.buyer_bank_bpo[0]="N";dj.byId("buyer_bank_bpo_added").set("value","false");}});})});if(dj.byId("buyer_bank_bic")&&dj.byId("buyer_bank_bic").get("value")!==""){_8.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(_8,function(_c,_d){dojo.forEach(_c,function(_e){if(_e.obligor_bank[0]===dj.byId("buyer_bank_bic").get("value")){_e.buyer_bank_bpo[0]="Y";dj.byId("buyer_bank_bpo_added").set("value","true");}});})});}}},function(){dj.byId("issuing_bank_abbv_name").set("value","");dj.byId("buyer_bank_bic").set("value","");});}});if(dj.byId("issuing_bank_abbv_name")){m.connect("entity","onChange",function(){dj.byId("issuing_bank_abbv_name").onChange();});}m.connect("issuing_bank_customer_reference","onChange",m.setBuyerReference);m.connect(dj.byId("line_item_qty_unit_measr_code"),"onChange",function(){dj.byId("line_item_price_unit_measr_code").set("value",this.get("value"));});m.connect(dj.byId("line_item_qty_unit_measr_code"),"onChange",function(){dj.byId("line_item_qty_unit_measr_label").set("value",this.get("displayedValue"));});m.connect(dj.byId("product_identifier_code"),"onChange",function(){dj.byId("product_identifier_code_label").set("value",this.get("displayedValue"));});m.connect(dj.byId("product_category_code"),"onChange",function(){dj.byId("product_category_code_label").set("value",this.get("displayedValue"));});m.connect(dj.byId("product_characteristic_code"),"onChange",function(){dj.byId("product_characteristic_code_label").set("value",this.get("displayedValue"));});m.connect(dj.byId("adjustment_type"),"onChange",function(){dj.byId("adjustment_type_label").set("value",this.get("displayedValue"));});m.connect(dj.byId("tax_type"),"onChange",function(){dj.byId("tax_type_label").set("value",this.get("displayedValue"));});m.connect(dj.byId("freight_charge_type"),"onChange",function(){dj.byId("freight_charge_type_label").set("value",this.get("displayedValue"));});m.connect(dj.byId("incoterm_code"),"onChange",function(){dj.byId("incoterm_code_label").set("value",this.get("displayedValue"));});if(d.byId("adjustment_other_type_row")&&d.byId("adjustment_type")){if(dj.byId("adjustment_type").get("value")==="OTHR"){m.animate("fadeIn","adjustment_other_type_row");}else{m.animate("fadeOut","adjustment_other_type_row");}}if(d.byId("tax_other_type_row")&&d.byId("tax_type")){if(dj.byId("tax_type").get("value")==="OTHR"){m.animate("fadeIn","tax_other_type_row");}else{m.animate("fadeOut","tax_other_type_row");}}m.connect("adjustment_type","onChange",function(){m.toggleFields((this.get("value")==="OTHR"),null,["adjustment_other_type"]);if(dojo.byId("adjustment_other_type_row")){if(this.get("value")==="OTHR"){m.animate("fadeIn","adjustment_other_type_row");}else{m.animate("fadeOut","adjustment_other_type_row");}}});m.connect("ceds_cert_type","onChange",function(){if(dj.byId("ceds_cert_type_hidden")){dj.byId("ceds_cert_type_hidden").set("value",this.get("displayedValue"));}});m.connect("ocds_cert_type","onChange",function(){if(dj.byId("ocds_cert_type_hidden")){dj.byId("ocds_cert_type_hidden").set("value",this.get("displayedValue"));}});m.connect("ids_clauses_required","onChange",function(){if(dj.byId("ids_clauses_required_hidden")){dj.byId("ids_clauses_required_hidden").set("value",this.get("displayedValue"));}});m.connect("tax_type","onChange",function(){m.toggleFields((this.get("value")==="OTHR"),null,["tax_other_type"]);if(dojo.byId("tax_other_type_row")){if(this.get("value")==="OTHR"){m.animate("fadeIn","tax_other_type_row");}else{m.animate("fadeOut","tax_other_type_row");}}});if(d.byId("product_category_other_code_row")&&d.byId("product_category_code")){if(dj.byId("product_category_code").get("value")==="OTHR"){m.animate("fadeIn","product_category_other_code_row");}else{m.animate("fadeOut","product_category_other_code_row");}}if(d.byId("product_characteristic_other_code_row")&&d.byId("product_characteristic_code")){if(dj.byId("product_characteristic_code").get("value")==="OTHR"){m.animate("fadeIn","product_characteristic_other_code_row");}else{m.animate("fadeOut","product_characteristic_other_code_row");}}if(d.byId("product_identifier_other_code_row")&&d.byId("product_identifier_code")){if(dj.byId("product_identifier_code").get("value")==="OTHR"){m.animate("fadeIn","product_identifier_other_code_row");}else{m.animate("fadeOut","product_identifier_other_code_row");}}if(d.byId("incoterm_other_row")&&d.byId("incoterm_code")){if(dj.byId("incoterm_code").get("value")==="OTHR"){m.animate("fadeIn","incoterm_other_row");}else{m.animate("fadeOut","incoterm_other_row");}}if(d.byId("freight_charge_other_type_row")&&d.byId("freight_charge_type")){if(dj.byId("freight_charge_type").get("value")==="OTHR"){m.animate("fadeIn","freight_charge_other_type_row");}else{m.animate("fadeOut","freight_charge_other_type_row");}}m.connect("freight_charge_type","onChange",function(){m.toggleFields((this.get("value")==="OTHR"),null,["freight_charge_other_type"]);if(dojo.byId("freight_charge_other_type_row")){if(this.get("value")==="OTHR"){m.animate("fadeIn","freight_charge_other_type_row");}else{m.animate("fadeOut","freight_charge_other_type_row");}}});m.connect("incoterm_code","onChange",function(){m.toggleFields((this.get("value")==="OTHR"),null,["incoterm_other"]);if(dojo.byId("incoterm_other_row")){if(this.get("value")==="OTHR"){m.animate("fadeIn","incoterm_other_row");}else{m.animate("fadeOut","incoterm_other_row");}}});m.connect("product_identifier_code","onChange",function(){m.toggleFields((this.get("value")==="OTHR"),null,["product_identifier_other_code"]);if(dojo.byId("product_identifier_other_code_row")){if(this.get("value")==="OTHR"){m.animate("fadeIn","product_identifier_other_code_row");}else{m.animate("fadeOut","product_identifier_other_code_row");}}});m.connect("product_characteristic_code","onChange",function(){m.toggleFields((this.get("value")==="OTHR"),null,["product_characteristic_other_code"]);if(dojo.byId("product_characteristic_other_code_row")){if(this.get("value")==="OTHR"){m.animate("fadeIn","product_characteristic_other_code_row");}else{m.animate("fadeOut","product_characteristic_other_code_row");}}});m.connect("product_category_code","onChange",function(){m.toggleFields((this.get("value")==="OTHR"),null,["product_category_other_code"]);if(d.byId("product_characteristic_other_code_row")){if(this.get("value")==="OTHR"){m.animate("fadeIn","product_category_other_code_row");}else{m.animate("fadeOut","product_category_other_code_row");}}});m.connect(dj.byId("contact_type"),"onChange",function(){dj.byId("contact_type_decode").set("value",this.get("displayedValue"));var _f=false;var _10=false;var _11=dj.byId("contact-details");if((this.get("value")==="03"||this.get("value")==="04")&&_11&&_11.store){_11.store.fetch({query:{type:"*"},onComplete:dojo.hitch(_11,function(_12,_13){dojo.forEach(_12,function(_14){if(_14.type[0]==="03"){_f=true;}else{if(_14.type[0]==="04"){_10=true;}}});})});if((_f&&this.get("value")==="04")||(_10&&this.get("value")==="03")){this.set("value","");displayMessage=misys.getLocalization("contactEitherBuyerbankOrSellerbank",[this.get("value")]);this.focus();this.set("state","Error");dj.hideTooltip(this.domNode);dj.showTooltip(displayMessage,this.domNode,0);}}if(this.get("value")==="08"&&dj.byId("contact_bic")){dj.byId("contact_bic").set("disabled",false);m.toggleRequired("contact_bic",true);}else{dj.byId("contact_bic").set("value","");dj.byId("contact_bic").set("disabled",true);m.toggleRequired("contact_bic",false);}});m.connect(dj.byId("obligor_bank"),"onBlur",function(){var _15=false,_16=dj.byId("bank-payment-obligations");m.validateBpoBICFormat(dj.byId("obligor_bank"));var _17=this.get("value");var _18=dj.byId("obligor_bank_hidden").get("value");if(_17!==_18){if(_16&&_16.store&&_16.store._arrayOfTopLevelItems.length>0&&_17!==""){_16.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(_16,function(_19,_1a){dojo.forEach(_19,function(_1b){if(_1b.obligor_bank[0]===_17){_15=true;}});})});if(_15){this.set("value","");displayMessage=misys.getLocalization("duplicateBicIdImportOpenAccount",[this.get("value")]);this.focus();this.set("state","Error");dj.hideTooltip(this.domNode);dj.showTooltip(displayMessage,this.domNode,0);}}}});m.connect("settlement_bic","onClick",function(){if(dj.byId("creditor_agent_name")&&dj.byId("creditor_agent_bic")&&dj.byId("creditor_street_name")&&dj.byId("creditor_post_code_identification")&&dj.byId("creditor_town_name")&&dj.byId("creditor_country_sub_div")&&dj.byId("creditor_country")&&dj.byId("settlement_bic")&&dj.byId("settlement_bic").get("checked")){dj.byId("creditor_agent_bic").set("disabled",false);dj.byId("creditor_agent_name").set("value","");dj.byId("creditor_street_name").set("value","");dj.byId("creditor_post_code_identification").set("value","");dj.byId("creditor_town_name").set("value","");dj.byId("creditor_country_sub_div").set("value","");dj.byId("creditor_country").set("value","");dj.byId("creditor_street_name").set("disabled",true);dj.byId("creditor_post_code_identification").set("disabled",true);dj.byId("creditor_town_name").set("disabled",true);dj.byId("creditor_country_sub_div").set("disabled",true);dj.byId("creditor_country").set("disabled",true);dj.byId("creditor_agent_name").set("disabled",true);}});m.connect("settlement_name_address","onClick",function(){if(dj.byId("creditor_agent_name")&&dj.byId("creditor_agent_bic")&&dj.byId("creditor_street_name")&&dj.byId("creditor_post_code_identification")&&dj.byId("creditor_town_name")&&dj.byId("creditor_country_sub_div")&&dj.byId("creditor_country")&&dj.byId("settlement_name_address")&&dj.byId("settlement_name_address").get("checked")){dj.byId("creditor_agent_name").set("disabled",false);dj.byId("creditor_street_name").set("disabled",false);dj.byId("creditor_post_code_identification").set("disabled",false);dj.byId("creditor_town_name").set("disabled",false);dj.byId("creditor_country_sub_div").set("disabled",false);dj.byId("creditor_country").set("disabled",false);dj.byId("creditor_agent_bic").set("value","");dj.byId("creditor_agent_bic").set("disabled",true);}});m.connect("payment_obligation_amount","onBlur",function(){if(dj.byId("total_net_amt")&&dj.byId("oblg_amt")){var _1c=dj.byId("total_net_amt").get("value");var _1d=dj.byId("payment_obligation_amount").get("value");if(_1d>_1c){errorMessage=m.getLocalization("bpoAmountGreaterThanTotalAmtError");dj.byId("payment_obligation_amount").set("state","Error");dj.hideTooltip(dj.byId("payment_obligation_amount").domNode);dj.showTooltip(errorMessage,dj.byId("payment_obligation_amount").domNode,0);}}});m.connect("bpo_used_status","onChange",function(){if(dj.byId("bpo_used_status")&&dj.byId("add_bpo_button")&&dj.byId("bpo_used_status").get("checked")){dj.byId("add_bpo_button").set("disabled",false);}else{if(dj.byId("bpo_used_status")&&dj.byId("add_bpo_button")&&!dj.byId("bpo_used_status").get("checked")){dj.byId("add_bpo_button").set("disabled",true);if(dj.byId("bank-payment-obligations")){dj.byId("bank-payment-obligations").clear();}}}});m.connect("payment_obligation_amount","onChange",function(){m.validateAmount(dj.byId("payment_obligation_amount"));});m.connect("payment_obligation_percent","onChange",function(){m.validateAmount(dj.byId("payment_obligation_percent"));});m.connect("payment_charges_amount","onChange",function(){m.validateAmount(dj.byId("payment_charges_amount"));});m.connect("payment_charges_percent","onChange",function(){m.validateAmount(dj.byId("payment_charges_percent"));});m.connect("payment_amount","onChange",function(){m.validateAmount(dj.byId("payment_amount"));});m.connect("payment_percent","onChange",function(){m.validateAmount(dj.byId("payment_percent"));});m.connect("cds_bic","onBlur",function(){m.validateBpoBICFormat(dj.byId("cds_bic"));});m.connect("tds_bic","onBlur",function(){m.validateBpoBICFormat(dj.byId("tds_bic"));});m.connect("ids_bic","onBlur",function(){m.validateBpoBICFormat(dj.byId("ids_bic"));});m.connect("ceds_bic","onBlur",function(){m.validateBpoBICFormat(dj.byId("ceds_bic"));});m.connect("ocds_bic","onBlur",function(){m.validateBpoBICFormat(dj.byId("ocds_bic"));});m.connect("recipient_bank","onBlur",function(){m.validateBpoBICFormat(dj.byId("recipient_bank"));if(dj.byId("recipient_bank").get("value")!==""&&dj.byId("obligor_bank")&&dj.byId("obligor_bank").get("value")!==""){if(dj.byId("recipient_bank").get("value")===dj.byId("obligor_bank").get("value")){dj.byId("recipient_bank").focus();displayMessage=m.getLocalization("obligorRecipientSameBICError");dj.byId("recipient_bank").set("value","");dj.byId("recipient_bank").set("state","Error");dj.hideTooltip(dj.byId("recipient_bank").domNode);dj.showTooltip(displayMessage,dj.byId("recipient_bank").domNode,0);}else{dj.byId("recipient_bank").set("state","");}}});m.connect("creditor_agent_bic","onBlur",function(){m.validateBpoBICFormat(dj.byId("creditor_agent_bic"));});m.connect("buyer_bank_bpo","onClick",function(){if(dj.byId("buyer_bank_bpo_added")&&dj.byId("buyer_bank_bpo_added").get("value")!=="true"&&dj.byId("buyer_bank_bpo").get("checked")){if(dj.byId("obligor_bank")&&dj.byId("buyer_bank_bic")&&dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""){dj.byId("obligor_bank").set("value",dj.byId("buyer_bank_bic").get("value"));dj.byId("obligor_bank").set("disabled",true);}else{if(dj.byId("obligor_bank")&&dj.byId("buyer_bank_bic")&&dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")===""){dj.byId("buyer_bank_bpo").set("checked",false);m.dialog.show("ERROR",m.getLocalization("selectBuyerBank"),"",function(){});}}}else{if(dj.byId("buyer_bank_bpo_added")&&dj.byId("buyer_bank_bpo_added").get("value")!=="true"&&!dj.byId("buyer_bank_bpo").get("checked")){dj.byId("obligor_bank").set("value","");dj.byId("obligor_bank").set("disabled",false);}else{if(dj.byId("buyer_bank_bpo_added")&&dj.byId("buyer_bank_bpo_added").get("value")!=="false"&&!dj.byId("buyer_bank_bpo").get("checked")){dj.byId("buyer_bank_bpo_added").set("value",false);dj.byId("obligor_bank").set("value","");dj.byId("obligor_bank").set("disabled",false);}}}});m.connect("settlement_bic","onChange",function(){if(dj.byId("settlement_bic")&&dj.byId("settlement_bic").get("checked")){d.style(d.byId("CreditorAgentBIC"),"display","block");dj.byId("creditor_agent_bic").set("required",true);d.style(d.byId("CreditorAgentName"),"display","none");dj.byId("creditor_agent_name").set("required",false);dj.byId("creditor_post_code_identification").set("required",false);dj.byId("creditor_town_name").set("required",false);dj.byId("creditor_country").set("required",false);}});m.connect("settlement_name_address","onChange",function(){if(dj.byId("settlement_name_address")&&dj.byId("settlement_name_address").get("checked")){d.style(d.byId("CreditorAgentName"),"display","block");dj.byId("creditor_agent_name").set("required",true);dj.byId("creditor_post_code_identification").set("required",true);dj.byId("creditor_town_name").set("required",true);dj.byId("creditor_country").set("required",true);d.style(d.byId("CreditorAgentBIC"),"display","none");dj.byId("creditor_agent_bic").set("required",false);}});m.connect("creditor_account_iban","onChange",function(){if(dj.byId("creditor_account_iban")&&dj.byId("creditor_account_iban").get("checked")){dojo.style(dojo.byId("creditor_account_id_iban_row"),"display","block");dj.byId("creditor_account_id_prop").set("required",true);dojo.style(dojo.byId("creditor_account_id_bban_row"),"display","none");dj.byId("creditor_account_id_bban").set("value","");dj.byId("creditor_account_id_bban").set("required",false);dojo.style(dojo.byId("creditor_account_id_upic_row"),"display","none");dj.byId("creditor_account_id_upic").set("value","");dj.byId("creditor_account_id_upic").set("required",false);dojo.style(dojo.byId("creditor_account_id_prop_row"),"display","none");dj.byId("creditor_account_id_prop").set("value","");dj.byId("creditor_account_id_prop").set("required",false);}});m.connect("creditor_account_bban","onChange",function(){if(dj.byId("creditor_account_bban")&&dj.byId("creditor_account_bban").get("checked")){d.style(d.byId("creditor_account_id_iban_row"),"display","none");dj.byId("creditor_account_id_iban").set("value","");dj.byId("creditor_account_id_iban").set("required",false);d.style(d.byId("creditor_account_id_bban_row"),"display","block");dj.byId("creditor_account_id_bban").set("required",true);dj.byId("creditor_account_id_upic").set("value","");dj.byId("creditor_account_id_upic").set("required",false);d.style(d.byId("creditor_account_id_upic_row"),"display","none");dj.byId("creditor_account_id_prop").set("value","");dj.byId("creditor_account_id_prop").set("required",false);dojo.style(dojo.byId("creditor_account_id_prop_row"),"display","none");}});m.connect("creditor_account_upic","onChange",function(){if(dj.byId("creditor_account_upic")&&dj.byId("creditor_account_upic").get("checked")){d.style(dojo.byId("creditor_account_id_iban_row"),"display","none");dj.byId("creditor_account_id_iban").set("value","");dj.byId("creditor_account_id_iban").set("required",false);d.style(d.byId("creditor_account_id_bban_row"),"display","none");dj.byId("creditor_account_id_bban").set("value","");dj.byId("creditor_account_id_bban").set("required",false);d.style(d.byId("creditor_account_id_upic_row"),"display","block");dj.byId("creditor_account_id_upic").set("required",true);d.style(d.byId("creditor_account_id_prop_row"),"display","none");dj.byId("creditor_account_id_prop").set("value","");dj.byId("creditor_account_id_prop").set("required",false);}});m.connect("creditor_account_prop","onChange",function(){if(dj.byId("creditor_account_prop")&&dj.byId("creditor_account_prop").get("checked")){dojo.style(dojo.byId("creditor_account_id_iban_row"),"display","none");dj.byId("creditor_account_id_iban").set("value","");dj.byId("creditor_account_id_iban").set("required",false);dojo.style(dojo.byId("creditor_account_id_bban_row"),"display","none");dj.byId("creditor_account_id_bban").set("value","");dj.byId("creditor_account_id_bban").set("required",false);dojo.style(dojo.byId("creditor_account_id_upic_row"),"display","none");dj.byId("creditor_account_id_upic").set("value","");dj.byId("creditor_account_id_upic").set("required",false);dojo.style(dojo.byId("creditor_account_id_prop_row"),"display","block");dj.byId("creditor_account_id_prop").set("required",true);}});m.connect("creditor_act_type_code","onChange",function(){if(dj.byId("creditor_act_type_code")&&dj.byId("creditor_act_type_code").get("checked")){dojo.style(dojo.byId("creditor_account_type_prop_row"),"display","none");dj.byId("creditor_account_type_prop").set("value","");dj.byId("creditor_account_type_prop").set("required",false);dojo.style(dojo.byId("creditor_account_type_code_row"),"display","block");dj.byId("creditor_account_type_code").set("required",true);}});m.connect("creditor_act_type_prop","onChange",function(){if(dj.byId("creditor_act_type_prop")&&dj.byId("creditor_act_type_prop").get("checked")){dojo.style(dojo.byId("creditor_account_type_prop_row"),"display","block");dj.byId("creditor_account_type_prop").set("required",true);dj.byId("creditor_account_type_code").set("value","");dj.byId("creditor_account_type_code").set("required",false);dojo.style(dojo.byId("creditor_account_type_code_row"),"display","none");}});m.connect("pmt_code","onChange",function(){if(dj.byId("pmt_code")&&dj.byId("pmt_code").get("checked")){dojo.style(dojo.byId("paymentCode"),"display","block");dj.byId("payment_nb_days").set("disabled",false);dj.byId("payment_code").set("disabled",false);dj.byId("payment_code").set("required",true);dj.byId("payment_other_term").set("required",false);dj.byId("payment_other_term").set("value","");dojo.style(dojo.byId("payment_other_term_row"),"display","none");}});m.connect("pmt_other_term_code","onChange",function(){if(dj.byId("pmt_other_term_code")&&dj.byId("pmt_other_term_code").get("checked")){dojo.style(dojo.byId("paymentCode"),"display","none");dj.byId("payment_code").set("value","");dj.byId("payment_nb_days").set("value","");dojo.style(dojo.byId("payment_other_term_row"),"display","block");dj.byId("payment_other_term").set("disabled",false);dj.byId("payment_code").set("required",false);dj.byId("payment_other_term").set("required",true);}});m.connect("payment_obligation_amount","onChange",function(){m.toggleMutuallyExclusiveMandatoryFields(["payment_obligation_amount","payment_obligation_percent"]);});m.connect("payment_obligation_amount","onBlur",function(){m.toggleMutuallyExclusiveMandatoryFields(["payment_obligation_amount","payment_obligation_percent"]);});m.connect("payment_obligation_percent","onChange",function(){m.toggleMutuallyExclusiveMandatoryFields(["payment_obligation_amount","payment_obligation_percent"]);});m.connect("payment_obligation_percent","onBlur",function(){m.toggleMutuallyExclusiveMandatoryFields(["payment_obligation_amount","payment_obligation_percent"]);});m.connect("payment_charges_amount","onChange",function(){m.toggleMutuallyExclusiveFields(["payment_charges_amount","payment_charges_percent"]);});m.connect("payment_charges_amount","onBlur",function(){m.toggleMutuallyExclusiveFields(["payment_charges_amount","payment_charges_percent"]);});m.connect("payment_charges_percent","onChange",function(){m.toggleMutuallyExclusiveFields(["payment_charges_amount","payment_charges_percent"]);});m.connect("payment_charges_percent","onBlur",function(){m.toggleMutuallyExclusiveFields(["payment_charges_amount","payment_charges_percent"]);});m.connect("payment_amount","onChange",function(){m.toggleMutuallyExclusiveMandatoryFields(["payment_amount","payment_percent"]);});m.connect("payment_amount","onBlur",function(){m.toggleMutuallyExclusiveMandatoryFields(["payment_amount","payment_percent"]);});m.connect("payment_percent","onChange",function(){m.toggleMutuallyExclusiveMandatoryFields(["payment_amount","payment_percent"]);});m.connect("payment_percent","onBlur",function(){m.toggleMutuallyExclusiveMandatoryFields(["payment_amount","payment_percent"]);});m.oaCommonBindEvents();if(dj.byId("tnxtype")&&dj.byId("tnxtype").get("value")!=="38"){m.validateResubmissionCount();}},onFormLoad:function(){_1=m.formToXML();var _1e=dj.byId("prodstatus");var _1f=dj.byId("tnxtype");if((_1e&&_1e.get("value")==="43")||(_1f&&_1f.get("value")==="03")){if(dj.byId("provisional_status")){dj.byId("provisional_status").set("value","Y");}if(dj.byId("buyer_name")){dj.byId("buyer_name").set("readOnly",true);}if(dj.byId("buyer_country")){dj.byId("buyer_country").set("readOnly",true);}if(dj.byId("seller_country")){dj.byId("seller_country").set("readOnly",true);}if(dj.byId("seller_name")){dj.byId("seller_name").set("readOnly",true);}}if(dj.byId("seller_name")&&dj.byId("seller_name").get("value")!==""&&(dj.byId("tnxtype")&&dj.byId("tnxtype").get("value")==="01")){dj.byId("seller_name").set("readOnly",false);dj.byId("seller_street_name").set("readOnly",false);dj.byId("seller_town_name").set("readOnly",false);dj.byId("seller_country_sub_div").set("readOnly",false);dj.byId("seller_post_code").set("readOnly",false);}var _20=dj.byId("display_other_parties");if(_20){m.showHideOtherParties();misys.toggleCountryFields(false,["bill_to_country","ship_to_country","consgn_country"]);}m.toggleDisableButtons();var _21=dj.byId("issuing_bank_abbv_name");if(_21){_21.onChange();}var _22=dj.byId("issuing_bank_customer_reference");if(_22){_22.onChange();_22.set("value",_22._resetValue);}m.computePOTotalAmount();m.managePOCurrency();if(dj.byId("payment_obligation_amount")&&dj.byId("payment_obligation_amount").get("value")!==""){dj.byId("payment_obligation_amount").set("disabled",false);}else{dj.byId("payment_obligation_amount").set("disabled",true);}if(dj.byId("payment_obligation_percent")&&dj.byId("payment_obligation_percent").get("value")!==""){dj.byId("payment_obligation_percent").set("disabled",false);}else{dj.byId("payment_obligation_percent").set("disabled",true);}if(dj.byId("isCopyFrom")&&dj.byId("isCopyFrom").get("value")==="Y"){m.clearBpoExpiryDateOnLoad();}if(dj.byId("creditor_agent_bic")&&dj.byId("settlement_bic")&&!dj.byId("settlement_bic").get("checked")){dj.byId("creditor_agent_bic").set("disabled",true);dj.byId("creditor_agent_bic").set("required",false);}else{if(dj.byId("creditor_agent_bic")){dj.byId("creditor_agent_bic").set("disabled",false);}}if(dj.byId("creditor_agent_name")&&dj.byId("creditor_street_name")&&dj.byId("creditor_post_code_identification")&&dj.byId("creditor_town_name")&&dj.byId("creditor_country_sub_div")&&dj.byId("creditor_country")&&dj.byId("settlement_name_address")&&!dj.byId("settlement_name_address").get("checked")){dj.byId("creditor_agent_name").set("disabled",true);dj.byId("creditor_street_name").set("disabled",true);dj.byId("creditor_post_code_identification").set("disabled",true);dj.byId("creditor_town_name").set("disabled",true);dj.byId("creditor_country_sub_div").set("disabled",true);dj.byId("creditor_country").set("disabled",true);dj.byId("creditor_agent_name").set("required",false);dj.byId("creditor_post_code_identification").set("required",false);dj.byId("creditor_town_name").set("required",false);dj.byId("creditor_country").set("required",false);}else{if(dj.byId("creditor_agent_name")&&dj.byId("creditor_street_name")&&dj.byId("creditor_post_code_identification")&&dj.byId("creditor_town_name")&&dj.byId("creditor_country_sub_div")&&dj.byId("creditor_country")){dj.byId("creditor_agent_name").set("disabled",false);dj.byId("creditor_street_name").set("disabled",false);dj.byId("creditor_post_code_identification").set("disabled",false);dj.byId("creditor_town_name").set("disabled",false);dj.byId("creditor_country_sub_div").set("disabled",false);dj.byId("creditor_country").set("disabled",false);}}if(dj.byId("creditor_account_iban")&&dj.byId("creditor_account_iban").get("checked")){dojo.style(dojo.byId("creditor_account_id_iban_row"),"display","block");dj.byId("creditor_account_id_iban").set("required",true);}else{if(dj.byId("creditor_account_iban")){dojo.style(dojo.byId("creditor_account_id_iban_row"),"display","none");dj.byId("creditor_account_id_iban").set("required",false);}}if(dj.byId("creditor_account_bban")&&dj.byId("creditor_account_bban").get("checked")){dojo.style(dojo.byId("creditor_account_id_bban_row"),"display","block");dj.byId("creditor_account_id_bban").set("required",true);}else{if(dj.byId("creditor_account_bban")){dojo.style(dojo.byId("creditor_account_id_bban_row"),"display","none");dj.byId("creditor_account_id_bban").set("required",false);}}if(dj.byId("creditor_account_upic")&&dj.byId("creditor_account_upic").get("checked")){dojo.style(dojo.byId("creditor_account_id_upic_row"),"display","block");dj.byId("creditor_account_id_upic").set("required",true);}else{if(dj.byId("creditor_account_upic")){dojo.style(dojo.byId("creditor_account_id_upic_row"),"display","none");dj.byId("creditor_account_id_upic").set("required",false);}}if(dj.byId("creditor_account_prop")&&dj.byId("creditor_account_prop").get("checked")){dojo.style(dojo.byId("creditor_account_id_prop_row"),"display","block");dj.byId("creditor_account_id_prop").set("required",true);}else{if(dj.byId("creditor_account_prop")){dojo.style(dojo.byId("creditor_account_id_prop_row"),"display","none");dj.byId("creditor_account_id_prop").set("required",false);}}if(dj.byId("pmt_other_term_code")&&dj.byId("pmt_other_term_code").get("checked")){dojo.style(dojo.byId("payment_other_term_row"),"display","block");dj.byId("payment_other_term").set("required",true);}else{if(dj.byId("pmt_other_term_code")){dojo.style(dojo.byId("payment_other_term_row"),"display","none");dj.byId("payment_other_term").set("required",false);}}if(dj.byId("pmt_code")&&dj.byId("pmt_code").get("checked")===true){dojo.style(dojo.byId("paymentCode"),"display","block");dj.byId("payment_code").set("required",true);}else{if(dj.byId("pmt_code")){dojo.style(dojo.byId("paymentCode"),"display","none");dj.byId("payment_code").set("required",false);}}if(dj.byId("creditor_act_type_prop")&&dj.byId("creditor_act_type_prop").get("checked")){dojo.style(dojo.byId("creditor_account_type_prop_row"),"display","block");dj.byId("creditor_account_type_prop").set("required",true);}else{if(dj.byId("creditor_act_type_prop")){dojo.style(dojo.byId("creditor_account_type_prop_row"),"display","none");dj.byId("creditor_account_type_prop").set("required",false);}}if(dj.byId("creditor_act_type_code")&&dj.byId("creditor_act_type_code").get("checked")){dojo.style(dojo.byId("creditor_account_type_code_row"),"display","block");dj.byId("creditor_account_type_code").set("required",true);}else{if(dj.byId("creditor_act_type_code")){dojo.style(dojo.byId("creditor_account_type_code_row"),"display","none");dj.byId("creditor_account_type_code").set("required",false);}}m.oaOnLoadActions();if(dj.byId("bpo_used_status")&&dj.byId("add_bpo_button")&&dj.byId("bpo_used_status").get("checked")){dj.byId("add_bpo_button").set("disabled",false);}else{if(dj.byId("bpo_used_status")&&dj.byId("add_bpo_button")&&!dj.byId("bpo_used_status").get("checked")){dj.byId("add_bpo_button").set("disabled",true);}}var _23=dj.byId("bank-payment-obligations");var _24=false;if(_23&&_23.store&&_23.store._arrayOfTopLevelItems){_23.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(_23,function(_25,_26){dojo.forEach(_25,function(_27){if(_27.buyer_bank_bpo[0]==="Y"){dj.byId("buyer_bank_bpo_added").set("value",true);_24=true;}});})});if(!_24){dj.byId("buyer_bank_bpo_added").set("value",false);}}if(dj.byId("recipient_bank")&&dj.byId("recipient_bank").get("value")!==""&&dj.byId("obligor_bank")&&dj.byId("obligor_bank").get("value")!==""){if(dj.byId("recipient_bank").get("value")===dj.byId("obligor_bank").get("value")){dj.byId("recipient_bank").focus();displayMessage=m.getLocalization("obligorRecipientSameBICError");dj.byId("recipient_bank").set("state","Error");dj.hideTooltip(dj.byId("recipient_bank").domNode);dj.showTooltip(displayMessage,dj.byId("recipient_bank").domNode,0);}else{dj.byId("recipient_bank").set("state","");}}_2="true";},beforeSaveValidations:function(){var _28=true;var _29="";var _2a=dj.byId("entity");if(_2a&&_2a.get("value")===""){_28=false;}return _28;},beforeSubmitValidations:function(){var _2b=true,_2c="",_2d=dj.byId("po-payments"),_2e=dj.byId("line-items"),_2f=dj.byId("contact-details"),_30=dj.byId("bank-payment-obligations"),_31=dj.byId("commercial-ds"),_32=0,_33=dj.byId("total_net_amt"),_34=false,_35=false,_36=dj.byId("part_ship_2")?dj.byId("part_ship_2").get("checked"):false;if(dj.byId("tnxtype")&&dj.byId("tnxtype").get("value")==="38"){closeComments=dj.byId("close_comments");if(closeComments&&dojo.string.trim(closeComments.get("value"))===""){closeComments.set("required",true);_2b=false;_2c=m.getLocalization("closeCommentsMandatory");}m._config.onSubmitErrorMsg=_2c;return _2b;}else{if(dj.byId("tnxtype")&&dj.byId("tnxtype").get("value")==="55"){return _2b;}else{m.checkPoReferenceExistsIO();if(dj.byId("po_ref_id")&&dj.byId("po_ref_id").get("state")==="Error"){_2c+=m.getLocalization("mandatoryPOReferenceError");_2b=false;}if(!_2d||!_2d.store||_2d.store._arrayOfTopLevelItems.length<=0){_2c+=m.getLocalization("mandatoryPaymentTermError");_2b=false;}if(!_2e||!_2e.store||_2e.store._arrayOfTopLevelItems.length<=0){if(_2c!==""){_2c+="<br>";}_2c+=misys.getLocalization("mandatoryLineItemError");_2b=false;}if(!_2f||!_2f.store||_2f.store._arrayOfTopLevelItems.length<=0){if(_2c!==""){_2c+="<br>";}_2c+=misys.getLocalization("mandatoryContactBuyerOrSellerBankError");_2b=false;}if(_2f&&_2f.store!==null&&_2f.store._arrayOfTopLevelItems.length>0){var _37=true;var _38=_2f.store._arrayOfTopLevelItems.length;for(var i=0;i<_38;i++){var _39=_2f.store._arrayOfTopLevelItems[i];if(_39!==null&&(_39.type[0]==="04"||_39.type[0]==="03")){_37=false;}}if(_37===true){if(_2c!==""){_2c+="<br>";}_2c+=misys.getLocalization("mandatoryContactBuyerOrSellerBankError");_2b=false;}}if(_33&&_2d.store&&_2d.store._arrayOfTopLevelItems.length>0){var _3a=0;var Amt=0;var _3b=parseFloat(dijit.byId("total_net_amt").get("value"));_2d.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(_2d,function(_3c,_3d){dojo.forEach(_3c,function(_3e){if(_3e.amt[0]!==""){_3a=_3a+parseFloat(_3e.amt[0].replace(",",""));}else{if(_3e.pct[0]!==""){Amt=(parseFloat(_3e.pct[0])/100)*_3b;_3a=_3a+Amt;}}});})});if(_3a!==_3b){if(_2c!==""){_2c+="<br>";}_2c+=misys.getLocalization("paymentAmtOrPercentage");_2b=false;}}if(_36&&_2d.store&&_2d.store._arrayOfTopLevelItems.length>1){if(_2c!==""){_2c+="<br>";}_2c+=misys.getLocalization("multiplePaymentTermsError");_2b=false;}if(!_31||!_31.store||_31.store._arrayOfTopLevelItems.length<=0){if(_2c!==""){_2c+="<br>";}_2c+=misys.getLocalization("mandatoryCommercialDatasetError");_2b=false;}if(dj.byId("seller_bank_bic")&&_31&&_31.store&&_31.store._arrayOfTopLevelItems.length>0){var _3f=dj.byId("seller_bank_bic").get("value");_31.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(_31,function(_40,_41){dojo.forEach(_40,function(_42){if(_42.BIC[0]!==_3f){_2c+=misys.getLocalization("commercialDatasetBicSellerBicError");_2b=false;}});})});}if(_33&&_30&&_30.store&&_30.store._arrayOfTopLevelItems){var _43=_33.get("value");_30.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(_30,function(_44,_45){dojo.forEach(_44,function(_46){if(_46.payment_obligation_amount[0]!==""){_32=_32+parseInt(_46.payment_obligation_amount[0],10);}else{if(_46.payment_obligation_percent[0]!==""){paymentOblgAmt=(parseInt(_46.payment_obligation_percent[0],10)/100)*parseInt(_43,10);_32=_32+paymentOblgAmt;}}if(_46.payment_expiry_date[0]===""){_34=true;}if(_46.creditor_account_id_iban[0]===""&&_46.creditor_account_id_bban[0]===""&&_46.creditor_account_id_upic[0]===""&&_46.creditor_account_id_prop[0]===""){_35=true;}});})});if(_32>_43){_2b=false;_2c=m.getLocalization("BpoSumMoreThanIoAmount");}if(_34){if(_2c!==""){_2c+="<br>";}_2c+=m.getLocalization("bpoExpiryDateNotPresent");_2b=false;}if(_35){if(_2c!==""){_2c+="<br>";}_2c+=m.getLocalization("bpoCreditorAccIdTypeError");_2b=false;}}if(dj.byId("tnxtype")&&dj.byId("tnxtype").get("value")==="31"){var _47=m.compareDateIsGreater("exp_date",["iss_date","appl_date"]);if(!_47){_2c+=m._config.onSubmitErrorMsg;_2b=false;}}var _48=dj.byId("taking_in_charge");var _49=dj.byId("final_dest_place");if((_48&&_48.value!=="")&&(_49&&_49.value==="")){_2c+=misys.getLocalization("multimodalDetMandatoryError");_2b=false;}else{if((_49&&_49.value!=="")&&(_48&&_48.value==="")){_2c+=misys.getLocalization("multimodalDetMandatoryError");_2b=false;}}if(!m.validateCreditorAccountIdType()){if(_2c!==""){_2c+="<br>";}_2c+=misys.getLocalization("creditorAccIdTypeError");_2b=false;}if((_2e&&_2e.store&&_2e.store._arrayOfTopLevelItems.length>0)&&(m.hasIncotermsInAllLineItems()||m.hasLastShipmentInAllLineItems()||m.hasRoutingSummaryInAllLineItems())){if(_2c!==""){_2c+="<br>";}_2c+=misys.getLocalization("incotermRoutingShipmentDateNotInAllLineItemError");_2b=false;}m._config.onSubmitErrorMsg=_2c;}}return _2b;}});function _4a(){var _4b=misys.getLocalization("resetImportOpenAccountCurrency");if(dj.byId("line-items")&&dj.byId("line-items").store&&dj.byId("line-items").store!=null&&dj.byId("line-items").store._arrayOfAllItems.length>0){for(var i=0,_4c=dj.byId("line-items").store._arrayOfAllItems.length;i<_4c;i++){var _4d=dj.byId("line-items").store._arrayOfAllItems[i];if(_4d!=null&&_4d.price_cur_code!==dj.byId("total_cur_code").get("value")){var _4e=function(){if(dj.byId("line-items").grid&&dj.byId("line-items").grid.store){dj.byId("line-items").grid.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(dj.byId("total_cur_code"),function(_4f,_50){d.forEach(_4f,function(_51){dj.byId("line-items").grid.store.setValue(_51,"price_cur_code",dj.byId("total_cur_code").get("value"));dj.byId("line-items").grid.store.setValue(_51,"total_cur_code",dj.byId("total_cur_code").get("value"));dj.byId("line-items").grid.store.setValue(_51,"total_net_cur_code",dj.byId("total_cur_code").get("value"));if(_51.taxes&&_51.taxes.length>0){dj.byId("tax_cur_code").set("value",dj.byId("total_cur_code").get("value"));if(_51.taxes[0]._values!==""&&_51.taxes[0]._values.length>0){for(i=0;i<_51.taxes[0]._values.length;i++){_51.taxes[0]._values[i].cur_code=dj.byId("total_cur_code").get("value");}}}if(_51.adjustments&&_51.adjustments.length>0){dj.byId("adjustment_cur_code").set("value",dj.byId("total_cur_code").get("value"));if(_51.adjustments[0]._values!==""&&_51.adjustments[0]._values.length>0){for(i=0;i<_51.adjustments[0]._values.length;i++){_51.adjustments[0]._values[i].cur_code=dj.byId("total_cur_code").get("value");}}}if(_51.freight_charges&&_51.freight_charges.length>0){dj.byId("freight_charge_cur_code").set("value",dj.byId("total_cur_code").get("value"));if(_51.freight_charges[0]._values!==""&&_51.freight_charges[0]._values.length>0){for(i=0;i<_51.freight_charges[0]._values.length;i++){_51.freight_charges[0]._values[i].cur_code=dj.byId("total_cur_code").get("value");}}}},dj.byId("line-items"));})});dj.byId("line-items").grid.store.save();var _52=dj.byId("line-items");setTimeout(function(){_52.renderSections();_52.grid.render();},200);}};var _53=function(){dj.byId("total_cur_code").set("value",dj.byId("line-items").store._arrayOfAllItems[0].price_cur_code);};m.dialog.show("CONFIRMATION",_4b,"","","","",_4e,_53);}}}if(dj.byId("po-adjustments")&&dj.byId("po-adjustments").store&&dj.byId("po-adjustments").store!==null&&dj.byId("po-adjustments").store._arrayOfAllItems.length>0){if(dj.byId("po-adjustments").grid&&dj.byId("po-adjustments").grid.store){dj.byId("po-adjustments").grid.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(dj.byId("total_cur_code"),function(_54,_55){d.forEach(_54,function(_56){dj.byId("po-adjustments").grid.store.setValue(_56,"cur_code",dj.byId("total_cur_code").get("value"));},dj.byId("po-adjustments"));})});}}if(dj.byId("po-taxes")&&dj.byId("po-taxes").store&&dj.byId("po-taxes").store!==null&&dj.byId("po-taxes").store._arrayOfAllItems.length>0){if(dj.byId("po-taxes").grid&&dj.byId("po-taxes").grid.store){dj.byId("po-taxes").grid.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(dj.byId("total_cur_code"),function(_57,_58){d.forEach(_57,function(_59){dj.byId("po-taxes").grid.store.setValue(_59,"cur_code",dj.byId("total_cur_code").get("value"));},dj.byId("po-taxes"));})});}}if(dj.byId("po-freight-charges")&&dj.byId("po-freight-charges").store&&dj.byId("po-freight-charges").store!==null&&dj.byId("po-freight-charges").store._arrayOfAllItems.length>0){if(dj.byId("po-freight-charges").grid&&dj.byId("po-freight-charges").grid.store){dj.byId("po-freight-charges").grid.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(dj.byId("total_cur_code"),function(_5a,_5b){d.forEach(_5a,function(_5c){dj.byId("po-freight-charges").grid.store.setValue(_5c,"cur_code",dj.byId("total_cur_code").get("value"));},dj.byId("po-freight-charges"));})});}}};})(dojo,dijit,misys);dojo.require("misys.client.binding.openaccount.payment_oa_client");}