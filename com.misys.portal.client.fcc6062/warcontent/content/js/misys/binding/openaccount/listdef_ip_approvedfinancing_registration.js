/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.openaccount.listdef_ip_approvedfinancing_registration"]){dojo._hasResource["misys.binding.openaccount.listdef_ip_approvedfinancing_registration"]=true;dojo.provide("misys.binding.openaccount.listdef_ip_approvedfinancing_registration");dojo.require("dojo.data.ItemFileReadStore");dojo.require("dojo.data.ItemFileWriteStore");dojo.require("dijit.form.FilteringSelect");dojo.require("misys.form.MultiSelect");dojo.require("dijit.layout.TabContainer");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.openaccount.StringUtils");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.layout.ContentPane");dojo.require("misys.form.CurrencyTextBox");dojo.require("misys.binding.common.listdef_mc");dojo.require("misys.binding.common.reauth_listdef_common");dojo.require("misys.binding.system.reauth");dojo.require("misys.binding.common.reauth_listdef");(function(d,dj,m){function _1(){var _2=false,_3=[];d.query(".dojoxGrid").forEach(function(g){_3.push(dj.byId(g.id));});d.forEach(_3,function(_4){if(_4.selection.getSelected().length>0){_2=true;}});return _2;};function _5(){var _6=this;if(_6.get("value")===null){return true;}var _7=dj.byId("iss_date2");if(!m.compareDateFields(_6,_7)){var _8=dj.byId("iss_date");displayMessage=misys.getLocalization("InvoiceIssueDateFromLesserThanInvoiceIssueDateTo");_8.focus();_8.set("state","Error");dj.hideTooltip(_8.domNode);dj.showTooltip(displayMessage,_8.domNode,0);}return true;};function _9(){var _a=this;if(_a.get("value")===null){return true;}var _b=dj.byId("iss_date");if(!m.compareDateFields(_b,_a)){var _c=dj.byId("iss_date2");displayMessage=misys.getLocalization("InvoiceIssueDateToGreaterThanInvoiceIssueDateFrom");_c.focus();_c.set("state","Error");dj.hideTooltip(_c.domNode);dj.showTooltip(displayMessage,_c.domNode,0);return false;}return true;};function _d(){var _e=this;if(_e.get("value")===null){return true;}var _f=dj.byId("due_date2");if(!m.compareDateFields(_e,_f)){var _10=dj.byId("due_date"),_11=misys.getLocalization("InvoiceDueDateFromGreaterThanInvoiceDueDateTo");_10.focus();_10.set("state","Error");dj.hideTooltip(_10.domNode);dj.showTooltip(_11,_10.domNode,0);dj.showTooltip(_11,domNode,0);return false;}return true;};function _12(){var _13=this;if(_13.get("value")===null){return true;}var _14=dj.byId("due_date");if(!m.compareDateFields(_14,_13)){var _15=dj.byId("due_date2");displayMessage=misys.getLocalization("InvoiceDueDateToLesserThanInvoiceDueDateFrom");_15.focus();_15.set("state","Error");dj.hideTooltip(_15.domNode);dj.showTooltip(displayMessage,_15.domNode,0);}return true;};d.subscribe("ready",function(){m._config=(m._config)||{};m._config.cellNodeReference;m._config.programcode;d.query(".dojoxGrid").forEach(function(_16){if(_16.id!=="nonSignedFolders"){m.connect(_16.id,"onRowMouseOver",m._config.mouseOverShowTermsAndConditions);m.connect(_16.id,"onRowMouseOut",m._config.mouseOutHideTermsAndConditions);m.connect(dj.byId(_16.id).selection,"onSelected",m._config.showTermsAndConditions);m.connect(dj.byId(_16.id).selection,"onDeselected",m._config.hideTermsAndConditions);m.connect(_16.id,"onRowClick",m._config.storeCellNodeReference);m.connect(_16.id,"onHeaderCellClick",function(evt){if(m._config.cellNodeReference&&m._config.cellNodeReference.cellNode){dj.hideTooltip(m._config.cellNodeReference.cellNode);m._config.cellNodeReference.cellNode=null;}});}});});d.mixin(m,{bind:function(){m.setValidation("cur_code",m.validateCurrency);m.connect("cur_code","onChange",_17);m.connect("cur_code","onChange",function(){misys.setCurrency(this,["AmountRange","AmountRange2"]);});m.connect("AmountRangevisible","onBlur",_18);m.connect("AmountRange2visible","onBlur",_18);m.connect("submitButton","onClick",_19);m.connect("iss_date","onBlur",_5);m.connect("iss_date2","onBlur",_9);m.connect("due_date","onBlur",_d);m.connect("due_date2","onBlur",_12);}});d.mixin(m._config,{saveOpenAccount:function(_1a){var _1b=[],_1c="",_1d="";if(dj.byId("nonSignedFolders")){if(dijit.byId("nonSignedFolders").selection.selectedIndex!==-1){if(dj.byId("referenceid")){_1c=dj.byId("referenceid").get("value");}if(dj.byId("tnxid")){_1d=dj.byId("tnxid").get("value");}}}d.query(".dojoxGrid").forEach(function(g){_1b.push(dj.byId(g.id));});},submitOpenAccount:function(_1e){var _1f=[],_20="",_21="",_22={},_23=dj.byId("reauth_perform");m._config.programcode=_1e;if(_1()){if(_23&&_23.get("value")==="Y"){if(d.isFunction(m._config.initReAuthParams)){_22=m._config.initReAuthParams();m._config.executeReauthentication(_22);}else{m.setContentInReAuthDialog("ERROR","");dj.byId("reauth_dialog").show();}}else{m._config.nonReauthSubmit();}}else{m.dialog.show("ERROR",m.getLocalization("noTransactionsSelectedError"));}},showTermsAndConditions:function(_24){var _25;if(this.grid.store._items[_24]&&this.grid.store._items[_24].i){_25=this.grid.store._items[_24].i["Counterparty@ObjectDataClob@conditions_04"];if(!_25){_25=this.grid.store._items[_24].i["Counterparty@ObjectDataClob@conditions_06"];}if(!_25){_25=this.grid.store._items[_24].i["Counterparty@ObjectDataClob@conditions_05"];}_25=m.replaceCarriageReturn(_25,"<br>");}if(_25&&m._config.cellNodeReference&&m._config.cellNodeReference.cellNode){dj.hideTooltip(m._config.cellNodeReference.cellNode);dj.showTooltip(_25,m._config.cellNodeReference.cellNode,0);}},mouseOverShowTermsAndConditions:function(evt){if(this.selection.selected[evt.rowIndex]&&this.selection.selected[evt.rowIndex]===true&&evt.cellIndex===0){var _26;_26=this.store._items[evt.rowIndex].i["Counterparty@ObjectDataClob@conditions_04"];if(!_26){_26=this.store._items[evt.rowIndex].i["Counterparty@ObjectDataClob@conditions_06"];}if(!_26){_26=this.grid.store._items[rowIndex].i["Counterparty@ObjectDataClob@conditions_05"];}if(_26){_26=m.replaceCarriageReturn(_26,"<br>");dj.showTooltip(_26,evt.cellNode,0);}}},mouseOutHideTermsAndConditions:function(evt){dj.hideTooltip(evt.cellNode);},storeCellNodeReference:function(evt){m._config.cellNodeReference=evt;},hideTermsAndConditions:function(evt){if(m._config.cellNodeReference&&m._config.cellNodeReference.cellNode){dj.hideTooltip(m._config.cellNodeReference.cellNode);}},initReAuthParams:function(){var _27={productCode:"AFR",subProductCode:"",transactionTypeCode:"01",entity:"",currency:"",amount:"",es_field1:"",es_field2:""};return _27;},reauthSubmit:function(){var _28=dj.byId("reauth_password").get("value"),_29="",_2a="",_2b=[];var _2c=[];_2c.push("&reauth_otp_response=",_28);if(dj.byId("nonSignedFolders")){if(dijit.byId("nonSignedFolders").selection.selectedIndex!==-1){if(dj.byId("referenceid")){_29=dj.byId("referenceid").get("value");}if(dj.byId("tnxid")){_2a=dj.byId("tnxid").get("value");}}}d.query(".dojoxGrid").forEach(function(g){_2b.push(dj.byId(g.id));});var url="/screen/AjaxScreen/action/RunGroupSubmission?s=InvoicePayableScreen&operation=SUBMIT&option=IP_FOLDER&mode=DRAFT&tnxtype=01&referenceid="+_29+"&tnxid="+_2a+"&programcode="+m._config.programcode;var _2d=function(){m.markWidgetAsLoading("submit-button",false);};m.markWidgetAsLoading("submit-button",true);m.grid.processRecords(_2b,url+_2c.join(""),_2d);},nonReauthSubmit:function(){var _2e=[],_2f="",_30="";if(dj.byId("nonSignedFolders")){if(dijit.byId("nonSignedFolders").selection.selectedIndex!==-1){if(dj.byId("referenceid")){_2f=dj.byId("referenceid").get("value");}if(dj.byId("tnxid")){_30=dj.byId("tnxid").get("value");}}}d.query(".dojoxGrid").forEach(function(g){_2e.push(dj.byId(g.id));});var url="/screen/AjaxScreen/action/RunGroupSubmission?s=InvoicePayableScreen&operation=SUBMIT&option=IP_FOLDER&mode=DRAFT&tnxtype=01&referenceid="+_2f+"&tnxid="+_30+"&programcode="+m._config.programcode;var _31=function(){m.markWidgetAsLoading("submit-button",false);};m.markWidgetAsLoading("submit-button",true);m.grid.processRecords(_2e,url,_31);}});function _17(){if(dj.byId("cur_code").value!==""){dj.byId("AmountRangevisible").set("disabled",false);dj.byId("AmountRange2visible").set("disabled",false);}else{if(dj.byId("cur_code").value===""){dj.byId("AmountRangevisible").set("disabled",true);dj.byId("AmountRange2visible").set("disabled",true);dj.byId("AmountRangevisible").reset();dj.byId("AmountRange2visible").reset();}}};function _18(){var _32=this.get("value");var _33=dj.byId("AmountRange2visible").get("value");var _34=dj.byId("AmountRangevisible").get("value");var _35=false;var _36=dj.byId("AmountRangevisible");var _37=dj.byId("AmountRange2visible");if(_34>_33){displayMessage=misys.getLocalization("invalidMaxAmountValueError");_35=true;}else{if(_33<0){displayMessage=misys.getLocalization("invalidAmountValueError");_35=true;}else{if(_34<0){displayMessage=misys.getLocalization("invalidAmountValueError");_36.focus();_36.set("state","Error");dj.hideTooltip(_36.domNode);dj.showTooltip(displayMessage,_36.domNode,0);dj.showTooltip(displayMessage,domNode,0);return false;}}}if(_35){_37.focus();_37.set("state","Error");dj.hideTooltip(_37.domNode);dj.showTooltip(displayMessage,_37.domNode,0);dj.showTooltip(displayMessage,domNode,0);return false;}return true;};function _19(){if(dj.byId("AmountRangevisible")){var _38=dj.byId("AmountRangevisible").value;var _39=isNaN(_38)?0:_38;dj.byId("AmountRange").set("value",_38);var _3a=dj.byId("AmountRange2visible").value;dj.byId("AmountRange2").set("value",_3a);}};})(dojo,dijit,misys);dojo.require("misys.client.binding.openaccount.listdef_ip_approvedfinancing_registration_client");}