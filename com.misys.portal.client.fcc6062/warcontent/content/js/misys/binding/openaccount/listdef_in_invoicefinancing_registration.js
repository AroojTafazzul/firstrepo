/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.openaccount.listdef_in_invoicefinancing_registration"]){dojo._hasResource["misys.binding.openaccount.listdef_in_invoicefinancing_registration"]=true;dojo.provide("misys.binding.openaccount.listdef_in_invoicefinancing_registration");dojo.require("dojo.data.ItemFileReadStore");dojo.require("dojo.data.ItemFileWriteStore");dojo.require("dijit.form.FilteringSelect");dojo.require("misys.form.MultiSelect");dojo.require("dijit.layout.TabContainer");dojo.require("misys.form.common");dojo.require("misys.openaccount.StringUtils");dojo.require("misys.validation.common");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.layout.ContentPane");dojo.require("misys.form.CurrencyTextBox");dojo.require("misys.binding.common.listdef_mc");dojo.require("misys.binding.common.reauth_listdef_common");dojo.require("misys.binding.system.reauth");dojo.require("misys.binding.common.reauth_listdef");(function(d,dj,m){function _1(){var _2=false,_3=[];d.query(".dojoxGrid").forEach(function(g){_3.push(dj.byId(g.id));});d.forEach(_3,function(_4){if(_4.selection.getSelected().length>0){_2=true;}});return _2;};d.subscribe("ready",function(){m._config=(m._config)||{};m._config.cellNodeReference;d.query(".dojoxGrid").forEach(function(_5){if(_5.id!=="nonSignedFolders"){m.connect(_5.id,"onRowMouseOver",m._config.mouseOverShowTermsAndConditions);m.connect(_5.id,"onRowMouseOut",m._config.mouseOutHideTermsAndConditions);m.connect(dj.byId(_5.id).selection,"onSelected",m._config.showTermsAndConditions);m.connect(dj.byId(_5.id).selection,"onDeselected",m._config.hideTermsAndConditions);m.connect(_5.id,"onRowClick",m._config.storeCellNodeReference);m.connect(_5.id,"onHeaderCellClick",function(_6){if(m._config.cellNodeReference&&m._config.cellNodeReference.cellNode){dj.hideTooltip(m._config.cellNodeReference.cellNode);m._config.cellNodeReference.cellNode=null;}});}});});d.mixin(m,{bind:function(){m.setValidation("cur_code",m.validateCurrency);m.connect("cur_code","onChange",_7);m.connect("cur_code","onChange",function(){misys.setCurrency(this,["AmountRange","AmountRange2"]);});m.connect("submitButton","onClick",_8);}});d.mixin(m._config,{saveOpenAccount:function(_9){var _a=[],_b="",_c="";if(dj.byId("nonSignedFolders")){if(dijit.byId("nonSignedFolders").selection.selectedIndex!==-1){if(dj.byId("referenceid")){_b=dj.byId("referenceid").get("value");}if(dj.byId("tnxid")){_c=dj.byId("tnxid").get("value");}}}d.query(".dojoxGrid").forEach(function(g){_a.push(dj.byId(g.id));});m.grid.processRecords(_a,"/screen/AjaxScreen/action/RunGroupSubmission?s=InvoiceScreen&operation=SAVE&option=IP_FOLDER&mode=DRAFT&tnxtype=01&referenceid="+_b+"&tnxid="+_c+"&programcode="+_9);},submitOpenAccount:function(_d){var _e=[],_f="",_10="",_11={},_12=dj.byId("reauth_perform");m._config.programcode=_d;if(_1()){if(_12&&_12.get("value")==="Y"){if(d.isFunction(m._config.initReAuthParams)){_11=m._config.initReAuthParams();m._config.executeReauthentication(_11);}else{m.setContentInReAuthDialog("ERROR","");dj.byId("reauth_dialog").show();}}else{m._config.nonReauthSubmit();}}else{m.dialog.show("ERROR",m.getLocalization("noTransactionsSelectedError"));}},showTermsAndConditions:function(_13){var _14;if(this.grid.store._items[_13]&&this.grid.store._items[_13].i){_14=this.grid.store._items[_13].i["MyParty@ObjectDataClob@conditions_03"];_14=m.replaceCarriageReturn(_14,"<br>");}if(m._config.cellNodeReference&&m._config.cellNodeReference.cellNode&&m._config.cellNodeReference.cellIndex===0){dj.hideTooltip(m._config.cellNodeReference.cellNode);dj.showTooltip(_14,m._config.cellNodeReference.cellNode,0);}},mouseOverShowTermsAndConditions:function(evt){if(this.selection.selected[evt.rowIndex]&&this.selection.selected[evt.rowIndex]===true&&evt.cellIndex===0){var _15;_15=this.store._items[evt.rowIndex].i["MyParty@ObjectDataClob@conditions_03"];_15=m.replaceCarriageReturn(_15,"<br>");dj.showTooltip(_15,evt.cellNode,0);}},mouseOutHideTermsAndConditions:function(evt){dj.hideTooltip(evt.cellNode);},storeCellNodeReference:function(evt){m._config.cellNodeReference=evt;},hideTermsAndConditions:function(evt){if(m._config.cellNodeReference&&m._config.cellNodeReference.cellNode){dj.hideTooltip(m._config.cellNodeReference.cellNode);}},initReAuthParams:function(){var _16={productCode:"IFR",subProductCode:"",transactionTypeCode:"01",entity:"",currency:"",amount:"",es_field1:"",es_field2:""};return _16;},reauthSubmit:function(){var _17=dj.byId("reauth_password").get("value"),_18="",_19="",_1a=[];var _1b=[];_1b.push("&reauth_otp_response=",misys.encryptText(_17));if(dj.byId("nonSignedFolders")){if(dijit.byId("nonSignedFolders").selection.selectedIndex!==-1){if(dj.byId("referenceid")){_18=dj.byId("referenceid").get("value");}if(dj.byId("tnxid")){_19=dj.byId("tnxid").get("value");}}}var url="/screen/AjaxScreen/action/RunGroupSubmission?s=InvoiceScreen&operation=SUBMIT&option=IP_FOLDER&mode=DRAFT&tnxtype=01&referenceid="+_18+"&tnxid="+_19+"&programcode="+m._config.programcode;d.query(".dojoxGrid").forEach(function(g){_1a.push(dj.byId(g.id));});m.grid.processRecords(_1a,url+_1b.join(""));},nonReauthSubmit:function(){var _1c=[],_1d="",_1e="";if(dj.byId("nonSignedFolders")){if(dijit.byId("nonSignedFolders").selection.selectedIndex!==-1){if(dj.byId("referenceid")){_1d=dj.byId("referenceid").get("value");}if(dj.byId("tnxid")){_1e=dj.byId("tnxid").get("value");}}}d.query(".dojoxGrid").forEach(function(g){_1c.push(dj.byId(g.id));});var url="/screen/AjaxScreen/action/RunGroupSubmission?s=InvoiceScreen&operation=SUBMIT&option=IP_FOLDER&mode=DRAFT&tnxtype=01&referenceid="+_1d+"&tnxid="+_1e+"&programcode="+m._config.programcode;m.grid.processRecords(_1c,url);}});function _7(){if(dj.byId("cur_code").value!==""){dj.byId("AmountRangevisible").set("disabled",false);dj.byId("AmountRange2visible").set("disabled",false);}else{if(dj.byId("cur_code").value===""){dj.byId("AmountRangevisible").set("disabled",true);dj.byId("AmountRange2visible").set("disabled",true);dj.byId("AmountRangevisible").reset();dj.byId("AmountRange2visible").reset();}}};function _8(){if(dj.byId("AmountRangevisible")){var _1f=dj.byId("AmountRangevisible").value;var _20=isNaN(_1f)?0:_1f;dj.byId("AmountRange").set("value",_1f);var _21=dj.byId("AmountRange2visible").value;dj.byId("AmountRange2").set("value",_21);}};})(dojo,dijit,misys);dojo.require("misys.client.binding.openaccount.listdef_in_invoicefinancing_registration_client");}