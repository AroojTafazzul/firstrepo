/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.create_subscription"]){dojo._hasResource["misys.binding.create_subscription"]=true;dojo.provide("misys.binding.create_subscription");dojo.require("misys.form.MultiSelect");dojo.require("dijit.form.FilteringSelect");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.layout.ContentPane");dojo.require("misys.validation.common");dojo.require("misys.form.common");dojo.require("dojox.xml.DomParser");(function(d,dj,m){function _1(_2){var _3=dojo.byId("products-attached-to-subscription-package");if(this.get&&this.get("value")!=="01"){misys.animate("fadeOut",_3);var _4=dj.byId("product_list");var _5=dj.byId("avail_list_nosend");_4.reset();_4.invertSelection();misys.addMultiSelectItems(_5,_4);_5.reset();}else{misys.animate("fadeIn",_3);}};function _6(_7,_8){var _9=_7.getElementsByTagName(_8)[0],_a=(_9)?_9.childNodes[0]:"",_b=(_a)?_a.nodeValue.split(","):[],_c=["<existing_permissions>"];dojo.forEach(dojo.query("option",dijit.byId(_8).domNode),function(_d){_c.push("<permission_desc_record><permission>",_d.value,"</permission></permission_desc_record>");});_c.push("</existing_permissions>");return _c.join("");};function _e(_f,_10,_11){var _12=_f.getElementsByTagName(_10)[0],_13=_f.getElementsByTagName(_11)[0],_14="",_15="",_16=[];if(_12){_14=_12.childNodes[0];if(_14&&_14.nodeValue){_15=_14.nodeValue;}}_16.push("<group_record><group_abbv_name>",_15,"</group_abbv_name>");if(dijit.byId(_11)){if(/dijit.form.FilteringSelect/.test(dijit.byId(_11).declaredClass)){if("S"+dijit.byId(_11).get("value")!="S"){_16.push("<existing_roles><role><name>",dijit.byId(_11).get("value"),"</name></role></existing_roles>");}}else{dojo.forEach(dojo.query("option",dijit.byId(_11).domNode),function(_17){_16.push("<existing_roles><role><name>",_17.value,"</name></role></existing_roles>");});}}_16.push("</group_record>");return _16.join("");};d.mixin(m,{bind:function(){m.setValidation("sp_code",m.validateCharacters);m.setValidation("sp_description",m.validateCharacters);m.setValidation("charging_cur_code",m.validateCurrency);m.connect("charging_cur_code","onChange",function(){m.setCurrency(this,["charging_amt"]);});m.connect("add","onClick",function(){m.addMultiSelectItems(dj.byId("product_list"),dj.byId("avail_list_nosend"));});m.connect("remove","onClick",function(){m.addMultiSelectItems(dj.byId("avail_list_nosend"),dj.byId("product_list"));});},onFormLoad:function(){m.setCurrency(dj.byId("charging_cur_code"),["charging_amt"]);var _18=dojo.hitch(dj.byId("roletype"),_1);_18();if(dj.byId("charging_cur_code")&&dj.byId("charging_cur_code").get("value")===""){dj.byId("charging_cur_code").set("value",dj.byId("base_currency_nosend").get("value"));}}});m._config=m._config||{};d.mixin(m._config,{xmlTransform:function(xml){var _19=dj.byId("group_record"),_1a="subscription_package",_1b="",_1c=m._config.xmlTagName,_1d=_1c?["<",_1c,">"]:[],dom=dojox.xml.DomParser.parse(xml);if(dijit.byId("return_comments")){_1b=dijit.byId("return_comments").get("value");}_1d.push("<",_1a,">");_1d.push(m.getDomNode(dom,"subscription_code"));_1d.push(m.getDomNode(dom,"subscription_description"));_1d.push(m.getDomNode(dom,"charging_cur_code"));_1d.push(m.getDomNode(dom,"charging_amt"));_1d.push(m.getDomNode(dom,"local_tax"));_1d.push(m.getDomNode(dom,"creation_date"));_1d.push(m.getDomNode(dom,"last_maintenance_date"));_1d.push(m.getDomNode(dom,"last_maintenance_user"));_1d.push(m.getDomNode(dom,"last_maintenance_user"));_1d.push(m.getDomNode(dom,"lastMaintenanceUserName"));_1d.push("<return_comments>",_1b,"</return_comments>");_1d.push("</",_1a,">");var _1e="entity";_1d.push(_e(dom,_1e+"_group_abbv_name","entity_role_list"));if(_1c){_1d.push("</",_1c,">");}return _1d.join("");}});})(dojo,dijit,misys);}