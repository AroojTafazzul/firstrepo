/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.SessionTimer"]){dojo._hasResource["misys.binding.SessionTimer"]=true;dojo.provide("misys.binding.SessionTimer");dojo.require("dijit.form.Button");(function(d,m){function _1(){var _2=dijit.byId("sessionMaxDurationOverDialog");var _3=dojo.byId("sessionMaxDurationOverDialogButtons"),_4=dijit.byId("sessionMaxDurationOverButton").domNode;var _5=dojo.byId("sessionMaxDurationOverDialogContent");dojo.style(_3,"display","block");dojo.style(_5,"display","block");dojo.style(_4,"display","inline-block");dojo.style(_2.closeButtonNode,"display","none");_2.set("title",misys.getLocalization("sessionalertMessage"));misys.dialog.connect(_2,"onKeyPress",function(_6){if(_6.keyCode==dojo.keys.ESCAPE){dojo.stopEvent(_6);}});misys.dialog.connect(dijit.byId("sessionMaxDurationOverButton"),"onClick",function(){misys.dialog.disconnect(_2);_2.hide();document.location.href=dojo.byId("loginAction").value;},_2.id);misys.dialog.connect(_2,"onHide",function(){misys.dialog.disconnect(_2);});_2.show();};function _7(){var _8=dijit.byId("idleSessionDialog");var _9=dojo.byId("idleSessionDialogButtons"),_a=dijit.byId("sessionContinueButton").domNode,_b=dijit.byId("sessionlogButton").domNode;var _c=dojo.byId("idleSessionDialogContent");dojo.style(_9,"display","block");dojo.style(_c,"display","block");dojo.style(_a,"display","inline-block");dojo.style(_b,"display","inline-block");dojo.style(_8.closeButtonNode,"display","none");_8.set("title",misys.getLocalization("sessionalertMessage"));misys.dialog.connect(_8,"onKeyPress",function(_d){if(_d.keyCode==dojo.keys.ESCAPE){dojo.stopEvent(_d);}});misys.dialog.connect(dijit.byId("sessionContinueButton"),"onClick",function(){var _e=false;misys.xhrGet({url:misys.getServletURL("/screen/AjaxScreen/action/PingAction"),sync:true,handleAs:"text",load:function(_f,_10){if(_f.indexOf("SC_UNAUTHORIZED")!==-1){_e=true;}},customError:function(_11,_12){_e=true;}});if(_e){misys.showSessionOverDialog();misys.dialog.disconnect(_8);_8.hide();}else{misys.idleSessionTimer(0);misys.dialog.disconnect(_8);_8.hide();}},_8.id);misys.dialog.connect(dijit.byId("sessionlogButton"),"onClick",function(){misys.dialog.disconnect(_8);_8.hide();if(dojo.byId("_token")&&dojo.byId("logoutAction")){misys.post({action:dojo.byId("logoutAction").value,params:[{name:"commonToken",value:dojo.byId("_token").value}]});}},_8.id);misys.dialog.connect(_8,"onHide",function(){misys.dialog.disconnect(_8);});_8.show();};function _13(){var _14=dijit.byId("durationSessionDialog");var _15=dojo.byId("durationSessionDialogButtons"),_16=dijit.byId("OkSessionButton").domNode;var _17=dojo.byId("durationSessionDialogContent");dojo.style(_15,"display","block");dojo.style(_17,"display","block");dojo.style(_16,"display","inline-block");dojo.style(_14.closeButtonNode,"display","none");_14.set("title",misys.getLocalization("sessionalertMessage"));misys.dialog.connect(_14,"onKeyPress",function(evt){if(evt.keyCode==dojo.keys.ESCAPE){dojo.stopEvent(evt);}});misys.dialog.connect(dijit.byId("OkSessionButton"),"onClick",function(){var _18=true;misys.xhrGet({url:misys.getServletURL("/screen/AjaxScreen/action/PingAction"),sync:true,handleAs:"text",load:function(_19,_1a){if(_19.indexOf("SC_UNAUTHORIZED")===-1){_18=false;}},customError:function(_1b,_1c){_18=false;}});if(_18){misys.showSessionOverDialog();misys.dialog.disconnect(_14);_14.hide();}else{misys.dialog.disconnect(_14);_14.hide();}},_14.id);misys.dialog.connect(_14,"onHide",function(){misys.dialog.disconnect(_14);});_14.show();misys.startAutoLogoutCounter(misys._config.sessionMaxDurationTimeAlert);};d.mixin(m,{showSessionOverDialog:function(){var _1d=dijit.byId("sessionOverDialog");var _1e=dojo.byId("sessionOverDialogButtons"),_1f=dijit.byId("sessionOverButton").domNode;var _20=dojo.byId("sessionOverDialogContent");dojo.style(_1e,"display","block");dojo.style(_20,"display","block");dojo.style(_1f,"display","inline-block");dojo.style(_1d.closeButtonNode,"display","none");_1d.set("title",misys.getLocalization("sessionalertMessage"));misys.dialog.connect(_1d,"onKeyPress",function(evt){if(evt.keyCode==dojo.keys.ESCAPE){dojo.stopEvent(evt);}});misys.dialog.connect(dijit.byId("sessionOverButton"),"onClick",function(){misys.dialog.disconnect(_1d);_1d.hide();if(dojo.byId("customLoginAction")&&dojo.byId("customLoginAction").value){document.location.href=dojo.byId("customLoginAction").value;}else{document.location.href=dojo.byId("loginAction").value;}},_1d.id);misys.dialog.connect(_1d,"onHide",function(){misys.dialog.disconnect(_1d);});_1d.show();},startAutoLogoutCounter:function(_21){var _22=dijit.byId("durationSessionDialog");if(_21<=misys._config.sessionMaxDurationTime){_21=_21+1;setTimeout("misys.startAutoLogoutCounter("+_21+")",1000);}else{_21=0;var _23=false;misys.xhrGet({url:misys.getServletURL("/screen/AjaxScreen/action/PingAction"),sync:true,handleAs:"text",load:function(_24,_25){if(_24.indexOf("SC_UNAUTHORIZED")!==-1){_23=true;}},customError:function(_26,_27){_23=true;}});if(_23){misys.showSessionOverDialog();misys.dialog.disconnect(_22);_22.hide();}else{_1();misys.dialog.disconnect(_22);_22.hide();}}},idleSessionTimer:function(_28){if(dojo.byId("idleSessionTimeOutIndicator")){if(_28<=(misys._config.idleSessionTimeOutTime)){_28=_28+1;setTimeout("misys.idleSessionTimer("+_28+")",1000);}else{if(!misys._config.stopIdleSessionTimer){_28=0;_7();}}}},durationSessionTimer:function(_29){if(dojo.byId("sessionMaxDurationIndicator")){var _2a=misys._config.presentTime-misys._config.loginTime;_2a=Math.floor(_2a/1000);var _2b=misys._config.sessionMaxDurationTimeAlert;var _2c=_2b-_2a;if(_29<=(_2c)){_29=_29+1;setTimeout("misys.durationSessionTimer("+_29+")",1000);}else{_29=0;_13();misys._config.stopIdleSessionTimer=true;var _2d=dijit.byId("idleSessionDialog");if(_2d){_2d.hide();}}}}});})(dojo,misys);}