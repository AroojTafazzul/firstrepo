/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.treasury.create_td_trtd"]){dojo._hasResource["misys.binding.treasury.create_td_trtd"]=true;dojo.provide("misys.binding.treasury.create_td_trtd");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("misys.form.DateTermField");dojo.require("misys.form.DateOrTermField");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.layout.ContentPane");dojo.require("dojo.data.ItemFileReadStore");dojo.require("dijit.form.DateTextBox");dojo.require("dijit.form.CurrencyTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("misys.form.SimpleTextarea");dojo.require("dojo.parser");dojo.require("dojo.date");dojo.require("misys.widget.Collaboration");dojo.require("misys.binding.cash.common.request_action");dojo.require("misys.binding.treasury.FtPopupManagement");(function(d,dj,m){var _1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16;function _17(_18,_19){var _1a="";switch(_18){case 3:_1a=m.getLocalization("errorTDRejected");if(_19.trader_remarks!=null&&_19.trader_remarks.length!=0){_1a+="<br><br>"+m.getLocalization("traderRemarks")+_19.trader_remarks;}break;default:_1a=m.getCommonMessageError(_18,_19);break;}m.dialog.show("ERROR",_1a);m.toggleEnableFields();};function _1b(){var _1c=_1d();d.forEach(_1c,function(id){if(dj.byId(id)){dj.byId(id).reset();}});};function _1d(){var _1e=["applicant_act_name","input_td_cur_code","input_td_amt","input_value_code","input_maturity_code","remarks","issuing_bank_customer_reference"];return _1e;};function _1f(_20){d.query("#trade_id_report_row .content")[0].innerHTML=_20.trade_id;d.query("#rate_report_row .content")[0].innerHTML=_20.rate;d.query("#interest_report_row .content")[0].innerHTML=_20.interest;d.query("#value_date_report_row .content")[0].innerHTML=_20.value_date;d.query("#maturity_date_report_row .content")[0].innerHTML=_20.maturity_date;d.query("#trader_remarks_report_row .content")[0].innerHTML=_20.trader_remarks;dj.byId("trade_id").set("value",_20.trade_id);dj.byId("rec_id").set("value",_20.rec_id);dj.byId("remarks").set("value",_20.remarks);_1=_20.trade_id;_3=_20.rec_id;dj.byId("rate").set("value",_20.rate);dj.byId("maturity_date").set("value",_20.maturity_date);dj.byId("value_date").set("value",_20.value_date);dj.byId("td_cur_code").set("value",_20.currency);dj.byId("td_amt").set("value",_20.amount);dj.byId("interest").set("value",_20.interest);dj.byId("trader_remarks").set("value",_20.trader_remarks);if(_20.trader_remarks===null||_20.trader_remarks.length===0){if(dojo.byId("traderRemarksContainer")){dojo.style(dojo.byId("traderRemarksContainer"),"display","none");}}else{if(dojo.byId("traderRemarksContainer")){dojo.style(dojo.byId("traderRemarksContainer"),"display","");}}};d.mixin(m._config,{initReAuthParams:function(){var _21={productCode:"TD",subProductCode:"TRTD",transactionTypeCode:"01",entity:dj.byId("entity")?dj.byId("entity").get("value"):"",currency:dj.byId("td_cur_code")?dj.byId("td_cur_code").get("value"):"",amount:dj.byId("td_amt")?m.trimAmount(dj.byId("td_amt").get("value")):"",bankAbbvName:dj.byId("issuing_bank_abbv_name")?dj.byId("issuing_bank_abbv_name").get("value"):"",es_field1:dj.byId("td_amt")?m.trimAmount(dj.byId("td_amt").get("value")):"",es_field2:""};return _21;}});d.mixin(m,{bind:function(){m.connect("cancelDelayDialogButton","onClick",m.performClear("delayDialog"));m.connect("buttonAcceptRequest","onClick",m.acceptRate);m.connect("buttonCancelRequest","onClick",m.fncPerformCancelRequest);m.setValidation("remarks",m.validateAlphaNumericRemarks);m.setValidation("input_td_cur_code",m.validateCurrency);m.connect("input_td_cur_code","onChange",function(){m.setCurrency(this,["input_td_amt"]);});m.setValidation("input_value_date",function(){return m.validateDate("input_value","","startDateLessThanDateOfDayError",false)&&m.validateDate("input_value","input_maturity","startDateGreaterThanMaturityDateError",true,dj.byId("input_value_date"));});m.setValidation("input_maturity_date",function(){return m.validateDate("input_maturity","","maturityDateLessThanDateOfDayError",false)&&m.validateDate("input_value","input_maturity","maturityDateSmallerThanStartDateError",true,dj.byId("input_value_date"));});m.connect("issuing_bank_abbv_name","onChange",m.populateReferences);if(dj.byId("issuing_bank_abbv_name")){m.connect("entity","onChange",function(){dj.byId("issuing_bank_abbv_name").onChange();});}m.connect("issuing_bank_customer_reference","onChange",m.setApplicantReference);m.setValidation("input_value_number",function(){return m.validateTermNumber("input_value","","TermCodeError",false);});m.setValidation("input_maturity_number",function(){return m.validateTermNumber("input_maturity","","TermCodeError",false);});m.connect("input_td_amt","onBlur",function(){m.amountValidationForZero(dj.byId("input_td_amt"));});m.connect("entity","onChange",_1b);},onFormLoad:function(){dj.byId("td_type").set("value","SCRATCH");var _22=dj.byId("issuing_bank_abbv_name");if(_22){_22.onChange();}var _23=dj.byId("issuing_bank_customer_reference");if(_23){_23.onChange();_23.set("value",_23._resetValue);}m.fncDisableLoadingDialogClosing();},fncPerformRequest:function(){if(m.checkFields()){m.doPerformRequest();}},initVar:function(){_2=dj.byId("ref_id").get("value");if(dj.byId("applicant_reference")){_4=dj.byId("applicant_reference").get("value");}else{_4="";}_5=dj.byId("remarks").get("value");_f="SCRATCH";_e=dj.byId("input_td_cur_code").get("value");_10=dj.byId("input_td_amt").get("value");_11=dj.byId("input_value").getDate();_12=dj.byId("input_value").getNumber();_13=dj.byId("input_value").getCode();_14=dj.byId("input_maturity").getDate();_15=dj.byId("input_maturity").getNumber();_16=dj.byId("input_maturity").getCode();},getRate:function(){m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/TreasuryRequestForQuoteSearchAction"),handleAs:"json",content:{operation:"REQUEST",ref_id:_2,applicant_reference:_4,td_type:_f,td_cur_code:_e,td_amt:_10,value_date:_11,value_days:_12,value_period:_13,remarks:_5,maturity_date:_14,maturity_days:_15,maturity_period:_16,bank:dj.byId("issuing_bank_abbv_name").get("value"),productcode:"TD",subproductcode:"TRTD"},load:function(_24,_25){dj.byId("loadingDialog").hide();var _26=_24.status;switch(_26){case 5:_1f(_24);validity=_24.validity;m.countDown(validity);m.showDetailField();break;case 6:_1=_24.trade_id;_3=_24.rec_id;m.frequencyStore=_24.delay_frequency;m.opicsFrequencyResponse=_24.delay_frequency;m.delayStore=_24.delay_timeout;m.openDelayDialog(m.frequencyStore,m.delayStore);break;default:undefined;_17(_26,_24);break;}},customError:function(_27,_28){dj.byId("loadingDialog").hide();_17(_27.status,_27);}});},performDelayRequest:function(){if(m.frequencyStore>0){m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/TreasuryRequestForQuoteSearchAction"),handleAs:"json",content:{operation:"DELAY",ref_id:_2,rec_id:_3,applicant_reference:_4,td_type:_f,td_cur_code:_e,td_amt:_10,value_date:_11,value_days:_12,value_period:_13,remarks:_5,maturity_date:_14,maturity_days:_15,maturity_period:_16,bank:dj.byId("issuing_bank_abbv_name").get("value"),productcode:"TD",subproductcode:"TRTD"},load:function(_29,_2a){var _2b=_29.status;switch(_2b){case 5:_1f(_29);m.closeDelayDialog();var _2c=_29.validity;m.countDown(_2c);m.showDetailField();break;case 6:_3=_29.rec_id;m.frequencyStore--;m.timer=setTimeout("misys.performDelayRequest()",(m.delayStore*1000));break;default:m.closeDelayDialog();_17(_2b,_29);break;}},customError:function(_2d,_2e){console.error("[TradeCreateTdAjaxCall] error retrieving quote");_17(_2d.status,_2d);}});}else{m.stopCountDown(m.timer);m.showContinuationElement();}},performCancelDelayRequest:function(){dj.byId("buttonAcceptRequest").set("disabled",false);m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/TreasuryRequestForQuoteSearchAction"),handleAs:"json",content:{operation:"CANCEL",ref_id:_2,applicant_reference:dj.byId("applicant_reference").get("value"),trade_id:_1,td_type:_f,rec_id:_3,bank:dj.byId("issuing_bank_abbv_name").get("value"),productcode:"TD",subproductcode:"TRTD"},load:function(_2f,_30){var _31=_2f.status;switch(_31){case 7:m.dialog.show("CUSTOM-NO-CANCEL",m.getLocalization("confirmationCancelRequest"),m.getLocalization("confirmationCancelTitle"));break;default:_17(_31,_2f);break;}},customError:function(_32,_33){console.error("[TdAjaxCall] error retrieving quote");m.dialog.show("ERROR",m.getLocalization("technicalError"));m.performClear();}});},cancelRequest:function(){dj.byId("buttonAcceptRequest").set("disabled",false);m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/TreasuryRequestForQuoteSearchAction"),handleAs:"json",content:{operation:"REJECT",ref_id:_2,applicant_reference:dj.byId("applicant_reference").get("value"),trade_id:_1,td_type:_f,rec_id:_3,bank:dj.byId("issuing_bank_abbv_name").get("value"),productcode:"TD",subproductcode:"TRTD"},load:function(_34,_35){m.toggleEnableFields();m.performClearDetails();},customError:function(_36,_37){console.error("[TdAjaxCall] error retrieving quote");m.dialog.show("ERROR",m.getLocalization("technicalError"));m.performClear();}});},getDisabledFields:function(){var _38=["issuing_bank_customer_reference","trade_id","issuing_bank_abbv_name","input_td_cur_code","input_td_amt","input_td_amt_img","dijit_form_Button_2","dijit_form_Button_3","request_button","request_clear_button","input_value","input_maturity","remarks","input_value_number","input_maturity_number","input_value_code","input_maturity_code","entity_img","applicant_name","applicant_address_line_1","applicant_address_line_2","applicant_dom","input_maturity_date","input_value_date"];return _38;},getEnabledFields:function(){return m.getDisabledFields();},getHiddenFieldsToClear:function(){var _39=["td_cur_code","td_amt","rate","value_date","maturity_date","trader_remarks"];return _39;},getFieldsToClear:function(){var _3a=["cust_ref_id","trade_id","issuing_bank_abbv_name","input_td_cur_code","input_td_amt","input_value","input_maturity","remarks"];return _3a;},getDateTermFieldsToClear:function(){var _3b=["input_value","input_maturity"];return _3b;},amountValidationForZero:function(_3c){var _3d;var _3e=_3c.get("value");if(_3e===0){_3d=m.getLocalization("amountcannotzero");_3c.set("state","Error");dj.hideTooltip(_3c.domNode);dj.showTooltip(_3d,_3c.domNode,0);return false;}}});})(dojo,dijit,misys);dojo.require("misys.client.binding.treasury.create_td_trtd_client");}