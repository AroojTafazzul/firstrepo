/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.treasury.create_ft_trtpt"]){dojo._hasResource["misys.binding.treasury.create_ft_trtpt"]=true;dojo.provide("misys.binding.treasury.create_ft_trtpt");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("misys.form.DateTermField");dojo.require("misys.form.DateOrTermField");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.layout.ContentPane");dojo.require("dojo.data.ItemFileReadStore");dojo.require("dijit.form.DateTextBox");dojo.require("dijit.form.CurrencyTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("misys.form.SimpleTextarea");dojo.require("dojo.parser");dojo.require("dojo.date");dojo.require("misys.widget.Collaboration");dojo.require("misys.binding.cash.common.request_action");dojo.require("misys.binding.common");dojo.require("misys.binding.treasury.FtPopupManagement");dojo.require("misys.binding.cash.common.standing_instruction_action");(function(d,dj,m){var _1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_1a,_1b,_1c,_1d,_1e,_1f,_20,_21,_22,_23,_24,_25,_26,_27,_28,_29,_2a,_2b,_2c,_2d,_2e,_2f,_30,_31,_32,_33,_34,_35,_36,_37,_38,_39,_3a,_3b,_3c,_3d,_3e,_3f,_40,_41,_42,_43,_44,_45,_46,_47,_48,_49,_4a,_4b,_4c,_4d,_4e,_4f,_50,_51,_52,_53,_54,_55,_56,_57,_58,_59,_5a,_5b=false,_5c;function _5d(){dj.byId("applicant_cur_code").set("value",dj.byId("applicant_act_cur_code").get("value"));dj.byId("payment_cur_code").set("value",dj.byId("applicant_act_cur_code").get("value"));if(dj.byId("applicant_cur_code")&&dj.byId("applicant_cur_code").get("value")!==""){dj.byId("applicant_cur_code").set("disabled",true);}};function _5e(){if(_5b===false){_5b=true;_5f();}else{m.dialog.show("CONFIRMATION",m.getLocalization("clearMessage"),"",function(){_5f();});}};function _5f(){dj.byId("instructions_type").set("value",dj.byId("instructions_type_1").value);dj.byId("beneficiary_name").set("value","");dj.byId("beneficiary_address").set("value","");dj.byId("beneficiary_city").set("value","");dj.byId("beneficiary_country").set("value","");dj.byId("beneficiary_account").set("value","");dj.byId("beneficiary_bank").set("value","");dj.byId("beneficiary_bank_city").set("value","");dj.byId("beneficiary_name").set("disabled",true);dj.byId("beneficiary_address").set("disabled",true);dj.byId("beneficiary_city").set("disabled",true);dj.byId("beneficiary_country").set("disabled",true);dj.byId("beneficiary_account").set("disabled",true);dj.byId("beneficiary_bank").set("disabled",true);dj.byId("beneficiary_bank_city").set("disabled",true);m.performClear(null,3,false);m.changeRequiredFieldsOnPaymentTypeChange(null,false);d.style("free_format_field",{"display":"none"});d.style("bank_instruction_field",{"display":"block"});m.requestStandingInstructions();};function _60(){if(_5b===false){_5b=true;_61();}else{m.dialog.show("CONFIRMATION",m.getLocalization("clearMessage"),"",function(){_61();});}};function _61(){dj.byId("instructions_type").set("value",dj.byId("instructions_type_2").value);dj.byId("beneficiary_name").set("disabled",false);dj.byId("beneficiary_address").set("disabled",false);dj.byId("beneficiary_city").set("disabled",false);dj.byId("beneficiary_country").set("disabled",false);dj.byId("beneficiary_account").set("disabled",false);dj.byId("beneficiary_bank").set("disabled",false);dj.byId("beneficiary_bank_city").set("disabled",false);m.performClear(null,2,false);m.changeRequiredFieldsOnPaymentTypeChange(null,false);d.style("free_format_field",{"display":"block"});d.style("bank_instruction_field",{"display":"none"});d.style("freeformatbeneficiary",{"display":"block"});d.style("freeformataddlinstructions",{"display":"block"});d.style("freeformatpaymentdetails",{"display":"block"});d.style("bankPayment",{"display":"none"});misys._populateSwiftFields();if(dj.byId("beneficiary_name").get("state")==="Error"){dj.byId("beneficiary_name").set("state","Incomplete");}if(dj.byId("beneficiary_address").get("state")==="Error"){dj.byId("beneficiary_address").set("state","Incomplete");}if(dj.byId("beneficiary_address_2").get("state")==="Error"){dj.byId("beneficiary_address_2").set("state","Incomplete");}if(dj.byId("beneficiary_city").get("state")==="Error"){dj.byId("beneficiary_city").set("state","Incomplete");}if(dj.byId("beneficiary_account").get("state")==="Error"){dj.byId("beneficiary_account").set("state","Incomplete");}if(dj.byId("beneficiary_bank").get("state")==="Error"){dj.byId("beneficiary_bank").set("state","Incomplete");}if(dj.byId("beneficiary_bank_country").get("state")==="Error"){dj.byId("beneficiary_bank_country").set("state","Incomplete");}if(dj.byId("beneficiary_country").get("state")==="Error"){dj.byId("beneficiary_country").set("state","Incomplete");}if(dj.byId("beneficiary_bank_city").get("state")==="Error"){dj.byId("beneficiary_bank_city").set("state","Incomplete");}};function _62(){dj.byId("loadingDialog").show();m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/TreasuryRequestForQuoteSearchAction"),handleAs:"json",content:{operation:"REQUESTINSTRUCTIONS",ft_type:"02",applicant_reference:_5,ordering_account:_1a,transfer_account:_20,transfer_amount:_21,transfer_currency:_22,beneficiary_account:_23,beneficiary_name:_25,beneficiary_address:_26,beneficiary_address_2:_27,beneficiary_city:_28,beneficiary_country:_29,beneficiary_bank:_2a,bene_details_clrc:_58,beneficiary_bank_routing_number:_2b,beneficiary_bank_branch:_2c,beneficiary_bank_address:_2d,beneficiary_bank_city:_2e,beneficiary_bank_country:_2f,beneficiary_bank_clrc:_57,beneficiary_bank_bic:_30,ordering_cust_name:_32,ordering_cust_address:_33,ordering_cust_address_2:_34,ordering_cust_citystate:_35,ordering_cust_country:_36,ordering_cust_account:_37,order_details_clrc:_59,ft_amount:_1e,ft_cur_code:_1f,execution_date:_1c,execution_tenor:_1d,payment_amount:_39,remarks:_9,fee_account:_3a,feeCurCode:_3b,feeAmt:_3c,swift_charges_type:_3e,intermediary_bank:_3f,intermediary_bank_aba:_40,intermediary_bank_bic:_41,intermediary_bank_street:_42,intermediary_bank_street_2:_43,intermediary_bank_city:_44,intermediary_bank_country:_45,inter_bank_clrc:_5a,intermediary_bank_instruction_1:_46,intermediary_bank_instruction_2:_47,intermediary_bank_instruction_3:_48,intermediary_bank_instruction_4:_49,intermediary_bank_instruction_5:_4a,intermediary_bank_instruction_6:_4b,additional_detail_1:_4c,additional_detail_2:_4d,additional_detail_3:_4e,additional_detail_4:_4f,bank:dj.byId("issuing_bank_abbv_name").get("value"),ordering_currency:dj.byId("applicant_act_cur_code").get("value"),payment_currency:dj.byId("payment_cur_code").get("value"),productcode:"FT",subproductcode:_1},load:function(_63,_64){dj.byId("loadingDialog").hide();var _65=_63.status;switch(_65){case 7205:m.closeDealSummaryDialog();_6c(_65,_63);break;default:var _66=misys._config;var _67;_67={items:_63.receipts};_5c=_67;var _68=m._fncConstructBankPaymentGrid(_67,"bankPaymentGrid","receipt_instructions_id");if(document.getElementById("mode").value=="UNSIGNED"){_68.setQuery({instruction_indicator:dj.byId("cpty_instruction_indicator").value});_68.selection.select(0);_68.rowSelectCell.setDisabled(0,true);}else{if(document.getElementById("mode").value=="DRAFT"){var _69=0;for(var i=0;i<_68.get("store")._arrayOfAllItems.length;i=i+2){_69++;}}}break;}},customError:function(_6a,_6b){dj.byId("loadingDialog").hide();console.error("[requestFTAjaxCall] Error on Ajax Call for Request Fund Transfer");_6c(status,_6a);}});};function _6d(){var _6e=dj.byId("applicant_act_amt"),_6f=dj.byId("payment_amt");if(_6e&&_6f){if(!isNaN(_6e.get("value"))){_6f.set("disabled",true);_6f.set("value","");m.toggleRequired("payment_amt",false);m.amountValidationForZero(_6e);}else{if(!isNaN(_6f.get("value"))){_6e.set("disabled",true);_6e.set("value","");m.toggleRequired("applicant_act_amt",false);m.toggleRequired("applicant_cur_code",false);m.amountValidationForZero(_6f);}else{_6f.set("disabled",false);_6e.set("disabled",false);m.toggleRequired("payment_amt",true);m.toggleRequired("applicant_act_amt",true);m.toggleRequired("applicant_cur_code",true);}}}};function _6c(_70,_71){var _72="";switch(_70){case 3:_72=m.getLocalization("errorFTRejected");if(_71.remarks!==null&&_71.remarks.length!==0){_72+="<br><br>"+m.getLocalization("traderRemarks")+_71.remarks;}break;case 7205:_72=m.getLocalization("errorCurrencyCalendar");break;case 993:_72=m.getLocalization("errorQuoteExpired");break;default:_72=m.getCommonMessageError(_70,_71);break;}m.dialog.show("ERROR",_72);m.performClear();};function _73(){var _74=(_5c!==undefined&&_5c.items.length!==0)?_5c.items[0].beneficiary_institution:_25;dj.byId("loadingDialog").show();m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/TreasuryRequestForQuoteSearchAction"),handleAs:"json",content:{operation:"REQUEST",ft_type:"02",applicant_reference:_5,ordering_account:_1a,ordering_currency:_1b,transfer_account:_20,transfer_amount:_21,transfer_currency:_22,beneficiary_account:_23,beneficiary_name:_74,beneficiary_address:_26,beneficiary_address_2:_27,beneficiary_city:_28,beneficiary_country:_29,bene_details_clrc:_58,beneficiary_bank:_2a,beneficiary_bank_routing_number:_2b,beneficiary_bank_branch:_2c,beneficiary_bank_address:_2d,beneficiary_bank_city:_2e,beneficiary_bank_country:_2f,beneficiary_bank_clrc:_57,beneficiary_bank_bic:_30,ordering_cust_name:_32,ordering_cust_address:_33,ordering_cust_address_2:_34,ordering_cust_citystate:_35,ordering_cust_country:_36,order_details_clrc:_59,ordering_cust_account:_37,ft_amount:_1e,ft_cur_code:_1f,execution_date:_1c,execution_tenor:_1d,payment_currency:_38,payment_amount:_39,debit_ccy:_55,debit_amt:_56,remarks:_9,fee_account:_3a,feeCurCode:_3b,feeAmt:_3c,swift_charges_type:_3e,intermediary_bank:_3f,intermediary_bank_aba:_40,intermediary_bank_bic:_41,intermediary_bank_street:_42,intermediary_bank_street_2:_43,intermediary_bank_city:_44,intermediary_bank_country:_45,inter_bank_clrc:_5a,intermediary_bank_instruction_1:_46,intermediary_bank_instruction_2:_47,intermediary_bank_instruction_3:_48,intermediary_bank_instruction_4:_49,intermediary_bank_instruction_5:_4a,intermediary_bank_instruction_6:_4b,additional_detail_1:_4c,additional_detail_2:_4d,additional_detail_3:_4e,additional_detail_4:_4f,receipt_instructions_id:_50,mode:_31,bo_ref_id:_53,payment_deal_no:_51,fx_deal_no:_52,xfer_deal_no:_54,bank:_19,applicant_act_amt:dj.byId("applicant_act_amt").get("value"),applicant_cur_code:dj.byId("applicant_cur_code").get("value"),payment_amt:dj.byId("payment_amt").get("value"),payment_cur_code:dj.byId("payment_cur_code").get("value"),productcode:"FT",subproductcode:_1},load:function(_75,_76){dj.byId("loadingDialog").hide();var _77=_75.status;switch(_77){case 5:m.showDealSummaryDialog(_75);var _78=_75.validity;m.countDown(_78);m.showDetailField();break;case 1:m.showDealSummaryDialog(_75);break;case 6:dj.byId("bo_tnx_id").set("value",_75.boTnxId);dj.byId("bo_ref_id").set("value",_75.bo_ref_id);dj.byId("rec_id").set("value",_75.rec_id);m.frequencyStore=_75.delay_frequency;m.opicsFrequencyResponse=_75.delay_frequency;m.delayStore=_75.delay_timeout;m.openDelayDialog(m.frequencyStore,m.delayStore);break;default:_6c(_77,_75);break;}},customError:function(_79,_7a){dj.byId("loadingDialog").hide();console.error("[requestFTAjaxCall] Error on Ajax Call for Request Fund Transfer");_6c(status,_79);}});};function _7b(){if(dj.byId("credit_amt")){dj.byId("credit_amt").set("value","");}if(dj.byId("debit_amt")){dj.byId("debit_amt").set("value","");}if(dj.byId("rate")){dj.byId("rate").set("value","");}dj.byId("loadingDialog").show();m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/TreasuryRequestForQuoteSearchAction"),handleAs:"json",content:{operation:"REJECT",ref_id:m.ref_id,ft_type:dj.byId("ft_type").get("value"),applicant_reference:_5,ordering_account:_1a,ordering_currency:_1b,rec_id:dj.byId("rec_id").get("value"),beneficiary_account:_23,beneficiary_name:_25,beneficiary_address:_26,beneficiary_address_2:_27,beneficiary_city:_28,beneficiary_country:_29,bene_details_clrc:_58,beneficiary_bank:_2a,beneficiary_bank_routing_number:_2b,beneficiary_bank_branch:_2c,beneficiary_bank_address:_2d,beneficiary_bank_city:_2e,beneficiary_bank_country:_2f,beneficiary_bank_clrc:_57,beneficiary_bank_bic:_30,ordering_cust_name:_32,ordering_cust_address:_33,ordering_cust_address_2:_34,ordering_cust_citystate:_35,ordering_cust_country:_36,order_details_clrc:_59,ordering_cust_account:_37,swift_charges_type:_3e,intermediary_bank:_3f,intermediary_bank_aba:_40,intermediary_bank_bic:_41,intermediary_bank_street:_42,intermediary_bank_street_2:_43,intermediary_bank_city:_44,intermediary_bank_country:_45,inter_bank_clrc:_5a,intermediary_bank_instruction_1:_46,intermediary_bank_instruction_2:_47,intermediary_bank_instruction_3:_48,intermediary_bank_instruction_4:_49,intermediary_bank_instruction_5:_4a,intermediary_bank_instruction_6:_4b,additional_detail_1:_4c,additional_detail_2:_4d,additional_detail_3:_4e,additional_detail_4:_4f,ft_amount:_1e,ft_cur_code:_1f,execution_date:_1c,execution_tenor:_1d,remarks:_9,bo_ref_id:dj.byId("bo_ref_id").get("value"),bo_tnx_id:dj.byId("bo_tnx_id").get("value"),credit_account_name:dj.byId("creditAccountName").get("value"),bank:dj.byId("issuing_bank_abbv_name").get("value"),productcode:"FT",subproductcode:_1},load:function(_7c,_7d){dj.byId("loadingDialog").hide();var _7e=_7c.status;switch(_7e){case 3:m.performClearFieldsOnFieldChange();m.closeDealSummaryDialog();m.dialog.show("CUSTOM-NO-CANCEL",m.getLocalization("confirmationRejectRequest"),m.getLocalization("confirmationRejectTitle"));break;default:m.closeDealSummaryDialog();_6c(_7e,_7c);break;}},customError:function(_7f,_80){console.error("[CancelFTAjaxCall] error canceling FT quote");dj.byId("loadingDialog").hide();m.performClearFieldsOnFieldChange();m.closeDealSummaryDialog();_6c("",_7f);}});};d.mixin(m._config,{initReAuthParams:function(){var _81=dj.byId("applicant_act_amt")?dj.byId("applicant_cur_code").get("value"):dj.byId("payment_amt")?dj.byId("payment_cur_code").get("value"):"";var _82=dj.byId("applicant_act_amt")?dj.byId("applicant_act_amt").get("value"):dj.byId("payment_amt")?dj.byId("payment_amt").get("value"):"";var _83={productCode:"FT",subProductCode:dj.byId("sub_product_code").get("value"),transactionTypeCode:"01",entity:dj.byId("entity")?dj.byId("entity").get("value"):"",currency:_81,amount:m.trimAmount(_82),bankAbbvName:dj.byId("issuing_bank_abbv_name")?dj.byId("issuing_bank_abbv_name").get("value"):"",es_field1:m.trimAmount(_82),es_field2:(dj.byId("applicant_act_no"))?dj.byId("applicant_act_no").get("value"):""};return _83;}});d.mixin(m,{bind:function(){if(dj.byId("sub_product_code")){_1=dj.byId("sub_product_code").get("value");}m.connect("issuing_bank_abbv_name","onChange",m.populateReferences);if(dj.byId("issuing_bank_abbv_name")){m.connect("entity","onChange",function(){dj.byId("issuing_bank_abbv_name").onChange();});}m.connect("issuing_bank_customer_reference","onChange",m.setApplicantReference);m.connect("ft_amt","onBlur",function(){m.setTnxAmt(this.get("value"));m.amountValidationForZero(dj.byId("ft_amt"));});m.connect("beneficiary_bank_bic","onBlur",function(){var _84="beneficiary";var _85=dj.byId("beneficiary_bank_bic").value;m.toggleBeneficiaryFields(_85,_84,"beneficiary_bank_country_btn_img",true);});m.connect("intermediary_bank_bic","onBlur",function(){var _86="intermediary";var _87=dj.byId("intermediary_bank_bic").value;m.toggleBeneficiaryFields(_87,_86,"intermediary_bank_country_btn_img",false);});m.connect("beneficiary_bank","onBlur",function(){var _88=dj.byId("beneficiary_bank").value;var _89="false";if(dj.byId("show_bic_code")){_89=dj.byId("show_bic_code").get("value");}if(_89==="true"){if(dj.byId("beneficiary_bank_bic")&&dj.byId("beneficiary_bank_bic").get("value")===""){m.toggleBICFields(_88,"beneficiary_bank_bic");}}else{m.toggleBICFields(_88,"beneficiary_bank_bic");}});m.connect("intermediary_bank","onBlur",function(){var _8a=dj.byId("intermediary_bank").value;m.toggleBICFields(_8a,"intermediary_bank_bic");});m.connect("buttonAcceptRequest","onClick",m.acceptRate);m.connect("buttonCancelRequest","onClick",m.fncPerformCancelRequest);m.setValidation("request_value_date",function(){return m.validateDate("request_value","","requestDateLessThanDateOfDayError",false);});m.connect("applicant_act_name","onChange",_5d);m.connect("applicant_act_no","onChange",function(){dj.byId("instructions_type_1").set("disabled",false);dj.byId("instructions_type_2").set("disabled",false);if(dj.byId("instructions_type_1").checked){dj.byId("instructions_type_1").checked=false;}if(dj.byId("instructions_type_2").checked){dj.byId("instructions_type_2").checked=false;}d.style("bank_instruction_field",{"display":"none"});d.style("free_format_field",{"display":"none"});m.performClear(null,3,false);});m.connect("instructions_type_1","onClick",_5e);m.connect("instructions_type_2","onClick",_60);m.setValidation("applicant_cur_code",m.validateCurrency);m.setValidation("payment_cur_code",m.validateCurrency);m.setValidation("beneficiary_country",m.validateCountry);m.setValidation("beneficiary_bank_country",m.validateCountry);m.setValidation("ordering_cust_country",m.validateCountry);m.setValidation("intermediary_bank_country",m.validateCountry);m.connect("payment_amt","onBlur",_6d);m.connect("applicant_act_amt","onBlur",_6d);m.connect("payment_cur_code","onChange",function(){if(dj.byId("instructions_type_1").checked){dj.byId("instructions_type_1").checked=false;}if(dj.byId("instructions_type_2").checked){dj.byId("instructions_type_2").checked=false;}if(dj.byId("payment_cur_code").value.length===0){dj.byId("instructions_type_1").set("disabled",true);dj.byId("instructions_type_2").set("disabled",true);}if(dj.byId("payment_cur_code").value.length>0){dj.byId("instructions_type_1").set("disabled",false);dj.byId("instructions_type_2").set("disabled",false);}d.style("bank_instruction_field",{"display":"none"});d.style("free_format_field",{"display":"none"});m.performClear(null,3,false);});m.setValidation("request_value_number",function(){if(_1==="TRTPT"){return m.validateTermNumber("request_value","","TermCodeError",false);}});m._fncConnectSSIFields("");m.connect("entity","onChange",m.performClearFieldsOnFieldChange);m.connect("applicant_cur_code","onChange",function(){m.setCurrency(this,["applicant_act_amt"]);m.setPaymentDescriptionForCAD();});m.connect("payment_cur_code","onChange",function(){m.setCurrency(this,["payment_amt"]);m.setPaymentDescriptionForCAD();});m.setValidation("intermediary_bank_bic",m.validateBICFormat);m.setValidation("beneficiary_bank_bic",m.validateBICFormat);},onFormLoad:function(){var _8b=dj.byId("issuing_bank_abbv_name");if(_8b){_8b.onChange();}var _8c=dj.byId("issuing_bank_customer_reference");if(_8c){_8c.onChange();_8c.set("value",_8c._resetValue);}m.fncDisableLoadingDialogClosing();if(m._config.swift_allowed){misys._populateClearingCodes("beneficiary_bank");misys._populateClearingCodes("beneficiary");misys._populateClearingCodes("intermediary_bank");misys._populateClearingCodes("ordering_customer");}dojo.style("bank_instruction_field",{"display":"none"});dojo.style("free_format_field",{"display":"none"});if(dj.byId("applicant_act_name").get("value").length===0){dj.byId("instructions_type_2").checked=false;dj.byId("instructions_type_1").checked=false;dj.byId("instructions_type_1").set("disabled",true);dj.byId("instructions_type_2").set("disabled",true);}if(dj.byId("applicant_act_name").get("value")){dj.byId("applicant_cur_code").set("disabled",true);}m.setCurrency(dj.byId("applicant_cur_code"),["applicant_act_amt"]);m.setCurrency(dj.byId("payment_cur_code"),["payment_amt"]);var _8d=dj.byId("applicant_act_amt"),_8e=dj.byId("payment_amt");if(_8d&&_8e){if(!isNaN(_8d.get("value"))){_8e.set("disabled",true);m.toggleRequired("payment_amt",false);}else{if(!isNaN(_8e.get("value"))){_8d.set("disabled",true);m.toggleRequired("applicant_act_amt",false);m.toggleRequired("applicant_cur_code",false);}else{_8e.set("disabled",false);_8d.set("disabled",false);m.toggleRequired("payment_amt",true);m.toggleRequired("applicant_act_amt",true);m.toggleRequired("applicant_cur_code",true);}}}if(dj.byId("instructions_type_2").checked){dj.byId("instructions_type_1").set("disabled",false);dj.byId("instructions_type_2").set("disabled",false);dj.byId("instructions_type_2").checked=true;_60();}else{if(dj.byId("instructions_type_1").checked){dj.byId("instructions_type_2").set("disabled",false);dj.byId("instructions_type_1").set("disabled",false);dj.byId("instructions_type_1").checked=true;_5e();}}var _8f,_90,_91;if(dj.byId("beneficiary_bank_bic")&&dj.byId("beneficiary_bank_bic").get("value")!==""){_8f="beneficiary";_90=dj.byId("beneficiary_bank_bic").value;m.toggleBeneficiaryFields(_90,_8f,"beneficiary_bank_country_btn_img",true);}else{if(dj.byId("beneficiary_bank")&&dj.byId("beneficiary_bank").get("value")!==""){_91=dj.byId("beneficiary_bank").value;m.toggleBICFields(_91,"beneficiary_bank_bic");}}if(dj.byId("intermediary_bank_bic")&&dj.byId("intermediary_bank_bic").get("value")!==""){_8f="intermediary";_90=dj.byId("intermediary_bank_bic").value;m.toggleBeneficiaryFields(_90,_8f,"intermediary_bank_country_btn_img",false);}else{if(dj.byId("intermediary_bank")&&dj.byId("intermediary_bank").get("value")!==""){_91=dj.byId("intermediary_bank").value;m.toggleBICFields(_91,"intermediary_bank_bic");}}},initVar:function(){_2=dj.byId("ref_id").get("value");if(dj.byId("applicant_reference")){_5=dj.byId("applicant_reference").get("value");}else{_5="";}if(dj.byId("contract_type_1")&&dj.byId("contract_type_1").get("checked")===true){_6="01";}else{if(dj.byId("contract_type_2")&&dj.byId("contract_type_2").get("checked")===true){_6="02";}else{_6=dj.byId("contract_type").get("value");}}_7=(dj.byId("cust_payment_account_act_no"))?dj.byId("cust_payment_account_act_no").get("value"):"";_8=(dj.byId("cust_payment_account_act_description"))?dj.byId("cust_payment_account_act_description").get("value"):"";_9=dj.byId("remarks").get("value");_19=dj.byId("issuing_bank_abbv_name").get("value");},requestStandingInstructions:function(){m.fillVar();_62();},requestFT:function(){if(dj.byId("mode")&&dj.byId("mode").get("value")==="UNSIGNED"){m.acceptFT();}else{if(dj.byId("instructions_type_1")&&dj.byId("instructions_type_1").checked){if(m.checkFields()&&m.beforeSubmitValidations()){if(dj.byId("sub_product_code").get("value")==="TRTPT"){var _92=dj.byId("bankPaymentGrid").store._arrayOfAllItems.length===0||(dj.byId("bankPaymentGrid").store._arrayOfAllItems.length!==0&&dj.byId("instructions_type_1").checked&&dj.byId("bankPaymentGrid").selection.selectedIndex!==-1)||dj.byId("instructions_type_2").checked;if(_92){m.fillVar();if((dj.byId("bankPaymentGrid").rowCount>0)&&(dj.byId("bankPaymentGrid").selection.selectedIndex>-1)){_50=dj.byId("bankPaymentGrid").selection.getSelected()[0].instruction_indicator[0];}if(dj.byId("effDate")){dj.byId("effDate").set("value",dj.byId("bankPaymentGrid").selection.getSelected()[0].eff_date);}_73();}else{m.dialog.show("ERROR",m.getLocalization("mustChooseBankInstruction"));}}}}else{m._config.onSubmitErrorMsg=m.getLocalization("mandatoryFieldsAndInstructionsRequired");if(m.checkFields()&&m.beforeSubmitValidations()){if(dj.byId("ft_type").get("value")==="02"){if((dj.byId("instructions_type_1").checked===false)&&(dj.byId("instructions_type_2").checked===false)){m.dialog.show("ERROR",m.getLocalization("mustChooseInstructionsType"));}else{m.fillVar();_73();}}else{if(m.ft_type=="01"||m.ft_type=="05"){m.fillVar();_73();}}}else{if(dj.byId("instructions_type_2").checked){m._config.onSubmitErrorMsg=m.getLocalization("highlightedFieldsRequired");m.dialog.show("ERROR",m._config.onSubmitErrorMsg);}else{m.dialog.show("ERROR",m._config.onSubmitErrorMsg);}}}}},performDelayRequest:function(){if(m.frequencyStore>0){m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/TreasuryRequestForQuoteSearchAction"),handleAs:"json",content:{operation:"DELAY",ft_type:"02",ref_id:m.ref_id,applicant_reference:_5,bo_ref_id:dj.byId("bo_ref_id").get("value"),bo_tnx_id:dj.byId("bo_tnx_id").get("value"),rec_id:dj.byId("rec_id").get("value"),ordering_account:_1a,ordering_currency:_1b,transfer_account:_20,transfer_amount:_21,transfer_currency:_22,beneficiary_account:_23,beneficiary_name:_25,beneficiary_address:_26,beneficiary_address_2:_27,beneficiary_city:_28,beneficiary_country:_29,bene_details_clrc:_58,beneficiary_bank:_2a,beneficiary_bank_routing_number:_2b,beneficiary_bank_branch:_2c,beneficiary_bank_address:_2d,beneficiary_bank_city:_2e,beneficiary_bank_country:_2f,beneficiary_bank_clrc:_57,beneficiary_bank_bic:_30,ordering_cust_name:_32,ordering_cust_address:_33,ordering_cust_address_2:_34,ordering_cust_citystate:_35,ordering_cust_country:_36,order_details_clrc:_59,ordering_cust_account:_37,swift_charges_type:_3e,intermediary_bank:_3f,intermediary_bank_aba:_40,intermediary_bank_bic:_41,intermediary_bank_street:_42,intermediary_bank_street_2:_43,intermediary_bank_city:_44,intermediary_bank_country:_45,inter_bank_clrc:_5a,intermediary_bank_instruction_1:_46,intermediary_bank_instruction_2:_47,intermediary_bank_instruction_3:_48,intermediary_bank_instruction_4:_49,intermediary_bank_instruction_5:_4a,intermediary_bank_instruction_6:_4b,additional_detail_1:_4c,additional_detail_2:_4d,additional_detail_3:_4e,additional_detail_4:_4f,ft_amount:_1e,ft_cur_code:_1f,execution_date:_1c,execution_tenor:_1d,payment_currency:_38,payment_amount:_39,remarks:_9,fee_account:_3a,receipt_instructions_id:_50,bank:_19,productcode:"FT",subproductcode:_1},load:function(_93,_94){var _95=_93.status;switch(_95){case 5:m.closeDelayDialog();m.showDealSummaryDialog(_93);var _96=_93.validity;m.countDown(_96);m.showDetailField();break;case 6:m.frequencyStore--;m.timer=setTimeout("misys.performDelayRequest()",(m.delayStore*1000));break;default:m.closeDelayDialog();_6c(_95,_93);break;}},customError:function(_97,_98){console.error("[Create_FT] error retrieving quote");m.closeDelayDialog();_6c("",_97);}});}else{m.stopCountDown(m.timer);m.showContinuationElement();}},performCancelDelayRequest:function(){dj.byId("loadingDialog").show();m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/TreasuryRequestForQuoteSearchAction"),handleAs:"json",content:{operation:"CANCEL",ref_id:m.ref_id,ft_type:"02",applicant_reference:_5,ordering_account:_1a,ordering_currency:_1b,beneficiary_account:_23,beneficiary_name:_25,beneficiary_address:_26,beneficiary_address_2:_27,beneficiary_city:_28,beneficiary_country:_29,bene_details_clrc:_58,beneficiary_bank:_2a,beneficiary_bank_routing_number:_2b,beneficiary_bank_branch:_2c,beneficiary_bank_address:_2d,beneficiary_bank_city:_2e,beneficiary_bank_country:_2f,beneficiary_bank_clrc:_57,beneficiary_bank_bic:_30,ordering_cust_name:_32,ordering_cust_address:_33,ordering_cust_address_2:_34,ordering_cust_citystate:_35,ordering_cust_country:_36,order_details_clrc:_59,ordering_cust_account:_37,swift_charges_type:_3e,intermediary_bank:_3f,intermediary_bank_aba:_40,intermediary_bank_bic:_41,intermediary_bank_street:_42,intermediary_bank_street_2:_43,intermediary_bank_city:_44,intermediary_bank_country:_45,inter_bank_clrc:_5a,intermediary_bank_instruction_1:_46,intermediary_bank_instruction_2:_47,intermediary_bank_instruction_3:_48,intermediary_bank_instruction_4:_49,intermediary_bank_instruction_5:_4a,intermediary_bank_instruction_6:_4b,additional_detail_1:_4c,additional_detail_2:_4d,additional_detail_3:_4e,additional_detail_4:_4f,ft_amount:_1e,ft_cur_code:_1f,execution_date:_1c,execution_tenor:_1d,remarks:_9,receipt_instructions_id:_50,bank:_19,bo_ref_id:dj.byId("bo_ref_id").get("value"),bo_tnx_id:dj.byId("bo_tnx_id").get("value"),credit_account_name:dj.byId("creditAccountName").get("value"),productcode:"FT",subproductcode:_1},load:function(_99,_9a){dj.byId("loadingDialog").hide();var _9b=_99.status;switch(_9b){case 3:m.closeDealSummaryDialog();m.dialog.show("CUSTOM-NO-CANCEL",m.getLocalization("confirmationCancelRequest"),m.getLocalization("confirmationCancelTitle"));break;default:_6c(_9b,_99);break;}},customError:function(_9c,_9d){console.error("[CancelFTAjaxCall] error canceling FT quote");dj.byId("loadingDialog").hide();m.closeDealSummaryDialog();_6c("",_9c);}});},acceptFT:function(){dj.byId("option").set("value","ACCEPT");m.submit("SUBMIT");},rejectFT:function(){if(m.countdown){m.stopCountDown(m.countdown);}_7b();},beforeSaveValidations:function(){if(dj.byId("applicant_act_amt")){dj.byId("debit_amt").set("value",dj.byId("applicant_act_amt").get("value"));}if(dj.byId("payment_amt")){dj.byId("credit_amt").set("value",dj.byId("payment_amt").get("value"));}var _9e=dj.byId("entity");if(_9e&&_9e.get("value")===""){return false;}else{return true;}},beforeSubmitValidations:function(){if(dj.byId("mode")&&dj.byId("mode").get("value")==="UNSIGNED"){return true;}var _9f=false;var _a0=false;var _a1=false;var _a2=false;var _a3=false;var _a4=false;var _a5=false;if(dj.byId("applicant_act_name")){_9f=dj.byId("applicant_act_name").get("value")!=="";}if(dj.byId("applicant_act_amt")){_a0=dj.byId("applicant_act_amt").get("value")!=="";}if(dj.byId("payment_cur_code")){_a1=dj.byId("payment_cur_code").value.length>0;}if(dj.byId("payment_amt")){_a2=dj.byId("payment_amt").get("value")!=="";}if(dj.byId("issuing_bank_customer_reference")){_a3=dj.byId("issuing_bank_customer_reference").get("value")!=="";}if(dj.byId("instructions_type_1")&&dj.byId("instructions_type_1").checked){if(dj.byId("bankPaymentGrid")){if(dj.byId("bankPaymentGrid").store._arrayOfAllItems.length===0){_a4=true;var _a6="";_a6=m.getLocalization("selectFreeFormatInstructionsError");m._config.onSubmitErrorMsg=_a6;if(_a6&&_a6!==""){m.dialog.show("ERROR",_a6);return false;}}if(dj.byId("bankPaymentGrid").store._arrayOfAllItems.length!==0&&dj.byId("bankPaymentGrid").selection.selectedIndex===-1){_a5=true;var _a7="";_a7=m.getLocalization("selectInstructionsError");m._config.onSubmitErrorMsg=_a7;if(_a7&&_a7!==""){m.dialog.show("ERROR",_a7);return false;}}}}if(dj.byId("instructions_type_2")&&dj.byId("instructions_type_2").checked){if(dj.byId("beneficiary_name").get("value")!==""&&dj.byId("beneficiary_address").get("value")!==""&&dj.byId("beneficiary_city").get("value")!==""&&dj.byId("beneficiary_country").get("value")!==""&&dj.byId("beneficiary_account").get("value")!==""){_a4=false;}else{_a4=true;}}if(_9f&&(_a0||_a2)&&_a3&&!_a4&&!_a5){return true;}else{m._config.onSubmitErrorMsg=m.getLocalization("errorAccountOrPaymentInformationMissing");return false;}},fillVar:function(){var _a8="";_2=dj.byId("ref_id").get("value");if(dj.byId("applicant_reference")){_5=dj.byId("applicant_reference").get("value");}else{_5="";}_1a=dj.byId("applicant_act_no").get("value");_1b=dj.byId("applicant_act_cur_code").get("value");_1c=dj.byId("request_value").getDate();if(dj.byId("request_value").getNumber()){_a8=dj.byId("request_value").getNumber();}_1d=_a8+dj.byId("request_value").getCode();_31=document.getElementById("mode").value;_19=dj.byId("issuing_bank_abbv_name").get("value");if(dj.byId("ft_type").get("value")==="02"){_25=dj.byId("beneficiary_name").get("value");_26=dj.byId("beneficiary_address").get("value");_27=dj.byId("beneficiary_address_2").get("value");_28=dj.byId("beneficiary_city").get("value");_23=dj.byId("beneficiary_account").get("value");_2a=dj.byId("beneficiary_bank").get("value");_29=dj.byId("beneficiary_country").get("value");if(m._config.swift_allowed){_58=dj.byId("bene_details_clrc").get("value");}if((document.getElementById("instructions_type_1")&&dj.byId("instructions_type_1").checked)){_50=dj.byId("receipt_instructions_id").get("value");}else{_2b=dj.byId("beneficiary_bank_routing_number").get("value");_2c=dj.byId("beneficiary_bank_branch").get("value");_2d=dj.byId("beneficiary_bank_address").get("value");_2e=dj.byId("beneficiary_bank_city").get("value");_2f=dj.byId("beneficiary_bank_country").get("value");if(document.getElementById("mode").value=="UNSIGNED"){dj.byId("beneficiary_bank_country").set("value",dj.byId("beneficiary_bank_country").get("value"));if(dj.byId("cpty_instruction_indicator").value!==""){dj.byId("beneficiary_bank_routing_number").set("value",dj.byId("cpty_benif_account").get("value"));}else{dj.byId("beneficiary_bank_routing_number").set("value",dj.byId("cpty_benif_bank_routing_no").get("value"));}}_30=dj.byId("beneficiary_bank_bic").get("value");_32=dj.byId("ordering_cust_name").get("value");_33=dj.byId("ordering_cust_address").get("value");_35=dj.byId("ordering_cust_citystate").get("value");_36=dj.byId("ordering_cust_country").get("value");_37=dj.byId("ordering_cust_account").get("value");_3f=dj.byId("intermediary_bank").get("value");_40=dj.byId("intermediary_bank_aba").get("value");_41=dj.byId("intermediary_bank_bic").get("value");_42=dj.byId("intermediary_bank_street").get("value");_44=dj.byId("intermediary_bank_city").get("value");_45=dj.byId("intermediary_bank_country").get("value");_46=dj.byId("intermediary_bank_instruction_1").get("value");_47=dj.byId("intermediary_bank_instruction_2").get("value");_48=dj.byId("intermediary_bank_instruction_3").get("value");_49=dj.byId("intermediary_bank_instruction_4").get("value");_4a=dj.byId("intermediary_bank_instruction_5").get("value");_4b=dj.byId("intermediary_bank_instruction_6").get("value");if(m._config.swift_allowed){_57=dj.byId("beneficiary_bank_clrc").get("value");_34=dj.byId("ordering_cust_address_2").get("value");_59=dj.byId("order_details_clrc").get("value");_43=dj.byId("intermediary_bank_street_2").get("value");_5a=dj.byId("inter_bank_clrc").get("value");}if(document.getElementById("mode").value=="UNSIGNED"){_3e=dj.byId("swift_charges_type").get("value");}else{if(dj.byId("swift_charges_type_1").checked){_3e=dj.byId("swift_charges_type_1").get("value");}else{if(dj.byId("swift_charges_type_2").checked){_3e=dj.byId("swift_charges_type_2").get("value");}else{if(dj.byId("swift_charges_type_3").checked){_3e=dj.byId("swift_charges_type_3").get("value");}}}}_4c=dj.byId("free_additional_details_line_1_input").get("value");_4d=dj.byId("free_additional_details_line_2_input").get("value");_4e=dj.byId("free_additional_details_line_3_input").get("value");_4f=dj.byId("free_additional_details_line_4_input").get("value");}}if((dj.byId("ft_type").get("value")==="01"||dj.byId("ft_type").get("value")==="02")&&(document.getElementById("mode").value==="NEW"||document.getElementById("mode").value==="UNSIGNED")){_3a=dj.byId("feeAccount").get("value");_3b=dj.byId("feeCurCode").get("value");_3c=dj.byId("feeAmt").get("value");}else{if(dj.byId("FTCharge").get("value")==="true"){if(dj.byId("open_chrg_brn_by_code_1").get("value")==="01"){_3a=dj.byId("applicant_act_no").get("value");}else{if(dj.byId("open_chrg_brn_by_code_2").get("value")==="02"){if(dj.byId("ft_type").get("value")==="01"||dj.byId("ft_type").get("value")==="05"){_3a=dj.byId("beneficiary_act_no").get("value");}else{if(dj.byId("ft_type").get("value")==="02"){_3a=dj.byId("beneficiary_account").get("value");}}}else{if(dj.byId("open_chrg_brn_by_code_3").get("value")==="03"){_3a=dj.byId("beneficiary_account").get("value");}}}}}if(dj.byId("payment_cur_code").get("value")!==""&&dj.byId("payment_amt").get("value")!==""&&!isNaN(dj.byId("payment_amt").get("value"))){_38=dj.byId("payment_cur_code").get("value");_39=dj.byId("payment_amt").get("value");_55=dj.byId("applicant_act_cur_code").get("value");_1f=_38;_1e=_39;_56=dj.byId("applicant_act_amt").set("value","");dj.byId("debit_amt").set("value","");}else{if(dj.byId("applicant_cur_code").get("value")!==""&&dj.byId("applicant_act_amt").get("value")!==""&&!isNaN(dj.byId("applicant_act_amt").get("value"))){_55=dj.byId("applicant_cur_code").get("value");_56=dj.byId("applicant_act_amt").get("value");_38=dj.byId("payment_cur_code").get("value");_39=dj.byId("payment_amt").set("value","");_1f=_55;_1e=_56;}}if(dj.byId("instructions_type_1")&&dj.byId("instructions_type_1").checked){_50=dj.byId("receipt_instructions_id").get("value");}else{_50="";}},amountValidationForZero:function(_a9){var _aa;var _ab=_a9.get("value");if(_ab===0){_aa=m.getLocalization("amountcannotzero");_a9.set("state","Error");dj.hideTooltip(_a9.domNode);dj.showTooltip(_aa,_a9.domNode,0);return false;}},fillAccountField:function(_ac,_ad){if(_ac==="debitDDAccount"){dj.byId("cust_payment_account_act_no").set("value",_ad.account_no);dj.byId("cust_payment_account_act_description").set("value",_ad.description);}}});})(dojo,dijit,misys);dojo.require("misys.client.binding.treasury.create_ft_trtpt_client");}