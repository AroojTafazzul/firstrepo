/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.treasury.message_si_td_trtd"]){dojo._hasResource["misys.binding.treasury.message_si_td_trtd"]=true;dojo.provide("misys.binding.treasury.message_si_td_trtd");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("misys.grid._base");dojo.require("dojo.data.ItemFileReadStore");dojo.require("dojo.parser");dojo.require("dojo.data.ItemFileReadStore");dojo.require("dijit.layout.TabContainer");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("misys.widget.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.layout.ContentPane");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("dojox.grid.EnhancedGrid");dojo.require("dojox.grid.enhanced.plugins.Menu");dojo.require("dojox.grid.enhanced.plugins.NestedSorting");dojo.require("dojox.grid.enhanced.plugins.IndirectSelection");dojo.require("dojox.grid.cells.dijit");dojo.require("misys.binding.common");dojo.require("misys.binding.cash.common.standing_instruction_action");(function(d,dj,m){d.mixin(m._config,{initReAuthParams:function(){var _1={productCode:"TD",subProductCode:dj.byId("sub_product_code").get("value"),transactionTypeCode:"01",entity:dj.byId("entity")?dj.byId("entity").get("value"):"",currency:"",amount:"",es_field1:"",es_field2:""};return _1;}});d.mixin(m,{bind:function(){if(dj.byId("beneficiary_country")){m.setValidation("beneficiary_country",m.validateCountry);}if(dj.byId("beneficiary_bank_country")){m.setValidation("beneficiary_bank_country",m.validateCountry);}if(dj.byId("ordering_cust_country")){m.setValidation("ordering_cust_country",m.validateCountry);}if(dj.byId("intermediary_bank_country")){m.setValidation("intermediary_bank_country",m.validateCountry);}m.connect("beneficiary_bank_bic","onBlur",function(){var _2="beneficiary";var _3=dj.byId("beneficiary_bank_bic").value;m.toggleBeneficiaryFields(_3,_2,"beneficiary_bank_country_btn_img",true);});m.connect("intermediary_bank_bic","onBlur",function(){var _4="intermediary";var _5=dj.byId("intermediary_bank_bic").value;m.toggleBeneficiaryFields(_5,_4,"intermediary_bank_country_btn_img",false);});m.connect("beneficiary_bank","onBlur",function(){var _6=dj.byId("beneficiary_bank").value;m.toggleBICFields(_6,"beneficiary_bank_bic");});m.connect("intermediary_bank","onBlur",function(){var _7=dj.byId("intermediary_bank").value;m.toggleBICFields(_7,"intermediary_bank_bic");});if(dijit.byId("receipt_completed_indicator")&&(dj.byId("receipt_completed_indicator").get("value")==="N"||dj.byId("receipt_completed_indicator").get("value")==="")){m.connect("instructions_type_1","onClick",function(){m._fncSwitchBankPaymentInstructionsFields("bank_instruction_field","free_format_field","instructions_type_2",null,null,"instructions_type_2",null);});m.connect("instructions_type_2","onClick",function(){m._fncSwitchBankPaymentInstructionsFields("free_format_field","bank_instruction_field","freeformatbeneficiary",null,null,"instructions_type_1");misys.removeAdditionalFieldsForCD();});m.connect("payment_type","onChange",function(){m.changeRequiredFieldsOnPaymentTypeChange("");});m.connect("beneficiary_account","onChange",function(){m._fncChangeRequiredFieldsOnChange("beneficiary_account","");});m.connect("beneficiary_address","onChange",function(){m._fncChangeRequiredFieldsOnChange("beneficiary_address","");});m._fncConnectSSIFields("");m.connect("freeformataddlinstructionslabel","onClick",function(){m.fncfreeformataddlinstructions(null);});m.connect("freeformatpaymentdetailslabel","onClick",function(){m.fncfreeformatpaymentdetails(null);});m.connect("freeformatbeneficiarylabel","onClick",function(){m.fncfreeformatbeneficiary(null);});}var _8=dijit.byId("sub_tnx_type_code").get("value");if(_8=="25"){m.connect("near_instructions_type_1","onClick",function(){_fncSwitchBankPaymentInstructionsFields("near_bank_instruction_field","free_format_field","near_instructions_type_2","near");});m.connect("near_instructions_type_2","onClick",function(){_fncSwitchBankPaymentInstructionsFields("near_free_format_field","bank_instruction_field","near_instructions_type_1","near");});m.connect("near_payment_type","onChange",function(){_fncChangeRequiredFieldsOnPaymentTypeChange("near");});m.connect("near_beneficiary_account","onChange",function(){_fncChangeRequiredFieldsOnChange("near_beneficiary_account","near");});m.connect("near_beneficiary_address","onChange",function(){_fncChangeRequiredFieldsOnChange("near_beneficiary_address","near");});m.connect("near_intermediary_bank","onChange",function(){_fncChangeRequiredFieldsOnChange("near_intermediary_bank","near");});m.connect("freeformataddlinstructionslabel","onClick",function(){m.fncfreeformataddlinstructions(null);});m.connect("freeformatpaymentdetailslabel","onClick",function(){m.fncfreeformatpaymentdetails(null);});m.connect("freeformatbeneficiarylabel","onClick",function(){m.fncfreeformatbeneficiary(null);});}m.setValidation("beneficiary_bank_bic",m.validateBICFormat);m.setValidation("intermediary_bank_bic",m.validateBICFormat);},onFormLoad:function(){var _9=misys._config.td_si;var _a=dj.byId("sub_tnx_type_code").get("value");dj.byId("rec_id").set("value",_9.rec_id);if(dj.byId("receipt_completed_indicator")&&(dj.byId("receipt_completed_indicator").get("value")==="N"||dj.byId("receipt_completed_indicator").get("value")==="")){d.style("bank_instruction_field",{"display":"block"});d.style("free_format_field",{"display":"none"});if(dj.byId("payment_type")){dj.byId("payment_type").set("required",false);}}var _b={items:_9.payments};if(dj.byId("payment_completed_indicator")&&(dj.byId("payment_completed_indicator").get("value")==="N"||dj.byId("payment_completed_indicator").get("value")==="")){m._fncConstructCustomerPaymentGrid(_b,"customerPaymentGrid","payment_instructions_id","",dj.byId("customer_instruction_indicator").value);m._fncSetGridSelectedId("customerPaymentGrid",dj.byId("customer_instruction_indicator").value);}var _c={items:_9.receipts};if(dijit.byId("receipt_completed_indicator")&&(dj.byId("receipt_completed_indicator").get("value")==="N"||dj.byId("receipt_completed_indicator").get("value")==="")){d.style("bank_instruction_field",{"display":"block"});d.style("free_format_field",{"display":"none"});m._fncConstructBankPaymentGrid(_c,"bankPaymentGrid","receipt_instructions_id");m._fncSetGridSelectedId("bankPaymentGrid",dj.byId("bank_instruction_indicator").value);m._fncChangeDisabledAdditionalDetailsFiels("additional_details",true);m._fncDisplayStoredBankInstruction(null);}if(dj.byId("instructions_type_2")&&dj.byId("instructions_type_2").checked){m.changeRequiredFieldsOnPaymentTypeChange();misys.removeAdditionalFieldsForCD();}if(dj.byId("instructions_type_1")&&dj.byId("instructions_type_1").checked){m._fncChangePaymentTypeRequired("bank_instruction_field","free_format_field","");}if(_a=="25"){_c={items:_9.near_receipts};d.style("near_bank_instruction_field",{"display":"block"});d.style("near_free_format_field",{"display":"none"});d.byId("near_payment_type").set("required",false);m._fncConstructBankPaymentGrid(_c,"near_bankPaymentGrid","near_payment_instructions_id","near");m._fncChangeDisabledAdditionalDetailsFiels("near_additional_details",true);}var _d,_e,_f;if(dj.byId("beneficiary_bank_bic")&&dj.byId("beneficiary_bank_bic").get("value")!==""){_d="beneficiary";_e=dj.byId("beneficiary_bank_bic").value;m.toggleBeneficiaryFields(_e,_d,"beneficiary_bank_country_btn_img",true);}else{if(dj.byId("beneficiary_bank")&&dj.byId("beneficiary_bank").get("value")!==""){_f=dj.byId("beneficiary_bank").value;m.toggleBICFields(_f,"beneficiary_bank_bic");}}if(dj.byId("intermediary_bank_bic")&&dj.byId("intermediary_bank_bic").get("value")!==""){_d="intermediary";_e=dj.byId("intermediary_bank_bic").value;m.toggleBeneficiaryFields(_e,_d,"intermediary_bank_country_btn_img",false);}else{if(dj.byId("intermediary_bank")&&dj.byId("intermediary_bank").get("value")!==""){_f=dj.byId("intermediary_bank").value;m.toggleBICFields(_f,"intermediary_bank_bic");}}},selectIndex:function(_10,_11,_12){var _13=dj.byId(_11).selection.getSelected()[0].id;dj.byId(_12).set("value",_13);if(_11==="bankPaymentGrid"){m._fncChangeDisabledAdditionalDetailsFiels("additional_details",false);}else{if(_11==="near_bankPaymentGrid"){m._fncChangeDisabledAdditionalDetailsFiels("near_additional_details",false);}else{if(_11==="far_bankPaymentGrid"){m._fncChangeDisabledAdditionalDetailsFiels("far_additional_details",false);}}}},beforeSubmitValidations:function(){var _14;var _15;var _16;var _17;var _18;var _19;var _1a="";if(dj.byId("customerPaymentGrid")){_14=dj.byId("customerPaymentGrid").store._arrayOfAllItems.length==0||(dj.byId("customerPaymentGrid").store._arrayOfAllItems.length!=0&&dj.byId("customerPaymentGrid").selection.selectedIndex!=-1);}else{_14=true;}if(dj.byId("bankPaymentGrid")){_15=dj.byId("bankPaymentGrid").store._arrayOfAllItems.length==0||(dj.byId("bankPaymentGrid").store._arrayOfAllItems.length!=0&&dj.byId("instructions_type_1").checked&&dj.byId("bankPaymentGrid").selection.selectedIndex!=-1)||dj.byId("instructions_type_2").checked;}else{_15=true;}if(dj.byId("customerPaymentGrid")&&dj.byId("bankPaymentGrid")&&dj.byId("customerPaymentGrid").store._arrayOfAllItems.length==0&&dj.byId("bankPaymentGrid").store._arrayOfAllItems.length==0&&dj.byId("instructions_type_1").checked){_14=false;_15=false;}if(dj.byId("near_customerPaymentGrid")){_16=dj.byId("near_customerPaymentGrid").store._arrayOfAllItems.length===0||(dj.byId("near_customerPaymentGrid").store._arrayOfAllItems.length!==0&&dj.byId("near_customerPaymentGrid").selection.selectedIndex!==-1);}else{_16=true;}if(dj.byId("near_bankPaymentGrid")){_17=dj.byId("near_bankPaymentGrid").store._arrayOfAllItems.length===0||(dj.byId("near_bankPaymentGrid").store._arrayOfAllItems.length!==0&&dj.byId("near_instructions_type_1").checked&&dj.byId("near_bankPaymentGrid").selection.selectedIndex!==-1)||dj.byId("near_instructions_type_2").checked;}else{_17=true;}if(dj.byId("far_customerPaymentGrid")){_18=dj.byId("far_customerPaymentGrid").store._arrayOfAllItems.length===0||(dj.byId("far_customerPaymentGrid").store._arrayOfAllItems.length!==0&&dj.byId("far_customerPaymentGrid").selection.selectedIndex!==-1);}else{_18=true;}if(dj.byId("far_bankPaymentGrid")){_19=dj.byId("far_bankPaymentGrid").store._arrayOfAllItems.length===0||(dj.byId("far_bankPaymentGrid").store._arrayOfAllItems.length!==0&&dj.byId("far_instructions_type_1").checked&&dj.byId("far_bankPaymentGrid").selection.selectedIndex!==-1)||dj.byId("far_instructions_type_2").checked;}else{_19=true;}_1a=m.getLocalization("selectInstructionError");m._config.onSubmitErrorMsg=_1a;var _1b=dojo.query("[class= 'dojoxGridRowTable']");var _1c="";if(_1b.length===2){_1c=m.getLocalization("attachOneInstruction");m._config.onSubmitErrorMsg=_1c;}return _14&&_15&&_16&&_17&&_18&&_19;}});})(dojo,dijit,misys);dojo.require("misys.client.binding.treasury.message_si_td_trtd_client");}