/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.trade.create_bg"]){dojo._hasResource["misys.binding.trade.create_bg"]=true;dojo.provide("misys.binding.trade.create_bg");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("misys.form.file");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("misys.widget.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.layout.ContentPane");dojo.require("misys.editor.plugins.ProductFieldChoice");dojo.require("dojo.data.ItemFileReadStore");dojo.require("dijit.layout.TabContainer");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("misys.form.SimpleTextarea");dojo.require("dijit.Editor");dojo.require("dijit._editor.plugins.FontChoice");dojo.require("dojox.editor.plugins.ToolbarLineBreak");dojo.require("misys.widget.Collaboration");dojo.require("misys.form.static_document");dojo.require("misys.binding.trade.ls_common");(function(d,dj,m){function _1(){dj.byId("principal_act_no").set("value","");dj.byId("fee_act_no").set("value","");};var _2=m._config.requiredFieldPrefix||"*";var _3="deletegridrecord",_4=[];m._config=m._config||{};m._config.bgCurCode=m._config.bgCurCode||{};m._config.applicant=m._config.applicant||{entity:"",name:"",addressLine1:"",addressLine2:"",dom:""};m._config.beneficiary=m._config.beneficiary||{name:"",addressLine1:"",addressLine2:"",dom:""};m._config.expDate=m._config.expDate||{};m._config.renewFlag=m._config.renewFlag||{};m._config.bgTypeCode=m._config.bgTypeCode||{};function _5(){if((dj.byId("bg_text_type_code").get("value")=="02"||dj.byId("bg_text_type_code").get("value")=="04")){dj.byId("narrative_additional_instructions").set("value","NOT APPLICABLE");dj.byId("narrative_additional_instructions").set("disabled",true);dj.byId("narrative_additional_instructions_img").set("disabled",true);}else{if(dj.byId("narrative_additional_instructions").get("disabled")){dj.byId("narrative_additional_instructions").set("value","");dj.byId("narrative_additional_instructions").set("disabled",false);dj.byId("narrative_additional_instructions_img").set("disabled",false);m.toggleRequired("narrative_additional_instructions",true);}}};d.mixin(m._config,{initReAuthParams:function(){var _6={productCode:"BG",subProductCode:"",transactionTypeCode:"01",entity:dj.byId("entity")?dj.byId("entity").get("value"):"",currency:dj.byId("bg_cur_code")?dj.byId("bg_cur_code").get("value"):"",amount:dj.byId("bg_amt")?m.trimAmount(dj.byId("bg_amt").get("value")):"",bankAbbvName:dj.byId("recipient_bank_abbv_name")?dj.byId("recipient_bank_abbv_name").get("value"):"",es_field1:"",es_field2:""};return _6;},xmlTransform:function(_7){var _8="<bg_tnx_record>";if(_7.indexOf(_8)!=-1){var _9=m._config.xmlTagName,_a=_9?["<",_9,">"]:[],_b="</bg_tnx_record>",_c="",_d=-1;_c=_7.substring(_8.length,(_7.length-_b.length));_a.push(_c);if(dj.byId("gridLicense")&&dj.byId("gridLicense").store&&dj.byId("gridLicense").store!==null&&dj.byId("gridLicense").store._arrayOfAllItems.length>0){_a.push("<linked_licenses>");dj.byId("gridLicense").store.fetch({query:{REFERENCEID:"*"},onComplete:dojo.hitch(dj.byId("gridLicense"),function(_e,_f){dojo.forEach(_e,function(_10){_a.push("<license>");_a.push("<ls_ref_id>",_10.REFERENCEID,"</ls_ref_id>");_a.push("<bo_ref_id>",_10.BO_REF_ID,"</bo_ref_id>");_a.push("<ls_number>",_10.LS_NUMBER,"</ls_number>");_a.push("<ls_allocated_amt>",_10.LS_ALLOCATED_AMT,"</ls_allocated_amt>");_a.push("<ls_amt>",_10.LS_AMT,"</ls_amt>");_a.push("<ls_os_amt>",_10.LS_OS_AMT,"</ls_os_amt>");_a.push("<converted_os_amt>",_10.CONVERTED_OS_AMT,"</converted_os_amt>");_a.push("<allow_overdraw>",_10.ALLOW_OVERDRAW,"</allow_overdraw>");_a.push("</license>");});})});_a.push("</linked_licenses>");}if(dj.byId("lead_bank_flag")&&!dj.byId("lead_bank_flag").get("checked")){_a.push("<processing_bank_name></processing_bank_name>");_a.push("<processing_bank_address_line_1></processing_bank_address_line_1>");_a.push("<processing_bank_address_line_2></processing_bank_address_line_2>");_a.push("<processing_bank_dom></processing_bank_dom>");_a.push("<processing_bank_reference></processing_bank_reference>");}if(_9){_a.push("</",_9,">");}return _a.join("");}else{return _7;}}});d.mixin(m,{bind:function(){m.setValidation("template_id",m.validateTemplateId);m.setValidation("exp_date",m.validateTradeExpiryDate);m.setValidation("tender_expiry_date",m.validateTenderExpiryDate);m.setValidation("contract_date",m.validateContractDate);m.setValidation("bg_cur_code",m.validateCurrency);m.setValidation("contract_cur_code",m.validateCurrency);m.setValidation("applicant_country",m.validateCountry);m.setValidation("beneficiary_country",m.validateCountry);m.setValidation("alt_applicant_country",m.validateCountry);m.setValidation("contact_country",m.validateCountry);m.setValidation("net_exposure_cur_code",m.validateCurrency);m.setValidation("contract_pct",m.checkContractPercent);m.setValidation("renew_for_nb",m.validateRenewFor);m.setValidation("advise_renewal_days_nb",m.validateDaysNotice);m.setValidation("rolling_renewal_nb",m.validateNumberOfRenewals);m.setValidation("rolling_cancellation_days",m.validateCancellationNotice);m.setValidation("renewal_calendar_date",m.validateRenewalCalendarDate);m.setValidation("final_expiry_date",m.validateFinalExpiryDate);m.setValidation("iss_date_type_details",m.validateEffectiveIssueDate);m.connect("final_expiry_date","onChange",function(){var _11=dj.byId("exp_date");var _12=dj.byId("projected_expiry_date");var _13=function(){dj.hideTooltip(dj.byId("final_expiry_date").domNode);};var _14=this.get("displayedValue");if(_11&&!m.compareDateFields(_11,this)){this.set("value",null);this.set("state","Error");dj.showTooltip(m.getLocalization("finalExpDateLessThanTransactionExpDtError",[_14,_11.get("displayedValue")]),dj.byId("final_expiry_date").domNode,0);setTimeout(_13,10000);}else{if(_12&&!m.compareDateFields(_12,this)){this.set("value",null);dj.showTooltip(m.getLocalization("finalExpDateLessThanProjectedExpDtError",[_14,_12.get("displayedValue")]),dj.byId("final_expiry_date").domNode,0);setTimeout(_13,10000);}}});m.connect("iss_date_type_code","onChange",function(){m.toggleFields((this.get("value")==="99"),null,["iss_date_type_details"]);});m.connect("exp_date_type_code","onChange",function(){m.toggleFields((this.get("value")!=="01"),null,["exp_date"]);m.toggleFields((this.get("value")!=="02"),null,["exp_event"]);if(this.get("value")==="01"&&dj.byId("renew_flag")){dj.byId("renew_flag").set("checked",false);dj.byId("renew_flag").set("disabled",true);}else{if(dj.byId("renew_flag")){dj.byId("renew_flag").set("disabled",false);dj.byId("renew_flag").set("checked",false);}}});m.connect("reduction_authorised","onChange",function(){m.toggleFields((this.get("value")==="on"),null,["reduction_clause"]);});m.connect("reduction_clause","onChange",function(){m.toggleFields((this.get("value")==="03"),null,["reduction_clause_other"]);});m.connect("for_account","onChange",function(){m.toggleFields((this.get("value")==="on"),["alt_applicant_address_line_2","alt_applicant_dom","alt_applicant_address_line_4"],["alt_applicant_name","alt_applicant_address_line_1","alt_applicant_country"]);});m.connect("consortium","onChange",function(){m.toggleFields((this.get("value")==="on"),null,["net_exposure_cur_code","net_exposure_amt","consortium_details"],true,true);var _15=dj.byId("consortium");var _16=dj.byId("consortium_details");if(_15.get("value")!=="on"){dj.byId("net_exposure_cur_code").set("value","");dj.byId("net_exposure_amt").set("value","");_16.set("value","");_16.set("disabled",true);}else{_16.set("disabled",false);}});m.connect("rolling_renewal_flag","onClick",function(){m.toggleFields(this.get("checked"),["final_expiry_date"],["rolling_renewal_nb","rolling_cancellation_days","rolling_renew_on_code"]);if(!this.get("checked")){dj.byId("rolling_renew_for_nb").set("value","");dj.byId("rolling_renew_for_period").set("value","");dj.byId("rolling_day_in_month").set("value","");if(dj.byId("renew_flag").get("checked")){dj.byId("rolling_renewal_nb").set("value",m.getLocalization("default_rewnewalNumber"));}}});m.connect("rolling_renewal_flag","onChange",function(){m.toggleFields(this.get("checked"),["final_expiry_date"],["rolling_renewal_nb","rolling_cancellation_days","rolling_renew_on_code"]);if(!this.get("checked")){dj.byId("rolling_renew_for_nb").set("value","");dj.byId("rolling_renew_for_period").set("value","");dj.byId("rolling_day_in_month").set("value","");if(dj.byId("renew_flag").get("checked")){dj.byId("rolling_renewal_nb").set("value",m.getLocalization("default_rewnewalNumber"));}}});m.connect("rolling_renewal_nb","onBlur",function(){if(dj.byId("rolling_renewal_flag").get("checked")&&d.number.parse(this.get("value"))===1){m.showTooltip(m.getLocalization("invalidNumberOfRollingRenewals"),this.domNode,["after"]);this.state="Error";this._setStateClass();dj.setWaiState(this.focusNode,"invalid","true");}});m.connect("rolling_day_in_month","onBlur",function(){if(dj.byId("rolling_day_in_month").get("value")===0){dj.byId("rolling_day_in_month").set("state","Error");dj.showTooltip(m.getLocalization("dayInMonthZeroNotApplicableError"),dj.byId("rolling_day_in_month").domNode,0);var _17=function(){dj.hideTooltip(dj.byId("rolling_day_in_month").domNode);};setTimeout(_17,4500);}});m.connect("rolling_day_in_month","onChange",function(){if(dj.byId("rolling_renew_for_period").get("value")==="D"){this.set("value","");dj.showTooltip(m.getLocalization("dayInMonthNotApplicableForDaysError"),dj.byId("rolling_day_in_month").domNode,0);var _18=function(){dj.hideTooltip(dj.byId("rolling_day_in_month").domNode);};setTimeout(_18,1500);}});m.connect("rolling_renew_for_period","onChange",function(){if(dj.byId("rolling_renew_for_period").get("value")==="D"&&!isNaN(dj.byId("rolling_day_in_month").get("value"))){dj.byId("rolling_day_in_month").set("value","");dj.showTooltip(m.getLocalization("dayInMonthNotApplicableForDaysError"),dj.byId("rolling_renew_for_period").domNode,0);var _19=function(){dj.hideTooltip(dj.byId("rolling_day_in_month").domNode);};setTimeout(_19,1500);}});m.connect("rolling_renew_on_code","onChange",function(){m.toggleFields(this.get("value")==="03",["rolling_day_in_month"],["rolling_renew_for_nb"],true);if(this.get("value")==="01"){dj.byId("rolling_renew_for_nb").set("value","");dj.byId("rolling_renew_for_period").set("value","");dj.byId("rolling_day_in_month").set("value","");}else{if(dj.byId("rolling_renew_on_code").get("value")==="03"&&dj.byId("rolling_renewal_flag").get("checked")&&dj.byId("renew_for_period").get("value")!==""){dj.byId("rolling_renew_for_period").set("value",dj.byId("renew_for_period").get("value"));}}});m.connect("rolling_renew_for_nb","onBlur",function(){m.validateRollingRenewalFrequency(dj.byId("rolling_renew_for_nb"));});m.connect("renew_for_nb","onBlur",function(){m.validateRollingRenewalFrequency(dj.byId("renew_for_nb"));});m.connect("renew_for_period","onChange",function(){if(dj.byId("rolling_renew_on_code").get("value")==="03"&&dj.byId("rolling_renewal_flag").get("checked")&&dj.byId("renew_for_period").get("value")!==""){dj.byId("rolling_renew_for_period").set("value",dj.byId("renew_for_period").get("value"));}});var _1a=dj.byId("rolling_renewal_flag");if(_1a){m.toggleFields(_1a.get("checked"),["final_expiry_date"],["rolling_renewal_nb","rolling_cancellation_days","rolling_renew_on_code"],true);}var _1b=dj.byId("rolling_renew_on_code");if(_1b){m.toggleFields(_1b.get("value")==="03",["rolling_day_in_month"],["rolling_renew_for_nb"],true);}m.connect("issuing_bank_type_code","onChange",function(){m.toggleFields((this.get("value")==="02"),["issuing_bank_address_line_2","issuing_bank_dom","issuing_bank_address_line_4"],["issuing_bank_name","issuing_bank_address_line_1"]);if(this.get("value")==="01"){m.animate("fadeOut",d.byId("issuing_bank_name_img"));}else{if(this.get("value")==="02"){m.animate("fadeIn",d.byId("issuing_bank_name_img"));}}});m.connect("bg_type_code","onChange",m.toggleGuaranteeType);m.connect("bg_type_code","onChange",function(){var _1c=d.byId("pro-check-box");if(m._config.provisionalProductTypes[this.get("value")]){dj.byId("provisional_status").set("checked",true);m.animate("fadeIn",_1c);}else{dj.byId("provisional_status").set("checked",false);m.animate("fadeOut",_1c);}});m.connect("contract_ref","onChange",function(){var _1d=d.byId("tender-exp-date");if(this.get("value")==="TEND"){m.animate("fadeIn",_1d);}else{dj.byId("tender_expiry_date").set("value",null);m.animate("fadeOut",_1d);}});m.connect("bg_text_type_code","onChange",function(){m.toggleFields((this.get("value")==="03"),null,["bg_text_type_details"]);_5();});m.connect("delivery_to","onChange",function(){m.toggleFields((this.get("value")==="04"),null,["delivery_to_other"]);});m.connect("text_language","onChange",function(){m.toggleFields((this.get("value")==="*"),null,["text_language_other"]);});m.connect("bg_rule","onChange",function(){m.toggleFields((this.get("value")==="99"),null,["bg_rule_other"]);});m.connect("bg_cur_code","onChange",function(){m.setCurrency(this,["bg_amt"]);});m.connect("contract_cur_code","onChange",function(){m.setCurrency(this,["contract_amt"]);});m.connect("net_exposure_cur_code","onChange",function(){m.setCurrency(this,["net_exposure_amt"]);});m.connect("bg_amt","onBlur",function(){m.setTnxAmt(this.get("value"));});m.connect("recipient_bank_abbv_name","onChange",m.populateReferences);m.connect("recipient_bank_abbv_name","onChange",m.updateBusinessDate);m.connect("recipient_bank_abbv_name","onClick",m.selectEntityBeforeBank);m.connect("adv_bank_conf_req","onClick",function(){m.toggleFields(this.get("checked")===true,["confirming_bank_address_line_2","confirming_bank_dom","confirming_bank_address_line_4"],["confirming_bank_name","confirming_bank_address_line_1"]);var _1e=d.byId("dijit_layout_TabContainer_0_tablist_dijit_layout_ContentPane_2").innerHTML;if(this.get("checked")===true){m.animate("fadeIn",d.byId("confirming_bank_name_img"));d.byId("dijit_layout_TabContainer_0_tablist_dijit_layout_ContentPane_2").innerHTML=_2+_1e;}else{m.animate("fadeOut",d.byId("confirming_bank_name_img"));d.byId("dijit_layout_TabContainer_0_tablist_dijit_layout_ContentPane_2").innerHTML=_1e.replace(_2,"");}});m.connect("entity","onChange",function(){var _1f=dj.byId("recipient_bank_abbv_name");if(_1f){_1f.onChange();if(dj.byId("recipient_bank_customer_reference")){m.populateFacilityReference(dj.byId("recipient_bank_customer_reference"));}if(misys._config.entityBankMap&&Object.keys(misys._config.entityBankMap).length>1){m.populateBankAsPerEntity("recipient_bank_abbv_name");}}});m.connect("recipient_bank_customer_reference","onChange",m.setApplicantReference);m.connect("renew_on_code","onChange",m.validateRenewalCalendarDate);m.connect("advising_bank_name","onBlur",m.setConfirmedRequired);m.connect("final_expiry_date","onBlur",function(){if(dj.byId("adv_send_mode").get("value")=="01"){var _20=m.calculateFinalExpiryDate();var _21=function(){m.calculateRenewalFinalExpiryDate();};if(_20!=undefined&&dj.byId("final_expiry_date")&&dj.byId("final_expiry_date").get("value")!=null&&dj.byId("final_expiry_date").get("value").getTime()!==_20.getTime()){var _22=dojo.date.locale.format(new Date(_20.getTime()),{selector:"date",formatLength:"short",locale:dojo.config.locale,datePattern:m.getLocalization("g_strGlobalDateFormat")});m.dialog.show("DATE-CONFLICT",m.getLocalization("confirmResetFinalExpDate",[_22]),"","","","",_21,"","");}}});m.connect("adv_send_mode","onChange",function(){m.toggleMT798Fields("recipient_bank_abbv_name");if(dj.byId("adv_send_mode").get("value")==="01"){m.toggleRequired("narrative_additional_instructions",true);var _23=m.calculateFinalExpiryDate();var _24=function(){m.calculateRenewalFinalExpiryDate();};if(_23!=undefined&&dj.byId("final_expiry_date")&&dj.byId("final_expiry_date").get("value")!=null&&dj.byId("final_expiry_date").get("value").getTime()!==_23.getTime()){var _25=dojo.date.locale.format(new Date(_23.getTime()),{selector:"date",formatLength:"short",locale:dojo.config.locale,datePattern:m.getLocalization("g_strGlobalDateFormat")});m.dialog.show("DATE-CONFLICT",m.getLocalization("confirmResetFinalExpDate",[_25]),"","","","",_24,"","");}}else{m.toggleRequired("narrative_additional_instructions",false);}_5();});m.connect("adv_send_mode","onChange",function(){m.toggleFields((this.get("value")=="99"),null,["adv_send_mode_text"]);});m.connect("recipient_bank_abbv_name","onChange",function(){m.toggleMT798Fields("recipient_bank_abbv_name");});m.connect("renew_flag","onClick",function(){if(!this.get("checked")){dj.byId("rolling_renewal_nb").set("value","");}else{if(!dj.byId("rolling_renewal_flag").get("checked")){dj.byId("rolling_renewal_nb").set("value",m.getLocalization("default_rewnewalNumber"));}}});m.connect("advise_renewal_flag","onClick",function(){m.toggleFields(this.get("checked"),null,["advise_renewal_days_nb"]);});m.connect("advise_renewal_flag","onChange",function(){m.toggleFields(this.get("checked"),null,["advise_renewal_days_nb"]);});m.connect("renew_on_code","onChange",function(){m.toggleFields(this.get("value")==="02",null,["renewal_calendar_date"]);});m.connect("exp_date","onChange",m.calculateRenewalFinalExpiryDate);m.connect("rolling_renewal_nb","onBlur",m.calculateRenewalFinalExpiryDate);m.connect("renew_on_code","onBlur",m.calculateRenewalFinalExpiryDate);m.connect("renewal_calendar_date","onBlur",m.calculateRenewalFinalExpiryDate);m.connect("renew_for_nb","onBlur",m.calculateRenewalFinalExpiryDate);m.connect("renew_for_period","onBlur",m.calculateRenewalFinalExpiryDate);m.connect("entity_img_label","onClick",_1);m.connect("rolling_renew_on_code","onChange",m.calculateRenewalFinalExpiryDate);m.connect("rolling_renew_for_nb","onChange",m.calculateRenewalFinalExpiryDate);m.connect("rolling_renew_for_period","onChange",m.calculateRenewalFinalExpiryDate);m.connect("recipient_bank_customer_reference","onChange",function(){if(dj.byId("recipient_bank_customer_reference")){m.populateFacilityReference(dj.byId("recipient_bank_customer_reference"));}});m.connect("facility_id","onChange",m.getLimitDetails);m.connect("beneficiary_country","onChange",function(){if(dj.byId("recipient_bank_customer_reference")){m.populateFacilityReference(dj.byId("recipient_bank_customer_reference"));}});m.connect("bg_type_code","onChange",function(){if(dj.byId("recipient_bank_customer_reference")){m.populateFacilityReference(dj.byId("recipient_bank_customer_reference"));}});m.connect("facility_id","onChange",function(){if(this&&this.get("value")+"S"!=="S"){m.toggleFields(true,null,["limit_id","booking_amt","booking_cur_code"],true,true);}else{m.toggleFields(false,null,["limit_id","booking_amt","booking_cur_code"],true,true);}});m.connect("limit_id","onChange",m.setLimitFieldsValue);m.setValidation("booking_cur_code",m.validateCurrency);m.connect("facility_id","onChange",m.validateLimitBookingAmount);m.connect("limit_id","onChange",m.validateLimitBookingAmount);m.connect("bg_amt","onChange",m.validateLimitBookingAmount);m.connect("bg_cur_code","onChange",m.validateLimitBookingAmount);m.connect("booking_amt","onBlur",m.validateLimitBookingAmount);m.connect("contract_cur_code","onBlur",function(){if(dj.byId("contract_cur_code").get("value")!==""||!isNaN(dj.byId("contract_amt").get("value"))){m.toggleRequired("contract_amt",true);m.toggleRequired("contract_cur_code",true);}else{m.toggleRequired("contract_amt",false);m.toggleRequired("contract_cur_code",false);}});m.connect("contract_amt","onBlur",function(){if(dj.byId("contract_cur_code").get("value")!==""||!isNaN(dj.byId("contract_amt").get("value"))){m.toggleRequired("contract_amt",true);m.toggleRequired("contract_cur_code",true);}else{m.toggleRequired("contract_amt",false);m.toggleRequired("contract_cur_code",false);}});m.connect("license_lookup","onClick",function(){m.getLicenses("bg");});m.connect("bg_cur_code","onChange",function(){m.clearLicenseGrid(this,m._config.bgCurCode);});m.connect("entity","onChange",function(){m.clearLicenseGrid(this,m._config.applicant);});m.connect("beneficiary_name","onChange",function(){m.clearLicenseGrid(this,m._config.beneficiary);});m.connect("exp_date","onChange",function(){m.clearLicenseGrid(this,m._config.expDate);});m.connect("renew_flag","onClick",function(){m.clearLicenseGrid(this,m._config.renewFlag);});m.connect("renew_flag","onChange",function(){m.clearLicenseGrid(this,m._config.renewFlag);});m.connect("bg_type_code","onChange",function(){m.clearLicenseGrid(this,m._config.bgTypeCode);});m.connect("applicant_address_line_4","onFocus",function(){m.showTooltip(m.getLocalization("addressLine4ToolTip",[dj.byId("applicant_address_line_4").get("displayedValue"),dj.byId("applicant_address_line_4").get("value")]),d.byId("applicant_address_line_4"),["right"],5000);});m.connect("beneficiary_address_line_4","onFocus",function(){m.showTooltip(m.getLocalization("addressLine4ToolTip",[dj.byId("beneficiary_address_line_4").get("displayedValue"),dj.byId("beneficiary_address_line_4").get("value")]),d.byId("beneficiary_address_line_4"),["right"],5000);});m.connect("alt_applicant_address_line_4","onFocus",function(){m.showTooltip(m.getLocalization("addressLine4ToolTip",[dj.byId("alt_applicant_address_line_4").get("displayedValue"),dj.byId("alt_applicant_address_line_4").get("value")]),d.byId("alt_applicant_address_line_4"),["right"],5000);});m.connect("contact_address_line_4","onFocus",function(){m.showTooltip(m.getLocalization("addressLine4ToolTip",[dj.byId("contact_address_line_4").get("displayedValue"),dj.byId("contact_address_line_4").get("value")]),d.byId("contact_address_line_4"),["right"],5000);});m.connect("advising_bank_address_line_4","onFocus",function(){m.showTooltip(m.getLocalization("addressLine4ToolTip",[dj.byId("advising_bank_address_line_4").get("displayedValue"),dj.byId("advising_bank_address_line_4").get("value")]),d.byId("advising_bank_address_line_4"),["right"],5000);});m.connect("issuing_bank_address_line_4","onFocus",function(){m.showTooltip(m.getLocalization("addressLine4ToolTip",[dj.byId("issuing_bank_address_line_4").get("displayedValue"),dj.byId("issuing_bank_address_line_4").get("value")]),d.byId("issuing_bank_address_line_4"),["right"],5000);});m.connect("advising_bank_address_line_4","onFocus",function(){m.showTooltip(m.getLocalization("addressLine4ToolTip",[dj.byId("advising_bank_address_line_4").get("displayedValue"),dj.byId("advising_bank_address_line_4").get("value")]),d.byId("advising_bank_address_line_4"),["right"],5000);});m.connect("confirming_bank_address_line_4","onFocus",function(){m.showTooltip(m.getLocalization("addressLine4ToolTip",[dj.byId("confirming_bank_address_line_4").get("displayedValue"),dj.byId("confirming_bank_address_line_4").get("value")]),d.byId("confirming_bank_address_line_4"),["right"],5000);});var _26=dj.byId("dijit_layout_ContentPane_3");m.connect("lead_bank_flag","onClick",function(){var _27=d.byId("recipient_bank_abbv_name_label");var _28=dj.byId("recipient_bank_abbv_name");var _29=false;if(dj.byId("entity")){_29=true;var _2a=_28.store._arrayOfAllItems;}else{_2a=_28.store.root.options;}if(this.get("checked")){if(_26!=null){dijit.byId("dijit_layout_TabContainer_0").addChild(_26,3);if(dj.byId("org_lead_bank_flag")&&dj.byId("org_lead_bank_flag").get("value")!=="Y"){d.place(d.create("span",{innerHTML:_2}),d.byId("dijit_layout_TabContainer_0_tablist_dijit_layout_ContentPane_3"),"first");}}_27.innerHTML=dj.byId("lead_bank_label").get("value");for(var i=0;i<_2a.length;i++){var _2b=_29?_2a[i].value[0]:_2a[i].value;if(!misys._config.leadBankAccess[_2b]){_4.push(_2a[i]);if(_29){dj.byId("recipient_bank_abbv_name").store._arrayOfAllItems.remove(i);}else{dj.byId("recipient_bank_abbv_name").store.root.options.remove(i);}}}m.toggleRequired("processing_bank_name",true);m.toggleRequired("processing_bank_address_line_1",true);}else{m.toggleRequired("processing_bank_name",false);m.toggleRequired("processing_bank_address_line_1",false);dj.byId("processing_bank_name").set("value","");dj.byId("processing_bank_address_line_1").set("value","");dj.byId("processing_bank_address_line_2").set("value","");dj.byId("processing_bank_dom").set("value","");dj.byId("processing_bank_address_line_4").set("value","");dijit.byId("dijit_layout_TabContainer_0").removeChild(dijit.byId("dijit_layout_ContentPane_3"));_27.innerHTML=dj.byId("recipient_bank_label").get("value");for(var j=0;j<_4.length;j++){_2a.add(_4[j]);}_4=[];}d.place(d.create("span",{"class":"required-field-symbol",innerHTML:_2}),_27,"first");if(!_28.get("disabled")){_28.set("value","");}dj.byId("recipient_bank_customer_reference").set("value","");});},setConfirmedRequired:function(){var _2c=dj.byId("advising_bank_name");var _2d=dj.byId("adv_bank_conf_req");if(_2c){var _2e=dj.byId("advising_bank_name").get("value");if(_2e!==""){_2d.set("disabled",false);_2d.set("checked",false);if(d.byId("span_id")){d.empty("span_id");}}else{_2d.set("disabled",true);_2d.set("checked",false);}}},onFormLoad:function(){m._config.bgCurCode=dj.byId("bg_cur_code").get("value");m._config.beneficiary.name=dj.byId("beneficiary_name").get("value");m._config.beneficiary.addressLine1=dj.byId("beneficiary_address_line_1").get("value");m._config.beneficiary.addressLine2=dj.byId("beneficiary_address_line_2").get("value");m._config.beneficiary.dom=dj.byId("beneficiary_dom").get("value");m._config.applicant.entity=dj.byId("entity")?dj.byId("entity").get("value"):"";m._config.applicant.name=dj.byId("applicant_name").get("value");m._config.applicant.addressLine1=dj.byId("applicant_address_line_1").get("value");m._config.applicant.addressLine2=dj.byId("applicant_address_line_2").get("value");m._config.applicant.dom=dj.byId("applicant_dom").get("value");m._config.expDate=dj.byId("exp_date").get("displayedValue");m._config.renewFlag=dj.byId("renew_flag").get("checked");m._config.bgTypeCode=dj.byId("bg_type_code")?dj.byId("bg_type_code").get("value"):"";if(dj.byId("entity")&&dj.byId("entity").readOnly&&dj.byId("entity").get("value")!==""){if(misys._config.entityBankMap&&Object.keys(misys._config.entityBankMap).length>1){m.populateBankAsPerEntity("recipient_bank_abbv_name");}}var _2f=dj.byId("iss_date_type_code");if(_2f){m.toggleFields(_2f.get("value")==="99",null,["iss_date_type_details"]);}var _30=dj.byId("exp_date_type_code");if(_30){m.toggleFields(_30.get("value")!="01",null,["exp_date"]);m.toggleFields(_30.get("value")!="02",null,["exp_event"]);if(_30.get("value")==="01"&&dj.byId("renew_flag")){dj.byId("renew_flag").set("checked",false);dj.byId("renew_flag").set("disabled",true);}}var _31=dj.byId("adv_send_mode");if(_31){m.toggleFields(_31.get("value")=="99",null,["adv_send_mode_text"]);}var _32=dj.byId("reduction_authorised");if(_32){m.toggleFields(_32.get("value")==="on",null,["reduction_clause"]);}var _33=dj.byId("reduction_clause");if(_33){m.toggleFields(_33.get("value")==="03",null,["reduction_clause_other"]);}var _34=dj.byId("for_account");if(_34){m.toggleFields(_34.get("value")==="on",["alt_applicant_address_line_2","alt_applicant_dom","alt_applicant_address_line_4"],["alt_applicant_name","alt_applicant_address_line_1","alt_applicant_country"]);}var _35=dj.byId("consortium");if(_35){m.toggleFields(_35.get("value")==="on",null,["net_exposure_cur_code","net_exposure_amt","consortium_details"],true,true);var _36=dj.byId("consortium_details");_36.set("disabled",(_35.get("value")!="on"));}var _37=dj.byId("issuing_bank_type_code");if(_37){m.toggleFields(_37.get("value")==="02",["issuing_bank_address_line_2","issuing_bank_dom","issuing_bank_address_line_4"],["issuing_bank_name","issuing_bank_address_line_1"]);if(_37.get("value")==="01"){m.animate("fadeOut",d.byId("issuing_bank_name_img"));}else{if(_37.get("value")==="02"){m.animate("fadeIn",d.byId("issuing_bank_name_img"));}}}var _38=dj.byId("delivery_to");if(_38){m.toggleFields(_38.get("value")==="04",null,["delivery_to_other"]);}var _39=dj.byId("text_language");if(_39){m.toggleFields(_39.get("value")==="*",null,["text_language_other"]);}var _3a=dj.byId("bg_rule");if(_3a){m.toggleFields(_3a.get("value")==="99",null,["bg_rule_other"]);}var _3b=dj.byId("bg_text_type_code"),_3c=dj.byId("bg_text_details_code");if(_3c&&_3b&&_3c.get("value")==="02"){_3b.set("disabled",true);_3b.set("value","01");}if(_3b){m.toggleFields(_3b.get("value")==="03",null,["bg_text_type_details"]);}m.setCurrency(dj.byId("bg_cur_code"),["bg_amt"]);m.setCurrency(dj.byId("contract_cur_code"),["contract_amt"]);m.setCurrency(dj.byId("booking_cur_code"),["booking_amt"]);m.setCurrency(dj.byId("net_exposure_cur_code"),["net_exposure_amt"]);var _3d=dj.byId("recipient_bank_abbv_name");if(_3d){_3d.onChange();}var _3e=dj.byId("recipient_bank_customer_reference");if(_3e){_3e.onChange();}var _3f=dj.byId("bg_type_code"),_40=dj.byId("guarantee_type_code");if(_3f){_3f.onChange(_3f.get("value"));}var _41=dj.byId("facility_id"),_42=dj.byId("facility_reference");if(_42&&_41.get("value")+"S"==="S"){if(_42.get("value")+"S"!=="S"){m._config.isLoading=true;}_41.set("displayedValue",_42.get("value"));}var _43=dj.byId("advising_bank_name");var _44=dj.byId("adv_bank_conf_req");if(_43&&_43.get("value")===""){_44.set("disabled",true);_44.set("checked",false);}if(_44){m.toggleFields(_44.get("checked")===true,["confirming_bank_address_line_2","confirming_bank_dom","confirming_bank_address_line_4"],["confirming_bank_name","confirming_bank_address_line_1"]);}if(_44&&_44.get("checked")===true){m.animate("fadeIn",d.byId("confirming_bank_name_img"));}else{m.animate("fadeOut",d.byId("confirming_bank_name_img"));}var _45=dojo.subscribe(_3,function(){m.toggleFields(m._config.customerBanksMT798Channel[_3d]===true&&m.hasAttachments(),null,["delivery_channel"],false,false);});var _46=d.byId("pro-check-box");if(m._config.provisionalProductTypes[dj.byId("bg_type_code").get("value")]){m.animate("fadeIn",_46);}else{dj.byId("provisional_status").set("checked",false);m.animate("fadeOut",_46);}var _47=d.byId("tender-exp-date");if(dj.byId("contract_ref").get("value")==="TEND"){m.animate("fadeIn",_47);}else{dj.byId("tender_expiry_date").set("value",null);m.animate("fadeOut",_47);}var _48=dj.byId("renew_flag");if(_48){d.hitch(_48,m.toggleRenewalDetails,true)();}var _49=dj.byId("renew_on_code");if(_49){m.toggleFields(_49.get("value")==="02",null,["renewal_calendar_date"],true);}var _4a=dj.byId("advise_renewal_flag");if(_4a){m.toggleFields(_4a.get("checked"),null,["advise_renewal_days_nb"],true);}var _4b=dj.byId("rolling_renewal_flag");if(_4b){m.toggleFields(_4b.get("checked"),["final_expiry_date"],["rolling_renewal_nb","rolling_cancellation_days"],true);}m.populateGridOnLoad("bg");if(_3d&&dj.byId("bg_code")){if(_3d.get("value")!==""&&misys._config.leadBankAccess[_3d.get("value")]){m.animate("fadeIn",d.byId("lead-bank-check-box"));}else{m.animate("fadeOut",d.byId("lead-bank-check-box"));}}if(dj.byId("lead_bank_flag")&&_3d){var _4c=d.byId("recipient_bank_abbv_name_label");var _4d=false;if(dj.byId("entity")){_4d=true;var _4e=_3d.store._arrayOfAllItems;}else{_4e=_3d.store.root.options;}if(dj.byId("lead_bank_flag").get("checked")){_4c.innerHTML=dj.byId("lead_bank_label").get("value");for(var i=0;i<_4e.length;i++){var _4f=_4d?_4e[i].value[0]:_4e[i].value;if(!misys._config.leadBankAccess[_4f]){_4.push(_4e[i]);if(_4d){dj.byId("recipient_bank_abbv_name").store._arrayOfAllItems.remove(i);}else{dj.byId("recipient_bank_abbv_name").store.root.options.remove(i);}}}m.toggleRequired("processing_bank_name",true);m.toggleRequired("processing_bank_address_line_1",true);}else{m.toggleRequired("processing_bank_name",false);m.toggleRequired("processing_bank_address_line_1",false);dj.byId("processing_bank_name").set("value","");dj.byId("processing_bank_address_line_1").set("value","");dj.byId("processing_bank_address_line_2").set("value","");dj.byId("processing_bank_dom").set("value","");dj.byId("processing_bank_address_line_4").set("value","");dijit.byId("dijit_layout_TabContainer_0").removeChild(dijit.byId("dijit_layout_ContentPane_3"));_4c.innerHTML=dj.byId("recipient_bank_label").get("value");for(var j=0;j<_4.length;j++){_4e.add(_4[j]);}_4=[];}d.place(d.create("span",{"class":"required-field-symbol",innerHTML:_2}),_4c,"first");}else{m.toggleRequired("processing_bank_name",false);m.toggleRequired("processing_bank_address_line_1",false);dj.byId("dijit_layout_TabContainer_0").removeChild(dj.byId("dijit_layout_ContentPane_3"));}if(dj.byId("adv_send_mode")&&dj.byId("adv_send_mode").get("value")==="01"){m.toggleRequired("narrative_additional_instructions",true);}else{m.toggleRequired("narrative_additional_instructions",false);}m.setRenewalAmountOnFormLoad();if(dj.byId("bg_text_type_code")){_5();}},beforeSaveValidations:function(){if(dj.byId("bg_type_code").get("value")!=="99"){dj.byId("bg_type_details").set("value","");}var _50=dj.byId("principal_act_no");if(_50&&_50.get("value")!==""){if(!m.validatePricipleAccount()){m._config.onSubmitErrorMsg=m.getLocalization("invalidPrincipleAccountError",[_50.get("displayedValue")]);m.showTooltip(m.getLocalization("invalidPrincipleAccountError",[_50.get("displayedValue")]),_50.domNode);_50.focus();return false;}}var _51=dj.byId("fee_act_no");if(_51&&_51.get("value")!==""){if(!m.validateFeeAccount()){m._config.onSubmitErrorMsg=m.getLocalization("invalidFeeAccountError",[_51.get("displayedValue")]);m.showTooltip(m.getLocalization("invalidFeeAccountError",[_51.get("displayedValue")]),_51.domNode);_51.focus();return false;}}var _52=dj.byId("entity");if(_52&&_52.get("value")===""){return false;}else{return true;}},beforeSubmitValidations:function(){var _53=true;if(dj.byId("bg_amt")){if(!m.validateAmount((dj.byId("bg_amt"))?dj.byId("bg_amt"):0)){m._config.onSubmitErrorMsg=m.getLocalization("amountcannotzero");dj.byId("bg_amt").set("value","");return false;}}if(_53===true&&dj.byId("booking_amt")){_53=m.validateLimitBookingAmount();}if(dj.byId("rolling_renewal_flag")&&dj.byId("rolling_renewal_nb")&&dj.byId("rolling_renewal_flag").get("checked")&&d.number.parse(dj.byId("rolling_renewal_nb").get("value"))===1){m._config.onSubmitErrorMsg=m.getLocalization("invalidNumberOfRollingRenewals");dj.byId("rolling_renewal_nb").set("value","");dj.byId("rolling_renewal_nb").focus();return false;}var _54=dj.byId("bg_text_type_code")?dj.byId("bg_text_type_code").value:"";if(_53===true&&(_54==="02"||_54==="04")){_53=m.checkForAttachments();}if(_53===true){_53=m.validateLSAmtSumAgainstTnxAmt("bg");}if(!(m.validateLength(["applicant","alt_applicant","beneficiary","contact","advising_bank","confirming_bank"]))){return false;}var _55=dj.byId("bg_type_code");if(_55&&(dj.byId("bg_type_code").get("value")!="99")){dj.byId("bg_type_details").set("value","");}var _56=dj.byId("principal_act_no");if(_56&&_56.get("value")!==""){if(!m.validatePricipleAccount()){m._config.onSubmitErrorMsg=m.getLocalization("invalidPrincipleAccountError",[_56.get("displayedValue")]);m.showTooltip(m.getLocalization("invalidPrincipleAccountError",[_56.get("displayedValue")]),_56.domNode);_56.focus();return false;}}if(dj.byId("recipient_bank_abbv_name")&&!m.validateApplDate(dj.byId("recipient_bank_abbv_name").get("value"))){m._config.onSubmitErrorMsg=m.getLocalization("changeInApplicationDates");m.goToTop();return false;}var _57=dj.byId("fee_act_no");if(_57&&_57.get("value")!==""){if(!m.validateFeeAccount()){m._config.onSubmitErrorMsg=m.getLocalization("invalidFeeAccountError",[_57.get("displayedValue")]);m.showTooltip(m.getLocalization("invalidFeeAccountError",[_57.get("displayedValue")]),_57.domNode);_57.focus();return false;}}return _53;},generateGTEEFromNew:function(){var _58=m.formToXML();dj.byId("transactiondata_download_project").set("value",_58);dj.byId("gteeName_download_project").set("value",dj.byId("bg_text_type_code").get("value"));dj.byId("company_download_project").set("value",dj.byId("company_name").get("value"));dj.byId("bank_download_project").set("value",dj.byId("recipient_bank_abbv_name").get("value"));if(dj.byId("entity")){dj.byId("entity_download_project").set("value",dj.byId("entity").get("value"));}if(dj.byId("parent_entity")){dj.byId("parentEntity_download_project").set("value",dj.byId("parent_entity").get("value"));}if(!dj.byId("downloadgteetext")){d.parser.parse();}dj.byId("downloadgteetext").submit();return false;}});})(dojo,dijit,misys);dojo.require("misys.client.binding.trade.create_bg_client");}