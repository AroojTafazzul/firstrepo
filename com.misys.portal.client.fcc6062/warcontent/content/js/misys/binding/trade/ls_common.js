/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.trade.ls_common"]){dojo._hasResource["misys.binding.trade.ls_common"]=true;dojo.provide("misys.binding.trade.ls_common");dojo.require("dojo.data.ItemFileWriteStore");(function(d,dj,m){function _1(_2){var _3=dj.byId("additional_amt"),_4=dj.byId("org_additional_amt"),_5=dj.byId("ls_amt"),_6=dj.byId("org_ls_amt"),_7=d.number.parse(_6.get("displayedValue")),_8=d.number.parse(_4.get("displayedValue")),_9=d.number.parse(_2.get("displayedValue"));_7=!isNaN(_7)?_7:0;_8=!isNaN(_8)?_8:0;_9=!isNaN(_9)?_9:0;if(_2.id==="inc_amt"){_5.set("value",_7+_9);}else{if(_2.id==="dec_amt"){if(_9<=_7){_5.set("value",_7-_9);}else{m.setFieldState(_2,false);}}else{if(_2.id==="additional_inc_amt"){_3.set("value",_8+_9);}else{if(_2.id==="additional_dec_amt"){if(_9<=_8){_3.set("value",_8-_9);}else{m.setFieldState(_2,false);}}}}}if(dj.byId("total_amt")){var _a=d.number.parse(_5.get("displayedValue")),_b=d.number.parse(_3.get("displayedValue"));_a=!isNaN(_a)?_a:0;_b=!isNaN(_b)?_b:0;dj.byId("total_amt").set("value",_a);}};d.mixin(m,{amendLicenseTransaction:function(){var _c="";if("inc_amt"===this.get("id")){_c=dj.byId("dec_amt");}else{if("dec_amt"===this.get("id")){_c=dj.byId("inc_amt");}else{if("additional_inc_amt"===this.get("id")){_c=dj.byId("additional_dec_amt");}else{if("additional_dec_amt"===this.get("id")){_c=dj.byId("additional_inc_amt");}}}}if(!isNaN(this.get("value"))){_c.set("disabled",true);}else{this.set("disabled",false);_c.set("disabled",false);}_1(this);},handleAdditionalAmountDetails:function(){if(dj.byId("additional_amt")&&dj.byId("org_additional_amt")){var _d=d.number.parse(dj.byId("additional_amt").get("displayedValue")),_e=d.number.parse(dj.byId("org_additional_amt").get("displayedValue"));_d=!isNaN(_d)?_d:0;_e=!isNaN(_e)?_e:0;if(_d==_e||dj.byId("additional_amt").get("value")===0){dj.byId("narrative_additional_amount").set("disabled",true);dj.byId("narrative_additional_amount").set("value",dj.byId("org_narrative_additional_amount").get("value"));m.toggleRequired("narrative_additional_amount",false);if(d.byId("narrative_additional_amount_img")){d.byId("narrative_additional_amount_img").style.display="none";dj.byId("narrative_additional_amount_img").set("disabled",true);}}else{dj.byId("narrative_additional_amount").set("disabled",false);m.toggleRequired("narrative_additional_amount",true);d.byId("narrative_additional_amount_img").style.display="block";dj.byId("narrative_additional_amount_img").set("disabled",false);}}},validateIncAmount:function(_f,_10){var _11=dj.byId(_f);var _12=_11.get("value");var _13=d.number.parse(dj.byId("org_"+_10+"_amt").get("displayedValue"));_13=!isNaN(_13)?_13:0;if(!isNaN(_12)){if((_12+_13)>Number.MAX_VALUE){m.showTooltip(m.getLocalization("maximumValueError"),_11.domNode,["after"]);_11.state="Error";_11._setStateClass();dj.setWaiState(_11.focusNode,"invalid","true");}}},validateDecAmount:function(_14,_15){var _16=dj.byId(_14);var _17=_16.get("value");var _18=d.number.parse(dj.byId("org_"+_15+"_amt").get("displayedValue"));_18=!isNaN(_18)?_18:0;if(!isNaN(_17)){if((_18-_17)<0){m.showTooltip(m.getLocalization("amendAmountLessThanOriginalError"),_16.domNode,["after"]);_16.state="Error";_16._setStateClass();dj.setWaiState(_16.focusNode,"invalid","true");}}},setValidToDate:function(){var _19=dj.byId("valid_from_date"),_1a=dj.byId("valid_for_nb"),_1b=dj.byId("valid_for_period"),_1c=dj.byId("valid_to_date"),_1d=null,_1e=true;if(_19&&(_19.get("value")===null||_19.get("value")==="")){_1e=false;}if(_1a&&(_1a.get("value")===null||_1a.get("value")===""||isNaN(_1a.get("value")))){_1e=false;}if(_1b&&(_1b.get("value")===null||_1b.get("value")==="")){_1e=false;}if(_1c){if(_1e){switch(_1b.get("value")){case "01":_1d=d.date.add(_19.get("value"),"day",_1a.get("value"));break;case "02":_1d=d.date.add(_19.get("value"),"week",_1a.get("value"));break;case "03":_1d=d.date.add(_19.get("value"),"month",_1a.get("value"));break;case "04":_1d=d.date.add(_19.get("value"),"year",_1a.get("value"));break;default:break;}_1c.set("value",_1d);var _1f=new Date();_1f.setHours(0,0,0,0);var _20=d.date.compare(m.localizeDate(dj.byId("valid_to_date")),_1f)<0?false:true;if(_20){_1c.set("disabled",true);}else{_1c.set("disabled",false);_1a.set("value","");_1b.set("value","");_1b.set("disabled",true);}}else{_1c.set("disabled",false);}}},getLicenses:function(_21){var _22=_21+"_cur_code";var _23=dj.byId("beneficiary_name")?dj.byId("beneficiary_name").get("value"):"";if(_21==="br"){_22="bg_cur_code";_23=dj.byId("beneficiary_abbv_name")?dj.byId("beneficiary_abbv_name").get("value"):_23;}var _24=dj.byId(_22)?dj.byId(_22).get("value"):"";var _25=dj.byId("entity")?dj.byId("entity").get("value"):"";var _26=d.byId("maturity_date")?d.byId("maturity_date").value:"";var _27=dj.byId("applicant_name")?dj.byId("applicant_name").get("value"):"";var _28=d.byId("exp_date")?d.byId("exp_date").value:"";var _29=d.byId("iss_date")?d.byId("iss_date").value:"";var _2a=d.byId("last_ship_date")?d.byId("last_ship_date").value:"";var _2b=d.byId("final_expiry_date")?d.byId("final_expiry_date").value:"";var _2c=dj.byId("sub_product_code")?dj.byId("sub_product_code").get("value"):"*";var _2d=null;var _2e=null;var _2f="";if((_21==="bg")||(_21==="br")){_2f=dj.byId("bg_type_code")?dj.byId("bg_type_code").get("value"):"*";}else{if(_21==="si"){_2f=dj.byId("product_type_code")?dj.byId("product_type_code").get("value"):"*";}}if(_2f===""){_2f="*";}if((_21==="ec")||(_21==="ic")){var _30=dj.byId("drawer_name")?dj.byId("drawer_name").get("value"):"";var _31=dj.byId("drawee_name")?dj.byId("drawee_name").get("value"):"";if(_21==="ec"){if(m._config.licenseBeneficiaryEnabled===true){if(_24===""||_31===""||_30===""){m.dialog.show("ERROR",m.getLocalization("selectRequiredValuesFirstforCollections"));return;}}else{if(_24===""||_31===""){m.dialog.show("ERROR",m.getLocalization("selectRequiredValuesFirstforCollectionsWithoutBenf"));return;}}}if(_21==="ic"){if(_24===""||_31===""){m.dialog.show("ERROR",m.getLocalization("selectRequiredValuesFirstforImportCollections"));return;}}if(_21==="ec"){_2d=dj.byId("remitting_bank_abbv_name")?dj.byId("remitting_bank_abbv_name").get("value"):"";m.showSearchDialog("license_item","['ls_ref_id', 'bo_ref_id', 'ls_number','ls_curr','ls_allocated_amt', 'ls_amt', 'ls_os_amt', 'converted_os_amt', 'allow_overdraw']",{cur_code:_24,entity:_25,beneficiary:_31,product_code:_21.toUpperCase(),sub_product_code:_2c,bank_abbv_name:_2d},"",_21.toUpperCase(),"width:1100px;height:350px;",m.getLocalization("ListOfLicensesTitleMessage"));}else{m.showSearchDialog("license_item","['ls_ref_id', 'bo_ref_id', 'ls_number','ls_curr','ls_allocated_amt', 'ls_amt', 'ls_os_amt', 'converted_os_amt', 'allow_overdraw']",{cur_code:_24,entity:_25,beneficiary:dj.byId("drawee_abbv_name")?dj.byId("drawee_abbv_name").get("value"):"",product_code:_21.toUpperCase(),sub_product_code:_2c},"",_21.toUpperCase(),"width:1100px;height:350px;",m.getLocalization("ListOfLicensesTitleMessage"));}}else{if(_21==="el"){_22="lc_cur_code";_24=dj.byId(_22)?dj.byId(_22).get("value"):"";_23=dj.byId("beneficiary_abbv_name")?dj.byId("beneficiary_abbv_name").get("value"):_23;if(dj.byId("option")&&dj.byId("option").get("value")==="ASSIGNEE"){_28=dj.byId("assignee_exp_date")?dj.byId("assignee_exp_date").get("value"):"";}if(_24===""||_23===""||_28===""){m.dialog.show("ERROR",m.getLocalization("selectRequiredValuesFirstForEL"));return;}m.showSearchDialog("license_item","['ls_ref_id', 'bo_ref_id', 'ls_number','ls_curr','ls_allocated_amt', 'ls_amt', 'ls_os_amt', 'converted_os_amt', 'allow_overdraw']",{cur_code:_24,entity:_25,beneficiary:_23,product_code:_21.toUpperCase(),sub_product_code:_2c,exp_date:_28,last_ship_date:_2a},"",_21.toUpperCase(),"width:1100px;height:350px;",m.getLocalization("ListOfLicensesTitleMessage"));}else{if(_21==="br"){if(_24===""||_23===""||_28===""){m.dialog.show("ERROR",m.getLocalization("selectRequiredValuesFirstForEL"));return;}m.showSearchDialog("license_item","['ls_ref_id', 'bo_ref_id', 'ls_number','ls_curr','ls_allocated_amt', 'ls_amt', 'ls_os_amt', 'converted_os_amt', 'allow_overdraw']",{cur_code:_24,entity:_25,beneficiary:_23,product_code:_21.toUpperCase(),sub_product_code:_2c,exp_date:_28,last_ship_date:_2a},"",_21.toUpperCase(),"width:1100px;height:350px;",m.getLocalization("ListOfLicensesTitleMessage"));}else{if(_21==="tf"){_22="fin_cur_code";_24=dj.byId(_22)?dj.byId(_22).get("value"):"";_2e=dijit.byId("menu_from")?dijit.byId("menu_from").get("value"):"";if(_24===""||_27===""){m.dialog.show("ERROR",m.getLocalization("selectRequiredValuesFirstWithoutBenf"));return;}m.showSearchDialog("license_item","['ls_ref_id', 'bo_ref_id', 'ls_number','ls_curr','ls_allocated_amt', 'ls_amt', 'ls_os_amt', 'converted_os_amt', 'allow_overdraw']",{cur_code:_24,entity:_25,product_code:_21.toUpperCase(),sub_product_code:_2c,menu_from:_2e,mat_date:_26},"",_21.toUpperCase(),"width:1100px;height:350px;",m.getLocalization("ListOfLicensesTitleMessage"));}else{if(_21==="ft"&&_2c==="TTPT"){_22="ft_cur_code";_24=dj.byId(_22)?dj.byId(_22).get("value"):"";_23=dj.byId("counterparty_name");if(m._config.licenseBeneficiaryEnabled===true){if(_24===""||_23===""||_29===""||_27===""){m.dialog.show("ERROR",m.getLocalization("selectRequiredValuesFirst"));return;}}else{if(_24===""||_29===""||_27===""){m.dialog.show("ERROR",m.getLocalization("selectRequiredValuesFirstWithoutBenf"));return;}}m.showSearchDialog("license_item","['ls_ref_id', 'bo_ref_id', 'ls_number','ls_curr','ls_allocated_amt', 'ls_amt', 'ls_os_amt', 'converted_os_amt', 'allow_overdraw']",{cur_code:_24,entity:_25,product_code:_21.toUpperCase(),sub_product_code:_2c},"",_21.toUpperCase(),"width:1100px;height:350px;",m.getLocalization("ListOfLicensesTitleMessage"));}else{if(_21==="ft"&&_2c==="TINT"){_22="counterparty_cur_code";_24=dj.byId(_22)?dj.byId(_22).get("value"):"";if(_24===""||_27===""||_29===""){m.dialog.show("ERROR",m.getLocalization("selectRequiredValuesFirstForFTWithoutBenf"));return;}m.showSearchDialog("license_item","['ls_ref_id', 'bo_ref_id', 'ls_number','ls_curr','ls_allocated_amt', 'ls_amt', 'ls_os_amt', 'converted_os_amt', 'allow_overdraw']",{cur_code:_24,entity:_25,product_code:_21.toUpperCase(),sub_product_code:_2c},"",_21.toUpperCase(),"width:1100px;height:350px;",m.getLocalization("ListOfLicensesTitleMessage"));}else{if(dj.byId("org_exp_date")&&_28===""){_28=dj.byId("org_exp_date").get("value");}if((dj.byId("renew_flag")&&(dj.byId("renew_flag").get("checked")===true))&&(_2b===""||_2b===null)){m.dialog.show("ERROR",m.getLocalization("enterRenewalDetails"));return;}else{if((dj.byId("renew_flag")&&(dj.byId("renew_flag").get("checked")===true))&&_2b&&_2b!==""){_28=_2b;}}if(m._config.licenseBeneficiaryEnabled===true){if(_24===""||_23===""||_28===""||_27===""){m.dialog.show("ERROR",m.getLocalization("selectRequiredValuesFirst"));return;}}else{if(_24===""||_28===""||_27===""){m.dialog.show("ERROR",m.getLocalization("selectRequiredValuesFirstWithoutBenf"));return;}}if(_21==="lc"){_2d=dj.byId("issuing_bank_abbv_name")?dj.byId("issuing_bank_abbv_name").get("value"):"";}else{if(_21==="bg"){_2d=dj.byId("recipient_bank_abbv_name")?dj.byId("recipient_bank_abbv_name").get("value"):"";}}m.showSearchDialog("license_item","['ls_ref_id', 'bo_ref_id', 'ls_number','ls_curr','ls_allocated_amt', 'ls_amt', 'ls_os_amt', 'converted_os_amt', 'allow_overdraw']",{cur_code:_24,entity:_25,beneficiary:_23,product_code:_21.toUpperCase(),sub_product_code:_2c,exp_date:_28,last_ship_date:_2a,product_type_code:_2f,bank_abbv_name:_2d},"",_21.toUpperCase(),"width:1100px;height:350px;",m.getLocalization("ListOfLicensesTitleMessage"));}}}}}}},clearLicenseGrid:function(_32,_33,_34){var _35={items:""};var _36=[];var _37=dj.byId("gridLicense");var _38=_32.get("displayedValue")!==_33;if(_32.id==="entity"){_38=_32.get("displayedValue")!==_33.entity;}else{if(_32.id==="beneficiary_name"){_38=_32.get("displayedValue")!==_33.name;}else{if(_32.id==="drawee_name"){_38=_32.get("displayedValue")!==_33.name;}else{if(_32.id==="renew_flag"){_38=_32.get("checked")!==_33;}else{if(_32.id==="bg_type_code"){_38=_32.get("value")!==_33;}}}}}if(_37&&_37.store&&_37.store._arrayOfTopLevelItems&&_37.store._arrayOfTopLevelItems.length!==0&&_38){var _39=misys.getLocalization("resetLicenseGrid");var _3a=new dojo.data.ItemFileWriteStore({data:_35});var _3b=function(){_36=_37.store._arrayOfTopLevelItems;for(var i=0;i<_36.length;i++){if(dj.byId("licenseAmt_"+i)){dj.byId("licenseAmt_"+i).destroy(true);}}_37.setStore(_3a);if(_32.id==="exp_date"){m._config.expDate=_32.get("displayedValue");}else{if(_32.id==="entity"&&(_34!=="ec"&&_34!=="ic"&&_34!=="el"&&_34!=="br")){m._config.applicant.entity=_32.get("value");m._config.applicant.name=dj.byId("applicant_name").get("value");m._config.applicant.addressLine1=dj.byId("applicant_address_line_1").get("value");m._config.applicant.addressLine2=dj.byId("applicant_address_line_2").get("value");m._config.applicant.dom=dj.byId("applicant_dom").get("value");}else{if(_32.id==="entity"){if((_34==="ec")){m._config.drawer.entity=_32.get("value");m._config.drawer.name=dj.byId("drawer_name").get("value");m._config.drawer.addressLine1=dj.byId("drawer_address_line_1").get("value");m._config.drawer.addressLine2=dj.byId("drawer_address_line_2").get("value");m._config.drawer.dom=dj.byId("drawer_dom").get("value");}else{if(_34==="ic"){m._config.drawee.entity=_32.get("value");m._config.drawee.name=dj.byId("drawee_name").get("value");m._config.drawee.addressLine1=dj.byId("drawee_address_line_1").get("value");m._config.drawee.addressLine2=dj.byId("drawee_address_line_2").get("value");m._config.drawee.dom=dj.byId("drawee_dom").get("value");}}}else{if(_32.id==="beneficiary_name"){m._config.beneficiary.name=dj.byId("beneficiary_name").get("value");if(_34==="el"||_34==="br"){m._config.beneficiary.abbvName=dj.byId("beneficiary_abbv_name").get("value");m._config.beneficiary.entity=dj.byId("entity").get("value");}m._config.beneficiary.addressLine1=dj.byId("beneficiary_address_line_1").get("value");m._config.beneficiary.addressLine2=dj.byId("beneficiary_address_line_2").get("value");m._config.beneficiary.dom=dj.byId("beneficiary_dom").get("value");}else{if(_32.id==="drawee_name"&&(_34==="ec"||_34==="ic")){m._config.drawee.name=_32.get("value");if(_34==="ic"){m._config.drawee.entity=dj.byId("entity").get("value");}m._config.drawee.addressLine1=dj.byId("drawee_address_line_1").get("value");m._config.drawee.addressLine2=dj.byId("drawee_address_line_2").get("value");m._config.drawee.dom=dj.byId("drawee_dom").get("value");}else{if(_32.id==="lc_cur_code"){m._config.lcCurCode=_32.get("displayedValue");}else{if(_32.id==="ec_cur_code"){m._config.ecCurCode=_32.get("displayedValue");}else{if(_32.id==="ic_cur_code"){m._config.icCurCode=_32.get("displayedValue");}else{if(_32.id==="bg_cur_code"){m._config.bgCurCode=_32.get("displayedValue");}else{if(_32.id==="last_ship_date"){m._config.lastShipDate=_32.get("displayedValue");}else{if(_32.id==="renew_flag"){m._config.renewFlag=_32.get("checked");m.resetRenewalDetails(m._config.renewFlag,_32);}else{if(_32.id==="bg_type_code"){m._config.bgTypeCode=_32.get("value");}}}}}}}}}}}}};var _3c=function(){if(_32.id==="entity"&&(_34!=="ec"&&_34!=="ic"&&_34!=="el"&&_34!=="br")){_32.set("value",_33.entity);dj.byId("applicant_name").set("value",_33.name);dj.byId("applicant_address_line_1").set("value",_33.addressLine1);dj.byId("applicant_address_line_2").set("value",_33.addressLine2);dj.byId("applicant_dom").set("value",_33.dom);}else{if(_32.id==="entity"){if(_34==="ec"){_32.set("value",_33.entity);dj.byId("drawer_name").set("value",_33.name);dj.byId("drawer_address_line_1").set("value",_33.addressLine1);dj.byId("drawer_address_line_2").set("value",_33.addressLine2);dj.byId("drawer_dom").set("value",_33.dom);}else{if(_34==="ic"){_32.set("value",_33.entity);dj.byId("drawee_name").set("value",_33.name);dj.byId("drawee_address_line_1").set("value",_33.addressLine1);dj.byId("drawee_address_line_2").set("value",_33.addressLine2);dj.byId("drawee_dom").set("value",_33.dom);}}}else{if(_32.id==="beneficiary_name"){dj.byId("beneficiary_name").set("value",_33.name);if(_34==="el"||_34==="br"){dj.byId("beneficiary_abbv_name").set("value",_33.abbvName);dj.byId("entity")?dj.byId("entity").set("value",_33.entity):"";}dj.byId("beneficiary_address_line_1").set("value",_33.addressLine1);dj.byId("beneficiary_address_line_2").set("value",_33.addressLine2);dj.byId("beneficiary_dom").set("value",_33.dom);}else{if(_32.id==="drawee_name"&&(_34==="ec"||_34==="ic")){dj.byId("drawee_name").set("value",_33.name);if(_34==="ic"){dj.byId("entity").set("value",_33.entity);}dj.byId("drawee_address_line_1").set("value",_33.addressLine1);dj.byId("drawee_address_line_2").set("value",_33.addressLine2);dj.byId("drawee_dom").set("value",_33.dom);}else{if(_32.id==="renew_flag"){_32.set("checked",_33);}else{if(_32.id==="bg_type_code"){_32.set("value",_33);}else{_32.set("displayedValue",_33);}}}}}}};m.dialog.show("CONFIRMATION",_39,"","","","",_3b,_3c);}else{if(_32.id==="exp_date"){m._config.expDate=_32.get("displayedValue");}else{if(_32.id==="entity"&&(_34!=="ec"&&_34!=="ic")&&_34!=="el"&&_34!=="br"){m._config.applicant.entity=_32.get("value");m._config.applicant.name=dj.byId("applicant_name").get("value");m._config.applicant.addressLine1=dj.byId("applicant_address_line_1").get("value");m._config.applicant.addressLine2=dj.byId("applicant_address_line_2").get("value");m._config.applicant.dom=dj.byId("applicant_dom").get("value");}else{if(_32.id==="entity"){if((_34==="ec")){m._config.drawer.entity=_32.get("value");m._config.drawer.name=dj.byId("drawer_name").get("value");m._config.drawer.addressLine1=dj.byId("drawer_address_line_1").get("value");m._config.drawer.addressLine2=dj.byId("drawer_address_line_2").get("value");m._config.drawer.dom=dj.byId("drawer_dom").get("value");}else{if(_34==="ic"){m._config.drawee.entity=_32.get("value");m._config.drawee.name=dj.byId("drawee_name").get("value");m._config.drawee.addressLine1=dj.byId("drawee_address_line_1").get("value");m._config.drawee.addressLine2=dj.byId("drawee_address_line_2").get("value");m._config.drawee.dom=dj.byId("drawee_dom").get("value");}}}else{if(_32.id==="beneficiary_name"){m._config.beneficiary.name=dj.byId("beneficiary_name").get("value");if(_34==="el"||_34==="br"){m._config.beneficiary.abbvName=dj.byId("beneficiary_abbv_name").get("value");m._config.beneficiary.entity=dj.byId("entity").get("value");}m._config.beneficiary.addressLine1=dj.byId("beneficiary_address_line_1").get("value");m._config.beneficiary.addressLine2=dj.byId("beneficiary_address_line_2").get("value");m._config.beneficiary.dom=dj.byId("beneficiary_dom").get("value");}else{if(_32.id==="drawee_name"&&(_34==="ec"||_34==="ic")){m._config.drawee.name=_32.get("value");if(_34==="ic"){m._config.drawee.entity=dj.byId("entity").get("value");}m._config.drawee.addressLine1=dj.byId("drawee_address_line_1").get("value");m._config.drawee.addressLine2=dj.byId("drawee_address_line_2").get("value");m._config.drawee.dom=dj.byId("drawee_dom").get("value");}else{if(_32.id==="lc_cur_code"){m._config.lcCurCode=_32.get("displayedValue");}else{if(_32.id==="ec_cur_code"){m._config.ecCurCode=_32.get("displayedValue");}else{if(_32.id==="ic_cur_code"){m._config.icCurCode=_32.get("displayedValue");}else{if(_32.id==="bg_cur_code"){m._config.bgCurCode=_32.get("displayedValue");}else{if(_32.id==="last_ship_date"){m._config.lastShipDate=_32.get("displayedValue");}else{if(_32.id==="renew_flag"){m._config.renewFlag=_32.get("checked");m.resetRenewalDetails(m._config.renewFlag,_32);}else{if(_32.id==="bg_type_code"){m._config.bgTypeCode=_32.get("value");}}}}}}}}}}}}}},fetchLicenseRecords:function(_3d,_3e){var _3f=_3d.selection.getSelected().length;var _40=_3d.store?_3d.store._arrayOfAllItems.length:0;var _41=dj.byId("gridLicense").store?dj.byId("gridLicense").store._arrayOfTopLevelItems.length:0;var _42=true;var _43=m.getLocalization("multipleLicenseSelectionNotAllowedError");for(var l=0;l<_3d.selection.getSelected().length;l++){if(_3d.selection.getSelected()[l]===null){_3f=l;break;}}if(_3f!==0){if(_41===0){if(_3f>1){for(var i=0;i<_3f;i++){if(_3d.selection.getSelected()[i]&&_3d.selection.getSelected()[i].ALLOW_MULTIPLE_LS[0]==="N"){_42=false;m.dialog.show("ERROR",_43);}}}}else{if(_41===1){var ref=dj.byId("gridLicense")?dj.byId("gridLicense").store._arrayOfTopLevelItems[0].REFERENCEID[0]:"";var _44;for(var j=0;j<_3d.store._arrayOfAllItems.length;j++){if(ref.slice()===_3d.store._arrayOfAllItems[j].REFERENCEID[0].slice()){_44=_3d.store._arrayOfAllItems[j].ALLOW_MULTIPLE_LS[0];break;}}if(_44==="N"){_42=false;m.dialog.show("ERROR",_43);}else{for(var n=0;n<_3f;n++){if(_3d.selection.getSelected()[n]&&_3d.selection.getSelected()[n].ALLOW_MULTIPLE_LS[0]==="N"){_42=false;m.dialog.show("ERROR",_43);}}}}else{if(_41>1){for(var k=0;k<_3f;k++){if(_3d.selection.getSelected()[k]&&_3d.selection.getSelected()[k].ALLOW_MULTIPLE_LS[0]==="N"){_42=false;m.dialog.show("ERROR",_43);}}}}}}if(_42){if(_3f>0&&_40>0){m.processLicenseRecords(_3d,_3e);}dj.byId("xhrDialog").hide();}},processLicenseRecords:function(_45,_46){var _47=dj.byId("gridLicense");var _48=new dojo.data.ItemFileWriteStore({data:{"identifier":"REFERENCEID","items":[]}});var obj=[];if(_47&&_47.store&&_47.store._arrayOfTopLevelItems.length>0){_47.store.fetch({query:{REFERENCEID:"*"},onComplete:function(_49,_4a){dojo.forEach(_49,function(_4b){var _4c=_4b.REFERENCEID.slice().toString();var _4d=_4b.BO_REF_ID.slice().toString();var _4e=_4b.LS_NUMBER.slice().toString();var _4f=_4b.LS_ALLOCATED_AMT;var _50=_4b.LS_AMT;var _51=_4b.LS_OS_AMT;var _52=_4b.CONVERTED_OS_AMT;var _53=_4b.ALLOW_OVERDRAW;var _54="";if(d.byId("ls_delete_icon")!=null&&d.byId("ls_delete_icon")){_54=d.byId("ls_delete_icon").value;}var _55="<img src="+_54+" onClick =\"javascript:misys.deleteLicenseRecord('"+_4b.REFERENCEID+"')\"/>";var _56={"REFERENCEID":_4c,"BO_REF_ID":_4d,"LS_NUMBER":_4e,"ACTION":_55,"LS_ALLOCATED_AMT":_4f,"LS_AMT":_50,"LS_OS_AMT":_51,"CONVERTED_OS_AMT":_52,"ALLOW_OVERDRAW":_53};_48.newItem(_56);obj.push(_4b);});}});}var _57=_45.selection.getSelected();if(_57.length>0){for(var i=0;i<_57.length;i++){var _58=false;var _59="";var _5a={};var _5b=_57[i];if(_5b!==null){var _5c=_5b.REFERENCEID.slice().toString();var _5d=_5b.LS_NUMBER.slice().toString();var _5e=_5b.BO_REF_ID.slice().toString();var _5f=_5b.LS_AMT;var _60=_5b.LS_OS_AMT;var _61=_5b.CONVERTED_OS_AMT;var _62=_5b.ALLOW_OVERDRAW;var _63="";if(d.byId("ls_delete_icon")!=null&&d.byId("ls_delete_icon")){_63=d.byId("ls_delete_icon").value;}var _64="<img src="+_63+" onClick =\"javascript:misys.deleteLicenseRecord('"+_5b.REFERENCEID+"')\"/>";if(obj.length>0){for(var t=0;t<obj.length;t++){if(obj[t].REFERENCEID.slice().toString()===_5c.slice().toString()){_58=true;}}if(!_58){var j,k;for(j=0;dj.byId("licenseAmt_"+j);j++){continue;}_59=new misys.form.CurrencyTextBox({id:"licenseAmt_"+j,name:"licenseAmt_"+j,value:"",constraints:{min:0,max:999999999999.99},readOnly:false,selectOnClick:true});if(_46){m.setCurrency(_46,["licenseAmt_"+j]);}misys.connect("licenseAmt_"+j,"onClick",function(){var _65=this.id;dijit.byId("gridLicense").onCellFocus=function(_66,_67){if(_66.field==="LS_ALLOCATED_AMT"){dijit.byId(_65).textbox.focus();}};});_5a={"REFERENCEID":_5c,"BO_REF_ID":_5e,"LS_NUMBER":_5d,"ACTION":_64,"LS_ALLOCATED_AMT":_59,"LS_AMT":_5f,"LS_OS_AMT":_60,"CONVERTED_OS_AMT":_61,"ALLOW_OVERDRAW":_62};_48.newItem(_5a);misys.connect("licenseAmt_"+j,"onChange",function(){var _68=d.number.parse(this.get("value"));var _69=d.number.parse(dj.byId("gridLicense").store._arrayOfAllItems[(this.id).slice(-1)].CONVERTED_OS_AMT[0]);if(dj.byId("gridLicense").store._arrayOfAllItems[(this.id).slice(-1)].ALLOW_OVERDRAW[0]!=="Y"&&(_68>_69)){var _6a=m.getLocalization("allocatedAmtGreaterThanAvailableLSAmtError");var _6b=this;var _6c=function(){_6b.set("value",null);};m.dialog.show("ERROR",_6a,"",function(){setTimeout(_6c,500);});}});}}else{_59=new misys.form.CurrencyTextBox({id:"licenseAmt_"+i,name:"licenseAmt_"+i,value:"",constraints:{min:0,max:999999999999.99},readOnly:false,selectOnClick:true});if(_46){m.setCurrency(_46,["licenseAmt_"+i]);}misys.connect("licenseAmt_"+i,"onClick",function(){var _6d=this.id;dijit.byId("gridLicense").onCellFocus=function(_6e,_6f){if(_6e.field==="LS_ALLOCATED_AMT"){dijit.byId(_6d).textbox.focus();}};});_5a={"REFERENCEID":_5c,"BO_REF_ID":_5e,"LS_NUMBER":_5d,"ACTION":_64,"LS_ALLOCATED_AMT":_59,"LS_AMT":_5f,"LS_OS_AMT":_60,"CONVERTED_OS_AMT":_61,"ALLOW_OVERDRAW":_62};_48.newItem(_5a);misys.connect("licenseAmt_"+i,"onChange",function(){var _70=d.number.parse(this.get("value"));var _71=d.number.parse(dj.byId("gridLicense").store._arrayOfAllItems[(this.id).slice(-1)].CONVERTED_OS_AMT[0]);if(dj.byId("gridLicense").store._arrayOfAllItems[(this.id).slice(-1)].ALLOW_OVERDRAW[0]!=="Y"&&(_70>_71)){var _72=m.getLocalization("allocatedAmtGreaterThanAvailableLSAmtError");var _73=this;var _74=function(){_73.set("value",null);};m.dialog.show("ERROR",_72,"",function(){setTimeout(_74,500);});}});}}}}if(_47){_47.setStore(_48);dojo.style(_47.domNode,"display","");_47.resize();}},deleteLicenseRecord:function(ref){var _75=[];dj.byId("gridLicense").store.fetch({query:{REFERENCEID:"*"},onComplete:dojo.hitch(dj.byId("gridLicense"),function(_76,_77){dojo.forEach(_76,function(_78){if(_78.REFERENCEID.slice().toString()===ref.slice().toString()){dj.byId("gridLicense").store.deleteItem(_78);var _79=_78.LS_ALLOCATED_AMT[0].id;if(dj.byId(_79)){dj.byId(_79).destroy(true);}}});})});dj.byId("gridLicense").resize();dj.byId("gridLicense").render();},populateGridOnLoad:function(_7a){var _7b=dj.byId("gridLicense");if(_7b&&linkedLsItems&&linkedLsItems.length>0){var _7c=new dojo.data.ItemFileWriteStore({data:{"identifier":"REFERENCEID","items":[]}});if(dj.byId("gridLicense")&&linkedLsItems&&linkedLsItems.length>0){for(var i=0;i<linkedLsItems.length;i++){var _7d="";var _7e="";var _7f=linkedLsItems[i];var _80=_7f.REFERENCEID.slice().toString();var _81=_7f.BO_REF_ID.slice().toString();var _82=_7f.LS_NUMBER.slice().toString();var _83=_7f.LS_ALLOCATED_AMT;var _84=_7f.LS_AMT;var _85=_7f.LS_OS_AMT;var _86=_7f.CONVERTED_OS_AMT;var _87=_7f.ALLOW_OVERDRAW;var _88="";if(!dj.byId("licenseAmt_"+i)){_7d=new misys.form.CurrencyTextBox({id:"licenseAmt_"+i,name:"licenseAmt_"+i,value:_83,constraints:{min:0,max:999999999999.99},readOnly:false,selectOnClick:true});if(_7a!==null&&dj.byId(_7a+"_cur_code")){m.setCurrency(dj.byId(_7a+"_cur_code"),["licenseAmt_"+i]);}misys.connect("licenseAmt_"+i,"onClick",function(){var _89=this.id;dijit.byId("gridLicense").onCellFocus=function(_8a,_8b){if(_8a.field==="LS_ALLOCATED_AMT"){dijit.byId(_89).textbox.focus();}};});misys.connect("licenseAmt_"+i,"onChange",function(){var _8c=d.number.parse(this.get("value"));var _8d=d.number.parse(dj.byId("gridLicense").store._arrayOfAllItems[(this.id).slice(-1)].CONVERTED_OS_AMT[0]);if(dj.byId("gridLicense").store._arrayOfAllItems[(this.id).slice(-1)].ALLOW_OVERDRAW[0]!=="Y"&&(_8c>_8d)){var _8e=m.getLocalization("allocatedAmtGreaterThanAvailableLSAmtError");var _8f=this;var _90=function(){_8f.set("value",null);};m.dialog.show("ERROR",_8e,"",function(){setTimeout(_90,500);});}});}if(d.byId("ls_delete_icon")!=null&&d.byId("ls_delete_icon")){_88=d.byId("ls_delete_icon").value;}var _91="<img src="+_88+" onClick =\"javascript:misys.deleteLicenseRecord('"+_7f.REFERENCEID+"')\"/>";dijit.byId("gridLicense").onCellFocus=function(_92,_93){};var _94={"REFERENCEID":_80,"BO_REF_ID":_81,"LS_NUMBER":_82,"ACTION":_91,"LS_ALLOCATED_AMT":_7d,"LS_AMT":_84,"LS_OS_AMT":_85,"CONVERTED_OS_AMT":_86,"ALLOW_OVERDRAW":_87};_7c.newItem(_94);}}_7b.setStore(_7c);dojo.style(_7b.domNode,"display","");_7b.resize();}else{if(dj.byId("gridLicense")){dojo.style(dj.byId("gridLicense").domNode,"display","none");}}},validateLSAmtSumAgainstTnxAmt:function(_95){var _96=dj.byId("gridLicense");var sum=0,_97;if(_96&&_96.store&&_96.store._arrayOfTopLevelItems&&_96.store._arrayOfTopLevelItems.length>0){for(var i=0;i<_96.store._arrayOfTopLevelItems.length;i++){if((dj.byId("licenseAmt_"+i)&&dj.byId("licenseAmt_"+i).state==="Error")){m._config.onSubmitErrorMsg=m.getLocalization("focusOnErrorAlert");return false;}else{if(dj.byId("licenseAmt_"+i)){_97=d.number.parse(dj.byId("licenseAmt_"+i).get("value"));if(isNaN(_97)){m._config.onSubmitErrorMsg=m.getLocalization("noLicenseAmountError");return false;}sum=sum+(isNaN(_97)?0:_97);}}if(dj.byId("licenseAmt_"+i)&&dj.byId("licenseAmt_"+i).get("value")===0){m._config.onSubmitErrorMsg=m.getLocalization("licenseValueZeroError");return false;}}if(dj.byId(_95+"_amt")&&(sum!==dj.byId(_95+"_amt").value)){m._config.onSubmitErrorMsg=m.getLocalization("licensesSumGreaterThanTnxAmountError");return false;}}return true;}});})(dojo,dijit,misys);dojo.require("misys.client.binding.trade.ls_common_client");}