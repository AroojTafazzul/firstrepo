/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.trade.create_ft_tint"]){dojo._hasResource["misys.binding.trade.create_ft_tint"]=true;dojo.provide("misys.binding.trade.create_ft_tint");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("misys.widget.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.layout.ContentPane");dojo.require("dojo.data.ItemFileReadStore");dojo.require("dojo.parser");dojo.require("dijit.form.DateTextBox");dojo.require("dijit.form.CurrencyTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.form.addons");dojo.require("misys.form.file");dojo.require("dijit.layout.TabContainer");dojo.require("dojox.grid.DataGrid");dojo.require("dojox.grid.cells.dijit");dojo.require("misys.widget.Collaboration");dojo.require("misys.binding.trade.ls_common");dojo.require("misys.form.BusinessDateTextBox");(function(d,dj,m){function _1(){dj.byId("fee_act_no").set("value","");};function _2(){var _3=dj.byId("applicant_act_no").get("value");if(_3===""){m.dialog.show("ERROR",m.getLocalization("selectDebitFirst"));return;}var _4=dijit.byId("product_code").get("value");misys.showSearchDialog("account","['beneficiary_account','beneficiary_name', '', '', '','counterparty_cur_code']","","",_4,"width:650px;height:350px;",m.getLocalization("ListOfAccountsTitleMessage"),"","","","","applicant_act_no");};function _5(){var _6=dijit.byId("product_code").get("value");misys.showSearchDialog("account","['applicant_act_no','', '', '', '','applicant_act_cur_code']","","",_6,"width:650px;height:350px;",m.getLocalization("ListOfAccountsTitleMessage"));};function _7(){var _8=dijit.byId("applicant_act_no").get("value");var _9=dijit.byId("beneficiary_account").get("value");if(_8==_9){misys.dialog.show("ERROR",misys.getLocalization("sameBeneficiaryApplicantError"));dijit.byId("applicant_act_cur_code").set("value","");dijit.byId("applicant_act_no").set("value","");dijit.byId("beneficiary_account").set("value","");dijit.byId("counterparty_cur_code").set("value","");dijit.byId("beneficiary_name").set("value","");dijit.byId("ft_cur_code").set("value","");return;}};function _a(){dj.byId("counterparty_cur_code").set("value",dj.byId("selected_payment_cur_code").get("Value"));dj.byId("beneficiary_name").set("value",dj.byId("selected_beneficiary_name").get("Value"));dj.byId("beneficiary_account").set("value",dj.byId("selected_beneficiary_account_no").get("Value"));dj.byId("beneficiary_reference").set("value",dj.byId("selected_beneficiary_reference").get("Value"));dj.byId("feeAccount").set("value",dj.byId("selected_fee_act_no").get("Value"));};d.mixin(m._config,{initReAuthParams:function(){var _b={productCode:"FT",subProductCode:"",transactionTypeCode:"01",entity:dj.byId("entity")?dj.byId("entity").get("value"):"",bankAbbvName:dj.byId("issuing_bank_abbv_name")?dj.byId("issuing_bank_abbv_name").get("value"):"",currency:dj.byId("ft_cur_code")?dj.byId("ft_cur_code").get("value"):"",amount:dj.byId("ft_amt")?m.trimAmount(dj.byId("ft_amt").get("value")):"",es_field1:"",es_field2:""};return _b;},xmlTransform:function(_c){var _d="<ft_tnx_record>";if(_c.indexOf(_d)!==-1){var _e=m._config.xmlTagName,_f=_e?["<",_e,">"]:[],_10="</ft_tnx_record>",_11="";_11=_c.substring(_d.length,(_c.length-_10.length));_f.push(_11);if(dj.byId("gridLicense")&&dj.byId("gridLicense").store&&dj.byId("gridLicense").store!==null&&dj.byId("gridLicense").store._arrayOfAllItems.length>0){_f.push("<linked_licenses>");dj.byId("gridLicense").store.fetch({query:{REFERENCEID:"*"},onComplete:dojo.hitch(dj.byId("gridLicense"),function(_12,_13){dojo.forEach(_12,function(_14){_f.push("<license>");_f.push("<ls_ref_id>",_14.REFERENCEID,"</ls_ref_id>");_f.push("<bo_ref_id>",_14.BO_REF_ID,"</bo_ref_id>");_f.push("<ls_number>",_14.LS_NUMBER,"</ls_number>");_f.push("<ls_allocated_amt>",_14.LS_ALLOCATED_AMT,"</ls_allocated_amt>");_f.push("<ls_allocated_add_amt>",_14.LS_ALLOCATED_ADD_AMT,"</ls_allocated_add_amt>");_f.push("<ls_amt>",_14.LS_AMT,"</ls_amt>");_f.push("<ls_os_amt>",_14.LS_OS_AMT,"</ls_os_amt>");_f.push("<converted_os_amt>",_14.CONVERTED_OS_AMT,"</converted_os_amt>");_f.push("<allow_overdraw>",_14.ALLOW_OVERDRAW,"</allow_overdraw>");_f.push("</license>");});})});_f.push("</linked_licenses>");}if(_e){_f.push("</",_e,">");}return _f.join("");}else{return _c;}}});d.mixin(m,{bind:function(){m.setValidation("template_id",m.validateTemplateId);m.setValidation("applicant_act_cur_code",m.validateCurrency);m.connect("beneficiary_account_img","onClick",_2);m.connect("applicant_act_no_img_label","onClick",_5);m.connect("applicant_act_no","onChange",_7);m.connect("ft_amt","onBlur",function(){m.setCurrency(dj.byId("ft_cur_code"),["ft_amt"]);});m.connect("beneficiary_account","onChange",function(){if(dj.byId("counterparty_cur_code").get("value")!==""){dj.byId("ft_cur_code").set("value",dj.byId("counterparty_cur_code").get("value"));}});m.connect("issuing_bank_abbv_name","onChange",m.populateReferences);m.connect("issuing_bank_abbv_name","onChange",m.updateBusinessDate);if(dijit.byId("issuing_bank_abbv_name")){m.connect("entity","onChange",function(){dijit.byId("issuing_bank_abbv_name").onChange();});}m.connect("issuing_bank_customer_reference","onChange",m.setApplicantReference);m.connect("license_lookup","onClick",function(){m.getLicenses("ft");});m.setValidation("iss_date",function(){var _15=dj.byId("appl_date");if(!m.compareDateFields(_15,this)){this.invalidMessage=m.getLocalization("executionDateLessThanAppDateError",[m.getLocalizeDisplayDate(this),m.getLocalizeDisplayDate(_15)]);return false;}return true;});m.setValidation("counterparty_act_iso_code",m.validateBICFormat);m.connect("entity_img_label","onClick",_1);},onFormLoad:function(){_a();m.setCurrency(dj.byId("ft_cur_code"),["ft_amt"]);var _16=dijit.byId("issuing_bank_abbv_name");if(_16){_16.onChange();}var _17=dijit.byId("issuing_bank_customer_reference");if(_17){_17.onChange();_17.set("value",_17._resetValue);}m.populateGridOnLoad("ft");d.mixin(m,{isTransactionDataBeingSigned:false,originalRealFormSubmitFunction:function(){return;}});},beforeSaveValidations:function(){var _18=dj.byId("principal_act_no");if(_18&&_18.get("value")!==""){if(!m.validatePricipleAccount()){m._config.onSubmitErrorMsg=m.getLocalization("invalidPrincipleAccountError",[_18.get("displayedValue")]);m.showTooltip(m.getLocalization("invalidPrincipleAccountError",[_18.get("displayedValue")]),_18.domNode);_18.focus();return false;}}var _19=dj.byId("fee_act_no");if(_19&&_19.get("value")!==""){if(!m.validateFeeAccount()){m._config.onSubmitErrorMsg=m.getLocalization("invalidFeeAccountError",[_19.get("displayedValue")]);m.showTooltip(m.getLocalization("invalidFeeAccountError",[_19.get("displayedValue")]),_19.domNode);_19.focus();return false;}}var _1a=dj.byId("entity");if(_1a&&_1a.get("value")===""){return false;}else{return true;}},beforeSubmitValidations:function(){if(!m.validateAmount((dj.byId("ft_amt"))?dj.byId("ft_amt"):0)){m._config.onSubmitErrorMsg=m.getLocalization("amountcannotzero");dj.byId("ft_amt").set("value","");return false;}var _1b=dj.byId("iss_date");var _1c=dj.byId("appl_date");if(_1b&&_1b.get("value")!==""){if(!m.compareDateFields(_1c,_1b)){var _1d=m.getLocalization("executionDateLessThanAppDateError",[m.getLocalizeDisplayDate(_1b),m.getLocalizeDisplayDate(_1c)]);_1b.set("state","Error");_1b.focus();dj.showTooltip(_1d,_1b.domNode,0);return false;}}var _1e=dj.byId("principal_act_no");if(_1e&&_1e.get("value")!==""){if(!m.validatePricipleAccount()){m._config.onSubmitErrorMsg=m.getLocalization("invalidPrincipleAccountError",[_1e.get("displayedValue")]);m.showTooltip(m.getLocalization("invalidPrincipleAccountError",[_1e.get("displayedValue")]),_1e.domNode);_1e.focus();return false;}}var _1f=dj.byId("fee_act_no");if(_1f&&_1f.get("value")!==""){if(!m.validateFeeAccount()){m._config.onSubmitErrorMsg=m.getLocalization("invalidFeeAccountError",[_1f.get("displayedValue")]);m.showTooltip(m.getLocalization("invalidFeeAccountError",[_1f.get("displayedValue")]),_1f.domNode);_1f.focus();return false;}}if(dj.byId("issuing_bank_abbv_name")&&!m.validateApplDate(dj.byId("issuing_bank_abbv_name").get("value"))){m._config.onSubmitErrorMsg=m.getLocalization("changeInApplicationDates");m.goToTop();return false;}return m.validateLSAmtSumAgainstTnxAmt("ft");}});})(dojo,dijit,misys);dojo.require("misys.client.binding.trade.create_ft_tint_client");}