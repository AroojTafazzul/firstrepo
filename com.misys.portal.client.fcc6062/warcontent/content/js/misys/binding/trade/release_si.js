/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.trade.release_si"]){dojo._hasResource["misys.binding.trade.release_si"]=true;dojo.provide("misys.binding.trade.release_si");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("misys.form.file");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("misys.widget.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.layout.ContentPane");dojo.require("dijit.form.DateTextBox");dojo.require("dijit.form.CurrencyTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.widget.Collaboration");(function(d,dj,m){var _1="deletegridrecord";function _2(){var _3=dj.byId("release_amt");var _4=dj.byId("lc_amt");if(_3&&_4){var _5=dj.byId("lc_amt").get("value");var _6=dj.byId("release_amt").get("value");dj.byId("tnx_amt").set("value",_6);var _7=dj.byId("lc_release_flag");if((_6==_5)&&!(_7.get("checked"))){m.dialog.show("ERROR",m.getLocalization("selectReleaseFull"));m._config.onSubmitErrorMsg=m.getLocalization("selectReleaseFull");return false;}}return true;};function _8(){var _9=true;var _a=dj.byId("release_amt")?dj.byId("release_amt").get("value"):"";if(isNaN(_a)||(_a===0)){dj.byId("release_amt").set("value","");_9=false;}return _9;};d.mixin(m._config,{initReAuthParams:function(){var _b={productCode:"SI",subProductCode:"",transactionTypeCode:"03",entity:dj.byId("entity")?dj.byId("entity").get("value"):"",currency:dj.byId("lc_cur_code")?dj.byId("lc_cur_code").get("value"):"",amount:dj.byId("lc_amt")?m.trimAmount(dj.byId("lc_amt").get("value")):"",es_field1:"",es_field2:""};return _b;}});d.mixin(m,{bind:function(){m.connect("lc_release_flag","onClick",function(){var _c=dj.byId("release_amt"),_d=dj.byId("lc_amt").get("value");if(this.get("checked")){_c.set("readOnly",true);_c.reset();_c.set("value",_d);}else{_c.set("readOnly",false);_c.reset();_c.set("value",_d);}});m.connect("release_amt","onBlur",_2);m.setValidation("amd_date",m.validateAmendmentDate);m.connect("delv_org","onChange",function(){if(this.get("value")==="99"||this.get("value")==="02"){if(this.get("value")==="99"){m.toggleFields((this.get("value")==="99"),null,["delv_org_text"]);m.toggleRequired("delv_org_text",true);dj.byId("delv_org_text").set("value","");}if(this.get("value")==="02"){m.toggleFields((this.get("value")==="02"),null,["delv_org_text"]);m.toggleRequired("delv_org_text",true);dj.byId("delv_org_text").set("value","");}}else{dj.byId("delv_org_text").set("disabled",true);dj.byId("delv_org_text").set("value","");m.toggleRequired("delv_org_text",false);}});m.connect("delivery_to","onChange",function(){if(this.get("value")===""||this.get("value")==="04"){if(this.get("value")===""){dj.byId("narrative_delivery_to").set("disabled",false);dj.byId("narrative_delivery_to").set("value","");m.toggleRequired("narrative_delivery_to",false);document.getElementById("narrative_delivery_to_img").style.display="block";}else{m.toggleFields((this.get("value")==="04"),null,["narrative_delivery_to"]);m.toggleRequired("narrative_delivery_to",false);dj.byId("narrative_delivery_to").set("value","");dj.byId("narrative_delivery_to").set("disabled",true);document.getElementById("narrative_delivery_to_img").style.display="none";}}else{dj.byId("narrative_delivery_to").set("disabled",false);dj.byId("narrative_delivery_to").set("value","");m.toggleRequired("narrative_delivery_to",true);document.getElementById("narrative_delivery_to_img").style.display="block";}});m.connect("release_amt","onChange",function(){var _e=dj.byId("utilized_amt").get("value");var _f=dj.byId("lc_amt").get("value");var _10=dj.byId("release_amt").get("value");var _11=dj.byId("lc_cur_code")?dj.byId("lc_cur_code").get("value"):"";var _12=(_f-_e);if(_10>_12){var _13=m.getLocalization("releaseAmtGreaterThanLCAmtError",[_11,_12]);dj.byId("release_amt").set("state","Error");dj.showTooltip(_13,dj.byId("release_amt").domNode,0);}});},onFormLoad:function(){var _14=d.byId("org-lc-lib-amt");var _15=m._config.customerBanksMT798Channel[dj.byId("issuing_bank_abbv_name").get("value")]===true&&dj.byId("adv_send_mode").get("value")==="01";m.animate("fadeOut",_14);m._config.productCode="lc";var _16=dj.byId("tnx_amt");m.setCurrency(dj.byId("lc_cur_code"),["release_amt","lc_amt"]);var _17=dj.byId("lc_release_flag"),_18=dj.byId("lc_amt")?dj.byId("lc_amt").get("value"):"";if(_17){var _19=dj.byId("release_amt");if(_17.get("value")=="on"){_19.set("readOnly",true);_19.set("value",_18);}else{if(_16&&_16.get("value")!=""&&_16.get("value")!=null&&_17.get("value")!="on"){_19.set("readOnly",false);_19.set("value",_16.get("value"));}else{_19.set("readOnly",false);_19.set("value",_18);}}}if(_16){var _1a=dj.byId("release_amt").get("value");_16.set("value",_1a);}var _1b=dj.byId("sub_tnx_type_code");var _1c=dj.byId("issuing_bank_abbv_name")?dj.byId("issuing_bank_abbv_name").get("value"):"";if(_1b.get("value")=="05"&&_15){if(dj.byId("delivery_channel").get("value")===""){m.animate("fadeIn",d.byId("delivery_channel_row"));dj.byId("delivery_channel").set("disabled",true);}else{m.animate("fadeIn",d.byId("delivery_channel_row"));}if(dj.byId("delivery_channel")){if(!m.hasAttachments()){dj.byId("delivery_channel").set("disabled",true);dj.byId("delivery_channel").set("value",null);}else{m.toggleFields(m._config.customerBanksMT798Channel[_1c]===true&&m.hasAttachments(),null,["delivery_channel"],false,false);}m.animate("fadeIn","delivery_channel_row");m.connect("delivery_channel","onChange",function(){if(dj.byId("attachment-file")){if(dj.byId("delivery_channel").get("value")==="FACT"){dj.byId("attachment-file").displayFileAct(true);}else{dj.byId("attachment-file").displayFileAct(false);}}});dj.byId("delivery_channel").onChange();}}else{m.animate("fadeOut",d.byId("delivery_channel_row"));}var _1d=dojo.subscribe(_1,function(){m.toggleFields(m._config.customerBanksMT798Channel[_1c]===true&&m.hasAttachments(),null,["delivery_channel"],false,false);});if(dj.byId("delv_org")&&dj.byId("delv_org_text")){if(dj.byId("delv_org").value==="99"||dj.byId("delv_org").value==="02"){dj.byId("delv_org_text").set("disabled",false);m.toggleRequired("delv_org_text",true);}else{dj.byId("delv_org_text").set("disabled",true);m.toggleRequired("delv_org_text",false);}}if(dj.byId("delivery_to")&&dj.byId("narrative_delivery_to")){if(dj.byId("delivery_to").get("value")==="04"){m.toggleFields((dj.byId("delivery_to").get("value")==="04"),null,["narrative_delivery_to"]);m.toggleRequired("narrative_delivery_to",false);dj.byId("narrative_delivery_to").set("value","");dj.byId("narrative_delivery_to").set("disabled",true);document.getElementById("narrative_delivery_to_img").style.display="none";}else{if(dj.byId("delivery_to").get("value")!==""){dj.byId("narrative_delivery_to").set("disabled",false);m.toggleRequired("narrative_delivery_to",true);document.getElementById("narrative_delivery_to_img").style.display="block";}}}},beforeSaveValidations:function(){var _1e=dj.byId("principal_act_no");if(_1e&&_1e.get("value")!==""){if(!m.validatePricipleAccount()){m._config.onSubmitErrorMsg=m.getLocalization("invalidPrincipleAccountError",[_1e.get("displayedValue")]);m.showTooltip(m.getLocalization("invalidPrincipleAccountError",[_1e.get("displayedValue")]),_1e.domNode);_1e.focus();return false;}}if(!_8()){m._config.onSubmitErrorMsg=m.getLocalization("releaseAmountEmptyZero");return false;}var _1f=dj.byId("fee_act_no");if(_1f&&_1f.get("value")!==""){if(!m.validateFeeAccount()){m._config.onSubmitErrorMsg=m.getLocalization("invalidFeeAccountError",[_1f.get("displayedValue")]);m.showTooltip(m.getLocalization("invalidFeeAccountError",[_1f.get("displayedValue")]),_1f.domNode);_1f.focus();return false;}}var _20=dj.byId("utilized_amt").get("value");var _21=dj.byId("lc_amt").get("value");var _22=dj.byId("release_amt").get("value");var _23=dj.byId("release_amt");var _24=dj.byId("lc_cur_code")?dj.byId("lc_cur_code").get("value"):"";var _25=(_21-_20);if(_22>_25){m._config.onSubmitErrorMsg=m.getLocalization("releaseAmtGreaterThanLCAmtError",[_24,_25]);m.showTooltip(m.getLocalization("releaseAmtGreaterThanLCAmtError",[_24,_25]),_23.domNode);_23.focus();return false;}return true;},beforeSubmitValidations:function(){var _26=["lc_liab_amt","amd_details","file"];var _27=d.every(_26,function(id){if(d.byId(id)){return true;}return false;});if(!_8()){m._config.onSubmitErrorMsg=m.getLocalization("releaseAmountEmptyZero");return false;}if(_27){var _28=(d.query("#edit [id^='file_row_']").length>1);if(!_28&&!dj.byId("lc_liab_amt").get("value")&&(dj.byId("amd_details").get("value")=="")){m._config.onSubmitErrorMsg=m.getLocalization("noAmendmentError");return false;}}var _29=dj.byId("amd_date"),_2a=dj.byId("org_exp_date");if(_29&&_2a&&_2a.get("value")!==null){if(!m.compareDateFields(_29,_2a)){m._config.onSubmitErrorMsg=m.getLocalization("amendDateGreaterThanOldExpiryDate",[_29.get("displayedValue"),_2a.get("displayedValue")]);return false;}}var _2b=dj.byId("principal_act_no");if(_2b&&_2b.get("value")!==""){if(!m.validatePricipleAccount()){m._config.onSubmitErrorMsg=m.getLocalization("invalidPrincipleAccountError",[_2b.get("displayedValue")]);m.showTooltip(m.getLocalization("invalidPrincipleAccountError",[_2b.get("displayedValue")]),_2b.domNode);_2b.focus();return false;}}var _2c=dj.byId("fee_act_no");if(_2c&&_2c.get("value")!==""){if(!m.validateFeeAccount()){m._config.onSubmitErrorMsg=m.getLocalization("invalidFeeAccountError",[_2c.get("displayedValue")]);m.showTooltip(m.getLocalization("invalidFeeAccountError",[_2c.get("displayedValue")]),_2c.domNode);_2c.focus();return false;}}var _2d=dj.byId("utilized_amt").get("value");var _2e=dj.byId("lc_amt").get("value");var _2f=dj.byId("release_amt").get("value");var _30=dj.byId("release_amt");var _31=dj.byId("lc_cur_code")?dj.byId("lc_cur_code").get("value"):"";var _32=(_2e-_2d);if(_2f>_32){m._config.onSubmitErrorMsg=m.getLocalization("releaseAmtGreaterThanLCAmtError",[_31,_32]);m.showTooltip(m.getLocalization("releaseAmtGreaterThanLCAmtError",[_31,_32]),_30.domNode);_30.focus();return false;}var _33=dj.byId("release_amt");if(_33&&_33.get("value")===0){m._config.onSubmitErrorMsg=m.getLocalization("canNotProceedTheTransaction");return false;}else{return _2();}return true;}});})(dojo,dijit,misys);dojo.require("misys.client.binding.trade.release_si_client");}