/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.trade.message_tf"]){dojo._hasResource["misys.binding.trade.message_tf"]=true;dojo.provide("misys.binding.trade.message_tf");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.layout.ContentPane");dojo.require("dijit.TooltipDialog");dojo.require("dojo.data.ItemFileReadStore");dojo.require("dijit.form.FilteringSelect");dojo.require("dojo.data.ItemFileReadStore");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.form.file");dojo.require("misys.widget.Collaboration");dojo.require("dijit.Dialog");dojo.require("misys.form.PercentNumberTextBox");(function(d,dj,m){var _1=d.byId("div-messageType");var _2;var _3=m.getLocalization("settlementFreeFormatMessage");var _4=m.getLocalization("correspondenceFreeFormatMessage");var _5=d.byId("fx-message-type");var _6=d.byId("request-message-type");var _7="fx-section";function _8(){if(dj.byId("repayment_cur_code")){dj.byId("repayment_cur_code").reset();}if(dj.byId("repayment_amt")){dj.byId("repayment_amt").reset();}if(dj.byId("settlement_code")){dj.byId("settlement_code").reset();}if(dj.byId("principal_act_name")){dj.byId("principal_act_name").reset();}if(dj.byId("repayment_mode_1")&&dj.byId("repayment_mode_2")){dj.byId("repayment_mode_1").set("checked",true);dj.byId("repayment_mode_2").set("checked",false);}};function _9(_a){var _b=dj.byId("repayment_amt").domNode;dj.showTooltip(m.getLocalization(_a),_b,0);var _c=function(){dj.hideTooltip(_b);};var _d=2000;setTimeout(_c,_d);dj.byId("repayment_amt").set("state","Error");};function _e(_f){var _10=function(){var _11=dijit.byId("repayment_amt");_11.set("state","Error");m.defaultBindTheFXTypes();dj.byId("repayment_amt").set("value","");dj.byId("principal_act_name").set("value","");dj.byId("principal_act_cur_code").set("value","");dj.byId("principal_act_name").set("value","");dj.byId("principal_act_description").set("value","");dj.byId("principal_act_pab").set("value","");};m.dialog.show("ERROR",_f,"",function(){setTimeout(_10,500);});if(d.byId(_7)&&(d.style(d.byId(_7),"display")!=="none")){m.animate("wipeOut",d.byId(_7));}};function _12(){m.connect("repayment_amt","onBlur",function(){m.setTnxAmt(this.get("value"));if(!isNaN(dj.byId("repayment_amt").get("value"))&&dj.byId("repayment_cur_code").get("value")!==""){m.fireFXAction();}else{m.defaultBindTheFXTypes();}});m.connect("principal_act_name","onChange",function(){if(dj.byId("principal_act_cur_code")&&dj.byId("principal_act_cur_code").get("value")!==""){m.fireFXAction();}else{m.defaultBindTheFXTypes();if(d.byId(_7)&&(d.style(d.byId(_7),"display")!=="none")){m.animate("wipeOut",d.byId(_7));}}});};d.mixin(m._config,{initReAuthParams:function(){var _13=(dijit.byId("sub_tnx_type_code")&&dijit.byId("sub_tnx_type_code").get("value")==="24")?dj.byId("fin_amt").get("value"):dj.byId("repayment_amt").get("value");var _14=(dijit.byId("sub_tnx_type_code")&&dijit.byId("sub_tnx_type_code").get("value")==="24")?dj.byId("fin_cur_code").get("value"):dj.byId("repayment_cur_code").get("value");var _15={productCode:"TF",subProductCode:"",transactionTypeCode:"13",entity:dj.byId("entity")?dj.byId("entity").get("value"):"",currency:_14,amount:m.trimAmount(_13),es_field1:m.trimAmount(_13),es_field2:""};return _15;}});d.mixin(m,{fireFXAction:function(){var _16,_17;var _18=dj.byId("repayment_cur_code").get("value");var _19=dj.byId("repayment_amt").get("value");var _1a=dj.byId("principal_act_cur_code")?dj.byId("principal_act_cur_code").get("value"):"";var _1b=dj.byId("product_code").get("value");var _1c=false;var _1d="";if(dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""){_1d=dj.byId("issuing_bank_abbv_name").get("value");}if(m._config.fxParamData&&dj.byId("sub_product_code")&&dj.byId("sub_product_code").get("value")!==""){var _1e=m._config.fxParamData[dj.byId("sub_product_code").get("value")];if(m._config.fxParamData&&_1e.fxParametersData.isFXEnabled==="Y"){if(_18!==""&&!isNaN(_19)&&_1b!==""&&_1d!==""){if(_18!==_1a){_16=_1a;_17=_18;masterCurrency=_1a;}if(_16&&_16!==""&&_17&&_17!==""){if(d.byId(_7)){m.animate("wipeIn",d.byId(_7));}m.fetchFXDetails(_16,_17,_19,_1b,_1d,masterCurrency,_1c);if(dj.byId("fx_rates_type_1")&&dj.byId("fx_rates_type_1").get("checked")){if(isNaN(dj.byId("fx_exchange_rate").get("value"))||dj.byId("fx_exchange_rate_cur_code").get("value")===""||isNaN(dj.byId("fx_exchange_rate_amt").get("value"))||(_1e.fxParametersData.toleranceDispInd==="Y"&&(isNaN(dj.byId("fx_tolerance_rate").get("value"))||isNaN(dj.byId("fx_tolerance_rate_amt").get("value"))||dj.byId("fx_tolerance_rate_cur_code").get("value")===""))){_e(m.getLocalization("FXDefaultErrorMessage"));}}}else{if(d.byId(_7)&&(d.style(d.byId(_7),"display")!=="none")){m.animate("wipeOut",d.byId(_7));}m.defaultBindTheFXTypes();}}}}},bind:function(){m.setCurrency(dj.byId("fin_cur_code"),["fin_liab_amt"]);m.setCurrency(dj.byId("fin_cur_code"),["interest_amt"]);m.setCurrency(dj.byId("repayment_cur_code"),["repayment_amt"]);m.connect("sub_tnx_type_code","onChange",function(){var _1f=dj.byId("free_format_text");var _20=(dj.byId("updatedOutstandingAmt")&&dj.byId("updatedOutstandingAmt").get("value"))?dojo.number.parse(dj.byId("updatedOutstandingAmt").get("value")):0;var _21=dj.byId("fin_cur_code").get("value");if(this.get("value")=="24"){_8();m.toggleRequired("repayment_cur_code",false);m.toggleRequired("repayment_amt",false);m.toggleRequired("settlement_code",false);m.toggleRequired("fee_act_no",false);m.animate("fadeOut",_6,function(){});m.animate("fadeOut",_5,function(){});}else{if((this.get("value")=="38")&&(_20!=0)){_8();m.animate("fadeIn",_6,function(){});m.toggleRequired("repayment_cur_code",true);m.toggleRequired("repayment_amt",true);m.toggleRequired("settlement_code",true);m.toggleRequired("fee_act_no",true);if(dj.byId("repayment_amt")&&dj.byId("repayment_cur_code")){if(dj.byId("fin_cur_code")){dj.byId("repayment_cur_code").set("value",dj.byId("fin_cur_code").get("value"));}dj.byId("repayment_amt").set("readOnly",false);dj.byId("repayment_amt").set("value","");dj.byId("repayment_cur_code").set("readOnly",true);}if(dj.byId("repayment_mode_1")){dj.byId("repayment_mode_1").set("disabled",false);dj.byId("repayment_mode_1").set("checked",true);}if(dj.byId("repayment_mode_2")){dj.byId("repayment_mode_2").set("disabled",false);dj.byId("repayment_mode_2").set("checked",false);}if(dj.byId("settlement_code")){dj.byId("settlement_code").set("value","");}if(dj.byId("principal_act_name")){dj.byId("principal_act_name").set("value","");}if(dj.byId("principal_act_no")){dj.byId("principal_act_no").set("value","");}if(dj.byId("repayment_amt")){dj.byId("repayment_amt").set("value","");}if(dj.byId("principal_act_cur_code")){dj.byId("principal_act_cur_code").set("value","");}if(dj.byId("fee_act_no")){dj.byId("fee_act_no").set("value","");}if(dj.byId("fee_act_cur_code")){dj.byId("fee_act_cur_code").set("value","");}if(dj.byId("interest_amt")){dj.byId("interest_amt").set("readOnly",true);dj.byId("interest_amt").set("value","");}if(m._config.fxParamData&&m._config.fxParamData[dj.byId("sub_product_code").get("value")].fxParametersData.isFXEnabled==="Y"){m.animate("fadeIn",_5,function(){});_12();}if(dojo.byId("repayment_cur_code_row")){dojo.place("<p style='width: 260px;font-size: 12px;display: inline;position: absolute;'>(Current Outstanding Amount:"+_21+" "+_20+")</p>","repayment_cur_code_row","last");}}else{if((this.get("value")=="39")&&(_20!=0)){m.animate("fadeIn",_6,function(){});m.toggleRequired("repayment_cur_code",true);m.toggleRequired("repayment_amt",true);m.toggleRequired("settlement_code",true);m.toggleRequired("fee_act_no",true);if(dj.byId("repayment_amt")&&dj.byId("repayment_cur_code")){if(dj.byId("fin_liab_amt")){var _22=dj.byId("fin_liab_amt").get("value");if(_22!=_20){dj.byId("repayment_amt").set("value",_20);}else{dj.byId("repayment_amt").set("value",dj.byId("fin_liab_amt").get("value"));}m.setTnxAmt(dj.byId("repayment_amt").get("value"));}if(dj.byId("fin_cur_code")){dj.byId("repayment_cur_code").set("value",dj.byId("fin_cur_code").get("value"));}dj.byId("repayment_amt").set("readOnly",true);dj.byId("interest_amt").set("readOnly",true);dj.byId("repayment_cur_code").set("readOnly",true);}dj.byId("repayment_mode_1").set("checked",false);dj.byId("repayment_mode_1").set("disabled",true);dj.byId("repayment_mode_2").set("checked",false);dj.byId("repayment_mode_2").set("disabled",true);if(dj.byId("settlement_code")){dj.byId("settlement_code").set("value","");}if(dj.byId("principal_act_name")){dj.byId("principal_act_name").set("value","");}if(dj.byId("principal_act_cur_code")){dj.byId("principal_act_cur_code").set("value","");}if(dj.byId("fee_act_no")){dj.byId("fee_act_no").set("value","");}if(dj.byId("fee_act_cur_code")){dj.byId("fee_act_cur_code").set("value","");}if(dj.byId("principal_act_no")){dj.byId("principal_act_no").set("value","");}if(dj.byId("interest_amt")){dj.byId("interest_amt").set("value","");}if(dj.byId("interest_amt")){dj.byId("interest_amt").set("readOnly",false);}if(m._config.fxParamData&&m._config.fxParamData[dj.byId("sub_product_code").get("value")].fxParametersData.isFXEnabled==="Y"){m.animate("fadeIn",_5,function(){});_12();}}}}});m.connect("repayment_amt","onBlur",function(){m.setTnxAmt(this.get("value"));var _23=(dj.byId("updatedOutstandingAmt")&&dj.byId("updatedOutstandingAmt").get("value"))?dojo.number.parse(dj.byId("updatedOutstandingAmt").get("value")):0;var _24=dj.byId("repayment_cur_code")?dj.byId("repayment_cur_code").get("value"):"";if(dj.byId("sub_tnx_type_code")&&dj.byId("sub_tnx_type_code").get("value")=="38"&&dj.byId("repayment_amt")&&dj.byId("fin_liab_amt")){var _25=dj.byId("fin_liab_amt").get("value");var _26=dj.byId("interest_amt").get("value");var _27=dj.byId("repayment_amt").get("value");var _28=dj.byId("repayment_amt").domNode;if(dj.byId("repayment_mode_2").get("checked")){if((_26!==null&&_26!=="")&&(_27>=(_25+_26))){dj.byId("repayment_amt").set("value",null);_9("repaymentPrincipalInterestError");}else{if(_27>=_25){dj.byId("repayment_amt").set("value",null);_9("repaymentPrincipalInterestError");}}}else{if(dj.byId("repayment_mode_1").get("checked")){if(_27>=_25){dj.byId("repayment_amt").set("value",null);_9("repaymentPrincipalError");}else{if(_27>=_23){var _29=function(){var _2a=dijit.byId("repayment_amt");_2a.focus();_2a.set("state","Error");};m.dialog.show("ERROR",m.getLocalization("repaymentAmtLessThanOutstandingAmt",[_24,_27,_24,_23]),"",function(){setTimeout(_29,100);});}}}}}});m.connect("settlement_code","onChange",function(){if(dj.byId("settlement_code")){if(dj.byId("settlement_code").get("value")=="01"){m.toggleRequired("principal_act_name",true);}else{if(dj.byId("settlement_code").get("value")=="03"){m.toggleRequired("principal_act_name",false);}else{m.toggleRequired("principal_act_name",false);}}}});m.connect("repayment_mode_2","onClick",function(){if(dj.byId("repayment_mode_2").get("checked")===true){if(dj.byId("interest_amt")){dj.byId("interest_amt").set("readOnly",false);}}});m.connect("repayment_mode_1","onClick",function(){if(dj.byId("repayment_mode_1").get("checked")===true){if(dj.byId("interest_amt")){dj.byId("interest_amt").set("readOnly",true);dj.byId("interest_amt").set("value","");}}});m.connect("req_pct","onBlur",function(){if(this.get("value")!==null&&!isNaN(this.get("value"))){if(parseFloat(this.get("value"))<=100&&!(parseFloat(this.get("value"))<=0)){var _2b=(parseFloat(this.get("value"))*parseFloat(dj.byId("fin_amt").get("value")))/100;dj.byId("req_amt").set("value",_2b);}else{displayMessage=misys.getLocalization("incorrectPercentage");this.focus();this.set("state","Error");dj.hideTooltip(this.domNode);dj.showTooltip(displayMessage,this.domNode,0);}}else{if(dj.byId("fin_amt").get("value")!==null&&!isNaN(dj.byId("fin_amt").get("value"))){dj.byId("req_amt").set("value",dj.byId("fin_amt").get("value"));}}});},onFormLoad:function(){var _2c=dj.byId("free_format_text");if(_2c&&_2c.get("value")!==""){_2c.focus();}if(dj.byId("repayment_amt")){m.setTnxAmt(dj.byId("repayment_amt").get("value"));}var _2d=dj.byId("sub_product_code").get("value");if(d.byId(_7)){m.initializeFX(_2d);if((dj.byId("fx_exchange_rate_cur_code")&&dj.byId("fx_exchange_rate_cur_code").get("value")!=="")||(dj.byId("fx_total_utilise_cur_code")&&dj.byId("fx_total_utilise_cur_code").get("value")!=="")){m.animate("wipeIn",d.byId(_7));}else{d.style(_7,"display","none");}}var _2e=dj.byId("free_format_text");if(dj.byId("sub_tnx_type_code").value==="24"){_8();m.toggleRequired("repayment_cur_code",false);m.toggleRequired("repayment_amt",false);m.toggleRequired("settlement_code",false);m.toggleRequired("fee_act_no",false);m.animate("fadeOut",_6,function(){});m.animate("fadeOut",_5,function(){});if(_2e.get("value")===""||_2e.get("value")===_3||_2e.get("value")===_2){_2e.set("value",_4);}if(m._config.fxParamData&&m._config.fxParamData[_2d].fxParametersData.isFXEnabled==="Y"){m.defaultBindTheFXTypes();m.animate("fadeOut",_5,function(){});}}else{if(dj.byId("sub_tnx_type_code").value=="38"){m.animate("fadeIn",_6,function(){});m.toggleRequired("repayment_cur_code",true);m.toggleRequired("repayment_amt",true);m.toggleRequired("settlement_code",true);m.toggleRequired("fee_act_no",true);if(dj.byId("repayment_amt")&&dj.byId("repayment_cur_code")){if(dj.byId("fin_cur_code")){dj.byId("repayment_cur_code").set("value",dj.byId("fin_cur_code").get("value"));}dj.byId("repayment_amt").set("disabled",false);dj.byId("repayment_cur_code").set("disabled",true);}if(dj.byId("repayment_mode")&&dj.byId("repayment_mode").get("value")===""){dj.byId("repayment_mode_1").set("checked",true);dj.byId("repayment_mode_2").set("checked",false);}if(dj.byId("settlement_code")){if(dj.byId("settlement_code").get("value")=="01"){m.toggleRequired("principal_act_name",true);}else{if(dj.byId("settlement_code").get("value")=="03"){m.toggleRequired("principal_act_name",false);}else{m.toggleRequired("principal_act_name",false);}}}if(dj.byId("repayment_mode_1").get("checked")===true){if(dj.byId("interest_amt")){dj.byId("interest_amt").set("readOnly",true);dj.byId("interest_amt").set("value","");}}else{if(dj.byId("repayment_mode_2").get("checked")===true){if(dj.byId("interest_amt")){dj.byId("interest_amt").set("readOnly",false);}}}if(m._config.fxParamData&&m._config.fxParamData[_2d].fxParametersData.isFXEnabled==="Y"){m.animate("fadeIn",_5,function(){});m.onloadFXActions();}_2e.set("value",_2);}else{if(dj.byId("sub_tnx_type_code").value=="39"){m.animate("fadeIn",_6,function(){});m.toggleRequired("repayment_cur_code",true);m.toggleRequired("repayment_amt",true);m.toggleRequired("settlement_code",true);m.toggleRequired("fee_act_no",true);if(dj.byId("repayment_amt")&&dj.byId("repayment_cur_code")){if(dj.byId("fin_liab_amt")){dj.byId("repayment_amt").set("value",dj.byId("fin_liab_amt").get("value"));}if(dj.byId("fin_cur_code")){dj.byId("repayment_cur_code").set("value",dj.byId("fin_cur_code").get("value"));}dj.byId("repayment_amt").set("disabled",true);dj.byId("repayment_cur_code").set("disabled",true);}if(dj.byId("settlement_code")&&dj.byId("settlement_code").get("value")==="01"){m.toggleRequired("principal_act_name",true);}else{m.toggleRequired("principal_act_name",false);}dj.byId("repayment_mode_1").set("disabled",true);dj.byId("repayment_mode_2").set("disabled",true);dj.byId("repayment_amt").set("disabled",true);if(m._config.fxParamData&&m._config.fxParamData[_2d].fxParametersData.isFXEnabled==="Y"){m.animate("fadeIn",_5,function(){});m.onloadFXActions();}_2e.set("value",_2);}else{_8();m.animate("fadeOut",_6,function(){});if(m._config.fxParamData&&m._config.fxParamData[_2d].fxParametersData.isFXEnabled==="Y"){m.defaultBindTheFXTypes();m.animate("fadeOut",_5,function(){});}}}}},beforeSubmitValidations:function(){var _2f=dj.byId("sub_product_code").get("value");if(m._config.fxParamData&&m._config.fxParamData[_2f].fxParametersData.isFXEnabled==="Y"){if(!m.fxBeforeSubmitValidation()){return false;}var _30="";var _31=dj.byId("fx_rates_type_2");var _32=dj.byId("fx_total_utilise_amt");var _33=dj.byId("repayment_amt");if(_31.get("checked")&&_32&&!isNaN(_32.get("value"))&&_33&&!isNaN(_33.get("value"))){if(_33.get("value")<_32.get("value")){_30+=m.getLocalization("FXUtiliseAmtGreaterMessage");m._config.onSubmitErrorMsg=_30;return false;}}}if(dj.byId("sub_tnx_type_code")&&dj.byId("sub_tnx_type_code").get("value")==="38"&&dj.byId("repayment_amt")){if(!m.validateAmount(dj.byId("repayment_amt"))){m._config.onSubmitErrorMsg=m.getLocalization("amountcannotzero");dj.byId("repayment_amt").set("value","");return false;}}return true;}});})(dojo,dijit,misys);dojo.require("misys.client.binding.trade.message_tf_client");}