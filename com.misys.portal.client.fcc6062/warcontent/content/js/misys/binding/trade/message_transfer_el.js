/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.trade.message_transfer_el"]){dojo._hasResource["misys.binding.trade.message_transfer_el"]=true;dojo.provide("misys.binding.trade.message_transfer_el");dojo.require("dijit.layout.TabContainer");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.form.file");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("misys.widget.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.layout.ContentPane");dojo.require("misys.widget.Collaboration");dojo.require("misys.binding.trade.ls_common");(function(d,dj,m){var _1="deletegridrecord";m._config=m._config||{};m._config.expDate=m._config.expDate||{};m._config.lastShipDate=m._config.lastShipDate||{};d.mixin(m._config,{initReAuthParams:function(){var _2={productCode:"EL",subProductCode:"",transactionTypeCode:"13",entity:"",currency:"",amount:"",es_field1:"",es_field2:""};return _2;},xmlTransform:function(_3){var _4="<el_tnx_record>";if(_3.indexOf(_4)!=-1){var _5=m._config.xmlTagName,_6=_5?["<",_5,">"]:[],_7="</el_tnx_record>",_8="",_9=-1;_8=_3.substring(_4.length,(_3.length-_7.length));_6.push(_8);if(dj.byId("gridLicense")&&dj.byId("gridLicense").store&&dj.byId("gridLicense").store!==null&&dj.byId("gridLicense").store._arrayOfAllItems.length>0){_6.push("<linked_licenses>");dj.byId("gridLicense").store.fetch({query:{REFERENCEID:"*"},onComplete:dojo.hitch(dj.byId("gridLicense"),function(_a,_b){dojo.forEach(_a,function(_c){_6.push("<license>");_6.push("<ls_ref_id>",_c.REFERENCEID,"</ls_ref_id>");_6.push("<bo_ref_id>",_c.BO_REF_ID,"</bo_ref_id>");_6.push("<ls_number>",_c.LS_NUMBER,"</ls_number>");_6.push("<ls_allocated_amt>",_c.LS_ALLOCATED_AMT,"</ls_allocated_amt>");_6.push("<ls_amt>",_c.LS_AMT,"</ls_amt>");_6.push("<ls_os_amt>",_c.LS_OS_AMT,"</ls_os_amt>");_6.push("<converted_os_amt>",_c.CONVERTED_OS_AMT,"</converted_os_amt>");_6.push("<allow_overdraw>",_c.ALLOW_OVERDRAW,"</allow_overdraw>");_6.push("</license>");});})});_6.push("</linked_licenses>");}if(_5){_6.push("</",_5,">");}return _6.join("");}else{return _3;}}});function _d(){var _e=true;var _f,_10,_11,_12,_13="";if(dj.byId("narrative_description_goods")&&dj.byId("narrative_special_beneficiary")){if(dj.byId("narrative_description_goods")){_f=dj.byId("narrative_description_goods").get("value")!==""?dj.byId("narrative_description_goods").get("value")+"\n":"";}if(dj.byId("narrative_special_beneficiary")){_12=dj.byId("narrative_special_beneficiary").get("value")!==""?dj.byId("narrative_special_beneficiary").get("value")+"\n":"";}_13=_f+_12;var _14=800*this.cols;var _15=_13.length;this.invalidMessage=m.getLocalization("invalidFieldSizeError",[_14,_15]);return _e=m.validateExtNarrativeSwiftInit2018(_13);}};d.mixin(m,{bind:function(){m.setValidation("exp_date",m.validateMessageTransferTradeExpiryDate);m.setValidation("last_ship_date",m.validateMessageTransferLastShipmentDate);m.setValidation("free_format_text",m.validateFreeFormatMessage);if(m._config.swift2018Enabled&&misys._config.swiftExtendedNarrativeEnabled){m.setValidation("narrative_description_goods",_d);m.setValidation("narrative_special_beneficiary",_d);}m.connect("last_ship_date","onClick",function(){m.toggleDependentFields(this,dj.byId("narrative_shipment_period"),m.getLocalization("shipmentDateOrPeriodExclusivityError"));});m.connect("last_ship_date","onChange",function(){m.toggleDependentFields(this,dj.byId("narrative_shipment_period"),m.getLocalization("shipmentDateOrPeriodExclusivityError"));});m.connect("narrative_shipment_period","onClick",function(){m.toggleDependentFields(this,dj.byId("last_ship_date"),m.getLocalization("shipmentDateOrPeriodExclusivityError"));});m.connect("narrative_shipment_period","onChange",function(){m.toggleDependentFields(this,dj.byId("last_ship_date"),m.getLocalization("shipmentDateOrPeriodExclusivityError"));});m.connect("full_trf_flag","onClick",function(){var _16=dj.byId("tnx_amt");if(this.get("checked")){m.setTnxAmt(dj.byId("org_lc_amt").get("value"));_16.set("readOnly",true);}else{_16.reset();_16.set("readOnly",false);}});m.connect("advise_mode_code","onChange",function(){m.toggleFields(this.get("value")=="02",["advise_thru_bank_name","advise_thru_bank_address_line_1","advise_thru_bank_address_line_2","advise_thru_bank_dom"],["advise_thru_bank_name","advise_thru_bank_address_line_1"]);if(this.get("value")=="02"){m.animate("wipeIn",d.byId("advise_thru_bank_name_img"));}else{m.animate("wipeOut",d.byId("advise_thru_bank_name_img"));}});m.connect("license_lookup","onClick",function(){m.getLicenses("el");});m.connect("exp_date","onChange",function(){m.clearLicenseGrid(this,m._config.expDate,"el");});m.connect("last_ship_date","onChange",function(){m.clearLicenseGrid(this,m._config.lastShipDate,"el");});m.connect("tnx_amt","onBlur",function(){if(dj.byId("org_lc_amt")&&dj.byId("tnx_amt")&&dj.byId("full_trf_flag")){var _17=dj.byId("org_lc_amt").get("value");var _18=dj.byId("tnx_amt").get("value");if(_17===_18){dijit.byId("full_trf_flag").set("checked",true);}else{dijit.byId("full_trf_flag").set("checked",false);}}});m.connect("applicable_rules","onChange",function(){m.toggleFields((this.get("value")=="99"),null,["applicable_rules_text"]);});m.connect("tnx_amt","onChange",function(){var _19=dj.byId("tnx_amt")?dj.byId("tnx_amt").get("value"):"";var _1a=dj.byId("utilized_amt")?dj.byId("utilized_amt").get("value"):"";var _1b=dj.byId("utilized_amt_cur_code")?dj.byId("utilized_amt_cur_code").get("value"):"";var _1c=dj.byId("org_lc_amt").get("value");var _1d=0;if(_19!==""){_1d=(_1c-_1a);if(_19>_1d){_1d=_1d<0?dojo.currency.format(0):dojo.currency.format(_1d);var _1e=m.getLocalization("transferAmtGreaterThanAvailableLCAmtWarning",[_1b,_1d]);dj.byId("tnx_amt").set("state","Error");dj.showTooltip(_1e,dj.byId("tnx_amt").domNode,0);}}});m.connect("inco_term","onChange",function(){m.toggleFields(this.get("value"),null,["inco_place"],false,false);});m.connect("inco_term_year","onChange",m.getIncoTerm);m.connect("inco_term","onClick",function(){if(dj.byId("issuing_bank_abbv_name").get("value")==""&&(this.store._arrayOfAllItems==undefined||this.store._arrayOfAllItems.length==0)){m.dialog.show("ERROR",m.getLocalization("selectBankToProceed"),"","");}else{if(dj.byId("inco_term_year").get("value")==""&&(this.store._arrayOfAllItems==undefined||this.store._arrayOfAllItems.length==0)){m.dialog.show("ERROR",m.getLocalization("selectIncoYearToProceed"),"","");}}});m.connect("inco_term_year","onChange",function(){m.toggleFields(this.get("value"),null,["inco_term"],false,true);});},onFormLoad:function(){m._config.expDate=dj.byId("exp_date")?dj.byId("exp_date").get("displayedValue"):"";m._config.lastShipDate=dj.byId("last_ship_date")?dj.byId("last_ship_date").get("displayedValue"):"";var _1f=dj.byId("advising_bank_abbv_name").get("value");var _20=m._config.customerBanksMT798Channel[_1f]===true&&dj.byId("adv_send_mode").get("value")==="01";m.setCurrency(dj.byId("lc_cur_code"),["org_lc_amt","tnx_amt"]);if(dj.byId("advise_mode_code")){m.toggleFields(dj.byId("advise_mode_code").get("value")=="02",["advise_thru_bank_name","advise_thru_bank_address_line_1","advise_thru_bank_address_line_2","advise_thru_bank_dom"],["advise_thru_bank_name","advise_thru_bank_address_line_1"]);if(dj.byId("advise_mode_code").get("value")=="02"){m.animate("wipeIn",d.byId("advise_thru_bank_name_img"));}else{m.animate("wipeOut",d.byId("advise_thru_bank_name_img"));}}if(dj.byId("sec_beneficiary_country")){dj.byId("sec_beneficiary_country").set("required",false);}m.animate("wipeOut",d.byId("sec_beneficiary_country_row"));if(_20){if(dj.byId("delivery_channel").get("value")===""){m.animate("fadeIn",d.byId("bankInst"));dj.byId("delivery_channel").set("disabled",true);}else{m.animate("fadeIn",d.byId("bankInst"));}if(dj.byId("delivery_channel")){m.connect("delivery_channel","onChange",function(){if(dj.byId("attachment-file")){if(dj.byId("delivery_channel").get("value")==="FACT"){dj.byId("attachment-file").displayFileAct(true);}else{dj.byId("attachment-file").displayFileAct(false);}}});dj.byId("delivery_channel").onChange();}m.toggleFields(m._config.customerBanksMT798Channel[_1f]===true&&m.hasAttachments(),null,["delivery_channel"],false,false);}else{m.animate("fadeOut",d.byId("bankInst"));}var _21=dojo.subscribe(_1,function(){m.toggleFields(m._config.customerBanksMT798Channel[_1f]===true&&m.hasAttachments(),null,["delivery_channel"],false,false);});m.populateGridOnLoad("lc");if(dj.byId("full_trf_flag")){var _22=dj.byId("tnx_amt");if(dj.byId("full_trf_flag").get("checked")){m.setTnxAmt(dj.byId("org_lc_amt").get("value"));_22.set("readOnly",true);}else{_22.set("readOnly",false);}}var _23=dj.byId("applicable_rules");if(_23){m.toggleFields(_23.get("value")=="99",null,["applicable_rules_text"]);}if(dj.byId("inco_term_year")){m.getIncoYear();dijit.byId("inco_term_year").set("value",dj.byId("org_term_year").get("value"));}if(dj.byId("inco_term")){if(dj.byId("inco_term_year")&&dj.byId("inco_term_year").get("value")!=""){m.getIncoTerm();}dijit.byId("inco_term").set("value",dj.byId("org_inco_term").get("value"));}var _24=dj.byId("inco_term")?dj.byId("inco_term").get("value"):"";if(_24){m.toggleFields(_24,null,["inco_place"],false,true);}else{m.toggleFields(_24,null,["inco_place"],false,false);}},beforeSaveValidations:function(){var _25=dj.byId("tnx_amt")?dj.byId("tnx_amt").get("value"):"";if(isNaN(_25)||(_25===0)){m._config.onSubmitErrorMsg=m.getLocalization("transferAmountEmptyZero");dj.byId("tnx_amt").set("value","");return false;}if(_25!==""){var _26=dj.byId("org_lc_amt").get("value");if(_26<_25){dj.byId("tnx_amt").reset();m._config.onSubmitErrorMsg=m.getLocalization("transferAmtGreaterThanLCAmtError");return false;}}var _27=dj.byId("utilized_amt")?dj.byId("utilized_amt").get("value"):"";var _28=dj.byId("utilized_amt_cur_code")?dj.byId("utilized_amt_cur_code").get("value"):"";var _29=dj.byId("org_lc_amt")?dj.byId("org_lc_amt").get("value"):"";var _2a=0;if(_25!==""){_2a=(_29-_27);if(_25>_2a){_2a=_2a<0?dojo.currency.format(0):dojo.currency.format(_2a);m._config.onSubmitErrorMsg=m.getLocalization("transferAmtGreaterThanAvailableLCAmtWarning",[_28,_2a]);dj.byId("tnx_amt").focus();return false;}}if(m._config.swift2018Enabled){if(dj.byId("narrative_period_presentation_nosend")&&dj.byId("narrative_period_presentation_nosend").get("value")!==""){var _2b=dj.byId("narrative_period_presentation_nosend").get("value");if(_2b.indexOf("\n")!=-1){m._config.onSubmitErrorMsg=m.getLocalization("periodOfPresentaionError");return false;}}}return true;},beforeSubmitValidations:function(){var _2c=dj.byId("tnx_amt")?dj.byId("tnx_amt").get("value"):"";if(isNaN(_2c)||(_2c===0)){m._config.onSubmitErrorMsg=m.getLocalization("transferAmountEmptyZero");dj.byId("tnx_amt").set("value","");return false;}if(_2c!==""){var _2d=dj.byId("org_lc_amt").get("value");if(_2d<_2c){dj.byId("tnx_amt").reset();m._config.onSubmitErrorMsg=m.getLocalization("transferAmtGreaterThanLCAmtError");return false;}}var _2e=dj.byId("utilized_amt")?dj.byId("utilized_amt").get("value"):"";var _2f=dj.byId("utilized_amt_cur_code")?dj.byId("utilized_amt_cur_code").get("value"):"";var _30=dj.byId("org_lc_amt")?dj.byId("org_lc_amt").get("value"):"";var _31=0;if(_2c!==""){_31=(_30-_2e);if(_2c>_31){_31=_31<0?dojo.currency.format(0):dojo.currency.format(_31);m._config.onSubmitErrorMsg=m.getLocalization("transferAmtGreaterThanAvailableLCAmtWarning",[_2f,_31]);dj.byId("tnx_amt").focus();return false;}}if(m._config.swift2018Enabled){if(dj.byId("narrative_period_presentation_nosend")&&dj.byId("narrative_period_presentation_nosend").get("value")!==""){var _32=dj.byId("narrative_period_presentation_nosend").get("value");if(_32.indexOf("\n")!=-1){m._config.onSubmitErrorMsg=m.getLocalization("periodOfPresentaionError");return false;}}}return m.validateLSAmtSumAgainstTnxAmt("tnx");}});})(dojo,dijit,misys);dojo.require("misys.client.binding.trade.message_transfer_el_client");}