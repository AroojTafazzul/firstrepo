/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.trade.amend_ls"]){dojo._hasResource["misys.binding.trade.amend_ls"]=true;dojo.provide("misys.binding.trade.amend_ls");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("misys.form.file");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("misys.binding.trade.ls_common");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("misys.widget.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.layout.ContentPane");dojo.require("misys.widget.Collaboration");(function(d,dj,m){var _1="deletegridrecord";d.mixin(m._config,{initReAuthParams:function(){var _2={productCode:"LS",subProductCode:"",transactionTypeCode:"03",entity:dj.byId("entity")?dj.byId("entity").get("value"):"",currency:dj.byId("ls_cur_code")?dj.byId("ls_cur_code").get("value"):"",amount:dj.byId("ls_amt")?m.trimAmount(dj.byId("ls_amt").get("value")):"",es_field1:dj.byId("ls_amt")?m.trimAmount(dj.byId("ls_amt").get("value")):"",es_field2:""};return _2;}});d.mixin(m,{bind:function(){m.setValidation("amd_date",m.validateAmendmentDate);m.connect("inc_amt","onBlur",function(){m.validateIncAmount(this,"ls");});m.connect("dec_amt","onBlur",function(){m.validateDecAmount(this,"ls");});m.connect("additional_inc_amt","onBlur",function(){m.validateIncAmount(this,"additional");});m.connect("additional_dec_amt","onBlur",function(){m.validateDecAmount(this,"additional");});m.setValidation("origin_country",m.validateCountry);m.setValidation("supply_country",m.validateCountry);m.setValidation("pstv_tol_pct",m.validateTolerance);m.setValidation("neg_tol_pct",m.validateTolerance);m.connect("inc_amt","onBlur",m.amendLicenseTransaction);m.connect("dec_amt","onBlur",m.amendLicenseTransaction);m.connect("additional_inc_amt","onBlur",m.amendLicenseTransaction);m.connect("additional_dec_amt","onBlur",m.amendLicenseTransaction);m.connect("additional_inc_amt","onBlur",m.handleAdditionalAmountDetails);m.connect("additional_dec_amt","onBlur",m.handleAdditionalAmountDetails);m.connect("inco_term","onChange",function(){m.toggleFields(this.get("value"),null,["inco_place"],false,false);});m.connect("inco_term_year","onChange",function(){m.toggleFields(this.get("value"),null,["inco_term"],false,true);});m.connect("inco_term_year","onChange",m.getIncoTerm);m.setValidation("valid_from_date",m.validateValidFromDate);m.setValidation("valid_to_date",m.validateValidToDate);m.setValidation("latest_payment_date",m.validateLatestPaymentDate);m.connect("valid_from_date","onChange",m.setValidToDate);m.connect("valid_for_nb","onBlur",m.setValidToDate);m.connect("valid_for_nb","onBlur",function(){if(dj.byId("valid_for_period")&&(this.get("value")!==""&&!isNaN(this.get("value")))){dj.byId("valid_for_period").set("disabled",false);dj.byId("valid_for_period").set("required",true);}else{dj.byId("valid_for_period").set("disabled",true);dj.byId("valid_for_period").set("required",false);dj.byId("valid_for_period").set("value","");}});m.connect("valid_for_period","onChange",m.setValidToDate);},onFormLoad:function(){m.setCurrency(dj.byId("ls_cur_code"),["inc_amt","dec_amt","org_ls_amt","ls_amt","additional_inc_amt","additional_dec_amt","additional_amt","org_additional_amt","org_total_amt","total_amt"]);var _3=dj.byId("inco_term")?dj.byId("inco_term").get("value"):"";if(_3){m.toggleFields(_3,null,["inco_place"],false,true);}else{m.toggleFields(_3,null,["inco_place"],false,false);}if(d.byId("org_narrative_additional_amount_img")){d.byId("org_narrative_additional_amount_img").style.display="none";dj.byId("org_narrative_additional_amount_img").set("disabled",true);}m.handleAdditionalAmountDetails();var _4=dj.byId("additional_inc_amt")&&isNaN(dj.byId("additional_inc_amt").get("value"));var _5=dj.byId("additional_dec_amt")&&isNaN(dj.byId("additional_dec_amt").get("value"));if(dj.byId("additional_amt")&&dj.byId("org_additional_amt")&&_4&&_5){dj.byId("additional_amt").set("value",dj.byId("org_additional_amt").get("value"));}if(dj.byId("org_ls_amt")&&dj.byId("org_ls_amt").get("value")!==""&&!isNaN(dj.byId("org_ls_amt").get("value"))){dj.byId("org_total_amt").set("value",dj.byId("org_ls_amt").get("value"));}if(dj.byId("ls_amt")&&dj.byId("ls_amt").get("value")!==""&&!isNaN(dj.byId("ls_amt").get("value"))){dj.byId("total_amt").set("value",dj.byId("ls_amt").get("value"));}if(dj.byId("valid_for_nb")&&dj.byId("valid_for_period")&&dj.byId("valid_for_nb").get("value")!==""&&!isNaN(dj.byId("valid_for_nb").get("value"))){dj.byId("valid_for_period").set("disabled",false);dj.byId("valid_for_period").set("required",true);if(dj.byId("valid_for_period").get("value")!==""&&dj.byId("valid_to_date")){dj.byId("valid_to_date").set("disabled",true);}}else{dj.byId("valid_for_period").set("disabled",true);dj.byId("valid_for_period").set("required",false);}if(dj.byId("inc_amt")&&!isNaN(dj.byId("inc_amt").get("value"))){dj.byId("dec_amt").set("disabled",true);}else{if(dj.byId("dec_amt")&&!isNaN(dj.byId("dec_amt").get("value"))){dj.byId("inc_amt").set("disabled",true);}}if(dj.byId("additional_inc_amt")&&!isNaN(dj.byId("additional_inc_amt").get("value"))){dj.byId("additional_dec_amt").set("disabled",true);}else{if(dj.byId("additional_dec_amt")&&!isNaN(dj.byId("additional_dec_amt").get("value"))){dj.byId("additional_inc_amt").set("disabled",true);}}if(dj.byId("inco_term_year")){m.getIncoYear();dijit.byId("inco_term_year").set("value",dj.byId("org_term_year").get("value"));}if(dj.byId("inco_term")){if(dj.byId("inco_term_year")&&dj.byId("inco_term_year").get("value")!=""){m.getIncoTerm();}dijit.byId("inco_term").set("value",dj.byId("org_inco_term").get("value"));}},beforeSaveValidations:function(){var _6=dj.byId("inc_amt"),_7=dj.byId("dec_amt"),_8=dj.byId("additional_inc_amt"),_9=dj.byId("additional_dec_amt");if(_6&&_7&&_8&&_9){var _a=isNaN(_6.get("value"))?-(d.number.parse(_7.get("value"))):d.number.parse(_6.get("value")),_b=isNaN(_8.get("value"))?-(d.number.parse(_9.get("value"))):d.number.parse(_8.get("value"));_a=!isNaN(_a)?_a:0;_b=!isNaN(_b)?_b:0;var _c=_a+_b;_c=_c>=0?_c:-_c;m.setTnxAmt(_c);}return true;},beforeSubmitValidations:function(){var _d=dj.byId("inc_amt"),_e=dj.byId("dec_amt"),_f=dj.byId("additional_inc_amt"),_10=dj.byId("additional_dec_amt");if(_d&&_e&&_f&&_10){var _11=isNaN(_d.get("value"))?-(d.number.parse(_e.get("value"))):d.number.parse(_d.get("value")),_12=isNaN(_f.get("value"))?-(d.number.parse(_10.get("value"))):d.number.parse(_f.get("value"));_11=!isNaN(_11)?_11:0;_12=!isNaN(_12)?_12:0;var _13=_11+_12;_13=_13>=0?_13:-_13;m.setTnxAmt(_13);}var _14=["narrative_additional_amount","org_narrative_additional_amount","origin_country","org_origin_country","supply_country","org_supply_country","inco_term","org_inco_term","inco_place","org_inco_place","org_valid_from_date","org_valid_for_nb","valid_from_date","valid_for_nb","valid_for_period","org_valid_for_period","valid_to_date","org_valid_to_date","latest_payment_date","org_latest_payment_date","additional_dec_amt","additional_inc_amt","inc_amt","dec_amt","amd_details","file"];var _15=d.every(_14,function(id){if(d.byId(id)){return true;}return false;});if(_15){var _16=m.trim(dj.byId("narrative_additional_amount").get("value"));var _17=m.trim(dj.byId("org_narrative_additional_amount").get("value"));var _18=["origin_country","supply_country","inco_term","inco_place","valid_for_nb","valid_for_period"];var _19=d.every(_18,function(id){var _1a=dj.byId(id).get("value")+"";var _1b=dj.byId("org_"+id).get("value")+"";if(_1a==="NaN"||_1a==="null"||_1a==="undefined"){_1a="";}if(_1a===_1b){return true;}return false;});var _1c=["valid_from_date","valid_to_date","latest_payment_date"];var _1d=d.every(_1c,function(id){var _1e=dj.byId(id).get("value")+"";var _1f=d.date.locale.parse(dj.byId("org_"+id).get("displayedValue"),{selector:"date",datePattern:m.getLocalization("g_strGlobalDateFormat")})+"";if(_1e==="null"||_1e===_1f){return true;}return false;});var _20=(d.query("#edit [id^='file_row_']").length>1);if(_19&&_1d&&!_20&&(_16===_17)&&!dj.byId("inc_amt").get("value")&&!dj.byId("dec_amt").get("value")&&!dj.byId("additional_inc_amt").get("value")&&!dj.byId("additional_dec_amt").get("value")&&(dj.byId("amd_details").get("value")==="")){m._config.onSubmitErrorMsg=m.getLocalization("noAmendmentError");return false;}}if(dj.byId("ls_liab_amt")&&dj.byId("sub_tnx_type_code")&&dj.byId("tnx_amt")){var _21=d.number.parse(dj.byId("ls_liab_amt").get("value")),_22=d.number.parse(dj.byId("tnx_amt").get("value"));_21=!isNaN(_21)?_21:0;_22=!isNaN(_22)?_22:0;if(dj.byId("sub_tnx_type_code").get("value")==="02"&&_22>_21){m._config.onSubmitErrorMsg=m.getLocalization("cannotDecreaseMoreThanLiabilityAmount",[dj.byId("ls_liab_amt").get("value")]);return false;}}return true;},beforeSubmit:function(){var _23=dj.byId("total_amt"),_24=dj.byId("org_total_amt"),_25=dj.byId("sub_tnx_type_code"),_26="03";if(_23&&_24){var _27=d.number.parse(_23.get("value")),_28=d.number.parse(_24.get("value"));_27=!isNaN(_27)?_27:0;_28=!isNaN(_28)?_28:0;if(_27>_28){_26="01";}else{if(_27<_28){_26="02";}}}if(_25){_25.set("value",_26);}}});})(dojo,dijit,misys);dojo.require("misys.client.binding.trade.amend_ls_client");}