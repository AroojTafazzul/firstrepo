/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.trade.correspondence_se"]){dojo._hasResource["misys.binding.trade.correspondence_se"]=true;dojo.provide("misys.binding.trade.correspondence_se");dojo.require("dijit.layout.TabContainer");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("misys.widget.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("misys.form.file");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.widget.Collaboration");dojo.require("misys.form.common");dojo.require("misys.validation.common");(function(d,dj,m){d.mixin(m._config,{initReAuthParams:function(){var _1={productCode:"SE",subProductCode:"",transactionTypeCode:"01",entity:dj.byId("entity")?dj.byId("entity").get("value"):"",currency:"",amount:"",es_field1:"",es_field2:""};return _1;}});function _2(){var _3=dj.byId("attIds");var _4=false;var _5=0;if(_3){var _6=[dj.byId("attachment-file"),dj.byId("attachment-fileOTHER")];d.forEach(_6,function(_7){if(_7&&_7.grid){var _8=_7.grid.store._arrayOfAllItems;d.forEach(_8,function(_9,i){if(_9!==null){_4=true;_5++;}});}});}if(_4==false){m._config.onSubmitErrorMsg=m.getLocalization("mandatoryMinimumFileUploadTypeError");}if(_5>5){m._config.onSubmitErrorMsg=m.getLocalization("mandatoryMaximumFileUploadTypeError");_4=false;}return _4;};function _a(){var _b=dj.byId("entity")?dj.byId("entity").get("value"):"";if(dj.byId("upload_file_type")!=null){dj.byId("upload_file_type").set("value","");}m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/GetFileTypesForEntities"),handleAs:"json",content:{entity:_b},load:_c,customError:function(_d,_e){console.error("[misys.binding.trade.correspondence_se] Technical error while getting File types for Entity",_d);}});};function _c(_f,_10){var _11=dj.byId("upload_file_type");var _12=1;misys._config.reportTypeArray=[];_11.store=new d.data.ItemFileReadStore({data:_f});dj.byId("upload_file_type").set("value",dj.byId("selected_upload_file_type").get("displayedValue"));dj.byId("margin_act_name").set("value",dj.byId("selected_margin_act_name").get("displayedValue"));dj.byId("margin_act_no").set("value",dj.byId("selected_margin_act_no").get("displayedValue"));misys._config.reportTypeArray["report"]=[];_11.store.fetch({query:{ID:"*"},onComplete:function(_13,_14){dojo.forEach(_13,function(_15){var _16=_15["flag"];misys._config.reportTypeArray["report"][_12]=new Array();misys._config.reportTypeArray["report"][_12].description=_15["name"];misys._config.reportTypeArray["report"][_12].flag=_15["flag"];misys._config.reportTypeArray["report"][_12].fileSystemName=_15["fileSystemName"];misys._config.reportTypeArray["report"][_12].fileTypeName=_15["fileTypeName"];_12++;},this);}});misys.hasAccount();};d.mixin(m,{hasAccount:function(){var _17=d.byId("account-flag");var _18=dj.byId("upload_file_type").get("value");for(var i in misys._config.reportTypeArray){for(var j=1;j<misys._config.reportTypeArray[i].length;j++){if(misys._config.reportTypeArray[i][j]&&misys._config.reportTypeArray[i][j].description==_18){if(misys._config.reportTypeArray[i][j].flag=="Y"){dj.byId("margin_act_name").set("disabled",false);m.toggleRequired("margin_act_name",true);}else{dj.byId("margin_act_name").set("value","");dj.byId("margin_act_name").set("disabled",true);m.toggleRequired("margin_act_name",false);}dj.byId("file_type_name").set("value",misys._config.reportTypeArray[i][j].fileTypeName);dj.byId("file_system_name").set("value",misys._config.reportTypeArray[i][j].fileSystemName);}}}},bind:function(){if(dj.byId("bank_abbv_name")){dj.byId("bank_abbv_name").set("value","");}var _19="";m.connect("issuing_bank_abbv_name","onChange",m.populateReferences);m.connect("issuing_bank_abbv_name","onChange",function(){var _1a=dj.byId("issuing_bank_abbv_name").get("value");if(dj.byId("bank_abbv_name")){dj.byId("bank_abbv_name").set("value",_1a);}if(_1a&&_1a!==_19){dj.byId("margin_act_name").set("value","");}if(misys&&misys._config&&misys._config.businessDateForBank&&misys._config.businessDateForBank[_1a]&&misys._config.businessDateForBank[_1a][0]&&misys._config.businessDateForBank[_1a][0].value!==""){var _1b=misys._config.businessDateForBank[_1a][0].value;var _1c=_1b.substring(0,4);var _1d=_1b.substring(5,7);var _1e=_1b.substring(8,10);_1b=_1e+"/"+_1d+"/"+_1c;if(misys&&misys._config&&misys._config.option_for_app_date==="SCRATCH"){dj.byId("appl_date").set("value",_1b);document.getElementById("appl_date_view_row").childNodes[1].innerHTML=_1b;}}});m.connect("margin_act_name","onChange",function(){if(misys._config.nickname==="true"&&misys._config.option_for_app_date!=="PENDING"){if(dj.byId("margin_act_nickname")&&dj.byId("margin_act_nickname").get("value")!==""){d.byId("nickname").innerHTML=dj.byId("margin_act_nickname").get("value");d.style("nickname","display","inline");}else{d.style("nickname","display","none");}}});if(dj.byId("entity")){m.connect("entity","onChange",function(){_a();if(dj.byId("issuing_bank_abbv_name")){dj.byId("issuing_bank_abbv_name").onChange();}});}else{_a();}m.connect("upload_file_type","onChange",m.hasAccount);m.connect("issuing_bank_customer_reference","onChange",function(){if(dj.byId("applicant_reference")){var _1f=this.get("value");dj.byId("applicant_reference").set("value",_1f);}});m.connect("margin_act_name","onChange",function(){if(dj.byId("issuing_bank_abbv_name")){_19=misys._config.customerBankName;}});},onFormLoad:function(){_a();var _20=dj.byId("issuing_bank_customer_reference_temp");var _21;if(_20){_21=_20.value;}var _22=dj.byId("issuing_bank_abbv_name");if(_22){_22.onChange();}_20=dj.byId("issuing_bank_customer_reference");if(_20){_20.onChange();_20.set("value",_21);}},beforeSaveValidations:function(){var _23=dj.byId("entity");if(_23&&_23.get("value")==""){return false;}else{return true;}},beforeSubmitValidations:function(){return _2();}});})(dojo,dijit,misys);dojo.require("misys.client.binding.trade.correspondence_se_client");}