/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.trade.create_li"]){dojo._hasResource["misys.binding.trade.create_li"]=true;dojo.provide("misys.binding.trade.create_li");dojo.require("dojo.parser");dojo.require("dijit.layout.TabContainer");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("misys.widget.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("misys.form.file");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("misys.widget.Collaboration");(function(d,dj,m){function _1(){dj.byId("principal_act_no").set("value","");dj.byId("fee_act_no").set("value","");};d.mixin(m._config,{initReAuthParams:function(){var _2={productCode:"LI",subProductCode:"",transactionTypeCode:"01",entity:dj.byId("entity")?dj.byId("entity").get("value"):"",bankAbbvName:dj.byId("issuing_bank_abbv_name")?dj.byId("issuing_bank_abbv_name").get("value"):"",currency:dj.byId("li_cur_code")?dj.byId("li_cur_code").get("value"):"",amount:dj.byId("li_amt")?m.trimAmount(dj.byId("li_amt").get("value")):"",es_field1:"",es_field2:""};return _2;}});d.mixin(m,{bind:function(){m.setValidation("li_cur_code",m.validateCurrency);m.setValidation("exp_date",m.validateFutureDate);m.setValidation("bol_date",m.validateTransportDocumentDate);m.connect("li_amt","onBlur",function(){m.setTnxAmt(this.get("value"));if(dj.byId("org_li_amt")){m.checkIndemnityAmount();}});m.connect("li_cur_code","onChange",function(){m.setCurrency(this,["li_amt"]);});m.connect("bene_type_code","onChange",function(){var _3=this.get("value");if(_3!=="99"){d.style("bene_type_other_row","display","none");m.toggleRequired("bene_type_other",false);}else{d.style("bene_type_other_row","display","block");m.toggleRequired("bene_type_other",true);}});m.connect("issuing_bank_abbv_name","onChange",m.populateReferences);m.connect("issuing_bank_abbv_name","onChange",m.updateBusinessDate);if(dj.byId("issuing_bank_abbv_name")){m.connect("entity","onChange",function(){dj.byId("issuing_bank_abbv_name").onChange();});}m.connect("issuing_bank_customer_reference","onChange",m.setApplicantReference);m.connect("trans_doc_type_code","onChange",function(){if(dj.byId("trans_doc_type_code").get("value")!=="99"){d.style("trans_doc_type_other_row","display","none");m.toggleRequired("trans_doc_type_other",false);}else{d.style("trans_doc_type_other_row","display","block");m.toggleRequired("trans_doc_type_other",true);}});m.connect("entity_img_label","onClick",_1);},onFormLoad:function(){if(m._config.swift2018Enabled){var _4=dj.byId("CREATE_OPTION").get("value");if(_4==="EXISTING_LC"||_4==="EXISTING_EL"){m.dialog.show("CONFIRMATION",m.getLocalization("warningMsgCreateLI"),"","","","","",function(){var _5="/screen/LetterOfIndemnityScreen?option="+_4+"&tnxtype=01";window.location.href=misys.getServletURL(_5);return;});}}m.setCurrency(dj.byId("li_cur_code"),["li_amt"]);var _6=dj.byId("bene_type_code");if(_6&&_6.get("value")!=="99"){d.style("bene_type_other_row","display","none");m.toggleRequired("bene_type_other",false);}else{m.toggleRequired("bene_type_other",true);}var _7=dj.byId("trans_doc_type_code");if(_7&&_7.get("value")!=="99"){d.style("trans_doc_type_other_row","display","none");m.toggleRequired("trans_doc_type_other",false);}else{m.toggleRequired("trans_doc_type_other",true);}var _8=dj.byId("issuing_bank_abbv_name");if(_8){_8.onChange();}var _9=dj.byId("issuing_bank_customer_reference");if(_9){_9.onChange();}},beforeSaveValidations:function(){var _a=dj.byId("entity");if(_a&&_a.get("value")===""){return false;}else{return true;}},beforeSubmitValidations:function(){if(dj.byId("li_amt")){if(!m.validateAmount((dj.byId("li_amt"))?dj.byId("li_amt"):0)){m._config.onSubmitErrorMsg=m.getLocalization("amountcannotzero");dj.byId("li_amt").set("value","");return false;}}if(dj.byId("issuing_bank_abbv_name")&&!m.validateApplDate(dj.byId("issuing_bank_abbv_name").get("value"))){m._config.onSubmitErrorMsg=m.getLocalization("changeInApplicationDates");m.goToTop();return false;}return true;},checkIndemnityAmount:function(){var _b=dj.byId("li_amt"),_c=dj.byId("org_li_amt");if(_b&&_c){if(_b.get("value")>_c.get("value")){var _d=m.getLocalization("AmtGreaterThanOrgOutstandingAmtError",[_c.get("value")]);_b.set("state","Error");dj.hideTooltip(_b.domNode);m.showTooltip(_d,_b.domNode,0);}}}});})(dojo,dijit,misys);dojo.require("misys.client.binding.trade.create_li_client");}