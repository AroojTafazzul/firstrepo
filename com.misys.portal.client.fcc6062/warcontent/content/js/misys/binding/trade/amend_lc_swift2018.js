/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.trade.amend_lc_swift2018"]){dojo._hasResource["misys.binding.trade.amend_lc_swift2018"]=true;dojo.provide("misys.binding.trade.amend_lc_swift2018");dojo.require("dijit.layout.TabContainer");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("misys.widget.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.widget.Collaboration");dojo.require("misys.form.common");dojo.require("misys.form.file");dojo.require("misys.validation.common");dojo.require("misys.binding.SessionTimer");dojo.require("misys.binding.trade.ls_common");dojo.require("misys.widget.Amendments");(function(d,dj,m){var _1="deletegridrecord";var _2=true;m._config=m._config||{};m._config.lcCurCode=m._config.lcCurCode||{};m._config.applicant=m._config.applicant||{entity:"",name:"",addressLine1:"",addressLine2:"",dom:""};m._config.beneficiary=m._config.beneficiary||{name:"",addressLine1:"",addressLine2:"",dom:""};m._config.expDate=m._config.expDate||{};m._config.lastShipDate=m._config.lastShipDate||{};function _3(){dj.byId("principal_act_no").set("value","");dj.byId("fee_act_no").set("value","");};function _4(){if(d.number.parse(dijit.byId("org_lc_amt").get("displayedValue"))<d.number.parse(dijit.byId("dec_amt").get("displayedValue"))){m.showTooltip(m.getLocalization("decreaseAmountShouldBeLessThanLCAmount",[dj.byId("dec_amt").get("displayedValue")]),d.byId("dec_amt"),["after"],5000);misys.dialog.show("ERROR",dj.byId("dec_amt").invalidMessage,"",function(){dj.byId("dec_amt").focus();dj.byId("dec_amt").set("state","Error");});return false;}if(d.number.parse(dijit.byId("dec_amt").get("displayedValue"))<0){dj.byId("lc_amt").set("value",d.number.parse(dj.byId("org_lc_amt").get("displayedValue")));m.showTooltip(m.getLocalization("valueShouldBeGreaterThanZero",[dj.byId("dec_amt").get("displayedValue")]),d.byId("dec_amt"),["after"],5000);misys.dialog.show("ERROR",dj.byId("dec_amt").invalidMessage,"",function(){dj.byId("dec_amt").focus();dj.byId("dec_amt").set("state","Error");});return false;}return true;};d.mixin(m._config,{initReAuthParams:function(){var _5={productCode:"LC",subProductCode:"",transactionTypeCode:"03",subTransactionTypeCode:dj.byId("sub_tnx_type_code")?dj.byId("sub_tnx_type_code").get("value"):"",entity:dj.byId("entity")?dj.byId("entity").get("value"):"",currency:dj.byId("lc_cur_code")?dj.byId("lc_cur_code").get("value"):"",amount:dj.byId("lc_amt")?m.trimAmount(dj.byId("lc_amt").get("value")):"",tnxAmt:dj.byId("tnx_amt")?m.trimAmount(dj.byId("tnx_amt").get("value")):"",es_field1:dj.byId("lc_amt")?m.trimAmount(dj.byId("lc_amt").get("value")):"",es_field2:""};return _5;},xmlTransform:function(_6){var _7="<lc_tnx_record>";if(_6.indexOf(_7)!=-1){var _8=m._config.xmlTagName,_9=_8?["<",_8,">"]:[],_a="</lc_tnx_record>",_b="",_c=-1;_b=_6.substring(_7.length,(_6.length-_a.length));if(m._config.swift2018Enabled){var _d;var _e=["narrative_description_goods","narrative_documents_required","narrative_additional_instructions","narrative_special_beneficiary"];var _f=[m._config.narrativeDescGoodsDataStore,m._config.narrativeDocsReqDataStore,m._config.narrativeAddInstrDataStore,m._config.narrativeSpBeneDataStore];for(var itr=0;itr<4;itr++){_d=itr==0?_b.substring(0,_b.indexOf("<"+_e[itr]+">")):(_d.indexOf("<"+_e[itr]+">")>0?_d.substring(0,_d.indexOf("<"+_e[itr]+">")):_d);if(_b.indexOf("<"+_e[itr]+">")<0){continue;}var i=0,_10,_11;if(_f[itr]){_d=_d.concat("<"+_e[itr]+">");_d=_d.concat("<![CDATA[");_d=_d.concat("<amendments>");_d=_d.concat("<amendment>");_d=_d.concat("<sequence>");_d=_d.concat("");_d=_d.concat("</sequence>");_d=_d.concat("<data>");d.forEach(_f[itr],function(){if(_f[itr][i]!=null){_10=_f[itr][i].verb[0];_d=_d.concat("<datum>");_d=_d.concat("<id>");_d=_d.concat(i);_d=_d.concat("</id>");_d=_d.concat("<verb>");_d=_d.concat(_10);_d=_d.concat("</verb>");_d=_d.concat("<text>");_d=_d.concat("]]><![CDATA["+dojo.trim(_f[itr][i].content[0]));_d=_d.concat("</text>");_d=_d.concat("</datum>");}i++;});_d=_d.concat("</data>");_d=_d.concat("</amendment>");_d=_d.concat("</amendments>");_d=_d.concat("]]>");_d=_d.concat(_b.substring(_b.indexOf("</"+_e[itr]+">"),_b.length));}else{_d=_d.concat("<"+_e[itr]+">");_d=_d.concat(_b.substring(_b.indexOf("</"+_e[itr]+">"),_b.length));}}_9.push(_d);}else{_9.push(_b);}if(dj.byId("gridLicense")&&dj.byId("gridLicense").store&&dj.byId("gridLicense").store!==null&&dj.byId("gridLicense").store._arrayOfAllItems.length>0){_9.push("<linked_licenses>");dj.byId("gridLicense").store.fetch({query:{REFERENCEID:"*"},onComplete:dojo.hitch(dj.byId("gridLicense"),function(_12,_13){dojo.forEach(_12,function(_14){_9.push("<license>");_9.push("<ls_ref_id>",_14.REFERENCEID,"</ls_ref_id>");_9.push("<bo_ref_id>",_14.BO_REF_ID,"</bo_ref_id>");_9.push("<ls_number>",_14.LS_NUMBER,"</ls_number>");_9.push("<ls_allocated_amt>",_14.LS_ALLOCATED_AMT,"</ls_allocated_amt>");_9.push("<ls_amt>",_14.LS_AMT,"</ls_amt>");_9.push("<ls_os_amt>",_14.LS_OS_AMT,"</ls_os_amt>");_9.push("<converted_os_amt>",_14.CONVERTED_OS_AMT,"</converted_os_amt>");_9.push("<allow_overdraw>",_14.ALLOW_OVERDRAW,"</allow_overdraw>");_9.push("</license>");});})});_9.push("</linked_licenses>");}if(_8){_9.push("</",_8,">");}return _9.join("");}else{return _6;}}});d.mixin(m,{bind:function(){m.setValidation("tenor_maturity_date",m.validateMaturityDate);m.setValidation("exp_date",m.validateTradeExpiryDate);m.setValidation("amd_date",m.validateAmendmentDate);m.setValidation("pstv_tol_pct",m.validateTolerance);m.setValidation("neg_tol_pct",m.validateTolerance);m.setValidation("max_cr_desc_code",m.validateMaxCreditTerm);m.setValidation("last_ship_date",m.validateLastShipmentDate);m.setValidation("lc_cur_code",m.validateCurrency);m.setValidation("beneficiary_country",m.validateCountry);m.setValidation("alt_applicant_country",m.validateCountry);m.connect("irv_flag","onClick",m.checkIrrevocableFlag);m.connect("ntrf_flag","onClick",m.checkNonTransferableFlag);m.connect("stnd_by_lc_flag","onClick",m.checkStandByFlag);m.connect("cfm_inst_code_1","onClick",m.resetConfirmationCharges);m.connect("cfm_inst_code_2","onClick",m.resetConfirmationCharges);m.connect("cfm_inst_code_3","onClick",m.resetConfirmationCharges);m.connect("amd_chrg_brn_by_code_1","onClick",m.amendChargesLC);m.connect("amd_chrg_brn_by_code_2","onClick",m.amendChargesLC);m.connect("amd_chrg_brn_by_code_3","onClick",m.amendChargesLC);m.connect("amd_chrg_brn_by_code_4","onClick",m.amendChargesLC);m.connect("amd_chrg_brn_by_code_5","onClick",m.amendChargesLC);m.connect("amd_chrg_brn_by_code_9","onClick",m.amendChargesLC);m.connect("lc_amt","onBlur",m.calculateAmendTransactionAmount);m.setValidation("requested_confirmation_party_iso_code",m.validateBICFormat);m.connect("requested_confirmation_party_iso_code","onChange",function(){var _15=this.get("value");if(_15.length>0){m.setRequiredFields(["requested_confirmation_party_name","requested_confirmation_party_address_line_1"],false);}});m.connect("req_conf_party_flag","onChange",function(){var _16=this.get("value");if(_16=="Other"){d.byId("requested-conf-party-bank-details").style.display="block";m.toggleFields(true,["requested_confirmation_party_name","requested_confirmation_party_address_line_1","requested_confirmation_party_address_line_2","requested_confirmation_party_dom","requested_confirmation_party_iso_code"],null,null,true);}else{d.byId("requested-conf-party-bank-details").style.display="none";m.toggleFields(false,["requested_confirmation_party_name","requested_confirmation_party_address_line_1","requested_confirmation_party_address_line_2","requested_confirmation_party_dom","requested_confirmation_party_iso_code"],null,null,false);}});m.connect("cfm_chrg_brn_by_code_1","onClick",m.checkConfirmationCharges);m.connect("cfm_chrg_brn_by_code_2","onClick",m.checkConfirmationCharges);m.connect("cr_avl_by_code_1","onClick",m.togglePaymentDraftAt);m.connect("cr_avl_by_code_1","onClick",m.setDraftTerm);m.connect("cr_avl_by_code_2","onClick",m.togglePaymentDraftAt);m.connect("cr_avl_by_code_3","onClick",m.togglePaymentDraftAt);m.connect("cr_avl_by_code_4","onClick",m.togglePaymentDraftAt);m.connect("cr_avl_by_code_5","onClick",m.togglePaymentDraftAt);m.connect("tenor_type_1","onClick",m.toggleDraftTerm);m.connect("tenor_type_1","onClick",m.setDraftTerm);m.connect("tenor_type_2","onClick",m.toggleDraftTerm);m.connect("tenor_type_3","onClick",m.toggleDraftTerm);m.connect("last_ship_date","onChange",function(){m.toggleDependentFields(this,dj.byId("narrative_shipment_period"),m.getLocalization("shipmentDateOrPeriodExclusivityError"));});m.connect("last_ship_date","onClick",function(){m.toggleDependentFields(this,dj.byId("narrative_shipment_period"),m.getLocalization("shipmentDateOrPeriodExclusivityError"));});m.connect("tenor_maturity_date","onBlur",m.setDraftTerm);m.connect("tenor_days_type","onBlur",m.setDraftTerm);m.connect("tenor_type_details","onBlur",m.setDraftTerm);m.connect("lc_cur_code","onChange",function(){m.setCurrency(this,["lc_amt"]);});m.connect("credit_available_with_bank_type","onChange",m.setCreditAvailBy);m.connect("tenor_period","onChange",m.setDraftTerm);m.connect("tenor_from_after","onChange",m.setDraftTerm);m.connect("tenor_days","onChange",m.setDraftTerm);m.connect("tenor_days_type","onChange",function(){m.toggleFields((this.get("value")=="99"),null,["tenor_type_details"]);});m.connect("drawee_details_bank_name","onChange",m.initDraweeFields);m.connect("issuing_bank_abbv_name","onChange",m.populateReferences);m.connect("adv_send_mode","onChange",function(){m.toggleMT798Fields("issuing_bank_abbv_name");if(dj.byId("adv_send_mode").get("value")=="01"){m.toggleRequired("amd_details",true);}else{m.toggleRequired("amd_details",false);}});m.connect("issuing_bank_abbv_name","onChange",function(){m.toggleMT798Fields("issuing_bank_abbv_name");});m.connect("part_ship_detl_nosend","onChange",function(){var _17=this.get("value");dj.byId("part_ship_detl").set("value",this.get("value"));if(_17=="CONDITIONAL"){document.getElementById("infoMessagePartialShipment").style.display="block";document.getElementById("infoMessagePartialShipment").style.paddingLeft="250px";}else{document.getElementById("infoMessagePartialShipment").style.display="none";}m.toggleFields(_17&&_17!=="ALLOWED"&&_17!=="NOT ALLOWED"&&_17!=="NONE",null,["part_ship_detl_text_nosend"]);});m.connect("tran_ship_detl_nosend","onChange",function(){var _18=this.get("value");dj.byId("tran_ship_detl").set("value",_18);if(_18=="CONDITIONAL"){d.byId("infoMessageTranshipment").style.display="block";d.byId("infoMessageTranshipment").style.paddingLeft="250px";}else{d.byId("infoMessageTranshipment").style.display="none";}m.toggleFields(_18&&_18!=="ALLOWED"&&_18!=="NOT ALLOWED"&&_18!=="NONE",null,["tran_ship_detl_text_nosend"]);});m.connect("tenor_days","onFocus",m.setDraftDaysReadOnly);m.connect("tenor_period","onFocus",m.setDraftDaysReadOnly);m.connect("tenor_from_after","onFocus",m.setDraftDaysReadOnly);m.connect("tenor_days_type","onFocus",m.setDraftDaysReadOnly);m.connect("draft_term","onFocus",function(){this.set("readOnly",!dj.byId("cr_avl_by_code_5").get("checked"));});m.connect("narrative_shipment_period","onChange",function(){m.toggleDependentFields(this,dj.byId("last_ship_date"),m.getLocalization("shipmentDateOrPeriodExclusivityError"));});m.connect("narrative_shipment_period","onClick",function(){m.toggleDependentFields(this,dj.byId("last_ship_date"),m.getLocalization("shipmentDateOrPeriodExclusivityError"));});m.connect("eucp_flag","onClick",function(){m.toggleFields(this.get("checked"),null,["eucp_details"]);});m.connect("inco_term_year","onChange",function(){m.toggleFields(this.get("value"),null,["inco_term"],false,true);});m.connect("inco_term","onChange",function(){m.toggleFields(this.get("value"),null,["inco_place"],false,false);});m.connect("inco_term_year","onChange",m.getIncoTerm);m.connect("transport_mode_nosend","onChange",function(){var _19=this.get("value");dj.byId("transport_mode").set("value",_19);m.toggleFields(_19&&_19!=="AIRT"&&_19!=="SEAT"&&_19!=="RAIL"&&_19!=="ROAD"&&_19!=="MULT",null,["transport_mode_text_nosend"],false,false);});m.connect("transport_mode_text_nosend","onBlur",function(){dj.byId("transport_mode").set("value",this.get("value"));});m.connect("entity_img_label","onClick",_3);m.connect("license_lookup","onClick",function(){m.getLicenses("lc");});m.connect("lc_cur_code","onChange",function(){m.clearLicenseGrid(this,m._config.lcCurCode,"lc");});m.connect("entity","onChange",function(){m.clearLicenseGrid(this,m._config.applicant,"lc");});m.connect("beneficiary_name","onChange",function(){m.clearLicenseGrid(this,m._config.beneficiary,"lc");});m.connect("exp_date","onChange",function(){m.clearLicenseGrid(this,m._config.expDate,"lc");});m.connect("last_ship_date","onChange",function(){m.clearLicenseGrid(this,m._config.lastShipDate,"lc");});m.connect("revolving_flag","onChange",function(){if(this.get("checked")){m.animate("fadeIn",d.byId("revolving-details"));}else{m.animate("fadeOut",d.byId("revolving-details"));dj.byId("revolve_period").set("value","");dj.byId("revolve_frequency").set("value","");dj.byId("revolve_time_no").set("value","");dj.byId("cumulative_flag").set("checked",false);dj.byId("notice_days").set("value","");}});m.connect("for_account_flag","onChange",function(){if(this.get("checked")){m.animate("fadeIn",d.byId("alternate-party-details"));}else{m.animate("fadeOut",d.byId("alternate-party-details"));dj.byId("alt_applicant_name").set("value","");dj.byId("alt_applicant_address_line_1").set("value","");dj.byId("alt_applicant_address_line_2").set("value","");dj.byId("alt_applicant_dom").set("value","");dj.byId("alt_applicant_country").set("value","");}});m.connect("for_account_flag","onChange",function(){m.toggleFields((this.get("value")==="on"),["alt_applicant_address_line_2","alt_applicant_dom"],["alt_applicant_name","alt_applicant_address_line_1","alt_applicant_country"]);});m.connect("revolve_period","onBlur",function(){m.validateIntegerValue(dj.byId("revolve_period"));});m.connect("revolve_time_no","onBlur",function(){m.validateIntegerValue(dj.byId("revolve_time_no"));});m.connect("notice_days","onBlur",function(){m.validateIntegerValue(dj.byId("notice_days"));});m.connect("applicable_rules","onChange",function(){m.toggleFields((this.get("value")=="99"),null,["applicable_rules_text"]);});m.connect("narrative_period_presentation","onBlur",function(){var _1a=dj.byId("narrative_period_presentation").get("value");dj.byId("narrative_period_presentation_nosend").set("value",_1a);});m.setValidation("period_presentation_days",m.validatePeriodPresentationDays);m.connect("applicant_address_line_4","onFocus",function(){m.showTooltip(m.getLocalization("addressLine4ToolTip",[dj.byId("applicant_address_line_4").get("displayedValue"),dj.byId("applicant_address_line_4").get("value")]),d.byId("applicant_address_line_4"),["right"],5000);});m.connect("beneficiary_address_line_4","onFocus",function(){m.showTooltip(m.getLocalization("addressLine4ToolTip",[dj.byId("beneficiary_address_line_4").get("displayedValue"),dj.byId("beneficiary_address_line_4").get("value")]),d.byId("beneficiary_address_line_4"),["right"],5000);});m.connect("credit_available_with_bank_address_line_4","onFocus",function(){m.showTooltip(m.getLocalization("addressLine4ToolTip",[dj.byId("credit_available_with_bank_address_line_4").get("displayedValue"),dj.byId("credit_available_with_bank_address_line_4").get("value")]),d.byId("credit_available_with_bank_address_line_4"),["right"],5000);});if(dj.byId("dec_amt")&&!isNaN(dj.byId("dec_amt").get("value"))){dj.byId("inc_amt").set("disabled",true);}if(dj.byId("inc_amt")&&!isNaN(dj.byId("inc_amt").get("value"))){dj.byId("dec_amt").set("disabled",true);}m.connect("inc_amt","onBlur",m.amendTransaction);m.connect("dec_amt","onBlur",m.amendTransaction);m.connect("inc_amt","onBlur",function(){m.validateAmendAmount(true,this,"lc");if(!isNaN(dj.byId("inc_amt").value)&&d.number.parse(dijit.byId("inc_amt").get("displayedValue"))>0){dj.byId("lc_amt").set("value",d.number.parse(dj.byId("org_lc_amt").get("displayedValue"))+d.number.parse(dj.byId("inc_amt").get("displayedValue")));dj.byId("inc_amt").set("disabled",false);dj.byId("dec_amt").set("disabled",true);dj.byId("dec_amt").set("value","");}else{if(d.number.parse(dijit.byId("inc_amt").get("displayedValue"))<0){dj.byId("lc_amt").set("value",d.number.parse(dj.byId("org_lc_amt").get("displayedValue")));m.showTooltip(m.getLocalization("valueShouldBeGreaterThanZero",[dj.byId("inc_amt").get("displayedValue")]),d.byId("inc_amt"),["after"],5000);misys.dialog.show("ERROR",dj.byId("inc_amt").invalidMessage,"",function(){dj.byId("inc_amt").focus();dj.byId("inc_amt").set("state","Error");});return false;}}return true;});m.connect("dec_amt","onBlur",function(){_4();m.validateAmendAmount(true,this,"lc");if(!isNaN(dj.byId("dec_amt").value)){if(d.number.parse(dj.byId("org_lc_amt").get("displayedValue"))<d.number.parse(dj.byId("dec_amt").get("displayedValue"))){m.showTooltip(m.getLocalization("decreaseAmountShouldBeLessThanLCAmount",[dj.byId("dec_amt").get("displayedValue")]),d.byId("dec_amt"),["after"],5000);misys.dialog.show("ERROR",dj.byId("dec_amt").invalidMessage,"",function(){dj.byId("dec_amt").focus();dj.byId("dec_amt").set("state","Error");});return false;}else{if(d.number.parse(dijit.byId("dec_amt").get("displayedValue"))<0){dj.byId("lc_amt").set("value",d.number.parse(dj.byId("org_lc_amt").get("displayedValue")));m.showTooltip(m.getLocalization("valueShouldBeGreaterThanZero",[dj.byId("dec_amt").get("displayedValue")]),d.byId("dec_amt"),["after"],5000);misys.dialog.show("ERROR",dj.byId("dec_amt").invalidMessage,"",function(){dj.byId("dec_amt").focus();dj.byId("dec_amt").set("state","Error");});return false;}else{if(d.number.parse(dj.byId("dec_amt").get("displayedValue"))>0){dj.byId("lc_amt").set("value",d.number.parse(dj.byId("org_lc_amt").get("displayedValue"))-d.number.parse(dj.byId("dec_amt").get("displayedValue")));dj.byId("dec_amt").set("disabled",false);dj.byId("inc_amt").set("disabled",true);dj.byId("inc_amt").set("value","");}}}}return true;});m.connect("lc_amt","onBlur",function(){var _1b=d.number.parse(dj.byId("org_lc_amt").get("displayedValue")),_1c=d.number.parse(dj.byId("lc_amt").get("displayedValue"));if(!isNaN(_1c)){if(_1b>_1c){dj.byId("dec_amt").set("value",_1b-_1c);dj.byId("dec_amt").set("disabled",false);dj.byId("inc_amt").set("disabled",true);dj.byId("inc_amt").set("value","");}if(_1b<_1c){dj.byId("inc_amt").set("value",_1c-_1b);dj.byId("inc_amt").set("disabled",false);dj.byId("dec_amt").set("disabled",true);dj.byId("dec_amt").set("value","");}if(_1b===_1c){dj.byId("inc_amt").set("value","");dj.byId("inc_amt").set("disabled",false);dj.byId("dec_amt").set("value","");dj.byId("dec_amt").set("disabled",false);}}if(d.number.parse(dj.byId("lc_amt").get("displayedValue"))<=0){m.showTooltip(m.getLocalization("valueShouldBeGreaterThanZero",[dj.byId("lc_amt").get("displayedValue")]),d.byId("lc_amt"),["after"],5000);misys.dialog.show("ERROR",dj.byId("lc_amt").invalidMessage,"",function(){dj.byId("dec_amt").set("value","");dj.byId("inc_amt").set("value","");dj.byId("dec_amt").set("disabled",false);dj.byId("inc_amt").set("disabled",false);dj.byId("lc_amt").set("state","Error");});return false;}if(isNaN(d.number.parse(dj.byId("lc_amt").get("displayedValue")))){dj.byId("dec_amt").set("value","");dj.byId("inc_amt").set("value","");dj.byId("dec_amt").set("disabled",false);dj.byId("inc_amt").set("disabled",false);dj.byId("lc_amt").set("state","Error");return false;}return true;});},onFormLoad:function(){m.xhrPost({url:misys.getServletURL("/screen/AjaxScreen/action/GetAmendmentWarning"),handleAs:"json",sync:true,content:{refId:dj.byId("ref_id").get("value"),companyId:dj.byId("company_id").get("value"),productCode:"LC"},load:function(_1d,_1e){m._config.showWarningBene=_1d.showWarningBene?_1d.showWarningBene:false;}});if(m._config.showWarningBene){m.dialog.show("CONFIRMATION",m.getLocalization("warningMsgAmendLC"),"","","","","",function(){var _1f="/screen/LetterOfCreditScreen?option=EXISTING&tnxtype=03";window.location.href=misys.getServletURL(_1f);return;});}var _20=m._config.displayMode;m._config.lcCurCode=dj.byId("lc_cur_code").get("value");m._config.beneficiary.name=dj.byId("beneficiary_name").get("value");m._config.beneficiary.addressLine1=dj.byId("beneficiary_address_line_1").get("value");m._config.beneficiary.addressLine2=dj.byId("beneficiary_address_line_2").get("value");m._config.beneficiary.dom=dj.byId("beneficiary_dom").get("value");m._config.expDate=dj.byId("exp_date").get("displayedValue");m._config.lastShipDate=dj.byId("last_ship_date").get("displayedValue");var _21=dj.byId("issuing_bank_abbv_name").get("value");var _22=m._config.customerBanksMT798Channel[_21]===true;var _23=dojo.subscribe(_1,function(){m.toggleFields(m._config.customerBanksMT798Channel[_21]===true&&m.hasAttachments(),null,["delivery_channel"],false,false);});if(_20=="edit"){m.resetRequestedConfirmationParty();}var _24=dj.byId("tran_ship_detl").value;var _25=dj.byId("part_ship_detl").value;if((_24==="CONDITIONAL")&&_20==="edit"){d.byId("infoMessageTranshipment").style.display="block";d.byId("infoMessageTranshipment").style.paddingLeft="250px";}else{d.byId("infoMessageTranshipment").style.display="none";}if((_25==="CONDITIONAL")&&_20==="edit"){d.byId("infoMessagePartialShipment").style.display="block";d.byId("infoMessagePartialShipment").style.paddingLeft="250px";}else{d.byId("infoMessagePartialShipment").style.display="none";}if(dj.byId("req_conf_party_flag")){var _26=dj.byId("req_conf_party_flag").value;if(_26=="Other"){d.byId("requested-conf-party-bank-details").style.display="block";}else{d.byId("requested-conf-party-bank-details").style.display="none";}}if(dj.byId("amd_chrg_brn_by_code_4")||dj.byId("amd_chrg_brn_by_code_5")){if(!(dj.byId("amd_chrg_brn_by_code_4").get("value")||(dj.byId("amd_chrg_brn_by_code_5")&&dj.byId("amd_chrg_brn_by_code_5").get("value")))){var _27=dj.byId("narrative_amend_charges_other");if(_27){_27.set("value","");_27.set("disabled",true);}}}m.setCurrency(dj.byId("lc_cur_code"),["inc_amt","dec_amt","org_lc_amt","lc_amt","tnx_amt"]);var _28=dj.byId("credit_available_with_bank_type");if(_28){_28.onChange();}var _29=dj.byId("part_ship_detl_nosend");if(_29){var _2a=_29.get("value");m.toggleFields(_2a&&_2a!=="ALLOWED"&&_2a!=="NOT ALLOWED"&&_2a!=="NONE",null,["part_ship_detl_text_nosend"],true);}var _2b=dj.byId("part_ship_detl");if(_2b&&_2b.get("value")===""){_2b.set("value",_29.get("value"));}var _2c=dj.byId("tran_ship_detl_nosend");if(_2c){var _2d=_2c.get("value");m.toggleFields(_2d&&_2d!=="ALLOWED"&&_2d!=="NOT ALLOWED"&&_2d!=="NONE",null,["tran_ship_detl_text_nosend"]);}var _2e=dj.byId("tran_ship_detl");if(_2e&&_2e.get("value")===""){_2e.set("value",_2c.get("value"));}var _2f=["cr_avl_by_code_1","cr_avl_by_code_2","cr_avl_by_code_3","cr_avl_by_code_4","cr_avl_by_code_5"];d.forEach(_2f,function(id){var _30=dj.byId(id);if(_30&&_30.get("checked")){_30.onClick();}});var _31=dj.byId("eucp_flag");if(_31){m.toggleFields(_31.get("checked"),null,["eucp_details"]);}var _32=dj.byId("tenor_days_type")?dj.byId("tenor_days_type").get("value"):"";if(_32){m.toggleFields(_32==="99",null,["tenor_type_details"],true);}var _33=dj.byId("issuing_bank_abbv_name");if(_33){_33.onChange();}var _34=dj.byId("issuing_bank_customer_reference");if(_34){_34.onChange();}var _35=dj.byId("cr_avl_by_code_1").get("checked"),_36=dj.byId("cr_avl_by_code_2").get("checked"),_37=dj.byId("cr_avl_by_code_3").get("checked"),_38=dj.byId("cr_avl_by_code_5").get("checked");if(!_35&&!_36&&!_37&&!_38){m.setDraftTerm();}var _39=dj.byId("drawee_details_bank_name");if(_39){_39.onChange();}var _3a=dj.byId("inco_term")?dj.byId("inco_term").get("value"):"";if(_3a){m.toggleFields(_3a,null,["inco_place"],false,true);}else{m.toggleFields(_3a,null,["inco_place"],false,false);}var _3b=dj.byId("transport_mode_nosend");if(_3b){var _3c=_3b.get("value");m.toggleFields(_3c&&_3c!=="AIRT"&&_3c!=="SEAT"&&_3c!=="RAIL"&&_3c!=="ROAD"&&_3c!=="MULT",null,["transport_mode_text_nosend"]);}var _3d=dj.byId("transport_mode");if(_3d&&_3d.get("value")===""){_3d.set("value",_3b.get("value"));}if(dj.byId("revolving_flag")){if(dj.byId("revolving_flag").get("checked")){m.animate("fadeIn",d.byId("revolving-details"));}else{m.animate("fadeOut",d.byId("revolving-details"));dj.byId("revolve_period").set("value","");dj.byId("revolve_frequency").set("value","");dj.byId("revolve_time_no").set("value","");dj.byId("cumulative_flag").set("checked",false);dj.byId("notice_days").set("value","");}}if(dj.byId("for_account_flag")){if(dj.byId("for_account_flag").get("checked")){m.animate("fadeIn",d.byId("alternate-party-details"));}else{m.animate("fadeOut",d.byId("alternate-party-details"));dj.byId("alt_applicant_name").set("value","");dj.byId("alt_applicant_address_line_1").set("value","");dj.byId("alt_applicant_address_line_2").set("value","");dj.byId("alt_applicant_dom").set("value","");dj.byId("alt_applicant_country").set("value","");}}var _3e=dj.byId("for_account_flag");if(_3e){m.toggleFields(_3e.get("value")==="on",["alt_applicant_address_line_2","alt_applicant_dom"],["alt_applicant_name","alt_applicant_address_line_1","alt_applicant_country"]);}if(dj.byId("formLoad")){dj.byId("formLoad").set("value","false");}var _3f=dj.byId("applicable_rules");if(_3f){m.toggleFields(_3f.get("value")=="99",null,["applicable_rules_text"]);}if(dj.byId("inco_term_year")){m.getIncoYear();dijit.byId("inco_term_year").set("value",dj.byId("org_term_year").get("value"));}if(dj.byId("inco_term")){if(dj.byId("inco_term_year")&&dj.byId("inco_term_year").get("value")!=""){m.getIncoTerm();}dijit.byId("inco_term").set("value",dj.byId("org_inco_term").get("value"));}m.populateGridOnLoad("lc");m.toggleNarrativeDivStatus(true,"");},beforeSaveValidations:function(){var _40=dj.byId("entity");var _41=dj.byId("fee_act_no");var _42=dj.byId("principal_act_no");if(_42&&_42.get("value")!==""){if(!m.validatePricipleAccount("")){m._config.onSubmitErrorMsg=m.getLocalization("invalidPrincipleAccountError",[_42.get("displayedValue")]);m.showTooltip(m.getLocalization("invalidPrincipleAccountError",[_42.get("displayedValue")]),_42.domNode);_42.focus();return false;}}if(_41&&_41.get("value")!==""){if(!m.validateFeeAccount("")){m._config.onSubmitErrorMsg=m.getLocalization("invalidFeeAccountError",[_41.get("displayedValue")]);m.showTooltip(m.getLocalization("invalidFeeAccountError",[_41.get("displayedValue")]),_41.domNode);_41.focus();return false;}}if(_40&&_40.get("value")==""){return false;}else{return true;}},beforeSubmitValidations:function(){var _43=["alt_applicant_name","alt_applicant_address_line_1","alt_applicant_address_line_2","alt_applicant_address_line_4","alt_applicant_dom","alt_applicant_country","beneficiary_name","beneficiary_address_line_1","beneficiary_address_line_2","beneficiary_dom","beneficiary_address_line_4","beneficiary_country","beneficiary_reference","ship_from","ship_loading","ship_discharge","ship_to","part_ship_detl","tran_ship_detl","narrative_period_presentation","narrative_shipment_period","narrative_additional_amount","applicable_rules","credit_available_with_bank_name","credit_available_with_bank_role_code","credit_available_with_bank_address_line_1","credit_available_with_bank_address_line_2","req_conf_party_flag","requested_confirmation_party_name","requested_confirmation_party_address_line_1","requested_confirmation_party_address_line_2","requested_confirmation_party_iso_code","drawee_details_bank_name","adv_send_mode","expiry_place","requested_confirmation_party_address_line_4"];var _44=["irv_flag","ntrf_flag","stnd_by_lc_flag"];var _45=["cfm_inst_code_1","cfm_inst_code_2","cfm_inst_code_3","open_chrg_brn_by_code_1","open_chrg_brn_by_code_2","corr_chrg_brn_by_code_1","corr_chrg_brn_by_code_2","cfm_chrg_brn_by_code_1","cfm_chrg_brn_by_code_2","amd_chrg_brn_by_code_1","amd_chrg_brn_by_code_2","amd_chrg_brn_by_code_3","amd_chrg_brn_by_code_4","cr_avl_by_code_1","cr_avl_by_code_2","cr_avl_by_code_3","cr_avl_by_code_4","cr_avl_by_code_5","tenor_type_1","tenor_type_2","tenor_type_3"];var _46=["pstv_tol_pct","neg_tol_pct","lc_amt"];var _47=["exp_date","last_ship_date"];if(m._config.displayMode==="edit"){var _48=d.every(_47,function(id){var _49=dj.byId(id).get("value")+"";var _4a=d.date.locale.parse(dj.byId("org_"+id).get("displayedValue"),{selector:"date",datePattern:m.getLocalization("g_strGlobalDateFormat")})+"";if(_49==="null"||_49===_4a){return true;}return false;});var _4b=d.every(_46,function(id){var _4c=dj.byId(id).get("value");var _4d=dj.byId("org_"+id).get("value");if(isNaN(_4c)||_4c=="null"||_4c=="undefined"){_4c="";}if(_4c==_4d){return true;}return false;});var _4e=[m._config.narrativeDescGoodsDataStore,m._config.narrativeDocsReqDataStore,m._config.narrativeAddInstrDataStore,m._config.narrativeSpBeneDataStore,m._config.narrativeSpRecvbankDataStore];var _4f=false;for(var itr=0;itr<5;itr++){d.forEach(_4e[itr],function(){if(!(_4e[itr].length==0||_4e[itr]==undefined)){_4f=true;}});}var _50=m.compareTransactionMaster(_43,"TXT");var _51=m.compareTransactionMaster(_44,"CHECK");var _52=m.compareTransactionMasterRadio(_45);if(!_50&&!_51&&!_52&&_48&&_4b&&!_4f){m._config.onSubmitErrorMsg=m.getLocalization("noAmendmentError");return false;}}if(dj.byId("lc_amt")){if(!m.validateAmount((dj.byId("lc_amt"))?dj.byId("lc_amt"):0)){m._config.onSubmitErrorMsg=m.getLocalization("amountcannotzero");dj.byId("lc_amt").set("value","");return false;}}if(dj.byId("adv_send_mode")&&dj.byId("adv_send_mode").get("value")==1){var _53=dj.byId("issuing_bank_abbv_name").get("value");var i,_54=0,_55=0,_56=0,_57="narrative-details-tabcontainer",_58=true,_59,_5a=m._config.customerBanksMT798Channel[_53];var _5b=dj.byId("swiftregexzcharValue").get("value");var _5c=new RegExp(_5b);m._config.isNarrativeZCharValidArray=[true,true,true,true,true];var _5d=[0,0,0,0,0];m._config.isSingleNarrativeValid=[true,true,true,true,true];var _5e=["tabNarrativeDescriptionGoods","tabNarrativeDocumentsRequired","tabNarrativeAdditionalInstructions","tabNarrativeSpecialBeneficiary","tabNarrativeSpecialReceivingBank"];if(document.getElementById("tabNarrativeDescriptionGoods").status==true){for(itr=0;itr<5;itr++){i=0;_59=true;if(_4e&&_4e[itr]){d.forEach(_4e[itr],function(){if(_4e[itr][i]&&_4e[itr][i]!==null&&_59){_4e[itr][i].content[0].replace(/&#xa;/g,"\n");_56+=_4e[itr][i].content[0].length;_55+=_4e[itr][i].text_size[0];_5d[itr]+=_4e[itr][i].text_size[0];_59=_5c.test(_4e[itr][i].content[0]);m._config.isNarrativeZCharValidArray[itr]=_59;}i++;});}if(!m._config.isNarrativeZCharValidArray[itr]||(dojo.some(_5d,function(_5f){return _5f>(_5a?792:800);}))){if(!m._config.isNarrativeZCharValidArray[itr]){m.toggleNarrativeDivStatus(m._config.isNarrativeZCharValidArray[itr],_5e[itr]);}else{if(_5d[itr]>(_5a?792:800)){m._config.isSingleNarrativeValid[itr]=false;m.toggleNarrativeDivStatus(m._config.isSingleNarrativeValid[itr],_5e[itr]);_58=false;}}}}if(_55>(_5a?992:1000)){d.forEach(m._config.isSingleNarrativeValid,function(){m._config.isSingleNarrativeValid[_54]=true;});m.toggleNarrativeDivStatus(false);_58=false;}}else{if(_55>(_5a?992:1000)||document.getElementById("tabNarrativeDescriptionGoods").status==false){_54=0;d.forEach(m._config.isSingleNarrativeValid,function(){m._config.isSingleNarrativeValid[_54]=true;});if(document.getElementById("tabNarrativeDescriptionGoods").status==true){m.toggleNarrativeDivStatus(false);}_58=false;}}if(!_58||(dojo.some(m._config.isNarrativeZCharValidArray,function(_60){return _60==false;}))){if(m._config.isNarrativeZCharValidArray.indexOf(false)>3){_57="narrative-special-payments-beneficiary-tabcontainer";}dojox.fx.smoothScroll({node:document.getElementById(_57),win:window}).play();return false;}}if(dj.byId("req_conf_party_flag")&&dj.byId("req_conf_party_flag").get("value")!==""){if(dj.byId("req_conf_party_flag").get("value")==="Other"){if(!m.validateBankEntry("requested_confirmation_party")){m._config.onSubmitErrorMsg=m.getLocalization("requestedConfirmationPartyError");return false;}}}if(dj.byId("narrative_period_presentation_nosend")&&dj.byId("narrative_period_presentation_nosend").get("value")!==""){var _61=dj.byId("narrative_period_presentation_nosend").get("value");if(_61.indexOf("\n")!=-1){m._config.onSubmitErrorMsg=m.getLocalization("periodOfPresentaionError");return false;}}var _62=dj.byId("principal_act_no");if(_62&&_62.get("value")!==""){if(!m.validatePricipleAccount()){m._config.onSubmitErrorMsg=m.getLocalization("invalidPrincipleAccountError",[_62.get("displayedValue")]);m.showTooltip(m.getLocalization("invalidPrincipleAccountError",[_62.get("displayedValue")]),_62.domNode);_62.focus();return false;}}var _63=dj.byId("fee_act_no");if(_63&&_63.get("value")!==""){if(!m.validateFeeAccount()){m._config.onSubmitErrorMsg=m.getLocalization("invalidFeeAccountError",[_63.get("displayedValue")]);m.showTooltip(m.getLocalization("invalidFeeAccountError",[_63.get("displayedValue")]),_63.domNode);_63.focus();return false;}}return m.validateLSAmtSumAgainstTnxAmt("lc");},beforeSubmit:function(){m.updateSubTnxTypeCode("lc");}});})(dojo,dijit,misys);dojo.require("misys.client.binding.trade.amend_lc_swift2018_client");}