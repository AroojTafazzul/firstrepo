/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.trade.create_sg"]){dojo._hasResource["misys.binding.trade.create_sg"]=true;dojo.provide("misys.binding.trade.create_sg");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("misys.form.file");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("misys.widget.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.layout.ContentPane");dojo.require("dojo.data.ItemFileReadStore");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.form.FilteringSelect");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.widget.Collaboration");(function(d,dj,m){function _1(){dj.byId("principal_act_no").set("value","");dj.byId("fee_act_no").set("value","");};d.mixin(m._config,{initReAuthParams:function(){var _2={productCode:"SG",subProductCode:"",transactionTypeCode:"01",entity:dj.byId("entity")?dj.byId("entity").get("value"):"",currency:dj.byId("sg_cur_code")?dj.byId("sg_cur_code").get("value"):"",amount:dj.byId("sg_amt")?m.trimAmount(dj.byId("sg_amt").get("value")):"",bankAbbvName:dj.byId("issuing_bank_abbv_name")?dj.byId("issuing_bank_abbv_name").get("value"):"",es_field1:dj.byId("sg_amt")?m.trimAmount(dj.byId("sg_amt").get("value")):"",es_field2:""};return _2;}});d.mixin(m,{bind:function(){m.setValidation("exp_date",m.validateTradeExpiryDate);m.setValidation("sg_cur_code",m.validateCurrency);m.setValidation("sg_amt",_3);m.connect("issuing_bank_abbv_name","onChange",m.populateReferences);m.connect("issuing_bank_abbv_name","onChange",m.updateBusinessDate);if(dj.byId("issuing_bank_abbv_name")){m.connect("entity","onChange",function(){dj.byId("issuing_bank_abbv_name").onChange();});}m.connect("sg_cur_code","onChange",function(){m.setCurrency(this,["sg_amt"]);});m.connect("sg_amt","onBlur",function(){m.setTnxAmt(this.get("value"));});m.connect("issuing_bank_customer_reference","onChange",m.setApplicantReference);m.connect("entity_img_label","onClick",_1);},onFormLoad:function(){m.setCurrency(dj.byId("sg_cur_code"),["sg_amt"]);if(dj.byId("isfromExistingLC")&&dj.byId("isfromExistingLC").get("value")==="Y"){if(dj.byId("sg_cur_code")){dj.byId("sg_cur_code").set("readOnly",true);}if(dj.byId("sg_amt_img")){m.animate("fadeOut","sg_amt_img");}}var _4=dj.byId("issuing_bank_abbv_name");if(_4){_4.onChange();}var _5=dj.byId("issuing_bank_customer_reference");if(_5){_5.onChange();}},beforeSaveValidations:function(){var _6=dj.byId("principal_act_no");if(_6&&_6.get("value")!==""){if(!m.validatePricipleAccount()){m._config.onSubmitErrorMsg=m.getLocalization("invalidPrincipleAccountError",[_6.get("displayedValue")]);m.showTooltip(m.getLocalization("invalidPrincipleAccountError",[_6.get("displayedValue")]),_6.domNode);_6.focus();return false;}}var _7=dj.byId("fee_act_no");if(_7&&_7.get("value")!==""){if(!m.validateFeeAccount()){m._config.onSubmitErrorMsg=m.getLocalization("invalidFeeAccountError",[_7.get("displayedValue")]);m.showTooltip(m.getLocalization("invalidFeeAccountError",[_7.get("displayedValue")]),_7.domNode);_7.focus();return false;}}var _8=dj.byId("entity");if(_8&&_8.get("value")==""){return false;}else{return true;}},beforeSubmitValidations:function(){if(!(m.validateLength(["applicant","beneficiary"]))){return false;}var _9=dj.byId("principal_act_no");if(_9&&_9.get("value")!==""){if(!m.validatePricipleAccount()){m._config.onSubmitErrorMsg=m.getLocalization("invalidPrincipleAccountError",[_9.get("displayedValue")]);m.showTooltip(m.getLocalization("invalidPrincipleAccountError",[_9.get("displayedValue")]),_9.domNode);_9.focus();return false;}}var _a=dj.byId("fee_act_no");if(_a&&_a.get("value")!==""){if(!m.validateFeeAccount()){m._config.onSubmitErrorMsg=m.getLocalization("invalidFeeAccountError",[_a.get("displayedValue")]);m.showTooltip(m.getLocalization("invalidFeeAccountError",[_a.get("displayedValue")]),_a.domNode);_a.focus();return false;}}if(dj.byId("issuing_bank_abbv_name")&&!m.validateApplDate(dj.byId("issuing_bank_abbv_name").get("value"))){m._config.onSubmitErrorMsg=m.getLocalization("changeInApplicationDates");m.goToTop();return false;}return true;}});function _3(){var _b=dj.byId("sg_amt");var _c=_b?_b.get("value"):"";var _d=dj.byId("parent_lc_liab_amt");var _e=d.number.parse(_d?_d.get("value"):"");if(_b&&_c!==null){if(!m.validateAmount(dj.byId("sg_amt")?_b:0)){m._config.onSubmitErrorMsg=m.getLocalization("amountcannotzero");_b.set("value","");return false;}if((dj.byId("sg_amt")&&_c!=null)&&(_d&&_e!=null)&&(_c>_e)){m.dialog.show("ERROR",m.getLocalization("sgAmtGreaterThanLcLiabAmtError"));_b.set("value","");return false;}}return true;};})(dojo,dijit,misys);dojo.require("misys.client.binding.trade.create_sg_client");}