/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.trade.amend_bg"]){dojo._hasResource["misys.binding.trade.amend_bg"]=true;dojo.provide("misys.binding.trade.amend_bg");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("misys.form.file");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("misys.widget.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.layout.ContentPane");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.widget.Collaboration");dojo.require("misys.binding.trade.ls_common");(function(d,dj,m){var _1="deletegridrecord";m._config=m._config||{};m._config.expDate=m._config.expDate||{};m._config.beneficiary=m._config.beneficiary||{name:"",addressLine1:"",addressLine2:"",dom:""};m._config.renewFlag=m._config.renewFlag||{};d.mixin(m._config,{initReAuthParams:function(){var _2={productCode:"BG",subProductCode:"",transactionTypeCode:"03",entity:dj.byId("entity")?dj.byId("entity").get("value"):"",currency:dj.byId("bg_cur_code")?dj.byId("bg_cur_code").get("value"):"",amount:dj.byId("bg_amt")?m.trimAmount(dj.byId("bg_amt").get("value")):"",es_field1:"",es_field2:""};return _2;},xmlTransform:function(_3){var _4="<bg_tnx_record>";if(_3.indexOf(_4)!=-1){var _5=m._config.xmlTagName,_6=_5?["<",_5,">"]:[],_7="</bg_tnx_record>",_8="",_9=-1;_8=_3.substring(_4.length,(_3.length-_7.length));_6.push(_8);if(dj.byId("gridLicense")&&dj.byId("gridLicense").store&&dj.byId("gridLicense").store!==null&&dj.byId("gridLicense").store._arrayOfAllItems.length>0){_6.push("<linked_licenses>");dj.byId("gridLicense").store.fetch({query:{REFERENCEID:"*"},onComplete:dojo.hitch(dj.byId("gridLicense"),function(_a,_b){dojo.forEach(_a,function(_c){_6.push("<license>");_6.push("<ls_ref_id>",_c.REFERENCEID,"</ls_ref_id>");_6.push("<bo_ref_id>",_c.BO_REF_ID,"</bo_ref_id>");_6.push("<ls_number>",_c.LS_NUMBER,"</ls_number>");_6.push("<ls_allocated_amt>",_c.LS_ALLOCATED_AMT,"</ls_allocated_amt>");_6.push("<ls_amt>",_c.LS_AMT,"</ls_amt>");_6.push("<ls_os_amt>",_c.LS_OS_AMT,"</ls_os_amt>");_6.push("<converted_os_amt>",_c.CONVERTED_OS_AMT,"</converted_os_amt>");_6.push("<allow_overdraw>",_c.ALLOW_OVERDRAW,"</allow_overdraw>");_6.push("</license>");});})});_6.push("</linked_licenses>");}if(_5){_6.push("</",_5,">");}return _6.join("");}else{return _3;}}});function _d(){if(dj.byId("org_bg_liab_amt")&&dj.byId("org_bg_liab_amt").get("value")!==null&&dj.byId("dec_amt")&&dj.byId("dec_amt").get("value")!==null){if(d.number.parse(dijit.byId("org_bg_liab_amt").get("value"))<dijit.byId("dec_amt").get("value")){var _e=dj.byId("bg_cur_code").get("value");var _f=dojo.number.parse(dj.byId("org_bg_liab_amt").get("value"));dj.byId("dec_amt").invalidMessage=m.getLocalization("decAmountLessThanOutstandingAmt",[_e,_f.toFixed(2)]);misys.dialog.show("ERROR",dj.byId("dec_amt").invalidMessage,"",function(){dj.byId("dec_amt").focus();dj.byId("dec_amt").set("state","Error");});return false;}return true;}};function _10(){var _11=d.byId("facilityLimitDetail");if(!isNaN(this.get("value"))&&_11){m.animate("wipeIn",_11);if(this.id==="inc_amt"){_12(this);m.toggleFields(false,null,["limit_id","booking_amt","facility_id"],true,false);m.toggleFields(true,null,["booking_amt"],true,false);}else{if(dj.byId("orginal_facility_id")&&dj.byId("orginal_limit_id")&&dj.byId("facility_id")&&dj.byId("limit_id")){dj.byId("facility_id").set("value",dj.byId("orginal_facility_id").get("value"));dj.byId("limit_id").set("value",dj.byId("orginal_limit_id").get("value"));}_12(this);m.toggleFields(false,null,["limit_id","booking_amt","facility_id"],true,false);}m.toggleFields(true,null,["limit_id","booking_amt","facility_id","booking_cur_code"],true,true);}else{if(_11){m.animate("wipeOut",_11);m.toggleFields(false,null,["limit_id","booking_amt","facility_id","booking_cur_code"],true,false);}}};function _12(_13){var _14=dj.byId("bg_cur_code"),_15=dj.byId("limit_outstanding_cur_code"),_16=dj.byId("limit_outstanding_amount"),_17=dj.byId("facility_outstanding_cur_code"),_18=dj.byId("facility_outstanding_amount"),_19=dj.byId("booking_amt"),_1a="";if(_13&&_13.id==="inc_amt"&&_19){_19.set("displayedValue","");}if(_14&&_15&&_16&&_17&&_18&&_19){var _1b=_16.get("value"),_1c=_18.get("value"),_1d=_15.get("value"),_1e=_14.get("value"),_1f=_17.get("value"),_20=_19.get("value"),_21=true,_22=_13?_13.get("value"):"",_23="";if(_1d!==""&&_1e!==""&&_1f!==""&&_1d!==""){if(_1d!==_1e){_1a=_1e+"_"+_1d+"_limit,";}if(_1f!==_1d){_1a=_1a+_1f+"_"+_1d+"_facility";}if(_1a+"S"!=="S"){m.getCurrencyRateForFacility(_1a);if(!_13||_13.id==="inc_amt"){if(m._config.limitRate&&_22!==""){_20=_22*m._config.limitRate;}_19.attr("value",_20,false);if(_20>_1b){_21=false;if(m._config.limitRate!==1){_23=m.getLocalization("invalidBookingAmountCurrency",["Limit",_1e+"/"+_1d]);}else{if(m._config.limitRate!==1){_23=m.getLocalization("invalidBookingAmountCurrency",["Facility",_1f+"/"+_1d]);}else{_23=m.getLocalization("invalidBookingAmount",["Limit"]);}}}if(_21&&_20>_1c*m._config.facilityRate){_21=false;_23=m.getLocalization("invalidBookingAmountCurrency",["Facility",_1f+"/"+_1d]);}}else{if(m._config.limitRate&&_22!==""){_20=_22*m._config.limitRate;}_19.attr("value",_20,false);}}else{if(_22!==""){_20=_22;}_19.attr("value",_20,false);if(!_13||_13.id==="inc_amt"){if(_20>_1b){_21=false;_23=m.getLocalization("invalidBookingAmount",["Limit"]);}if(_21&&_20>_1c){_21=false;_23=m.getLocalization("invalidBookingAmount",["Facility"]);}}}}if(!_21){if(_13){_19.focus();}_19.set("state","Error");dj.hideTooltip(_19.domNode);dj.showTooltip(_23,_19.domNode,100);}}};d.mixin(m,{bind:function(){m.setValidation("tender_expiry_date",m.validateTenderExpiryDate);m.setValidation("contract_date",m.validateContractDate);m.setValidation("contract_cur_code",m.validateCurrency);m.setValidation("contract_pct",m.checkContractPercent);m.setValidation("exp_date",m.validateTradeExpiryDate);m.connect("inc_amt","onBlur",function(){m.validateAmendAmount(true,this,"bg");});m.connect("dec_amt","onBlur",function(){_d();m.validateAmendAmount(true,this,"bg");});m.setValidation("renew_for_nb",m.validateRenewFor);m.setValidation("advise_renewal_days_nb",m.validateDaysNotice);m.setValidation("rolling_renewal_nb",m.validateNumberOfRenewals);m.setValidation("rolling_cancellation_days",m.validateCancellationNotice);m.connect("inc_amt","onBlur",m.amendTransaction);m.connect("inc_amt","onBlur",_10);m.setValidation("amd_date",m.validateBGAmendmentDate);m.setValidation("exp_date",m.validateAmendBGTradeExpiryDate);m.connect("renewal_calendar_date","onChange",m.validateAmendBGRenewalCalendarDate);m.connect("exp_date","onChange",m.calculateRenewalFinalExpiryDate);m.connect("rolling_renewal_nb","onBlur",m.calculateRenewalFinalExpiryDate);m.connect("renew_on_code","onBlur",m.calculateRenewalFinalExpiryDate);m.connect("renewal_calendar_date","onBlur",m.calculateRenewalFinalExpiryDate);m.connect("renew_for_nb","onBlur",m.calculateRenewalFinalExpiryDate);m.connect("renew_for_period","onBlur",m.calculateRenewalFinalExpiryDate);m.connect("rolling_renew_on_code","onChange",m.calculateRenewalFinalExpiryDate);m.connect("rolling_renew_for_nb","onChange",m.calculateRenewalFinalExpiryDate);m.connect("rolling_renew_for_period","onChange",m.calculateRenewalFinalExpiryDate);m.connect("limit_id","onChange",m.setLimitFieldsValue);m.connect("booking_amt","onBlur",function(){_12();});m.connect("facility_id","onChange",function(){m.getLimitDetails(true);if(dj.byId("booking_amt")){dj.byId("booking_amt").set("displayedValue","");}});m.connect("limit_id","onChange",function(){if(dj.byId("inc_amt")&&!isNaN(dj.byId("inc_amt").get("value"))){_12(dj.byId("inc_amt"));}else{if(dj.byId("dec_amt")&&!isNaN(dj.byId("dec_amt").get("value"))){_12(dj.byId("dec_amt"));}}});m.connect("dec_amt","onBlur",m.amendTransaction);m.connect("dec_amt","onBlur",_10);m.connect("final_expiry_date","onBlur",function(){if(dj.byId("adv_send_mode").get("value")=="01"){var _24=m.calculateFinalExpiryDate();var _25=function(){m.calculateRenewalFinalExpiryDate();};if(_24!=undefined&&dj.byId("final_expiry_date")&&dj.byId("final_expiry_date").get("value")!==null&&dj.byId("final_expiry_date").get("value").getTime()!==_24.getTime()){var _26=dojo.date.locale.format(new Date(_24.getTime()),{selector:"date",formatLength:"short",locale:dojo.config.locale,datePattern:m.getLocalization("g_strGlobalDateFormat")});m.dialog.show("DATE-CONFLICT",m.getLocalization("confirmResetFinalExpDate",[_26]),"","","","",_25,"","");}}});m.connect("adv_send_mode","onChange",function(){m.toggleMT798Fields("recipient_bank_abbv_name");if(dj.byId("adv_send_mode").get("value")=="01"){m.toggleRequired("amd_details",true);var _27=m.calculateFinalExpiryDate();var _28=function(){m.calculateRenewalFinalExpiryDate();};if(_27!=undefined&&dj.byId("final_expiry_date")&&dj.byId("final_expiry_date").get("value")!==null&&dj.byId("final_expiry_date").get("value").getTime()!==_27.getTime()){var _29=dojo.date.locale.format(new Date(_27.getTime()),{selector:"date",formatLength:"short",locale:dojo.config.locale,datePattern:m.getLocalization("g_strGlobalDateFormat")});m.dialog.show("DATE-CONFLICT",m.getLocalization("confirmResetFinalExpDate",[_29]),"","","","",_28,"","");}}else{m.toggleRequired("amd_details",false);}});m.connect("renew_flag","onClick",function(){if(!this.get("checked")){dj.byId("rolling_renewal_nb").set("value","");}else{if(!dj.byId("rolling_renewal_flag").get("checked")){dj.byId("rolling_renewal_nb").set("value",m.getLocalization("default_rewnewalNumber"));}}});m.connect("renew_on_code","onChange",m.validateRenewalCalendarDate);m.connect("renew_on_code","onChange",function(){m.toggleFields(this.get("value")==="02",null,["renewal_calendar_date"]);});m.connect("advise_renewal_flag","onClick",function(){m.toggleFields(this.get("checked"),null,["advise_renewal_days_nb"]);});m.connect("advise_renewal_flag","onChange",function(){m.toggleFields(this.get("checked"),null,["advise_renewal_days_nb"]);});m.connect("rolling_renewal_flag","onClick",function(){m.toggleFields(this.get("checked"),null,["rolling_renewal_nb","rolling_cancellation_days","rolling_renew_on_code"]);if(!this.get("checked")){dj.byId("rolling_renew_for_nb").set("value","");dj.byId("rolling_renew_for_period").set("value","");dj.byId("rolling_day_in_month").set("value","");if(dj.byId("renew_flag").get("checked")){dj.byId("rolling_renewal_nb").set("value",m.getLocalization("default_rewnewalNumber"));}}});m.connect("final_expiry_date","onChange",function(){var _2a=dj.byId("exp_date");var _2b=dj.byId("projected_expiry_date");var _2c=function(){dj.hideTooltip(dj.byId("final_expiry_date").domNode);};var _2d=this.get("displayedValue");if(_2a&&!m.compareDateFields(_2a,this)){this.set("state","Error");dj.showTooltip(m.getLocalization("finalExpDateLessThanTransactionExpDtError",[_2d,_2a.get("displayedValue")]),dj.byId("final_expiry_date").domNode,0);setTimeout(_2c,2000);}else{if(_2b&&!m.compareDateFields(_2b,this)){this.set("value",null);dj.showTooltip(m.getLocalization("finalExpDateLessThanProjectedExpDtError",[_2d,_2b.get("displayedValue")]),dj.byId("final_expiry_date").domNode,0);setTimeout(_2c,2000);}}});m.connect("rolling_renewal_flag","onChange",function(){m.toggleFields(this.get("checked"),null,["rolling_renewal_nb","rolling_cancellation_days","rolling_renew_on_code"]);if(!this.get("checked")){dj.byId("rolling_renew_for_nb").set("value","");dj.byId("rolling_renew_for_period").set("value","");dj.byId("rolling_day_in_month").set("value","");if(dj.byId("renew_flag").get("checked")){dj.byId("rolling_renewal_nb").set("value",m.getLocalization("default_rewnewalNumber"));}}});m.connect("rolling_renew_on_code","onChange",function(){m.toggleFields(this.get("value")==="03",["rolling_day_in_month"],["rolling_renew_for_nb"],true);if(this.get("value")==="01"){dj.byId("rolling_renew_for_nb").set("value","");dj.byId("rolling_renew_for_period").set("value","");dj.byId("rolling_day_in_month").set("value","");}else{if(dj.byId("rolling_renew_on_code").get("value")==="03"&&dj.byId("rolling_renewal_flag").get("checked")&&dj.byId("renew_for_period").get("value")!==""){dj.byId("rolling_renew_for_period").set("value",dj.byId("renew_for_period").get("value"));}}});m.connect("rolling_renew_for_nb","onBlur",function(){m.validateRollingRenewalFrequency(dj.byId("rolling_renew_for_nb"));});m.connect("renew_for_nb","onBlur",function(){m.validateRollingRenewalFrequency(dj.byId("renew_for_nb"));});m.connect("renew_for_period","onChange",function(){if(dj.byId("rolling_renew_on_code").get("value")==="03"&&dj.byId("rolling_renewal_flag").get("checked")&&dj.byId("renew_for_period").get("value")!==""){dj.byId("rolling_renew_for_period").set("value",dj.byId("renew_for_period").get("value"));}});m.connect("license_lookup","onClick",function(){m.getLicenses("bg");});m.connect("exp_date","onChange",function(){m.clearLicenseGrid(this,m._config.expDate);});m.connect("beneficiary_name","onChange",function(){m.clearLicenseGrid(this,m._config.beneficiary);});m.connect("renew_flag","onChange",function(){m.clearLicenseGrid(this,m._config.renewFlag);});m.connect("renew_amt_code_1","onClick",function(){m.setRenewalAmount(this);});m.connect("renew_amt_code_2","onClick",function(){m.setRenewalAmount(this);});m.connect("contract_cur_code","onChange",function(){m.setCurrency(dj.byId("contract_cur_code"),["contract_amt"]);});m.connect("contract_cur_code","onBlur",function(){if(dj.byId("contract_cur_code").get("value")!==""||!isNaN(dj.byId("contract_amt").get("value"))){m.toggleRequired("contract_amt",true);m.toggleRequired("contract_cur_code",true);}else{m.toggleRequired("contract_amt",false);m.toggleRequired("contract_cur_code",false);}});m.connect("contract_amt","onBlur",function(){if(dj.byId("contract_cur_code").get("value")!==""||!isNaN(dj.byId("contract_amt").get("value"))){m.toggleRequired("contract_amt",true);m.toggleRequired("contract_cur_code",true);}else{m.toggleRequired("contract_amt",false);m.toggleRequired("contract_cur_code",false);}});m.connect("contract_ref","onChange",function(){var _2e=d.byId("tender-exp-date");if(this.get("value")==="TEND"){m.animate("fadeIn",_2e);}else{dj.byId("tender_expiry_date").set("value",null);m.animate("fadeOut",_2e);}});m.connect("exp_date_type_code","onChange",function(){if(this.get("value")!=""){m.toggleFields((this.get("value")!="01"),null,["exp_date"]);m.toggleFields((this.get("value")!="02"),null,["exp_event"]);}else{m.toggleFields((false),null,["exp_date","exp_event"],null,["exp_date","exp_event"]);}});m.connect("beneficiary_address_line_4","onFocus",function(){m.showTooltip(m.getLocalization("addressLine4ToolTip",[dj.byId("beneficiary_address_line_4").get("displayedValue"),dj.byId("beneficiary_address_line_4").get("value")]),d.byId("beneficiary_address_line_4"),["right"],5000);});},onFormLoad:function(){m._config.expDate=dj.byId("exp_date").get("displayedValue");m._config.beneficiary.name=dj.byId("beneficiary_name").get("value");m._config.beneficiary.addressLine1=dj.byId("beneficiary_address_line_1").get("value");m._config.beneficiary.addressLine2=dj.byId("beneficiary_address_line_2").get("value");m._config.beneficiary.dom=dj.byId("beneficiary_dom").get("value");m._config.renewFlag=dj.byId("renew_flag").get("checked");m.setCurrency(dj.byId("bg_cur_code"),["inc_amt","dec_amt","org_bg_amt","bg_amt"]);if(dj.byId("contract_cur_code")&&dj.byId("contract_cur_code").get("value")!==""){m.setCurrency(dj.byId("contract_cur_code"),["contract_amt"]);}var _2f=dj.byId("recipient_bank_abbv_name").get("value");var _30=dojo.subscribe(_1,function(){m.toggleFields(m._config.customerBanksMT798Channel[_2f]==true&&m.hasAttachments(),null,["delivery_channel"],false,false);});var _31=dj.byId("adv_send_mode");if(_31){_31.onChange();}var _32=m._config.customerBanksMT798Channel[_2f]===true;if(_32){m.animate("wipeOut",d.byId("adv_send_mode_row"));m.toggleRequired("adv_send_mode",false);}else{m.animate("wipeIn",d.byId("adv_send_mode_row"));m.toggleRequired("adv_send_mode",true);}var _33=dj.byId("renew_flag");if(_33){d.hitch(_33,m.toggleRenewalDetails,true)();m.toggleFields((dj.byId("renew_on_code").get("value")=="02"),null,["renewal_calendar_date"],true);m.toggleFields(dj.byId("advise_renewal_flag").get("checked"),null,["advise_renewal_days_nb"],true);m.toggleFields(dj.byId("rolling_renewal_flag").get("checked"),null,["rolling_renewal_nb","rolling_cancellation_days","rolling_renew_on_code"],true);if(d.byId("advise_renewal_days_nb")&&d.byId("advise_renewal_days_nb").value==""){dj.byId("advise_renewal_flag").set("checked",false);}var _34=dj.byId("rolling_renew_on_code");if(_34){m.toggleFields(_34.get("value")==="03",["rolling_day_in_month"],["rolling_renew_for_nb"],true);}}if(dj.byId("provisional_status")){d.style("provisional_status_row","display","none");}var _35=dj.byId("renew_on_code");if(_35){m.toggleFields(_35.get("value")==="02",null,["renewal_calendar_date"],true);}var _36=dj.byId("advise_renewal_flag");if(_36){m.toggleFields(_36.get("checked"),null,["advise_renewal_days_nb"],true);}var _37=dj.byId("rolling_renewal_flag");if(_37){m.toggleFields(_37.get("checked"),null,["rolling_renewal_nb","rolling_cancellation_days","rolling_renew_on_code"],true);}if(dj.byId("facility_id")){dj.byId("facility_id").onChange();if(dj.byId("inc_amt")&&!isNaN(dj.byId("inc_amt").get("value"))){m.toggleFields(false,null,["limit_id","booking_amt","facility_id"],true,false);m.toggleFields(true,null,["booking_amt"],true,false);}else{if(dj.byId("dec_amt")&&!isNaN(dj.byId("dec_amt").get("value"))){m.toggleFields(false,null,["limit_id","booking_amt","facility_id"],true,false);}}m.toggleFields(true,null,["limit_id","booking_amt","facility_id","booking_cur_code"],true,true);}if(dj.byId("inc_amt")&&isNaN(dj.byId("inc_amt").get("value"))&&dj.byId("dec_amt")&&isNaN(dj.byId("dec_amt").get("value"))){m.animate("wipeOut",d.byId("facilityLimitDetail"));}m.populateGridOnLoad("bg");m.setRenewalAmountOnFormLoad();var _38=d.byId("tender-exp-date");if(dj.byId("contract_ref")&&dj.byId("contract_ref").get("value")==="TEND"){m.animate("fadeIn",_38);}else{dj.byId("tender_expiry_date").set("value",null);m.animate("fadeOut",_38);}if(dj.byId("inc_amt").get("value")&&!dj.byId("dec_amt").get("value")){dj.byId("dec_amt").set("disabled",true);}else{if(dj.byId("dec_amt").get("value")&&!dj.byId("inc_amt").get("value")){dj.byId("inc_amt").set("disabled",true);}}var n1=dojo.query("#GTPRootPortlet .portlet-title")[0];var _39=dj.byId("mode");if((_39.get("value")==="DRAFT")&&(n1.innerHTML==="Amend Existing Banker's Guarantee")){if(dj.byId("org_contract_narrative")){dj.byId("contract_narrative").set("value","");}if(dj.byId("org_contract_amt")&&dj.byId("org_contract_cur_code")){dj.byId("contract_amt").set("value","");dj.byId("contract_cur_code").set("value","");}if(dj.byId("org_contract_pct")){dj.byId("contract_pct").set("value","");}}var _3a=dj.byId("org_exp_date");var _3b=dj.byId("exp_date_type_code");if(_3a){if(dj.byId(_3b)){if(_3b.get("value")==="01"){dj.byId("exp_date").set("disabled",true);m.toggleRequired("exp_event",true);}if(_3b.get("value")==="02"){dj.byId("exp_event").set("disabled",true);m.toggleRequired("exp_date",true);}if(_3b.get("value")==="03"){m.toggleRequired("exp_event",true);m.toggleRequired("exp_date",true);}}}},beforeSaveValidations:function(){var _3c=dj.byId("principal_act_no");if(_3c&&_3c.get("value")!=""){if(!m.validatePricipleAccount()){m._config.onSubmitErrorMsg=m.getLocalization("invalidPrincipleAccountError",[_3c.get("displayedValue")]);m.showTooltip(m.getLocalization("invalidPrincipleAccountError",[_3c.get("displayedValue")]),_3c.domNode);_3c.focus();return false;}}var _3d=dj.byId("fee_act_no");if(_3d&&_3d.get("value")!=""){if(!m.validateFeeAccount()){m._config.onSubmitErrorMsg=m.getLocalization("invalidFeeAccountError",[_3d.get("displayedValue")]);m.showTooltip(m.getLocalization("invalidFeeAccountError",[_3d.get("displayedValue")]),_3d.domNode);_3d.focus();return false;}}return true;},beforeSubmitValidations:function(){var _3e=["exp_date","org_exp_date","exp_date_type_code","org_exp_date_type_code","inc_amt","dec_amt","amd_details","file"];var _3f=d.every(_3e,function(id){if(d.byId(id)){return true;}return false;});if(_3f){var _40=["exp_date_type_code"];var _41=d.every(_40,function(id){var _42=dj.byId(id).get("value")+"";var _43=dj.byId("org_"+id).get("value")+"";if(_42=="NaN"||_42=="null"||_42=="undefined"){_42="";}if(_42==_43){return true;}return false;});var _44=["exp_date"];var _45=d.every(_44,function(id){var _46=dj.byId(id).get("value")+"";var _47=d.date.locale.parse(dj.byId("org_"+id).get("displayedValue"),{selector:"date",datePattern:m.getLocalization("g_strGlobalDateFormat")})+"";if(_46==_47){return true;}return false;});var _48=(d.query("#edit [id^='file_row_']").length>1);if(_41&&_45&&!_48&&!dj.byId("inc_amt").get("value")&&!dj.byId("dec_amt").get("value")&&(dj.byId("amd_details").get("value")=="")){m._config.onSubmitErrorMsg=m.getLocalization("noAmendmentError");return false;}}var _49=dj.byId("amd_date");if(_49&&dj.byId("exp_date_type_code")&&dj.byId("exp_date_type_code").get("value")!="01"&&dj.byId("org_exp_date")&&dj.byId("exp_date")&&dj.byId("exp_date").get("value")===null){var _4a=dj.byId("org_exp_date");if(!m.compareDateFields(_49,_4a)){m._config.onSubmitErrorMsg=m.getLocalization("amdDateGreaterThanOldExpiryDate",[_49.get("displayedValue"),_4a.get("displayedValue")]);return false;}}if(dj.byId("inc_amt")&&dj.byId("dec_amt")&&(!isNaN(dj.byId("inc_amt").get("value"))||!isNaN(dj.byId("dec_amt").get("value")))&&dj.byId("limit_review_date")&&dj.byId("facility_date")){if(d.date.compare(dj.byId("limit_review_date").get("value"),new Date(),"date")<0){m._config.onSubmitErrorMsg=m.getLocalization("amendLimitDateExpiry");return false;}}var _4b=dj.byId("projected_expiry_date");var _4c=dj.byId("final_expiry_date");var _4d=dj.byId("exp_date");if(_4c){if(_4d&&_4c&&!m.compareDateFields(_4d,_4c)){m._config.onSubmitErrorMsg=m.getLocalization("finalExpDateLessThanTransactionExpDtError",[_4c.get("displayedValue"),_4d.get("displayedValue")]);m.showTooltip(m.getLocalization("finalExpDateLessThanTransactionExpDtError",[_4c.get("displayedValue"),_4d.get("displayedValue")]),_4c.domNode);_4c.focus();return false;}else{if(_4b&&_4c&&!m.compareDateFields(_4b,_4c)){m._config.onSubmitErrorMsg=m.getLocalization("finalExpDateLessThanProjectedExpDtError",[_4c.get("displayedValue"),_4b.get("displayedValue")]);m.showTooltip(m.getLocalization("finalExpDateLessThanProjectedExpDtError",[_4c.get("displayedValue"),_4b.get("displayedValue")]),_4c.domNode);_4c.focus();return false;}}}var _4e=dj.byId("principal_act_no");if(_4e&&_4e.get("value")!==""){if(!m.validatePricipleAccount()){m._config.onSubmitErrorMsg=m.getLocalization("invalidPrincipleAccountError",[_4e.get("displayedValue")]);m.showTooltip(m.getLocalization("invalidPrincipleAccountError",[_4e.get("displayedValue")]),_4e.domNode);_4e.focus();return false;}}var _4f=dj.byId("fee_act_no");if(_4f&&_4f.get("value")!==""){if(!m.validateFeeAccount()){m._config.onSubmitErrorMsg=m.getLocalization("invalidFeeAccountError",[_4f.get("displayedValue")]);m.showTooltip(m.getLocalization("invalidFeeAccountError",[_4f.get("displayedValue")]),_4f.domNode);_4f.focus();return false;}}return m.validateLSAmtSumAgainstTnxAmt("bg");},beforeSubmit:function(){m.updateSubTnxTypeCode();}});})(dojo,dijit,misys);dojo.require("misys.client.binding.trade.amend_bg_client");}