/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.trade.create_si"]){dojo._hasResource["misys.binding.trade.create_si"]=true;dojo.provide("misys.binding.trade.create_si");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("misys.widget.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.layout.ContentPane");dojo.require("dojo.data.ItemFileReadStore");dojo.require("dijit.layout.TabContainer");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.widget.Collaboration");dojo.require("misys.validation.common");dojo.require("misys.form.common");dojo.require("misys.form.file");dojo.require("misys.form.static_document");dojo.require("misys.binding.trade.create_si_swift");dojo.require("misys.purchaseorder.widget.PurchaseOrder");dojo.require("misys.purchaseorder.widget.PurchaseOrders");dojo.require("misys.purchaseorder.FormPurchaseOrderEvents");(function(d,dj,m){var _1="NOT ALLOWED";var _2="deletegridrecord";function _3(){dj.byId("principal_act_no").set("value","");dj.byId("fee_act_no").set("value","");};d.mixin(m._config,{initReAuthParams:function(){var _4={productCode:"SI",subProductCode:"",transactionTypeCode:"01",entity:dj.byId("entity")?dj.byId("entity").get("value"):"",bankAbbvName:dj.byId("issuing_bank_abbv_name")?dj.byId("issuing_bank_abbv_name").get("value"):"",currency:dj.byId("lc_cur_code")?dj.byId("lc_cur_code").get("value"):"",amount:dj.byId("lc_amt")?m.trimAmount(dj.byId("lc_amt").get("value")):"",es_field1:"",es_field2:""};return _4;},xmlTransform:function(_5){var _6="<si_tnx_record>";if(_5.indexOf(_6)!=-1){var _7=m._config.xmlTagName,_8=_7?["<",_7,">"]:[],_9="</si_tnx_record>",_a="",_b=-1;_a=_5.substring(_6.length,(_5.length-_9.length));if(m._config.swift2018Enabled){var i=0,_c,_d,_e;var _f=["narrative_description_goods","narrative_documents_required","narrative_additional_instructions","narrative_special_beneficiary"];for(var itr=0;itr<4;itr++){_e=itr==0?_a.substring(0,_a.indexOf("<"+_f[itr]+">")):_e.substring(0,_e.indexOf("<"+_f[itr]+">"));_e=_e.concat("<"+_f[itr]+">");if(dj.byId(_f[itr])){_e=_e.concat("<![CDATA[");_e=_e.concat("<issuance>");_e=_e.concat("<sequence>");_e=_e.concat("0");_e=_e.concat("</sequence>");_e=_e.concat("<data>");_e=_e.concat("<datum>");_e=_e.concat("<id>");_e=_e.concat("0");_e=_e.concat("</id>");_e=_e.concat("<verb>");_e=_e.concat("ISSUANCE");_e=_e.concat("</verb>");_e=_e.concat("<text>");_e=_e.concat("]]><![CDATA["+dojo.trim(dj.byId(_f[itr]).get("value")));_e=_e.concat("</text>");_e=_e.concat("</datum>");_e=_e.concat("</data>");_e=_e.concat("</issuance>");_e=_e.concat("]]>");}_e=_e.concat(_a.substring(_a.indexOf("</"+_f[itr]+">"),_a.length));}_8.push(_e);}else{_8.push(_a);}if(_7){_8.push("</",_7,">");}return _8.join("");}else{return _5;}}});d.mixin(m,{bind:function(){m.setValidation("template_id",m.validateTemplateId);m.setValidation("exp_date",m.validateTradeExpiryDate);m.setValidation("pstv_tol_pct",m.validateTolerance);m.setValidation("neg_tol_pct",m.validateTolerance);m.setValidation("max_cr_desc_code",m.validateMaxCreditTerm);m.setValidation("beneficiary_country",m.validateCountry);m.setValidation("last_ship_date",m.validateLastShipmentDate);m.setValidation("lc_cur_code",m.validateCurrency);m.setValidation("renew_for_nb",m.validateRenewFor);m.setValidation("advise_renewal_days_nb",m.validateDaysNotice);m.setValidation("rolling_renewal_nb",m.validateNumberOfRenewals);m.setValidation("rolling_cancellation_days",m.validateCancellationNotice);m.setValidation("lc_cur_code",m.validateCurrency);m.setValidation("fake_total_cur_code",m.validateCurrency);m.setValidation("total_net_cur_code",m.validateCurrency);m.setValidation("line_item_price_cur_code",m.validateCurrency);m.setValidation("line_item_total_net_cur_code",m.validateCurrency);m.setValidation("renewal_calendar_date",m.validateRenewalCalendarDate);m.setValidation("lc_govern_country",m.validateCountry);m.connect("irv_flag","onClick",m.checkIrrevocableFlag);m.connect("ntrf_flag","onClick",m.checkNonTransferableFlag);m.connect("stnd_by_lc_flag","onClick",m.checkStandByFlag);m.connect("cfm_chrg_brn_by_code_1","onClick",m.checkConfirmationCharges);m.connect("cfm_chrg_brn_by_code_2","onClick",m.checkConfirmationCharges);m.connect("cr_avl_by_code_1","onClick",m.togglePaymentDraftAt);m.connect("cr_avl_by_code_1","onClick",m.setDraftTerm);m.connect("cr_avl_by_code_2","onClick",m.togglePaymentDraftAt);m.connect("cr_avl_by_code_2","onClick",m.setDraweeDetailBankName);m.connect("cr_avl_by_code_3","onClick",m.togglePaymentDraftAt);m.connect("cr_avl_by_code_3","onClick",m.setDraweeDetailBankName);m.connect("cr_avl_by_code_4","onClick",m.togglePaymentDraftAt);m.connect("cr_avl_by_code_5","onClick",m.togglePaymentDraftAt);m.connect("cr_avl_by_code_6","onClick",m.togglePaymentDraftAt);if(!misys._config.makeDescOfGoodsMandatory){m.connect("ship_from","onChange",_10);m.connect("part_ship_detl_nosend","onChange",_10);m.connect("tran_ship_detl_nosend","onChange",_10);m.connect("ship_to","onChange",_10);m.connect("ship_loading","onChange",_10);m.connect("ship_discharge","onChange",_10);m.connect("inco_term","onChange",_10);m.connect("last_ship_date","onChange",_10);m.connect("narrative_shipment_period","onChange",_10);}m.connect("cr_avl_by_code_5","onChange",function(){dj.byId("draft_term").set("value","");});m.connect("tenor_type_1","onClick",m.toggleDraftTerm);m.connect("tenor_type_1","onClick",m.setDraftTerm);m.connect("tenor_type_2","onClick",m.toggleDraftTerm);m.connect("tenor_type_3","onClick",m.toggleDraftTerm);m.connect("renew_flag","onClick",m.toggleRenewalDetails);m.connect("ntrf_flag","onClick",m.toggleTransferIndicatorFlag);m.connect("delv_org","onChange",function(){if(this.get("value")==="99"||this.get("value")==="02"){if(this.get("value")==="99"){m.toggleFields((this.get("value")==="99"),null,["delv_org_text"]);m.toggleRequired("delv_org_text",true);dj.byId("delv_org_text").set("value","");}if(this.get("value")==="02"){m.toggleFields((this.get("value")==="02"),null,["delv_org_text"]);m.toggleRequired("delv_org_text",true);dj.byId("delv_org_text").set("value","");}}else{dj.byId("delv_org_text").set("disabled",true);dj.byId("delv_org_text").set("value","");m.toggleRequired("delv_org_text",false);}});m.connect("lc_exp_date_type_code","onChange",function(){m.toggleFields((this.get("value")==="01"||this.get("value")==="02"),null,["exp_date"]);if(this.get("value")==="02"){m.toggleRequired("exp_date",false);m.animate("fadeIn",d.byId("exp-event"));m.toggleRequired("exp_event",true);}else{m.animate("fadeOut",d.byId("exp-event"));dj.byId("exp_event").set("value","");m.toggleRequired("exp_event",false);}});m.connect("delivery_to","onChange",function(){if(this.get("value")===""||this.get("value")==="01"||this.get("value")==="03"){m.toggleFields((this.get("value")===""||this.get("value")==="01"||this.get("value")==="03"),null,["narrative_delivery_to"]);m.toggleRequired("narrative_delivery_to",false);dj.byId("narrative_delivery_to").set("value","");dj.byId("narrative_delivery_to").set("disabled",true);document.getElementById("narrative_delivery_to_img").style.display="none";}else{dj.byId("narrative_delivery_to").set("disabled",false);dj.byId("narrative_delivery_to").set("value","");m.toggleRequired("narrative_delivery_to",true);document.getElementById("narrative_delivery_to_img").style.display="block";}});m.connect("renew_flag","onClick",function(){if(!this.get("checked")){dj.byId("rolling_renewal_nb").set("value","");dj.byId("renew_amt_code_1").set("checked",false);dj.byId("renew_amt_code_2").set("checked",false);}else{if(this.get("checked")){dj.byId("renew_amt_code_2").set("checked",true);}}});m.connect("final_expiry_date","onChange",function(){var _11=dj.byId("exp_date");var _12=dj.byId("projected_expiry_date");var _13=function(){dj.hideTooltip(dj.byId("final_expiry_date").domNode);};var _14=this.get("displayedValue");if(_11&&!m.compareDateFields(_11,this)){this.set("value",null);this.set("state","Error");dj.showTooltip(m.getLocalization("finalExpDateLessThanTransactionExpDtError",[_14,_11.get("displayedValue")]),dj.byId("final_expiry_date").domNode,0);setTimeout(_13,2000);}else{if(_12&&!m.compareDateFields(_12,this)){this.set("value",null);dj.showTooltip(m.getLocalization("finalExpDateLessThanProjectedExpDtError",[_14,_12.get("displayedValue")]),dj.byId("final_expiry_date").domNode,0);setTimeout(_13,2000);}}});m.connect("exp_date","onChange",m.calculateRenewalFinalExpiryDate);m.connect("rolling_renewal_nb","onBlur",m.calculateRenewalFinalExpiryDate);m.connect("renew_on_code","onBlur",m.calculateRenewalFinalExpiryDate);m.connect("renewal_calendar_date","onBlur",m.calculateRenewalFinalExpiryDate);m.connect("renew_for_nb","onBlur",m.calculateRenewalFinalExpiryDate);m.connect("renew_for_period","onBlur",m.calculateRenewalFinalExpiryDate);m.connect("rolling_renew_on_code","onChange",m.calculateRenewalFinalExpiryDate);m.connect("rolling_renew_for_nb","onChange",m.calculateRenewalFinalExpiryDate);m.connect("rolling_renew_for_period","onChange",m.calculateRenewalFinalExpiryDate);m.connect("advise_renewal_flag","onClick",function(){m.toggleFields(this.get("checked"),null,["advise_renewal_days_nb"]);});m.connect("advise_renewal_flag","onChange",function(){m.toggleFields(this.get("checked"),null,["advise_renewal_days_nb"]);});m.connect("rolling_renewal_flag","onClick",function(){m.toggleFields(this.get("checked"),["final_expiry_date"],["rolling_renewal_nb","rolling_cancellation_days","rolling_renew_on_code"]);if(!this.get("checked")){dj.byId("rolling_renew_for_nb").set("value","");dj.byId("rolling_renew_for_period").set("value","");dj.byId("rolling_day_in_month").set("value","");}});m.connect("rolling_renewal_flag","onChange",function(){m.toggleFields(this.get("checked"),["final_expiry_date"],["rolling_renewal_nb","rolling_cancellation_days","rolling_renew_on_code"]);if(!this.get("checked")){dj.byId("rolling_renew_for_nb").set("value","");dj.byId("rolling_renew_for_period").set("value","");dj.byId("rolling_day_in_month").set("value","");}});m.connect("rolling_renewal_nb","onChange",function(){if(dj.byId("rolling_renewal_flag").get("checked")&&d.number.parse(this.get("value"))===1){dj.byId("rolling_renewal_nb").set("state","Error");dj.showTooltip(m.getLocalization("invalidNumberOfRollingRenewals"),dj.byId("rolling_renewal_nb").domNode,0);var _15=function(){dj.hideTooltip(dj.byId("rolling_renewal_nb").domNode);};setTimeout(_15,50000);}});m.connect("rolling_day_in_month","onBlur",function(){if(dj.byId("rolling_day_in_month").get("value")===0){dj.byId("rolling_day_in_month").set("state","Error");dj.showTooltip(m.getLocalization("dayInMonthZeroNotApplicableError"),dj.byId("rolling_day_in_month").domNode,0);var _16=function(){dj.hideTooltip(dj.byId("rolling_day_in_month").domNode);};setTimeout(_16,4500);}});m.connect("rolling_day_in_month","onChange",function(){if(dj.byId("rolling_renew_for_period").get("value")==="D"){this.set("value","");dj.showTooltip(m.getLocalization("dayInMonthNotApplicableForDaysError"),dj.byId("rolling_day_in_month").domNode,0);var _17=function(){dj.hideTooltip(dj.byId("rolling_day_in_month").domNode);};setTimeout(_17,1500);}});m.connect("rolling_renew_for_period","onChange",function(){if(dj.byId("rolling_renew_for_period").get("value")==="D"&&!isNaN(dj.byId("rolling_day_in_month").get("value"))){dj.byId("rolling_day_in_month").set("value","");dj.showTooltip(m.getLocalization("dayInMonthNotApplicableForDaysError"),dj.byId("rolling_renew_for_period").domNode,0);var _18=function(){dj.hideTooltip(dj.byId("rolling_day_in_month").domNode);};setTimeout(_18,1500);}});m.connect("adv_send_mode","onChange",function(){m.toggleFields((this.get("value")=="99"),null,["adv_send_mode_text"]);});m.connect("rolling_renew_on_code","onChange",function(){m.toggleFields(this.get("value")==="03",["rolling_day_in_month"],["rolling_renew_for_nb"],true);if(this.get("value")==="01"){dj.byId("rolling_renew_for_nb").set("value","");dj.byId("rolling_renew_for_period").set("value","");dj.byId("rolling_day_in_month").set("value","");}else{if(dj.byId("rolling_renew_on_code").get("value")==="03"&&dj.byId("rolling_renewal_flag").get("checked")&&dj.byId("renew_for_period").get("value")!==""){dj.byId("rolling_renew_for_period").set("value",dj.byId("renew_for_period").get("value"));}}});m.connect("rolling_renew_for_nb","onBlur",function(){m.validateRollingRenewalFrequency(dj.byId("rolling_renew_for_nb"));});m.connect("renew_for_nb","onBlur",function(){m.validateRollingRenewalFrequency(dj.byId("renew_for_nb"));});m.connect("renew_for_period","onChange",function(){if(dj.byId("rolling_renew_on_code").get("value")==="03"&&dj.byId("rolling_renewal_flag").get("checked")&&dj.byId("renew_for_period").get("value")!==""){dj.byId("rolling_renew_for_period").set("value",dj.byId("renew_for_period").get("value"));}});m.connect("lc_amt","onBlur",function(){m.setTnxAmt(this.get("value"));});m.connect("last_ship_date","onChange",function(){m.toggleDependentFields(this,dj.byId("narrative_shipment_period"),m.getLocalization("shipmentDateOrPeriodExclusivityError"));});m.connect("last_ship_date","onClick",function(){m.toggleDependentFields(this,dj.byId("narrative_shipment_period"),m.getLocalization("shipmentDateOrPeriodExclusivityError"));});m.connect("tenor_maturity_date","onBlur",m.setDraftTerm);m.connect("tenor_days_type","onBlur",m.setDraftTerm);m.connect("tenor_type_details","onBlur",m.setDraftTerm);m.connect("product_type_code","onChange",function(){var _19=d.byId("pro-check-box");if(m._config.provisionalProductTypes[this.get("value")]&&dj.byId("provisional_status")){m.animate("fadeIn",_19);dj.byId("provisional_status").set("checked",true);}else{dj.byId("provisional_status").set("checked",false);m.animate("fadeOut",_19);}});m.connect("lc_cur_code","onChange",function(){m.setCurrency(this,["lc_amt"]);});m.connect("credit_available_with_bank_type","onChange",m.setCreditAvailBy);m.connect("tenor_period","onChange",m.setDraftTerm);m.connect("tenor_from_after","onChange",m.setDraftTerm);m.connect("tenor_days","onChange",m.setDraftTerm);m.connect("tenor_days_type","onChange",function(){m.toggleFields((this.get("value")=="99"),null,["tenor_type_details"]);});m.connect("drawee_details_bank_name","onChange",m.initDraweeFields);m.connect("issuing_bank_abbv_name","onChange",m.populateReferences);m.connect("issuing_bank_abbv_name","onChange",m.updateBusinessDate);if(dj.byId("issuing_bank_abbv_name")){m.connect("entity","onChange",function(){dj.byId("issuing_bank_abbv_name").onChange();});}m.connect("issuing_bank_customer_reference","onChange",m.setApplicantReference);m.connect("part_ship_detl_nosend","onChange",function(){var _1a=this.get("value");dj.byId("part_ship_detl").set("value",this.get("value"));if(m._config.swift2018Enabled){if(_1a==="CONDITIONAL"){d.byId("infoMessagePartialShipment").style.display="block";d.byId("infoMessagePartialShipment").style.paddingLeft="250px";}else{d.byId("infoMessagePartialShipment").style.display="none";}}m.toggleFields(_1a&&_1a!=="ALLOWED"&&_1a!==_1&&_1a!=="NONE",null,["part_ship_detl_text_nosend"]);});m.connect("part_ship_detl_text_nosend","onBlur",function(){var _1b=dj.byId("part_ship_detl_nosend").value;if(_1b==="OTHER"){dj.byId("part_ship_detl").set("value",dj.byId("part_ship_detl_text_nosend").value);}else{dj.byId("part_ship_detl").set("value",dj.byId("part_ship_detl_nosend").value);}});m.connect("tran_ship_detl_nosend","onChange",function(){var _1c=this.get("value");dj.byId("tran_ship_detl").set("value",_1c);if(m._config.swift2018Enabled){if(_1c==="CONDITIONAL"){d.byId("infoMessageTranshipment").style.display="block";d.byId("infoMessageTranshipment").style.paddingLeft="250px";}else{d.byId("infoMessageTranshipment").style.display="none";}}m.toggleFields(_1c&&_1c!=="ALLOWED"&&_1c!==_1&&_1c!=="NONE",null,["tran_ship_detl_text_nosend"]);});m.connect("tran_ship_detl_text_nosend","onBlur",function(){dj.byId("tran_ship_detl").set("value",this.get("value"));});m.connect("renew_on_code","onChange",function(){m.toggleFields(this.get("value")==="02",null,["renewal_calendar_date"]);});m.connect("tenor_days","onFocus",m.setDraftDaysReadOnly);m.connect("tenor_period","onFocus",m.setDraftDaysReadOnly);m.connect("tenor_from_after","onFocus",m.setDraftDaysReadOnly);m.connect("tenor_days_type","onFocus",m.setDraftDaysReadOnly);m.connect("draft_term","onFocus",function(){this.set("readOnly",!dj.byId("cr_avl_by_code_5").get("checked"));});m.connect("narrative_shipment_period","onChange",function(){m.toggleDependentFields(this,dj.byId("last_ship_date"),m.getLocalization("shipmentDateOrPeriodExclusivityError"));});m.connect("narrative_shipment_period","onClick",function(){m.toggleDependentFields(this,dj.byId("last_ship_date"),m.getLocalization("shipmentDateOrPeriodExclusivityError"));});m.connect("eucp_flag","onClick",function(){m.toggleFields(this.get("checked"),null,["eucp_details"]);});m.connect("inco_term","onChange",function(){m.toggleFields(this.get("value"),null,["inco_place"],false,false);});m.connect("inco_term_year","onChange",function(){m.toggleFields(this.get("value"),null,["inco_term"],false,true);});m.connect("adv_send_mode","onChange",function(){m.toggleMT798Fields("issuing_bank_abbv_name");});m.connect("issuing_bank_abbv_name","onChange",function(){m.toggleMT798Fields("issuing_bank_abbv_name");});m.connect("issuing_bank_abbv_name","onChange",function(){if(dj.byId("issuing_bank_abbv_name").get("value")!=""){m.getIncoYear();}});m.connect("inco_term_year","onChange",m.getIncoTerm);m.connect("inco_term_year","onClick",function(){if(dj.byId("issuing_bank_abbv_name").get("value")==""&&(this.store._arrayOfAllItems==undefined||this.store._arrayOfAllItems.length==0)){m.dialog.show("ERROR",m.getLocalization("selectBankToProceed"),"","");}});m.connect("inco_term","onClick",function(){if(dj.byId("issuing_bank_abbv_name").get("value")==""&&(this.store._arrayOfAllItems==undefined||this.store._arrayOfAllItems.length==0)){m.dialog.show("ERROR",m.getLocalization("selectBankToProceed"),"","");}else{if(dj.byId("inco_term_year").get("value")==""&&(this.store._arrayOfAllItems==undefined||this.store._arrayOfAllItems.length==0)){m.dialog.show("ERROR",m.getLocalization("selectIncoYearToProceed"),"","");}}});m.connect("transport_mode_nosend","onChange",function(){var _1d=this.get("value");dj.byId("transport_mode").set("value",_1d);m.toggleFields(_1d&&_1d!=="AIRT"&&_1d!=="SEAT"&&_1d!=="RAIL"&&_1d!=="ROAD"&&_1d!=="MULT",null,["transport_mode_text_nosend"],false,false);});m.connect("transport_mode_text_nosend","onBlur",function(){dj.byId("transport_mode").set("value",this.get("value"));});m.connect("product_type_code","onChange",function(){if(dj.byId("product_type_code").get("value")!=="99"){d.style("product_type_details_row","display","none");}else{d.style("product_type_details_row","display","block");}});m.connect("standby_rule_code","onChange",function(){m.toggleFields((this.get("value")=="99"),null,["standby_rule_other"]);});m.connect("entity_img_label","onClick",_3);m.connect("renew_amt_code_1","onClick",function(){m.setRenewalAmount(this);});m.connect("renew_amt_code_2","onClick",function(){m.setRenewalAmount(this);});m.connect("po_activated","onChange",m.toggleDisableButtons);m.connect("lc_cur_code","onBlur",m.checkLineItemsCurrencyTotalCurrency);m.connect("lc_cur_code","onChange",m.managePOCurrency);m.connect("lc_cur_code","onFocus",m.saveOldPOCurrency);m.connect("line_item_qty_val","onBlur",m.computeLineItemAmount);m.connect("line_item_price_amt","onBlur",m.computeLineItemAmount);m.connect(dj.byId("line_item_qty_unit_measr_code"),"onChange",function(){dj.byId("line_item_price_unit_measr_code").set("value",this.get("value"));});m.connect("line_item_qty_unit_measr_code","onChange",function(){if(dojo.byId("line_item_qty_unit_measr_other_row")){if(this.get("value")==="OTHR"){m.animate("fadeIn","line_item_qty_unit_measr_other_row");dj.byId("line_item_qty_unit_measr_other").set("readOnly",false);m.toggleRequired("line_item_qty_unit_measr_other",true);}else{m.animate("fadeOut","line_item_qty_unit_measr_other_row");dj.byId("line_item_qty_unit_measr_other").set("readOnly",true);dj.byId("line_item_qty_unit_measr_other").set("value","");m.toggleRequired("line_item_qty_unit_measr_other",false);}}});m.connect("fake_total_cur_code","onChange",function(){m.setCurrency(this,["fake_total_amt"]);});m.connect("fake_total_amt","onChange",function(){m.setTnxAmt(this.get("value"));});m.connect("total_net_cur_code","onChange",function(){m.setCurrency(this,["total_net_amt"]);});m.connect("line_item_price_cur_code","onChange",function(){m.setCurrency(this,["line_item_price_amt"]);});m.connect("line_item_total_cur_code","onChange",function(){m.setCurrency(this,["line_item_total_amt"]);});m.connect("line_item_total_net_cur_code","onChange",function(){m.setCurrency(this,["line_item_total_net_amt"]);});m.connect("lc_cur_code","onChange",function(){m.setCurrency(this,["lc_amt"]);});m.connect("lc_amt","onChange",function(){m.setTnxAmt(this.get("value"));});m.connect(dijit.byId("dialogPOSubmit"),"onClick",function(){var _1e=dj.byId("line_item_total_cur_code").get("value");var _1f=dj.byId("line_item_qty_val").get("value");var _20=dj.byId("line_item_qty_unit_measr_code").get("displayedValue");var _21=dj.byId("line_item_price_unit_measr_code").get("displayedValue");var _22=dj.byId("line_item_price_amt").get("value");var _23=dj.byId("line_item_product_name").get("value");var _24="";var _25="";if(dj.byId("line_item_qty_tol_pstv_pct")&&dj.byId("line_item_qty_tol_pstv_pct").get("value")!=null&&!isNaN(dj.byId("line_item_qty_tol_pstv_pct").get("value"))){_24="(Tolerance: +"+dj.byId("line_item_qty_tol_pstv_pct").get("value")+")";}if(dj.byId("line_item_qty_tol_neg_pct")&&dj.byId("line_item_qty_tol_neg_pct").get("value")!=null&&!isNaN(dj.byId("line_item_qty_tol_neg_pct").get("value"))){_25="(Tolerance: -"+dj.byId("line_item_qty_tol_neg_pct").get("value")+")";}if(_1f&&_20&&_21&&_22&&_23){var _26="";_26=dj.byId("narrative_description_goods").get("value");var _27=_26+"\n\r+"+_1f+" "+_20+" of "+_23+"\n\r+"+_24+_25+" at "+_22+" "+_1e+" per "+_21;dj.byId("narrative_description_goods").set("value",_27);}});m.connect(dj.byId("line_item_qty_unit_measr_code"),"onChange",function(){dj.byId("line_item_qty_unit_measr_label").set("value",this.get("displayedValue"));});if(m._config.swift2018Enabled){m._bindSwift2018();}else{m.connect("cfm_inst_code_1","onClick",m.resetConfirmationCharges);m.connect("cfm_inst_code_2","onClick",m.resetConfirmationCharges);m.connect("cfm_inst_code_3","onClick",m.resetConfirmationCharges);}m.connect("applicant_address_line_4","onFocus",function(){m.showTooltip(m.getLocalization("addressLine4ToolTip",[dj.byId("applicant_address_line_4").get("displayedValue"),dj.byId("applicant_address_line_4").get("value")]),d.byId("applicant_address_line_4"),["right"],5000);});m.connect("beneficiary_address_line_4","onFocus",function(){m.showTooltip(m.getLocalization("addressLine4ToolTip",[dj.byId("beneficiary_address_line_4").get("displayedValue"),dj.byId("beneficiary_address_line_4").get("value")]),d.byId("beneficiary_address_line_4"),["right"],5000);});m.connect("credit_available_with_bank_address_line_4","onFocus",function(){m.showTooltip(m.getLocalization("addressLine4ToolTip",[dj.byId("credit_available_with_bank_address_line_4").get("displayedValue"),dj.byId("credit_available_with_bank_address_line_4").get("value")]),d.byId("credit_available_with_bank_address_line_4"),["right"],5000);});m.connect("advising_bank_address_line_4","onFocus",function(){m.showTooltip(m.getLocalization("addressLine4ToolTip",[dj.byId("advising_bank_address_line_4").get("displayedValue"),dj.byId("advising_bank_address_line_4").get("value")]),d.byId("advising_bank_address_line_4"),["right"],5000);});m.connect("advise_thru_bank_address_line_4","onFocus",function(){m.showTooltip(m.getLocalization("addressLine4ToolTip",[dj.byId("advise_thru_bank_address_line_4").get("displayedValue"),dj.byId("advise_thru_bank_address_line_4").get("value")]),d.byId("advise_thru_bank_address_line_4"),["right"],5000);});},onFormLoad:function(){m.setCurrency(dj.byId("lc_cur_code"),["lc_amt"]);var _28=dj.byId("credit_available_with_bank_type");if(_28){_28.onChange(_28.get("value"));}var _29=dj.byId("part_ship_detl_nosend");if(_29){var _2a=_29.get("value");m.toggleFields(_2a&&_2a!=="ALLOWED"&&_2a!==_1&&_2a!=="NONE",null,["part_ship_detl_text_nosend"],true);}var _2b=dj.byId("part_ship_detl");if(_2b&&_2b.get("value")===""){_2b.set("value",_29.get("value"));}var _2c=dj.byId("adv_send_mode");if(_2c){m.toggleFields(_2c.get("value")=="99",null,["adv_send_mode_text"]);}var _2d=dj.byId("tran_ship_detl_nosend");if(_2d){var _2e=_2d.get("value");m.toggleFields(_2e&&_2e!=="ALLOWED"&&_2e!==_1&&_2e!=="NONE",null,["tran_ship_detl_text_nosend"]);}var _2f=dj.byId("tran_ship_detl");if(_2f&&_2f.get("value")===""){_2f.set("value",_2d.get("value"));}var _30=["cr_avl_by_code_1","cr_avl_by_code_2","cr_avl_by_code_3","cr_avl_by_code_4","cr_avl_by_code_5","cr_avl_by_code_6"];var _31=dj.byId("product_type_code");if(_31&&_31.get("value")!=="99"){d.style("product_type_details_row","display","none");}if(dj.byId("stand_by_lc_code")&&dj.byId("stand_by_lc_code").get("value")!=null){dj.byId("product_type_code").set("disabled",true);}if(m._config.swift2018Enabled){m._onFormLoadSwift2018();}d.forEach(_30,function(id){var _32=dj.byId(id);if(_32&&_32.get("checked")){_32.onClick();}});var _33=dj.byId("renew_flag");if(_33){d.hitch(_33,m.toggleRenewalDetails,true)();}var _34=dj.byId("renew_on_code");if(_34){m.toggleFields(_34.get("value")==="02",null,["renewal_calendar_date"],true);}var _35=dj.byId("advise_renewal_flag");if(_35){m.toggleFields(_35.get("checked"),null,["advise_renewal_days_nb"],true);}var _36=dj.byId("rolling_renewal_flag");if(_36){m.toggleFields(_36.get("checked"),["final_expiry_date"],["rolling_renewal_nb","rolling_cancellation_days","rolling_renew_on_code"],true);}var _37=dj.byId("rolling_renew_on_code");if(_37){m.toggleFields(_37.get("value")==="03",["rolling_day_in_month"],["rolling_renew_for_nb"],true);}var _38=dj.byId("eucp_flag");if(_38){m.toggleFields(_38.get("checked"),null,["eucp_details"]);}var _39=dj.byId("tenor_days_type")?dj.byId("tenor_days_type").get("value"):"";if(_39){m.toggleFields(_39==="99",null,["tenor_type_details"],true);m.setDraftTerm();}var _3a=dj.byId("issuing_bank_abbv_name");if(_3a){_3a.onChange();}if(_3a&&_3a.get("value")!==""&&dj.byId("stand_by_lc_code")&&dj.byId("stand_by_lc_code").get("value")!==""){_3a.set("disabled",true);}var _3b=dj.byId("issuing_bank_customer_reference");if(_3b){_3b.onChange();}var _3c=dj.byId("drawee_details_bank_name");if(_3c){_3c.onChange();}var _3d=dj.byId("inco_term")?dj.byId("inco_term").get("value"):"";if(_3d){m.toggleFields(_3d,null,["inco_place"],false,true);}else{m.toggleFields(_3d,null,["inco_place"],false,false);}var _3e=dojo.subscribe(_2,function(){m.toggleFields(m._config.customerBanksMT798Channel[_3a]===true&&m.hasAttachments(),null,["delivery_channel"],false,false);});var _3f=dj.byId("transport_mode_nosend");if(_3f){var _40=_3f.get("value");m.toggleFields(_40&&_40!=="AIRT"&&_40!=="SEAT"&&_40!=="RAIL"&&_40!=="ROAD"&&_40!=="MULT",null,["transport_mode_text_nosend"]);}var _41=dj.byId("transport_mode");if(_41&&_41.get("value")===""){_41.set("value",_3f.get("value"));}var _42=d.byId("pro-check-box");if(m._config.provisionalProductTypes[dj.byId("product_type_code")?dj.byId("product_type_code").get("value"):""]){m.animate("fadeIn",_42);}else{dj.byId("provisional_status")?dj.byId("provisional_status").set("checked",false):"";m.animate("fadeOut",_42);}var _43=dj.byId("standby_rule_code");if(_43){m.toggleFields(_43.get("value")=="99",null,["standby_rule_other"]);}m.setCurrency(dj.byId("total_net_cur_code"),["total_net_amt"]);m.toggleDisableButtons();if(d.byId("line_item_qty_unit_measr_other_row")){m.animate("fadeOut","line_item_qty_unit_measr_other_row");}var _44="line-items";if(dj.byId(_44)&&dj.byId(_44).grid){dj.byId(_44).grid._refresh();}if(m._config.purchase_order_assistant=="true"){m.animate("fadeIn",d.byId(_44));m.animate("fadeIn",d.byId("fake_total_cur_code_row"));m.animate("fadeIn",d.byId("total_net_cur_code_row"));}else{m.animate("fadeOut",d.byId(_44));m.animate("fadeOut",d.byId("fake_total_cur_code_row"));m.animate("fadeOut",d.byId("total_net_cur_code_row"));}m.setRenewalAmountOnFormLoad();if(!misys._config.makeDescOfGoodsMandatory){var _45=dj.byId("ship_from");var _46=dj.byId("ship_loading");var _47=dj.byId("ship_discharge");var _48=dj.byId("ship_to");var _49=dj.byId("inco_term");var _4a=dj.byId("last_ship_date");var _4b=dj.byId("narrative_shipment_period");var _4c=dj.byId("narrative_description_goods");if((_45&&_45.get("value")!=="")||(_46&&_46.get("value")!=="")||(_47&&_47.get("value")!=="")||(_48&&_48.get("value")!=="")||(_49&&_49.get("value")!=="")||(_4a&&_4a.get("value")!==null)||(_4b&&_4b.get("value")!=="")){_4c.set("required",true);}else{_4c.set("required",false);}}if(dj.byId("ntrf_flag")&&dj.byId("narrative_transfer_conditions")){if(dj.byId("ntrf_flag").get("checked")){dj.byId("narrative_transfer_conditions").set("disabled",true);dj.byId("narrative_transfer_conditions").set("value","");document.getElementById("narrative_transfer_conditions_img").style.display="none";}else{dj.byId("narrative_transfer_conditions").set("disabled",false);document.getElementById("narrative_transfer_conditions_img").style.display="block";}}if(dj.byId("lc_exp_date_type_code")&&dj.byId("lc_exp_date_type_code").value=="02"){m.animate("fadeIn",d.byId("exp-event"));m.toggleRequired("exp_event",true);}else{m.animate("fadeOut",d.byId("exp-event"));m.toggleRequired("exp_event",false);}if(dj.byId("delv_org")&&dj.byId("delv_org_text")){if(dj.byId("delv_org").value==="99"||dj.byId("delv_org").value==="02"){dj.byId("delv_org_text").set("disabled",false);m.toggleRequired("delv_org_text",true);}else{dj.byId("delv_org_text").set("disabled",true);m.toggleRequired("delv_org_text",false);}}if(dj.byId("delivery_to")&&dj.byId("narrative_delivery_to")){if(dj.byId("delivery_to").get("value")===""||dj.byId("delivery_to").get("value")==="01"||dj.byId("delivery_to").get("value")==="03"){m.toggleFields((dj.byId("delivery_to").get("value")===""||dj.byId("delivery_to").get("value")==="01"||dj.byId("delivery_to").get("value")==="03"),null,["narrative_delivery_to"]);m.toggleRequired("narrative_delivery_to",false);dj.byId("narrative_delivery_to").set("value","");dj.byId("narrative_delivery_to").set("disabled",true);document.getElementById("narrative_delivery_to_img").style.display="none";}else{if(dj.byId("delivery_to").get("value")!==""){dj.byId("narrative_delivery_to").set("disabled",false);m.toggleRequired("narrative_delivery_to",true);document.getElementById("narrative_delivery_to_img").style.display="block";}}}if(dj.byId("inco_term_year")){m.getIncoYear();dijit.byId("inco_term_year").set("value",dj.byId("org_term_year").get("value"));}if(dj.byId("inco_term")){if(dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!=""&&dj.byId("inco_term_year")&&dj.byId("inco_term_year").get("value")!=""){m.getIncoTerm();}dijit.byId("inco_term").set("value",dj.byId("org_inco_term").get("value"));}},beforeSaveValidations:function(){var _4d=dj.byId("principal_act_no");if(_4d&&_4d.get("value")!==""){if(!m.validatePricipleAccount()){m._config.onSubmitErrorMsg=m.getLocalization("invalidPrincipleAccountError",[_4d.get("displayedValue")]);m.showTooltip(m.getLocalization("invalidPrincipleAccountError",[_4d.get("displayedValue")]),_4d.domNode);_4d.focus();return false;}}var _4e=dj.byId("fee_act_no");if(_4e&&_4e.get("value")!==""){if(!m.validateFeeAccount()){m._config.onSubmitErrorMsg=m.getLocalization("invalidFeeAccountError",[_4e.get("displayedValue")]);m.showTooltip(m.getLocalization("invalidFeeAccountError",[_4e.get("displayedValue")]),_4e.domNode);_4e.focus();return false;}}var _4f=dj.byId("entity");if(_4f&&_4f.get("value")===""){return false;}else{return true;}},beforeSubmitValidations:function(){var _50=true;if(m._config.swift2018Enabled){_50=m._beforeSubmitValidationsSwift2018();if(!_50){return _50;}}var _51=dj.byId("rolling_day_in_month");if(dj.byId("lc_amt")){if(!m.validateAmount((dj.byId("lc_amt"))?dj.byId("lc_amt"):0)){m._config.onSubmitErrorMsg=m.getLocalization("amountcannotzero");dj.byId("lc_amt").set("value","");return false;}}if(_51&&_51.get("value")===0){m._config.onSubmitErrorMsg=m.getLocalization("dayInMonthZeroNotApplicableError");_51.set("value","");return false;}var _52=dj.byId("tenor_type_1"),_53=dj.byId("draft_term");if(_53&&_53.get("value")===""){_53.set("value",document.getElementById("draft_term").innerHTML);}if(_52&&!_52.get("checked")&&!dj.byId("tenor_type_2").get("checked")&&!dj.byId("tenor_type_3").get("checked")&&_53&&_53.get("value")===""){m._config.onSubmitErrorMsg=m.getLocalization("mandatoryPaymentTypeError");m.showTooltip(m.getLocalization("mandatoryPaymentTypeError"),_52.domNode);return false;}var _54=dj.byId("exp_date");var _55=dj.byId("projected_expiry_date");var _56=dj.byId("final_expiry_date");if(_56){if(_54&&!m.compareDateFields(_54,_56)){m._config.onSubmitErrorMsg=m.getLocalization("finalExpDateLessThanTransactionExpDtError",[_56.get("displayedValue"),_54.get("displayedValue")]);m.showTooltip(m.getLocalization("finalExpDateLessThanTransactionExpDtError",[_56.get("displayedValue"),_54.get("displayedValue")]),_56.domNode);return false;}else{if(_55&&!m.compareDateFields(_55,_56)){m._config.onSubmitErrorMsg=m.getLocalization("finalExpDateLessThanProjectedExpDtError",[_56.get("displayedValue"),_55.get("displayedValue")]);m.showTooltip(m.getLocalization("finalExpDateLessThanProjectedExpDtError",[_56.get("displayedValue"),_55.get("displayedValue")]),_56.domNode);return false;}}}if(dj.byId("rolling_renewal_flag")&&dj.byId("rolling_renewal_nb")&&dj.byId("rolling_renewal_flag").get("checked")&&d.number.parse(dj.byId("rolling_renewal_nb").get("value"))===1){dj.byId("rolling_renewal_nb").set("state","Error");m._config.onSubmitErrorMsg=m.getLocalization("invalidNumberOfRollingRenewals");dj.byId("rolling_renewal_nb").set("value"," ");return false;}if(!(m.validateLength(["applicant","beneficiary","credit_available_with_bank","advising_bank","advise_thru_bank"]))){return false;}if(dj.byId("issuing_bank_abbv_name")&&!m.validateApplDate(dj.byId("issuing_bank_abbv_name").get("value"))){m._config.onSubmitErrorMsg=m.getLocalization("changeInApplicationDates");m.goToTop();return false;}var _57=dj.byId("principal_act_no");if(_57&&_57.get("value")!==""){if(!m.validatePricipleAccount()){m._config.onSubmitErrorMsg=m.getLocalization("invalidPrincipleAccountError",[_57.get("displayedValue")]);m.showTooltip(m.getLocalization("invalidPrincipleAccountError",[_57.get("displayedValue")]),_57.domNode);_57.focus();return false;}}var _58=dj.byId("fee_act_no");if(_58&&_58.get("value")!==""){if(!m.validateFeeAccount()){m._config.onSubmitErrorMsg=m.getLocalization("invalidFeeAccountError",[_58.get("displayedValue")]);m.showTooltip(m.getLocalization("invalidFeeAccountError",[_58.get("displayedValue")]),_58.domNode);_58.focus();return false;}}if(dj.byId("issuing_bank_abbv_name")&&!m.validateApplDate(dj.byId("issuing_bank_abbv_name").get("value"))){m._config.onSubmitErrorMsg=m.getLocalization("changeInApplicationDates");m.goToTop();return false;}return true;},generateGTEEFromNew:function(){var _59=m.formToXML();dj.byId("transactiondata_download_project").set("value",_59);dj.byId("gteeName_download_project").set("value",dj.byId("standby_text_type_code").get("value"));dj.byId("company_download_project").set("value",dj.byId("company_name").get("value"));if(dj.byId("entity")){dj.byId("entity_download_project").set("value",dj.byId("entity").get("value"));}if(dj.byId("parent_entity")){dj.byId("parentEntity_download_project").set("value",dj.byId("parent_entity").get("value"));}if(!dj.byId("downloadgteetext")){d.parser.parse();}dj.byId("downloadgteetext").submit();return false;}});function _10(){var _5a=dj.byId("ship_from");var _5b=dj.byId("ship_loading");var _5c=dj.byId("ship_discharge");var _5d=dj.byId("ship_to");var _5e=dj.byId("inco_term");var _5f=dj.byId("last_ship_date");var _60=dj.byId("narrative_shipment_period");var _61=dj.byId("narrative_description_goods");var _62=dj.byId("part_ship_detl_nosend");var _63=dj.byId("tran_ship_detl_nosend");var _64="*";var _65;var _66=dijit.byId(_61.parentTab);if((_5a&&_5a.get("value")!=="")||(_5b&&_5b.get("value")!=="")||(_5c&&_5c.get("value")!=="")||(_5d&&_5d.get("value")!=="")||(_5e&&_5e.get("value")!=="")||(_5f&&_5f.get("value")!==null)||(_62.get("value")=="ALLOWED"||_62.get("value")=="OTHER")||(_63.get("value")=="ALLOWED"||_63.get("value")=="OTHER")){_61.set("required",true);_65=_66.get("title");if((_65.indexOf(_64)===-1)){_64+=" ";_65=_64+_65;_66.set("title",_65);}}else{_61.set("required",false);_65=_66.get("title");if((_65.indexOf(_64)!==-1)){_65=_65.split(_64)[1];if(_65.indexOf("<img")!==-1){_65=_65.substr(0,_65.indexOf("<img"));_66.set("title",_65);}_66.set("title",_65);}}};})(dojo,dijit,misys);dojo.require("misys.client.binding.trade.create_si_client");}