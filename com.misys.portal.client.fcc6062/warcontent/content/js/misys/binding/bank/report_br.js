/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.bank.report_br"]){dojo._hasResource["misys.binding.bank.report_br"]=true;dojo.provide("misys.binding.bank.report_br");dojo.require("dijit.layout.TabContainer");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("misys.form.file");dojo.require("misys.form.addons");dojo.require("misys.form.SimpleTextarea");dojo.require("dijit.Editor");dojo.require("dojo.data.ItemFileReadStore");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("misys.widget.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.layout.ContentPane");dojo.require("misys.editor.plugins.ProductFieldChoice");dojo.require("dojo.data.ItemFileReadStore");dojo.require("dijit.layout.TabContainer");dojo.require("dijit.form.DateTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("misys.form.addons");dojo.require("misys.form.SimpleTextarea");dojo.require("dijit.Editor");dojo.require("dijit._editor.plugins.FontChoice");dojo.require("dojox.editor.plugins.ToolbarLineBreak");dojo.require("misys.widget.Collaboration");dojo.require("misys.binding.trade.ls_common");(function(d,dj,m){var _1="deletegridrecord";m._config=m._config||{};m._config.bgCurCode=m._config.bgCurCode||{};m._config.beneficiary=m._config.beneficiary||{entity:"",name:"",abbvName:"",addressLine1:"",addressLine2:"",dom:""};m._config.expDate=m._config.expDate||{};m._config.renewFlag=m._config.renewFlag||{};m._config.bgTypeCode=m._config.bgTypeCode||{};d.mixin(m._config,{xmlTransform:function(_2){var _3="<br_tnx_record>";if(_2.indexOf(_3)!=-1){var _4=m._config.xmlTagName,_5=_4?["<",_4,">"]:[],_6="</br_tnx_record>",_7="",_8=-1;_7=_2.substring(_3.length,(_2.length-_6.length));_5.push(_7);if(dj.byId("gridLicense")&&dj.byId("gridLicense").store&&dj.byId("gridLicense").store!==null&&dj.byId("gridLicense").store._arrayOfAllItems.length>0){_5.push("<linked_licenses>");dj.byId("gridLicense").store.fetch({query:{REFERENCEID:"*"},onComplete:dojo.hitch(dj.byId("gridLicense"),function(_9,_a){dojo.forEach(_9,function(_b){_5.push("<license>");_5.push("<ls_ref_id>",_b.REFERENCEID,"</ls_ref_id>");_5.push("<bo_ref_id>",_b.BO_REF_ID,"</bo_ref_id>");_5.push("<ls_number>",_b.LS_NUMBER,"</ls_number>");_5.push("<ls_allocated_amt>",_b.LS_ALLOCATED_AMT,"</ls_allocated_amt>");_5.push("<ls_amt>",_b.LS_AMT,"</ls_amt>");_5.push("<ls_os_amt>",_b.LS_OS_AMT,"</ls_os_amt>");_5.push("<converted_os_amt>",_b.CONVERTED_OS_AMT,"</converted_os_amt>");_5.push("<allow_overdraw>",_b.ALLOW_OVERDRAW,"</allow_overdraw>");_5.push("</license>");});})});_5.push("</linked_licenses>");}if(_4){_5.push("</",_4,">");}return _5.join("");}else{return _2;}}});d.mixin(m,{bind:function(){m.setValidation("iss_date",m.validateMOProdIssueDate);m.setValidation("amd_date",m.validateAmendmentDate);m.setValidation("exp_date",m.validateBankExpiryDate);m.setValidation("bg_cur_code",m.validateCurrency);m.setValidation("contract_cur_code",m.validateCurrency);m.setValidation("renew_for_nb",m.validateRenewFor);m.setValidation("advise_renewal_days_nb",m.validateDaysNotice);m.setValidation("rolling_renewal_nb",m.validateNumberOfRenewals);m.setValidation("rolling_cancellation_days",m.validateCancellationNotice);m.setValidation("renewal_calendar_date",m.validateRenewalCalendarDate);m.setValidation("applicant_country",m.validateCountry);m.setValidation("beneficiary_country",m.validateCountry);m.setValidation("alt_applicant_country",m.validateCountry);m.connect("prod_stat_code","onChange",m.validateOutstandingAmount);m.setValidation("contract_date",m.validateContractDate);m.setValidation("tender_expiry_date",m.validateTenderExpiryDate);m.setValidation("contract_pct",m.checkContractPercent);m.connect("prod_stat_code","onChange",function(){var _c=dj.byId("prod_stat_code").get("value"),_d=dj.byId("bg_liab_amt");if(_d&&(_c==="01"||_c==="10"||_c==="06")){_d.set("readOnly",true);_d.set("disabled",true);}else{if(_d){_d.set("readOnly",false);_d.set("disabled",false);}}});m.connect("contract_ref","onChange",function(){var _e=d.byId("tender-exp-date");var _f=dj.byId("tender_expiry_date");if(this.get("value")==="TEND"){m.animate("fadeIn",_e);}else{if(_f){_f.set("value",null);}m.animate("fadeOut",_e);}});m.setValidation("bo_comment",m.bofunction);var _10=["narrative_additional_instructions"];d.forEach(_10,function(id){var _11=dj.byId(id);if(_11){_11.onBlur(_11);}});m.connect("bg_cur_code","onChange",function(){m.setCurrency(this,["bg_amt"]);m.setCurrency(this,["bg_available_amt","bg_liab_amt"]);});m.connect("bg_available_amt","onBlur",function(){if(dj.byId("bg_amt")&&(dj.byId("bg_amt").get("value")<dj.byId("bg_available_amt").get("value"))){var _12=function(){var _13=dijit.byId("bg_available_amt");_13.focus();_13.set("state","Error");};m.dialog.show("ERROR",m.getLocalization("AvailBGamtcanNotMoreThanTranAmt"),"",function(){setTimeout(_12,500);});}});m.connect("bg_amt","onBlur",function(){m.setTnxAmt(this.get("value"));});m.connect("bg_liab_amt","onBlur",function(){if(dj.byId("bg_amt")&&(dj.byId("bg_amt").get("value")<dj.byId("bg_liab_amt").get("value"))){var _14=function(){var _15=dijit.byId("bg_liab_amt");_15.set("state","Error");};m.dialog.show("ERROR",m.getLocalization("BRLiabilityAmountCanNotBeGreaterThanBRTotalAmount"),"",function(){setTimeout(_14,0);});}});m.connect("iss_date_type_code","onChange",function(){m.toggleFields((this.get("value")=="99"),null,["iss_date_type_details"]);});m.connect("exp_date_type_code","onChange",function(){m.toggleFields((this.get("value")!="01"),null,["exp_date"]);});m.connect("issuing_bank_type_code","onChange",function(){m.toggleFields((this.get("value")=="02"),["issuing_bank_address_line_2","issuing_bank_dom"],["issuing_bank_name","issuing_bank_address_line_1"]);});m.connect("bg_type_code","onChange",function(){m.toggleFields((this.get("value")=="99"),null,["bg_type_details"]);});m.connect("bg_text_type_code","onChange",m.toggleGuaranteeText);m.connect("text_language","onChange",function(){m.toggleFields((this.get("value")=="*"),null,["text_language_other"]);});m.connect("contract_cur_code","onChange",function(){m.setCurrency(this,["contract_amt"]);});m.connect("renew_on_code","onChange",m.validateRenewalCalendarDate);m.connect("renew_flag","onClick",m.toggleRenewalDetails);m.connect("renew_flag","onClick",function(){if(!this.get("checked")){dj.byId("rolling_renewal_nb").set("value","");}else{if(!dj.byId("rolling_renewal_flag").get("checked")){dj.byId("rolling_renewal_nb").set("value",m.getLocalization("default_rewnewalNumber"));}}});m.connect("advise_renewal_flag","onClick",function(){m.toggleFields(this.get("checked"),null,["advise_renewal_days_nb"]);});m.connect("advise_renewal_flag","onChange",function(){m.toggleFields(this.get("checked"),null,["advise_renewal_days_nb"]);});m.connect("rolling_renewal_flag","onClick",function(){m.toggleFields(this.get("checked"),["final_expiry_date"],["rolling_renewal_nb","rolling_cancellation_days","rolling_renew_on_code"]);if(!this.get("checked")){dj.byId("rolling_renew_for_nb").set("value","");dj.byId("rolling_renew_for_period").set("value","");dj.byId("rolling_day_in_month").set("value","");if(dj.byId("renew_flag").get("checked")){dj.byId("rolling_renewal_nb").set("value",m.getLocalization("default_rewnewalNumber"));}}});m.connect("rolling_renewal_flag","onChange",function(){m.toggleFields(this.get("checked"),["final_expiry_date"],["rolling_renewal_nb","rolling_cancellation_days","rolling_renew_on_code"]);if(!this.get("checked")){dj.byId("rolling_renew_for_nb").set("value","");dj.byId("rolling_renew_for_period").set("value","");dj.byId("rolling_day_in_month").set("value","");if(dj.byId("renew_flag").get("checked")){dj.byId("rolling_renewal_nb").set("value",m.getLocalization("default_rewnewalNumber"));}}});m.connect("rolling_renewal_nb","onBlur",function(){if(dj.byId("rolling_renewal_flag").get("checked")&&d.number.parse(this.get("value"))===1){m.showTooltip(m.getLocalization("invalidNumberOfRollingRenewals"),this.domNode,["after"]);this.state="Error";this._setStateClass();dj.setWaiState(this.focusNode,"invalid","true");}});m.connect("rolling_day_in_month","onBlur",function(){if(dj.byId("rolling_day_in_month").get("value")===0){dj.byId("rolling_day_in_month").set("state","Error");dj.showTooltip(m.getLocalization("dayInMonthZeroNotApplicableError"),dj.byId("rolling_day_in_month").domNode,0);var _16=function(){dj.hideTooltip(dj.byId("rolling_day_in_month").domNode);};setTimeout(_16,4500);}});m.connect("rolling_day_in_month","onChange",function(){if(dj.byId("rolling_renew_for_period").get("value")==="D"){this.set("value","");dj.showTooltip(m.getLocalization("dayInMonthNotApplicableForDaysError"),dj.byId("rolling_day_in_month").domNode,0);var _17=function(){dj.hideTooltip(dj.byId("rolling_day_in_month").domNode);};setTimeout(_17,10000);}});m.connect("rolling_renew_for_period","onChange",function(){if(dj.byId("rolling_renew_for_period").get("value")==="D"&&!isNaN(dj.byId("rolling_day_in_month").get("value"))){dj.byId("rolling_day_in_month").set("value","");dj.showTooltip(m.getLocalization("dayInMonthNotApplicableForDaysError"),dj.byId("rolling_renew_for_period").domNode,0);var _18=function(){dj.hideTooltip(dj.byId("rolling_day_in_month").domNode);};setTimeout(_18,10000);}});m.connect("rolling_renew_on_code","onChange",function(){m.toggleFields(this.get("value")==="03",["rolling_day_in_month"],["rolling_renew_for_nb"],true);if(this.get("value")==="01"){dj.byId("rolling_renew_for_nb").set("value","");dj.byId("rolling_renew_for_period").set("value","");dj.byId("rolling_day_in_month").set("value","");}else{if(dj.byId("rolling_renew_on_code").get("value")==="03"&&dj.byId("rolling_renewal_flag").get("checked")&&dj.byId("renew_for_period").get("value")!==""){dj.byId("rolling_renew_for_period").set("value",dj.byId("renew_for_period").get("value"));}}});m.connect("rolling_renew_for_nb","onBlur",function(){m.validateRollingRenewalFrequency(dj.byId("rolling_renew_for_nb"));});m.connect("renew_for_nb","onBlur",function(){m.validateRollingRenewalFrequency(dj.byId("renew_for_nb"));});m.connect("renew_for_period","onChange",function(){if(dj.byId("rolling_renew_on_code").get("value")==="03"&&dj.byId("rolling_renewal_flag").get("checked")&&dj.byId("renew_for_period").get("value")!==""){dj.byId("rolling_renew_for_period").set("value",dj.byId("renew_for_period").get("value"));}});m.connect("renew_on_code","onChange",function(){m.toggleFields(this.get("value")==="02",null,["renewal_calendar_date"]);});m.connect("projected_expiry_date","onChange",function(){var _19=dj.byId("exp_date");var _1a=dj.byId("final_expiry_date");var _1b=function(){dj.hideTooltip(dj.byId("projected_expiry_date").domNode);};var _1c=this.get("displayedValue");if(_19&&!m.compareDateFields(_19,this)){this.set("value",null);dj.showTooltip(m.getLocalization("projectedExpDateLessThanTransactionExpDtError",[_1c,_19.get("displayedValue")]),dj.byId("projected_expiry_date").domNode,0);setTimeout(_1b,10000);}else{if(_1a&&!m.compareDateFields(this,_1a)){this.set("value",null);dj.showTooltip(m.getLocalization("projectedExpDateGreaterThanFinalExpDtError",[_1c,_1a.get("displayedValue")]),dj.byId("projected_expiry_date").domNode,0);setTimeout(_1b,10000);}}});m.connect("final_expiry_date","onChange",function(){var _1d=dj.byId("exp_date");var _1e=dj.byId("projected_expiry_date");var _1f=function(){dj.hideTooltip(dj.byId("final_expiry_date").domNode);};var _20=this.get("displayedValue");if(_1d&&!m.compareDateFields(_1d,this)){this.set("value",null);this.set("state","Error");dj.showTooltip(m.getLocalization("finalExpDateLessThanTransactionExpDtError",[_20,_1d.get("displayedValue")]),dj.byId("final_expiry_date").domNode,0);setTimeout(_1f,10000);}else{if(_1e&&!m.compareDateFields(_1e,this)){this.set("value",null);dj.showTooltip(m.getLocalization("finalExpDateLessThanProjectedExpDtError",[_20,_1e.get("displayedValue")]),dj.byId("final_expiry_date").domNode,0);setTimeout(_1f,10000);}}});m.connect("prod_stat_code","onChange",m.toggleProdStatCodeFields);m.connect("prod_stat_code","onChange",function(){var _21=this.get("value");m.toggleFields(_21&&_21!=="01"&&_21!=="18",null,["iss_date","bo_ref_id"]);});m.connect("prod_stat_code","onChange",function(){var _22=dj.byId("prod_stat_code").get("value");if(dj.byId("doc_ref_no")&&(_22==="16"||_22==="24")){dj.byId("doc_ref_no").set("disabled",false);}else{if(dj.byId("doc_ref_no")){dj.byId("doc_ref_no").set("disabled",true);}}if(m._config.enable_to_edit_customer_details_bank_side=="false"&&dj.byId("prod_stat_code")&&dj.byId("prod_stat_code").get("value")!==""&&dj.byId("bg_liab_amt")&&dj.byId("tnx_type_code")&&dj.byId("tnx_type_code").get("value")!=="15"&&dj.byId("tnx_type_code").get("value")!=="13"){m.toggleRequired("bg_liab_amt",false);}});m.connect("contract_cur_code","onBlur",function(){if(dj.byId("contract_cur_code").get("value")!==""||!isNaN(dj.byId("contract_amt").get("value"))){m.toggleRequired("contract_amt",true);m.toggleRequired("contract_cur_code",true);}else{m.toggleRequired("contract_amt",false);m.toggleRequired("contract_cur_code",false);}});m.connect("contract_amt","onBlur",function(){if(dj.byId("contract_cur_code").get("value")!==""||!isNaN(dj.byId("contract_amt").get("value"))){m.toggleRequired("contract_amt",true);m.toggleRequired("contract_cur_code",true);}else{m.toggleRequired("contract_amt",false);m.toggleRequired("contract_cur_code",false);}});m.connect("license_lookup","onClick",function(){m.getLicenses("br");});m.connect("bg_cur_code","onChange",function(){m.clearLicenseGrid(this,m._config.bgCurCode,"bg");});m.connect("entity","onChange",function(){m.clearLicenseGrid(this,m._config.beneficiary,"br");});m.connect("beneficiary_name","onChange",function(){m.clearLicenseGrid(this,m._config.beneficiary,"br");});m.connect("exp_date","onChange",function(){m.clearLicenseGrid(this,m._config.expDate,"br");});m.connect("renew_flag","onClick",function(){m.clearLicenseGrid(this,m._config.renewFlag);});m.connect("bg_type_code","onChange",function(){m.clearLicenseGrid(this,m._config.bgTypeCode);});},onFormLoad:function(){m.setCurrency(dj.byId("bg_cur_code"),["tnx_amt","bg_amt","bg_liab_amt","bg_available_amt"]);if(dj.byId("bg_cur_code")){m.setCurrency(dj.byId("bg_cur_code"),["bg_available_amt","bg_liab_amt"]);}m.setCurrency(dj.byId("contract_cur_code"),["contract_amt"]);m._config.bgCurCode=dj.byId("bg_cur_code")?dj.byId("bg_cur_code").get("value"):"";m._config.beneficiary.entity=dj.byId("entity")?dj.byId("entity").get("value"):"";m._config.beneficiary.abbvName=dj.byId("beneficiary_abbv_name")?dj.byId("beneficiary_abbv_name").get("value"):"";m._config.beneficiary.name=dj.byId("beneficiary_name")?dj.byId("beneficiary_name").get("value"):"";m._config.beneficiary.addressLine1=dj.byId("beneficiary_address_line_1")?dj.byId("beneficiary_address_line_1").get("value"):"";m._config.beneficiary.addressLine2=dj.byId("beneficiary_address_line_2")?dj.byId("beneficiary_address_line_2").get("value"):"";m._config.beneficiary.dom=dj.byId("beneficiary_dom")?dj.byId("beneficiary_dom").get("value"):"";m._config.expDate=dj.byId("exp_date")?dj.byId("exp_date").get("displayedValue"):"";m._config.renewFlag=dj.byId("renew_flag")?dj.byId("renew_flag").get("checked"):"";m._config.bgTypeCode=dj.byId("bg_type_code")?dj.byId("bg_type_code").get("value"):"";var _23=d.byId("tender-exp-date");var _24=dj.byId("tender_expiry_date");var _25=dj.byId("contract_ref");if(_25&&_25.get("value")==="TEND"){m.animate("fadeIn",_23);}else{if(_25){if(_24){_24.set("value",null);}m.animate("fadeOut",_23);}}var _26=dj.byId("iss_date_type_code");if(_26){m.toggleFields((_26.get("value")=="99"),null,["iss_date_type_details"]);}var _27=dj.byId("exp_date_type_code");if(_27){m.toggleFields((_27.get("value")!="01"),null,["exp_date"]);}var _28=dj.byId("issuing_bank_type_code");if(_28){m.toggleFields((_28.get("value")=="02"),["issuing_bank_address_line_2","issuing_bank_dom"],["issuing_bank_name","issuing_bank_address_line_1"]);}var _29=dj.byId("bg_type_code");if(_29){m.toggleFields((_29.get("value")=="99"),null,["bg_type_details"]);}var _2a=dj.byId("text_language");if(_2a){m.toggleFields((_2a.get("value")=="*"),null,["text_language_other"]);}var _2b=dj.byId("bg_text_type_code");if(_2b){_2b.onChange(_2b.get("value"));}var _2c=dj.byId("prod_stat_code"),_2d=dj.byId("bg_liab_amt");if(_2d&&_2c&&(_2c.get("value")==="01"||_2c.get("value")==="10"||_2c.get("value")==="06")){_2d.set("readOnly",true);_2d.set("disabled",true);}else{if(_2d){_2d.set("readOnly",false);_2d.set("disabled",false);}}var _2e=dj.byId("prod_stat_code");if(dj.byId("doc_ref_no")&&_2c&&(_2c.get("value")==="16"||_2c.get("value")==="24")){dj.byId("doc_ref_no").set("disabled",false);}else{if(dj.byId("doc_ref_no")){dj.byId("doc_ref_no").set("disabled",true);}}var _2f=dj.byId("renew_flag");if(_2f){d.hitch(_2f,m.toggleRenewalDetails,true)();m.toggleFields((dj.byId("renew_on_code").get("value")==="02"),null,["renewal_calendar_date"],true);m.toggleFields(dj.byId("advise_renewal_flag").get("checked"),null,["advise_renewal_days_nb"],true);m.toggleFields(dj.byId("rolling_renewal_flag").get("checked"),["final_expiry_date"],["rolling_renewal_nb","rolling_cancellation_days","rolling_renew_on_code"],true);var _30=dj.byId("rolling_renew_on_code");if(_30){m.toggleFields(_30.get("value")==="03",["rolling_day_in_month"],["rolling_renew_for_nb"],true);}}var _31=dj.byId("renew_on_code");if(_31){m.toggleFields(_31.get("value")==="02",null,["renewal_calendar_date"],true);}var _32=dj.byId("advise_renewal_flag");if(_32){m.toggleFields(_32.get("checked"),null,["advise_renewal_days_nb"],true);}m.populateGridOnLoad("bg");if(dj.byId("tnx_type_code")&&(dj.byId("tnx_type_code").get("value")==="15"||(dj.byId("tnx_type_code").get("value")==="13"))&&(m._config.enable_to_edit_customer_details_bank_side=="false")){dojo.style("transactionDetails","display","none");}else{if(m._config.enable_to_edit_customer_details_bank_side=="false"&&dojo.byId("release_dttm_view_row")){dojo.style("transactionDetails","display","none");var _33=["bg_liab_amt"];d.forEach(_33,function(id){var _34=dj.byId(id);if(_34){m.toggleRequired(_34,false);}});}}},beforeSubmitValidations:function(){if(dj.byId("bg_amt")){if(!m.validateAmount((dj.byId("bg_amt"))?dj.byId("bg_amt"):0)){m._config.onSubmitErrorMsg=m.getLocalization("amountcannotzero");dj.byId("bg_amt").set("value","");return false;}}if(dj.byId("bg_amt")&&dj.byId("bg_available_amt")&&(dj.byId("bg_amt").get("value")<dj.byId("bg_available_amt").get("value"))){m._config.onSubmitErrorMsg=m.getLocalization("AvailBGamtcanNotMoreThanTranAmt");dj.byId("bg_available_amt").set("value","");return false;}if(dj.byId("rolling_renewal_flag")&&dj.byId("rolling_renewal_nb")&&dj.byId("rolling_renewal_flag").get("checked")&&d.number.parse(dj.byId("rolling_renewal_nb").get("value"))===1){m._config.onSubmitErrorMsg=m.getLocalization("invalidNumberOfRollingRenewals");dj.byId("rolling_renewal_nb").focus();return false;}if(dj.byId("bg_amt")&&dj.byId("bg_liab_amt")&&(dj.byId("bg_amt").get("value")<dj.byId("bg_liab_amt").get("value"))){m._config.onSubmitErrorMsg=m.getLocalization("BRLiabilityAmountCanNotBeGreaterThanBRTotalAmount");dj.byId("bg_liab_amt").set("value","");return false;}if(!(m.validateLength(["beneficiary","applicant","advising_bank","issuing_bank","confirming_bank"]))){return false;}return m.validateLSAmtSumAgainstTnxAmt("bg");}});})(dojo,dijit,misys);dojo.require("misys.client.binding.bank.report_br_client");}