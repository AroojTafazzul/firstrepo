/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.bank.report_ft_tint"]){dojo._hasResource["misys.binding.bank.report_ft_tint"]=true;dojo.provide("misys.binding.bank.report_ft_tint");dojo.require("dojo.parser");dojo.require("dijit.layout.TabContainer");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("misys.widget.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("misys.form.PercentNumberTextBox");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.widget.Collaboration");dojo.require("misys.form.common");dojo.require("misys.form.file");dojo.require("misys.form.addons");dojo.require("misys.validation.common");dojo.require("misys.binding.cash.ft_common");dojo.require("misys.binding.trade.ls_common");dojo.require("misys.form.BusinessDateTextBox");dojo.require("misys.binding.common.create_fx");(function(d,dj,m){var _1=d.byId("fx-message-type");function _2(_3){var _4=function(){var _5=dijit.byId("ft_amt");_5.set("state","Error");m.defaultBindTheFXTypes();dj.byId("ft_amt").set("value","");if(dj.byId("ft_cur_code")&&!dj.byId("ft_cur_code").get("readOnly")){dj.byId("ft_cur_code").set("value","");}};m.dialog.show("ERROR",_3,"",function(){setTimeout(_4,500);});if(d.byId("fx-section")&&(d.style(d.byId("fx-section"),"display")!=="none")){m.animate("wipeOut",d.byId("fx-section"));}};d.mixin(m._config,{xmlTransform:function(_6){var _7="<ft_tnx_record>";if(_6.indexOf(_7)!==-1){var _8=m._config.xmlTagName,_9=_8?["<",_8,">"]:[],_a="</ft_tnx_record>",_b="";_b=_6.substring(_7.length,(_6.length-_a.length));_9.push(_b);if(dj.byId("gridLicense")&&dj.byId("gridLicense").store&&dj.byId("gridLicense").store!==null&&dj.byId("gridLicense").store._arrayOfAllItems.length>0){_9.push("<linked_licenses>");dj.byId("gridLicense").store.fetch({query:{REFERENCEID:"*"},onComplete:dojo.hitch(dj.byId("gridLicense"),function(_c,_d){dojo.forEach(_c,function(_e){_9.push("<license>");_9.push("<ls_ref_id>",_e.REFERENCEID,"</ls_ref_id>");_9.push("<bo_ref_id>",_e.BO_REF_ID,"</bo_ref_id>");_9.push("<ls_number>",_e.LS_NUMBER,"</ls_number>");_9.push("<ls_allocated_amt>",_e.LS_ALLOCATED_AMT,"</ls_allocated_amt>");_9.push("<ls_amt>",_e.LS_AMT,"</ls_amt>");_9.push("<ls_os_amt>",_e.LS_OS_AMT,"</ls_os_amt>");_9.push("<converted_os_amt>",_e.CONVERTED_OS_AMT,"</converted_os_amt>");_9.push("<allow_overdraw>",_e.ALLOW_OVERDRAW,"</allow_overdraw>");_9.push("</license>");});})});_9.push("</linked_licenses>");}if(_8){_9.push("</",_8,">");}return _9.join("");}else{return _6;}}});d.mixin(m._config,{initReAuthParams:function(){var _f={productCode:"FT",subProductCode:dj.byId("sub_product_code").get("value"),transactionTypeCode:"15",entity:dj.byId("entity")?dj.byId("entity").get("value"):"",currency:dj.byId("ft_cur_code").get("value"),amount:m.trimAmount(dj.byId("ft_amt").get("value")),es_field1:m.trimAmount(dj.byId("ft_amt").get("value")),es_field2:(dj.byId("beneficiary_account"))?dj.byId("beneficiary_account").get("value"):""};return _f;}});d.mixin(m,{fireFXAction:function(){if(m._config.fxParamData&&dj.byId("sub_product_code")&&dj.byId("sub_product_code").get("value")!==""){var _10=m._config.fxParamData[dj.byId("sub_product_code").get("value")];if(m._config.fxParamData&&_10.fxParametersData.isFXEnabled==="Y"){var _11,_12;var _13="";if(dj.byId("ft_cur_code")){_13=dj.byId("ft_cur_code").get("value");}var _14=dj.byId("ft_amt").get("value");var _15=dj.byId("applicant_act_cur_code").get("value");var _16=m._config.productCode;var _17="";if(dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""){_17=dj.byId("issuing_bank_abbv_name").get("value");}var _18=dj.byId("applicant_act_cur_code").get("value");var _19=dj.byId("beneficiary_act_cur_code");var _1a=false;if(_13!==""&&!isNaN(_14)&&_16!==""&&_17!==""){if(_13!==_15){_11=_15;_12=_13;_18=_15;}else{if(_18&&_18!==""&&_13&&_13!==""&&_18===_13&&(_19&&_19.get("value")!==""&&_13!==_19.get("value"))){_1a=true;_11=_13;_12=_19.get("value");_18=_12;}}if(_11&&_11!==""&&_12&&_12!==""){if(d.byId("fx-section")&&(d.style(d.byId("fx-section"),"display")==="none")){m.animate("wipeIn",d.byId("fx-section"));}m.fetchFXDetails(_11,_12,_14,_16,_17,_18,_1a);if(dj.byId("fx_rates_type_1")&&dj.byId("fx_rates_type_1").get("checked")){if(isNaN(dj.byId("fx_exchange_rate").get("value"))||dj.byId("fx_exchange_rate_cur_code").get("value")===""||isNaN(dj.byId("fx_exchange_rate_amt").get("value"))||(m._config.fxParamData[dj.byId("sub_product_code").get("value")].fxParametersData.toleranceDispInd==="Y"&&(isNaN(dj.byId("fx_tolerance_rate").get("value"))||isNaN(dj.byId("fx_tolerance_rate_amt").get("value"))||dj.byId("fx_tolerance_rate_cur_code").get("value")===""))){_2(m.getLocalization("FXDefaultErrorMessage"));}}}else{if(d.byId("fx-section")&&(d.style(d.byId("fx-section"),"display")!=="none")){m.animate("wipeOut",d.byId("fx-section"));}m.defaultBindTheFXTypes();}}if(dj.byId("recurring_payment_enabled")&&dj.byId("recurring_payment_enabled").get("checked")&&dj.byId("fx_rates_type_2")){dj.byId("fx_rates_type_2").set("disabled",true);m.animate("wipeOut",d.byId("contracts_div"));}}}},bind:function(){m.setValidation("iss_date",m.validateTransferDateCustomer);m.connect("license_lookup","onClick",function(){m.getLicenses("ft");});dj.byId("sub_product_code").set("value","TINT");m.bindRecurringFields();m.setValidation("bo_comment",m.bofunction);m.connect("prod_stat_code","onChange",m.populateReportingStatus);m.connect("prod_stat_code","onChange",function(){if(dj.byId("mode")&&dj.byId("mode").get("value")!=="RELEASE"){var _1b=this.get("value");m.toggleFields(_1b&&_1b!=="01"&&_1b!=="18",null,["bo_ref_id"]);}});m.connect("ft_cur_code","onChange",function(){m.setCurrency(this,["ft_amt"]);});m.connect("entity","onChange",function(){m.setApplicantReference();dj.byId("applicant_act_name").set("value","");});m.connect("recurring_flag","onClick",m.showRecurring);var _1c=dj.byId("sub_product_code").get("value");if(m._config.fxParamData&&m._config.fxParamData[_1c].fxParametersData.isFXEnabled==="Y"){m.connect("ft_cur_code","onChange",function(){m.setCurrency(this,["ft_amt"]);if(dj.byId("ft_cur_code").get("value")!==""&&!isNaN(dj.byId("ft_amt").get("value"))){m.fireFXAction();}else{m.defaultBindTheFXTypes();}});m.connect("ft_amt","onBlur",function(){m.setTnxAmt(this.get("value"));var _1d="";if(dj.byId("ft_cur_code")){_1d=dj.byId("ft_cur_code").get("value");}if(!isNaN(dj.byId("ft_amt").get("value"))&&_1d!==""){m.fireFXAction();}else{m.defaultBindTheFXTypes();}});}else{if(d.byId("fx-section")&&dj.byId("fx_rates_type_1")&&!dj.byId("fx_rates_type_1").get("checked")&&dj.byId("fx_rates_type_2")&&!dj.byId("fx_rates_type_2").get("checked")){d.style("fx-section","display","none");}}},onFormLoad:function(){m.populateReportingStatus();m.populateGridOnLoad("ft");m.setCurrency(dj.byId("ft_cur_code"),["ft_amt"]);m.initForm();if(dj.byId("mode")&&dj.byId("mode").get("value")!=="RELEASE"){m.toggleFields(dj.byId("prod_stat_code").get("value")&&dj.byId("prod_stat_code").get("value")!=="01"&&dj.byId("prod_stat_code").get("value")!=="18",null,["bo_ref_id"]);}if(dj.byId("recurring_payment_enabled")&&dj.byId("recurring_payment_enabled").get("checked")){m.showSavedRecurringDetails(false);}else{if(d.byId("recurring_payment_div")){d.style("recurring_payment_div","display","none");}m.showSavedRecurringDetails(false);}if(dj.byId("applicant_act_product_types")&&dj.byId("applicant_act_no").get("value")!==""){m.toggleRequired("applicant_act_product_types",false);}var _1e=dj.byId("applicant_act_cur_code");var _1f=dj.byId("beneficiary_act_cur_code");var _20=dj.byId("ft_cur_code");if(m._config.fxParamData&&dj.byId("sub_product_code")&&dj.byId("sub_product_code").get("value")!==""){m.initializeFX(dj.byId("sub_product_code").get("value"));if(_1e&&_1e.get("value")!==""&&_20&&_20.get("value")!==""&&(_1e.get("value")!==_20.get("value")||_20.get("value")!==_1f.get("value"))){m.onloadFXActions();}else{m.defaultBindTheFXTypes();}}else{m.animate("fadeOut",_1);}if(d.byId("fx-section")){if(dj.byId("bulk_ref_id")&&dj.byId("ft_cur_code")&&dj.byId("ft_amt")&&dj.byId("bulk_ref_id").get("value")!==""&&dj.byId("ft_cur_code").get("value")!==""&&!isNaN(dj.byId("ft_amt").get("value"))){m.initializeFX(dj.byId("sub_product_code").get("value"));m.fireFXAction();}else{if((dj.byId("fx_exchange_rate_cur_code")&&dj.byId("fx_exchange_rate_cur_code").get("value")!=="")||(dj.byId("fx_total_utilise_cur_code")&&dj.byId("fx_total_utilise_cur_code").get("value")!=="")||((dj.byId("fx_rates_type_1")&&dj.byId("fx_rates_type_1").get("checked"))||(dj.byId("fx_rates_type_2")&&dj.byId("fx_rates_type_2").get("checked")))){m.animate("wipeIn",d.byId("fx-section"));}else{d.style("fx-section","display","none");}}}},initForm:function(){dj.byId("sub_product_code").set("value","TINT");}});})(dojo,dijit,misys);dojo.require("misys.client.binding.bank.report_ft_tint_client");}