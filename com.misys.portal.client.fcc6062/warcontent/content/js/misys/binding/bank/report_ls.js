/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.bank.report_ls"]){dojo._hasResource["misys.binding.bank.report_ls"]=true;dojo.provide("misys.binding.bank.report_ls");dojo.require("dijit.layout.TabContainer");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("misys.widget.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.widget.Collaboration");dojo.require("misys.form.common");dojo.require("misys.form.file");dojo.require("misys.validation.common");dojo.require("misys.binding.SessionTimer");dojo.require("misys.form.addons");(function(d,dj,m){d.mixin(m,{bind:function(){m.setValidation("template_id",m.validateTemplateId);m.setValidation("pstv_tol_pct",m.validateTolerance);m.setValidation("neg_tol_pct",m.validateTolerance);m.setValidation("ls_cur_code",m.validateCurrency);m.setValidation("beneficiary_country",m.validateCountry);m.setValidation("iss_date",m.validateIssueDate);m.setValidation("valid_from_date",m.validateValidFromDate);m.setValidation("valid_to_date",m.validateValidToDate);m.setValidation("latest_payment_date",m.validateLatestPaymentDate);m.setValidation("origin_country",m.validateCountry);m.setValidation("supply_country",m.validateCountry);m.setValidation("bo_comment",m.bofunction);m.connect("ls_cur_code","onChange",function(){dj.byId("additional_cur_code").set("value",this.get("value"));dj.byId("total_cur_code").set("value",this.get("value"));m.setCurrency(this,["ls_amt","additional_amt","total_amt","ls_liab_amt"]);});m.connect("prod_stat_code","onChange",m.validateOutstandingAmount);m.connect(dj.byId("prod_stat_code"),"onChange",function(){this.validate();});m.connect("prod_stat_code","onChange",function(){var _1=dj.byId("prod_stat_code").get("value"),_2=dj.byId("ls_liab_amt");if(_2&&(_1==="01"||_1==="10"||_1==="06")){_2.set("readOnly",true);_2.set("disabled",true);m.toggleRequired("ls_liab_amt",false);dj.byId("ls_liab_amt").set("value","");}else{if(_2){_2.set("readOnly",false);_2.set("disabled",false);if(!(dj.byId("mode")&&dj.byId("mode").get("value")==="RELEASE")){m.toggleRequired("ls_liab_amt",true);}dj.byId("ls_liab_amt").set("value","");}}});m.connect("issuing_bank_abbv_name","onChange",m.populateReferences);if(dj.byId("issuing_bank_abbv_name")){m.connect("entity","onChange",function(){dj.byId("issuing_bank_abbv_name").onChange();});}m.connect("issuing_bank_customer_reference","onChange",m.setApplicantReference);m.connect("inco_term_year","onChange",function(){m.toggleFields(this.get("value"),null,["inco_term"],false,true);});m.connect("inco_term","onChange",function(){m.toggleFields(this.get("value"),null,["inco_place"],false,false);});m.connect("inco_term_year","onChange",m.getIncoTerm);m.connect("ls_amt","onBlur",function(){m.calculateTotalAmt();});m.connect("additional_amt","onBlur",function(){if(dj.byId("narrative_additional_amount")&&(this.get("value")!==""&&!isNaN(this.get("value"))&&this.get("value")!==0)){dj.byId("narrative_additional_amount").set("disabled",false);m.toggleRequired("narrative_additional_amount",true);dojo.byId("narrative_additional_amount_img").style.display="block";dijit.byId("narrative_additional_amount_img").set("disabled",false);}else{dj.byId("narrative_additional_amount").set("disabled",true);dj.byId("narrative_additional_amount").set("value","");m.toggleRequired("narrative_additional_amount",false);dojo.byId("narrative_additional_amount_img").style.display="none";dijit.byId("narrative_additional_amount_img").set("disabled",true);}m.calculateTotalAmt();});m.connect("valid_from_date","onChange",m.setValidToDate);m.connect("valid_for_nb","onBlur",m.setValidToDate);m.connect("valid_for_nb","onBlur",function(){if(dj.byId("valid_for_period")&&(this.get("value")!==""&&!isNaN(this.get("value")))){dj.byId("valid_for_period").set("disabled",false);dj.byId("valid_for_period").set("required",true);}else{dj.byId("valid_for_period").set("disabled",true);dj.byId("valid_for_period").set("required",false);dj.byId("valid_for_period").set("value","");}});m.connect("valid_for_period","onChange",m.setValidToDate);m.connect("ls_liab_amt","onBlur",function(){if(dj.byId("total_amt")&&(dj.byId("total_amt").get("value")<dj.byId("ls_liab_amt").get("value"))){var _3=function(){var _4=dijit.byId("ls_liab_amt");_4.set("state","Error");};m.dialog.show("ERROR",m.getLocalization("licenseLiabilityAmountCanNotBeGreaterThanLicenseTotalAmount"),"",function(){setTimeout(_3,500);});}});m.connect("prod_stat_code","onChange",function(){if(m._config.enable_to_edit_customer_details_bank_side=="false"&&dj.byId("prod_stat_code")&&dj.byId("prod_stat_code").get("value")!==""){if(dj.byId("ls_liab_amt")&&dj.byId("tnx_type_code")&&dj.byId("tnx_type_code").get("value")!=="15"&&dj.byId("tnx_type_code").get("value")!=="13"){m.toggleRequired("ls_liab_amt",false);}}});m.connect("prod_stat_code","onChange",m.toggleProdStatCodeFields);m.connect("prod_stat_code","onChange",function(){var _5=this.get("value");m.toggleFields(_5&&_5!=="01"&&_5!=="18",["action_req_code"],["iss_date","bo_ref_id"]);if(dj.byId("mode")&&dj.byId("mode").get("value")==="RELEASE"){m.toggleRequired("bo_ref_id",false);m.toggleRequired("iss_date",false);m.toggleRequired("ls_liab_amt",false);}if(dj.byId("prod_stat_code")&&dj.byId("prod_stat_code").get("value")==="08"){dj.byId("ls_clear").set("checked",true);m.animate("fadeIn",d.byId("clear-check-box"));}else{dj.byId("ls_clear").set("checked",false);m.animate("fadeOut",d.byId("clear-check-box"));}});m.connect("ls_amt","onBlur",function(){if(dj.byId("org_ls_amt")&&dj.byId("tnx_type_code").get("value")==="13"&&dj.byId("sub_tnx_type_code").get("value")==="25"){var _6=d.number.parse(dj.byId("ls_amt").get("value"));var _7=d.number.parse(dj.byId("org_ls_amt").get("value"));_6=!isNaN(_6)?_6:0;_7=!isNaN(_7)?_7:0;if(_6>_7){m.showTooltip(m.getLocalization("lsAmtGreaterThanMasterLSAmtError",[_6,_7]),this.domNode,["after"]);this.state="Error";this._setStateClass();dj.setWaiState(this.focusNode,"invalid","true");}}});m.connect("additional_amt","onBlur",function(){if(dj.byId("org_additional_amt")&&dj.byId("tnx_type_code").get("value")==="13"&&dj.byId("sub_tnx_type_code").get("value")==="25"){var _8=d.number.parse(dj.byId("additional_amt").get("value"));var _9=d.number.parse(dj.byId("org_additional_amt").get("value"));_8=!isNaN(_8)?_8:0;_9=!isNaN(_9)?_9:0;if(_8>_9){m.showTooltip(m.getLocalization("lsAddAmtGreaterThanMasterLSAddAmtError",[_8,_9]),this.domNode,["after"]);this.state="Error";this._setStateClass();dj.setWaiState(this.focusNode,"invalid","true");}}});},calculateTotalAmt:function(){if(dj.byId("additional_amt")&&dj.byId("ls_amt")&&dj.byId("total_amt")){var _a=isNaN(dj.byId("additional_amt").get("value"))?0:dj.byId("additional_amt").get("value");var _b=isNaN(dj.byId("ls_amt").get("value"))?0:dj.byId("ls_amt").get("value");dj.byId("total_amt").set("value",_b+_a);}},setValidToDate:function(){var _c=dj.byId("valid_from_date"),_d=dj.byId("valid_for_nb"),_e=dj.byId("valid_for_period"),_f=dj.byId("valid_to_date"),_10=null,_11=true;if(_c&&(_c.get("value")===null||_c.get("value")==="")){_11=false;}if(_d&&(_d.get("value")===null||_d.get("value")===""||isNaN(_d.get("value")))){_11=false;}if(_e&&(_e.get("value")===null||_e.get("value")==="")){_11=false;}if(_f&&_11){switch(_e.get("value")){case "01":_10=d.date.add(_c.get("value"),"day",_d.get("value"));break;case "02":_10=d.date.add(_c.get("value"),"week",_d.get("value"));break;case "03":_10=d.date.add(_c.get("value"),"month",_d.get("value"));break;case "04":_10=d.date.add(_c.get("value"),"year",_d.get("value"));break;default:break;}_f.set("value",_10);}},onFormLoad:function(){m.setCurrency(dj.byId("ls_cur_code"),["ls_amt","additional_amt","total_amt","ls_liab_amt"]);if(dj.byId("mode")&&dj.byId("mode").get("value")==="RELEASE"){m.toggleRequired("iss_date",false);m.toggleRequired("ls_liab_amt",false);}if(dj.byId("ls_cur_code")&&dj.byId("ls_cur_code").get("value")!==""){dj.byId("additional_cur_code").set("value",dj.byId("ls_cur_code").get("value"));dj.byId("total_cur_code").set("value",dj.byId("ls_cur_code").get("value"));}m.calculateTotalAmt();if(dj.byId("additional_amt")&&dj.byId("narrative_additional_amount")&&dj.byId("additional_amt").get("value")!==""&&!isNaN(dj.byId("additional_amt").get("value"))&&dj.byId("additional_amt").get("value")!==0){dj.byId("narrative_additional_amount").set("disabled",false);m.toggleRequired("narrative_additional_amount",true);if(d.byId("narrative_additional_amount_img")){dojo.byId("narrative_additional_amount_img").style.display="block";dijit.byId("narrative_additional_amount_img").set("disabled",false);}}else{dj.byId("narrative_additional_amount").set("disabled",true);dj.byId("narrative_additional_amount").set("value","");m.toggleRequired("narrative_additional_amount",false);if(d.byId("narrative_additional_amount_img")){dojo.byId("narrative_additional_amount_img").style.display="none";dijit.byId("narrative_additional_amount_img").set("disabled",true);}}if(dj.byId("valid_for_nb")&&dj.byId("valid_for_period")&&dj.byId("valid_for_nb").get("value")!==""&&!isNaN(dj.byId("valid_for_nb").get("value"))){dj.byId("valid_for_period").set("disabled",false);dj.byId("valid_for_period").set("required",true);}else{dj.byId("valid_for_period").set("disabled",true);dj.byId("valid_for_period").set("required",false);}var _12=dj.byId("issuing_bank_abbv_name");if(_12){_12.onChange();}var _13=dj.byId("issuing_bank_customer_reference");if(_13){_13.onChange();}var _14=dj.byId("inco_term")?dj.byId("inco_term").get("value"):"";if(_14){m.toggleFields(_14,null,["inco_place"],false,true);}else{m.toggleFields(_14,null,["inco_place"],false,false);}if(dj.byId("prod_stat_code").get("value")==="01"){m.toggleFields(false,["action_req_code"],["iss_date","bo_ref_id"]);m.toggleRequired("bo_ref_id",false);}var _15=dj.byId("prod_stat_code").get("value"),_16=dj.byId("ls_liab_amt");if(_16&&(_15==="01"||_15==="10"||_15==="06")){_16.set("readOnly",true);_16.set("disabled",true);}else{if(_16){_16.set("readOnly",false);_16.set("disabled",false);}}m.toggleProdStatCodeFields();if(dj.byId("tnx_type_code").get("value")==="13"&&dj.byId("sub_tnx_type_code").get("value")==="25"){if(dj.byId("org_ls_amt")){var _17=d.number.parse(dj.byId("ls_amt").get("value"));var _18=d.number.parse(dj.byId("org_ls_amt").get("value"));_17=!isNaN(_17)?_17:0;_18=!isNaN(_18)?_18:0;if(_17>_18){m.showTooltip(m.getLocalization("lsAmtGreaterThanMasterLSAmtError",[_17,_18]),dj.byId("ls_amt").domNode,["after"]);dj.byId("ls_amt").state="Error";dj.byId("ls_amt")._setStateClass();dj.setWaiState(dj.byId("ls_amt").focusNode,"invalid","true");}}if(dj.byId("org_additional_amt")){var _19=d.number.parse(dj.byId("additional_amt").get("value"));var _1a=d.number.parse(dj.byId("org_additional_amt").get("value"));_19=!isNaN(_19)?_19:0;_1a=!isNaN(_1a)?_1a:0;if(_19>_1a){m.showTooltip(m.getLocalization("lsAddAmtGreaterThanMasterLSAddAmtError",[_19,_1a]),dj.byId("additional_amt").domNode,["after"]);dj.byId("additional_amt").state="Error";dj.byId("additional_amt")._setStateClass();dj.setWaiState(dj.byId("additional_amt").focusNode,"invalid","true");}}}if(dj.byId("prod_stat_code")&&dj.byId("prod_stat_code").get("value")==="08"){m.animate("fadeIn",d.byId("clear-check-box"));}else{m.animate("fadeOut",d.byId("clear-check-box"));}if(dj.byId("tnx_type_code")&&(dj.byId("tnx_type_code").get("value")==="15"||(dj.byId("tnx_type_code").get("value")==="13"))&&(m._config.enable_to_edit_customer_details_bank_side=="false")){dojo.style("transactionDetails","display","none");}else{if(m._config.enable_to_edit_customer_details_bank_side=="false"&&dojo.byId("release_dttm_view_row")){dojo.style("transactionDetails","display","none");}}if(dj.byId("inco_term_year")){m.getIncoYear();dijit.byId("inco_term_year").set("value",dj.byId("org_term_year").get("value"));}if(dj.byId("inco_term")){if(dj.byId("inco_term_year")&&dj.byId("inco_term_year").get("value")!=""){m.getIncoTerm();}dijit.byId("inco_term").set("value",dj.byId("org_inco_term").get("value"));}},beforeSaveValidations:function(){if(dj.byId("sub_tnx_type_code")&&dj.byId("ls_clear")){if(dj.byId("ls_clear").get("checked",true)){dj.byId("sub_tnx_type_code").set("value","84");}else{dj.byId("sub_tnx_type_code").set("value",null);}}return true;},beforeSubmitValidations:function(){if(dj.byId("sub_tnx_type_code")&&dj.byId("ls_clear")){if(dj.byId("ls_clear").get("checked",true)){dj.byId("sub_tnx_type_code").set("value","84");}else{dj.byId("sub_tnx_type_code").set("value",null);}}var _1b=true;if(dj.byId("total_amt")){m.setTnxAmt(dj.byId("total_amt").get("value"));}if(dj.byId("total_amt")&&dj.byId("ls_liab_amt")&&(dj.byId("total_amt").get("value")<dj.byId("ls_liab_amt").get("value"))){m._config.onSubmitErrorMsg=m.getLocalization("licenseLiabilityAmountCanNotBeGreaterThanLicenseTotalAmount");dj.byId("ls_liab_amt").set("value","");_1b=false;}if(dj.byId("bo_ref_id")&&dj.byId("bo_ref_id")!=""){_1b=m.checkBankReference();if(!_1b){var _1c=dj.byId("bo_ref_id");_1c.focus();_1c.set("state","Error");dj.hideTooltip(_1c.domNode);dj.showTooltip(m.getLocalization("boRefIdExists",[_1c.get("value")]),_1c.domNode,0);m._config.onSubmitErrorMsg=m.getLocalization("boRefIdExists",[_1c.get("value")]);_1c.set("value","");}}return _1b;}});})(dojo,dijit,misys);dojo.require("misys.client.binding.bank.report_ls_client");}