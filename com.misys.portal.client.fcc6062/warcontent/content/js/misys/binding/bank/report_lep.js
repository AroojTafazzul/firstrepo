/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.bank.report_lep"]){dojo._hasResource["misys.binding.bank.report_lep"]=true;dojo.provide("misys.binding.bank.report_lep");dojo.require("dojo.parser");dojo.require("dijit.layout.TabContainer");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("misys.widget.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("misys.form.PercentNumberTextBox");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.widget.Collaboration");dojo.require("misys.form.common");dojo.require("misys.form.file");dojo.require("misys.form.addons");dojo.require("misys.validation.common");dojo.require("misys.binding.cash.ft_common");dojo.require("misys.form.BusinessDateTextBox");dojo.require("misys.binding.core.beneficiary_advice_common");(function(d,dj,m){var _1={};_1.fields=["beneficiary_name","beneficiary_account","counterparty_details_name_1","beneficiary_address","beneficiary_city","beneficiary_dom","cpty_bank_code","cpty_bank_name","cpty_bank_swift_bic_code","cpty_bank_address_line_1","cpty_bank_address_line_2","cpty_bank_dom","cpty_branch_code","cpty_branch_name","pre_approved"];_1.toggleEditable=function(){d.forEach(this.fields,function(_2,i){if(dj.byId(_2)){dj.byId(_2).set("readOnly",false);}});};_1.toggleIBG=function(){d.forEach(d.query(".IBG"),function(_3,i){d.style(_3,"display","block");});d.forEach(d.query(".CUR"),function(_4,i){d.style(_4,"display","none");});m.toggleRequired("cpty_bank_code",true);m.toggleRequired("cpty_branch_code",true);m.toggleRequired("cpty_bank_name",true);m.toggleRequired("cpty_branch_name",true);};_1.toggleMEPS=function(){d.forEach(d.query(".MEPS"),function(_5,i){d.style(_5,"display","block");});d.forEach(d.query(".CUR"),function(_6,i){d.style(_6,"display","none");});m.toggleRequired("beneficiary_address",true);m.toggleRequired("cpty_bank_swift_bic_code",true);m.toggleRequired("cpty_bank_name",true);m.toggleRequired("cpty_bank_address_line_1",true);};_1.toggleIAFT=function(){d.forEach(d.query(".IAFT"),function(_7,i){d.style(_7,"display","block");});};function _8(){var _9=dj.byId("cpty_branch_code"),_a=dj.byId("cpty_bank_code"),_b=dj.byId("cpty_bank_name"),_c=dj.byId("cpty_branch_name"),_d="";if(_a&&_9){if(!("S"+_a.get("value")==="S")&&!("S"+_9.get("value")==="S")){m.xhrPost({url:misys.getServletURL("/screen/AjaxScreen/action/ValidateBankBranchCodeAction"),handleAs:"json",sync:true,content:{bank_code:_a.get("value"),brnch_code:_9.get("value"),internal:"N"},load:function(_e,_f){if(_e.items.valid===false){_d=misys.getLocalization("invalidBankCodeBranchCode",[_a.get("value"),_9.get("value")]);_9.focus();_b.set("value","");_c.set("value","");_a.set("state","Error");_9.set("state","Error");dj.hideTooltip(_9.domNode);dj.showTooltip(_d,_9.domNode,0);}else{_b.set("value",_e.items.bankName);_c.set("value",_e.items.branchName);}},error:function(_10,_11){console.error("[Could not validate Bank Code Branch Code] "+_a.get("value")+","+_9.get("value"));console.error(_10);}});}}};function _12(_13){if(dj.byId("fx_contract_nbr_1")){m.toggleRequired("fx_contract_nbr_1",_13);}if(dj.byId("fx_contract_nbr_amt_1")){m.toggleRequired("fx_contract_nbr_amt_1",_13);}var _14=d.byId("fx_contract_nbr_122");if(!_14){_14=d.create("span",{innerHTML:"*",id:"fx_contract_nbr_122"});d.addClass(_14,"required-field-symbol");}else{_14=d.byId("fx_contract_nbr_122");}if(_13){d.query(dj.byId("fx_contract_nbr_1").domNode.parentNode.childNodes).forEach(function(_15,_16){if(_16===0){d.place(_14,_15[0],"first");}});}else{d.destroy(_14);}};d.mixin(m,{bind:function(){m.setValidation("fx_tolerance_rate",m.validateToleranceAndExchangeRate);m.setValidation("fx_exchange_rate",m.validateToleranceAndExchangeRate);m.setValidation("iss_date",m.validateTransferDate);m.bindRecurringFields();m.connect("ft_cur_code","onChange",function(){m.setCurrency(this,["ft_amt"]);});m.setValidation("ft_cur_code",m.validateCurrency);m.setValidation("beneficiary_act_cur_code",m.validateCurrency);m.setValidation("cpty_bank_swift_bic_code",m.validateBICFormat);m._config.forceSWIFTValidation=true;m.connect("beneficiary_name","onChange",function(){dj.byId("counterparty_details_name_1").set("value",dj.byId("beneficiary_name").get("value"));});m.connect("cpty_bank_code","onBlur",_8);m.connect("cpty_branch_code","onBlur",_8);if(dj.byId("fx_rates_type_temp")&&dj.byId("fx_rates_type_temp").get("value")!==""){var _17=0;if(dj.byId("fx_nbr_contracts")&&dj.byId("fx_nbr_contracts").get("value")>0){_17=dj.byId("fx_nbr_contracts").get("value");}m.bindTheFXTypes(_17,"Y");}},validateToleranceAndExchangeRate:function(){var _18,_19,_1a=true;if(this&&this.get("value")!=""){_19=this.get("value");if(isNaN(_19)){m.showTooltip(m.getLocalization("invalidExchangeAndTolerateRate"),this.domNode,["after"]);this.state="Error";this._setStateClass();dj.setWaiState(this.focusNode,"invalid","true");return false;}_18=_19.split(".");if(_18[0]){if(_18[0].length>4){_1a=false;}}if(_18[1]){if(_18[1].length>7){_1a=false;}}if(!_1a){m.showTooltip(m.getLocalization("invalidExchangeAndTolerateRateLength"),this.domNode,["after"]);this.state="Error";this._setStateClass();dj.setWaiState(this.focusNode,"invalid","true");return false;}}return true;},onFormLoad:function(){m.setCurrency(dj.byId("ft_cur_code"),["ft_amt"]);d.forEach(d.query(".IBG, .MEPS, .IAFT"),function(_1b,i){d.style(_1b,"display","none");});if(dj.byId("pre_approved")&&dj.byId("pre_approved").get("value")==="Y"){d.style("PAB","display","inline");}d.forEach(d.query(".CUR"),function(_1c,i){d.style(_1c,"display","none");});_1.toggleEditable();m.setApplicantReference();if(dj.byId("bank_img")){d.style("bank_img","display","none");}if(dj.byId("bank_iso_img")){d.style("bank_iso_img","display","none");}if(d.byId("fx-section")){if((dj.byId("fx_exchange_rate_cur_code")&&dj.byId("fx_exchange_rate_cur_code").get("value")!=="")||(dj.byId("fx_total_utilise_cur_code")&&dj.byId("fx_total_utilise_cur_code").get("value")!=="")){m.animate("wipeIn",d.byId("fx-section"));}else{d.style("fx-section","display","none");}}m.showSavedRecurringDetails(false);m.initForm();if(dj.byId("fx_rates_type_temp")&&dj.byId("fx_rates_type_temp").get("value")!==""){m.onloadFXActions();}},initForm:function(){if(dj.byId("sub_product_code").get("value")==="IAFT"){_1.toggleIAFT();d.forEach(d.query(".CUR"),function(_1d,i){d.style(_1d,"display","inline");});}else{if(dj.byId("sub_product_code").get("value")==="IBG"){_1.toggleIBG();}else{if(dj.byId("sub_product_code").get("value")==="MEPS"){_1.toggleMEPS();}}}}});d.ready(function(){m._config.clearOnSecondCall=false;});})(dojo,dijit,misys);dojo.require("misys.client.binding.bank.report_lep_client");}