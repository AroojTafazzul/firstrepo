/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.bank.report_ft_hvxb"]){dojo._hasResource["misys.binding.bank.report_ft_hvxb"]=true;dojo.provide("misys.binding.bank.report_ft_hvxb");dojo.require("dojo.parser");dojo.require("dijit.layout.TabContainer");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("misys.widget.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("misys.form.PercentNumberTextBox");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.widget.Collaboration");dojo.require("misys.form.common");dojo.require("misys.form.file");dojo.require("misys.form.addons");dojo.require("misys.validation.common");dojo.require("misys.binding.cash.ft_common");dojo.require("misys.form.BusinessDateTextBox");dojo.require("misys.binding.common.create_fx");(function(d,dj,m){var _1=d.byId("fx-message-type");function _2(_3){var _4=function(){var _5=dijit.byId("ft_amt");_5.set("state","Error");m.defaultBindTheFXTypes();dj.byId("ft_amt").set("value","");if(dj.byId("ft_cur_code")&&!dj.byId("ft_cur_code").get("readOnly")){dj.byId("ft_cur_code").set("value","");}};m.dialog.show("ERROR",_3,"",function(){setTimeout(_4,500);});if(d.byId("fx-section")&&(d.style(d.byId("fx-section"),"display")!=="none")){m.animate("wipeOut",d.byId("fx-section"));}};var _6,_7={};_7.fields=["beneficiary_name","beneficiary_account","beneficiary_act_cur_code","beneficiary_address","beneficiary_city","beneficiary_dom","cnaps_bank_code","cpty_bank_name","cpty_bank_swift_bic_code","cpty_bank_address_line_1","cpty_bank_address_line_2","cpty_bank_dom","pre_approved"];_7.toggleReadonly=function(_8){m.toggleFieldsReadOnly(this.fields,_8);};_7.clear=function(){d.forEach(this.fields,function(_9,i){if(dj.byId(_9)){dj.byId(_9).set("value","");}});d.style("PAB","display","none");};function _a(){var _b=dj.byId("applicant_act_pab").get("value");if(_b=="Y"){_7.toggleReadonly(true);_7.clear();}else{_7.toggleReadonly(false);dj.byId("cpty_bank_name").set("readOnly",true);_7.clear();dj.byId("pre_approved_status").set("value","N");var _c=dj.byId("sub_product_code");}};function _d(){var _e=dj.byId("sub_product_code"),_f=dj.byId("beneficiary_account"),_10=dj.byId("beneficiary_act_cur_code");var _11=false;m.xhrPost({url:misys.getServletURL("/screen/AjaxScreen/action/ValidateBeneficiaryMasterAccount"),handleAs:"json",sync:true,content:{account_number:_f.get("value"),account_cur_code:_10.get("value"),sub_product_code:_e.get("value")},load:function(_12,_13){switch(_12.items.StatusCode){case "OK":_10.set("value",_12.items.AcctCur);_11=true;break;case "ERR_INVALID_ACCOUNT_NUMBER":_6=misys.getLocalization("invalidAccountNumber",[_f.get("value")]);_f.focus();_f.set("value","");_f.set("state","Error");dj.hideTooltip(_f.domNode);dj.showTooltip(_6,_f.domNode,0);break;case "ERR_INVALID_INTERFACE_PROCESSING_ERROR":_6=misys.getLocalization("accountValidationInterfaceError");_f.focus();_f.set("value","");_f.set("state","Error");dj.hideTooltip(_f.domNode);dj.showTooltip(_6,_f.domNode,0);break;default:_6=_12.items.StatusCodeMessage;_f.focus();_f.set("value","");_f.set("state","Error");dj.hideTooltip(_f.domNode);dj.showTooltip(_6,_f.domNode,0);break;}},error:function(_14,_15){console.error("[Could not validate Beneficiary Account] "+_f.get("value"));console.error(_14);}});return _11;};d.mixin(m._config,{initReAuthParams:function(){var _16={productCode:"FT",subProductCode:dj.byId("sub_product_code").get("value"),transactionTypeCode:"01",entity:dj.byId("entity")?dj.byId("entity").get("value"):"",currency:dj.byId("ft_cur_code").get("value"),amount:m.trimAmount(dj.byId("ft_amt").get("value")),es_field1:m.trimAmount(dj.byId("ft_amt").get("value")),es_field2:(dj.byId("beneficiary_account"))?dj.byId("beneficiary_account").get("value"):""};return _16;}});d.mixin(m,{fireFXAction:function(){if(m._config.fxParamData&&dj.byId("sub_product_code")&&dj.byId("sub_product_code").get("value")!==""){var _17=m._config.fxParamData[dj.byId("sub_product_code").get("value")];if(m._config.fxParamData&&_17.fxParametersData.isFXEnabled==="Y"){var _18,_19;var _1a="";if(dj.byId("ft_cur_code")){_1a=dj.byId("ft_cur_code").get("value");}var _1b=dj.byId("ft_amt").get("value");var _1c=dj.byId("applicant_act_cur_code").get("value");var _1d=m._config.productCode;var _1e="";if(dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""){_1e=dj.byId("issuing_bank_abbv_name").get("value");}var _1f=dj.byId("applicant_act_cur_code").get("value");var _20=false;if(_1a!==""&&!isNaN(_1b)&&_1d!==""&&_1e!==""){if(_1a!==_1c){_18=_1c;_19=_1a;_1f=_1c;}if(_18&&_18!==""&&_19&&_19!==""){if(d.byId("fx-section")&&(d.style(d.byId("fx-section"),"display")==="none")){m.animate("wipeIn",d.byId("fx-section"));}m.fetchFXDetails(_18,_19,_1b,_1d,_1e,_1f,_20);if(dj.byId("fx_rates_type_1")&&dj.byId("fx_rates_type_1").get("checked")){if(isNaN(dj.byId("fx_exchange_rate").get("value"))||dj.byId("fx_exchange_rate_cur_code").get("value")===""||isNaN(dj.byId("fx_exchange_rate_amt").get("value"))||(m._config.fxParamData[dj.byId("sub_product_code").get("value")].fxParametersData.toleranceDispInd==="Y"&&(isNaN(dj.byId("fx_tolerance_rate").get("value"))||isNaN(dj.byId("fx_tolerance_rate_amt").get("value"))||dj.byId("fx_tolerance_rate_cur_code").get("value")===""))){_2(m.getLocalization("FXDefaultErrorMessage"));}}}else{if(d.byId("fx-section")&&(d.style(d.byId("fx-section"),"display")!=="none")){m.animate("wipeOut",d.byId("fx-section"));}m.defaultBindTheFXTypes();}}if(dj.byId("recurring_payment_enabled")&&dj.byId("recurring_payment_enabled").get("checked")&&dj.byId("fx_rates_type_2")){dj.byId("fx_rates_type_2").set("disabled",true);m.animate("wipeOut",d.byId("contracts_div"));}}}},bind:function(){m.setValidation("iss_date",m.validateTransferDateCustomer);dj.byId("sub_product_code").set("value","HVXB");m.bindRecurringFields();m.connect("prod_stat_code","onChange",m.populateReportingStatus);m.connect("ft_cur_code","onChange",function(){m.setCurrency(this,["ft_amt"]);});m.setValidation("ft_cur_code",m.validateCurrency);m.connect("beneficiary_account","onChange",_d);m.connect("beneficiary_act_cur_code","onChange",function(){if(dj.byId("ft_cur_code")&&!dj.byId("ft_cur_code").get("readOnly")){dj.byId("ft_cur_code").set("value",dj.byId("beneficiary_act_cur_code").get("value"));}});m.connect("entity","onChange",function(){dj.byId("applicant_act_name").set("value","");});m.connect("clear_img","onClick",_a);m.connect("recurring_flag","onClick",function(){m.showRecurring();});m.connect("pre_approved_status","onChange",function(){if(dj.byId("pre_approved_status").get("value")==="N"){if(dj.byId("bank_img")){dj.byId("bank_img").set("disabled",false);}if(dj.byId("bank_iso_img")){dj.byId("bank_iso_img").set("disabled",false);}if(dj.byId("currency")){dj.byId("currency").set("disabled",false);}}var _21=dj.byId("sub_product_code");});var _22=dj.byId("sub_product_code").get("value");if(m._config.fxParamData&&m._config.fxParamData[_22].fxParametersData.isFXEnabled==="Y"){m.connect("ft_cur_code","onBlur",function(){m.setCurrency(this,["ft_amt"]);if(dj.byId("ft_cur_code").get("value")!==""&&!isNaN(dj.byId("ft_amt").get("value"))){m.fireFXAction();}else{m.defaultBindTheFXTypes();}});m.connect("ft_amt","onBlur",function(){m.setTnxAmt(this.get("value"));var _23="";if(dj.byId("ft_cur_code")){_23=dj.byId("ft_cur_code").get("value");}if(!isNaN(dj.byId("ft_amt").get("value"))&&_23!==""){m.fireFXAction();}else{m.defaultBindTheFXTypes();}});}else{if(d.byId("fx-section")&&dj.byId("fx_rates_type_1")&&!dj.byId("fx_rates_type_1").get("checked")&&dj.byId("fx_rates_type_2")&&!dj.byId("fx_rates_type_2").get("checked")){d.style("fx-section","display","none");}}},onFormLoad:function(){m.populateReportingStatus();m.setCurrency(dj.byId("ft_cur_code"),["ft_amt"]);m.initForm();if(dj.byId("applicant_act_product_types")&&dj.byId("applicant_act_no").get("value")!==""){m.toggleRequired("applicant_act_product_types",false);}if(dj.byId("recurring_payment_enabled")&&dj.byId("recurring_payment_enabled").get("checked")){m.showSavedRecurringDetails(false);}else{if(d.byId("recurring_payment_div")){d.style("recurring_payment_div","display","none");}m.showSavedRecurringDetails(false);}if(m._config.fxParamData&&dj.byId("sub_product_code")&&dj.byId("sub_product_code").get("value")!==""&&dj.byId("sub_product_code").get("value")!=="IBG"){m.initializeFX(dj.byId("sub_product_code").get("value"));if(dj.byId("applicant_act_cur_code")&&dj.byId("applicant_act_cur_code").get("value")!==""&&dj.byId("ft_cur_code")&&dj.byId("ft_cur_code").get("value")!==""&&dj.byId("applicant_act_cur_code").get("value")!==dj.byId("ft_cur_code").get("value")){m.onloadFXActions();}else{m.defaultBindTheFXTypes();}}else{m.animate("fadeOut",_1);}if(d.byId("fx-section")){if(dj.byId("bulk_ref_id")&&dj.byId("ft_cur_code")&&dj.byId("ft_amt")&&dj.byId("bulk_ref_id").get("value")!==""&&dj.byId("ft_cur_code").get("value")!==""&&!isNaN(dj.byId("ft_amt").get("value"))){m.initializeFX(dj.byId("sub_product_code").get("value"));m.fireFXAction();}else{if((dj.byId("fx_exchange_rate_cur_code")&&dj.byId("fx_exchange_rate_cur_code").get("value")!=="")||(dj.byId("fx_total_utilise_cur_code")&&dj.byId("fx_total_utilise_cur_code").get("value")!=="")||((dj.byId("fx_rates_type_1")&&dj.byId("fx_rates_type_1").get("checked"))||(dj.byId("fx_rates_type_2")&&dj.byId("fx_rates_type_2").get("checked")))){m.animate("wipeIn",d.byId("fx-section"));}else{d.style("fx-section","display","none");}}}},initForm:function(){dj.byId("sub_product_code").set("value","HVXB");if(dj.byId("pre_approved_status")&&dj.byId("pre_approved_status").get("value")==="Y"){d.style("PAB","display","inline");_7.toggleReadonly(true);if(dj.byId("bank_img")){dj.byId("bank_img").set("disabled",true);}if(dj.byId("bank_iso_img")){dj.byId("bank_iso_img").set("disabled",true);}if(dj.byId("currency")){dj.byId("currency").set("disabled",true);}}d.forEach(d.query(".CUR"),function(_24,i){d.style(_24,"display","inline");});dj.byId("beneficiary_mode").set("value","02");}});})(dojo,dijit,misys);}