/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.bank.report_bg"]){dojo._hasResource["misys.binding.bank.report_bg"]=true;dojo.provide("misys.binding.bank.report_bg");dojo.require("dijit.layout.TabContainer");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("misys.form.file");dojo.require("misys.form.addons");dojo.require("misys.form.SimpleTextarea");dojo.require("dijit.Editor");dojo.require("dojo.data.ItemFileReadStore");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("misys.widget.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.layout.ContentPane");dojo.require("misys.widget.Collaboration");dojo.require("misys.binding.trade.ls_common");function _localizeDisplayDate(_1){if(_1.get("type")==="hidden"){return d.date.locale.format(m.localizeDate(_1),{selector:"date"});}return _1.get("displayedValue");};(function(d,dj,m){m._config=m._config||{};m._config.bgCurCode=m._config.bgCurCode||{};m._config.applicant=m._config.applicant||{entity:"",name:"",addressLine1:"",addressLine2:"",dom:""};m._config.beneficiary=m._config.beneficiary||{name:"",addressLine1:"",addressLine2:"",dom:""};m._config.expDate=m._config.expDate||{};m._config.renewFlag=m._config.renewFlag||{};m._config.bgTypeCode=m._config.bgTypeCode||{};function _2(){if(dj.byId("sub_tnx_type_code")&&dj.byId("sub_tnx_type_code").get("value")==="05"){var _3=dj.byId("release_amt");var _4=dj.byId("org_bg_liab_amt");var _5=dj.byId("release_amt")?dj.byId("release_amt").get("value"):"";var _6=dojo.number.parse(_4.get("value"))||0;if(_3&&_4&&(_5<=0||_5>_6)){m.dialog.show("ERROR",m.getLocalization("canNotReleaseTheTransaction"));dj.byId("bg_liab_amt").set("value",_6);return false;}if(!isNaN(_5)){var _7=_6-_5;dj.byId("bg_liab_amt").set("value",_7);return true;}else{dj.byId("bg_liab_amt").set("value",_6);}}return true;};function _8(){var _9=dj.byId("bg_liab_amt");var _a=dj.byId("bg_amt");var _b=dj.byId("claim_amt");if(_a&&_b){if(_b.get("value")<=0||_b.get("value")>_9.get("value")||_b.get("value")>_a.get("value")){var _c=function(){var _d=dijit.byId("claim_amt");_d.focus();_d.set("state","Error");};m.dialog.show("ERROR",m.getLocalization("claimAmtGreaterThanOutstandingAmtError",[_9.get("value").toFixed(2)]),"",function(){setTimeout(_c,500);});return false;}}return true;};function _e(){var _f=dj.byId("current_date");var _10=dj.byId("exp_date");var _11=dj.byId("iss_date");var _12=dj.byId("claim_present_date");if(_12){if(_f&&!m.compareDateFields(_12,_f)){var _13=function(){var _14=dijit.byId("claim_present_date");_14.focus();_14.set("state","Error");};m.dialog.show("ERROR",m.getLocalization("claimDateGreaterThanCurrentDateError",[_12.get("displayedValue"),_f.get("displayedValue")]),"",function(){setTimeout(_13,500);});return false;}else{if(_10&&!m.compareDateFields(_12,_10)){var _15=function(){return true;};m.dialog.show("WARNING",m.getLocalization("claimDateGreaterThanExpiryDateError",[_12.get("displayedValue"),_10.get("displayedValue")]),"",function(){setTimeout(_15,500);});}else{if(_11&&!m.compareDateFields(_11,_12)){var _16=function(){return true;};m.dialog.show("WARNING",m.getLocalization("claimDateLessThanIssueDateError",[_12.get("displayedValue"),_11.get("displayedValue")]),"",function(){setTimeout(_16,500);});}}}}return true;};function _17(){if(dj.byId("sub_tnx_type_code")&&dj.byId("sub_tnx_type_code").get("value")==="05"){var _18=dj.byId("bg_liab_amt"),_19=dj.byId("prod_stat_code"),_1a=null,_1b=null;if(_19){_1a={"identifier":"id","items":[]};_1b=new dojo.data.ItemFileWriteStore({data:_1a});if(_18&&_18.get("value")>0){_1b.newItem({"id":"03","name":m.getLocalization("Approved")});_1b.newItem({"id":"01","name":m.getLocalization("Not_Processed")});if(_19.get("value")!=="01"&&_19.get("value")!=="03"){_19.set("displayedValue","");_19.set("value","");}_19.store=null;_19.store=_1b;dj.byId("bg_release_flag").set("value","N");}else{_1b.newItem({"id":"76","name":m.getLocalization("Approved")});_1b.newItem({"id":"01","name":m.getLocalization("Not_Processed")});if(_19.get("value")!=="01"&&_19.get("value")!=="76"){_19.set("displayedValue","");_19.set("value","");}_19.store=null;_19.store=_1b;dj.byId("bg_release_flag").set("value","Y");}}}};function _1c(){var _1d=dj.byId("sub_tnx_type_code").get("value");var _1e=dj.byId("inc_amt").get("value");var _1f=dj.byId("dec_amt").get("value");var _20=dj.byId("bg_liab_amt").get("value");if(_1d&&(_1d==="01"||_1d==="02")&&(_1e||_1f)){if(_1d==="01"&&_1e){var inc=dojo.number.parse(_20)+dojo.number.parse(_1e);dj.byId("bg_liab_amt").set("value",inc);}else{var dec=dojo.number.parse(_20)-dojo.number.parse(_1f);dj.byId("bg_liab_amt").set("value",dec);}}};d.mixin(m._config,{xmlTransform:function(xml){var _21="<bg_tnx_record>";if(xml.indexOf(_21)!=-1){var _22=m._config.xmlTagName,_23=_22?["<",_22,">"]:[],_24="</bg_tnx_record>",_25="",_26=-1;_25=xml.substring(_21.length,(xml.length-_24.length));_23.push(_25);if(dj.byId("gridLicense")&&dj.byId("gridLicense").store&&dj.byId("gridLicense").store!==null&&dj.byId("gridLicense").store._arrayOfAllItems.length>0){_23.push("<linked_licenses>");dj.byId("gridLicense").store.fetch({query:{REFERENCEID:"*"},onComplete:dojo.hitch(dj.byId("gridLicense"),function(_27,_28){dojo.forEach(_27,function(_29){_23.push("<license>");_23.push("<ls_ref_id>",_29.REFERENCEID,"</ls_ref_id>");_23.push("<bo_ref_id>",_29.BO_REF_ID,"</bo_ref_id>");_23.push("<ls_number>",_29.LS_NUMBER,"</ls_number>");_23.push("<ls_allocated_amt>",_29.LS_ALLOCATED_AMT,"</ls_allocated_amt>");_23.push("<ls_amt>",_29.LS_AMT,"</ls_amt>");_23.push("<ls_os_amt>",_29.LS_OS_AMT,"</ls_os_amt>");_23.push("<converted_os_amt>",_29.CONVERTED_OS_AMT,"</converted_os_amt>");_23.push("<allow_overdraw>",_29.ALLOW_OVERDRAW,"</allow_overdraw>");_23.push("</license>");});})});_23.push("</linked_licenses>");}if(_22){_23.push("</",_22,">");}return _23.join("");}else{return xml;}}});d.mixin(m,{bind:function(){m.setValidation("iss_date",m.validateIssueDate);m.setValidation("amd_date",m.validateAmendmentDate);m.setValidation("exp_date",m.validateBankExpiryDate);m.setValidation("bg_cur_code",m.validateCurrency);m.setValidation("contract_cur_code",m.validateCurrency);m.setValidation("net_exposure_cur_code",m.validateCurrency);m.setValidation("applicant_country",m.validateCountry);m.setValidation("beneficiary_country",m.validateCountry);m.setValidation("alt_applicant_country",m.validateCountry);m.setValidation("contact_country",m.validateCountry);m.setValidation("claim_cur_code",m.validateCurrency);m.setValidation("claim_reference",m.validateSwiftAddressCharacters);m.setValidation("exp_date",m.validateBankExpiryDate);m.connect("claim_amt","onBlur",_8);m.connect("claim_reference","onBlur",m.checkClaimReferenceExists);m.connect("claim_present_date","onBlur",_e);m.setValidation("contract_date",m.validateContractDate);m.setValidation("tender_expiry_date",m.validateTenderExpiryDate);m.setValidation("contract_pct",m.checkContractPercent);m.setValidation("extend_pay_date",m.validateMT777Fields);m.setValidation("latest_date_reply",m.validateMT777Fields);m.connect("prod_stat_code","onChange",function(){m.updateOutstandingAmount(dj.byId("bg_liab_amt"),dj.byId("org_bg_liab_amt"));});m.connect("contract_ref","onChange",function(){var _2a=d.byId("tender-exp-date");if(this.get("value")==="TEND"){m.animate("fadeIn",_2a);}else{dj.byId("tender_expiry_date").set("value",null);m.animate("fadeOut",_2a);}});m.connect("prod_stat_code","onChange",function(){if(this.get("value")==="84"||this.get("value")==="85"){m.animate("fadeIn",d.byId("claimDetails"));dj.byId("claim_cur_code").set("value",dj.byId("bg_cur_code").get("value"));dj.byId("claim_reference").set("disabled",false);dj.byId("claim_present_date").set("disabled",false);dj.byId("claim_amt").set("disabled",false);dj.byId("claim_cur_code").set("disabled",false);if(dj.byId("prod_stat_code").get("value")==="85"&&dj.byId("claim_reference_hidden")&&dj.byId("claim_amt_hidden")&&d.byId("claimPresentDate")){m.animate("fadeOut",d.byId("claimPresentDate"));dj.byId("claim_reference").set("value",dj.byId("claim_reference_hidden").get("value"));dj.byId("claim_amt").set("value",dj.byId("claim_amt_hidden").get("value"));}else{m.animate("fadeIn",d.byId("claimPresentDate"));dj.byId("claim_reference").set("value","");dj.byId("claim_amt").set("value","");}}else{if(dj.byId("claim_reference")&&dj.byId("claim_present_date")&&dj.byId("claim_amt")){m.animate("fadeOut",d.byId("claimDetails"));dj.byId("claim_reference").set("disabled",true);dj.byId("claim_present_date").set("disabled",true);dj.byId("claim_amt").set("disabled",true);dj.byId("claim_cur_code").set("disabled",true);dj.byId("claim_reference").set("value","");dj.byId("claim_present_date").set("value",null);dj.byId("claim_amt").set("value","");dj.byId("claim_cur_code").set("value","");}}});m.connect("prod_stat_code","onChange",function(){if(this.get("value")==="86"&&dj.byId("extend_pay_date")&&dj.byId("latest_date_reply")){m.animate("fadeIn",d.byId("ExtendPay"));dj.byId("extend_pay_date").set("disabled",false);dj.byId("latest_date_reply").set("disabled",false);}else{if(dj.byId("extend_pay_date")&&dj.byId("latest_date_reply")){m.animate("fadeOut",d.byId("ExtendPay"));dj.byId("extend_pay_date").set("disabled",true);dj.byId("latest_date_reply").set("disabled",true);dj.byId("extend_pay_date").set("value",null);dj.byId("latest_date_reply").set("value",null);}}});m.setValidation("renewal_calendar_date",m.validateRenewalCalendarDate);m.setValidation("renew_on_code",m.validateRenewalCalendarDate);m.connect("projected_expiry_date","onChange",function(){var _2b=dj.byId("exp_date");var _2c=dj.byId("final_expiry_date");var _2d=function(){dj.hideTooltip(dj.byId("projected_expiry_date").domNode);};var _2e=this.get("displayedValue");if(_2b&&!m.compareDateFields(_2b,this)){this.set("value",null);dj.showTooltip(m.getLocalization("projectedExpDateLessThanTransactionExpDtError",[_2e,_2b.get("displayedValue")]),dj.byId("projected_expiry_date").domNode,0);setTimeout(_2d,10000);}else{if(_2c&&!m.compareDateFields(this,_2c)){this.set("value",null);dj.showTooltip(m.getLocalization("projectedExpDateGreaterThanFinalExpDtError",[_2e,_2c.get("displayedValue")]),dj.byId("projected_expiry_date").domNode,0);setTimeout(_2d,10000);}}});m.connect("final_expiry_date","onChange",function(){var _2f=dj.byId("exp_date");var _30=dj.byId("projected_expiry_date");var _31=function(){dj.hideTooltip(dj.byId("final_expiry_date").domNode);};var _32=this.get("displayedValue");if(_2f&&!m.compareDateFields(_2f,this)){this.set("value",null);this.set("state","Error");dj.showTooltip(m.getLocalization("finalExpDateLessThanTransactionExpDtError",[_32,_2f.get("displayedValue")]),dj.byId("final_expiry_date").domNode,0);setTimeout(_31,10000);}else{if(_30&&!m.compareDateFields(_30,this)){this.set("value",null);dj.showTooltip(m.getLocalization("finalExpDateLessThanProjectedExpDtError",[_32,_30.get("displayedValue")]),dj.byId("final_expiry_date").domNode,0);setTimeout(_31,10000);}}});m.setValidation("bo_comment",m.bofunction);m.connect("bg_cur_code","onChange",function(){m.setCurrency(this,["bg_amt","bg_liab_amt"]);});m.connect("bg_amt","onBlur",function(){m.setTnxAmt(this.get("value"));});m.connect("iss_date_type_code","onChange",function(){m.toggleFields((this.get("value")==="99"),null,["iss_date_type_details"]);});m.connect("exp_date_type_code","onChange",function(){m.toggleFields((this.get("value")!=="01"),null,["exp_date"]);m.toggleFields((this.get("value")!=="02"),null,["exp_event"]);});m.connect("reduction_authorised","onChange",function(){m.toggleFields((this.get("value")==="on"),null,["reduction_clause"]);});m.connect("reduction_clause","onChange",function(){m.toggleFields((this.get("value")==="03"),null,["reduction_clause_other"]);});m.connect("for_account","onChange",function(){m.toggleFields((this.get("value")==="on"),["alt_applicant_address_line_2","alt_applicant_dom","alt_applicant_address_line_4"],["alt_applicant_name","alt_applicant_address_line_1","alt_applicant_country"]);});m.connect("consortium","onChange",function(){m.toggleFields((this.get("value")==="on"),null,["net_exposure_cur_code","net_exposure_amt","consortium_details"],true,true);var _33=dj.byId("consortium");if(_33.get("value")!=="on"){dj.byId("net_exposure_cur_code").set("value","");dj.byId("net_exposure_amt").set("value","");dj.byId("consortium_details").set("value","");}});m.connect("issuing_bank_type_code","onChange",function(){m.toggleFields((this.get("value")==="02"),["issuing_bank_address_line_2","issuing_bank_dom","issuing_bank_address_line_4","issuing_bank_reference"],["issuing_bank_name","issuing_bank_address_line_1"]);if(this.get("value")==="01"){dojo.byId("issuing_bank_name_img").style.display="display:none";}else{if(this.get("value")==="02"){dojo.byId("issuing_bank_name_img").style.display="display:block";}}});m.connect("bg_type_code","onChange",m.toggleGuaranteeType);m.connect("bg_text_type_code","onChange",function(){m.toggleFields((this.get("value")==="03"),null,["bg_text_type_details"]);});m.connect("delivery_to","onChange",function(){m.toggleFields((this.get("value")==="04"),null,["delivery_to_other"]);});m.connect("bg_rule","onChange",function(){m.toggleFields((this.get("value")==="99"),null,["bg_rule_other"]);});m.connect("text_language","onChange",function(){m.toggleFields((this.get("value")==="*"),null,["text_language_other"]);});m.connect("contract_cur_code","onChange",function(){m.setCurrency(this,["contract_amt"]);});m.connect("prod_stat_code","onChange",m.toggleProdStatCodeFields);m.connect("prod_stat_code","onChange",m.refreshUIforBGAmendment);m.connect("prod_stat_code","onChange",function(){var _34=this.get("value");m.toggleFields(_34&&_34!=="01"&&_34!=="18",["action_req_code"],["iss_date","bo_ref_id"]);if(dj.byId("mode")&&dj.byId("mode").get("value")==="RELEASE"){m.toggleRequired("bo_ref_id",false);m.toggleRequired("iss_date",false);m.toggleRequired("bg_liab_amt",false);m.toggleRequired("bg_available_amt",false);}});m.connect("adv_bank_conf_req","onClick",function(){m.toggleFields(this.get("checked")===true,["confirming_bank_address_line_2","confirming_bank_dom"],["confirming_bank_name","confirming_bank_address_line_1"]);if(this.get("checked")===true){m.animate("fadeIn",d.byId("confirming_bank_name_img"));}else{m.animate("fadeOut",d.byId("confirming_bank_name_img"));}});m.connect("prod_stat_code","onChange",function(){if(dj.byId("sub_tnx_type_code")&&dj.byId("sub_tnx_type_code").get("value")=="05"){var _35=dj.byId("prod_stat_code");if(_35&&_35.get("value")==="01"){dj.byId("release_amt").set("readOnly",true);dj.byId("amd_date").set("readOnly",true);}else{dj.byId("release_amt").set("readOnly",false);dj.byId("amd_date").set("readOnly",false);}}});m.connect("prod_stat_code","onChange",function(){var _36=dj.byId("prod_stat_code").get("value"),_37=dj.byId("bg_liab_amt");if(_37&&(_36==="01"||_36==="10"||_36==="06")){var _38=dj.byId("sub_tnx_type_code").get("value");if(_38&&(_38==="01"||_38==="02")&&(_36==="01")){_37.set("value",dj.byId("org_bg_liab_amt").get("value"));}_37.set("readOnly",true);_37.set("disabled",true);m.toggleRequired("bg_liab_amt",false);dj.byId("bg_liab_amt").set("value",dj.byId("bg_liab_amt").get("value"));}else{if(_37){if(_36==="08"){_1c();}_37.set("readOnly",false);_37.set("disabled",false);if(!(dj.byId("mode")&&dj.byId("mode").get("value")==="RELEASE")){m.toggleRequired("bg_liab_amt",true);}dj.byId("bg_liab_amt").set("value",dj.byId("bg_liab_amt").get("value"));}}var _39=dj.byId("bg_available_amt");if(_39&&(_36==="01"||_36==="10"||_36==="06")){_39.set("readOnly",true);_39.set("disabled",true);m.toggleRequired("bg_available_amt",false);dj.byId("bg_available_amt").set("value","");}else{if(_39){_39.set("readOnly",false);_39.set("disabled",false);if(!(dj.byId("mode")&&dj.byId("mode").get("value")==="RELEASE")){m.toggleRequired("bg_available_amt",true);}dj.byId("bg_available_amt").set("value","");}}if(dj.byId("tnx_type_code")&&dj.byId("tnx_type_code").get("value")=="01"){if(_36==="01"){_37.set("value",dj.byId("bg_liab_amt").get("value"));}else{_37.set("value",dj.byId("bg_amt").get("value"));}}var _3a=dj.byId("action_req_code");if(_3a&&(_36==="01"||_36==="10"||_36==="06"||_36==="31")){_3a.set("readOnly",true);_3a.set("disabled",true);}else{if(_3a&&_36==="12"){_3a.set("value","12");_3a.set("readOnly",true);_3a.set("disabled",true);}else{_3a.set("readOnly",false);_3a.set("disabled",false);}}});m.connect("release_amt","onBlur",_2);m.connect("advising_bank_name","onBlur",m.setConfirmedRequired);m.connect("renew_flag","onClick",m.toggleRenewalDetails);m.connect("renew_flag","onClick",function(){if(!this.get("checked")){dj.byId("rolling_renewal_nb").set("value","");}else{if(!dj.byId("rolling_renewal_flag").get("checked")){dj.byId("rolling_renewal_nb").set("value",m.getLocalization("default_rewnewalNumber"));}}});m.connect("renew_on_code","onChange",function(){m.toggleFields(this.get("value")==="02",null,["renewal_calendar_date"]);dj.byId("final_expiry_date").validate();});m.connect("advise_renewal_flag","onClick",function(){m.toggleFields(this.get("checked"),null,["advise_renewal_days_nb"]);});m.connect("advise_renewal_flag","onChange",function(){m.toggleFields(this.get("checked"),null,["advise_renewal_days_nb"]);});m.connect("rolling_renewal_flag","onClick",function(){m.toggleFields(this.get("checked"),null,["rolling_renewal_nb","rolling_cancellation_days","rolling_renew_on_code"]);if(!this.get("checked")){dj.byId("rolling_renew_for_nb").set("value","");dj.byId("rolling_renew_for_period").set("value","");dj.byId("rolling_day_in_month").set("value","");if(dj.byId("renew_flag").get("checked")){dj.byId("rolling_renewal_nb").set("value",m.getLocalization("default_rewnewalNumber"));}}});m.connect("rolling_renewal_flag","onChange",function(){m.toggleFields(this.get("checked"),null,["rolling_renewal_nb","rolling_cancellation_days","rolling_renew_on_code"]);if(!this.get("checked")){dj.byId("rolling_renew_for_nb").set("value","");dj.byId("rolling_renew_for_period").set("value","");dj.byId("rolling_day_in_month").set("value","");if(dj.byId("renew_flag").get("checked")){dj.byId("rolling_renewal_nb").set("value",m.getLocalization("default_rewnewalNumber"));}}});m.connect("rolling_renew_on_code","onChange",function(){m.toggleFields(this.get("value")==="03",["rolling_day_in_month"],["rolling_renew_for_nb"],true);if(this.get("value")==="01"){dj.byId("rolling_renew_for_nb").set("value","");dj.byId("rolling_renew_for_period").set("value","");dj.byId("rolling_day_in_month").set("value","");}else{if(dj.byId("rolling_renew_on_code").get("value")==="03"&&dj.byId("rolling_renewal_flag").get("checked")&&dj.byId("renew_for_period").get("value")!==""){dj.byId("rolling_renew_for_period").set("value",dj.byId("renew_for_period").get("value"));}}});m.connect("rolling_renew_for_nb","onBlur",function(){m.validateRollingRenewalFrequency(dj.byId("rolling_renew_for_nb"));});m.connect("renew_for_nb","onBlur",function(){m.validateRollingRenewalFrequency(dj.byId("renew_for_nb"));});m.connect("renew_for_period","onChange",function(){if(dj.byId("rolling_renew_on_code").get("value")==="03"&&dj.byId("rolling_renewal_flag").get("checked")&&dj.byId("renew_for_period").get("value")!==""){dj.byId("rolling_renew_for_period").set("value",dj.byId("renew_for_period").get("value"));}});m.connect("rolling_day_in_month","onBlur",function(){if(dj.byId("rolling_day_in_month").get("value")===0){dj.byId("rolling_day_in_month").set("state","Error");dj.showTooltip(m.getLocalization("dayInMonthZeroNotApplicableError"),dj.byId("rolling_day_in_month").domNode,0);var _3b=function(){dj.hideTooltip(dj.byId("rolling_day_in_month").domNode);};setTimeout(_3b,4500);}});m.connect("rolling_day_in_month","onChange",function(){if(dj.byId("rolling_renew_for_period").get("value")==="D"){this.set("value","");dj.showTooltip(m.getLocalization("dayInMonthNotApplicableForDaysError"),dj.byId("rolling_day_in_month").domNode,0);var _3c=function(){dj.hideTooltip(dj.byId("rolling_day_in_month").domNode);};setTimeout(_3c,1500);}});m.connect("rolling_renew_for_period","onChange",function(){if(dj.byId("rolling_renew_for_period").get("value")==="D"&&!isNaN(dj.byId("rolling_day_in_month").get("value"))){dj.byId("rolling_day_in_month").set("value","");dj.showTooltip(m.getLocalization("dayInMonthNotApplicableForDaysError"),dj.byId("rolling_renew_for_period").domNode,0);var _3d=function(){dj.hideTooltip(dj.byId("rolling_day_in_month").domNode);};setTimeout(_3d,1500);}});if(!(dj.byId("mode")&&dj.byId("mode").get("value")==="RELEASE")){m.connect("bg_liab_amt","onChange",_17);}m.connect("bg_liab_amt","onBlur",function(){if(dj.byId("bg_amt")&&(dj.byId("bg_amt").get("value")<dj.byId("bg_liab_amt").get("value"))){var _3e=function(){var _3f=dijit.byId("bg_liab_amt");_3f.focus();_3f.set("state","Error");};m.dialog.show("ERROR",m.getLocalization("canNotMoreThanTranAmt"),"",function(){setTimeout(_3e,500);});}});m.connect("bg_available_amt","onBlur",function(){if(dj.byId("bg_amt")&&(dj.byId("bg_amt").get("value")<dj.byId("bg_available_amt").get("value"))){var _40=function(){var _41=dijit.byId("bg_available_amt");_41.focus();_41.set("state","Error");};m.dialog.show("ERROR",m.getLocalization("AvailBGamtcanNotMoreThanTranAmt"),"",function(){setTimeout(_40,500);});}});m.connect("prod_stat_code","onChange",function(){var _42=dj.byId("prod_stat_code").get("value");if(dj.byId("doc_ref_no")&&(_42==="16"||_42==="24")){dj.byId("doc_ref_no").set("disabled",false);}else{if(dj.byId("doc_ref_no")){dj.byId("doc_ref_no").set("disabled",true);}}if(m._config.enable_to_edit_customer_details_bank_side=="false"&&dj.byId("prod_stat_code")&&dj.byId("prod_stat_code").get("value")!==""){if(dj.byId("bg_liab_amt")&&dj.byId("tnx_type_code")&&dj.byId("tnx_type_code").get("value")!=="15"&&dj.byId("tnx_type_code").get("value")!=="13"){m.toggleRequired("bg_liab_amt",false);m.toggleRequired("bg_available_amt",false);}}});m.connect("facility_id","onChange",m.getLimitDetails);m.connect("limit_id","onChange",m.setLimitFieldsValue);m.connect("contract_cur_code","onBlur",function(){if(dj.byId("contract_cur_code").get("value")!==""||!isNaN(dj.byId("contract_amt").get("value"))){m.toggleRequired("contract_amt",true);m.toggleRequired("contract_cur_code",true);}else{m.toggleRequired("contract_amt",false);m.toggleRequired("contract_cur_code",false);}});m.connect("contract_amt","onBlur",function(){if(dj.byId("contract_cur_code").get("value")!==""||!isNaN(dj.byId("contract_amt").get("value"))){m.toggleRequired("contract_amt",true);m.toggleRequired("contract_cur_code",true);}else{m.toggleRequired("contract_amt",false);m.toggleRequired("contract_cur_code",false);}});m.connect("license_lookup","onClick",function(){m.getLicenses("bg");});m.connect("bg_cur_code","onChange",function(){m.clearLicenseGrid(this,m._config.bgCurCode);});m.connect("entity","onChange",function(){m.clearLicenseGrid(this,m._config.applicant);});m.connect("beneficiary_name","onChange",function(){m.clearLicenseGrid(this,m._config.beneficiary);});m.connect("exp_date","onChange",function(){m.clearLicenseGrid(this,m._config.expDate);});m.connect("renew_flag","onClick",function(){m.clearLicenseGrid(this,m._config.renewFlag);});m.connect("bg_type_code","onChange",function(){m.clearLicenseGrid(this,m._config.bgTypeCode);});m.connect("renew_amt_code_1","onClick",function(){m.setRenewalAmount(this);});m.connect("renew_amt_code_2","onClick",function(){m.setRenewalAmount(this);});m.connect("issuing_bank_address_line_4","onFocus",function(){m.showTooltip(m.getLocalization("addressLine4ToolTip",[dj.byId("issuing_bank_address_line_4").get("displayedValue"),dj.byId("issuing_bank_address_line_4").get("value")]),d.byId("issuing_bank_address_line_4"),["after"],5000);});m.connect("applicant_address_line_4","onFocus",function(){m.showTooltip(m.getLocalization("addressLine4ToolTip",[dj.byId("applicant_address_line_4").get("displayedValue"),dj.byId("applicant_address_line_4").get("value")]),d.byId("applicant_address_line_4"),["after"],5000);});m.connect("beneficiary_address_line_4","onFocus",function(){m.showTooltip(m.getLocalization("addressLine4ToolTip",[dj.byId("beneficiary_address_line_4").get("displayedValue"),dj.byId("beneficiary_address_line_4").get("value")]),d.byId("beneficiary_address_line_4"),["after"],5000);});m.connect("contact_address_line_4","onFocus",function(){m.showTooltip(m.getLocalization("addressLine4ToolTip",[dj.byId("contact_address_line_4").get("displayedValue"),dj.byId("contact_address_line_4").get("value")]),d.byId("contact_address_line_4"),["after"],5000);});},setConfirmedRequired:function(){var _43=dj.byId("advising_bank_name");var _44=dj.byId("adv_bank_conf_req");if(_43){var _45=dj.byId("advising_bank_name").get("value");if(_45!==""){_44.set("disabled",false);_44.set("checked",false);}else{_44.set("disabled",true);_44.set("checked",false);}}},onFormLoad:function(){if(document.getElementById("amd_no")){m._config.amendmentNumber=document.getElementById("amd_no").value;}m._config.bgCurCode=dj.byId("bg_cur_code").get("value");m._config.beneficiary.name=dj.byId("beneficiary_name").get("value");m._config.beneficiary.addressLine1=dj.byId("beneficiary_address_line_1").get("value");m._config.beneficiary.addressLine2=dj.byId("beneficiary_address_line_2").get("value");m._config.beneficiary.dom=dj.byId("beneficiary_dom").get("value");m._config.applicant.entity=dj.byId("entity")?dj.byId("entity").get("value"):"";m._config.applicant.name=dj.byId("applicant_name").get("value");m._config.applicant.addressLine1=dj.byId("applicant_address_line_1").get("value");m._config.applicant.addressLine2=dj.byId("applicant_address_line_2").get("value");m._config.applicant.dom=dj.byId("applicant_dom").get("value");m._config.expDate=dj.byId("exp_date").get("displayedValue");m._config.renewFlag=dj.byId("renew_flag").get("checked");m._config.bgTypeCode=dj.byId("bg_type_code")?dj.byId("bg_type_code").get("value"):"";m.setCurrency(dj.byId("net_exposure_cur_code"),["net_exposure_amt"]);var _46=d.byId("tender-exp-date");if(dj.byId("contract_ref").get("value")==="TEND"){m.animate("fadeIn",_46);}else{dj.byId("tender_expiry_date").set("value",null);m.animate("fadeOut",_46);}if(d.byId("amd_no_date_bg_display_div")){if(dj.byId("prod_stat_code").get("value")==="08"){m.animate("fadeIn",d.byId("amd_no_date_bg_display_div"));d.byId("amd_no_date_bg_display_div").style.display="block";dj.byId("amd_date").set("disabled",false);}else{d.byId("amd_no_date_bg_display_div").style.display="none";}}if(d.byId("amd_no_date_display_div")){d.byId("amd_no_date_display_div").style.display="none";}m.setCurrency(dj.byId("bg_cur_code"),["tnx_amt","bg_amt","bg_liab_amt","bg_available_amt"]);if(dj.byId("claim_cur_code")&&dj.byId("claim_amt")){m.setCurrency(dj.byId("claim_cur_code"),["claim_amt"]);}m.setCurrency(dj.byId("contract_cur_code"),["contract_amt"]);var _47=dj.byId("advising_bank_name");var _48=dj.byId("adv_bank_conf_req");if(_47&&_47.get("value")===""){_48.set("disabled",true);_48.set("checked",false);}m.toggleFields(_48.get("checked")===true,["confirming_bank_address_line_2","confirming_bank_dom"],["confirming_bank_name","confirming_bank_address_line_1"]);if(_48.get("checked")===true){m.animate("fadeIn",d.byId("confirming_bank_name_img"));}else{m.animate("fadeOut",d.byId("confirming_bank_name_img"));}var _49=dj.byId("iss_date_type_code");if(_49){m.toggleFields((_49.get("value")==="99"),null,["iss_date_type_details"]);}var _4a=dj.byId("exp_date_type_code");if(_4a){m.toggleFields((_4a.get("value")!=="01"),null,["exp_date"]);m.toggleFields(_4a.get("value")!=="02",null,["exp_event"]);}var _4b=dj.byId("reduction_authorised");if(_4b){m.toggleFields(_4b.get("value")==="on",null,["reduction_clause"]);}var _4c=dj.byId("reduction_clause");if(_4c){m.toggleFields(_4c.get("value")==="03",null,["reduction_clause_other"]);}var _4d=dj.byId("for_account");if(_4d){m.toggleFields(_4d.get("value")==="on",["alt_applicant_address_line_2","alt_applicant_dom","alt_applicant_address_line_4"],["alt_applicant_name","alt_applicant_address_line_1","alt_applicant_country"]);}var _4e=dj.byId("consortium");if(_4e){m.toggleFields(_4e.get("value")==="on",null,["net_exposure_cur_code","net_exposure_amt","consortium_details"],true,true);}var _4f=dj.byId("issuing_bank_type_code");if(_4f){m.toggleFields((_4f.get("value")==="02"),["issuing_bank_address_line_2","issuing_bank_dom","issuing_bank_address_line_4","issuing_bank_reference"],["issuing_bank_name","issuing_bank_address_line_1"]);if(_4f.get("value")==="01"){dojo.byId("issuing_bank_name_img").style.display="display:none";}else{if(_4f.get("value")==="02"){dojo.byId("issuing_bank_name_img").style.display="display:block";}}}var _50=dj.byId("bg_type_code");if(_50){_50.onChange(_50.get("value"));}var _51=dj.byId("delivery_to");if(_51){m.toggleFields(_51.get("value")==="04",null,["delivery_to_other"]);}var _52=dj.byId("bg_rule");if(_52){m.toggleFields((_52.get("value")==="99"),null,["bg_rule_other"]);}var _53=dj.byId("text_language");if(_53){m.toggleFields((_53.get("value")==="*"),null,["text_language_other"]);}var _54=dj.byId("bg_text_type_code");if(_54){m.toggleFields(_54.get("value")==="03",null,["bg_text_type_details"]);}if(dj.byId("prod_stat_code").get("value")==="79"||dj.byId("prod_stat_code").get("value")==="78"){dj.byId("action_req_code").set("value","07");dj.byId("action_req_code").set("readOnly",true);}else{if(dj.byId("prod_stat_code").get("value")==="01"||dj.byId("prod_stat_code").get("value")==="10"||dj.byId("prod_stat_code").get("value")==="06"){dj.byId("action_req_code").set("readOnly",true);dj.byId("action_req_code").set("disabled",true);}else{if(dj.byId("prod_stat_code").get("value")==="12"){dj.byId("action_req_code").set("value","12");dj.byId("action_req_code").set("readOnly",true);dj.byId("action_req_code").set("disabled",true);}else{if(dj.byId("prod_stat_code").get("value")==="31"){dj.byId("action_req_code").set("readOnly",true);dj.byId("action_req_code").set("disabled",true);}else{dj.byId("action_req_code").set("readOnly",false);dj.byId("action_req_code").set("disabled",false);}}}}if(dj.byId("bg_liab_amt")&&dj.byId("release_amt")){var _55=dojo.number.parse(dj.byId("org_bg_liab_amt").get("value"))||0,_56=dj.byId("release_amt").get("value");if(_56>_55){m.dialog.show("ERROR",m.getLocalization("canNotReleaseTheTransaction"));dj.byId("bg_liab_amt").set("value",_55);}else{var _57=_55-_56;dj.byId("bg_liab_amt").set("value",_57);}}if(dj.byId("prod_stat_code")){if(dj.byId("mode")&&dj.byId("mode").get("value")==="RELEASE"){m.toggleRequired("bo_ref_id",false);m.toggleRequired("iss_date",false);m.toggleRequired("bg_liab_amt",false);m.toggleRequired("bg_available_amt",false);}else{_17();var _58=dj.byId("prod_stat_code").get("value");m.toggleFields(!(_58==="01"||_58==="18"),null,["iss_date","bo_ref_id"]);}}var _59=dj.byId("renew_flag");if(_59){d.hitch(_59,m.toggleRenewalDetails,true)();m.toggleFields((dj.byId("renew_on_code").get("value")==="02"),null,["renewal_calendar_date"],true);m.toggleFields(dj.byId("advise_renewal_flag").get("checked"),null,["advise_renewal_days_nb"],true);m.toggleFields(dj.byId("rolling_renewal_flag").get("checked"),null,["rolling_renewal_nb","rolling_cancellation_days","rolling_renew_on_code"],true);if(d.byId("advise_renewal_days_nb")&&d.byId("advise_renewal_days_nb").value===""){dj.byId("advise_renewal_flag").set("checked",false);}var _5a=dj.byId("rolling_renew_on_code");if(_5a){m.toggleFields(_5a.get("value")==="03",["rolling_day_in_month"],["rolling_renew_for_nb"],true);}}var _5b=dj.byId("prod_stat_code"),_5c=dj.byId("bg_liab_amt");if(_5c&&_5b&&(_5b.get("value")==="01"||_5b.get("value")==="10"||_5b.get("value")==="06")){_5c.set("readOnly",true);_5c.set("disabled",true);}else{if(_5c){if(_5b.get("value")==="08"){_1c();}_5c.set("readOnly",false);_5c.set("disabled",false);}}var _5d=dj.byId("bg_available_amt");if(_5d&&_5b&&(_5b.get("value")==="01"||_5b.get("value")==="10"||_5b.get("value")==="06")){_5d.set("readOnly",true);_5d.set("disabled",true);}else{_5d.set("readOnly",false);_5d.set("disabled",false);}if(dj.byId("claim_reference")&&dj.byId("claim_present_date")&&dj.byId("claim_amt")&&dj.byId("claim_cur_code")){if(dj.byId("prod_stat_code")&&(dj.byId("prod_stat_code").get("value")==="84"||dj.byId("prod_stat_code").get("value")==="85")){m.animate("fadeIn",d.byId("claimDetails"));dj.byId("claim_reference").set("required",true);dj.byId("claim_present_date").set("required",true);dj.byId("claim_amt").set("required",true);dj.byId("claim_cur_code").set("value",dj.byId("bg_cur_code").get("value"));if(dj.byId("prod_stat_code").get("value")==="85"&&dj.byId("claim_reference_hidden")&&dj.byId("claim_present_date_hidden")&&dj.byId("claim_amt_hidden")){dj.byId("claim_reference").set("value",dj.byId("claim_reference_hidden").get("value"));dj.byId("claim_present_date").set("value",dj.byId("claim_present_date_hidden").get("value"));dj.byId("claim_amt").set("value",dj.byId("claim_amt_hidden").get("value"));}}else{m.animate("fadeOut",d.byId("claimDetails"));dj.byId("claim_reference").set("disabled",true);dj.byId("claim_present_date").set("disabled",true);dj.byId("claim_amt").set("disabled",true);dj.byId("claim_cur_code").set("disabled",true);dj.byId("claim_reference").set("value","");dj.byId("claim_present_date").set("value",null);dj.byId("claim_amt").set("value","");dj.byId("claim_cur_code").set("value","");}}var _5e=dj.byId("prod_stat_code");if(dj.byId("doc_ref_no")&&_5b&&(_5b.get("value")==="16"||_5b.get("value")==="24")){dj.byId("doc_ref_no").set("disabled",false);}else{if(dj.byId("doc_ref_no")){dj.byId("doc_ref_no").set("disabled",true);}}if(dj.byId("facility_id")){m._config.isLoading=true;dj.byId("facility_id").onChange();m.connect("limit_id","onChange",m.validateLimitBookingAmount);m.connect("booking_amt","onBlur",m.validateLimitBookingAmount);}if(dj.byId("facility_mandatory")&&dj.byId("facility_mandatory").get("value")==="true"){m.toggleRequired("facility_id",true);}m.populateGridOnLoad("bg");if(dj.byId("lead_bank_flag")&&dj.byId("lead_bank_flag").get("value")==="Y"){m.toggleRequired("processing_bank_name",true);m.toggleRequired("processing_bank_address_line_1",true);}else{m.toggleRequired("processing_bank_name",false);m.toggleRequired("processing_bank_address_line_1",false);dijit.byId("dijit_layout_TabContainer_0").removeChild(dijit.byId("dijit_layout_ContentPane_2"));}if(dj.byId("extend_pay_date")&&dj.byId("latest_date_reply")){if(dj.byId("prod_stat_code")&&(dj.byId("prod_stat_code").get("value")==="86")){m.animate("fadeIn",d.byId("ExtendPay"));dj.byId("extend_pay_date").set("disabled",false);dj.byId("latest_date_reply").set("disabled",false);}else{m.animate("fadeOut",d.byId("ExtendPay"));dj.byId("extend_pay_date").set("disabled",true);dj.byId("latest_date_reply").set("disabled",true);dj.byId("extend_pay_date").set("value",null);dj.byId("latest_date_reply").set("value",null);}}m.setRenewalAmountOnFormLoad();if(dj.byId("tnx_type_code")&&(dj.byId("tnx_type_code").get("value")==="15"||(dj.byId("tnx_type_code").get("value")==="13"))&&(m._config.enable_to_edit_customer_details_bank_side=="false")){dojo.style("transactionDetails","display","none");}else{if(m._config.enable_to_edit_customer_details_bank_side=="false"){dojo.style("transactionDetails","display","none");var _5f=["iss_date_type_code","exp_event","reduction_clause","exp_date_type_code","exp_date","exp_event,reduction_authorised","reduction_authorised","iss_date_type_details","reduction_clause_other","entity","applicant_name","applicant_address_line_1","bg_type_details","applicant_address_line_2","applicant_dom","applicant_country","applicant_reference","applicant_contact_number","applicant_email","business_line","for_account","alt_applicant_name","alt_applicant_address_line_1","alt_applicant_address_line_2","issuing_bank_reference","alt_applicant_dom","alt_applicant_country","beneficiary_name","beneficiary_address_line_1","beneficiary_address_line_2","beneficiary_dom","beneficiary_country","beneficiary_reference","beneficiary_contact_number","beneficiary_email","contact_name","contact_address_line_1","contact_address_line_2","contact_dom","contact_email","contact_country","contact_contact_number","bg_liab_amt","consortium","consortium_details","net_exposure_cur_code","net_exposure_amt","open_chrg_brn_by_code_1","open_chrg_brn_by_code_2","corr_chrg_brn_by_code_1","corr_chrg_brn_by_code_2","bg_release_flag","renew_flag","renew_on_code","renewal_calendar_date","renew_for_nb","renew_for_period","advise_renewal_flag","rolling_renewal_flag","rolling_renew_on_code","rolling_renew_for_nb","rolling_renew_for_period","rolling_day_in_month","rolling_renewal_nb","rolling_cancellation_days","renew_amt_code_1","renew_amt_code_2","projected_expiry_date","final_expiry_date","issuing_bank_type_code","issuing_bank_name","issuing_bank_address_line_1","issuing_bank_address_line_2","bg_type_code","bg_rule","bg_rule_other","bg_text_type_code","bg_text_type_details","text_language","text_language_other","contract_ref","contract_date","contract_cur_code","contract_amt","contract_pct","narrative_additional_instructions","license_lookup","bg_amt","bg_liab_amt","bg_cur_code","advising_bank_name","advising_bank_address_line_1","advising_bank_address_line_2","advising_bank_dom","advising_bank_reference","adv_bank_conf_req","bg_available_amt"];d.forEach(_5f,function(id){var _60=dj.byId(id);if(_60){m.toggleRequired(_60,false);}});}}},beforeSubmitValidations:function(){var _61=dj.byId("bg_text_type_code");var _62=d.byId("loading_bg_text_type_code");var _63="00";if(_62&&(_62.value==="02"||_62.value==="04")&&_62.value===_61.value){_63="11";}var _64=dj.byId("sub_tnx_type_code")?dj.byId("sub_tnx_type_code").get("value"):"";if(_63==="00"&&_61&&(_61.value==="02"||_61.value==="04")){return m.checkForAttachments();}if(_64==="05"&&dj.byId("prod_stat_code")&&dj.byId("prod_stat_code").get("value")!="01"){var _65=dj.byId("release_amt");var _66=dj.byId("org_bg_liab_amt");var _67=dj.byId("release_amt")?dj.byId("release_amt").get("value"):"";var _68=dojo.number.parse(_66.get("value"))||0;if(_65&&_66&&(_67<=0||_67>_68)&&_68!="0"){m._config.onSubmitErrorMsg=m.getLocalization("canNotReleaseTheTransaction");dj.byId("bg_liab_amt").set("value",_68);return false;}else{if(_68==="0"){m._config.onSubmitErrorMsg=m.getLocalization("canNotProceedTheTransaction");dj.byId("bg_liab_amt").set("value",_68);return false;}}}if(dj.byId("tnx_type_code")&&dj.byId("tnx_type_code").get("value")==="03"&&_64!="05"&&dj.byId("prod_stat_code")&&dj.byId("prod_stat_code").get("value")!="01"&&dijit.byId("prv_pod_stat_code")&&dijit.byId("prv_pod_stat_code").get("value")==="06"){m._config.onSubmitErrorMsg=m.getLocalization("canNotProceedTheTransaction");dj.byId("bg_liab_amt").set("value",dojo.number.parse(dijit.byId("org_bg_liab_amt").get("value")));return false;}if(!(_8())){return false;}var _69=dj.byId("current_date");var _6a=dj.byId("claim_present_date");if(_6a&&_69&&!m.compareDateFields(_6a,_69)){var _6b=function(){var _6c=dijit.byId("claim_present_date");_6c.focus();_6c.set("state","Error");};m.dialog.show("ERROR",m.getLocalization("claimDateGreaterThanCurrentDateError",[_6a.get("displayedValue"),_69.get("displayedValue")]),"",function(){setTimeout(_6b,500);});return false;}if(dj.byId("prod_stat_code")&&dj.byId("prod_stat_code").get("value")==="84"&&dj.byId("claim_amt")&&dj.byId("claim_amt").get("value")!==""&&dj.byId("tnx_amt")){dj.byId("tnx_amt").set("value",dj.byId("claim_amt").get("value"));}if(dj.byId("booking_amt")&&!isNaN(dj.byId("booking_amt").get("value"))&&dj.byId("limit_review_date")&&dj.byId("facility_date")){if(d.date.compare(dj.byId("limit_review_date").get("value"),new Date(),"date")<0){m._config.onSubmitErrorMsg=m.getLocalization("amendLimitDateExpiry");return false;}}if(dj.byId("bg_amt")&&dj.byId("bg_liab_amt")&&(dj.byId("bg_amt").get("value")<dj.byId("bg_liab_amt").get("value"))){m._config.onSubmitErrorMsg=m.getLocalization("canNotMoreThanTranAmt");dj.byId("bg_liab_amt").set("value","");return false;}if(dj.byId("bg_amt")&&dj.byId("bg_available_amt")&&(dj.byId("bg_amt").get("value")<dj.byId("bg_available_amt").get("value"))){m._config.onSubmitErrorMsg=m.getLocalization("AvailBGamtcanNotMoreThanTranAmt");dj.byId("bg_available_amt").set("value","");return false;}return m.validateLSAmtSumAgainstTnxAmt("bg");},validateMT777Fields:function(){var _6d=dj.byId("current_date");var _6e=dj.byId("latest_date_reply");var _6f=dj.byId("extend_pay_date");var _70=dj.byId("iss_date");var _71=dj.byId("exp_date");if(_6e&&_6f){if(_6d&&!m.compareDateFields(_6f,_6d)){this.invalidMessage=m.getLocalization("dateOfExtendDatelessThanCurrentDate",[_localizeDisplayDate(_6f)]);return false;}else{if(_70&&!m.compareDateFields(_70,_6f)){this.invalidMessage=m.getLocalization("dateOfExtendDateGreaterThanIssueDate",[_localizeDisplayDate(_6f),_localizeDisplayDate(_70)]);return false;}}if(_6d&&!m.compareDateFields(_6d,_6e)){this.invalidMessage=m.getLocalization("latestDateForReplyGreaterThanCurrentDate",[_localizeDisplayDate(_6e)]);return false;}else{if(_71&&!m.compareDateFields(_6e,_71)){this.invalidMessage=m.getLocalization("latestDateForReplyLessThanExpiryDate",[_localizeDisplayDate(_6e),_localizeDisplayDate(_71)]);return false;}}}return true;}});})(dojo,dijit,misys);dojo.require("misys.client.binding.bank.report_bg_client");}