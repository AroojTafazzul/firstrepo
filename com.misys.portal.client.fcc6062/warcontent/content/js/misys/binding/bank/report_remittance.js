/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.bank.report_remittance"]){dojo._hasResource["misys.binding.bank.report_remittance"]=true;dojo.provide("misys.binding.bank.report_remittance");dojo.require("dojo.parser");dojo.require("dijit.layout.TabContainer");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("misys.widget.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("misys.form.PercentNumberTextBox");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.widget.Collaboration");dojo.require("misys.form.common");dojo.require("misys.form.file");dojo.require("misys.form.addons");dojo.require("misys.validation.common");dojo.require("misys.form.BusinessDateTextBox");dojo.require("misys.binding.cash.ft_common");dojo.require("misys.binding.core.beneficiary_advice_common");(function(d,dj,m){function _1(){if(dj.byId("applicant_act_name").get("value")!==""&&dj.byId("applicant_act_product_types").get("value")!==""){m.toggleSections();}};var _2=new Array();function _3(){var _4,_5;if(dj.byId("cpty_bank_country")){_4=dj.byId("cpty_bank_country").get("value");}if(dj.byId("ft_cur_code")){_5=dj.byId("ft_cur_code").get("value");}else{if(dj.byId("ft_cur_code_unsigned")){_5=dj.byId("ft_cur_code_unsigned").get("value");}}var _6=_4+_5;var _7=_4+"**";var _8="**"+_5;var _9=_4+"ALL";var _a="**"+"**";var i,_b;if(m._config.countryCurrencyPair[_6]==="Y"){if(m._config.clearingCodes[_6].length>=1){for(i=0;i<m._config.clearingCodes[_6].length;i++){_b=m._config.clearingCodes[_6][i];if(m._config.clearingCodesMandatory[_b]==="Y"){_c=true;}_2.push(_b);}}}if(m._config.countryCurrencyPair[_7]==="Y"){if(m._config.clearingCodes[_7].length>=1){for(i=0;i<m._config.clearingCodes[_7].length;i++){_b=m._config.clearingCodes[_7][i];if(m._config.clearingCodesMandatory[_b]==="Y"){_c=true;}_2.push(_b);}}}if(m._config.countryCurrencyPair[_8]==="Y"){if(m._config.clearingCodes[_8].length>=1){for(i=0;i<m._config.clearingCodes[_8].length;i++){_b=m._config.clearingCodes[_8][i];if(m._config.clearingCodesMandatory[_b]==="Y"){_c=true;}_2.push(_b);}}}if(m._config.countryCurrencyPair[_9]==="Y"){if(m._config.clearingCodes[_9].length>=1){for(i=0;i<m._config.clearingCodes[_9].length;i++){_b=m._config.clearingCodes[_9][i];if(m._config.clearingCodesMandatory[_b]==="Y"){_c=true;}_2.push(_b);}}}if(m._config.countryCurrencyPair[_a]==="Y"){if(m._config.clearingCodes[_a].length>=1){for(i=0;i<m._config.clearingCodes[_a].length;i++){_b=m._config.clearingCodes[_a][i];if(m._config.clearingCodesMandatory[_b]==="Y"){_c=true;}_2.push(_b);}}}};function _d(){var _e=true;if(dj.byId("ordering_customer_swift_bic_code").get("value").length===0){_e=false;}dj.byId("ordering_customer_swift_bic_code").set("disabled",false);dj.byId("ordering_customer_bank_name").set("disabled",_e);dj.byId("ordering_customer_bank_name").set("value","");dj.byId("ordering_customer_bank_address_line_1").set("disabled",_e);dj.byId("ordering_customer_bank_address_line_1").set("value","");dj.byId("ordering_customer_bank_address_line_2").set("disabled",_e);dj.byId("ordering_customer_bank_address_line_2").set("value","");dj.byId("ordering_customer_bank_dom").set("disabled",_e);dj.byId("ordering_customer_bank_dom").set("value","");dj.byId("ordering_customer_bank_country").set("disabled",_e);dj.byId("ordering_customer_bank_country").set("value","");dj.byId("ordering_customer_iso_img").set("disabled",false);dj.byId("ordering_customer_bank_country_img").set("disabled",_e);};function _f(){var _10=true;if(dj.byId("intermediary_bank_swift_bic_code").get("value").length===0){_10=false;}dj.byId("intermediary_bank_swift_bic_code").set("disabled",false);dj.byId("intermediary_bank_name").set("disabled",_10);dj.byId("intermediary_bank_address_line_1").set("disabled",_10);dj.byId("intermediary_bank_address_line_2").set("disabled",_10);dj.byId("intermediary_bank_dom").set("disabled",_10);dj.byId("intermediary_bank_country").set("disabled",_10);dj.byId("inter_bank_iso_img").set("disabled",false);dj.byId("intermediary_bank_country_img").set("disabled",_10);};function _11(){var _12=true;if(dj.byId("cpty_bank_swift_bic_code").get("value").length===0){_12=false;}dj.byId("cpty_bank_swift_bic_code").set("disabled",!_12);m.toggleRequired("cpty_bank_swift_bic_code",_12);if(dj.byId("cpty_bank_name")){dj.byId("cpty_bank_name").set("readOnly",_12);}m.toggleRequired("cpty_bank_name",!_12);if(dj.byId("cpty_bank_address_line_1")){dj.byId("cpty_bank_address_line_1").set("readOnly",_12);}m.toggleRequired("cpty_bank_address_line_1",!_12);if(dj.byId("cpty_bank_address_line_2")){dj.byId("cpty_bank_address_line_2").set("readOnly",_12);}if(dj.byId("cpty_bank_dom")){dj.byId("cpty_bank_dom").set("readOnly",_12);}if(dj.byId("cpty_bank_country")){dj.byId("cpty_bank_country").set("readOnly",_12);}m.toggleRequired("cpty_bank_country",!_12);if(dj.byId("bank_iso_img")){dj.byId("bank_iso_img").set("disabled",!_12);}};function _13(){var _14=true;if(dj.byId("ordering_bank_swift_bic_code").get("value").length===0){_14=false;}dj.byId("ordering_bank_swift_bic_code").set("readOnly",true);dj.byId("ordering_institution_name").set("disabled",_14);dj.byId("ordering_institution_name").set("value","");dj.byId("ordering_institution_address_line_1").set("disabled",_14);dj.byId("ordering_institution_address_line_1").set("value","");dj.byId("ordering_institution_address_line_2").set("disabled",_14);dj.byId("ordering_institution_address_line_2").set("value","");dj.byId("ordering_institution_dom").set("disabled",_14);dj.byId("ordering_institution_dom").set("value","");dj.byId("ordering_institution_country").set("disabled",_14);dj.byId("ordering_institution_country").set("value","");dj.byId("bank_iso_img").set("disabled",false);dj.byId("ordering_institution_country_img").set("disabled",_14);m.toggleRequired("ordering_bank_swift_bic_code",false);m.toggleRequired("ordering_institution_name",false);m.toggleRequired("ordering_institution_address_line_1",false);m.toggleRequired("ordering_institution_address_line_2",false);m.toggleRequired("ordering_institution_dom",false);m.toggleRequired("ordering_institution_country",false);};var _c=false;function _15(){var _16;dj.byId("beneficiary_bank_clearing_code_desc").reset();_16=dj.byId("beneficiary_bank_clearing_code_desc");var _17,_18,i,j,_19;var _1a=[];for(i=0;i<m._config.countryCcy.length;i++){_17=m._config.countryCcy[i];if(m._config.countryCurrencyPair[_17]==="Y"){if(m._config.clearingCodes[_17].length>=1){for(j=0;j<m._config.clearingCodes[_17].length;j++){_19=m._config.clearingCodes[_17][j];_18={"name":m._config.clearingCodesDescription[_17][j],"value":_19};_1a.push(_18);}}}}_16.store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_1a}});if(dj.byId("beneficiary_bank_clearing_code_desc_no_send").get("value")!==""){_16.set("value",dj.byId("beneficiary_bank_clearing_code_desc_no_send").get("value"));dj.byId("beneficiary_bank_clearing_code_desc_no_send").set("value","");}};function _1b(){var _1c;_1c=dj.byId("intermediary_bank_clearing_code_desc");if(dj.byId("intermediary_bank_clearing_code_desc")){dj.byId("intermediary_bank_clearing_code_desc").reset();}var _1d,_1e,_1f,i,j;var _20=[];if(dj.byId("intermediary_bank_clearing_code_desc")){for(i=0;i<m._config.countryCcy.length;i++){_1d=m._config.countryCcy[i];if(m._config.countryCurrencyPair[_1d]==="Y"){if(m._config.clearingCodes[_1d].length>=1){for(j=0;j<m._config.clearingCodes[_1d].length;j++){_1f=m._config.clearingCodes[_1d][j];_1e={"name":m._config.clearingCodesDescription[_1d][j],"value":_1f};_20.push(_1e);}}}}_1c.store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_20}});if(dj.byId("intermediary_bank_clearing_code_desc_no_send").get("value")!==""){_1c.set("value",dj.byId("intermediary_bank_clearing_code_desc_no_send").get("value"));dj.byId("intermediary_bank_clearing_code_desc_no_send").set("value","");}}};function _21(){if(dj.byId("charge_act_name")&&dj.byId("debit_account_for_charges")){dj.byId("debit_account_for_charges").set("value",dj.byId("charge_act_name").get("value"));}};d.mixin(m,{bind:function(){m.setValidation("fx_tolerance_rate",m.validateToleranceAndExchangeRate);m.setValidation("fx_exchange_rate",m.validateToleranceAndExchangeRate);m.connect("charge_act_name","onChange",_21);m.bindRecurringFields();m.connect("prod_stat_code","onChange",m.populateReportingStatus);m.connect("entity","onChange",function(){dj.byId("display_entity").set("value",dj.byId("entity").get("value"));m.setApplicantReference();});m.connect("beneficiary_name","onBlur",function(){dj.byId("counterparty_details_name_1").set("value",dj.byId("beneficiary_name").get("value"));});m.connect("applicant_act_name","onChange",function(){d.query("#display_account_row div")[0].innerHTML=dj.byId("applicant_act_name").get("value");});m.connect("button_intrmdt_ok","onClick",_1);m.setValidation("iss_date",m.validateCashProcessingDate);m.setValidation("request_date",m.validateCashRequestDate);m.setValidation("cpty_bank_country",m.validateCountry);m.setValidation("intermediary_bank_country",m.validateCountry);m.setValidation("ordering_institution_country",m.validateCountry);m.setValidation("ordering_customer_bank_country",m.validateCountry);m.connect("branch_address_flag","onClick",function(){if(this.get("checked")){m.animate("wipeIn",d.byId("bankBranchContent"));}else{dj.byId("beneficiary_bank_branch_address_line_1").set("value","");dj.byId("beneficiary_bank_branch_address_line_2").set("value","");dj.byId("beneficiary_bank_branch_dom").set("value","");dj.byId("beneficiary_bank_branch_address_line_1").set("required",false);dj.byId("beneficiary_bank_branch_address_line_2").set("required",false);dj.byId("beneficiary_bank_branch_dom").set("required",false);m.animate("wipeOut",d.byId("bankBranchContent"));}});m.connect("ordering_customer_swift_bic_code","onChange",function(){var _22=this.get("value");m.toggleFields((_22!=""),null,["ordering_customer_bank_account"]);dj.byId("ordering_customer_bank_account").set("disabled",false);});m.connect("ordering_institution_swift_bic_code","onChange",function(){var _23=this.get("value");m.toggleFields((_23!=""),null,["ordering_institution_account"]);dj.byId("ordering_institution_account").set("disabled",false);});m.connect("processing_date","onChange",function(){var _24=this.get("value");if(dj.byId("request_date")){dj.byId("request_date").set("value",_24);}});m.connect("beneficiary_bank_clearing_code","onChange",function(){var val=this.get("value");dj.byId("beneficiary_bank_clearing_code_desc").set("value","");if(val!==""&&val.length>0){dj.byId("beneficiary_bank_clearing_code_desc").set("value",val.substring(0,2));if(dj.byId("beneficiary_bank_clearing_code_desc").get("value")===""){this.set("value","");this.focus();this.set("state","Error");dj.hideTooltip(this.domNode);dj.showTooltip(m.getLocalization("CCValidationUnmatchedPrefixError"),this.domNode,0);return false;}}});m.connect("intermediary_bank_clearing_code","onChange",function(){var val=this.get("value");dj.byId("intermediary_bank_clearing_code_desc").set("value","");if(val!==""){dj.byId("intermediary_bank_clearing_code_desc").set("value",val.substring(0,2));if(dj.byId("intermediary_bank_clearing_code_desc").get("value")===""){this.set("value","");this.focus();this.set("state","Error");dj.hideTooltip(this.domNode);dj.showTooltip(m.getLocalization("CCValidationUnmatchedPrefixError"),this.domNode,0);return false;}}});m.connect("beneficiary_bank_clearing_code_desc","onChange",function(){var _25=this.get("value");var _26=dj.byId("beneficiary_bank_clearing_code");if(_26){var _27=_26.get("value");if(_27!==""&&_27.substring(0,2)!=_25){_26.focus();_26.set("state","Error");dj.hideTooltip(_26.domNode);dj.showTooltip(m.getLocalization("CCValidationUnmatchedPrefixError"),_26.domNode,0);return false;}}});m.connect("intermediary_bank_clearing_code_desc","onChange",function(){var _28=this.get("value");var _29=dj.byId("intermediary_bank_clearing_code");if(_29){var _2a=_29.get("value");if(_2a!==""&&_2a.substring(0,2)!=_28){_29.focus();_29.set("state","Error");dj.hideTooltip(_29.domNode);dj.showTooltip(m.getLocalization("CCValidationUnmatchedPrefixError"),_29.domNode,0);return false;}}});if(dj.byId("fx_rates_type_temp")&&dj.byId("fx_rates_type_temp").get("value")!==""){var _2b=0;if(dj.byId("fx_nbr_contracts")&&dj.byId("fx_nbr_contracts").get("value")>0){_2b=dj.byId("fx_nbr_contracts").get("value");m.bindTheFXTypes(_2b,"Y");}}},showbeneficiary_bankClearingCodeFormat:function(){var _2c=dj.byId("beneficiary_bank_clearing_code_desc").get("value");if(_2c!==""){var _2d=m._config.clearingCodesFormat[_2c];var _2e=m._config.clearingCodesRegExp[_2c];if(_2d!==""){m.dialog.show("ALERT",m.getLocalization("clearingCodeFormatMessage",[_2d,_2e]));}}},showintermediary_bankClearingCodeFormat:function(){var _2f=dj.byId("intermediary_bank_clearing_code_desc").get("value");if(_2f!==""){var _30=m._config.clearingCodesFormat[_2f];var _31=m._config.clearingCodesRegExp[_2f];if(_30!==""){m.dialog.show("ALERT",m.getLocalization("clearingCodeFormatMessage",[_30,_31]));}}},showFields:function(){var _32=dj.byId("entity").domNode;if(dj.byId("entity").get("value")===""){dj.showTooltip(m.getLocalization("remittanceToolTip"),_32,0);var _33=function(){dj.hideTooltip(_32);};var _34=1000;setTimeout(_33,_34);return false;}var _35=dj.byId("applicant_act_name").domNode;if(dj.byId("applicant_act_name").get("value")===""){dj.showTooltip(m.getLocalization("remittanceToolTip"),_35,0);var _36=function(){dj.hideTooltip(_35);};var _37=1000;setTimeout(_36,_37);return false;}m.animate("wipeOut",d.byId("content1"),_showContent2);return true;},onFormLoad:function(){m.populateReportingStatus();if(dj.byId("beneficiary_bank_clearing_code_desc")){_15();}_1b();if(dj.byId("cpty_bank_swift_bic_code")){_11();}if(dj.byId("ordering_bank_swift_bic_code")){_13();}if(dj.byId("ordering_customer_swift_bic_code")){_d();}if(dj.byId("intermediary_bank_swift_bic_code")){_f();}m.setApplicantReference();m.showSavedRecurringDetails(false);if(dj.byId("fx_rates_type_temp")&&dj.byId("fx_rates_type_temp").get("value")!==""){if(dj.byId("fx_nbr_contracts")&&dj.byId("fx_nbr_contracts").get("value")>0){m.onloadFXActions();}}},initForm:function(){if(dj.byId("branch_address_flag")){if(dj.byId("branch_address_flag").get("checked")){m.animate("wipeIn",d.byId("bankBranchContent"));}else{dj.byId("beneficiary_bank_branch_address_line_1").set("value","");dj.byId("beneficiary_bank_branch_address_line_2").set("value","");dj.byId("beneficiary_bank_branch_dom").set("value","");dj.byId("beneficiary_bank_branch_address_line_1").set("required",false);dj.byId("beneficiary_bank_branch_address_line_2").set("required",false);dj.byId("beneficiary_bank_branch_dom").set("required",false);m.animate("wipeOut",d.byId("bankBranchContent"));}}},beforeSubmitValidations:function(){if(dj.byId("beneficiary_account")){var _38=dj.byId("beneficiary_account").get("value"),_39="",_3a="";if(dj.byId("beneficiary_bank_clearing_code_desc")){_39=dj.byId("beneficiary_bank_clearing_code_desc").get("value");}var _3b=dj.byId("beneficiary_bank_clearing_code");var _3c=dj.byId("intermediary_bank_clearing_code_desc");var _3d=dj.byId("intermediary_bank_clearing_code");_3();var _3e;if((_39===""&&_3b&&_3b.get("value")!=="")||(_39!==""&&_3b&&_3b.get("value")==="")){_3e=m.getLocalization("CCValidationInvalidClearingCodeDescriptionError",[_3a,_39]);m._config.onSubmitErrorMsg=_3e;_3b.focus();_3b.set("state","Error");return false;}else{if((_3c&&_3c.get("value")===""&&_3d&&_3d.get("value")!=="")||(_3c&&_3c.get("value")!==""&&_3d&&_3d.get("value")==="")){_3e=m.getLocalization("CCValidationInvalidClearingCodeDescriptionError",[_3a,_39]);m._config.onSubmitErrorMsg=_3e;_3d.focus();_3d.set("state","Error");return false;}}if(_39!==""){if(dj.byId("beneficiary_bank_clearing_code")){_3a=dj.byId("beneficiary_bank_clearing_code").get("value");}if(_2&&_2.indexOf(_39)<0){_3e=m.getLocalization("beneAccountCCValidationUnsupportedClearingCodeError");m._config.onSubmitErrorMsg=_3e;_3b.focus();_3b.set("state","Error");return false;}var _3f="N";if(_39==="SC"){if(!m.isIBAN(_38)){_3f="Y";}}var _40=m._config.clearingCodesRegExp[_39];var _41;var _42;if(_3f==="Y"){if(_39!==_3a.substring(0,_39.length)){_3e=m.getLocalization("beneAccountCCValidationPrefixStartsWithError",[_3a,_39]);m._config.onSubmitErrorMsg=_3e;_3b.focus();_3b.set("state","Error");return false;}_3a=_3a.substring(_39.length,_3a.length);try{_41=new RegExp(_40);}catch(Error){_42=dj.byId("beneficiary_bank_clearing_code_desc").store._itemsByIdentity[_39].name;_3e=m.getLocalization("invalidRegularExpressionError",[_42]);m._config.onSubmitErrorMsg=_3e;return false;}if(!_41.test(_3a)){_3e=m.getLocalization("beneAccountCCValidationError");m._config.onSubmitErrorMsg=_3e;_3b.focus();_3b.set("state","Error");return false;}}if(m._config.clearingCodesMandatory[_39]==="Y"){if(_3a+"S"==="S"){_3e=m.getLocalization("beneAccountCCValidationMandatoryError");m._config.onSubmitErrorMsg=_3e;_3b.focus();_3b.set("state","Error");return false;}if(_39!==_3a.substring(0,_39.length)){_3e=m.getLocalization("beneAccountCCValidationPrefixStartsWithError",[_3a,_39]);m._config.onSubmitErrorMsg=_3e;_3b.focus();_3b.set("state","Error");return false;}_3a=_3a.substring(_39.length,_3a.length);try{_41=new RegExp(_40);}catch(Error){_42=dj.byId("beneficiary_bank_clearing_code_desc").store._itemsByIdentity[_39].name;_3e=m.getLocalization("invalidRegularExpressionError",[_42]);m._config.onSubmitErrorMsg=_3e;return false;}if(!_41.test(_3a)){_3e=m.getLocalization("beneAccountCCValidationError");m._config.onSubmitErrorMsg=_3e;_3b.focus();_3b.set("state","Error");return false;}}else{if(m._config.clearingCodesMandatory[_39]==="N"){if((_3a+"S"!=="S")){if(_39!==_3a.substring(0,_39.length)){_3e=m.getLocalization("beneAccountCCValidationPrefixStartsWithError",[_3a,_39]);m._config.onSubmitErrorMsg=_3e;_3b.focus();_3b.set("state","Error");return false;}_3a=_3a.substring(_39.length,_3a.length);try{_41=new RegExp(_40);}catch(Error){_42=dj.byId("beneficiary_bank_clearing_code_desc").store._itemsByIdentity[_39].name;_3e=m.getLocalization("invalidRegularExpressionError",[_42]);m._config.onSubmitErrorMsg=_3e;return false;}if(!_41.test(_3a)){_3e=m.getLocalization("beneAccountCCValidationError");m._config.onSubmitErrorMsg=_3e;_3b.focus();_3b.set("state","Error");return false;}}}else{if(_3a+"S"!=="S"||_39+"S"!=="S"){_3e=m.getLocalization("beneAccountCCValidationNoRequiredError");m._config.onSubmitErrorMsg=_3e;_3b.focus();_3b.set("state","Error");return false;}}}}else{if(_c){_3e=m.getLocalization("beneAccountCCValidationMandatoryError");m._config.onSubmitErrorMsg=_3e;_3b.focus();_3b.set("state","Error");return false;}}if(dj.byId("sub_product_code").get("value")==="FI103"||dj.byId("sub_product_code").get("value")==="MT103"){if(dj.byId("charge_act_cur_code")&&dj.byId("base_cur_code")&&dj.byId("ft_cur_code")&&("S"+dj.byId("charge_act_cur_code").get("value"))!=="S"&&(dj.byId("charge_act_cur_code").get("value")!==dj.byId("base_cur_code").get("value")&&dj.byId("charge_act_cur_code").get("value")!==dj.byId("ft_cur_code").get("value"))){m._config.onSubmitErrorMsg=m.getLocalization("invalidDebitChargeAccount",[dj.byId("charge_act_name").get("value")]);return false;}}if(dj.byId("cpty_bank_country")){var _43=dj.byId("cpty_bank_country").get("value");}if(dj.byId("ft_cur_code")){var _44=dj.byId("ft_cur_code").get("value");}if(_43!==""&&_44!==""){var _45=_43+_44;var _46=_43+"ALL";if(m._config.ibanMandatory[_45]==="Y"||m._config.ibanMandatory[_46]==="Y"){if(!m.isIBAN(_38)){m._config.onSubmitErrorMsg=m.getLocalization("invalidIBANAccNoError",[_38]);return false;}}}}return true;}});})(dojo,dijit,misys);dojo.require("misys.client.binding.bank.report_remittance_client");}