/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.bank.report_tf"]){dojo._hasResource["misys.binding.bank.report_tf"]=true;dojo.provide("misys.binding.bank.report_tf");dojo.require("dijit.layout.TabContainer");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.Form");dojo.require("dijit.form.FilteringSelect");dojo.require("misys.form.file");dojo.require("misys.form.addons");dojo.require("misys.form.SimpleTextarea");dojo.require("dijit.Editor");dojo.require("misys.widget.Dialog");dojo.require("dojo.data.ItemFileReadStore");dojo.require("dijit.form.DateTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("misys.binding.trade.ls_common");dojo.require("misys.form.SimpleTextarea");dojo.require("dojo.data.ItemFileReadStore");dojo.require("dijit.ProgressBar");dojo.require("misys.widget.Collaboration");dojo.require("misys.form.PercentNumberTextBox");dojo.require("misys.binding.common.bank_create_fx");(function(d,dj,m){d.mixin(m._config,{xmlTransform:function(_1){var _2="<tf_tnx_record>";if(_1.indexOf(_2)!==-1){var _3=m._config.xmlTagName,_4=_3?["<",_3,">"]:[],_5="</tf_tnx_record>",_6="";_6=_1.substring(_2.length,(_1.length-_5.length));_4.push(_6);if(dj.byId("gridLicense")&&dj.byId("gridLicense").store&&dj.byId("gridLicense").store!==null&&dj.byId("gridLicense").store._arrayOfAllItems.length>0){_4.push("<linked_licenses>");dj.byId("gridLicense").store.fetch({query:{REFERENCEID:"*"},onComplete:dojo.hitch(dj.byId("gridLicense"),function(_7,_8){dojo.forEach(_7,function(_9){_4.push("<license>");_4.push("<ls_ref_id>",_9.REFERENCEID,"</ls_ref_id>");_4.push("<bo_ref_id>",_9.BO_REF_ID,"</bo_ref_id>");_4.push("<ls_number>",_9.LS_NUMBER,"</ls_number>");_4.push("<ls_allocated_amt>",_9.LS_ALLOCATED_AMT,"</ls_allocated_amt>");_4.push("<ls_amt>",_9.LS_AMT,"</ls_amt>");_4.push("<ls_os_amt>",_9.LS_OS_AMT,"</ls_os_amt>");_4.push("<converted_os_amt>",_9.CONVERTED_OS_AMT,"</converted_os_amt>");_4.push("<allow_overdraw>",_9.ALLOW_OVERDRAW,"</allow_overdraw>");_4.push("</license>");});})});_4.push("</linked_licenses>");}if(_3){_4.push("</",_3,">");}return _4.join("");}else{return _1;}}});d.mixin(m,{bind:function(){m.setValidation("iss_date",m.validateIssueDate);m.setValidation("maturity_date",m.validateTFMaturityDate);m.setValidation("bo_comment",m.bofunction);m.connect("prod_stat_code","onChange",m.toggleProdStatCodeFields);m.connect("prod_stat_code","onChange",function(){m.toggleFields((this.get("value")!=""&&this.get("value")!="01"&&this.get("value")!="18"),null,["bo_ref_id","fin_liab_amt"]);if(dj.byId("mode")&&dj.byId("mode").get("value")==="RELEASE"){m.toggleRequired("bo_ref_id",false);m.toggleRequired("iss_date",false);m.toggleRequired("fin_liab_amt",false);}});m.connect("license_lookup","onClick",function(){m.getLicenses("tf");});m.connect("fin_cur_code","onChange",function(){m.clearLicenseGrid(this,m._config.finCurCode);});m.connect("maturity_date","onChange",function(){m.clearLicenseGrid(this,m._config.expDate);});m.connect("prod_stat_code","onChange",function(){var _a=dj.byId("prod_stat_code").get("value"),_b=dj.byId("fin_liab_amt");if(_b&&(_a==="01"||_a==="10"||_a==="06")){_b.set("readOnly",true);_b.set("disabled",true);}else{if(_b){_b.set("readOnly",false);_b.set("disabled",false);}}if(m._config.enable_to_edit_customer_details_bank_side=="false"&&dj.byId("prod_stat_code")&&dj.byId("prod_stat_code").get("value")!==""&&dj.byId("fin_liab_amt")&&dj.byId("tnx_type_code")&&dj.byId("tnx_type_code").get("value")!=="15"&&dj.byId("tnx_type_code").get("value")!=="13"){m.toggleRequired("iss_date",false);m.toggleRequired("maturity_date",false);m.toggleRequired("fin_liab_amt",false);}});m.connect("iss_date","onBlur",m.getMaturityDate);m.connect("sub_product_code","onChange",function(){var _c=dj.byId("sub_product_code_text");var _d=false;if(this.get("value")=="IOTHF"){_d=true;}if(this.get("value")=="EOTHF"){_d=true;}m.toggleFields((_d),null,["sub_product_code_text"]);});m.connect("maturity_date","onBlur",m.getMaturityDate);m.connect("tenor","onBlur",m.getMaturityDate);m.connect("fin_cur_code","onChange",function(){m.setCurrency(this,["fin_amt","fin_liab_amt"]);dj.byId("req_cur_code")?dj.byId("req_cur_code").set("value",dj.byId("fin_cur_code").get("value")):"";});m.connect("fin_amt","onBlur",function(){m.setTnxAmt(this.get("value"));});m.connect("fin_liab_amt","onBlur",function(){if(dj.byId("fin_amt")&&(dj.byId("fin_amt").get("value")<dj.byId("fin_liab_amt").get("value"))){var _e=function(){var _f=dijit.byId("fin_liab_amt");_f.set("state","Error");};m.dialog.show("ERROR",m.getLocalization("TFLiabilityAmountCanNotBeGreaterThanTFTotalAmount"),"",function(){setTimeout(_e,0);});}});m.connect("req_pct","onBlur",function(){if(this.get("value")!==null&&!isNaN(this.get("value"))){if(parseFloat(this.get("value"))<=100&&!(parseFloat(this.get("value"))<=0)){var _10=(parseFloat(this.get("value"))*parseFloat(dj.byId("fin_amt").get("value")))/100;dj.byId("req_amt").set("value",_10);}else{displayMessage=misys.getLocalization("incorrectPercentage");this.focus();this.set("state","Error");dj.hideTooltip(this.domNode);dj.showTooltip(displayMessage,this.domNode,0);}}else{if(dj.byId("fin_amt").get("value")!==null&&!isNaN(dj.byId("fin_amt").get("value"))){dj.byId("req_amt").set("value",dj.byId("fin_amt").get("value"));}}});m.connect("fin_amt","onBlur",function(){if(dj.byId("req_pct")&&dj.byId("req_pct").get("value")!==null&&!isNaN(dj.byId("req_pct").get("value"))){if(parseFloat(dj.byId("req_pct").get("value"))<=100&&!(parseFloat(dj.byId("req_pct").get("value"))<=0)){var _11=(parseFloat(dj.byId("req_pct").get("value"))*parseFloat(dj.byId("fin_amt").get("value")))/100;dj.byId("req_amt").set("value",_11);}}else{if(dj.byId("req_amt")){dj.byId("req_amt").set("value",dj.byId("fin_amt").get("value"));}}m.setCurrency(dj.byId("fin_cur_code"),["req_amt"]);});if(dj.byId("fx_rates_type_temp")&&dj.byId("fx_rates_type_temp").get("value")!==""){var _12="N",_13=0;if(dj.byId("fx_nbr_contracts")&&dj.byId("fx_nbr_contracts").get("value")>0){_13=dj.byId("fx_nbr_contracts").get("value");}m.bindTheFXTypes(_13,"Y");}},onFormLoad:function(){m.setCurrency(dj.byId("fin_cur_code"),["tnx_amt","fin_amt","fin_liab_amt","req_amt"]);m.setCurrency(dj.byId("bill_amt_cur_code"),["bill_amt"]);if(dj.byId("fx_rates_type_temp")&&dj.byId("fx_rates_type_temp").get("value")!==""){m.onloadFXActions();}if(dj.byId("mode")&&dj.byId("mode").get("value")==="RELEASE"){m.toggleRequired("iss_date",false);m.toggleRequired("fin_liab_amt",false);}if(dj.byId("prod_stat_code")&&dj.byId("prod_stat_code").get("value")==="01"){var _14=dj.byId("prod_stat_code");var _15=dj.byId("fin_liab_amt");var _16=dj.byId("bo_ref_id");var _17=dj.byId("iss_date");m.toggleFields(!(_14&&(_15||_16||_17||maturity_date)),null,["bo_ref_id","fin_liab_amt"],false,false);}else{if(dj.byId("prod_stat_code").get("value")==="98"&&dj.byId("product_code")&&dj.byId("product_code").get("value")==="TF"){dj.byId("action_req_code").set("value","07");dj.byId("action_req_code").set("readOnly",true);}}m.populateGridOnLoad("tf");if(dj.byId("tnx_type_code")&&(dj.byId("tnx_type_code").get("value")==="15"||(dj.byId("tnx_type_code").get("value")==="13"))&&(m._config.enable_to_edit_customer_details_bank_side=="false")){dojo.style("transactionDetails","display","none");}else{if(m._config.enable_to_edit_customer_details_bank_side=="false"){dojo.style("transactionDetails","display","none");var _18=["entity","applicant_name","applicant_address_line_1","applicant_address_line_2","applicant_dom","applicant_country","applicant_reference","applicant_contact_number","applicant_email","iss_date","tenor","maturity_date","sub_product_code","sub_product_code_text","related_reference","goods_desc","goods_desc","fin_liab_amt","fin_cur_code","fin_amt","bill_amt_cur_code","bill_amt","fin_amt_img","description_of_goods"];d.forEach(_18,function(id){var _19=dj.byId(id);if(_19){m.toggleRequired(_19,false);}});}}},beforeSubmitValidations:function(){var _1a=dj.byId("fin_amt");var _1b=dj.byId("bill_amt");var _1c=dj.byId("bill_amt_cur_code");var _1d=dj.byId("fin_cur_code");var _1e=dj.byId("fx_exchange_rate_amt");if(dj.byId("bill_amt")&&dj.byId("bill_amt").get("value")){if((_1c.get("value")===_1d.get("value"))&&(dojo.number.parse(_1a.get("value"))>dojo.number.parse(_1b.get("value")))){m._config.onSubmitErrorMsg=m.getLocalization("FinAmtGreaterThanBillAmtValidation");return false;}}if(dj.byId("fin_amt")&&dj.byId("fin_liab_amt")&&(dj.byId("fin_amt").get("value")<dj.byId("fin_liab_amt").get("value"))){m._config.onSubmitErrorMsg=m.getLocalization("TFLiabilityAmountCanNotBeGreaterThanTFTotalAmount");dj.byId("fin_liab_amt").set("value","");return false;}return true;}});})(dojo,dijit,misys);dojo.require("misys.client.binding.bank.report_tf_client");}