/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.bank.amend_bg"]){dojo._hasResource["misys.binding.bank.amend_bg"]=true;dojo.provide("misys.binding.bank.amend_bg");dojo.require("dijit.layout.TabContainer");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("misys.form.file");dojo.require("misys.form.addons");dojo.require("misys.form.SimpleTextarea");dojo.require("dijit.Editor");dojo.require("dojo.data.ItemFileReadStore");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("misys.widget.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.layout.ContentPane");dojo.require("misys.widget.Collaboration");(function(d,dj,m){function _1(){if(dj.byId("sub_tnx_type_code")&&dj.byId("sub_tnx_type_code").get("value")=="05"&&dj.byId("prod_stat_code")&&dj.byId("prod_stat_code").get("value")!=="01"){var _2=dj.byId("release_amt");var _3=dj.byId("org_bg_liab_amt");var _4=dj.byId("release_amt")?dj.byId("release_amt").get("value"):"";var _5=dojo.number.parse(_3.get("value"))||0;if(_2&&_3&&(_4<=0||_4>_5)){misys.dialog.show("ERROR",misys.getLocalization("canNotReleaseTheTransaction"),"",function(){dj.byId("release_amt").focus();dj.byId("release_amt").set("state","Error");});dj.byId("bg_liab_amt").set("value",_5);return false;}if(!isNaN(_4)){var _6=_5-_4;dj.byId("bg_liab_amt").set("value",_6);return true;}else{dj.byId("bg_liab_amt").set("value",_5);}}return true;};d.mixin(m,{bind:function(){m.setValidation("iss_date",m.validateIssueDate);m.setValidation("amd_date",m.validateAmendmentDate);m.setValidation("exp_date",m.validateBankExpiryDate);m.setValidation("inc_amt",function(_7){return m.validateAmendAmount(_7,this,"bg");},true);m.setValidation("dec_amt",function(_8){return m.validateAmendAmount(_8,this,"bg");},true);if(dj.byId("renew_flag")){dj.byId("renew_flag").set("readOnly",true);}if(dj.byId("final_expiry_date")){dj.byId("final_expiry_date").set("readOnly",true);}if(dj.byId("renew_amt_code_1")){dj.byId("renew_amt_code_1").set("readOnly",true);}if(dj.byId("renew_amt_code_2")){dj.byId("renew_amt_code_2").set("readOnly",true);}var _9=["inc_amt_2","inc_amt_3","inc_amt_4","dec_amt_2","dec_amt_3","dec_amt_4"];d.forEach(_9,function(id){});m.connect("inc_amt","onBlur",m.amendTransaction);m.connect("dec_amt","onBlur",m.amendTransaction);_9.push("inc_amt");_9.push("dec_amt");d.forEach(_9,function(id){m.connect(id,"onBlur",function(){m.toggleFields(dj.byId(id).get("value"),null,["amd_details"]);});});m.connect("dec_amt","onBlur",function(){var _a=dj.byId("org_bg_liab_amt").get("value");var _b;if(!isNaN(dj.byId("dec_amt").get("value"))){_b=dojo.number.parse(_a)-dojo.number.parse(dj.byId("dec_amt").get("value"));dj.byId("bg_liab_amt").set("value",_b);}else{dj.byId("bg_liab_amt").set("value",dj.byId("org_bg_liab_amt").get("value"));}});m.connect("inc_amt","onBlur",function(){var _c=dj.byId("org_bg_liab_amt").get("value");var _d;if(!isNaN(dj.byId("inc_amt").get("value"))){_d=dojo.number.parse(_c)+dojo.number.parse(dj.byId("inc_amt").get("value"));dj.byId("bg_liab_amt").set("value",_d);}else{dj.byId("bg_liab_amt").set("value",dj.byId("org_bg_liab_amt").get("value"));}});m.connect("release_amt","onBlur",_1);m.connect("prod_stat_code","onChange",function(){if(dj.byId("sub_tnx_type_code")&&dj.byId("sub_tnx_type_code").get("value")==="05"){var _e=dj.byId("prod_stat_code");if(_e&&_e.get("value")==="01"){dj.byId("release_amt").set("readOnly",true);}else{dj.byId("release_amt").set("readOnly",false);}}if(dj.byId("prod_stat_code")&&(dj.byId("prod_stat_code").get("value")!==""&&dj.byId("prod_stat_code").get("value")!=="01"&&dj.byId("prod_stat_code").get("value")!=="08")){if(!(dj.byId("sub_tnx_type_code")&&dj.byId("sub_tnx_type_code").get("value")==="05"&&dj.byId("prod_stat_code").get("value")==="76")){m.updateOutstandingAmount(dj.byId("bg_liab_amt"),dj.byId("org_bg_liab_amt"));}}});m.connect("bg_release_flag","onClick",m.toggleAmendmentFields);},onFormLoad:function(){if(dj.byId("bg_liab_amt")){var _f=dj.byId("org_bg_liab_amt").get("value");var _10;if(!isNaN(dj.byId("dec_amt").get("value"))){_10=dojo.number.parse(_f)-dojo.number.parse(dj.byId("dec_amt").get("value"));dj.byId("bg_liab_amt").set("value",_10);}else{if(!isNaN(dj.byId("inc_amt").get("value"))){_10=dojo.number.parse(_f)+dojo.number.parse(dj.byId("inc_amt").get("value"));dj.byId("bg_liab_amt").set("value",_10);}else{dj.byId("bg_liab_amt").set("value",dj.byId("org_bg_liab_amt").get("value"));}}}if(dj.byId("bg_liab_amt")&&dj.byId("release_amt")){var _11=dojo.number.parse(dj.byId("org_bg_liab_amt").get("value"))||0,_12=dj.byId("release_amt").get("value");if(_12>_11){m.dialog.show("ERROR",m.getLocalization("canNotReleaseTheTransaction"));dj.byId("bg_liab_amt").set("value",_11);}else{var _13=_11-_12;dj.byId("bg_liab_amt").set("value",_13);}}m.setCurrency(dj.byId("bg_cur_code"),["tnx_amt","bg_liab_amt"]);if(dj.byId("tnx_type_code")&&(dj.byId("tnx_type_code").get("value")==="15"||(dj.byId("tnx_type_code").get("value")==="13"))&&(m._config.enable_to_edit_customer_details_bank_side=="false")){dojo.style("transactionDetails","display","none");}else{if(m._config.enable_to_edit_customer_details_bank_side=="false"){dojo.style("transactionDetails","display","none");var _14=["exp_date","beneficiary_name","beneficiary_address_line_1","beneficiary_address_line_2","beneficiary_dom","beneficiary_country","beneficiary_reference","beneficiary_contact_number","renew_flag","renew_on_code","renewal_calendar_date","renew_for_nb","renew_for_period","advise_renewal_flag","rolling_renewal_flag","rolling_renew_on_code","rolling_renew_for_nb","rolling_renew_for_period","rolling_day_in_month","rolling_renewal_nb","rolling_cancellation_days","renew_amt_code_1","renew_amt_code_2","projected_expiry_date","final_expiry_date","advise_renewal_days_nb","bg_amt","amd_details","org_bg_amt","inc_amt","dec_amt"];d.forEach(_14,function(id){var _15=dj.byId(id);if(_15){m.toggleRequired(_15,false);}});}}},beforeSubmitValidations:function(){if(dj.byId("sub_tnx_type_code")&&dj.byId("sub_tnx_type_code").get("value")==="05"&&dj.byId("prod_stat_code")&&dj.byId("prod_stat_code").get("value")!=="01"){var _16=dj.byId("release_amt");var _17=dj.byId("org_bg_liab_amt");var _18=dj.byId("release_amt")?dj.byId("release_amt").get("value"):"";var _19=dojo.number.parse(_17.get("value"))||0;if(_16&&_17&&(_18<=0||_18>_19)&&_19!="0"){m._config.onSubmitErrorMsg=m.getLocalization("canNotReleaseTheTransaction");dj.byId("bg_liab_amt").set("value",_19);return false;}else{if(_19==="0"){m._config.onSubmitErrorMsg=m.getLocalization("canNotProceedTheTransaction");dj.byId("bg_liab_amt").set("value",_19);return false;}}}var _1a=["exp_date","org_exp_date","exp_date_type_code","org_exp_date_type_code","inc_amt","dec_amt","amd_details","file"];var _1b=d.every(_1a,dj.byId);if(_1b){_1a=["inc_amt_2","inc_amt_3","inc_amt_4","dec_amt_2","dec_amt_3","dec_amt_4"];var _1c=d.every(_1a,dj.byId);var _1d=["exp_date_type_code"];var _1e=d.every(_1d,function(id){var _1f=dj.byId(id).get("value")+"";var _20=dj.byId("org_"+id).get("value")+"";if(_1f=="NaN"||_1f=="null"||_1f=="undefined"){_1f="";}if(_1f==_20){return true;}return false;});var _21=["exp_date"];var _22=d.every(_21,function(id){var _23=dj.byId(id).get("value")+"";var _24=d.date.locale.parse(dj.byId("org_"+id).get("displayedValue"),{selector:"date",datePattern:m.getLocalization("g_strGlobalDateFormat")})+"";if(_23===_24){return true;}return false;});var _25=(d.query("#edit [id^='file_row_']").length>1);if(_1c&&_1e&&_22&&!_25&&!dj.byId("inc_amt").get("value")&&!dj.byId("dec_amt").get("value")&&(dj.byId("amd_details").get("value")=="")){m._config.onSubmitErrorMsg=m.getLocalization("noAmendmentError");return false;}}return true;}});})(dojo,dijit,misys);dojo.require("misys.client.binding.bank.amend_bg_client");}