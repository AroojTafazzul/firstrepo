/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.common.mc_batch_info"]){dojo._hasResource["misys.binding.common.mc_batch_info"]=true;dojo.provide("misys.binding.common.mc_batch_info");(function(d,dj,m){function _1(_2,_3,_4){var _5=dijit.byId("mode")?dijit.byId("mode").get("value"):"";var _6=dijit.byId("forwardHolidayButtonId")?dijit.byId("forwardHolidayButtonId"):new dj.form.Button({label:"Auto Forward",id:"forwardHolidayButtonId"});if(!dj.byId("holidayCutOffDialog")){d.require("misys.widget.Dialog");d.require("dijit.form.Button");var _7=new dj.Dialog({id:"holidayCutOffDialog",title:"Confirmation",draggable:false});var _8=d.create("div",{id:"holidayCutOffDialogContent"});var _9=d.create("div",{id:"dialogHolidayText"},_8,"first");var _a=d.create("div",{id:"holidayCutOffDialogButtons",style:"text-align:center;"},_8,"last");var _b=new dj.form.Button({label:"Cancel",id:"cancelHolidayButtonId"});d.place(_b.domNode,_a);_7.set("content",_8);}var _c=dj.byId("holidayCutOffDialog");if(_2===true){d.place(_6.domNode,d.byId("holidayCutOffDialogButtons"),"first");m.dialog.connect(dj.byId("forwardHolidayButtonId"),"onClick",function(){if(_4){_c.hide();dj.byId("autoForward").set("value","Y");dj.byId("TransactionData").set("value",m.formToXML());m.performReauth();}else{_c.hide();m.submit();}},_c.id);}else{_6.destroy();}if(d.byId("dialogHolidayText")){d.byId("dialogHolidayText").innerHTML=_3;d.byId("dialogHolidayText").innerHTML=d.byId("dialogHolidayText").innerHTML.replace(/\,/g,"");}m.dialog.connect(_c,"onKeyPress",function(_d){if(_d.keyCode==d.keys.ESCAPE){d.stopEvent(_d);}});m.dialog.connect(dj.byId("cancelHolidayButtonId"),"onClick",function(){m.dialog.hide();_c.hide();},_c.id);m.dialog.connect(_c,"onHide",function(){m.dialog.disconnect(_c);m.dialog.hide();});_c.show();};d.mixin(m._config,{initReAuthParams:function(){var _e={productCode:"MB",subProductCode:"",transactionTypeCode:"01",entity:dj.byId("entity")?dj.byId("entity").get("value"):"",currency:"",amount:"",batch_id:dj.byId("batch_id")?dj.byId("batch_id").get("value"):"",es_field1:"",es_field2:""};return _e;}});d.mixin(m,{generateEsignRequest:function(_f){dj.byId("realform_operation").set("value",_f);var _10=function(){dj.byId("TransactionData").set("value",m.formToXML());dj.byId("realform").submit();};m.dialog.show("CONFIRMATION",m.getLocalization("generateEsignRequest"),"",_10);},proxyAuthorise:function(_11){dj.byId("realform_operation").set("value",_11);var _12=function(){dj.byId("TransactionData").set("value",m.formToXML());dj.byId("realform").submit();};m.dialog.show("CONFIRMATION",m.getLocalization("proxyAuthorise"),"",_12);},deleteBatch:function(_13){dj.byId("realform_operation").set("value",_13);var _14=function(){dj.byId("TransactionData").set("value",m.formToXML());dj.byId("realform").submit();};m.dialog.show("CONFIRMATION",m.getLocalization("deleteBatchConfirmation"),"",_14);},checkAndShowReAuthDialog:function(_15){m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/ReAuthenticationAjax"),handleAs:"text",sync:true,preventCache:true,content:{productCode:_15.productCode,subProductCode:_15.subProductCode,transactionTypeCode:_15.transactionTypeCode,entity:(_15.entity)?_15.entity:"",currency:(_15.currency)?_15.currency:"",amount:(_15.amount)?_15.amount:"",batch_id:_15.batch_id?_15.batch_id:""},load:function(_16,_17){if(!(_16.indexOf("SC_UNAUTHORIZED")===-1)){misys.showSessionOverDialog();}else{m.setContentInReAuthDialog(_16,_17);if(""+_16+""!="01"){dj.byId("reauth_dialog").show();}}},customError:function(_18,_19){console.error(_18);m.setContentInReAuthDialog("ERROR",_19);dj.byId("reauth_dialog").show();}});},submitBatchWithHolidayCutOffValidation:function(_1a,_1b){if(misys.client.submitBatchWithHolidayCutOffValidation){misys.client.submitBatchWithHolidayCutOffValidation(_1a,_1b);}else{var _1c=true,_1d,_1e,_1f,_20,_21;dj.byId("realform_operation").set("value",_1b);var _22=function(){m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/ValidateHolidayCutOffMultipleSubmission"),sync:true,handleAs:"json",content:{"batch_id":_1a},load:function(_23,_24){_1c=_23.isValid;_1e=_23.autoForwardTransactionDetails;_20=_23.failedTransactionDetailsCutOff;_1f=_23.failedTransactionDetailsHolidays;_21=_23.autoForwardEnabled;},error:function(_25,_26){console.error("[misys.grid._base] submitBatchWithHolidayCutOffValidation error",_25);}});if(_1c){m.performReauth();}else{var _27=dj.byId("reauth_perform");var _28=[];if(_21){if(_20.length>0){_28.push("<div <b>"+m.getLocalization("failedMultipleSubmissionCutOff")+"</b><br/>");d.forEach(_20,function(_29){_28.push("<li>"+_29+"</li>");});}if(_1f.length>0){_28.push("<div style='display:block;'><b>"+m.getLocalization("failedMultipleSubmissionHoliday")+"</b><br/>");d.forEach(_1f,function(_2a){_28.push("<li>"+_2a+"</li>");});}_28.push("<div style='display:block;'><b>"+m.getLocalization("autoForwardMultipleSubmission")+"</b><br/>");_28.push("</div>");if(_27&&_27.get("value")==="Y"){_1(_21,_28,true);}else{_1(_21,_28,false);}}else{if(_20.length>0){_28.push("<div style='display:block;'><b>"+m.getLocalization("failedMultipleSubmissionCutOff")+"</b><br/>");d.forEach(_20,function(_2b){_28.push("<li>"+_2b+"</li>");});}if(_1f.length>0){_28.push("<div style='display:block;'><b>"+m.getLocalization("failedMultipleSubmissionHoliday")+"</b><br/>");d.forEach(_1f,function(_2c){_28.push("<li>"+_2c+"</li>");});}if(_27&&_27.get("value")==="Y"){_1(_21,_28,true);}else{_1(_21,_28,false);}}}};m.dialog.show("CONFIRMATION",m.getLocalization("submitBatchConfirmation"),"",_22);}},performReauth:function(){var _2d=dj.byId("reauth_perform");if(_2d&&_2d.get("value")==="Y"){var _2e={};if(d.isFunction(m._config.initReAuthParams)){_2e=m._config.initReAuthParams();m.checkAndShowReAuthDialog(_2e);}else{m.setContentInReAuthDialog("ERROR","");dj.byId("reauth_dialog").show();}}else{dj.byId("TransactionData").set("value",m.formToXML());dj.byId("realform").submit();}}});})(dojo,dijit,misys);dojo.require("misys.client.binding.common.mc_batch_info_client");}