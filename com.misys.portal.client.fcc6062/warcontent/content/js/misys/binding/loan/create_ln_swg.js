/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.loan.create_ln_swg"]){dojo._hasResource["misys.binding.loan.create_ln_swg"]=true;dojo.provide("misys.binding.loan.create_ln_swg");dojo.require("dojo.parser");dojo.require("dijit.layout.TabContainer");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("misys.widget.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dojo.data.ItemFileReadStore");dojo.require("misys.form.file");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("misys.widget.Collaboration");dojo.require("misys.binding.SessionTimer");dojo.require("dojox.xml.DomParser");(function(d,dj,m){misys._config.isDirtyFlag=false;misys._config.isValid=false;misys._config.isEffectiveDateFlag=false;misys._config.isRepricingDateFlag=false;var _1="/screen/AjaxScreen/action/GetBusinessDayValidatedDate";var _2="CUSTOM-NO-CANCEL";var _3="[INFO] No deals for the borrower found.";function _4(){if(!this.get("value")){return true;}var _5=dj.byId(this.id);var _6=_5.get("value");var _7=new Date();_7.setHours(0,0,0,0);var _8=d.date.compare(m.localizeDate(this),_7)<0?false:true;if(!_8){this.invalidMessage=m.getLocalization("effectiveDateGreaterThanSystemDate",[m.getLocalizeDisplayDate(this)]);return false;}var _9=dijit.byId("facility_effective_date");if(!m.compareDateFields(_9,_5)){this.invalidMessage=misys.getLocalization("loanEffDateGreaterThanFacEffDateError",[m.getLocalizeDisplayDate(this),m.getLocalizeDisplayDate(_9)]);return false;}var _a=dijit.byId("facility_expiry_date");if(!m.compareDateFields(_5,_a)){this.invalidMessage=misys.getLocalization("loanEffDateLessThanFacExpDateError",[m.getLocalizeDisplayDate(this),m.getLocalizeDisplayDate(_a)]);return false;}var _b=dijit.byId("facility_maturity_date");if(!m.compareDateFields(_5,_b)){this.invalidMessage=misys.getLocalization("loanEffDateLessThanFacMatDateError",[m.getLocalizeDisplayDate(this),m.getLocalizeDisplayDate(_b)]);return false;}var _c=dijit.byId("ln_maturity_date");if(_5&&_c&&_5.displayedValue!==""&&_c.displayedValue!==""){if(d.date.compare(m.localizeDate(_5),m.localizeDate(_c))>=0){this.invalidMessage=misys.getLocalization("loanEffDateLessThanLoanMatDateError",[m.getLocalizeDisplayDate(this),m.getLocalizeDisplayDate(_c)]);return false;}}_d();return true;};function _e(){var _f=dj.byId("accept_legal_text");if(_f){if(_f.get("checked")){return true;}else{m._config.onSubmitErrorMsg=misys.getLocalization("legalTextErrorMsg");return false;}}return true;};function _10(){if(_11()&&_12()){if(_d()){if(dj.byId("screenMode").get("value")==="UNSIGNED"){_13();if(m._config.onSubmitErrorMsg&&m._config.onSubmitErrorMsg!==""){return false;}else{return true;}}else{return true;}}}return false;};function _14(){var _15={identifier:"description",label:"description",items:misys._config.remittanceInstructions};var _16;if(dj.byId("screenMode").get("value")==="UNSIGNED"){_16=dj.byId("ln_cur_code_unsigned").get("value");}else{_16=dj.byId("ln_cur_code").get("value");}var _17=0;if(_15.items&&_15.items.length){_17=_15.items.length;}var _18=true;var y;for(y=0;y<_17;y++){if(_16===_15.items[y].currency[0]){_18=false;break;}}if(dijit.byId("remittance_flag").get("value")==="mandatory"&&!_18){var _19=dijit.byId("gridRemittanceInstruction");var _1a=_19.selection.getSelected();if(_1a.length!==0){return true;}else{if(dj.byId("screenMode").get("value")==="UNSIGNED"){m._config.onSubmitErrorMsg=misys.getLocalization("ErrorForMandatoryRemittanceForCheckerUser");}else{m._config.onSubmitErrorMsg=misys.getLocalization("ErrorForMandatoryRemittance");}return false;}}return true;};function _11(){var _1b=dj.byId("ln_access_type");if(_1b){if(_1b.get("value")==="A"){return true;}else{m._config.onSubmitErrorMsg=misys.getLocalization("facilityBlockError",[dj.byId("bo_facility_name").get("value")]);}}return false;};function _1c(){if(this.get("value")==null){return true;}var _1d=dj.byId(this.id);var _1e=dijit.byId("facility_maturity_date");if(!m.compareDateFields(_1d,_1e)){this.invalidMessage=misys.getLocalization("loanMatDateGreaterThanFacMatDateError",[m.getLocalizeDisplayDate(this),m.getLocalizeDisplayDate(_1e)]);return false;}var _1f=dijit.byId("effective_date");if(_1d&&_1f&&_1d.displayedValue!==""&&_1f.displayedValue!==""){if(d.date.compare(m.localizeDate(_1d),m.localizeDate(_1f))<=0){this.invalidMessage=misys.getLocalization("loanMatDateLessThanLoanEffDateError",[m.getLocalizeDisplayDate(this),m.getLocalizeDisplayDate(_1f)]);return false;}}var _20=dijit.byId("repricing_date");if(!m.compareDateFields(_20,_1d)){this.invalidMessage=misys.getLocalization("loanMatDateGreaterThanLoanRepDateError",[m.getLocalizeDisplayDate(_1d),m.getLocalizeDisplayDate(_20)]);return false;}return true;};function _21(){var _22=dijit.byId("borrower_limit_cur_code");var _23=dijit.byId("ln_cur_code");var _24=dojo.byId("facFXRateId");if(_22&&_23.get("value")!==""&&(_23.get("value")!==_22.get("value"))){var _25=_23.get("value");_23.store.fetch({query:{id:_23.get("value")},onComplete:dojo.hitch(this,function(_26,_27){dojo.forEach(_26,function(_28){dijit.byId("fx_display").set("value","1 "+_22.get("value")+" = "+_28.limitFXRate[0]+" "+_23.get("value"));dijit.byId("fx_conversion_rate").set("value",_28.limitFXRate[0]);dojo.style(_24,"display","block");},this);})});}else{dojo.style(_24,"display","none");}};function _13(){var _29=dj.byId("bo_facility_id").get("value");var _2a=dj.byId("ln_cur_code");var _2b=dj.byId("ln_cur_code_unsigned");var _2c="N";var _2d=dj.byId("effective_date");var _2e=dj.byId("effective_date_unsigned");var _2f;var _30;var _31;var _32;var _33;if(dj.byId("screenMode").get("value")==="UNSIGNED"){_32=_2e.get("value");_30=dijit.byId("pricing_option_unsigned").get("value");_33=_2b.get("value");}else{_32=_2d.get("displayedValue");_30=dijit.byId("pricing_option").get("value");_33=_2a.get("value");}m.xhrPost({url:m.getServletURL(_1),handleAs:"json",preventCache:true,sync:true,content:{boFacilityId:_29,pricingOptionName:_30,dateToValidate:_32,currency:_33,isRepricingDate:_2c},load:function(_34){misys._config.dateValuesResponse=_34;if(misys._config.displayMode==="edit"){if(_34.items.dateValues&&dj.byId("effective_date").get("displayedValue")===_34.items.dateValues[0].localizedDate){misys._config.isEffectiveDateFlag=true;}else{misys._config.isEffectiveDateFlag=false;}_4d();}else{if(_34.items.dateValues&&dj.byId("effective_date_unsigned").get("value")!==_34.items.dateValues[0].localizedDate){m._config.onSubmitErrorMsg=m.getLocalization("unsignedEffectiveDateNonBusinessDayError",[_34.items.dateValues[0].localizedDate]);}}},error:function(_35){}});};function _36(){var _37=dj.byId("bo_facility_id").get("value");var _38=dj.byId("pricing_option").get("value");var _39=dj.byId("repricing_date").get("displayedValue");var _3a=dj.byId("ln_cur_code").get("value");var _3b="Y";m.xhrPost({url:m.getServletURL(_1),handleAs:"json",preventCache:true,sync:true,content:{boFacilityId:_37,pricingOptionName:_38,dateToValidate:_39,currency:_3a,isRepricingDate:_3b},load:function(_3c){misys._config.dateValuesResponse=_3c;if(_3c.items.dateValues&&dj.byId("repricing_date").get("displayedValue")===_3c.items.dateValues[0].localizedDate){misys._config.isRepricingDateFlag=true;}else{misys._config.isRepricingDateFlag=false;}_3e();},error:function(_3d){}});};function _3e(){var _3f=dj.byId("repricing_date");var _40=dj.byId("repricing_date").get("displayedValue");var _41;var _42=misys._config.dateValuesResponse["items"];_3f.store=new dojo.data.ItemFileReadStore({data:{identifier:"id",label:"name",items:_42["dateValues"]}});var _43=0;var _44=function(_45,_46){_43=_45;};_3f.get("store").fetch({query:{},onBegin:_44,start:0,count:0});var _47=_3f.store._arrayOfTopLevelItems[0].name[0];var _48=_47.split("/");var _49=new Date(parseInt(_48[2],10),parseInt(_48[1],10)-1,parseInt(_48[0],10));_3f.set("value",_49);var _4a=_40.split("/");var _4b=new Date(parseInt(_4a[2],10),parseInt(_4a[1],10)-1,parseInt(_4a[0],10));_3f.set("value",_49);if(_49.valueOf()>_4b.valueOf()||_49.valueOf()<_4b.valueOf()){var _4c=m.getLocalization("repricingDateBusinessDayValidationErrorMsg",[_40]);setTimeout(function(){m.dialog.show(_2,_4c,"Info");},2000);}};function _4d(){var _4e=dj.byId("effective_date");var _4f=dj.byId("effective_date").get("displayedValue");var _50;var _51=misys._config.dateValuesResponse["items"];var _52;_4e.store=new dojo.data.ItemFileReadStore({data:{identifier:"id",label:"name",items:_51["dateValues"]}});var _53=0;var _54=function(_55,_56){_53=_55;};_4e.get("store").fetch({query:{},onBegin:_54,start:0,count:0});if(_53!==0){_52=_4e.store._arrayOfTopLevelItems[0].name[0];var _57=_52.split("/");var _58=new Date(parseInt(_57[2],10),parseInt(_57[1],10)-1,parseInt(_57[0],10));var _59=_4f.split("/");var _5a=new Date(parseInt(_59[2],10),parseInt(_59[1],10)-1,parseInt(_59[0],10));var _5b=dijit.byId("default_effective_date");var _5c=dijit.byId("appl_date");var _5d=dijit.byId("effective_date");var _5e=_5d;if((m.compareDateFields(_5c,_5e))&&!(m.compareDateFields(_5b,_5e))){var _5f=m.getLocalization("defaultEffectiveDateErrorMsg",[_5b.get("displayedValue")]);m.dialog.show(_2,_5f,"Info");_4e.set("value",_58);return true;}if(!((m.compareDateFields(_5c,_5e))&&!(m.compareDateFields(_5b,_5e)))){if(_58.valueOf()>_5a.valueOf()||_58.valueOf()<_5a.valueOf()){var _60=m.getLocalization("effectiveDateBusinessDayValidationErrorMsg",[_4f]);m.dialog.show(_2,_60,"Info");_4e.set("value",_58);return true;}}_4e.set("value",_58);return true;}};function _61(_62){var _63=_62.dateValues[0].name;var _64=dj.byId("default_effective_date");_64.set("value",_63);};function _65(){var _66;if(dj.byId("screenMode").get("value")==="UNSIGNED"){_66=dijit.byId("pricing_option_unsigned").get("value");}else{_66=dijit.byId("pricing_option").get("value");}var _67=misys._config.pricingOptionsStore;_67.fetch({query:{id:_66},onComplete:dojo.hitch(this,function(_68,_69){var _6a=_68[0];if(_6a){var _6b=_6a.serverDate;var _6c=new Date(_6b);if(dj.byId("screenMode").get("value")!="UNSIGNED"){dj.byId("effective_date").set("value",_6c);}}})});};function _6d(str){var _6e=new Date(str),_6f=("0"+(_6e.getMonth()+1)).slice(-2),day=("0"+_6e.getDate()).slice(-2);return [day,_6f,_6e.getFullYear()].join("/");};function _70(){var _71=dj.byId("effective_date");if(_71.get("value")!==null){_36();}};function _72(){var _73=dijit.byId("effective_date_hidden_field");if(dj.byId("screenMode").get("value")==="UNSIGNED"){dijit.byId("effective_date_unsigned").set("value",dijit.byId("effective_date_unsigned").get("value"));var _74=dijit.byId("effective_date_unsigned");if(!m.compareDateFields(_73,_74)){m._config.onSubmitErrorMsg=m.getLocalization("intendNoticeDaysErrorMsgForSwingline",[m.getLocalizeDisplayDate(_73)]);return false;}}else{if(!this.get("value")){return true;}m._config=m._config||{};m._config.repricingDatesValidationInprocess=false;if(!m._config.repricingDatesValidationInprocess){if(!m.compareDateFields(_73,this)){m._config.repricingDatesValidationInprocess=true;this.invalidMessage=m.getLocalization("intendNoticeDaysErrorMsgForSwingline",[m.getLocalizeDisplayDate(_73)]);return false;}}m._config.repricingDatesValidationInprocess=false;}return true;};function _75(){if(this.get("value")==null){return true;}var _76=dj.byId(this.id);var _77=dijit.byId("effective_date");if(m.compareDateFields(_76,_77)){this.invalidMessage=misys.getLocalization("loanRepricingDateGreaterThanLoanEffDateError",[m.getLocalizeDisplayDate(this),m.getLocalizeDisplayDate(_77)]);return false;}var _78=dijit.byId("ln_maturity_date");if(!m.compareDateFields(_76,_78)){this.invalidMessage=misys.getLocalization("loanRepricingDateLessThanLoanMatDateError",[m.getLocalizeDisplayDate(this),m.getLocalizeDisplayDate(_78)]);return false;}var _79=dijit.byId("facility_maturity_date");if(!m.compareDateFields(_76,_79)){this.invalidMessage=misys.getLocalization("loanRepricingDateLessThanFacMatDateError",[m.getLocalizeDisplayDate(this),m.getLocalizeDisplayDate(_79)]);return false;}return true;};function _12(){if(dj.byId("ln_amt")){var _7a=dj.byId("ln_amt");if(_7a.get("value")==null){return true;}if(_7a.get("value")<=0){_7a.set("state","Error");dj.hideTooltip(_7a.domNode);var _7b=misys.getLocalization("loanAmountZeroError");dj.showTooltip(_7b,_7a.domNode,["after"],0);setTimeout(function(){dj.hideTooltip(_7a.domNode);},5000);return false;}var _7c=dijit.byId("ln_cur_code");var _7d=dijit.byId("risk_type");var _7e=d.cldr.monetary.getData(_7c.get("value"));if(_7c&&_7c.get("value")){var _7f=0;var _80=0;var _81=0;var _82=0;var _83=0;var _84=0;var _85=0;var _86=false;var _87=0;var _88;var _89;misys._config.currenciesStore.fetch({query:{id:_7c.get("value")},onItem:function(_8a){_7f=_8a.limit;_80=_8a.borrowerCcylimit;_82=_8a.borrowerlimit;_83=_8a.swinglineLimit;_84=_8a.sublimitRisklimit;_85=_8a.limitWithPend;if((_7d&&_7d.get("value"))){var _8b=_7d.get("value");_81=_8a[_8b];}}});_87=_7f[0];if(_7a.get("value")>_82){_86=true;if(_82[0]<_87){_87=_82[0];if(_82[0]<=0){_88=misys.getLocalization("noAmountForBorrowerLimitError");_89=m.getLocalization("loanBorrowerLevelLimtAmtExceeded");}else{_88=misys.getLocalization("loanAmountTooBigThanBorrowerLimitAmtError",[_7c.get("value"),d.currency.format((Math.floor(_87*100)/100),{round:_7e.round,places:_7e.places})]);_89=m.getLocalization("loanBorrowerLevelLimtAmtExceeded");}}}if(_7d&&_7d.get("value")){if(_7a.get("value")>_81){_86=true;if(_81[0]<_87){_87=_81[0];if(_81[0]<=0){_88=misys.getLocalization("noAmountForSwingRiskLimitError");_89=m.getLocalization("loanBorrowerRiskTypeLimtAmtExceeded");}else{_88=misys.getLocalization("loanAmountTooBigThanBorrowerRiskTypeLimitAmtError",[_7c.get("value"),d.currency.format((Math.floor(_87*100)/100),{round:_7e.round,places:_7e.places})]);_89=m.getLocalization("loanBorrowerRiskTypeLimtAmtExceeded");}}}}if(_7a.get("value")>_83){_86=true;if(_83[0]<_87){_87=_83[0];if(_83[0]<=0){_88=misys.getLocalization("noAmountForSwinglineLimitError");_89=m.getLocalization("noAmountForSwinglineLimitError");}else{_88=misys.getLocalization("loanAmountTooBigThanSwinglineLimitAmtError",[_7c.get("value"),d.currency.format((Math.floor(_87*100)/100),{round:_7e.round,places:_7e.places})]);_89=m.getLocalization("loanSublimitExceeded");}}}if(_7a.get("value")>_84){_86=true;if(_84[0]<_87){_87=_84[0];if(_83[0]<=0){_88=misys.getLocalization("noAmountForSublimitRiskLimitError");_89=m.getLocalization("noAmountForSublimitRiskLimitError");}else{_88=misys.getLocalization("loanAmountTooBigThanSublimitRiskAmtError",[_7c.get("value"),d.currency.format((Math.floor(_87*100)/100),{round:_7e.round,places:_7e.places})]);_89=m.getLocalization("loanSublimitRiskExceeded");}}}if(_7a.get("value")>_85){_86=true;if(_85[0]<=_87){_87=_85[0];if(_87<=0){_88=misys.getLocalization("facilityFullyDrawnErrorWithPend");}else{_88=misys.getLocalization("loanAmountTooBigWithPendError",[_7c.get("value"),d.currency.format((Math.floor((_87*100).toFixed(2))/100),{round:_7e.round,places:_7e.places})]);}_89=m.getLocalization("loanFacilityAmtWithPendExceeded");}}if(_7a.get("value")>_80){_86=true;if(_80[0]<_87){_87=_80[0];if(_80[0]<=0){_88=misys.getLocalization("noAmountForCurrencyLimitError",[_7c.get("value")]);_89=m.getLocalization("loanBorrowerCcyLimtAmtExceeded");}else{_88=misys.getLocalization("loanAmountTooBigThanBorrowerCcyLimitAmtError",[_7c.get("value"),d.currency.format((Math.floor(_87*100)/100),{round:_7e.round,places:_7e.places})]);_89=m.getLocalization("loanBorrowerCcyLimtAmtExceeded");}}}if(_7a.get("value")>_7f){_86=true;if(_7f[0]<=_87){_87=_7f[0];if(_87===0){_88=misys.getLocalization("facilityFullyDrawnError");}else{_88=misys.getLocalization("swinglineLoanAmountTooBigError",[_7c.get("value"),d.currency.format((Math.floor(_87*100)/100),{round:_7e.round,places:_7e.places})]);}_89=m.getLocalization("loanFacilityAmtExceeded");}}if(_86){if(misys._config.warnFacilityAmtExceeded){dj.hideTooltip(_7a.domNode);dj.showTooltip(_89,_7a.domNode,2000);setTimeout(function(){dj.hideTooltip(_7a.domNode);},5000);return true;}else{_7a.set("state","Error");dj.hideTooltip(_7a.domNode);dj.showTooltip(_88,_7a.domNode,["after"],0);setTimeout(function(){dj.hideTooltip(_7a.domNode);},5000);return false;}}else{misys._config.warningMessages=[];return true;}}return true;}return true;};function _8c(){var _8d=dijit.byId("pricing_option").get("value");var _8e=misys._config.pricingOptionsStore;_8e.fetch({query:{id:_8d},onComplete:dojo.hitch(this,function(_8f,_90){var _91=_8f[0];if(_91){var _92=_91.intentDaysInAdvance;var _93=new Date();var _94=dj.byId("effective_date");var _95=_93.getMonth();var _96=_93.getFullYear();var day=_93.getDate();day=parseInt(day,10)+parseInt(_92,10);var _97=new Date(_96,_95,day);var _98=_97.getDay();if(_98===0){day=parseInt(day,10)+parseInt(1,10);}else{if(_98===6){day=parseInt(day,10)+parseInt(2,10);}}var _99=new Date(_96,_95,day);var _9a=dj.byId("effective_date_hidden_field");_96=_99.getFullYear();_95=(1+_99.getMonth()).toString();_95=_95.length>1?_95:"0"+_95;day=_99.getDate().toString();day=day.length>1?day:"0"+day;_9a.set("value",day+"/"+_95+"/"+_96);}})});};function _d(){var _9b=dj.byId("effective_date");var _9c=dj.byId("effective_date_unsigned");var _9d;var _9e;var _9f;var _a0;var _a1;if(dj.byId("screenMode").get("value")==="UNSIGNED"){_a0=_9c.get("value");_a0=_a0.split("/");_a0=new Date(_a0[2],_a0[1]-1,_a0[0]);_9e=dijit.byId("pricing_option_unsigned").get("value");}else{_a0=_9b.get("value");_9e=dijit.byId("pricing_option").get("value");}var _a2=misys._config.pricingOptionsStore;_a2.fetch({query:{id:_9e},onComplete:dojo.hitch(this,function(_a3,_a4){var _a5=_a3[0];if(_a5){_a1=_a5.serverDate;_9d=new Date(_a1);_9f=dijit.byId("effective_date_hidden_field");_9f.set("value",_9d);}})});m._config=m._config||{};m._config.repricingDatesValidationInprocess=false;if(!m._config.repricingDatesValidationInprocess){if(misys._config.displayMode==="edit"&&_a0<_9d){m._config.repricingDatesValidationInprocess=true;this.invalidMessage=m.getLocalization("intendNoticeDaysErrorMsgForSwingline");return false;}else{if(dj.byId("screenMode").get("value")==="UNSIGNED"&&_a0<_9d){m._config.onSubmitErrorMsg=m.getLocalization("unsignedEffectiveDateLesserThanApplDate");return false;}}}m._config.repricingDatesValidationInprocess=false;return true;};function _a6(){var _a7=dijit.byId("effective_date").get("value");var _a8;var _a9;var _aa;if(dj.byId("screenMode").get("value")==="UNSIGNED"){_a8=dijit.byId("pricing_option_unsigned").get("value");}else{_a8=dijit.byId("pricing_option").get("value");}var _ab=misys._config.pricingOptionsStore;_ab.fetch({query:{id:_a8},onComplete:dojo.hitch(this,function(_ac,_ad){var _ae=_ac[0];if(_ae){_a9=_ae.serverDate;_aa=new Date(_a9);}})});if(_a7>=_aa){return true;}else{return false;}};function _af(){var _b0=dijit.byId("repricing_date").get("value");var _b1=dijit.byId("effective_date").get("value");if(_b0>_b1){return true;}else{return false;}};function _b2(){var _b3=dijit.byId("pricing_option");var _b4=dijit.byId("repricing_frequency");_b4.set("value","");var _b5=_b3.get("value");var _b6=misys._config.repricingFrequenciesStores[_b5];if(_b6){_b4.set("store",new dojo.data.ItemFileReadStore(_b6));var _b7=0;var _b8=function(_b9,_ba){_b7=_b9;};_b4.get("store").fetch({query:{},onBegin:_b8,start:0,count:0});if(_b7==0){misys.toggleRequired("repricing_frequency",false);misys.toggleRequired("repricing_date",false);dj.byId("repricing_date").set("displayedValue","");dj.byId("repricing_date").set("disabled",true);dj.byId("repricing_frequency").set("disabled",true);}else{if(_b7==1){_b4.store.fetch({onComplete:function(_bb,_bc){dojo.forEach(_bb,function(_bd){_b4.set("value",_bd.id);_b4.set("displayedValue",_bd.name[0]);});}});}}}};function _be(_bf){var _c0=dijit.byId("pricing_option");var _c1=dijit.byId("ln_cur_code");var _c2=dijit.byId("ln_amt");var _c3=_c0.get("value");var _c4=misys._config.facCurrencyStores[_c3];if(_c4){if(_c4.data&&_c4.data.items&&_c4.data.items.length===0){_c1.set("store",misys._config.currenciesStore);misys._config.isValid=false;}else{var _c5=false;var _c6;var _c7;var _c8;for(var j=0;j<_c4.data.items.length;j++){_c6=_c4.data.items[j].name;}if(misys._config.currenciesStore._jsonData!==null){_c7=misys._config.currenciesStore._jsonData.items;for(var i=0;i<_c7.length;i++){_c8=_c7[i].name;if((_c6 instanceof Array&&_c6[0]===_c8)||_c6===_c8){_c5=true;break;}}}if(misys._config.currenciesStore._arrayOfAllItems!==null){_c7=misys._config.currenciesStore._arrayOfAllItems;for(var k=0;k<_c7.length;k++){_c8=_c7[k].name;if(_c6 instanceof Array){if(_c6[0]===_c8[0].trim()){_c5=true;break;}}else{if(_c6===_c8[0].trim()){_c5=true;break;}}}}if(_c5){_c1.set("store",new dojo.data.ItemFileReadStore(_c4));misys._config.isValid=false;}else{_c1.set("value","");_c1.set("store",null);misys._config.isValid=true;}}var _c9=0;var _ca=function(_cb,_cc){_c9=_cb;};if(_c1.get("store")){_c1.get("store").fetch({query:{},onBegin:_ca,start:0,count:0});}if(_c9===0){misys.toggleRequired("ln_cur_code",false);_c1.set("displayedValue","");_c1.set("disabled",true);misys.toggleRequired("ln_amt",false);_c2.set("displayedValue","");_c2.set("disabled",true);}else{if(_bf!==true){_c1.set("value","");_c1.set("state","Incomplete");}if(_c9===1&&_c1.store&&_c1.store._arrayOfAllItems.length){_c1.set("value",_c1.store._arrayOfAllItems[0].id[0]);_c1.set("displayedValue",_c1.store._arrayOfAllItems[0].id[0]);}}}if(misys._config.isValid){m.dialog.show("ERROR",misys.getLocalization("ErrorMessageForLoanCurrency"));}};function _cd(_ce){var _cf=dijit.byId("pricing_option").get("value");dj.byId("ln_maturity_date").set("disabled",true);if(misys._config.maturityMandatoryOptions&&misys._config.maturityMandatoryOptions.data&&misys._config.maturityMandatoryOptions.data.items){dojo.forEach(misys._config.maturityMandatoryOptions.data.items,function(_d0){if(_cf===_d0.id){if(_d0.maturityDateMandatory==="Y"){dj.byId("ln_maturity_date").set("disabled",false);m.toggleRequired("ln_maturity_date",true);if(!dj.byId("ln_maturity_date").get("value")&&dj.byId("facility_maturity_date")){dj.byId("ln_maturity_date").set("displayedValue",dj.byId("facility_maturity_date").get("value"));}}else{if(_ce){dj.byId("ln_maturity_date").set("displayedValue","");}m.toggleRequired("ln_maturity_date",false);dj.byId("ln_maturity_date").set("disabled",true);}if(dj.byId("match_funding")){if(_d0.matchFundedIndicator&&_d0.matchFundedIndicator==="Y"){dj.byId("match_funding").set("value","Y");}else{dj.byId("match_funding").set("value","N");}}}});}_be(_ce);};function _d1(_d2){var _d3={identifier:"description",label:"description",items:misys._config.remittanceInstructions};var _d4=new dojo.data.ItemFileReadStore({data:_d3});var _d5=dijit.byId("gridRemittanceInstruction");if(_d5){_d5.set("store",_d4);_d5.startup();_d5.render();var _d6=dj.byId("rem_inst_description_view"),_d7=dj.byId("rem_inst_location_code_view"),_d8=dj.byId("rem_inst_servicing_group_alias_view");_d5.store.fetch({query:{preferred:"*"},onComplete:dojo.hitch(this,function(_d9,_da){dojo.forEach(_d9,function(_db,_dc){if(_db.preferred[0]==="Y"&&_d6.get("value")===""){_d5.selection.select(_dc);}else{if(_d6.get("value")===_db.description[0]&&_d7.get("value")===_db.locationCode[0]&&_d8.get("value")===_db.servicingGroupAlias[0]){_d5.selection.select(_dc);}else{_d5.selection.deselect(_dc);}}if(_d2){_d5.rowSelectCell.setDisabled(_dc,true);}else{_d5.rowSelectCell.setDisabled(_dc,false);}},this);})});}};function _dd(){var _de={identifier:"description",label:"description",items:misys._config.remittanceInstructions};var _df;var _e0=0;var _e1=dj.byId("operationValue").get("value");var _e2=dijit.byId("remittance_flag").get("value");if(dj.byId("screenMode").get("value")==="UNSIGNED"){_df=dj.byId("ln_cur_code_unsigned").get("value");}else{_df=dj.byId("ln_cur_code").get("value");}var _e3=0;if(_de.items&&_de.items.length){_e3=_de.items.length;}var y;var _e4=new Array();for(y=0;y<_e3;y++){if(_df===_de.items[y].currency[0]){_e0++;_e4.push(_de.items[y]);}}var _e5={identifier:"description",label:"description",items:_e4};var _e6=new dojo.data.ItemFileReadStore({data:_e5});var _e7=dijit.byId("gridRemittanceInstruction");if(_e7){_e7.set("store",_e6);_e7.startup();_e7.render();var _e8=dj.byId("rem_inst_description_view"),_e9=dj.byId("rem_inst_location_code_view"),_ea=dj.byId("rem_inst_servicing_group_alias_view");_e7.store.fetch({query:{preferred:"*"},onComplete:dojo.hitch(this,function(_eb,_ec){dojo.forEach(_eb,function(_ed,_ee){if(_ed.preferred[0]==="Y"&&_e8.get("value")===""){_e7.selection.select(_ee);}else{if(_e8.get("value")===_ed.description[0]&&_e9.get("value")===_ed.locationCode[0]&&_ea.get("value")===_ed.servicingGroupAlias[0]){_e7.selection.select(_ee);}}var _ef=dijit.byId("mode")?dijit.byId("mode").get("value"):"";if((_e2==="mandatory"&&_e0>1&&_e1==="NEW_SWINGLINE")||(_e2==="true"&&_e1==="NEW_SWINGLINE")){_e7.selection.deselect(_ee);}else{if(dijit.byId("remittance_flag").get("value")==="mandatory"){if(_e4.length===parseInt("1",10)){_e7.selection.select(_ee);}}}},this);})});}};function _f0(_f1){var _f2=dj.byId("repricing_frequency");if(_f1.get("value")&&_f2.get("value")){var _f3=_f2.get("value"),_f4,_f5,_f6;if(_f3.length>0){_f4=_f3.substring(0,_f3.length-1);_f5=_f3.substring(_f3.length-1,_f3.length);}if(_f5==="W"){_f6="week";}else{if(_f5==="M"){_f6="month";}else{if(_f5==="Y"){_f6="year";}else{if(_f5==="D"){_f6="day";}}}}return dojo.date.add(_f1.get("value"),_f6,parseInt(_f4,10));}};function _f7(){var _f8=dj.byId("repricing_date");var _f9=dj.byId("effective_date");var _fa=dj.byId("repricing_frequency");var _fb=dj.byId("pricing_option");if(_f9.get("value")){if(misys._config.repricingFrequenciesStores[_fb.get("value")].data.items.length!==0){_fa.set("disabled",false);misys.toggleRequired("repricing_frequency",true);if(_fa.get("value")){dj.byId("repricing_date").set("disabled",false);misys.toggleRequired("repricing_date",true);_f8.set("displayedValue","");_f8.set("value",_f0(_f9));if(misys._config.isRepricingDateFlag){_36();misys._config.isRepricingDateFlag=false;}else{misys._config.isRepricingDateFlag=true;}}}}};function _fc(){var _fd=dj.byId("effective_date");var _fe=_f0(_fd);var _ff=dj.byId("repricing_date").get("value");if(_ff.getDate()===_fe.getDate()&&_ff.getMonth()===_fe.getMonth()&&_ff.getYear()===_fe.getYear()){misys.toggleRequired("repricing_frequency",true);dj.byId("repricing_frequency").set("disabled",false);}else{misys.toggleRequired("repricing_frequency",false);dj.byId("repricing_frequency").set("disabled",true);}};function _100(){var _101=dijit.byId("effective_date");var _102=dijit.byId("default_effective_date");if(_101&&_101.get("value")!=""){_102.set("value",_101.get("displayedValue"));}};function _103(){var _104=dj.byId("bo_facility_id").get("value");var _105=dj.byId("pricing_option").get("value");var _106=dj.byId("appl_date").get("value");var _107=dj.byId("ln_cur_code").get("value");var _108="N";if(_105!==""&&_106!==""&&_107!==""){m.xhrPost({url:m.getServletURL(_1),handleAs:"json",preventCache:true,sync:true,content:{boFacilityId:_104,pricingOptionName:_105,dateToValidate:_106,currency:_107,isRepricingDate:_108},load:function(_109){misys._config.dateValuesResponse=_109;_61(_109["items"]);},error:function(_10a){}});}};function _10b(_10c){var _10d=misys._config.pricingOptionsStore;var _10e=0;var _10f=function(size,_110){_10e=size;};_10d.fetch({query:{},onBegin:_10f,start:0,count:0});if(_10c){if(_10e===1){_10d.fetch({onComplete:function(_111,_112){dojo.forEach(_111,function(item){dijit.byId("pricing_option").set("value",item.name[0]);dijit.byId("pricing_option").set("displayedValue",item.name[0]);});}});}}};function _113(_114){var _115=misys._config.riskTypesStore;var _116=0;var _117=function(size,_118){_116=size;};_115.fetch({query:{},onBegin:_117,start:0,count:0});var _119=dijit.byId("risk_type");if(_114){if(_116===1){_115.fetch({onComplete:function(_11a,_11b){dojo.forEach(_11a,function(item){dijit.byId("risk_type").set("value",item.name[0]);dijit.byId("risk_type").set("displayedValue",item.name[0]);dijit.byId("risk_type").set("disabled",true);});}});}}};d.mixin(m._config,{initReAuthParams:function(){var _11c={productCode:"LN",subProductCode:"",transactionTypeCode:"01",entity:dj.byId("entity")?dj.byId("entity").get("value"):"",currency:dj.byId("ln_cur_code")?dj.byId("ln_cur_code").get("value"):"",amount:dj.byId("ln_amt")?m.trimAmount(dj.byId("ln_amt").get("value")):"",es_field1:"",es_field2:""};return _11c;}});d.mixin(m,{bind:function(){if(d.isIE){window.isDrawdown=true;}else{window.isDrawdown=false;}m.connect("ln_amt","onBlur",_12);m.connect("pricing_option","onChange",function(){dijit.byId("ln_cur_code").set("disabled",false);misys.toggleRequired("ln_cur_code",true);if(dijit.byId("ln_cur_code")&&dijit.byId("ln_cur_code").get("value")!==null){dijit.byId("ln_amt").set("disabled",true);misys.toggleRequired("ln_amt",false);dijit.byId("effective_date").set("disabled",true);misys.toggleRequired("effective_date",false);}if(dijit.byId("effective_date")&&dijit.byId("effective_date").get("value")!==null){dijit.byId("effective_date").set("value","");dijit.byId("effective_date").set("displayedValue","");}if(dijit.byId("repricing_date")&&dijit.byId("repricing_date").get("value")!==null){dijit.byId("repricing_date").set("value","");dijit.byId("repricing_date").set("displayedValue","");}});m.connect("pricing_option","onChange",_cd);misys.connect("pricing_option","onChange",_b2);m.connect("effective_date","onChange",function(){if(misys._config.isEffectiveDateFlag&&_a6()){_13();}else{misys._config.isEffectiveDateFlag=true;}});m.connect("effective_date","onChange",_f7);m.connect("repricing_date","onChange",function(){if(misys._config.isRepricingDateFlag&&_af()){_36();}else{misys._config.isRepricingDateFlag=true;}});m.connect("repricing_frequency","onChange",_f7);misys.connect("issuing_bank_abbv_name","onChange",misys.populateReferences);misys.setValidation("effective_date",_4);misys.setValidation("ln_maturity_date",_1c);misys.setValidation("repricing_date",_75);if(dijit.byId("issuing_bank_abbv_name")){misys.connect("entity","onChange",function(){dijit.byId("issuing_bank_abbv_name").onChange();});}misys.connect("ln_cur_code","onChange",function(){misys.setCurrency(this,["ln_amt"]);var _11d=dijit.byId("ln_amt");var _11e=dijit.byId("ln_cur_code");_11d.focus();_11d.onBlur();if(_11e&&_11e.get("value")!==""){_11d.set("disabled",false);misys.toggleRequired("ln_amt",true);dijit.byId("effective_date").set("disabled",false);misys.toggleRequired("effective_date",true);if(dijit.byId("effective_date")&&dijit.byId("effective_date").get("value")!==null){dijit.byId("effective_date").set("value","");dijit.byId("effective_date").set("displayedValue","");}_13();_100();}else{if(_11e&&_11e.get("value")===""){_11d.set("disabled",true);misys.toggleRequired("ln_amt",false);dijit.byId("effective_date").set("disabled",true);misys.toggleRequired("effective_date",false);}}_21();_d1(false);_dd();});if(dj.byId("screenMode").get("value")==="UNSIGNED"){_d1(true);_dd();}m.connect("cancelReauthentication","onClick",function(){dijit.byId("fx_conversion_rate").set("disabled",true);});var _11f=dj.byId("gridLoanInterestDetails");if(_11f){var _120=_11f.store;_120.comparatorMap={};_120.comparatorMap["interest_cycle"]=misys.grid.sortAmountColumn;_120.comparatorMap["start_date"]=misys.grid.sortDateColumn;_120.comparatorMap["end_date"]=misys.grid.sortDateColumn;_120.comparatorMap["adjusted_due_date"]=misys.grid.sortDateColumn;_120.comparatorMap["projected_cycleDue_amt"]=misys.grid.sortAmountColumn;_120.comparatorMap["accrued_toDate_amt"]=misys.grid.sortAmountColumn;_120.comparatorMap["paid_toDate_amt"]=misys.grid.sortAmountColumn;_120.comparatorMap["billed_interest_amt"]=misys.grid.sortAmountColumn;}},toggleRemittanceInst:function(){var _121=d.byId("actionDown");var _122=d.byId("actionUp");var _123=d.byId("remittanceInstContainer");if(d.style("remittanceInstContainer","display")==="none"){m.animate("wipeIn",_123);d.style("actionDown","display","none");d.style("actionUp","display","block");d.style("actionUp","cursor","pointer");dijit.byId("gridRemittanceInstruction")._refresh();}else{m.animate("wipeOut",_123);d.style("actionUp","display","none");d.style("actionDown","display","block");d.style("actionDown","cursor","pointer");}},toggleLoanInterestDetails:function(){var _124=d.byId("actionDown");var _125=d.byId("actionUp");var _126=d.byId("loanInterestDetailsContainer");if(d.style("loanInterestDetailsContainer","display")==="none"){m.animate("wipeIn",_126);dj.byId("gridLoanInterestDetails").resize();d.style("actionDown","display","none");d.style("actionUp","display","block");d.style("actionUp","cursor","pointer");}else{m.animate("wipeOut",_126);d.style("actionUp","display","none");d.style("actionDown","display","block");d.style("actionDown","cursor","pointer");}},onFormLoad:function(){if(misys._config.displayMode==="view"){_21();}if(dj.byId("effective_date")&&misys._config.displayMode!=="edit"){_70();}if(misys._config.displayMode==="edit"){_13();}misys._config.warningMessages=[];misys.setCurrency(dijit.byId("ln_cur_code"),["ln_amt"]);var _127=dijit.byId("issuing_bank_abbv_name");if(_127){_127.onChange();}var _128=dijit.byId("issuing_bank_customer_reference");if(_128){_128.onChange();}if(dj.byId("repricing_frequency_view")&&dj.byId("repricing_frequency")){_b2();dj.byId("repricing_frequency").set("value",dj.byId("repricing_frequency_view").get("value"),false);var _129=dj.byId("repricing_date");var _12a=dj.byId("effective_date");var _12b=dj.byId("repricing_frequency");if(_12a.get("value")&&_12b.get("value")&&_129.get("value")){dj.byId("repricing_date").onChange();}}if(dijit.byId("operationValue")&&dijit.byId("operationValue").get("value")==="NEW_SWINGLINE"){_10b(true);}_113(true);_cd(true);if(!dijit.byId("ln_cur_code").get("value")){dijit.byId("ln_amt").set("disabled",true);misys.toggleRequired("ln_amt",false);}if(!dijit.byId("pricing_option").get("value")){dijit.byId("ln_cur_code").set("disabled",true);misys.toggleRequired("ln_cur_code",false);dijit.byId("ln_amt").set("disabled",true);misys.toggleRequired("ln_amt",false);dj.byId("effective_date").set("disabled",true);misys.toggleRequired("effective_date",false);dijit.byId("repricing_frequency").set("disabled",true);misys.toggleRequired("repricing_frequency",false);dijit.byId("repricing_date").set("disabled",true);misys.toggleRequired("repricing_date",false);dijit.byId("ln_cur_code").set("disabled",true);misys.toggleRequired("ln_cur_code",false);dijit.byId("ln_amt").set("disabled",true);misys.toggleRequired("ln_amt",false);dijit.byId("ln_maturity_date").set("disabled",true);misys.toggleRequired("ln_maturity_date",false);}if(dijit.byId("operationValue")&&dijit.byId("operationValue")!==""&&dijit.byId("operationValue").get("value")==="NEW_SWINGLINE"){_d1(true);}else{_d1(false);}if(dijit.byId("ln_cur_code").get("value")!==""){_dd();}if(dijit.byId("remittance_flag").get("value")==="mandatory"){dojo.style(d.byId("remittanceInstContainer"),"display","block");dijit.byId("gridRemittanceInstruction")._refresh();}_21();_103();if(!dj.byId("repricing_frequency").get("value")){dj.byId("repricing_date").set("disabled",true);m.toggleRequired("repricing_date",false);}},beforeSaveValidations:function(){var _12c=dj.byId("entity");if(_12c&&_12c.get("value")===""){return false;}else{return true;}},toggleLegalTextDetails:function(){var _12d=d.byId("actionDown");var _12e=d.byId("actionUp");var _12f=d.byId("LegalTextContainer");if(d.style("LegalTextContainer","display")==="none"){m.animate("wipeIn",_12f);d.style("actionDown","display","none");d.style("actionUp","display","block");d.style("actionUp","cursor","pointer");}else{m.animate("wipeOut",_12f);d.style("actionUp","display","none");d.style("actionDown","display","block");d.style("actionDown","cursor","pointer");}},onCancelNavigation:function(){var _130=misys._config.homeUrl;var _131=["/screen/LoanScreen?","operation=List_Deals_Swingline"];_130=misys.getServletURL(_131.join(""));return _130;},setCustomConfirmMessage:function(){m._config.globalSubmitConfirmationMsg=m.getLocalization("submitTransactionConfirmationForSwingline",["Swingline"]);},beforeSubmitValidations:function(){var _132=false;if(_14()){_132=_10();}if(!_132){m._config.legalTextEnabled=false;return false;}var _133=m.isLegalTextAcceptedForAuthorizer();if(_132&&!(_133)){m._config.legalTextEnabled=true;return false;}else{if(_132&&(_133)){return true;}}return false;}});m._config=m._config||{};d.mixin(m._config,{xmlTransform:function(xml){var _134=m._config.xmlTagName,_135=_134?["<",_134,">"]:[];if(xml.indexOf(_134)!=-1){var dom=dojox.xml.DomParser.parse(xml);var _136=xml.substring(_134.length+2,(xml.length-_134.length-3));var _137=dijit.byId("gridRemittanceInstruction");if(_137&&_137.selection&&_137.selection.getSelected()&&_137.selection.getSelected()[0]&&_137.selection.getSelected()[0].description&&_137.selection.getSelected()[0].description[0]){_136=_136.concat("<rem_inst_description>");_136=_136.concat(_137.selection.getSelected()[0].description[0]);_136=_136.concat("</rem_inst_description>");_136=_136.concat("<rem_inst_location_code>");_136=_136.concat(_137.selection.getSelected()[0].locationCode[0]);_136=_136.concat("</rem_inst_location_code>");_136=_136.concat("<rem_inst_servicing_group_alias>");_136=_136.concat(_137.selection.getSelected()[0].servicingGroupAlias[0]);_136=_136.concat("</rem_inst_servicing_group_alias>");_136=_136.concat("<rem_inst_account_no>");_136=_136.concat(_137.selection.getSelected()[0].accountNo[0]);_136=_136.concat("</rem_inst_account_no>");}else{_136=_136.concat("<rem_inst_description>");_136=_136.concat("</rem_inst_description>");_136=_136.concat("<rem_inst_location_code>");_136=_136.concat("</rem_inst_location_code>");_136=_136.concat("<rem_inst_servicing_group_alias>");_136=_136.concat("</rem_inst_servicing_group_alias>");_136=_136.concat("<rem_inst_account_no>");_136=_136.concat("</rem_inst_account_no>");}if(dijit.byId("legalDialog")&&dijit.byId("accept_legal_text")&&dijit.byId("accept_legal_text").get("checked")){_136=_136.concat("<accept_legal_text>");_136=_136.concat("Y");_136=_136.concat("</accept_legal_text>");}else{if(dijit.byId("legalDialog")&&dijit.byId("accept_legal_text")&&!(dijit.byId("accept_legal_text").get("checked"))){_136=_136.concat("<accept_legal_text>");_136=_136.concat("N");_136=_136.concat("</accept_legal_text>");}}_135.push(_136);if(_134){_135.push("</",_134,">");}return _135.join("");}else{return xml;}}});})(dojo,dijit,misys);dojo.require("misys.client.binding.loan.create_ln_swg_client");}