/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.loan.payment_ln"]){dojo._hasResource["misys.binding.loan.payment_ln"]=true;dojo.provide("misys.binding.loan.payment_ln");dojo.require("dojo.parser");dojo.require("misys.widget.Dialog");dojo.require("dijit.form.Button");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.DateTextBox");dojo.require("dijit.form.Form");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("misys.widget.Collaboration");(function(d,dj,m){function _1(_2){var _3=dijit.byId("org_ln_liab_amt").get("value");var _4=parseFloat(_3)-parseFloat(_2);if(dijit.byId("ln_liab_amt")&&_4>-1){dijit.byId("ln_liab_amt").set("value",_4);}};function _5(_6){if(!this.get("value")){return true;}var _7=this.get("value");var _8=new Date();_8.setHours(0,0,0,0);var _9=d.date.compare(m.localizeDate(this),_8)<0?false:true;if(!_9){this.invalidMessage=m.getLocalization("paymentDateSmallerThanSystemDate",[m.getLocalizeDisplayDate(this)]);return false;}var _a=m.localizeDate(dj.byId(this.id));var _b=dj.byId("facility_maturity_date");if(_b){var _c=m.localizeDate(_b);if(d.date.compare(_a,_c)>0){this.invalidMessage=m.getLocalization("repaymentDateGreaterThanFacilityMaturityDate",[m.getLocalizeDisplayDate(this),m.getLocalizeDisplayDate(_b)]);return false;}}var _d=dj.byId("effective_date");if(_d){var _e=m.localizeDate(_d);if(d.date.compare(_e,_a)>0){this.invalidMessage=m.getLocalization("repaymentDateSmallerThanLoanEffectiveDate",[m.getLocalizeDisplayDate(this),m.getLocalizeDisplayDate(_d)]);return false;}}var _f=dj.byId("ln_maturity_date");if(_f){var _10=m.localizeDate(_f);if(d.date.compare(_a,_10)>0){this.invalidMessage=m.getLocalization("repaymentDateGreaterThanLoanMaturityDate",[m.getLocalizeDisplayDate(this),m.getLocalizeDisplayDate(_f)]);return false;}}var _11=dj.byId("appl_date");if(_11){var _12=m.localizeDate(_11);if(d.date.compare(_12,_a)>0){this.invalidMessage=m.getLocalization("loanRepaymentDateLesserThanLoanApplDateError",[this.getDisplayedValue(),_11.getDisplayedValue()]);return false;}}return true;};function _13(){if(dj.byId("tnx_amt")){if(!m.validateAmount((dj.byId("tnx_amt"))?dj.byId("tnx_amt"):0)){m._config.onSubmitErrorMsg=m.getLocalization("amountcannotzero");dj.byId("tnx_amt").set("value","");return false;}}return false;};function _14(){var _15=dj.byId("ln_access_type");if(_15){if(_15.get("value")==="A"){return true;}else{m._config.onSubmitErrorMsg=misys.getLocalization("facilityBlockError",[dj.byId("bo_facility_name").get("value")]);}}return false;};function _16(_17){var _18=this;var _19=this.get("value");var _1a=dj.byId("ln_liab_amt");var _1b=dj.byId("org_ln_liab_amt");var _1c=d.number.parse(_1b.get("value"));if(_19&&_1c&&_1c<_19){_18.focus();var _1d=m.getLocalization("paymentAmtGreaterThanLiabAmtError");_18.set("value","");_18.set("state","Error");dj.hideTooltip(_18.domNode);dj.showTooltip(_1d,_18.domNode,0);return false;}if(_19!==null&&(!isNaN(_19))&&(_19>=0)&&_1a){_1(_19);}else{if((isNaN(_19)||(_19<0))&&_1a&&_1b){_1a.set("value",_1b.get("value"));}}if(_19<=0){return false;}};d.mixin(m._config,{initReAuthParams:function(){var _1e={productCode:"LN",subProductCode:"",transactionTypeCode:"13",entity:dj.byId("entity")?dj.byId("entity").get("value"):"",currency:dj.byId("ln_cur_code")?dj.byId("ln_cur_code").get("value"):"",amount:dj.byId("ln_amt")?m.trimAmount(dj.byId("ln_amt").get("value")):"",es_field1:"",es_field2:""};return _1e;}});d.mixin(m,{bind:function(){m.setValidation("maturity_date",_5);m.connect("tnx_amt","onChange",_16);},onFormLoad:function(){},toggleLegalTextDetails:function(){var _1f=d.byId("actionDown");var _20=d.byId("actionUp");var _21=d.byId("LegalTextContainer");if(d.style("LegalTextContainer","display")==="none"){m.animate("wipeIn",_21);dj.byId("LegalTextDetailsGrid").resize();d.style("actionDown","display","none");d.style("actionUp","display","block");d.style("actionUp","cursor","pointer");}else{m.animate("wipeOut",_21);d.style("actionUp","display","none");d.style("actionDown","display","block");d.style("actionDown","cursor","pointer");}},onCancelNavigation:function(){var _22=misys._config.homeUrl;var _23=["/screen/LoanScreen?mode=PAYMENT&tnxtype=13","&option=EXISTING"];_22=misys.getServletURL(_23.join(""));return _22;},beforeSubmitValidations:function(){var _24=false;if(dj.byId("tnx_amt")){if(!m.validateAmount((dj.byId("tnx_amt"))?dj.byId("tnx_amt"):0)){m._config.onSubmitErrorMsg=m.getLocalization("amountcannotzero");dj.byId("tnx_amt").set("value","");m._config.legalTextEnabled=false;return false;}}_24=_14();if(!_24){m._config.legalTextEnabled=false;return false;}var _25=m.isLegalTextAcceptedForAuthorizer();if(_24&&!(_25)){m._config.legalTextEnabled=true;return false;}else{if(_24&&(_25)){return true;}}return false;}});m._config=m._config||{};d.mixin(m._config,{xmlTransform:function(xml){var _26=m._config.xmlTagName,_27=_26?["<",_26,">"]:[];if(xml.indexOf(_26)!=-1){var _28=xml.substring(_26.length+2,(xml.length-_26.length-3));if(dijit.byId("legalDialog")&&dijit.byId("accept_legal_text")&&dijit.byId("accept_legal_text").get("checked")){_28=_28.concat("<accept_legal_text>");_28=_28.concat("Y");_28=_28.concat("</accept_legal_text>");}else{if(dijit.byId("legalDialog")&&dijit.byId("accept_legal_text")&&!(dijit.byId("accept_legal_text").get("checked"))){_28=_28.concat("<accept_legal_text>");_28=_28.concat("N");_28=_28.concat("</accept_legal_text>");}}_27.push(_28);if(_26){_27.push("</",_26,">");}return _27.join("");}else{return xml;}}});})(dojo,dijit,misys);dojo.require("misys.client.binding.loan.payment_ln_client");}