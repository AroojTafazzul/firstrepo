/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.loan.create_ln"]){dojo._hasResource["misys.binding.loan.create_ln"]=true;dojo.provide("misys.binding.loan.create_ln");dojo.require("dojo.parser");dojo.require("dijit.layout.TabContainer");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("misys.widget.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dojo.data.ItemFileReadStore");dojo.require("misys.form.file");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("misys.widget.Collaboration");dojo.require("misys.binding.SessionTimer");dojo.require("dojox.xml.DomParser");(function(d,dj,m){misys._config.isDirtyFlag=false;misys._config.isValid=false;misys._config.isEffectiveDateFlag=false;misys._config.isRepricingDateFlag=false;var _1="/screen/AjaxScreen/action/GetBusinessDayValidatedDate";var _2="CUSTOM-NO-CANCEL";var _3="[INFO] No deals for the borrower found.";function _4(){if(!this.get("value")){return true;}var _5=dj.byId(this.id);var _6=_5.get("value");var _7=new Date();_7.setHours(0,0,0,0);var _8=d.date.compare(m.localizeDate(this),_7)<0?false:true;if(!_8){this.invalidMessage=m.getLocalization("effectiveDateGreaterThanSystemDate",[m.getLocalizeDisplayDate(this)]);return false;}var _9=dijit.byId("facility_effective_date");if(!m.compareDateFields(_9,_5)){this.invalidMessage=misys.getLocalization("loanEffDateGreaterThanFacEffDateError",[m.getLocalizeDisplayDate(this),m.getLocalizeDisplayDate(_9)]);return false;}var _a=dijit.byId("facility_expiry_date");if(!m.compareDateFields(_5,_a)){this.invalidMessage=misys.getLocalization("loanEffDateLessThanFacExpDateError",[m.getLocalizeDisplayDate(this),m.getLocalizeDisplayDate(_a)]);return false;}var _b=dijit.byId("facility_maturity_date");if(!m.compareDateFields(_5,_b)){this.invalidMessage=misys.getLocalization("loanEffDateLessThanFacMatDateError",[m.getLocalizeDisplayDate(this),m.getLocalizeDisplayDate(_b)]);return false;}var _c=dijit.byId("ln_maturity_date");if(_5&&_c&&_5.displayedValue&&_c.displayedValue){if(d.date.compare(m.localizeDate(_5),m.localizeDate(_c))>=0){this.invalidMessage=misys.getLocalization("loanEffDateLessThanLoanMatDateError",[m.getLocalizeDisplayDate(this),m.getLocalizeDisplayDate(_c)]);return false;}}_d();return true;};function _e(_f){var _10=dj.byId("date_format").get("value");var _11=_f.split("/");var _12;if(_10==="MM/dd/yyyy"){_12=new Date(parseInt(_11[2],10),parseInt(_11[0],10)-1,parseInt(_11[1],10));}else{if(_10==="dd/MM/yyyy"){_12=new Date(parseInt(_11[2],10),parseInt(_11[1],10)-1,parseInt(_11[0],10));}}return _12;};function _13(){var _14=true;var _15;m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/ValidateDrawdownLoanLimitAmount"),handleAs:"json",preventCache:true,sync:true,content:{xml:misys.formToXML()},load:function(_16,_17){_14=_16.isValid;_15=_16.errorMsg;},error:function(_18,_19){_14=false;console.error("Process drawdown error due to limit violation",_18);}});if(!_14){m._config.onSubmitErrorMsg=_15;return false;}else{return true;}};function _1a(){if(_1b()&&_1c()){if(_d()){if(dj.byId("screenMode").get("value")==="UNSIGNED"){_1d();_13();if(m._config.onSubmitErrorMsg&&m._config.onSubmitErrorMsg!==""){return false;}else{return true;}}else{return true;}}}return false;};function _1e(){var _1f={identifier:"description",label:"description",items:misys._config.remittanceInstructions};var _20;if(dj.byId("screenMode").get("value")==="UNSIGNED"){_20=dj.byId("ln_cur_code_unsigned").get("value");}else{_20=dj.byId("ln_cur_code").get("value");}var _21=0;if(_1f.items&&_1f.items.length){_21=_1f.items.length;}var _22=true;var y;for(y=0;y<_21;y++){if(_20===_1f.items[y].currency[0]){_22=false;break;}}if(dijit.byId("remittance_flag").get("value")==="mandatory"&&!_22){var _23=dijit.byId("gridRemittanceInstruction");var _24=_23.selection.getSelected();if(_24.length!==0){return true;}else{if(dj.byId("screenMode").get("value")==="UNSIGNED"){m._config.onSubmitErrorMsg=misys.getLocalization("ErrorForMandatoryRemittanceForCheckerUser");}else{m._config.onSubmitErrorMsg=misys.getLocalization("ErrorForMandatoryRemittance");}return false;}}return true;};function _1b(){var _25=dj.byId("ln_access_type");if(_25){if(_25.get("value")==="A"){return true;}else{m._config.onSubmitErrorMsg=misys.getLocalization("facilityBlockError",[dj.byId("bo_facility_name").get("value")]);}}return false;};function _26(){if(this.get("value")==null){return true;}var _27=dj.byId(this.id);var _28=dijit.byId("facility_maturity_date");if(!m.compareDateFields(_27,_28)){this.invalidMessage=misys.getLocalization("loanMatDateGreaterThanFacMatDateError",[m.getLocalizeDisplayDate(this),m.getLocalizeDisplayDate(_28)]);return false;}var _29=dijit.byId("effective_date");if(_27&&_29&&_27.value&&_29.value){if(d.date.compare(m.localizeDate(_27),m.localizeDate(_29))<=0){this.invalidMessage=misys.getLocalization("loanMatDateLessThanLoanEffDateError",[m.getLocalizeDisplayDate(this),m.getLocalizeDisplayDate(_29)]);return false;}}var _2a=dijit.byId("repricing_date");if(!m.compareDateFields(_2a,_27)){this.invalidMessage=misys.getLocalization("loanMatDateGreaterThanLoanRepDateError",[m.getLocalizeDisplayDate(_27),m.getLocalizeDisplayDate(_2a)]);return false;}return true;};function _2b(){var _2c=dijit.byId("borrower_limit_cur_code");var _2d=dijit.byId("ln_cur_code");var _2e=dojo.byId("facFXRateId");if(_2c&&_2d.get("value")!==""&&(_2d.get("value")!==_2c.get("value"))){var _2f=_2d.get("value");_2d.store.fetch({query:{id:_2d.get("value")},onComplete:dojo.hitch(this,function(_30,_31){dojo.forEach(_30,function(_32){dijit.byId("fx_display").set("value","1 "+_2c.get("value")+" = "+_32.limitFXRate[0]+" "+_2d.get("value"));dijit.byId("fx_conversion_rate").set("value",_32.limitFXRate[0]);dojo.style(_2e,"display","block");},this);})});}else{dojo.style(_2e,"display","none");}};function _1d(){var _33=dj.byId("bo_facility_id").get("value");var _34=dj.byId("ln_cur_code");var _35=dj.byId("ln_cur_code_unsigned");var _36="N";var _37=dj.byId("effective_date");var _38=dj.byId("effective_date_unsigned");var _39;var _3a;var _3b;var _3c;var _3d;if(dj.byId("screenMode").get("value")==="UNSIGNED"){_3c=_38.get("value");_3a=dijit.byId("pricing_option_unsigned").get("value");_3d=_35.get("value");}else{_3c=_37.get("displayedValue");_3a=dijit.byId("pricing_option").get("value");_3d=_34.get("value");}m.xhrPost({url:m.getServletURL(_1),handleAs:"json",preventCache:true,sync:true,content:{boFacilityId:_33,pricingOptionName:_3a,dateToValidate:_3c,currency:_3d,isRepricingDate:_36},load:function(_3e){misys._config.dateValuesResponse=_3e;if(misys._config.displayMode==="edit"){if(_3e.items.dateValues&&dj.byId("effective_date").get("displayedValue")===_3e.items.dateValues[0].localizedDate){misys._config.isEffectiveDateFlag=true;}else{misys._config.isEffectiveDateFlag=false;}_57();}else{if(_3e.items.dateValues&&dj.byId("effective_date_unsigned").get("value")!==_3e.items.dateValues[0].localizedDate){m._config.onSubmitErrorMsg=m.getLocalization("unsignedEffectiveDateNonBusinessDayError",[_3e.items.dateValues[0].localizedDate]);}}},error:function(_3f){}});};function _40(){var _41=dj.byId("bo_facility_id").get("value");var _42=dj.byId("pricing_option").get("value");var _43=dj.byId("repricing_date").get("displayedValue");var _44=dj.byId("ln_cur_code").get("value");var _45="Y";m.xhrPost({url:m.getServletURL(_1),handleAs:"json",preventCache:true,sync:true,content:{boFacilityId:_41,pricingOptionName:_42,dateToValidate:_43,currency:_44,isRepricingDate:_45},load:function(_46){misys._config.dateValuesResponse=_46;if(_46.items.dateValues&&dj.byId("repricing_date").get("displayedValue")===_46.items.dateValues[0].localizedDate){misys._config.isRepricingDateFlag=true;}else{misys._config.isRepricingDateFlag=false;}_48();},error:function(_47){}});};function _48(){var _49=dj.byId("repricing_date");var _4a=dj.byId("repricing_date").get("displayedValue");var _4b=(dj.byId("repricing_date").get("value")!==null)?dj.byId("repricing_date").get("value"):"";var _4c;var _4d=misys._config.dateValuesResponse["items"];_49.store=new dojo.data.ItemFileReadStore({data:{identifier:"id",label:"name",items:_4d["dateValues"]}});var _4e=0;var _4f=function(_50,_51){_4e=_50;};_49.get("store").fetch({query:{},onBegin:_4f,start:0,count:0});var _52=_49.store._arrayOfTopLevelItems[0].name[0];var _53=_52.split("/");var _54=new Date(parseInt(_53[2],10),parseInt(_53[1],10)-1,parseInt(_53[0],10));_49.set("value",_54);var _55=new Date(_4b);_49.set("value",_54);if(_54.valueOf()>_55.valueOf()||_54.valueOf()<_55.valueOf()){var _56=m.getLocalization("repricingDateBusinessDayValidationErrorMsg",[_4a]);setTimeout(function(){m.dialog.show(_2,_56,"Info");},2000);}};function _57(){var _58=dj.byId("effective_date");var _59=dj.byId("effective_date").get("displayedValue");var _5a=(dj.byId("effective_date").get("value")!==null)?dj.byId("effective_date").get("value"):"";var _5b;var _5c=misys._config.dateValuesResponse["items"];var _5d;_58.store=new dojo.data.ItemFileReadStore({data:{identifier:"id",label:"name",items:_5c["dateValues"]}});var _5e=0;var _5f=function(_60,_61){_5e=_60;};_58.get("store").fetch({query:{},onBegin:_5f,start:0,count:0});if(_5e!==0){_5d=_58.store._arrayOfTopLevelItems[0].name[0];var _62=_5d.split("/");var _63=new Date(parseInt(_62[2],10),parseInt(_62[1],10)-1,parseInt(_62[0],10));var _64=new Date(_5a);var _65=dijit.byId("default_effective_date");var _66=dijit.byId("appl_date");var _67=dijit.byId("effective_date");var _68=_67;if((m.compareDateFields(_66,_68))&&!(m.compareDateFields(_65,_68))){var _69=m.getLocalization("defaultEffectiveDateErrorMsg",[_65.get("displayedValue")]);m.dialog.show(_2,_69,"Info");_58.set("value",_63);return true;}if(!((m.compareDateFields(_66,_68))&&!(m.compareDateFields(_65,_68)))){if(_63.valueOf()>_64.valueOf()||_63.valueOf()<_64.valueOf()){var _6a=m.getLocalization("effectiveDateBusinessDayValidationErrorMsg",[_59]);m.dialog.show(_2,_6a,"Info");_58.set("value",_63);return true;}}_58.set("value",_63);return true;}};function _6b(_6c){var _6d=_6c.dateValues[0].localizedDate;var _6e=dj.byId("default_effective_date");_6e.set("value",_6d);};function _6f(){var _70;if(dj.byId("screenMode").get("value")==="UNSIGNED"){_70=dijit.byId("pricing_option_unsigned").get("value");}else{_70=dijit.byId("pricing_option").get("value");}var _71=misys._config.pricingOptionsStore;_71.fetch({query:{id:_70},onComplete:dojo.hitch(this,function(_72,_73){var _74=_72[0];if(_74){var _75=_74.serverDate;var _76=new Date(_75);if(dj.byId("screenMode").get("value")!="UNSIGNED"){dj.byId("effective_date").set("value",_76);}}})});};function _77(str){var _78=new Date(str),_79=("0"+(_78.getMonth()+1)).slice(-2),day=("0"+_78.getDate()).slice(-2);return [day,_79,_78.getFullYear()].join("/");};function _7a(){var _7b=dj.byId("effective_date");if(_7b.get("value")!==null){_40();}};function _7c(){var _7d=dijit.byId("effective_date_hidden_field");if(dj.byId("screenMode").get("value")==="UNSIGNED"){dijit.byId("effective_date_unsigned").set("value",dijit.byId("effective_date_unsigned").get("value"));var _7e=dijit.byId("effective_date_unsigned");if(!m.compareDateFields(_7d,_7e)){m._config.onSubmitErrorMsg=m.getLocalization("intendNoticeDaysErrorMsgForDrawDown",[m.getLocalizeDisplayDate(_7d)]);return false;}}else{if(!this.get("value")){return true;}m._config=m._config||{};m._config.repricingDatesValidationInprocess=false;if(!m._config.repricingDatesValidationInprocess){if(!m.compareDateFields(_7d,this)){m._config.repricingDatesValidationInprocess=true;this.invalidMessage=m.getLocalization("intendNoticeDaysErrorMsgForDrawDown",[m.getLocalizeDisplayDate(_7d)]);return false;}}m._config.repricingDatesValidationInprocess=false;}return true;};function _7f(){if(this.get("value")==null){return true;}var _80=dj.byId(this.id);var _81=dj.byId("repricing_date");var _82=dijit.byId("effective_date");if(m.compareDateFields(_81,_82)){this.invalidMessage=misys.getLocalization("loanRepricingDateGreaterThanLoanEffDateError",[m.getLocalizeDisplayDate(_81),m.getLocalizeDisplayDate(_82)]);return false;}var _83=dijit.byId("ln_maturity_date");if(!m.compareDateFields(_81,_83)){this.invalidMessage=misys.getLocalization("loanRepricingDateLessThanLoanMatDateError",[m.getLocalizeDisplayDate(_81),m.getLocalizeDisplayDate(_83)]);return false;}var _84=dijit.byId("facility_maturity_date");if(!m.compareDateFields(_81,_84)){this.invalidMessage=misys.getLocalization("loanRepricingDateLessThanFacMatDateError",[m.getLocalizeDisplayDate(_81),m.getLocalizeDisplayDate(_84)]);return false;}return true;};function _1c(){if(dj.byId("ln_amt")){var _85=dj.byId("ln_amt");if(_85.get("value")==null){return true;}if(_85.get("value")<=0){_85.set("state","Error");dj.hideTooltip(_85.domNode);var _86=misys.getLocalization("loanAmountZeroError");dj.showTooltip(_86,_85.domNode,["after"],0);setTimeout(function(){dj.hideTooltip(_85.domNode);},5000);return false;}var _87=dijit.byId("ln_cur_code");var _88=dijit.byId("risk_type");var _89=d.cldr.monetary.getData(_87.get("value"));if(_87&&_87.get("value")){var _8a=0;var _8b=0;var _8c=0;var _8d=0;var _8e=0;var _8f=0;var _90=false;var _91=0;var _92;var _93;misys._config.currenciesStore.fetch({query:{id:_87.get("value")},onItem:function(_94){_8a=_94.limit;_8b=_94.borrowerCcylimit;_8d=_94.borrowerlimit;_8f=_94.swinglineLimit;_8e=_94.limitWithPend;if((_88&&_88.get("value"))){var _95=_88.get("value");_8c=_94[_95];}}});_91=_8a[0];if(_85.get("value")>_8d){_90=true;if(_8d[0]<_91){_91=_8d[0];if(_8d[0]<=0){_92=misys.getLocalization("noAmountForBorrowerLimitError");_93=m.getLocalization("loanBorrowerLevelLimtAmtExceeded");}else{_92=misys.getLocalization("loanAmountTooBigThanBorrowerLimitAmtError",[_87.get("value"),d.currency.format((Math.floor(_91*100)/100),{round:_89.round,places:_89.places})]);_93=m.getLocalization("loanBorrowerLevelLimtAmtExceeded");}}}if(_88&&_88.get("value")){if(_85.get("value")>_8c){_90=true;if(_8c[0]<_91){_91=_8c[0];if(_8c[0]<=0){_92=misys.getLocalization("noAmountForRiskLimitError");_93=m.getLocalization("loanBorrowerRiskTypeLimtAmtExceeded");}else{_92=misys.getLocalization("loanAmountTooBigThanBorrowerRiskTypeLimitAmtError",[_87.get("value"),d.currency.format((Math.floor(_91*100)/100),{round:_89.round,places:_89.places})]);_93=m.getLocalization("loanBorrowerRiskTypeLimtAmtExceeded");}}}}if(_85.get("value")>_8f){_90=true;if(_8f[0]<_91){_91=_8f[0];if(_8f[0]<=0){_92=misys.getLocalization("noAmountForLoanSublimitLimitError");_93=m.getLocalization("noAmountForLoanSublimitLimitError");}else{_92=misys.getLocalization("loanAmountTooBigLoanSublimitAmtError",[_87.get("value"),d.currency.format((Math.floor(_91*100)/100),{round:_89.round,places:_89.places})]);_93=m.getLocalization("loanBorrowerCcyLimtAmtExceeded");}}}if(_85.get("value")>_8b){_90=true;if(_8b[0]<_91){_91=_8b[0];if(_8b[0]<=0){_92=misys.getLocalization("noAmountForCurrencyLimitError",[_87.get("value")]);_93=m.getLocalization("loanBorrowerCcyLimtAmtExceeded");}else{_92=misys.getLocalization("loanAmountTooBigThanBorrowerCcyLimitAmtError",[_87.get("value"),d.currency.format((Math.floor(_91*100)/100),{round:_89.round,places:_89.places})]);_93=m.getLocalization("loanBorrowerCcyLimtAmtExceeded");}}}if(_85.get("value")>_8a){_90=true;if(_8a[0]<=_91){_91=_8a[0];if(_91===0){_92=misys.getLocalization("facilityFullyDrawnError");}else{_92=misys.getLocalization("loanAmountTooBigError",[_87.get("value"),d.currency.format((Math.floor(_91*100)/100),{round:_89.round,places:_89.places})]);}_93=m.getLocalization("loanFacilityAmtExceeded");}}if(_85.get("value")>_8e){_90=true;if(_8e[0]<=_91){_91=_8e[0];if(_91<=0){_92=misys.getLocalization("facilityFullyDrawnErrorWithPend");}else{_92=misys.getLocalization("loanAmountTooBigWithPendError",[_87.get("value"),d.currency.format((Math.floor((_91*100).toFixed(2))/100),{round:_89.round,places:_89.places})]);}_93=m.getLocalization("loanFacilityAmtWithPendExceeded");}}if(dijit.byId("repricingdate_validation").value=="true"){var _96=_99();if(_96.get("limitViolated")){_90=true;var _97=_96.get("limitAmount");var _98=dj.byId("repricing_date").get("displayedValue");if(_97<=_91){_91=_97;if(_91<=0){_92=misys.getLocalization("commitmentScheduleFullyDrawnError");}else{_92=misys.getLocalization("commitmentScheduleAmountErrorForDrawdown",[_87.get("value"),d.currency.format((Math.floor((_91*100).toFixed(2))/100),{round:_89.round,places:_89.places})]);}_93=misys.getLocalization("commitmentScheduleAmountWarningForDrawdown");}}}if(_90){if(misys._config.warnFacilityAmtExceeded){dj.hideTooltip(_85.domNode);dj.showTooltip(_93,_85.domNode,2000);setTimeout(function(){dj.hideTooltip(_85.domNode);},5000);return true;}else{_85.set("state","Error");dj.hideTooltip(_85.domNode);dj.showTooltip(_92,_85.domNode,["after"],0);setTimeout(function(){dj.hideTooltip(_85.domNode);},5000);return false;}}else{misys._config.warningMessages=[];return true;}}return true;}return true;};function _99(){var _9a=dj.byId("repricing_date").displayedValue;var _9b=dj.byId("ln_amt").value;var _9c=new Map();_9c.set("limitViolated",false);if(_9a!==""&&!isNaN(_9b)){var _9d=_9e();if(_9d!==null){var _9f=_9d.get("commitmentSchAmount");var _a0=_9d.get("commitmentScheduled");if(_a0&&(_9b>_9f)){_9c.set("limitViolated",true);_9c.set("limitAmount",_9f);}}}return _9c;};function _9e(){var _a1=dj.byId("bo_facility_id").get("value");var _a2=dj.byId("repricing_date").get("displayedValue");var _a3=dijit.byId("borrower_limit_cur_code").value;var _a4=dijit.byId("ln_cur_code").value;var _a5=dijit.byId("ln_amt").value;var _a6=new Map();if(!isNaN(_a5)&&_a5>=0&&_a2!==""){m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/ValidateAmountWithCommitmentSchedule"),handleAs:"json",preventCache:true,sync:true,content:{facilityid:_a1,repricing_date:_a2,loanAmount:_a5,facilityCurrency:_a3,loanCurrency:_a4},load:function(_a7,_a8){_a6.set("commitmentSchAmount",_a7.commitmentSchAmount);_a6.set("commitmentViolated",_a7.commitmentViolated);_a6.set("commitmentScheduled",_a7.commitmentScheduled);},error:function(_a9,_aa){return null;}});}else{return null;}return _a6;};function _ab(){var _ac=dijit.byId("pricing_option").get("value");var _ad=misys._config.pricingOptionsStore;_ad.fetch({query:{id:_ac},onComplete:dojo.hitch(this,function(_ae,_af){var _b0=_ae[0];if(_b0){var _b1=_b0.intentDaysInAdvance;var _b2=new Date();var _b3=dj.byId("effective_date");var _b4=_b2.getMonth();var _b5=_b2.getFullYear();var day=_b2.getDate();day=parseInt(day,10)+parseInt(_b1,10);var _b6=new Date(_b5,_b4,day);var _b7=_b6.getDay();if(_b7===0){day=parseInt(day,10)+parseInt(1,10);}else{if(_b7===6){day=parseInt(day,10)+parseInt(2,10);}}var _b8=new Date(_b5,_b4,day);var _b9=dj.byId("effective_date_hidden_field");_b5=_b8.getFullYear();_b4=(1+_b8.getMonth()).toString();_b4=_b4.length>1?_b4:"0"+_b4;day=_b8.getDate().toString();day=day.length>1?day:"0"+day;_b9.set("value",day+"/"+_b4+"/"+_b5);}})});};function _d(){var _ba=dj.byId("effective_date");var _bb=dj.byId("effective_date_unsigned");var _bc;var _bd;var _be;var _bf;var _c0;if(dj.byId("screenMode").get("value")==="UNSIGNED"){_bf=_e(_bb.get("value"));_bd=dijit.byId("pricing_option_unsigned").get("value");}else{_bf=_ba.get("value");_bd=dijit.byId("pricing_option").get("value");}var _c1=misys._config.pricingOptionsStore;_c1.fetch({query:{id:_bd},onComplete:dojo.hitch(this,function(_c2,_c3){var _c4=_c2[0];if(_c4){_c0=_c4.serverDate;_bc=new Date(_c0);_be=dijit.byId("effective_date_hidden_field");_be.set("value",_bc);}})});m._config=m._config||{};m._config.repricingDatesValidationInprocess=false;if(!m._config.repricingDatesValidationInprocess){if(misys._config.displayMode==="edit"&&_bf<_bc){m._config.repricingDatesValidationInprocess=true;this.invalidMessage=m.getLocalization("intendNoticeDaysErrorMsgForDrawDown");return false;}else{if(dj.byId("screenMode").get("value")==="UNSIGNED"&&_bf<_bc){m._config.onSubmitErrorMsg=m.getLocalization("unsignedEffectiveDateLesserThanApplDate");return false;}}}m._config.repricingDatesValidationInprocess=false;return true;};function _c5(){var _c6=dijit.byId("effective_date").get("value");var _c7;var _c8;var _c9;if(dj.byId("screenMode").get("value")==="UNSIGNED"){_c7=dijit.byId("pricing_option_unsigned").get("value");}else{_c7=dijit.byId("pricing_option").get("value");}var _ca=misys._config.pricingOptionsStore;_ca.fetch({query:{id:_c7},onComplete:dojo.hitch(this,function(_cb,_cc){var _cd=_cb[0];if(_cd){_c8=_cd.serverDate;_c9=new Date(_c8);}})});if(_c6>=_c9){return true;}else{return false;}};function _ce(){var _cf=dijit.byId("repricing_date").get("value");var _d0=dijit.byId("effective_date").get("value");if(_cf>_d0){return true;}else{return false;}};function _d1(){var _d2=dijit.byId("pricing_option");var _d3=dijit.byId("repricing_frequency");_d3.set("value","");var _d4=_d2.get("value");var _d5=misys._config.repricingFrequenciesStores[_d4];if(_d5){_d3.set("store",new dojo.data.ItemFileReadStore(_d5));var _d6=0;var _d7=function(_d8,_d9){_d6=_d8;};_d3.get("store").fetch({query:{},onBegin:_d7,start:0,count:0});if(_d6==0){misys.toggleRequired("repricing_frequency",false);misys.toggleRequired("repricing_date",false);dj.byId("repricing_date").set("displayedValue","");dj.byId("repricing_date").set("disabled",true);dj.byId("repricing_frequency").set("disabled",true);}else{if(_d6==1){_d3.store.fetch({onComplete:function(_da,_db){dojo.forEach(_da,function(_dc){_d3.set("value",_dc.id);_d3.set("displayedValue",_dc.name[0]);});}});}}}};function _dd(_de){var _df=dijit.byId("pricing_option");var _e0=dijit.byId("ln_cur_code");var _e1=dijit.byId("ln_amt");var _e2=_df.get("value");var _e3=misys._config.facCurrencyStores[_e2];if(_e3){if(_e3.data&&_e3.data.items&&_e3.data.items.length===0){_e0.set("store",misys._config.currenciesStore);misys._config.isValid=false;}else{var _e4=false;var _e5;var _e6;var _e7;for(var j=0;j<_e3.data.items.length;j++){_e5=_e3.data.items[j].name;}if(misys._config.currenciesStore._jsonData!==null){_e6=misys._config.currenciesStore._jsonData.items;for(var i=0;i<_e6.length;i++){_e7=_e6[i].name;if((_e5 instanceof Array&&_e5[0]===_e7)||_e5===_e7){_e4=true;break;}}}if(misys._config.currenciesStore._arrayOfAllItems!==null){_e6=misys._config.currenciesStore._arrayOfAllItems;for(var k=0;k<_e6.length;k++){_e7=_e6[k].name;if(_e5 instanceof Array){if(_e5[0]===_e7[0].trim()){_e4=true;break;}}else{if(_e5===_e7[0].trim()){_e4=true;break;}}}}if(_e4){_e0.set("store",new dojo.data.ItemFileReadStore(_e3));misys._config.isValid=false;}else{_e0.set("value","");_e0.set("store",null);misys._config.isValid=true;}}var _e8=0;var _e9=function(_ea,_eb){_e8=_ea;};if(_e0.get("store")){_e0.get("store").fetch({query:{},onBegin:_e9,start:0,count:0});}if(_e8===0){misys.toggleRequired("ln_cur_code",false);_e0.set("displayedValue","");_e0.set("disabled",true);misys.toggleRequired("ln_amt",false);_e1.set("displayedValue","");_e1.set("disabled",true);}else{if(_de!==true){_e0.set("value","");_e0.set("state","Incomplete");}if(_e8===1&&_e0.store&&_e0.store._arrayOfAllItems.length){_e0.set("value",_e0.store._arrayOfAllItems[0].id[0]);_e0.set("displayedValue",_e0.store._arrayOfAllItems[0].id[0]);}}}if(misys._config.isValid){m.dialog.show("ERROR",misys.getLocalization("ErrorMessageForLoanCurrency"));}};function _ec(_ed){var _ee=dijit.byId("pricing_option").get("value");dj.byId("ln_maturity_date").set("disabled",true);if(misys._config.maturityMandatoryOptions&&misys._config.maturityMandatoryOptions.data&&misys._config.maturityMandatoryOptions.data.items){dojo.forEach(misys._config.maturityMandatoryOptions.data.items,function(_ef){if(_ee===_ef.id){if(_ef.maturityDateMandatory==="Y"){dj.byId("ln_maturity_date").set("disabled",false);m.toggleRequired("ln_maturity_date",true);if(!dj.byId("ln_maturity_date").get("value")&&dj.byId("facility_maturity_date")){dj.byId("ln_maturity_date").set("displayedValue",dj.byId("facility_maturity_date").get("value"));}}else{if(_ed){dj.byId("ln_maturity_date").set("displayedValue","");}m.toggleRequired("ln_maturity_date",false);dj.byId("ln_maturity_date").set("disabled",true);}if(dj.byId("match_funding")){if(_ef.matchFundedIndicator&&_ef.matchFundedIndicator==="Y"){dj.byId("match_funding").set("value","Y");}else{dj.byId("match_funding").set("value","N");}}}});}_dd(_ed);};function _f0(_f1){var _f2={identifier:"description",label:"description",items:misys._config.remittanceInstructions};var _f3=new dojo.data.ItemFileReadStore({data:_f2});var _f4=dijit.byId("gridRemittanceInstruction");if(_f4){_f4.set("store",_f3);_f4.startup();_f4.render();var _f5=dj.byId("rem_inst_description_view"),_f6=dj.byId("rem_inst_location_code_view"),_f7=dj.byId("rem_inst_servicing_group_alias_view");_f4.store.fetch({query:{preferred:"*"},onComplete:dojo.hitch(this,function(_f8,_f9){dojo.forEach(_f8,function(_fa,_fb){if(_fa.preferred[0]==="Y"&&_f5.get("value")===""){_f4.selection.select(_fb);}else{if(_f5.get("value")===_fa.description[0]&&_f6.get("value")===_fa.locationCode[0]&&_f7.get("value")===_fa.servicingGroupAlias[0]){_f4.selection.select(_fb);}else{_f4.selection.deselect(_fb);}}if(_f1){_f4.rowSelectCell.setDisabled(_fb,true);}else{_f4.rowSelectCell.setDisabled(_fb,false);}},this);})});}};function _fc(){var _fd={identifier:"description",label:"description",items:misys._config.remittanceInstructions};var _fe;var _ff=0;var _100=dj.byId("operationValue").get("value");var _101=dijit.byId("remittance_flag").get("value");if(dj.byId("screenMode").get("value")==="UNSIGNED"){_fe=dj.byId("ln_cur_code_unsigned").get("value");}else{_fe=dj.byId("ln_cur_code").get("value");}var _102=0;if(_fd.items&&_fd.items.length){_102=_fd.items.length;}var y;var _103=new Array();for(y=0;y<_102;y++){if(_fe===_fd.items[y].currency[0]){_ff++;_103.push(_fd.items[y]);}}var _104={identifier:"description",label:"description",items:_103};var _105=new dojo.data.ItemFileReadStore({data:_104});var _106=dijit.byId("gridRemittanceInstruction");if(_106){_106.set("store",_105);window.setTimeout(function(){_106.startup();},300);window.setTimeout(function(){_106.render();},600);var _107=dj.byId("rem_inst_description_view"),_108=dj.byId("rem_inst_location_code_view"),_109=dj.byId("rem_inst_servicing_group_alias_view");_106.store.fetch({query:{preferred:"*"},onComplete:dojo.hitch(this,function(_10a,_10b){dojo.forEach(_10a,function(item,_10c){if(item.preferred[0]==="Y"&&_107.get("value")===""){_106.selection.select(_10c);}else{if(_107.get("value")===item.description[0]&&_108.get("value")===item.locationCode[0]&&_109.get("value")===item.servicingGroupAlias[0]){_106.selection.select(_10c);}}var _10d=dijit.byId("mode")?dijit.byId("mode").get("value"):"";if((_101==="mandatory"&&_ff>1&&_100==="NEW_DRAWDOWN")||(_101==="true"&&_100==="NEW_DRAWDOWN")){_106.selection.deselect(_10c);}else{if(dijit.byId("remittance_flag").get("value")==="mandatory"){if(_103.length===parseInt("1",10)){_106.selection.select(_10c);}}}},this);})});}};function _10e(date){var _10f=dj.byId("repricing_frequency");if(date.get("value")&&_10f.get("value")){var _110=_10f.get("value"),_111,_112,_113;if(_110.length>0){_111=_110.substring(0,_110.length-1);_112=_110.substring(_110.length-1,_110.length);}if(_112==="W"){_113="week";}else{if(_112==="M"){_113="month";}else{if(_112==="Y"){_113="year";}else{if(_112==="D"){_113="day";}}}}return dojo.date.add(date.get("value"),_113,parseInt(_111,10));}};function _114(){var _115=dj.byId("repricing_date");var _116=dj.byId("effective_date");var _117=dj.byId("repricing_frequency");var _118=dj.byId("pricing_option");if(_116.get("value")){if(misys._config.repricingFrequenciesStores[_118.get("value")].data.items.length!==0){_117.set("disabled",false);misys.toggleRequired("repricing_frequency",true);if(_117.get("value")){dj.byId("repricing_date").set("disabled",false);misys.toggleRequired("repricing_date",true);_115.set("displayedValue","");_115.set("value",_10e(_116));if(misys._config.isRepricingDateFlag){_40();misys._config.isRepricingDateFlag=false;}else{misys._config.isRepricingDateFlag=true;}}}}};function _119(){var _11a=dj.byId("effective_date");var _11b=_10e(_11a);var _11c=dj.byId("repricing_date").get("value");if(_11c.getDate()===_11b.getDate()&&_11c.getMonth()===_11b.getMonth()&&_11c.getYear()===_11b.getYear()){misys.toggleRequired("repricing_frequency",true);dj.byId("repricing_frequency").set("disabled",false);}else{misys.toggleRequired("repricing_frequency",false);dj.byId("repricing_frequency").set("disabled",true);}};function _11d(){var _11e=dijit.byId("effective_date");var _11f=dijit.byId("default_effective_date");if(_11e&&_11e.get("value")!=""){_11f.set("value",_11e.get("displayedValue"));}};function _120(){var _121=dj.byId("bo_facility_id").get("value");var _122=dj.byId("pricing_option").get("value");var _123=dj.byId("appl_date").get("value");var _124=dj.byId("ln_cur_code").get("value");var _125="N";if(_122!==""&&_123!==""&&_124!==""){m.xhrPost({url:m.getServletURL(_1),handleAs:"json",preventCache:true,sync:true,content:{boFacilityId:_121,pricingOptionName:_122,dateToValidate:_123,currency:_124,isRepricingDate:_125},load:function(_126){misys._config.dateValuesResponse=_126;_6b(_126["items"]);},error:function(_127){}});}};function _128(_129){var _12a=misys._config.pricingOptionsStore;var _12b=0;var _12c=function(size,_12d){_12b=size;};_12a.fetch({query:{},onBegin:_12c,start:0,count:0});if(_129){if(_12b===1){_12a.fetch({onComplete:function(_12e,_12f){dojo.forEach(_12e,function(item){dijit.byId("pricing_option").set("value",item.name[0]);dijit.byId("pricing_option").set("displayedValue",item.name[0]);});}});}}};function _130(_131){var _132=misys._config.riskTypesStore;var _133=0;var _134=function(size,_135){_133=size;};_132.fetch({query:{},onBegin:_134,start:0,count:0});var _136=dijit.byId("risk_type");if(_131){if(_133===1){_132.fetch({onComplete:function(_137,_138){dojo.forEach(_137,function(item){dijit.byId("risk_type").set("value",item.name[0]);dijit.byId("risk_type").set("displayedValue",item.name[0]);dijit.byId("risk_type").set("disabled",true);});}});}}};d.mixin(m._config,{initReAuthParams:function(){var _139={productCode:"LN",subProductCode:"",transactionTypeCode:"01",entity:dj.byId("entity")?dj.byId("entity").get("value"):"",currency:dj.byId("ln_cur_code")?dj.byId("ln_cur_code").get("value"):"",amount:dj.byId("ln_amt")?m.trimAmount(dj.byId("ln_amt").get("value")):"",es_field1:"",es_field2:""};return _139;}});d.mixin(m,{bind:function(){if(d.isIE){window.isDrawdown=true;}else{window.isDrawdown=false;}m.connect("ln_amt","onBlur",_1c);m.connect("pricing_option","onChange",function(){dijit.byId("ln_cur_code").set("disabled",false);misys.toggleRequired("ln_cur_code",true);if(dijit.byId("ln_cur_code")&&dijit.byId("ln_cur_code").get("value")!==null){dijit.byId("ln_amt").set("disabled",true);misys.toggleRequired("ln_amt",false);dijit.byId("effective_date").set("disabled",true);misys.toggleRequired("effective_date",false);}if(dijit.byId("effective_date")&&dijit.byId("effective_date").get("value")!==null){dijit.byId("effective_date").set("value","");dijit.byId("effective_date").set("displayedValue","");}if(dijit.byId("repricing_date")&&dijit.byId("repricing_date").get("value")!==null){dijit.byId("repricing_date").set("value","");dijit.byId("repricing_date").set("displayedValue","");}});m.connect("pricing_option","onChange",_ec);misys.connect("pricing_option","onChange",_d1);m.connect("effective_date","onChange",function(){if(misys._config.isEffectiveDateFlag&&_c5()){_1d();}else{misys._config.isEffectiveDateFlag=true;}});m.connect("effective_date","onChange",_114);m.connect("repricing_date","onChange",function(){if(misys._config.isRepricingDateFlag&&_ce()){_40();}else{misys._config.isRepricingDateFlag=true;}if(dijit.byId("repricingdate_validation").value=="true"){if(_1c()){dijit.byId("ln_amt").set("state","");}}});m.connect("repricing_frequency","onChange",_114);m.connect("ln_maturity_date","onChange",_114);misys.connect("issuing_bank_abbv_name","onChange",misys.populateReferences);misys.setValidation("effective_date",_4);misys.setValidation("ln_maturity_date",_26);m.connect("repricing_frequency","onChange",_7f);if(dijit.byId("issuing_bank_abbv_name")){misys.connect("entity","onChange",function(){dijit.byId("issuing_bank_abbv_name").onChange();});}misys.connect("ln_cur_code","onChange",function(){misys.setCurrency(this,["ln_amt"]);var _13a=dijit.byId("ln_amt");var _13b=dijit.byId("ln_cur_code");_13a.focus();_13a.onBlur();if(_13b&&_13b.get("value")!==""){_13a.set("disabled",false);misys.toggleRequired("ln_amt",true);dijit.byId("effective_date").set("disabled",false);misys.toggleRequired("effective_date",true);if(dijit.byId("effective_date")&&dijit.byId("effective_date").get("value")!==null){dijit.byId("effective_date").set("value","");dijit.byId("effective_date").set("displayedValue","");}_1d();_11d();}else{if(_13b&&_13b.get("value")===""){_13a.set("disabled",true);misys.toggleRequired("ln_amt",false);dijit.byId("effective_date").set("disabled",true);misys.toggleRequired("effective_date",false);}}_2b();_f0(false);_fc();});if(dj.byId("screenMode").get("value")==="UNSIGNED"){_f0(true);_fc();}m.connect("cancelReauthentication","onClick",function(){dijit.byId("fx_conversion_rate").set("disabled",true);});var _13c=dj.byId("gridLoanInterestDetails");if(_13c){var _13d=_13c.store;_13d.comparatorMap={};_13d.comparatorMap["interest_cycle"]=misys.grid.sortAmountColumn;_13d.comparatorMap["start_date"]=misys.grid.sortDateColumn;_13d.comparatorMap["end_date"]=misys.grid.sortDateColumn;_13d.comparatorMap["adjusted_due_date"]=misys.grid.sortDateColumn;_13d.comparatorMap["projected_cycleDue_amt"]=misys.grid.sortAmountColumn;_13d.comparatorMap["accrued_toDate_amt"]=misys.grid.sortAmountColumn;_13d.comparatorMap["paid_toDate_amt"]=misys.grid.sortAmountColumn;_13d.comparatorMap["billed_interest_amt"]=misys.grid.sortAmountColumn;}},toggleRemittanceInst:function(){var _13e=d.byId("actionDown");var _13f=d.byId("actionUp");var _140=d.byId("remittanceInstContainer");if(d.style("remittanceInstContainer","display")==="none"){m.animate("wipeIn",_140);d.style("actionDown","display","none");d.style("actionUp","display","block");d.style("actionUp","cursor","pointer");dijit.byId("gridRemittanceInstruction")._refresh();}else{m.animate("wipeOut",_140);d.style("actionUp","display","none");d.style("actionDown","display","block");d.style("actionDown","cursor","pointer");}},toggleLoanInterestDetails:function(){var _141=d.byId("actionDown");var _142=d.byId("actionUp");var _143=d.byId("loanInterestDetailsContainer");if(d.style("loanInterestDetailsContainer","display")==="none"){m.animate("wipeIn",_143);dj.byId("gridLoanInterestDetails").resize();d.style("actionDown","display","none");d.style("actionUp","display","block");d.style("actionUp","cursor","pointer");}else{m.animate("wipeOut",_143);d.style("actionUp","display","none");d.style("actionDown","display","block");d.style("actionDown","cursor","pointer");}},onFormLoad:function(){if(misys._config.displayMode==="view"){_2b();}if(dj.byId("effective_date")&&misys._config.displayMode!=="edit"){_7a();}_120();if(misys._config.displayMode==="edit"){_1d();}misys._config.warningMessages=[];misys.setCurrency(dijit.byId("ln_cur_code"),["ln_amt"]);var _144=dijit.byId("issuing_bank_abbv_name");if(_144){_144.onChange();}var _145=dijit.byId("issuing_bank_customer_reference");if(_145){_145.onChange();}if(dj.byId("repricing_frequency_view")&&dj.byId("repricing_frequency")){_d1();dj.byId("repricing_frequency").set("value",dj.byId("repricing_frequency_view").get("value"),false);var _146=dj.byId("repricing_date");var _147=dj.byId("effective_date");var _148=dj.byId("repricing_frequency");if(_147.get("value")&&_148.get("value")&&_146.get("value")){dj.byId("repricing_date").onChange();}}if(dijit.byId("operationValue")&&dijit.byId("operationValue").get("value")==="NEW_DRAWDOWN"){_128(true);}_130(true);_ec(true);if(!dijit.byId("ln_cur_code").get("value")){dijit.byId("ln_amt").set("disabled",true);misys.toggleRequired("ln_amt",false);}if(!dijit.byId("pricing_option").get("value")){dijit.byId("ln_cur_code").set("disabled",true);misys.toggleRequired("ln_cur_code",false);dijit.byId("ln_amt").set("disabled",true);misys.toggleRequired("ln_amt",false);dj.byId("effective_date").set("disabled",true);misys.toggleRequired("effective_date",false);dijit.byId("repricing_frequency").set("disabled",true);misys.toggleRequired("repricing_frequency",false);dijit.byId("repricing_date").set("disabled",true);misys.toggleRequired("repricing_date",false);dijit.byId("ln_cur_code").set("disabled",true);misys.toggleRequired("ln_cur_code",false);dijit.byId("ln_amt").set("disabled",true);misys.toggleRequired("ln_amt",false);dijit.byId("ln_maturity_date").set("disabled",true);misys.toggleRequired("ln_maturity_date",false);}if(dijit.byId("operationValue")&&dijit.byId("operationValue")!==""&&dijit.byId("operationValue").get("value")==="NEW_DRAWDOWN"){_f0(true);}else{_f0(false);}if(dijit.byId("ln_cur_code").get("value")!==""){_fc();}if(dijit.byId("remittance_flag").get("value")==="mandatory"){dojo.style(d.byId("remittanceInstContainer"),"display","block");dijit.byId("gridRemittanceInstruction")._refresh();}_2b();if(!dj.byId("repricing_frequency").get("value")){dj.byId("repricing_date").set("disabled",true);m.toggleRequired("repricing_date",false);}_1c();try{var _149="#borrower_address_line_2";var _14a="#borrower_dom";var _14b="aria-label";if(dojo.query(_149)&&dojo.query(_149)[0]!==undefined){var _14c=dojo.query(_149)[0];dojo.attr(_14c,_14b,misys.getLocalization("ADDRESS_LINE_2_LABEL"));}if(dojo.query(_14a)&&dojo.query(_14a)[0]!==undefined){var _14d=dojo.query(_14a)[0];dojo.attr(_14d,_14b,misys.getLocalization("ADDRESS_LINE_3_LABEL"));}if(dojo.query("#ln_amt")&&dojo.query("#ln_amt")[0]!==undefined){var _14e=dojo.query("#ln_amt")[0];dojo.attr(_14e,_14b,misys.getLocalization("LOAN_AMOUNT_AMOUNT_FIELD_LABEL"));}}catch(exc){}},beforeSaveValidations:function(){var _14f=dj.byId("entity");if(_14f&&_14f.get("value")===""){return false;}else{return true;}},toggleLegalTextDetails:function(){var _150=d.byId("actionDown");var _151=d.byId("actionUp");var _152=d.byId("LegalTextContainer");if(d.style("LegalTextContainer","display")==="none"){m.animate("wipeIn",_152);d.style("actionDown","display","none");d.style("actionUp","display","block");d.style("actionUp","cursor","pointer");}else{m.animate("wipeOut",_152);d.style("actionUp","display","none");d.style("actionDown","display","block");d.style("actionDown","cursor","pointer");}},onCancelNavigation:function(){var _153=misys._config.homeUrl;var _154=["/screen/LoanScreen?","operation=LIST_DEALS"];_153=misys.getServletURL(_154.join(""));return _153;},setCustomConfirmMessage:function(){var _155=null,_156=null;if(dj.byId("screenMode").get("value")==="UNSIGNED"){_155=dj.byId("ln_cur_code_unsigned")&&dj.byId("ln_cur_code_unsigned").get("value")!=null?dj.byId("ln_cur_code_unsigned").get("value"):"";_156=dj.byId("ln_amt_unsigned")&&dj.byId("ln_amt_unsigned").get("value")!=null?dj.byId("ln_amt_unsigned").get("value"):"";}else{_155=dj.byId("ln_cur_code")&&dj.byId("ln_cur_code").get("value")!=null?dj.byId("ln_cur_code").get("value"):"";_156=(dj.byId("ln_amt")&&dj.byId("ln_amt").get("value")!=null&&!isNaN(dj.byId("ln_amt").get("value")))?dj.byId("ln_amt").get("value"):"";var _157=d.cldr.monetary.getData(_155);_156=_156!==""?d.currency.format((Math.floor((parseFloat(_156)*100).toFixed(2))/100),{round:_157.round,places:_157.places}):"";}m._config.globalSubmitConfirmationMsg=m.getLocalization("submitTransactionConfirmationForLoan",["Drawdown",_155,_156]);},beforeSubmitValidations:function(){var _158=false;if(_1e()){_158=_1a();}if(!_158){m._config.legalTextEnabled=false;return false;}var _159=m.isLegalTextAcceptedForAuthorizer();if(_158&&!(_159)){m._config.legalTextEnabled=true;return false;}else{if(_158&&(_159)){return true;}}return false;}});m._config=m._config||{};d.mixin(m._config,{xmlTransform:function(xml){var _15a=m._config.xmlTagName,_15b=_15a?["<",_15a,">"]:[];if(xml.indexOf(_15a)!=-1){var dom=dojox.xml.DomParser.parse(xml);var _15c=xml.substring(_15a.length+2,(xml.length-_15a.length-3));var _15d=dijit.byId("gridRemittanceInstruction");if(_15d&&_15d.selection&&_15d.selection.getSelected()&&_15d.selection.getSelected()[0]&&_15d.selection.getSelected()[0].description&&_15d.selection.getSelected()[0].description[0]){_15c=_15c.concat("<rem_inst_description>");_15c=_15c.concat(_15d.selection.getSelected()[0].description[0]);_15c=_15c.concat("</rem_inst_description>");_15c=_15c.concat("<rem_inst_location_code>");_15c=_15c.concat(_15d.selection.getSelected()[0].locationCode[0]);_15c=_15c.concat("</rem_inst_location_code>");_15c=_15c.concat("<rem_inst_servicing_group_alias>");_15c=_15c.concat(_15d.selection.getSelected()[0].servicingGroupAlias[0]);_15c=_15c.concat("</rem_inst_servicing_group_alias>");_15c=_15c.concat("<rem_inst_account_no>");_15c=_15c.concat(_15d.selection.getSelected()[0].accountNo[0]);_15c=_15c.concat("</rem_inst_account_no>");}else{_15c=_15c.concat("<rem_inst_description>");_15c=_15c.concat("</rem_inst_description>");_15c=_15c.concat("<rem_inst_location_code>");_15c=_15c.concat("</rem_inst_location_code>");_15c=_15c.concat("<rem_inst_servicing_group_alias>");_15c=_15c.concat("</rem_inst_servicing_group_alias>");_15c=_15c.concat("<rem_inst_account_no>");_15c=_15c.concat("</rem_inst_account_no>");}if(dijit.byId("legalDialog")&&dijit.byId("accept_legal_text")&&dijit.byId("accept_legal_text").get("checked")){_15c=_15c.concat("<accept_legal_text>");_15c=_15c.concat("Y");_15c=_15c.concat("</accept_legal_text>");}else{if(dijit.byId("legalDialog")&&dijit.byId("accept_legal_text")&&!(dijit.byId("accept_legal_text").get("checked"))){_15c=_15c.concat("<accept_legal_text>");_15c=_15c.concat("N");_15c=_15c.concat("</accept_legal_text>");}}_15b.push(_15c);if(_15a){_15b.push("</",_15a,">");}return _15b.join("");}else{return xml;}}});})(dojo,dijit,misys);dojo.require("misys.client.binding.loan.create_ln_client");}