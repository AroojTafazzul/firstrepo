/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.core.beneficiary_advice_common"]){dojo._hasResource["misys.binding.core.beneficiary_advice_common"]=true;dojo.provide("misys.binding.core.beneficiary_advice_common");dojo.require("misys.grid.GridMultipleItems");dojo.require("dojo.parser");dojo.require("dijit.form.Button");dojo.require("dijit.form.ValidationTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.DateTextBox");dojo.require("misys.binding.core.beneficiary_advice_templates");(function(d,dj,m){function _1(_2,_3){if(_2){m.animate("wipeIn",_3);}else{m.animate("wipeOut",_3);}};function _4(){var _5=dj.byId("bene_adv_postal_code"),_6=dj.byId("bene_adv_country"),_7="",_8=-1,_9=0,_a=2000,_b=function(){dj.hideTooltip(_6.domNode);};if(_5&&_6){if(_6.get("value")===""){if(this.get("name")==="bene_adv_postal_code"){_5.set("value","");_7=m.getLocalization("selectBeneficiaryCountry");dj.hideTooltip(_6.domNode);dj.showTooltip(_7,_6.domNode,0);setTimeout(_b,_a);}else{_5.set("value","");_5.set("maxLength",0);}}else{if(misys._config.bene_advice.postal_codes[_6.get("value")]){_9=misys._config.bene_advice.postal_codes[_6.get("value")];_5.set("maxLength",_9);if(m._config.currentBeneficiaryCountry!==_6.get("value")){_5.set("value","");m._config.currentBeneficiaryCountry=_6.get("value");}}else{if(this.get("name")==="bene_adv_country"){if(m._config.currentBeneficiaryCountry!==_6.get("value")){_5.set("value","");m._config.currentBeneficiaryCountry=_6.get("value");}}_5.set("maxLength",15);}}}};function _c(){_1((dj.byId("bene_adv_flag")&&dj.byId("bene_adv_flag").checked),"beneAdvDiv");m.toggleFields((dj.byId("bene_adv_email_flag")&&dj.byId("bene_adv_email_flag").checked),["bene_adv_email_21","bene_adv_email_22"],["bene_adv_email_1"]);m.toggleFields((dj.byId("bene_adv_phone_flag")&&dj.byId("bene_adv_phone_flag").checked),null,["bene_adv_phone"]);m.toggleFields((dj.byId("bene_adv_fax_flag")&&dj.byId("bene_adv_fax_flag").checked),null,["bene_adv_fax"]);m.toggleFields((dj.byId("bene_adv_ivr_flag")&&dj.byId("bene_adv_ivr_flag").checked),null,["bene_adv_ivr"]);_1((dj.byId("bene_adv_mail_flag")&&dj.byId("bene_adv_mail_flag").checked),"mailAdditionalDetails");m.toggleFields((dj.byId("bene_adv_mail_flag")&&dj.byId("bene_adv_mail_flag").checked),["bene_adv_mailing_name_add_2","bene_adv_mailing_name_add_3","bene_adv_mailing_name_add_4","bene_adv_mailing_name_add_5","bene_adv_mailing_name_add_6","bene_adv_postal_code","bene_adv_country"],["bene_adv_mailing_name_add_1"]);};function _d(_e,_f,_10){for(var k=0;k<_10.length;k++){if(dj.byId(_10[k])){dj.byId(_10[k]).set("checked",false);}}for(var i=0;i<_f.length;i++){if(dj.byId(_f[i])){dj.byId(_f[i]).set("value","");}}for(var j=0;j<_e.length;j++){m.animate("fadeOut",_e[j]);}};function _11(){var _12=_13();var Y="Y";var _14=[];var _15=[];var _16=[];m._config.beneAdvDeliveryModeSingle=false;m._config.beneAdvTableMaxRows=_12.table_max_rows||0;if(_12.multi_selection!==Y){m._config.beneAdvDeliveryModeSingle=true;}if(_12){if(_12.bene_adv_enabled_for_product===Y){if(_12.email_1!==Y){if(_12.email_2!==Y){_14.push("beneAdvEmailDiv");_16.push("bene_adv_email_flag");}else{_14.push("beneAdvEmailDiv1");_15.push("bene_adv_email_1");}}if(_12.email_2!==Y){_14.push("beneAdvEmailDiv2");_15.push("bene_adv_email_21");_15.push("bene_adv_email_22");}if(_12.phone!==Y){_14.push("beneAdvPhoneDiv");_16.push("bene_adv_phone_flag");}if(_12.fax!==Y){_14.push("beneAdvFaxDiv");_16.push("bene_adv_fax_flag");}if(_12.ivr!==Y){_14.push("beneAdvIVRDiv");_16.push("bene_adv_ivr_flag");}if(_12.print!==Y){_14.push("beneAdvPrintDiv");_16.push("bene_adv_print_flag");}if(_12.mail!==Y){_14.push("beneAdvMailDiv");_14.push("mailAdditionalDetails");_16.push("bene_adv_mail_flag");}if(dj.byId("bene_adv_free_format_msg")){dj.byId("bene_adv_free_format_msg").set("maxSize",_12.free_format_msg_length);dj.byId("bene_adv_free_format_msg").set("cols",_12.free_format_msg_width);}_d(_14,_15,_16);}else{m.animate("fadeOut","beneficiaryAdvicesTransactionContainer");m._config.beneAdvNotConfigured=true;dj.byId("bene_adv_flag").set("checked",false);}}else{console.error(m.getLocalization("technicalErrorWhileConfiguringBeneficiaryAdvices"));m.animate("fadeOut","beneficiaryAdvicesTransactionContainer");m._config.beneAdvNotConfigured=true;dj.byId("bene_adv_flag").set("checked",false);}};function _13(){var _17=m._config.bene_advice.beneAdvSubProductCodeWidgetId;var _18;if(_17!==null&&_17!==""){if(dj.byId(_17)){_18=misys._config.bene_advice.parameterConfig[dj.byId(_17).get("value")];}else{console.error(m.getLocalization("technicalErrorWhileConfiguringBeneficiaryAdvices"));m.animate("fadeOut","beneficiaryAdvicesTransactionContainer");m._config.beneAdvNotConfigured=true;dj.byId("bene_adv_flag").set("checked",false);}}else{_18=misys._config.bene_advice.parameterConfig["*"];}return _18;};function _19(){var _1a=["bene_adv_beneficiary_id","bene_adv_payer_name_1","bene_adv_payer_name_2","bene_adv_payer_ref_no","bene_adv_free_format_msg","bene_adv_table_format"];var _1b=["bene_adv_email_flag","bene_adv_phone_flag","bene_adv_fax_flag","bene_adv_ivr_flag","bene_adv_mail_flag"];_d([],_1a,_1b);};function _1c(_1d,_1e){var _1f=["bene_adv_email_flag","bene_adv_phone_flag","bene_adv_fax_flag","bene_adv_ivr_flag","bene_adv_mail_flag"];d.forEach(_1f,function(_20,_21){if(_1e!==_20){if(_1d){if(dijit.byId(_20)){dijit.byId(_20).set("readOnly",true);}}else{if(dijit.byId(_20)){dijit.byId(_20).set("readOnly",false);}}}});};d.mixin(m,{beneAdvBinding:function(){m.setValidation("bene_adv_email_1",m.validateEmailAddr);m.setValidation("bene_adv_email_21",m.validateEmailAddr);m.setValidation("bene_adv_email_22",m.validateEmailAddr);m.setValidation("bene_adv_country",m.validateCountry);m.setValidation("bene_adv_phone",m.validatePhoneOrFax);m.setValidation("bene_adv_fax",m.validatePhoneOrFax);m.setValidation("bene_adv_ivr",m.validatePhoneOrFax);m.connect("bene_adv_postal_code","onKeyPress",_4);m.connect("bene_adv_country","onBlur",_4);m.connect("bene_adv_flag","onChange",function(){var _22=function(){m._config.beneAdvNotConfigured=m._config.beneAdvNotConfigured||false;if(m._config.beneAdvNotConfigured===false){if(!dj.byId("bene_adv_flag").checked){m.dialog.show("CONFIRMATION",m.getLocalization("beneAdvClearAll"),"",null,null,"",function(){_1(false,"beneAdvDiv");m._config.beneAdvFlagUnchecked=true;_19();},function(){dj.byId("bene_adv_flag").set("checked",true);});}else{m._config.templateSelectionBuilt=m._config.templateSelectionBuilt||false;if(m._config.templateSelectionBuilt===false){m.buildTemplateSelection();}dj.byId("bene_adv_beneficiary_id").set("value",dj.byId("bene_adv_beneficiary_id_no_send").get("value"));_1(true,"beneAdvDiv");}}};setTimeout(_22,50);});m.connect("bene_adv_email_flag","onChange",function(){m.toggleFields((this.checked),["bene_adv_email_21","bene_adv_email_22"],["bene_adv_email_1"]);if(this.checked){dj.byId("bene_adv_email_1").set("value",dj.byId("bene_adv_email_no_send").get("value"));}if(m._config.beneAdvDeliveryModeSingle===true){_1c((this.checked),"bene_adv_email_flag");}});m.connect("bene_adv_phone_flag","onChange",function(){m.toggleFields((this.checked),null,["bene_adv_phone"]);if(this.checked){dj.byId("bene_adv_phone").set("value",dj.byId("bene_adv_phone_no_send").get("value"));}if(m._config.beneAdvDeliveryModeSingle===true){_1c((this.checked),"bene_adv_phone_flag");}});m.connect("bene_adv_fax_flag","onChange",function(){m.toggleFields((this.checked),null,["bene_adv_fax"]);if(this.checked){dj.byId("bene_adv_fax").set("value",dj.byId("bene_adv_fax_no_send").get("value"));}if(m._config.beneAdvDeliveryModeSingle===true){_1c((this.checked),"bene_adv_fax_flag");}});m.connect("bene_adv_ivr_flag","onChange",function(){m.toggleFields((this.checked),null,["bene_adv_ivr"]);if(this.checked){dj.byId("bene_adv_ivr").set("value",dj.byId("bene_adv_ivr_no_send").get("value"));}if(m._config.beneAdvDeliveryModeSingle===true){_1c((this.checked),"bene_adv_ivr_flag");}});m.connect("bene_adv_mail_flag","onChange",function(){_1((this.checked),"mailAdditionalDetails");m.toggleFields((this.checked),["bene_adv_mailing_name_add_2","bene_adv_mailing_name_add_3","bene_adv_mailing_name_add_4","bene_adv_mailing_name_add_5","bene_adv_mailing_name_add_6","bene_adv_postal_code","bene_adv_country"],["bene_adv_mailing_name_add_1"]);if(this.checked){dj.byId("bene_adv_mailing_name_add_1").set("value",dj.byId("bene_adv_mailing_name_add_1_no_send").get("value"));dj.byId("bene_adv_mailing_name_add_2").set("value",dj.byId("bene_adv_mailing_name_add_2_no_send").get("value"));dj.byId("bene_adv_mailing_name_add_3").set("value",dj.byId("bene_adv_mailing_name_add_3_no_send").get("value"));dj.byId("bene_adv_mailing_name_add_4").set("value",dj.byId("bene_adv_mailing_name_add_4_no_send").get("value"));dj.byId("bene_adv_mailing_name_add_5").set("value",dj.byId("bene_adv_mailing_name_add_5_no_send").get("value"));dj.byId("bene_adv_mailing_name_add_6").set("value",dj.byId("bene_adv_mailing_name_add_6_no_send").get("value"));dj.byId("bene_adv_postal_code").set("value",dj.byId("bene_adv_postal_code_no_send").get("value"));dj.byId("bene_adv_country").set("value",dj.byId("bene_adv_country_no_send").get("value"));}if(m._config.beneAdvDeliveryModeSingle===true){_1c((this.checked),"bene_adv_mail_flag");}});m.connect("bene_adv_table_format","onChange",function(){m._config.beneAdvFlagUnchecked=m._config.beneAdvFlagUnchecked||false;if(d.style("beneAdvTableDivContainer","display")!=="none"){m._config.beneAdvTemplateOld=m._config.beneAdvTemplateOld||false;if(!m._config.beneAdvPreviousTemplateSelection){m._config.beneAdvPreviousTemplateSelection=dj.byId("bene_adv_table_format").get("value");}if(m._config.beneAdvTemplateOld===false){if(m._config.beneAdvFlagUnchecked===false){m.dialog.show("CONFIRMATION",m.getLocalization("beneAdvChangingTemplateFormat"),"",null,null,"",function(){m._config.beneAdvPreviousTemplateSelection=dj.byId("bene_adv_table_format").get("value");m.buildGridMultipleItem();},function(){m._config.beneAdvTemplateOld=true;dj.byId("bene_adv_table_format").set("value",m._config.beneAdvPreviousTemplateSelection);});}else{m._config.beneAdvFlagUnchecked=false;m._config.beneAdvPreviousTemplateSelection=null;m.buildGridMultipleItem();}}else{m._config.beneAdvTemplateOld=false;}}else{if(!m._config.beneAdvPreviousTemplateSelection){m._config.beneAdvPreviousTemplateSelection=dj.byId("bene_adv_table_format").get("value");}m._config.beneAdvFlagUnchecked=false;m.buildGridMultipleItem();}});},beneAdvFormLoad:function(){if(dj.byId("bene_adv_flag")){_c();if(dj.byId("applicant_act_no")&&!(dj.byId("applicant_act_no").get("value")==="")){m.handleParametersConfigurations();m.buildTemplateSelection();if(m._config.bene_advice&&m._config.bene_advice.beneAdvTableFormat&&m._config.bene_advice.beneAdvTableFormat!==""){var _23=m._config.bene_advice.beneAdvTemplates[m._config.bene_advice.beneAdvTableFormat].modificationTime;var _24=misys._config.bene_advice.beneAdvTableFormatTime;if(_23===_24){dj.byId("bene_adv_table_format").set("value",m._config.bene_advice.beneAdvTableFormat);var _25=function(){if(dj.byId("beneAdvTable")){dj.byId("beneAdvTable").dataArray=m._config.bene_advice.beneAdvTableData;dj.byId("beneAdvTable")._started=false;dj.byId("beneAdvTable").startup();dj.byId("beneAdvTable").renderAll();}};setTimeout(_25,1000);}else{m.dialog.show("ERROR",m.getLocalization("beneAdvTemplateModifiedAlert"));}}}}},handleParametersConfigurations:function(){if(dj.byId("bene_adv_flag")){_11();}},beneAdvBeforeSubmitValidation:function(){if(dj.byId("bene_adv_flag")&&dj.byId("bene_adv_flag").get("checked")===true&&m._config.displayMode==="edit"){var _26=["bene_adv_email_flag","bene_adv_phone_flag","bene_adv_fax_flag","bene_adv_ivr_flag","bene_adv_mail_flag"];var _27=false;d.forEach(_26,function(_28){if(dj.byId(_28)&&dj.byId(_28).get("checked")===true){_27=true;}});if(!_27){m._config.onSubmitErrorMsg=m.getLocalization("beneAdvAtleastOneDeliveryModeRequired");}return _27;}else{return true;}},handleBeneAdvViewMode:function(){m.buildGridMultipleItem("view");var _29=function(){if(dj.byId("beneAdvTable")){dj.byId("beneAdvTable").dataArray=m._config.bene_advice.beneAdvTableData;dj.byId("beneAdvTable")._started=false;dj.byId("beneAdvTable").overrideDisplaymode="view";dj.byId("beneAdvTable").startup();dj.byId("beneAdvTable").renderAll();dj.byId("bene-adv-table-grid").resize();m.connect("beneAdvTableDivContainer","onClick",function(){if(dj.byId("bene-adv-table-grid")){dj.byId("bene-adv-table-grid").resize();}});}};setTimeout(_29,1000);},clearBeneficiaryAdviceFieldsForDefaultingFromBeneMaster:function(){var _2a=["bene_adv_beneficiary_id","bene_adv_email_1","bene_adv_phone","bene_adv_fax","bene_adv_ivr"];var _2b=["bene_adv_email_flag","bene_adv_mail_flag","bene_adv_phone_flag","bene_adv_fax_flag","bene_adv_ivr_flag"];_d([],_2a,_2b);}});})(dojo,dijit,misys);dojo.require("misys.client.binding.core.beneficiary_advice_common_client");}