/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.core.bk_file_upload"]){dojo._hasResource["misys.binding.core.bk_file_upload"]=true;dojo.provide("misys.binding.core.bk_file_upload");dojo.require("dijit.form.FilteringSelect");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.ValidationTextBox");dojo.require("dojo.data.ItemFileWriteStore");dojo.require("misys.binding.cash.ft_common");(function(d,dj,m){function _1(){var _2=dj.byId("upload_file_type").item;if(_2.formatName){dj.byId("format_name").set("value",_2.formatName);}if(_2.mapCode){dj.byId("map_code").set("value",_2.mapCode);}if(_2.formatType){dj.byId("format_type").set("value",_2.formatType);}if(_2.ammendable){dj.byId("amendable").set("value",_2.ammendable);}if(_2.fileEncrypted){dj.byId("file_encrypted").set("value",_2.fileEncrypted);}if(_2.overrideDuplicateReference){dj.byId("override_duplicate_reference").set("value",_2.overrideDuplicateReference);}if(_2.productGroup){dj.byId("product_group").set("value",_2.productGroup);}if(_2.productType){dj.byId("product_type").set("value",_2.productType);}if(_2.payRollType){dj.byId("payroll_type").set("value",_2.payRollType);}if(_2.fileTypePermissoin){dj.byId("file_type_permission").set("value",_2.fileTypePermissoin);}};function _3(){var _4=dj.byId("attIds");var _5=false;var _6=0;if(_4){var _7=[dj.byId("attachment-file"),dj.byId("attachment-fileOTHER")];d.forEach(_7,function(_8){if(_8&&_8.grid){var _9=_8.grid.store._arrayOfAllItems;d.forEach(_9,function(_a,i){if(_a!==null){_5=true;_6++;}});}});}if(_5==false){m._config.onSubmitErrorMsg=m.getLocalization("mandatoryMinimumFileUploadTypeError");}if(_6>1){m._config.onSubmitErrorMsg=m.getLocalization("mandatoryMaximumFileUploadTypeError");_5=false;}return _5;};function _b(){var _c=dj.byId("customer_bank").get("value");if(dj.byId("issuing_bank_abbv_name")){dj.byId("issuing_bank_abbv_name").set("value",_c);}if(dj.byId("issuing_bank_name")){dj.byId("issuing_bank_name").set("value",misys._config.customerBankDetails[_c][0].value);}if(misys&&misys._config&&misys._config.businessDateForBank&&misys._config.businessDateForBank[_c]&&misys._config.businessDateForBank[_c][0]&&misys._config.businessDateForBank[_c][0].value!==""){var _d=misys._config.businessDateForBank[_c][0].value;var _e=_d.substring(0,4);var _f=_d.substring(5,7);var _10=_d.substring(8,10);_d=_10+"/"+_f+"/"+_e;dj.byId("appl_date").set("value",_d);if(document.getElementById("appl_date_view_row")){document.getElementById("appl_date_view_row").childNodes[1].innerHTML=_d;}}};function _11(){if(dj.byId("applicant_reference")&&dj.byId("issuing_bank_abbv_name")&&dj.byId("entity")&&dj.byId("entity").get("value")!==""){var key=dj.byId("issuing_bank_abbv_name").get("value")+"_"+dj.byId("entity").get("value");if(m._config.customerReferences[key][1]){dj.byId("applicant_reference").set("value",m._config.customerReferences[key][1]);}}};function _12(){var _13,_14;if(dj.byId("entity")){_13=dj.byId("entity").get("value");}else{if(dj.byId("entity_hidden")){_13=dj.byId("entity_hidden").get("value");if(_13===""){_13="*";}}else{_13="*";}}if(dj.byId("customer_bank")){_14=dj.byId("customer_bank").get("value");}else{if(dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""){_14=dj.byId("issuing_bank_abbv_name").get("value");}}if(_13!==""&&_14!==""){dj.byId("bk_type").store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:m._config.bkTypeCollection[_14][_13]}});}};function _15(){var _16,_17;if(dj.byId("entity")){_16=dj.byId("entity").get("value");}else{if(dj.byId("entity_hidden")){_16=dj.byId("entity_hidden").get("value");if(_16===""){_16="*";}}else{_16="*";}}if(dj.byId("customer_bank")){_17=dj.byId("customer_bank").get("value");}else{if(dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""){_17=dj.byId("issuing_bank_abbv_name").get("value");}}if(dj.byId("payroll")&&_16!==""&&_17!==""){dj.byId("payroll").set("value","");dj.byId("payroll").store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:m._config.payrollTypeCollection[_17][_16]}});}};function _18(){var _19=dj.byId("bk_type").get("value");var _1a=dj.byId("entity")?dj.byId("entity").get("value"):"*";var _1b;if(dj.byId("customer_bank")){_1b=dj.byId("customer_bank").get("value");}else{if(dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""){_1b=dj.byId("issuing_bank_abbv_name").get("value");}}dj.byId("upload_file_type").set("value","");if(_19!==""&&_19!=="PAYRL"){dj.byId("upload_file_type").store=new dojo.data.ItemFileReadStore({data:{identifier:"value",items:m._config.childSubProductsCollection[_1b][_19][_1a]}});}else{if(_19!==""&&_1b!==""){var _1c=dj.byId("payroll").get("value");if(_1c!==""){dj.byId("upload_file_type").store=new dojo.data.ItemFileReadStore({data:{identifier:"value",items:m._config.childSubProductsCollectionPayroll[_1b][_19][_1c][_1a]}});}else{_15();}}}};function _1d(){if(dj.byId("entity")){entity=dj.byId("entity").get("value");}else{if(dj.byId("entity_hidden")){entity=dj.byId("entity_hidden").get("value");if(entity===""){entity="*";}}else{entity="*";}}var _1e;if(dj.byId("customer_bank")){_1e=dj.byId("customer_bank").get("value");}else{if(dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""){_1e=dj.byId("issuing_bank_abbv_name").get("value");}}if(entity!=""&&(m._config.childSubProductsCollection[_1e]||m._config.childSubProductsCollectionPayroll[_1e])){dj.byId("upload_file_type").set("value","");var _1f=new dojo.data.ItemFileWriteStore({data:{identifier:"value",items:[]}});var _20=[];if(m._config.childSubProductsCollection[_1e]&&m._config.childSubProductsCollection[_1e]["PAYMT"]&&m._config.childSubProductsCollection[_1e]["PAYMT"][entity]!==undefined){for(var i=0;i<m._config.childSubProductsCollection[_1e]["PAYMT"][entity].length;i++){_20.push(m._config.childSubProductsCollection[_1e]["PAYMT"][entity][i]);}}if(m._config.childSubProductsCollection[_1e]&&m._config.childSubProductsCollection[_1e]["COLLE"]&&m._config.childSubProductsCollection[_1e]["COLLE"][entity]!==undefined){for(var z=0;z<m._config.childSubProductsCollection[_1e]["COLLE"][entity].length;z++){_20.push(m._config.childSubProductsCollection[_1e]["COLLE"][entity][z]);}}if(m._config.childSubProductsCollectionPayroll[_1e]&&m._config.childSubProductsCollectionPayroll[_1e]["PAYRL"]){if(m._config.childSubProductsCollectionPayroll[_1e]["PAYRL"]["EMPL"]&&m._config.childSubProductsCollectionPayroll[_1e]["PAYRL"]["EMPL"][entity]!==undefined){for(var j=0;j<m._config.childSubProductsCollectionPayroll[_1e]["PAYRL"]["EMPL"][entity].length;j++){_20.push(m._config.childSubProductsCollectionPayroll[_1e]["PAYRL"]["EMPL"][entity][j]);}}if(m._config.childSubProductsCollectionPayroll[_1e]["PAYRL"]["EXEC"]&&m._config.childSubProductsCollectionPayroll[_1e]["PAYRL"]["EXEC"][entity]!==undefined){for(var k=0;k<m._config.childSubProductsCollectionPayroll[_1e]["PAYRL"]["EXEC"][entity].length;k++){_20.push(m._config.childSubProductsCollectionPayroll[_1e]["PAYRL"]["EXEC"][entity][k]);}}}dj.byId("upload_file_type").set("value","");dj.byId("upload_file_type").store=new dojo.data.ItemFileReadStore({data:{identifier:"value",items:_20}});}};function _21(obj){dj.byId("upload_description").set("value","");dj.byId("reference").set("value","");if(misys._config.isMultiBank&&obj.id!=="customer_bank"){dj.byId("customer_bank").set("value","");}if(dj.byId("format").get("value")==="STANDARD"){dj.byId("bk_type").set("value","");dj.byId("payroll").set("value","");}dj.byId("upload_file_type").set("value","");};d.mixin(m,{onFormLoad:function(){m.animate("wipeOut",d.byId("payrolltype"));if(!misys._config.isMultiBank){if(dj.byId("format").get("value")==="STANDARD"){_12();_15();d.style("payrolltype","display","none");}else{if(dj.byId("format").get("value")==="FLEXI"){_1d();}}}if(misys._config.isMultiBank){m.populateCustomerBanks(true);var _22=dj.byId("customer_bank");var _23=dj.byId("customer_bank_hidden");var _24=dj.byId("entity");if(_22&&_23){_22.set("value",_23.get("value"));}if(dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""){_22.set("value",dj.byId("issuing_bank_abbv_name").get("value"));_23.set("value",dj.byId("issuing_bank_abbv_name").get("value"));}if(_24&&_24.get("value")===""&&_22){_22.set("disabled",true);_22.set("required",false);}}},bind:function(){m.connect("upload_file_type","onChange",_1);m.connect("entity","onChange",function(){_21(this);var _25;if(misys._config.isMultiBank){_25=dj.byId("customer_bank");if(misys._config.isMultiBank&&dj.byId("customer_bank")){_25.set("value","");m.populateCustomerBanks();}}else{if(dj.byId("format").get("value")==="STANDARD"){_12();_15();d.style("payrolltype","display","none");}else{if(dj.byId("format").get("value")==="FLEXI"){_1d();}}}});m.connect("customer_bank","onChange",function(){_21(this);_b();m.animate("wipeOut",d.byId("payrolltype"));if(dj.byId("format").get("value")==="STANDARD"){_12();}else{if(dj.byId("format").get("value")==="FLEXI"){_1d();}}dj.byId("customer_bank_hidden").set("value",dj.byId("customer_bank").get("value"));var _26=dj.byId("issuing_bank_abbv_name");var _27=dj.byId("issuing_bank_name");_26.set("value",dj.byId("customer_bank").get("value"));if(misys._config.customerBankDetails&&_27.get("value")===""){_27.set("value",misys._config.customerBankDetails[dijit.byId("customer_bank").get("value")][0].value);}});m.connect("payroll","onChange",function(){_18();});m.connect("bk_type","onChange",function(){if(this.get("value")==="PAYMT"){m.animate("wipeOut",d.byId("payrolltype"));}else{if(this.get("value")==="PAYRL"){m.animate("wipeIn",d.byId("payrolltype"));}}_18();});},beforeSubmitValidations:function(){return _3();}});})(dojo,dijit,misys);dojo.require("misys.client.binding.core.bk_file_upload_client");}