/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.core.beneficiary_advice_templates"]){dojo._hasResource["misys.binding.core.beneficiary_advice_templates"]=true;dojo.provide("misys.binding.core.beneficiary_advice_templates");(function(d,dj,m){function _1(_2,_3,_4,_5,_6){dojo.require("misys.grid.GridMultipleItems");dojo.declare("misys.system.widget.BeneficiaryAdvicesGrid",[misys.grid.GridMultipleItems],{data:{identifier:"store_id",label:"store_id",items:[]},overrideDisplaymode:_5,templatePath:null,templateString:dojo.byId("beneAdvTable-template").innerHTML,dialogId:"beneAdvTable-dialog-template",xmlTagName:"bene_advices",xmlSubTagName:"bene_advice",headers:_4,gridColumns:_3,dataArray:null,templateJSON:_2,templateDesc:_6,propertiesMap:_7(_2,_3),layout:_8(_2),buildRendering:function(){this.inherited(arguments);},startup:function(){this.dataList=this.dataArray||[];this.templateString=dojo.byId("beneAdvTable-template").innerHTML;this.inherited(arguments);},_retrieveItemFields:function(){var _9=this.dialog.getChildren();var _a={};for(var i=0,_b=this.gridColumns.length;i<_b;i++){var _c=this.gridColumns[i];if(this.propertiesMap[_c]&&this.propertiesMap[_c].amtflag&&this.propertiesMap[_c].amtflag==="N"){var _d=this.propertiesMap[_c]._fieldName;_a=this._retrieveWidgetsValues(_9,_c,_d,_a);}else{if(this.propertiesMap[_c]&&this.propertiesMap[_c].amtflag&&this.propertiesMap[_c].amtflag==="Y"){var _e=_c+"_cur_code";var _f=_c+"_amt";var _10;if(dj.byId(_e)&&dj.byId(_f)){_10=dj.byId(_e).get("displayedValue")+" "+dj.byId(_f).get("displayedValue");}else{_10="";}_a[_c]=_10;}else{if(_c!=="store_id"&&_c!=="is_valid"){console.error("[BeneAdvicesGrid] Error while updating grid"+_c);}}}}_a.is_valid=this.is_valid;return _a;},addItem:function(_11){var _12=this;var _13=false;if(_12.grid&&_12.grid.store){_12.grid.store.fetch({onBegin:function(_14){if(_14<parseInt(m._config.beneAdvTableMaxRows,10)){_13=true;}else{m.dialog.show("ALERT",m.getLocalization("beneAdvMaxRowsReached"));}}});}else{_13=true;}if(_13){_12.inherited(arguments);}},toXML:function(){var xml=[];if(this.xmlTagName){xml.push("<",this.xmlTagName,">");}if(this.grid){this.grid.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(this,function(_15,_16){xml.push(this.itemToXML(_15,this.xmlSubTagName));})});}if(this.xmlTagName){xml.push("</",this.xmlTagName,">");}xml.push("<bene_adv_table_format_time>");xml.push(this.templateJSON.modificationTime);xml.push("</bene_adv_table_format_time>");xml.push("<bene_adv_table_format_json>");xml.push(dojo.toJson(this.templateJSON));xml.push("</bene_adv_table_format_json>");if(this.templateDesc!==null&&this.templateDesc!==undefined){xml.push("<bene_adv_table_format_description>");xml.push(dojo.trim(dojox.html.entities.encode(this.templateDesc,dojox.html.entities.html)));xml.push("</bene_adv_table_format_description>");}return xml.join("");},openDialogFromExistingItem:function(_17,_18){misys.dialog.isActive=false;var _19=_17[0];this.checkDialog();if(this.overrideDisplaymode!=="view"){this.dialog.set("title",this.dialogUpdateItemTitle);}else{var _1a=this.dialogViewItemTitle||this.dialogUpdateItemTitle;this.dialog.set("title",_1a);}this.resetDialog();this.dialog.gridMultipleItemsWidget=this;this.dialog.execute=this.dialogExecute;this.dialog.gridMultipleItemsWidget=this;this.dialog.storeId=(dojo.isArray(_19.store_id)?_19.store_id[0]:_19.store_id);var _1b=this.dialog.getChildren();for(var _1c in _19){if(this.propertiesMap[_1c]&&this.propertiesMap[_1c].amtflag&&this.propertiesMap[_1c].amtflag==="N"){var _1d=(this.propertiesMap[_1c]&&this.propertiesMap[_1c]._fieldName?this.propertiesMap[_1c]._fieldName:_1c);if(_1c!="store_id"){dojo.some(_1b,function(_1e){if(_1e.id==_1d||_1e.name==_1d){var _1f=_19[_1c];_1f=dojo.isArray(_1f)?_1f[0]:_1f;if((_1f!==0&&!_1f)&&this.overrideDisplaymode==="view"){if(_1e&&_1e.id&&dojo.byId(_1e.id+"_row")){dojo.style(_1e.id+"_row","display","none");}}if(_1e.isInstanceOf(misys.grid.GridMultipleItems)){if(_1e.grid){_1e.grid.destroy();}if(dojo.isObject(_1f)&&_1f._values&&dojo.isArray(_1f._values)){_1e.dataList=dojo.clone(_1f._values);_1e.createDataStoreFromDataList();_1e.createDataGrid();var key=_19.store_id+"_"+_1c;if(this.handle&&!this.handle[key]){this.handle[key]=misys.connect(this.dialog,"onShow",_1e,"renderAll");}}}else{var _20=_1e.declaredClass;switch(_20){case "dijit.form.DateTextBox":_1e.set("displayedValue",_1f);break;case "dijit.form.CheckBox":_1e.set("checked",_1f=="Y"?true:false);break;case "dijit.form.RadioButton":var _21=dojo.query("[name='"+_1e.name+"']",this.dialog.domNode);dojo.some(_21,function(_22){var _23=dj.byNode(_22.parentNode);if(_23.params.value==_1f){_23.set("checked",true);return true;}});break;case "dijit.form.NumberTextBox":if(_1f!==null&&_1f!==""&&_1f!=="NaN"){_1e.set("value",_1f,false);}break;default:_1e.set("value",_1f);break;}if(this.overrideDisplaymode==="view"){_1e.set("readOnly",true);}return true;}}return false;},this);}}else{if(this.propertiesMap[_1c]&&this.propertiesMap[_1c].amtflag&&this.propertiesMap[_1c].amtflag==="Y"){var _24=_1c+"_cur_code";var _25=_1c+"_amt";var _26=_19[_1c];var _27=_26=dojo.isArray(_26)?_26[0].split(" "):_26.split(" ");if(dj.byId(_24)&&dj.byId(_25)&&_26!==""){dj.byId(_24).set("displayedValue",_27[0]);dj.byId(_25).set("displayedValue",_27[1]);}else{dj.byId(_24).set("displayedValue","");dj.byId(_25).set("displayedValue","");}}else{if(_1c!=="store_id"&&_1c!=="is_valid"){console.error("[BeneAdvicesGrid] Error while opening dialog from existing "+_1c);}}}}if(this.openDialogFromExistingItemInitFunction!==null){this.openDialogFromExistingItemInitFunction(_19);}this.dialog.show();setTimeout(dojo.hitch(this,"activateDialog"),500);if(_19.hasOwnProperty("is_valid")){var _28=(dojo.isArray(_19.is_valid))?_19.is_valid[0]:_19.is_valid;if(_28!=="Y"){this.validateDialog(true);}}}});};function _29(_2a){var _2b=(_2a.column_label).replace(/\s/g,"")+"_row";var _2c="<div id='"+_2b+"' class='field'>";var _2d="<label>"+_2a.column_label+":"+"</label>";var _2e="";_2e=_2e.concat(_2c,_2d);var _2f="";if(_2a.column_type==="01"){_2f="<div trim='true' uppercase='true' dojoType='dijit.form.ValidationTextBox' required='true' regExp='^[a-zA-Z]*$' class='xx-small' maxLength='3'"+"id='"+(_2a.column_label).replace(/\s/g,"")+"_cur_code'"+"></div>";_2f=_2f.concat("<div trim='true' dojoType='misys.form.CurrencyTextBox' required='true' class='small'"+"id='"+(_2a.column_label).replace(/\s/g,"")+"_amt'"+"maxLength='"+_2a.column_width+"'"+"></div>");}else{if(_2a.column_type==="02"){_2f="<div trim='true' uppercase='true' dojoType='dijit.form.ValidationTextBox' required='true' regExp='^[a-zA-Z]*$' class='xx-small' maxLength='3'"+"id='"+(_2a.column_label).replace(/\s/g,"")+"_cur_code'"+"></div>";_2f=_2f.concat("<div trim='true' dojoType='misys.form.CurrencyTextBox' required='true' class='small'"+"id='"+(_2a.column_label).replace(/\s/g,"")+"_amt'"+"maxLength='"+_2a.column_width+"'"+"></div>");}else{if(_2a.column_type==="03"){_2f="<div dojoType='dijit.form.DateTextBox' required='true' class='small'"+"id='"+(_2a.column_label).replace(/\s/g,"")+"'"+"></div>";}else{if(_2a.column_type==="04"){_2f="<div dojoType='dijit.form.ValidationTextBox' regExp='^[0-9\\s+-]*$' required='true' class='medium' "+"id='"+(_2a.column_label).replace(/\s/g,"")+"'"+"maxLength='"+_2a.column_width+"'"+"></div>";}else{if(_2a.column_type==="05"){_2f="<div  dojoType='dijit.form.ValidationTextBox' regExp='^[a-zA-Z0-9\\s+-]*$' required='true' class='medium'"+"id='"+(_2a.column_label).replace(/\s/g,"")+"'"+"maxLength='"+_2a.column_width+"'"+"></div>";}else{if(_2a.column_type==="06"){_2f="<div dojoType='dijit.form.ValidationTextBox' regExp='^[a-zA-Z\\s]*$' required='true' class='medium'"+"id='"+(_2a.column_label).replace(/\s/g,"")+"'"+"maxLength='"+_2a.column_width+"'"+"></div>";}}}}}}_2e=_2e.concat(_2f);_2e=_2e.concat("</div>");return _2e;};function _30(_31){var _32=dj.byId(""+(_31.column_label).replace(/\s/g,"")+"_cur_code");var _33=dj.byId(""+(_31.column_label).replace(/\s/g,"")+"_amt");var _34,_35;var _36=parseFloat(_31.column_width);if(_32&&_32.get("value")!==""&&_32.state!=="Error"){_34=_32.get("value");if(_33){_35=d.cldr.monetary.getData(_34);var i,_37="";if(_35.places===2){for(i=0;i<(_36-3);i++){_37=_37.concat("9");}_37=_37.concat(".99");_33.set("constraints",{round:_35.round,places:_35.places,min:0,max:parseFloat(_37)});}else{if(_35.places===3){for(i=0;i<(_36-4);i++){_37=_37.concat("9");}_37=_37.concat(".999");_33.set("constraints",{round:_35.round,places:_35.places,min:0,max:parseFloat(_37)});}else{if(_35.places===0){for(i=0;i<(_36);i++){_37=_37.concat("9");}_33.set("constraints",{round:_35.round,places:_35.places,min:0,max:parseFloat(_37)});}}}}}};function _38(_39){var _3a=dj.byId(""+(_39.column_label).replace(/\s/g,"")+"_cur_code");var _3b=dj.byId(""+(_39.column_label).replace(/\s/g,"")+"_amt");var _3c,_3d;var _3e=parseFloat(_39.column_width);if(_3a&&_3a.get("value")!==""&&_3a.state!=="Error"){_3c=_3a.get("value");if(_3b){_3d=d.cldr.monetary.getData(_3c);var _3f="";for(var i=0;i<(_3e);i++){_3f=_3f.concat("9");}_3b.set("constraints",{round:_3d.round,places:0,min:0,max:parseFloat(_3f)});}}};function _7(_40,_41){var _42={};dojo.forEach(_40.table,function(_43,_44){if(_43.column_type!=="01"&&_43.column_type!=="02"){_42[(_43.column_label).replace(/\s/g,"")]={_fieldName:(_43.column_label).replace(/\s/g,""),amtflag:"N"};}else{_42[(_43.column_label).replace(/\s/g,"")]={_fieldName:(_43.column_label).replace(/\s/g,""),amtflag:"Y"};}});return _42;};function _8(_45){var _46=[];var _47=_45.table.length;var _48=""+95/_47+"%";dojo.forEach(_45.table,function(_49,_4a){var _4b=""+(_49.column_label).replace(/\s/g,"")+"";var _4c="text-align:"+_49.column_alignment+";";_46.push({name:_4b,field:_4b,width:_48,cellStyles:_4c,noresize:true});});_46.push({name:" ",field:"actions",formatter:misys.grid.formatReportActions,width:"5%",noresize:true});_46.push({name:"Id",field:"store_id",headerStyles:"display:none",cellStyles:"display:none",noresize:true});return _46;};function _4d(){var _4e=dj.byId("bene_adv_table_format").get("value");var _4f=m._config.bene_advice.beneAdvTemplates[_4e];var _50=[];if(_4f){dojo.forEach(_4f.table,function(_51,_52){if(_51.column_type!=="01"&&_51.column_type!=="02"){_50.push((_51.column_label).replace(/\s/g,""));}else{_50.push((_51.column_label).replace(/\s/g,"")+"_cur_code");_50.push((_51.column_label).replace(/\s/g,"")+"_amt");}});dj.byId("beneAdvDialogOkButton").set("disabled",true);var _53=false,_54,_55;_53=d.every(_50,function(id){_54=dj.byId(id);if(_54){_55=_54.get("value");if(!_55||_54.state==="Error"){if(_55==null||isNaN(_55)||(typeof (_55)=="string"&&_55.replace(/\s/g,"")==="")){m.showTooltip(m.getLocalization("mandatoryFieldsError"),_54.domNode,["above","before"]);_54.state="Error";_54._setStateClass();dj.setWaiState(_54.focusNode,"invalid","true");return false;}else{if(!isNaN(_55)&&_55<0){m.showTooltip(m.getLocalization("mandatoryFieldsError"),_54.domNode,["above","before"]);_54.state="Error";_54._setStateClass();dj.setWaiState(_54.focusNode,"invalid","true");return false;}}}}return true;});dj.byId("beneAdvDialogOkButton").set("disabled",false);if(!_53){d.forEach(_50,function(id){_54=dj.byId(id);if(_54){_55=_54.get("value");if(!_55||_54.state==="Error"){if(_55==null||isNaN(_55)||(typeof (_55)=="string"&&_55.replace(/\s/g,"")==="")){_54.state="Error";_54._setStateClass();dj.setWaiState(_54.focusNode,"invalid","true");}else{if(!isNaN(_55)&&_55<0){_54.state="Error";_54._setStateClass();dj.setWaiState(_54.focusNode,"invalid","true");}}}}});return false;}else{dj.byId("beneAdvTable-dialog-template").gridMultipleItemsWidget.updateData();dj.byId("beneAdvTable").dialog.hide();return true;}}else{console.error(m.getLocalization("technicalErrorWhileConfiguringBeneficiaryAdvices"));m.animate("fadeOut","beneficiaryAdvicesTransactionContainer");dj.byId("bene_adv_flag").set("checked",false);return false;}};d.mixin(m,{buildTemplateSelection:function(){var _56=dj.byId(m._config.bene_advice.beneAdvBankAbbvNameWidgetId);var _57=dj.byId(m._config.bene_advice.beneAdvEntityWidgetId);if(_56&&_57){if(_56.get("value")===""||_57.get("value")===""){var _58=function(){dj.byId("bene_adv_flag").set("checked",false);_56.set("state","error");};var _59=function(){dj.byId("bene_adv_flag").set("checked",false);_57.set("state","error");};if(_56.get("value")===""){m.dialog.show("ERROR",m.getLocalization("selectBankToProceed"),"",_58);}else{m.dialog.show("ERROR",m.getLocalization("selectEntityToProceed"),"",_59);}}else{if(dj.byId("bene_adv_table_format")){var _5a=m._config.bene_advice.beneAdvBankEntityTemplates[_56.get("value")][_57.get("value")];if(!_5a[0]){m.animate("fadeOut","beneAdvTemplateDiv");}else{m._config.templateSelectionBuilt=true;dj.byId("bene_adv_table_format").set("value","");dj.byId("bene_adv_table_format").store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_5a}});}}}}else{console.error(m.getLocalization("technicalErrorWhileConfiguringBeneficiaryAdvices"));m.animate("fadeOut","beneficiaryAdvicesTransactionContainer");dj.byId("bene_adv_flag").set("checked",false);}},buildGridMultipleItem:function(_5b){var _5c;var _5d;if(!_5b){_5b="edit";}if(_5b==="edit"){var _5e=dj.byId("bene_adv_table_format").get("value");_5c=m._config.bene_advice.beneAdvTemplates[_5e];_5d=m._config.bene_advice.beneAdvTemplatesDescription[_5e];}else{_5c=m._config.bene_advice.beneAdvTableFormatJson;}var _5f=[];var _60=[];var _61=new String("<div>");d.style("beneAdvTableDivContainer","display","none");var _62=dj.findWidgets(dojo.byId("beneAdvTable-dialog-template-content"));dojo.forEach(_62,function(w){w.destroyRecursive(false);});dojo.empty("beneAdvTable-dialog-template-content");if(_5c){var _63=[];var _64=[];dojo.forEach(_5c.table,function(_65,_66){_60.push(_65.column_label);_5f.push((_65.column_label).replace(/\s/g,""));_61=_61.concat(_29(_65));if(_65.column_type==="01"){_63.push(_65);}else{if(_65.column_type==="02"){_64.push(_65);}}});if(_61!==""){_61.concat("</div>");dojo.place(_61,"beneAdvTable-dialog-template-content");}dojo.parser.parse("beneAdvTable-dialog-template-content");dojo.forEach(_63,function(_67,_68){var _69=""+(_67.column_label).replace(/\s/g,"")+"_cur_code";var _6a=""+(_67.column_label).replace(/\s/g,"")+"_amt";m.setValidation(_69,m.validateCurrency);m.connect(_69,"onChange",function(){_30(_67);});});dojo.forEach(_64,function(_6b,_6c){var _6d=""+(_6b.column_label).replace(/\s/g,"")+"_cur_code";var _6e=""+(_6b.column_label).replace(/\s/g,"")+"_amt";m.setValidation(_6d,m.validateCurrency);m.connect(_6d,"onChange",function(){_38(_6b);});});_1(_5c,_5f,_60,_5b,_5d);if(dj.byId("beneAdvTable")){dj.byId("beneAdvTable").destroyRecursive();}var _6f="<div dojoType='misys.system.widget.BeneficiaryAdvicesGrid' gridId='bene-adv-table-grid' id='beneAdvTable' class'dojoxGrid'></div>";dojo.place(_6f,"beneAdvTableDivContainer","last");dojo.parser.parse("beneAdvTableDivContainer");m.animate("wipeIn","beneAdvTableDivContainer");m.connect(window,"onresize",m.resizeGrids);}else{if(dj.byId("beneAdvTable")){dj.byId("beneAdvTable").destroyRecursive();}}},updateGridDataFromDialog:function(){_4d();}});})(dojo,dijit,misys);dojo.require("misys.client.binding.core.beneficiary_advice_templates_client");}