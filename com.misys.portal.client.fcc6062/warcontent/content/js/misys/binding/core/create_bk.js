/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.core.create_bk"]){dojo._hasResource["misys.binding.core.create_bk"]=true;dojo.provide("misys.binding.core.create_bk");dojo.require("dojo.parser");dojo.require("dojo.data.ItemFileReadStore");dojo.require("dojo.window");dojo.require("dojo.DeferredList");dojo.require("dijit.layout.TabContainer");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.Select");dojo.require("dijit.Dialog");dojo.require("misys.widget.NoCloseDialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("misys.form.PercentNumberTextBox");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.widget.Collaboration");dojo.require("misys.form.common");dojo.require("misys.form.file");dojo.require("misys.validation.common");dojo.require("misys.binding.cash.ft_common");dojo.require("misys.form.BusinessDateTextBox");dojo.require("misys.binding.core.merge_demerge_bk");dojo.require("misys.openaccount.FormOpenAccountEvents");(function(d,dj,m){var _1="no-customer-bank-message-div";var _2="gridBulkTransaction",_3=false,_4=false,_5=true;function _6(_7){var _8=dijit.byId("mode")?dijit.byId("mode").get("value"):"";if(!dj.byId("holidayCutOffDialog")){d.require("misys.widget.Dialog");d.require("dijit.form.Button");var _9=new dj.Dialog({id:"holidayCutOffDialog",title:"Confirmation",draggable:false});var _a=d.create("div",{id:"holidayCutOffDialogContent"});var _b=d.create("div",{id:"dialogHolidayText"},_a,"first");var _c=d.create("div",{id:"holidayCutOffDialogButtons",style:"text-align:center;"},_a,"last");var _d=new dj.form.Button({label:m.getLocalization("returnMessage"),id:"rejectHolidayButtonId"});var _e=new dj.form.Button({label:m.getLocalization("autoForwardMessage"),id:"forwardHolidayButtonId"});var _f=new dj.form.Button({label:m.getLocalization("cancelMessage"),id:"cancelHolidayButtonId"});if(_8==="UNSIGNED"){d.place(_d.domNode,_c);}if(_7===true){d.place(_e.domNode,_c);}d.place(_f.domNode,_c);_9.set("content",_a);}if(_8!=="UNSIGNED"&&!_7){m._config.onSubmitErrorMsg=m.getLocalization("failedSingleSubmissionFromDraft");}var _10=dj.byId("holidayCutOffDialog");if(d.byId("dialogHolidayText")){d.byId("dialogHolidayText").innerHTML=m._config.onSubmitErrorMsg;}m.dialog.connect(_10,"onKeyPress",function(evt){if(evt.keyCode==d.keys.ESCAPE){d.stopEvent(evt);}});m.dialog.connect(dj.byId("forwardHolidayButtonId"),"onClick",function(){_10.hide();setTimeout(function(){dj.byId("bulk_autoforward").set("value","Y");m.submit("AUTO_FORWARD_SUBMIT");},500);},_10.id);m.dialog.connect(dj.byId("rejectHolidayButtonId"),"onClick",function(){m.submit("RETURN_TRANSACTION");m.dialog.hide();_10.hide();},_10.id);m.dialog.connect(dj.byId("cancelHolidayButtonId"),"onClick",function(){m.dialog.hide();_10.hide();},_10.id);m.dialog.connect(_10,"onHide",function(){m.dialog.disconnect(_10);m.dialog.hide();});_10.show();};function _11(){var _12=dj.byId("bk_cur_code").get("value");dj.byId("bk_total_amt_cur_code").set("value",_12);d.attr(dj.byId("bk_total_amt"),"value","",false);dj.byId("bk_highest_amt_cur_code").set("value",_12);d.attr(dj.byId("bk_total_amt"),"value","",false);if(dj.byId("value_date")){d.attr(dj.byId("value_date"),"value","",false);}d.byId("display_record_number").innerHTML="<b>0</b>";_13(false);if(dj.byId("pre_approved")){if(dj.byId("pre_approved").get("checked")===true){m.animate("wipeIn",d.byId("PAB"));dj.byId("pre_approved_status").set("value","Y");if(dj.byId("applicant_act_pab")){dj.byId("applicant_act_pab").set("value","Y");}}else{dj.byId("pre_approved_status").set("value","N");if(dj.byId("applicant_act_pab")){dj.byId("applicant_act_pab").set("value","N");}}}if(misys._config.nickname==="true"){if(dj.byId("applicant_act_nickname")&&d.byId("applicant_act_nickname_row")&&d.byId("nickname")&&dj.byId("applicant_act_nickname").get("value")!==""){m.animate("fadeIn",d.byId("label"));d.style("label","display","inline-block");d.style("nickname","display","inline");d.byId("nickname").innerHTML=dj.byId("applicant_act_nickname").get("value");}else{m.animate("wipeOut",d.byId("applicant_act_nickname_row"));}}m.animate("wipeOut",d.byId("content1"),function(){m.animate("wipeIn",d.byId("content2"),function(){dj.byId("gridBulkTransaction").resize();dj.byId("gridBulkTransaction").update();});m.animate("wipeOut",d.byId("display_sub_product_code_row"));});};function _14(){var _15,_16,_17,_18,_19,_1a;if(dj.byId("child_sub_product_code")){_16=dj.byId("child_sub_product_code").get("value");_18=dj.byId("applicant_act_no").get("value");_1a=dj.byId("applicant_collection_act_no").get("value");if(misys._config.isMultiBank){_19=_1b();}else{if(dj.byId("bank_base_currency")){_19=dj.byId("bank_base_currency").get("value");}}if((_16==="DOM"||_16==="PICO")&&_18!==""){dj.byId("bk_cur_code").set("value",_19);dj.byId("bk_cur_code").set("readOnly",true);}else{if(_16==="DOM"&&_1a!==""){dj.byId("bk_cur_code").set("value",_19);dj.byId("bk_cur_code").set("readOnly",true);}else{if(_16==="MEPS"){dj.byId("bk_cur_code").set("value","SGD");dj.byId("bk_cur_code").set("readOnly",true);}else{if(_16=="HVPS"||_16=="HVXB"){_17=dj.byId("applicant_act_cur_code")?dj.byId("applicant_act_cur_code").get("value"):"";if(_17!==""){dj.byId("bk_cur_code").set("value",_17);dj.byId("bk_cur_code").set("readOnly",true);}}else{if((_16==="INT"||_16==="TPT"||_16==="MUPS"||_16==="RTGS"||_16==="MT101"||_16==="MT103"||_16=="PIDD")&&_18!==""){_17=dj.byId("bk_type").get("value")==="COLLE"?dj.byId("applicant_collection_act_cur_code").get("value"):dj.byId("applicant_act_cur_code").get("value");if(_17!==""){dj.byId("bk_cur_code").set("value",_17);dj.byId("bk_cur_code").set("readOnly",true);if(_16==="PIDD"){dj.byId("bk_amt_img").set("disabled",true);}}}}}}}}if(m.client&&m.client.setBulkCurrency){m.client.setBulkCurrency();}};function _1c(){var _1d=m.getLocalization("totalamount");var _1e=dijit.byId("bk_total_amt");if(dijit.byId("bk_total_amt").isValid(true)===false){_1e.set("state","Error");dijit.hideTooltip(_1e.domNode);dijit.showTooltip(_1d,_1e.domNode,0);}};function _1f(){if(!_3){if(dj.byId("applicant_act_name")){dj.byId("applicant_act_name").set("value","");dj.byId("applicant_act_cur_code").set("value","");dj.byId("applicant_act_no").set("value","");dj.byId("applicant_act_description").set("value","");dj.byId("applicant_act_pab").set("value","");}if(dj.byId("applicant_collection_act_name")){dj.byId("applicant_collection_act_name").set("value","");dj.byId("applicant_collection_act_cur_code").set("value","");dj.byId("applicant_collection_act_no").set("value","");dj.byId("applicant_collection_act_description").set("value","");dj.byId("applicant_collection_act_pab").set("value","");}}};function _20(){if(!_3){dj.byId("sub_product_code_display").set("value","");dj.byId("sub_product_code").set("value","");dj.byId("bk_cur_code").set("value","");dj.byId("applicant_img").set("disabled",false);if(dj.byId("clearing_code")){dj.byId("clearing_code").set("value","");}_21();m.verifyCanAdvance;}};function _22(){if(dj.byId("applicant_act_pab").get("value")!==""&&dj.byId("applicant_act_name").get("value")!==""){if(dj.byId("applicant_act_name").get("value")!==""){if(dj.byId("applicant_act_pab").get("value")==="Y"){dj.byId("pre_approved").set("checked",true);dj.byId("pre_approved").set("disabled",true);}else{if(dj.byId("applicant_act_pab").get("value")==="N"){dj.byId("pre_approved").set("disabled",false);dj.byId("pre_approved").set("checked",false);}}if(!m._config.non_pab_allowed){m.animate("wipeOut",d.byId("pab_checkbox_row"));}else{if(m._config.non_pab_allowed&&dj.byId("applicant_act_pab").get("value")==="Y"){m.animate("wipeOut",d.byId("pab_checkbox_row"));}else{m.animate("wipeIn",d.byId("pab_checkbox_row"));}}}}else{if(dj.byId("applicant_collection_act_pab").get("value")!==""&&dj.byId("applicant_collection_act_name").get("value")!==""){if(dj.byId("applicant_collection_act_name").get("value")!==""){if(dj.byId("applicant_collection_act_pab").get("value")==="Y"){dj.byId("pre_approved").set("checked",true);dj.byId("pre_approved").set("disabled",true);}else{if(dj.byId("applicant_collection_act_pab").get("value")==="N"){dj.byId("pre_approved").set("disabled",false);dj.byId("pre_approved").set("checked",false);}}if(!m._config.non_pab_allowed){m.animate("wipeOut",d.byId("pab_checkbox_row"));}else{if(m._config.non_pab_allowed&&dj.byId("applicant_collection_act_pab").get("value")==="Y"){m.animate("wipeOut",d.byId("pab_checkbox_row"));}else{m.animate("wipeIn",d.byId("pab_checkbox_row"));}}}}else{dj.byId("pre_approved").set("checked",false);m.animate("wipeOut",d.byId("pab_checkbox_row"));m.animate("wipeOut",d.byId("PAB"));}}};function _13(_23){var _24="move-items";var _25=dj.byId("payroll_type").get("value");var _26=dj.byId("entity")?dj.byId("entity").get("value"):"*";var _27=dj.byId("issuing_bank_abbv_name")?dj.byId("issuing_bank_abbv_name").get("value"):"";if(misys._config.isMultiBank&&_23&&_23!==true){_27=dj.byId("customer_bank")?dj.byId("customer_bank").get("value"):"";}if(!_23&&_25!==""){var _28=(m._config.bkAccessPayrollArray[_25][_26+"_"+_27]&&m._config.bkAccessPayrollArray[_25][_26+"_"+_27][0].amountAccess);if(!(_28==="true")){m.animate("wipeOut",d.byId("bk_highest_amt_cur_code_row"));if(m._config.displayMode==="edit"){m.animate("wipeOut",d.byId("addTransactionButtonContainer"));m.animate("wipeOut",d.byId(_24));}}var _29=(m._config.bkAccessPayrollArray[_25][_26+"_"+_27]&&m._config.bkAccessPayrollArray[_25][_26+"_"+_27][0].itemAccess);if(!(_29==="true")){m.animate("wipeOut",d.byId("addTransactionButtonContainer"));m.animate("wipeOut",d.byId("transactionGridContainer"));m.animate("wipeOut",d.byId(_24));}}else{if(_23){if(!m._config.amountAccessPayroll){m.animate("wipeOut",d.byId("bk_highest_amt_cur_code_row"));if(m._config.displayMode==="edit"){m.animate("wipeOut",d.byId("addTransactionButtonContainer"));m.animate("wipeOut",d.byId(_24));}}if(!m._config.itemAccessPayroll){m.animate("wipeOut",d.byId("addTransactionButtonContainer"));m.animate("wipeOut",d.byId("transactionGridContainer"));m.animate("wipeOut",d.byId(_24));}}}};function _2a(){var _2b=dj.byId("bk_type").get("value");var _2c=dj.byId("entity")?dj.byId("entity").get("value"):"*";var _2d=dj.byId("issuing_bank_abbv_name")?dj.byId("issuing_bank_abbv_name").get("value"):"";if(misys._config.isMultiBank&&!_3){_2d=dj.byId("customer_bank")?dj.byId("customer_bank").get("value"):"";}if(!_3){dj.byId("child_sub_product_code").set("value","");if(_2b!==""&&_2b!=="PAYRL"){dj.byId("child_sub_product_code").store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:m._config.childSubProductsCollection[_2b][_2c+"_"+_2d]}});}else{if(_2b!==""){var _2e=dj.byId("payroll_type").get("value");if(_2e!==""){dj.byId("child_sub_product_code").store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:m._config.childSubProductsCollectionPayroll[_2b][_2e][_2c+"_"+_2d]}});}else{_2f();}}}}};function _30(_31){var _32;var _33=dj.byId("issuing_bank_abbv_name")?dj.byId("issuing_bank_abbv_name").get("value"):"";if(misys._config.isMultiBank&&!_31){_33=dj.byId("customer_bank")?dj.byId("customer_bank").get("value"):"";}if(dj.byId("entity")){_32=dj.byId("entity").get("value");}else{if(dj.byId("entity_hidden")){_32=dj.byId("entity_hidden").get("value");if(_32===""){_32="*";}}else{_32="*";}}dj.byId("bk_type").set("value","");if(_32!==""){var _34=m._config.bkTypeCollection[_32+"_"+_33];dj.byId("bk_type").store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_34}});if(d.byId(_1)){if(!_34&&_33){misys.animate("fadeIn",d.byId(_1));}else{misys.animate("fadeOut",d.byId(_1));}}}if(_31){_3=_31;}};function _2f(){var _35;var _36=dj.byId("issuing_bank_abbv_name")?dj.byId("issuing_bank_abbv_name").get("value"):"";if(misys._config.isMultiBank&&!_3){_36=dj.byId("customer_bank")?dj.byId("customer_bank").get("value"):"";}if(dj.byId("entity")){_35=dj.byId("entity").get("value");}else{if(dj.byId("entity_hidden")){_35=dj.byId("entity_hidden").get("value");if(_35===""){_35="*";}}else{_35="*";}}if(dj.byId("payroll_type")&&_35!==""){dj.byId("payroll_type").set("value","");dj.byId("payroll_type").store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:m._config.payrollTypeCollection[_35+"_"+_36]}});}};function _21(){var _37=dj.byId("bk_type").get("value");var _38=dj.byId("child_sub_product_code").get("value");var _39=dj.byId("payroll_type").get("value");var _3a=dj.byId("entity")?dj.byId("entity").get("value"):"*";var _3b=dj.byId("issuing_bank_abbv_name")?dj.byId("issuing_bank_abbv_name").get("value"):"";if(misys._config.isMultiBank&&!_3){_3b=dj.byId("customer_bank")?dj.byId("customer_bank").get("value"):"";}dj.byId("sub_product_code").set("value","");dj.byId("sub_product_code_display").set("value","");if(_38!==""){if(_37==="PAYRL"&&_39!==""){dj.byId("sub_product_code_display").set("value",m._config.subProductsCollectionPayroll[_39][_3a+"_"+_3b][_38].name);dj.byId("sub_product_code").set("value",m._config.subProductsCollectionPayroll[_39][_3a+"_"+_3b][_38].value);d.byId("display_value_sub_product_code_row").innerHTML=m._config.subProductsCollectionPayroll[_39][_3a+"_"+_3b][_38].name;}else{dj.byId("sub_product_code_display").set("value",m._config.subProductsCollection[_37][_3a+"_"+_3b][_38].name);dj.byId("sub_product_code").set("value",m._config.subProductsCollection[_37][_3a+"_"+_3b][_38].value);d.byId("display_value_sub_product_code_row").innerHTML=m._config.subProductsCollection[_37][_3a+"_"+_3b][_38].name;}m.animate("wipeIn",d.byId("display_sub_product_code_row"));if(dj.byId("child_sub_product_code").get("value")!==""&&dj.byId("child_sub_product_code").get("value")==="MUPS"){d.style("clearingCode_div","display","block");if(dj.byId("clearing_code")){dj.byId("clearing_code").set("required",true);}d.style("display_clearing_code_row","display","block");}else{d.style("clearingCode_div","display","none");if(dj.byId("clearing_code")){dj.byId("clearing_code").set("required",false);}d.style("display_clearing_code_row","display","none");}}else{m.animate("wipeOut",d.byId("display_sub_product_code_row"));d.style("clearingCode_div","display","none");if(dj.byId("clearing_code")){dj.byId("clearing_code").set("required",false);}}};function _3c(){var _3d=dj.byId("applicant_act_no").get("value");var _3e=m.checkAccountStatus(_3d);if(!_3e){return false;}return true;};function _3f(){var _40=dijit.byId("gridBulkTransaction");if(_40&&_40.store){for(var i=0;i<_40.store._items.length;i++){if(_40.store._items[i].i["tnx_stat_code"]+"S"==="Error"+"S"){_5=false;return;}}}};function _41(_42){var _43=dj.byId("customer_bank")?dj.byId("customer_bank").get("value"):"";if(dj.byId("optionVal")&&dj.byId("optionVal").get("value")==="SCRATCH"&&misys&&misys._config&&misys._config.businessDateForBank&&misys._config.businessDateForBank[_43]&&misys._config.businessDateForBank[_43][0]&&misys._config.businessDateForBank[_43][0].value!==""){var _44=misys._config.businessDateForBank[_43][0].value;var _45=_44.substring(0,4);var _46=_44.substring(5,7);var _47=_44.substring(8,10);_44=_47+"/"+_46+"/"+_45;dj.byId("appl_date").set("value",_44);if(document.getElementById("appl_date_view_row")){document.getElementById("appl_date_view_row").childNodes[1].innerHTML=_44;}}if(!_42){var _48=dj.byId("customer_bank_hidden");_1f();_30();if(_48){dj.byId("customer_bank_hidden").set("value",_43);}var _49=dj.byId("issuing_bank_abbv_name");var _4a=dj.byId("issuing_bank_name");if(_49&&_4a&&misys._config.customerBankDetails){_49.set("value",_43);if(m._config.customerBankDetails&&m._config.customerBankDetails[_43]){_4a.set("value",m._config.customerBankDetails[_43][0].value);}else{_4a.set("value",_43);}}if(d.byId("display_customer_bank")){d.byId("display_customer_bank").innerHTML=_4a.get("value");}}};function _4b(){if(dj.byId("bk_esign2_value")){return dj.byId("bk_esign2_value").value;}};function _4c(){var _4d=dj.byId("sub_product_code")?dj.byId("sub_product_code").get("value"):"";if(_4d!==""){var _4e=dojo.toJson({productcode:"BK",subproductcode:_4d});return m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/GetCollaborationMode"),sync:true,handleAs:"json",contentType:"application/json; charset=utf-8",content:_4e,load:function(_4f,_50){if(_4f.success){if(dj.byId("collaborationWindow")){if(_4f.collaboration_mode&&_4f.collaboration_mode==="none"){dj.byId("collaborationWindow").hide();}else{dj.byId("collaborationWindow").show();}}}else{m.dialog.show("ERROR",_4f.errorMessage,"");}},error:function(_51,_52){m.dialog.show("ERROR",m.getLocalization("updateBulkError"),"");}});}};function _53(){var _54=dj.byId("sub_product_code")?dj.byId("sub_product_code").get("value"):"";if(_54!==""){var _55=dojo.toJson({productcode:"BK",subproductcode:_54});return m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/GetTaskMode"),sync:true,content:_55,load:function(_56,_57){misys._config=misys._config||{};misys._config.task_mode=_56;},error:function(_58,_59){m.dialog.show("ERROR",m.getLocalization("updateBulkError"),"");}});}};function _5a(){var _5b=dj.byId("applicant_act_cur_code").get("value");if(_5b!==""&&_5b!=="CNY"){m.dialog.show("ERROR",m.getLocalization("bulkCNYError"));dj.byId("applicant_act_name").set("value","");dj.byId("applicant_act_cur_code").set("value","");dj.byId("applicant_act_no").set("value","");dj.byId("bk_cur_code").set("value","");return true;}};function _5c(){var _5d=dj.byId("bk_type");var _5e=dj.byId("bk_type_hidden");var _5f=dj.byId("payroll_type");var _60=dj.byId("payroll_type_hidden");if(_5d&&_5d.get("value")===""&&_5e&&_5e.get("value")!==""){_5d.set("value",_5e.get("value"));}if(_5f&&_5f.get("value")===""&&_60&&_60.get("value")!==""){_5f.set("value",_60.get("value"));}};function _1b(){var _61=dj.byId("customer_bank")?dj.byId("customer_bank").get("value"):"";var _62=dj.byId("bk_type")?dj.byId("bk_type").get("value"):"";var _63=dj.byId("child_sub_product_code")?dj.byId("child_sub_product_code").get("value"):"";var _64="";if(_61!==""&&_62!==""&&_63!==""&&_63==="DOM"&&misys._config.bankBaseCurCode){_64=misys._config.bankBaseCurCode[_61];}return _64;};function _65(){var _66=dj.byId("applicant_act_cur_code").get("value");if(_66!==""&&_66!=="INR"){m.dialog.show("ERROR",m.getLocalization("mismatchFromINR"));dj.byId("applicant_act_name").set("value","");dj.byId("applicant_act_cur_code").set("value","");dj.byId("applicant_act_no").set("value","");dj.byId("bk_cur_code").set("value","");return true;}};function _67(){var _68=dj.byId("product_code").get("value"),_69=dj.byId("sub_product_code").get("value"),_6a=dj.byId("applicant_act_name"),_6b=dj.byId("applicant_act_no"),_6c=dj.byId("applicant_act_cur_code"),_6d=dj.byId("applicant_act_description"),_6e=dj.byId("applicant_act_product_types"),_6f=dj.byId("applicant_reference"),_70=dj.byId("applicant_acc_nra"),_71=dj.byId("applicant_act_pab");if(_68&&_69){if(!(_68==="")&&!(_69==="")){_6a.set("value","");_6b.set("value","");_6c.set("value","");_6d.set("value","");_6f.set("value","");_71.set("value","");m.xhrPost({url:misys.getServletURL("/screen/AjaxScreen/action/SetDefaultAccount"),handleAs:"json",sync:true,content:{product_code:_68,sub_product_code:_69},load:function(_72,_73){if(_72.items.oneAccount===true){_6a.set("value",_72.items.applicant_act_name);_6b.set("value",_72.items.applicant_act_no);_6c.set("value",_72.items.applicant_act_cur_code);_6d.set("value",_72.items.applicant_act_description);_6f.set("value",_72.items.applicant_reference);_71.set("value",_72.items.applicant_act_pab);}else{}},error:function(_74,_75){console.error("[Could not check eligible accounts] ");console.error(_74);}});}}};d.mixin(m._config,{initReAuthParams:function(){var _76=dj.byId("entity")?dj.byId("entity").get("value"):"";var _77=dj.byId("issuing_bank_abbv_name")?dj.byId("issuing_bank_abbv_name").get("value"):"";var _78={productCode:"BK",subProductCode:dj.byId("sub_product_code").get("value"),transactionTypeCode:"01",entity:_76,currency:dj.byId("bk_total_amt_cur_code").get("value"),amount:m.trimAmount(dj.byId("bk_total_amt").get("value")),bankAbbvName:_77,es_field1:m.trimAmount(dj.byId("bk_total_amt").get("value")),es_field2:_4b()};return _78;}});d.mixin(m,{fixBulkTransactions:function(){if(dj.byId("value_date").get("value")!==""&&dj.byId("value_date").get("value")!==null){return m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/FixBulkTransactionsAction"),sync:true,handleAs:"json",contentType:"application/json; charset=utf-8",content:{formContent:m.formToXML({selector:"#fakeform1",xmlRoot:"bk_tnx_record"})},load:function(_79,_7a){if(_79.success){m.updateTransactionGrid(window);m.dialog.show("CUSTOM-NO-CANCEL",m.getLocalization("fixBulkResult",[_79.resultCount]),"");}else{m.dialog.show("ERROR",_79.errorMessage,"");}},error:function(_7b,_7c){m.dialog.show("ERROR",m.getLocalization("updateBulkError"),"");}});}},select:function(_7d){switch(_7d){case "CANCEL":document.location.href=m._config.homeUrl;return;break;default:break;}},goToTransaction:function(_7e,_7f){var _80=dj.byId(_7e);var _81=d.byId(_7e);for(var x in _7f){if(!_81[x]){d.create("input",{type:"hidden",name:x,value:_7f[x]},_81);}else{_81[x].value=_7f[x];}}_80.connectChildren();_80.set("action",misys.getServletURL("/screen/BulkScreen"));_80.startup();_80.submit();},confirmDeleteFromBulk:function(_82,_83){d.mixin(m,{bulkDeleteParameters:_82});this.dialog.show("CONFIRMATION",this.getLocalization("removeFromBulkConfirmation",[_82.referenceid]),"",_83);},editOrRemove:function(_84){var _85=(_84)?_84:m.bulkDeleteParameters;if(_85.operation&&_85.operation=="DELETE"){m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/DeleteBulkTransaction"),sync:true,handleAs:"json",content:{productcode:"FT",referenceid:_85.referenceid,tnxid:_85.tnxid,bulkRefId:dj.byId("ref_id")?dj.byId("ref_id").get("value"):"",bulkTnxId:dj.byId("tnx_id")?dj.byId("tnx_id").get("value"):"",e2ee_plus_public_key:dj.byId("e2ee_plus_public_key")?dj.byId("e2ee_plus_public_key").get("value"):"",e2ee_plus_challenge:dj.byId("e2ee_plus_challenge")?dj.byId("e2ee_plus_challenge").get("value"):""},load:function(_86,_87){if(_86.success){m.updateTransactionGrid(window);if(_86.bulkEsign2Value&&dj.byId("bk_esign2_value")){dj.byId("bk_esign2_value").set("value",_86.bulkEsign2Value);}}else{m.dialog.show("ERROR",_86.errorMessage,"");}},error:function(_88,_89){m.dialog.show("ERROR",m.getLocalization("updateBulkError"),"");}});}else{if(_85.option&&_85.option=="PENDING"){_5c();var _8a=m.formToXML({selector:"#fakeform1, #collaboration_form",xmlRoot:"bk_tnx_record"});m.goToTransaction("existingForm",{tnxtype:"01",option:_85.option,mode:_85.mode,referenceid:_85.referenceid,tnxid:_85.tnxid,text:dj.byId("narrative_additional_instructions")?dj.byId("narrative_additional_instructions").get("value"):"",bulktemplateid:dj.byId("template_id")?dj.byId("template_id").get("value"):"",custrefid:dj.byId("cust_ref_id")?dj.byId("cust_ref_id").get("value"):"",transactiondata:_8a,e2ee_plus_public_key:dj.byId("e2ee_plus_public_key")?dj.byId("e2ee_plus_public_key").get("value"):"",e2ee_plus_challenge:dj.byId("e2ee_plus_challenge")?dj.byId("e2ee_plus_challenge").get("value"):""});}else{this.dialog.show("ERROR",this.getLocalization("updateBulkError"));}}},transactionDialog:new m.widget.NoCloseDialog({title:"",id:"dialogTransaction",refocus:false,resizable:true,draggable:false,"class":"dialog",disableCloseButton:true},d.byId("dialogTransaction")),addTransaction:function(){_5c();var _8b=m.formToXML({selector:"#fakeform1, #collaboration_form",xmlRoot:"bk_tnx_record"});var _8c={transactiondata:_8b,tnxtype:"01",option:"SCRATCH",mode:"BULK"};var _8d=dj.findWidgets(dojo.byId("e2ee_content_div"));dojo.forEach(_8d,function(w){_8c[w.get("id")]=w.get("value");});m.goToTransaction("transactionForm",_8c);},verifyCanAdvance:function(){var _8e;if(dj.byId("child_sub_product_code").get("value")==="MUPS"){_8e=dj.byId("child_sub_product_code").validate()&&dj.byId("sub_product_code").get("value")!==""&&dj.byId("applicant_act_name").validate()&&dj.byId("bk_cur_code").validate()&&dj.byId("clearing_code").get("value")!=="";}else{_8e=dj.byId("child_sub_product_code").validate()&&dj.byId("sub_product_code").get("value")!==""&&dj.byId("applicant_act_name").validate()&&dj.byId("bk_cur_code").validate();}if(dj.byId("bk_type").get("value")==="PAYMT"||dj.byId("bk_type").get("value")==="PAYRL"){if(misys._config.isMultiBank){_8e=_8e&&dj.byId("customer_bank").validate();}if(_8e&&(dj.byId("sub_product_code").get("value")==="PAYRL")&&dj.byId("payroll_type").get("value")===""){_8e=false;}}dj.byId("button_intrmdt_ok").set("disabled",!_8e);_8e=true;},updateTransactionGrid:function(_8f){var _90=_8f.dijit,_91=_8f.misys,_92=_8f.dojo,_93=0,_94=0,_95=0;_91.xhrPost({url:_91.getServletURL("/screen/AjaxScreen/action/GetBulkDetailsAction"),sync:true,handleAs:"json",content:{productcode:"FT",bulk_ref_id:_90.byId("ref_id").get("value"),bulk_tnx_id:_90.byId("tnx_id").get("value")},load:function(_96,_97){if(_96.sum){_90.byId("bk_total_amt").set("value",_96.sum);}else{_90.byId("bk_total_amt").set("value","");}if(_96.max){_90.byId("bk_highest_amt").set("value",_96.max);}else{_90.byId("bk_highest_amt").set("value","");}if(_96.count){_90.byId("record_number").set("value",_96.count);}else{_90.byId("record_number").set("value","");}},error:function(_98,_99){_91.dialog.show("ERROR",_91.getLocalization("retrieveBulkDetailsError"),"");}});_91.grid.reloadForSearchTerms();},updateError:function(_9a,_9b){var _9c=_9a.dijit,_9d=_9a.misys,_9e=_9a.dojo;_9d.dialog.show("ERROR",_9d.getLocalization("updateBulkError"),"");_9d.grid.reloadForSearchTerms();},bind:function(){m.setValidation("bk_cur_code",m.validateCurrency);m.setValidation("template_id",m.validateTemplateId);m.setValidation("value_date",m.validateTransferDateCustomer);m.connect("value_date","onClick",function(){m.clearDateCache();if(misys._config.isMultiBank){var _9f;if(dijit.byId("customer_bank")){_9f=dijit.byId("customer_bank").get("value");}if(_9f!==""&&misys&&misys._config&&misys._config.businessDateForBank&&misys._config.businessDateForBank[_9f][0]&&misys._config.businessDateForBank[_9f][0].value!==""){var _a0=parseInt(misys._config.businessDateForBank[_9f][0].value.substring(0,4),10);var _a1=parseInt(misys._config.businessDateForBank[_9f][0].value.substring(5,7),10);var _a2=parseInt(misys._config.businessDateForBank[_9f][0].value.substring(8,10),10);this.dropDown.currentFocus=new Date(_a0,_a1-1,_a2);}}});m.connect("button_intrmdt_ok","onClick",_11);m.connect("bk_total_amt_cur_code","onChange",function(){m.setCurrency(this,["bk_total_amt"]);});m.connect("bk_highest_amt_cur_code","onChange",function(){m.setCurrency(this,["bk_highest_amt"]);});m.connect("entity","onChange",function(){d.byId("display_entity").innerHTML=dj.byId("entity").get("value");_1f();_30();dj.byId("entity_hidden").set("value",dj.byId("entity").get("value"));var _a3=dj.byId("customer_bank");if(misys._config.isMultiBank&&_a3){_a3.set("value","");m.populateCustomerBanks();}});m.connect("customer_bank","onChange",function(){_41(_4);_4=false;});m.connect("applicant_act_name","onChange",function(){d.byId("display_customer_bank").innerHTML=dj.byId("issuing_bank_name").get("value");d.byId("display_account").innerHTML=dj.byId("applicant_act_name").get("value");d.byId("product_group").innerHTML=dj.byId("bk_type").get("displayedValue");d.byId("display_child_sub_product_code").innerHTML=dj.byId("child_sub_product_code").get("displayedValue");if(dj.byId("child_sub_product_code").get("value")=="MEPS"||dj.byId("child_sub_product_code").get("value")=="RTGS"){d.byId("MEPS_RTGS_DISCLAIMER").innerHTML=m.getLocalization("disclaimerforrtgs");}var _a4=dj.byId("child_sub_product_code").get("value");if(_a4=="HVPS"||_a4=="HVXB"){_5a();}if(_a4=="MUPS"){_65();}m.verifyCanAdvance;_14();});m.connect("applicant_collection_act_name","onChange",function(){d.byId("display_to_account").innerHTML=dj.byId("applicant_collection_act_name").get("value");d.byId("product_group").innerHTML=dj.byId("bk_type").get("displayedValue");d.byId("display_child_sub_product_code").innerHTML=dj.byId("child_sub_product_code").get("displayedValue");m.verifyCanAdvance;_14();});m.connect("payroll_type","onChange",function(){d.byId("display_payroll_type").innerHTML=dj.byId("payroll_type").get("displayedValue");m.verifyCanAdvance;_2a();});m.connect("bk_total_amt","onChange",function(){dojo.forEach(d.query("#display_bk_total_amt_row div"),function(_a5,i){_a5.innerHTML=dj.byId("bk_total_amt").get("value");});});m.connect("bk_highest_amt","onChange",function(){dojo.forEach(d.query("#display_bk_highest_amt_row div"),function(_a6,i){_a6.innerHTML=dj.byId("bk_highest_amt").get("value");});});m.connect("record_number","onChange",function(){d.byId("display_record_number").innerHTML=dj.byId("record_number").get("value");});m.connect("bk_type","onChange",function(){if(this.get("value")==="COLLE"){m.animate("wipeOut",d.byId("payrolltype"));}else{if(this.get("value")==="PAYMT"){m.animate("wipeOut",d.byId("payrolltype"));}else{if(this.get("value")==="PAYRL"){m.animate("wipeIn",d.byId("payrolltype"));}}}});m.connect("child_sub_product_code","onChange",function(){_1f();_20();dj.byId("child_sub_product_code").get("value")==="MUPS"?d.byId("display_clearing_code").style.display="inline":d.byId("display_clearing_code").style.display="none";var _a7=dj.byId("child_sub_product_code").get("value");if(dj.byId("child_sub_product_code")){if(_a7=="HVPS"||_a7=="HVXB"){_67();}}});m.connect("clearing_code","onChange",function(){if(dj.byId("child_sub_product_code")&&dj.byId("child_sub_product_code").get("value")==="MUPS"){d.byId("display_clearing_code")?d.byId("display_clearing_code").innerHTML=dj.byId("clearing_code").get("value"):"";m.verifyCanAdvance();}});m.connect("bk_type","onChange",function(){if(this.get("value")==="COLLE"){m.animate("wipeIn",d.byId("collection"));dj.byId("applicant_act_name").set("required",false);m.animate("wipeOut",d.byId("otherpayments"));m.animate("wipeOut",d.byId("payrolltype"));m.animate("wipeOut",d.byId("display_payroll_row"));m.animate("wipeIn",d.byId("display_to_account_row"));m.animate("wipeOut",d.byId("display_account_row"));m.animate("wipeIn",d.byId("display_customer_bank_row"));}else{if(this.get("value")==="PAYRL"){m.animate("wipeIn",d.byId("payrolltype"));m.animate("wipeIn",d.byId("display_payroll_row"));}else{m.animate("wipeOut",d.byId("payrolltype"));m.animate("wipeOut",d.byId("display_payroll_row"));}m.animate("wipeIn",d.byId("otherpayments"));dj.byId("applicant_collection_act_name").set("required",false);m.animate("wipeOut",d.byId("collection"));m.animate("wipeOut",d.byId("display_to_account_row"));m.animate("wipeIn",d.byId("display_account_row"));m.animate("wipeIn",d.byId("display_customer_bank_row"));}m.verifyCanAdvance();if(!_3){dj.byId("child_sub_product_code").set("value","");dj.byId("sub_product_code").set("value","");dj.byId("payroll_type").set("value","");}_2a();});m.connect("sub_product_code","onChange",m.verifyCanAdvance);m.connect("bk_cur_code","onChange",m.verifyCanAdvance);m.connect("applicant_act_pab","onChange",_22);m.connect("applicant_collection_act_pab","onChange",_22);m.connect("sub_product_code","onChange",_4c);m.connect("sub_product_code","onChange",_53);m.connect("AmountRange","onBlur",function(){m.validateFSCMFromAmount("AmountRange","AmountRange2");});m.connect("AmountRange2","onBlur",function(){m.validateFSCMToAmount("AmountRange2","AmountRange");});m.connect("invoice_date_from","onBlur",m.validateInvoiceDateFrom);m.connect("invoice_date_to","onBlur",m.validateInvoiceDateTo);m.connect("invoice_due_date_from","onBlur",m.validateInvoiceDueDateFrom);m.connect("invoice_due_date_to","onBlur",m.validateInvoiceDueDateTo);},onBeforeLoad:function(){m.excludedMethods.push({object:m,method:"addTransaction"},{object:m,method:"moveItems"},{object:m,method:"editOrRemove"});if(misys._config.isMultiBank){if(d.byId(_1)){misys.animate("fadeOut",d.byId(_1));}}},onFormLoad:function(){var _a8=dj.byId("bk_type")?dj.byId("bk_type").get("value"):"";var _a9=dj.byId("bk_type_hidden")?dj.byId("bk_type_hidden").get("value"):"";var _aa=dj.byId("issuing_bank_abbv_name");var _ab=dj.byId("issuing_bank_name");if(dj.byId("bk_highest_amt")&&dijit.byId("bk_highest_amt").params&&dijit.byId("bk_highest_amt").params["value"]&&dijit.byId("bk_highest_amt").params["value"]!=dijit.byId("bk_highest_amt").get("value")){dj.byId("bk_highest_amt").set("value",dj.byId("bk_highest_amt").params["value"]);}if(dj.byId("bk_total_amt")&&dijit.byId("bk_total_amt").params&&dijit.byId("bk_total_amt").params["value"]&&dijit.byId("bk_total_amt").params["value"]!=dijit.byId("bk_total_amt").get("value")){dj.byId("bk_total_amt").set("value",dj.byId("bk_total_amt").params["value"]);}if(misys._config.nickname==="true"&&dj.byId("applicant_act_nickname_hidden")&&dj.byId("applicant_act_nickname_hidden").get("value")!==""){dj.byId("applicant_act_nickname").set("value",dj.byId("applicant_act_nickname_hidden").get("value"));}if(misys._config.nickname==="true"&&dj.byId("applicant_act_nickname")&&dj.byId("applicant_act_nickname").get("value")!==""){m.animate("fadeIn",d.byId("label"));d.style("label","display","inline-block");m.animate("fadeIn",d.byId("nickname"));d.style("nickname","display","inline");d.byId("nickname").innerHTML=dj.byId("applicant_act_nickname").get("value");}else{if(misys._config.option_for_app_date!=="SCRATCH"){m.animate("wipeOut",d.byId("applicant_act_nickname_row"));}}m.checkBeneficiaryNicknameOnFormLoad();if(dijit.byId("sub_product_code")&&dijit.byId("sub_product_code").get("value")!=""){dijit.byId("value_date").focus();}_4=m._config.openPending;if(m._config.openPending){_30(true);if(dj.byId("bk_type_hidden")){dj.byId("bk_type").set("value",dj.byId("bk_type_hidden").get("value"));}if(dj.byId("payroll_type_hidden")){dj.byId("payroll_type").set("value",dj.byId("payroll_type_hidden").get("value"));}}else{_30();}_2f();if(misys._config.isMultiBank){if(d.byId(_1)){misys.animate("fadeOut",d.byId(_1));}m.populateCustomerBanks(true);var _ac=dj.byId("customer_bank");var _ad=dj.byId("customer_bank_hidden");var _ae=dj.byId("entity");if(_ac&&_ad){_ac.set("value",_ad.get("value"));}if(_aa&&_aa.get("value")!==""){_ac.set("value",_aa.get("value"));_ad.set("value",_aa.get("value"));if(m._config.customerBankDetails&&m._config.customerBankDetails[_aa.get("value")]){_ab.set("value",m._config.customerBankDetails[_aa.get("value")][0].value);}else{_ab.set("value",_aa.get("value"));}}if(_ae&&_ae.get("value")===""&&_ac){_ac.set("disabled",true);_ac.set("required",false);}if(d.byId("display_customer_bank")){d.byId("display_customer_bank").innerHTML=_ab.get("value");}}if(_a8==="COLLE"||_a9==="COLLE"){d.style("payrolltype","display","none");m.animate("wipeIn",d.byId("display_to_account_row"));m.animate("wipeOut",d.byId("display_account_row"));m.animate("wipeOut",d.byId("display_payroll_row"));m.animate("wipeIn",d.byId("display_customer_bank_row"));d.byId("product_group").innerHTML=m.getLocalization("bulkCollectionProductGroup");d.style("collection","display","block");d.style("payrolltype","display","none");d.style("otherpayments","display","none");dj.byId("applicant_collection_act_name").set("required",false);}else{if(_a8==="PAYMT"||_a9==="PAYMT"){d.style("payrolltype","display","none");m.animate("wipeOut",d.byId("display_to_account_row"));m.animate("wipeIn",d.byId("display_account_row"));m.animate("wipeOut",d.byId("display_payroll_row"));m.animate("wipeIn",d.byId("display_customer_bank_row"));d.byId("product_group").innerHTML=m.getLocalization("bulkPaymentsProductGroup");d.style("collection","display","none");d.style("payrolltype","display","none");d.style("otherpayments","display","block");dj.byId("applicant_collection_act_name").set("required",false);}else{if(_a8==="PAYRL"||_a9==="PAYRL"){d.style("payrolltype","display","block");m.animate("wipeOut",d.byId("display_to_account_row"));m.animate("wipeIn",d.byId("display_account_row"));m.animate("wipeIn",d.byId("display_customer_bank_row"));d.byId("product_group").innerHTML=m.getLocalization("bulkPayrollProductGroup");d.style("collection","display","none");d.style("otherpayments","display","none");d.style("payrolltype","display","block");d.style("display_payroll_row","display","block");dj.byId("applicant_collection_act_name").set("required",false);_13(true);}else{d.style("payrolltype","display","none");if(dj.byId("applicant_img")){dj.byId("applicant_img").set("disabled",true);}m.animate("wipeOut",d.byId("display_to_account_row"));d.style("collection","display","none");d.style("otherpayments","display","none");d.style("payrolltype","display","none");d.style("display_payroll_row","display","none");}}}var _af=d.byId("content1"),_b0=d.byId("content2");if(dj.byId("applicant_act_no")&&dj.byId("applicant_act_no").get("value")===""){if(_af){d.style("content1","display","block");d.style("display_sub_product_code_row","display","none");}if(_b0){d.style("content2","display","none");}}else{if(_af){d.style("content1","display","none");}if(_b0){d.style("content2","display","block");}}if(d.byId("clearingCode_div")){d.style("clearingCode_div","display","none");if(dj.byId("clearing_code")){dj.byId("clearing_code").set("required",false);}}if(dj.byId("button_intrmdt_ok")){dj.byId("button_intrmdt_ok").set("disabled",true);}m.setCurrency(dj.byId("bk_total_amt_cur_code"),["bk_total_amt"]);m.setCurrency(dj.byId("bk_highest_amt_cur_code"),["bk_highest_amt"]);m.animate("wipeOut",d.byId("pab_checkbox_row"));var _b1=dj.byId("value_date");var _b2=dj.byId("appl_date");if(_b1&&_b1.get("value")&&_b2&&_b2.get("value")&&!m.compareDateFields(_b2,_b1)){var _b3=m.getLocalization("transferDateLessThanAppDateError",[_b1.get("displayedValue"),_b2.get("displayedValue")]);_b1.set("state","Error");dj.hideTooltip(_b1.domNode);dj.showTooltip(_b3,_b1.domNode,0);setTimeout(function(){dj.hideTooltip(_b1.domNode);},2000);}_1c();},beforeSaveValidations:function(){_5c();var _b4=dj.byId("entity");if(_b4&&_b4.get("value")===""){return false;}else{return true;}},submitBulkCommon:function(_b5){this.submitBulk(_b5);},submitBulk:function(_b6){_5c();_3f();var _b7=dj.byId("child_product_code").get("value");if(_b7!==""&&_b7==="FT"){if(!_3c()){misys.dialog.show("ERROR",m.getLocalization("accountStatusError"));return;}}if(dj.byId("return_comments")){dj.byId("return_comments").set("required",false);}if(!_b6()){misys.dialog.show("ERROR",m.getLocalization("mandatoryFieldsToSubmitError"));}else{if(dj.byId("record_number").get("value")<1){m.dialog.show("ERROR",m.getLocalization("atleastOneTransactionHasTobeAddedForBulk"));}else{if(!_5){m.dialog.show("ERROR",m.getLocalization("oneTransactionIsInvalid"));}else{var _b8=new d.Deferred();var _b9=new d.Deferred();var _ba=new d.DeferredList([_b8,_b9]);var _bb=m.xhrPost({url:misys.getServletURL("/screen/AjaxScreen/action/GetBulkBusinessDateAction"),sync:true,handleAs:"json",content:{transactiondata:m.formToXML({selector:"#fakeform1",xmlRoot:"bk_tnx_record"}),e2ee_plus_public_key:dj.byId("e2ee_plus_public_key")?dj.byId("e2ee_plus_public_key").get("value"):null,e2ee_plus_challenge:dj.byId("e2ee_plus_challenge")?dj.byId("e2ee_plus_challenge").get("value"):null,e2ee_server_random:dj.byId("e2ee_server_random")?dj.byId("e2ee_server_random").get("value"):null},load:function(_bc,_bd){var _be=_bc.valid;var _bf=_bc.requestedDate;var _c0=_bc.calculatedDate;var _c1=_bc.autoForwardEnabled;if(_be===false){m._config.onSubmitErrorMsg=_bc.errorMessage;_6(_c1);}else{m.submitBulkNoAutoForward("SUBMIT");}},customError:function(_c2,_c3){console.error("[misys.validation.common] Technical error while validating business days and cut-off time");console.error(_c2);status=false;m._config.onSubmitErrorMsg=m.getLocalization("technicalErrorWhileValidatingBusinessDays");m._config=m._config||{};dojo.mixin(m._config,{holidayCutOffEnabled:false});}});}}}}});})(dojo,dijit,misys);dojo.require("misys.client.binding.core.create_bk_client");}