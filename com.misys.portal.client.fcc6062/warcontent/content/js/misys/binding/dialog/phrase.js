/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.dialog.phrase"]){dojo._hasResource["misys.binding.dialog.phrase"]=true;dojo.provide("misys.binding.dialog.phrase");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.layout.ContentPane");dojo.require("dojo.data.ItemFileReadStore");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.editor.plugins.ProductFieldChoice");(function(d,dj,m){function _1(){var _2=dj.byId("popup_product_code").get("value"),_3=dj.byId("popup_category"),_4=m._config.productCategoryMap[_2];if(!misys._config.isModified){_3.set("value","");}if(_2!==""){if(_4){_3.store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_4}});_3.fetchProperties={sort:[{attribute:"value"}]};}else{_4=m._config.productCategoryMap["ALL"];_3.store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_4}});_3.fetchProperties={sort:[{attribute:"value"}]};}}};function _5(){var _6=dj.byId("popup_phrase_type").get("value"),_7=dj.byId("popup_product_code"),_8=m._config.phraseTypesProductMap[_6];if(!misys._config.isModified){_7.set("value","");}if(_8){_7.store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_8}});_7.fetchProperties={sort:[{attribute:"name"}]};}};function _9(_a){d.require("misys.report.definitions.report_all_candidates");d.require("misys.report.definitions.report_lc_phrase_candidate");initialiseProductArrays("lc");d.require("misys.report.definitions.report_si_phrase_candidate");initialiseProductArrays("si");};function _b(){var _c=dj.byId("popup_phrase_type");var _d=dj.byId("popup_product_code")?dj.byId("popup_product_code").get("value"):"";var _e=d.byId("static-text-editor");var _f=d.byId("rich-text-editor");if(_c&&_c.get("value")==="02"&&_d!==""){_9(_d);_10(_d+"Tnx","dynamic_text");m.animate("fadeOut",_e);m.animate("fadeIn",_f);dj.byId("static_text").set("required",false);}else{m.animate("fadeOut",_f);m.animate("fadeIn",_e);dj.byId("dynamic_text")?dj.byId("dynamic_text").set("required",false):"";}};function _10(_11,_12){var _13=dj.byId(_12);if(!_13){var _14=d.byId(_12);var _15=d.byId("rteContent").innerHTML;_13=new dj.Editor({id:_12,name:_12,rows:"13",cols:"40",maxSize:"300",plugins:[{name:"misys.editor.plugins.ProductFieldChoice",command:"misysEditorPluginsProductFieldChoice",product:_11}]},_14);_15=_15.replace(/&lt;/g,"<");_15=_15.replace(/&gt;/g,">");_15=_15.replace(/&amp;/g,"&");_15=_15.replace(/&quot;/g,"\"");_13.set("value",_15?_15:"");}};d.mixin(m.dialog,{bind:function(){m.setValidation("popup_abbv_name",m.validateCharactersExcludeSpace);m.setValidation("popup_description",m.validateBlackListChar);m.setValidation("static_text",m.validateBlackListChar);m.connect("popup_phrase_type","onChange",function(){_5();});m.connect("popup_product_code","onChange",_b);m.connect("popup_product_code","onChange",_1);},onFormLoad:function(){if(dj.byId("popup_phrase_type")&&dj.byId("popup_phrase_type").get("value")==="02"){var _16=d.byId("static-text-editor");var _17=d.byId("rich-text-editor");m.animate("fadeOut",_16);m.animate("fadeIn",_17);dj.byId("static_text").set("required",false);}_5();_1();},beforeSaveValidations:function(){m.setValidation("popup_abbv_name",m.validateCharactersExcludeSpace);m.setValidation("popup_description",m.validateBlackListChar);m.setValidation("static_text",m.validateBlackListChar);if((dj.byId("phrase_type")&&dj.byId("phrase_type").get("value")==="02"&&dj.byId("dynamic_text")&&dj.byId("dynamic_text").get("value")==="")){m._config.onSubmitErrorMsg=m.getLocalization("dynamicTextEmptyError");return false;}else{if(dj.byId("phrase_type")&&dj.byId("phrase_type").get("value")==="01"&&dj.byId("static_text")&&dj.byId("static_text").get("value")===""){m._config.onSubmitErrorMsg=m.getLocalization("dynamicTextEmptyError");return false;}else{return true;}}},beforeSubmitValidations:function(){m.setValidation("popup_abbv_name",m.validateCharactersExcludeSpace);m.setValidation("popup_description",m.validateBlackListChar);m.setValidation("static_text",m.validateBlackListChar);if((dj.byId("phrase_type")&&dj.byId("phrase_type").get("value")==="02"&&dj.byId("dynamic_text")&&dj.byId("dynamic_text").get("value")==="")){m._config.onSubmitErrorMsg=m.getLocalization("dynamicTextEmptyError");return false;}else{if(dj.byId("phrase_type")&&dj.byId("phrase_type").get("value")==="01"&&dj.byId("static_text")&&dj.byId("static_text").get("value")===""){m._config.onSubmitErrorMsg=m.getLocalization("dynamicTextEmptyError");return false;}else{return true;}}}});})(dojo,dijit,misys);dojo.require("misys.client.binding.dialog.phrase_client");}