/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.dialog.beneficiary"]){dojo._hasResource["misys.binding.dialog.beneficiary"]=true;dojo.provide("misys.binding.dialog.beneficiary");dojo.require("dijit.layout.TabContainer");(function(d,dj,m){m._config.onLoadShowBenExistingMsg=true;m._config.markPrtryIdFieldAsDisabled=false;function _1(_2,_3){var _4=dojo.byId("counterparty-products");if(_2){m.animate("fadeIn",_4);}else{m.animate("fadeOut",_4);}var _5=[];d.forEach(d.query("[id*='counterparty_permission_']").query("[id]"),function(_6){_5.push(_6.id);});m.toggleFields(_2,_5,null,_3);};function _7(_8){var _9=dj.byId("popup_prtry_id_type_flag");var _a=dj.byId("popup_prtry_id_type");var _b=_8;if(_9&&_a){if(_b){_a.set("required",false);_a.set("value","");}if(_a.get("value")){_9.set("checked",true);if(m._config.markPrtryIdFieldAsDisabled){_9.set("disabled",true);}else{_9.set("disabled",false);}}else{_9.set("checked",false);_9.set("disabled",false);}}};d.mixin(m.dialog,{bind:function(){m.connect("popup_abbv_name","onKeyPress",function(e){if(e.keyCode===32||e.charCode===32){dojo.stopEvent(e);}});m.connect("popup_abbv_name","onChange",function(e){var _c=this;var _d=this.get("value");var _e=dj.byId("popup_prtry_id_type_flag");var _f=dj.byId("popup_prtry_id_type");if(_e&&_f&&_d!=""){m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/CheckStaticBeneficiaryAction"),handleAs:"json",sync:true,content:{cpty_abbv_name:_d},load:function(_10){if(_10.items.prtryIdType){m._config.markPrtryIdFieldAsDisabled=_10.items.markAsDisabled;_f.set("value",_10.items.prtryIdType);if(_10.items.markAsDisabled){_f.set("disabled",true);_f.set("required",false);}else{_f.set("disabled",false);_f.set("required",true);}_7(false);if(m._config.onLoadShowBenExistingMsg){dj.showTooltip(m.getLocalization("beneficiaryAlreadyExist",[_d]),_c.domNode,0);setTimeout(function(){dj.hideTooltip(_c.domNode);},5000);}}else{if(_f.get("disabled")||_e.get("checked")){_f.set("value","");}_e.set("checked",false);_7(true);}}});}});m.connect("popup_prtry_id_type","onBlur",function(){var _11=this;var _12=_11.get("value");if(_11&&!_11.get("disabled")&&_12){var _13=dj.byId("popup_abbv_name");var _14=_13?_13.get("value"):"";var _15=dj.byId("popup_prtry_id_type_flag");var _16=dj.byId("popup_prtry_id_type");var _17=dj.byId("popup_prtry_id_type_separator");var _18=_17?_17.get("value"):"";var _19=_12.split(_18);var _1a=_19[0];var _1b=_19[1];var _1c=_12.length;var _1d=(_12.indexOf(_18)<1||_12.indexOf(_18)===_1c-1);var _1e=_19&&_19.length>2;if(_12&&(_1d||_1e)){_11.set("state","Error");dj.hideTooltip(_11.domNode);dj.showTooltip(m.getLocalization("invalidPrtryIdTypeFormat",[_18]),_11.domNode,0);setTimeout(function(){dj.hideTooltip(_11.domNode);},5000);}if(_1a&&_1a.length>35||_1b&&_1b.length>35){_11.set("state","Error");dj.hideTooltip(_11.domNode);dj.showTooltip(m.getLocalization("lengthTMAField"),_11.domNode,0);setTimeout(function(){dj.hideTooltip(_11.domNode);},5000);}if(_15&&_16&&_12!=""&&!_1d){m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/CheckStaticBeneficiaryAction"),handleAs:"json",sync:true,content:{cpty_abbv_name:_14,prtry_id_type:_12},load:function(_1f){if(_1f.items.isDuplicate){_11.set("value","");_11.set("state","Error");dj.hideTooltip(_11.domNode);dj.showTooltip(m.getLocalization("duplicatePrtryIdType"),_11.domNode,0);setTimeout(function(){dj.hideTooltip(_11.domNode);},5000);}}});}}});m.connect("popup_prtry_id_type_flag","onChange",function(){var _20=dj.byId("popup_prtry_id_type");var _21=d.byId("popup_prtry_id_type_div");if(this.get("checked")&&this.get("disabled")&&_20.get("value")){_20.set("disabled",true);_20.set("required",false);m.animate("fadeIn",_21);}else{if(this.get("checked")){_20.set("disabled",false);_20.set("required",true);m.animate("fadeIn",_21);}else{_20.set("required",false);if(!_20.get("disabled")){_20.set("value","");}_20.set("disabled",true);m.animate("fadeOut",_21);}}});m.setValidation("popup_phone",m.validatePhoneOrFax);m.setValidation("popup_fax",m.validatePhoneOrFax);m.setValidation("popup_telex",m.validatePhoneOrFax);m.setValidation("popup_email",m.validateEmailAddr);m.setValidation("popup_web_address",m.validateWebAddr);m.setValidation("popup_bei",m.validateBEIFormat);m.setValidation("popup_iso_code",m.validateBICFormat);m.setValidation("popup_country",m.validateCountry);m.setValidation("popup_name",m.validateSwiftAddressCharacters);m.setValidation("popup_address_line_1",m.validateSwiftAddressCharacters);m.setValidation("popup_address_line_2",m.validateSwiftAddressCharacters);m.setValidation("popup_dom",m.validateSwiftAddressCharacters);m.connect("popup_post_code","onBlur",function(){dj.byId("popup_swift_address_address_line_1").set("value",this.get("value"));});m.connect("popup_address_line_1","onBlur",function(){dj.byId("popup_address_line_1").set("value",this.get("value"));});m.connect("popup_access_opened","onClick",function(){m.toggleFields(this.get("checked"),["popup_notification_enabled"],null);dj.byId("popup_notification_enabled").onClick();});m.connect("popup_notification_enabled","onClick",function(){_1(this.get("checked"),false);});}});})(dojo,dijit,misys);dojo.require("misys.client.binding.dialog.beneficiary_client");}