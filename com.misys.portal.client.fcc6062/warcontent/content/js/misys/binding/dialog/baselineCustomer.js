/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.dialog.baselineCustomer"]){dojo._hasResource["misys.binding.dialog.baselineCustomer"]=true;dojo.provide("misys.binding.dialog.baselineCustomer");dojo.require("dijit.layout.TabContainer");(function(d,dj,m){function _1(_2,_3){var _4=dojo.byId("counterparty-products");if(_2){m.animate("fadeIn",_4);}else{m.animate("fadeOut",_4);}var _5=[];d.forEach(d.query("[id*='counterparty_permission_']").query("[id]"),function(_6){_5.push(_6.id);});m.toggleFields(_2,_5,null,_3);};function _7(_8){var _9=dj.byId("popup_prtry_id_type_flag");var _a=dj.byId("popup_prtry_id_type");var _b=_8;if(_9&&_a){if(_b){_a.set("required",false);_a.set("value","");}if(_a.get("value")){_9.set("checked",true);_9.set("readOnly",true);}else{_9.set("checked",false);_9.set("readOnly",false);}}};d.mixin(m.dialog,{bind:function(){m.setValidation("popup_abbv_name",m.validateCharactersExcludeSpace);m.connect("popup_abbv_name","onKeyPress",function(e){if(e.keyCode===32||e.charCode===32){dojo.stopEvent(e);}});m.connect("popup_abbv_name","onChange",function(e){var _c=this;var _d=this.get("value");var _e=dj.byId("popup_prtry_id_type_flag");var _f=dj.byId("popup_prtry_id_type");var _10=d.byId("popup_prtry_id_type_div");if(_e&&_f&&_d!=""){m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/CheckStaticBeneficiaryAction"),handleAs:"json",sync:true,content:{cpty_abbv_name:_d},load:function(_11){if(_11.items.prtryIdType){_f.set("value",_11.items.prtryIdType);_f.set("readOnly",true);_f.set("required",false);_7(false);dj.showTooltip(m.getLocalization("beneficiaryAlreadyExist",[_d]),_c.domNode,0);setTimeout(function(){dj.hideTooltip(_c.domNode);},5000);}else{if(_f.get("readOnly")){_f.set("value","");}_e.set("checked",false);_7(true);}}});}});m.connect("popup_prtry_id_type","onBlur",function(){var _12=this;if(_12&&!_12.get("readOnly")){var _13=dj.byId("popup_abbv_name");var _14=_13?_13.get("value"):"";var _15=_12.get("value");var _16=dj.byId("popup_prtry_id_type_flag");var _17=dj.byId("popup_prtry_id_type");var _18=d.byId("popup_prtry_id_type_div");var _19=dj.byId("popup_prtry_id_type_separator");var _1a=_19?_19.get("value"):"";var _1b=_15?_15.split(_1a):"";var _1c=_1b[0];var _1d=_1b[1];var _1e=_15.length;var _1f=(_15.indexOf(_1a)===0||_15.indexOf(_1a)===_1e-1||_15.indexOf(_1a)===-1);var _20=_1b&&_1b.length>2;if(_15&&(_1f||_20)){_12.set("state","Error");dj.hideTooltip(_12.domNode);dj.showTooltip(m.getLocalization("invalidPrtryIdTypeFormat",[_1a]),_12.domNode,0);setTimeout(function(){dj.hideTooltip(_12.domNode);},5000);}if(_1c&&_1c.length>35||_1d&&_1d.length>35){_12.set("state","Error");dj.hideTooltip(_12.domNode);dj.showTooltip(m.getLocalization("lengthTMAField"),_12.domNode,0);setTimeout(function(){dj.hideTooltip(_12.domNode);},5000);}if(_16&&_17&&_15!=""){m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/CheckStaticBeneficiaryAction"),handleAs:"json",sync:true,content:{cpty_abbv_name:_14,prtry_id_type:_15},load:function(_21){if(_21.items.isDuplicate){_12.set("value","");_12.set("state","Error");dj.hideTooltip(_12.domNode);dj.showTooltip(m.getLocalization("duplicatePrtryIdType"),_12.domNode,0);setTimeout(function(){dj.hideTooltip(_12.domNode);},5000);}}});}}});m.connect("popup_prtry_id_type_flag","onChange",function(){var _22=dj.byId("popup_prtry_id_type");var _23=d.byId("popup_prtry_id_type_div");if(this.get("checked")&&this.get("readOnly")&&_22.get("value")){_22.set("readOnly",true);_22.set("required",false);m.animate("fadeIn",_23);}else{if(this.get("checked")){_22.set("readOnly",false);_22.set("required",true);m.animate("fadeIn",_23);}else{_22.set("required",false);if(!_22.get("readOnly")){_22.set("value","");}_22.set("readOnly",true);m.animate("fadeOut",_23);}}});m.setValidation("popup_country",m.validateCountry);m.setValidation("popup_phone",m.validatePhoneOrFax);m.setValidation("popup_fax",m.validatePhoneOrFax);m.setValidation("popup_telex",m.validatePhoneOrFax);m.setValidation("popup_email",m.validateEmailAddr);m.setValidation("popup_web_address",m.validateWebAddr);m.setValidation("popup_bei",m.validateBEIFormat);m.setValidation("popup_iso_code",m.validateBICFormat);m.connect("popup_post_code","onBlur",function(){dj.byId("popup_swift_address_address_line_1").set("value",this.get("value"));});m.connect("popup_address_line_1","onBlur",function(){dj.byId("popup_address_line_1").set("value",this.get("value"));});m.connect("popup_access_opened","onClick",function(){m.toggleFields(this.get("checked"),["popup_notification_enabled"],null);dj.byId("popup_notification_enabled").onClick();});m.connect("popup_notification_enabled","onClick",function(){_1(this.get("checked"),false);});}});})(dojo,dijit,misys);dojo.require("misys.client.binding.dialog.baselineCustomer_client");}