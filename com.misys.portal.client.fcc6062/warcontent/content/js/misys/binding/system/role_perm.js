/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.system.role_perm"]){dojo._hasResource["misys.binding.system.role_perm"]=true;dojo.provide("misys.binding.system.role_perm");dojo.require("misys.form.MultiSelect");dojo.require("dijit.form.FilteringSelect");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.layout.ContentPane");dojo.require("misys.validation.common");dojo.require("misys.form.common");dojo.require("dojox.xml.DomParser");(function(d,dj,m){function _1(){var _2=dj.byId("roletype"),_3=d.byId("permission-details"),_4=dj.byId("permission_list"),_5=dj.byId("avail_list_nosend");if(d.style(_3,"position")==="absolute"){d.style(_3,"position","inherit");d.style(_3,"left",0);d.style(_3,"display","none");}if(_2&&_2.get("value")!=="01"){m.animate("fadeOut",_3,function(){_4.reset();_4.invertSelection();m.addMultiSelectItems(_5,_4);_5.reset();});}else{m.animate("fadeIn",_3);}};function _6(_7,_8){var _9=_7.getElementsByTagName(_8)[0],_a=(_9)?_9.childNodes[0]:"",_b=(_a)?_a.nodeValue.split(","):[],_c=["<existing_permissions>"];d.forEach(_b,function(_d){if(_d){_c.push("<permission_desc_record><permission>",_d,"</permission></permission_desc_record>");}});_c.push("</existing_permissions>");return _c.join("");};d.mixin(m,{bind:function(){m.connect("roletype","onChange",_1);m.connect("add","onClick",function(){m.addMultiSelectItems(dj.byId("permission_list"),dj.byId("avail_list_nosend"));});m.connect("remove","onClick",function(){m.addMultiSelectItems(dj.byId("avail_list_nosend"),dj.byId("permission_list"));});},onFormLoad:function(){_1();}});m._config=m._config||{};d.mixin(m._config,{xmlTransform:function(_e){var _f=dj.byId("permission_list"),_10="role",_11=m._config.xmlTagName,_12=_11?["<",_11,">"]:[],dom=dojox.xml.DomParser.parse(_e),_13=dj.byId("roletype").get("value");if(_f){_f.reset();_f.invertSelection();}_12.push("<",_10,">");_12.push(m.getDomNode(dom,"brch_code"));_12.push(m.getDomNode(dom,"name"));_12.push(m.getDomNode(dom,"role_id"));_12.push(m.getDomNode(dom,"role_description"));_12.push(m.getDomNode(dom,"roledest"));_12.push(m.getDomNode(dom,"roletype"));_12.push("</",_10,">");if(_13==="01"&&dom.getElementsByTagName("permission_list").length>0){_12.push(_6(dom,"permission_list"));}if(_11){_12.push("</",_11,">");}return _12.join("");}});})(dojo,dijit,misys);dojo.require("misys.client.binding.system.role_perm_client");}