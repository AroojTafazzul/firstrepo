/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.system.license"]){dojo._hasResource["misys.binding.system.license"]=true;dojo.provide("misys.binding.system.license");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.layout.ContentPane");dojo.require("dijit.form.FilteringSelect");dojo.require("misys.form.MultiSelect");dojo.require("dijit.Editor");dojo.require("dijit._editor._Plugin");dojo.require("dijit._editor.plugins.AlwaysShowToolbar");dojo.require("dijit._editor.plugins.FontChoice");dojo.require("dijit._editor.plugins.TextColor");dojo.require("dijit._editor.plugins.LinkDialog");dojo.require("dojox.editor.plugins.ToolbarLineBreak");dojo.require("misys.editor.plugins.ProductFieldChoice");dojo.require("misys.form.SimpleTextarea");dojo.require("dojo.data.ItemFileWriteStore");dojo.require("misys.grid.DataGrid");dojo.require("misys.widget.Dialog");dojo.require("misys.form.static_document");dojo.require("misys.system.widget.Customers");dojo.require("misys.system.widget.LicenseProducts");dojo.require("misys.report.widget.Column");dojo.require("misys.common");dojo.require("misys.form.common");dojo.require("misys.validation.common");(function(d,dj,m){function _1(){var _2=dj.byId("ls_type").get("value");if(_2==="02"){dj.byId("principal_label").set("value",m.getLocalization("exporter"));}else{if(_2==="01"){dj.byId("principal_label").set("value",m.getLocalization("applicant"));}else{if(_2==="03"){dj.byId("principal_label").set("value",m.getLocalization("payer"));}}}};function _3(){var _4=dj.byId("ls_type").get("value");if(_4==="02"){dj.byId("non_principal_label").set("value",m.getLocalization("consignee"));}else{if(_4==="01"){dj.byId("non_principal_label").set("value",m.getLocalization("beneficiary"));}else{if(_4==="03"){dj.byId("non_principal_label").set("value",m.getLocalization("payee"));}}}};function _5(){var _6=dj.byId("principal_override");var _7=dj.byId("principal_label");if(_6&&_7){if(_6.get("checked")){m.toggleRequired(_7,true);_7.set("disabled",false);}else{_1();m.toggleRequired(_7,false);_7.set("disabled",true);}}};function _8(){var _9=dj.byId("non_principal_override");var _a=dj.byId("non_principal_label");if(_9&&_a){if(_9.get("checked")){m.toggleRequired(_a,true);_a.set("disabled",false);}else{_3();m.toggleRequired(_a,false);_a.set("disabled",true);}}};function _b(){var _c=d.byId("customers-section");_c.style.display=(this.get("checked")?"none":"block");if(this.get("checked")){var _d=dj.byId("customers");if(_d){_d.clear();}}};function _e(){dj.byId("customerOkButton").set("disabled",true);var _f=["customer_abbv_name","customer_name"],_10=false,_11,_12;_10=d.every(_f,function(id){_11=dj.byId(id);if(_11){_12=_11.get("value");if(!_12||_11.state==="Error"){m.showTooltip(m.getLocalization("mandatoryFieldsError"),_11.domNode,["above","before"]);_11.state="Error";_11._setStateClass();dj.setWaiState(_11.focusNode,"invalid","true");return false;}}return true;});dj.byId("customerOkButton").set("disabled",false);if(!_10){return false;}else{dj.byId("customer-dialog-template").gridMultipleItemsWidget.updateData();dj.byId("customers").dialog.hide();return true;}};function _13(){var _14=dj.byId("product_code").get("value"),_15=(_14==="*")?"ALL":_14,_16=m._config.productTypeCodeList[_15];dj.byId("productOkButton").set("disabled",true);var _17,_18=false,_19,_1a;if(_16){_17=["product_code","sub_product_code","product_type_code"];}else{_17=["product_code","sub_product_code"];}_18=d.every(_17,function(id){_19=dj.byId(id);if(_19){_1a=_19.get("value");if(!_1a||_19.state==="Error"){m.showTooltip(m.getLocalization("mandatoryFieldsError"),_19.domNode,["above","before"]);_19.state="Error";_19._setStateClass();dj.setWaiState(_19.focusNode,"invalid","true");return false;}}return true;});dj.byId("productOkButton").set("disabled",false);if(!_18){return false;}else{dj.byId("ls-products-dialog-template").gridMultipleItemsWidget.updateData();dj.byId("products").dialog.hide();return true;}};function _1b(){var _1c=dj.byId("product_code").get("value"),_1d=dj.byId("product_type_code"),_1e=(_1c==="*")?"ALL":_1c,_1f=m._config.productTypeCodeList[_1e],_20=dj.byId("product_type_code_hidden").get("value");if(misys._config.isModified){_1d.set("value","");}if(_1e!==""){if(_1f){_1d.store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_1f}});_1d.fetchProperties={sort:[{attribute:"value"}]};m.animate("wipeIn",d.byId("productTypeDiv"));m.toggleFields(true,null,["product_type_code"]);}else{m.animate("wipeOut",d.byId("productTypeDiv"));_1d.store=null;}if(_20!==""){_1d.set("displayedValue",_20);}}};function _21(){var _22=dj.byId("product_code").get("value"),_23=dj.byId("sub_product_code"),_24=(_22==="*")?"ALL":_22,_25=m._config.subProductsCollection[_24],_26=dj.byId("sub_product_code_hidden").get("value");if(!misys._config.isModified){_23.set("value","");}if(_25){_23.store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_25}});_23.fetchProperties={sort:[{attribute:"name"}]};}if(_26!==""){_23.set("displayedValue",_26);}};function _27(){var _28=dj.byId("ls_type").get("value"),_29=dj.byId("product_code"),_2a=m._config.lsTypesProductMapping[_28],_2b=dj.byId("product_code_hidden").get("value");_29.set("value","");if(_2a){_29.store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_2a}});_29.fetchProperties={sort:[{attribute:"name"}]};}if(_2b!==""){_29.set("displayedValue",_2b);}};d.mixin(m,{bind:function(){m.setValidation("customer_abbv_name",m.validateCharacters);m.connect("customerOkButton","onMouseUp",_e);m.connect("ls_type","onChange",_1);m.connect("ls_type","onChange",_3);m.connect("addCustomerButton","onClick",function(){dj.byId("customer_abbv_name").set("readOnly",true);dj.byId("customer_name").set("readOnly",true);});m.connect("principal_override","onClick",_5);m.connect("non_principal_override","onClick",_8);m.connect("ls_type","onChange",function(){if(dj.byId("ls_type").get("value")!==""){dj.byId("addProductsButton").set("disabled",false);}else{dj.byId("addProductsButton").set("disabled",true);}_27();var _2c=dj.byId("products");if(_2c){_2c.clear();}});m.connect("product_code","onChange",function(){_21();if(dj.byId("product_type_code")){_1b();}else{m.animate("wipeOut",d.byId("productTypeDiv"));}});m.connect("addProductsButton","onClick",function(){if(dj.byId("product_code").get("value")===""){m.animate("wipeIn",d.byId("productTypeDiv"));dj.byId("product_type_code").store=null;dj.byId("sub_product_code").store=null;if(dj.byId("product_type_code_hidden")){dj.byId("product_type_code_hidden").set("value","");}if(dj.byId("sub_product_code_hidden")){dj.byId("sub_product_code_hidden").set("value","");}}});m.connect("productOkButton","onClick",_13);m.connect("product_code","onChange",function(){dj.byId("product_code_hidden").set("value",dj.byId("product_code").get("displayedValue"));});m.connect("sub_product_code","onChange",function(){dj.byId("sub_product_code_hidden").set("value",dj.byId("sub_product_code").get("displayedValue"));});m.connect("product_type_code","onChange",function(){dj.byId("product_type_code_hidden").set("value",dj.byId("product_type_code").get("displayedValue"));});m.connect("ls_name","onBlur",m.checkLicenseNameExists);},onFormLoad:function(){if(dj.byId("principal_override")&&dj.byId("principal_override").get("checked")){dj.byId("principal_label").set("disabled",false);}else{dj.byId("principal_label").set("disabled",true);}if(dj.byId("non_principal_override")&&dj.byId("non_principal_override").get("checked")){dj.byId("non_principal_label").set("disabled",false);}else{dj.byId("non_principal_label").set("disabled",true);}if(dj.byId("ls_type")&&dj.byId("ls_type").get("value")!==""){dj.byId("addProductsButton").set("disabled",false);}else{dj.byId("addProductsButton").set("disabled",true);}if(dj.byId("ls_operation")&&dj.byId("ls_operation").get("value")==="MODIFY_FEATURES"){dj.byId("ls_type").set("disabled",true);dj.byId("ls_name").set("disabled",true);}else{dj.byId("multi_cur").set("checked",true);dj.byId("allow_overdraw").set("checked",true);dj.byId("allow_multi_ls").set("checked",true);}_27();_21();_1b();}});d.ready(function(){dojo.parser.parse("edit");m.connect("valid_for_all","onClick",_b);var _2d=dj.byId("valid_for_all");if(_2d&&_2d.get("checked")){_2d.onClick();}});})(dojo,dijit,misys);dojo.require("misys.client.binding.system.license_client");}