/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.system.customer_reference"]){dojo._hasResource["misys.binding.system.customer_reference"]=true;dojo.provide("misys.binding.system.customer_reference");dojo.require("dojo.parser");dojo.require("dijit.form.Form");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.Button");dojo.require("misys.widget.Dialog");dojo.require("dijit.Tooltip");dojo.require("misys.form.addons");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("dojo._base.json");dojo.require("dojox.xml.DomParser");(function(d,dj,m){function _1(){var _2=dj.byId("customerReference_details_reference_nosend").get("value");if(_2){m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/CustomerDetailsSearchAction"),handleAs:"json",content:{customer_reference:_2},load:_3});}};function _3(_4){var _5=d.byId("checkField"),_6="";d.forEach(_4,function(_7){d.forEach(_7,function(_8,_9){if(_9===0){_6+="<span>"+_8+"</span>";}else{if(_8){_6+="<br>"+_8;}}});_6+="<br><br>";});_5.innerHTML=_6;_a();if(_6!=="<span>No Customer Details Found</span><br><br>"){_5.setAttribute("display","inline-block");}};function _a(){if(dj.byId("customerDetailsEnabled").get("value")==="true"){if(d.byId("checkField").innerHTML!=="<span>No Customer Details Found</span><br><br>"&&d.byId("checkField").innerHTML!==""&&d.byId("customerReference_details_description_nosend").value!==""&&d.byId("customerReference_details_reference_nosend").value!==""){dj.byId("addCustomerReferenceButton").set("disabled",false);}else{dj.byId("addCustomerReferenceButton").set("disabled",true);}}};function _b(){_c();_a();};function _d(){_e();if(dj.byId("customerDetailsEnabled").get("value")==="true"){dj.byId("addCustomerReferenceButton").set("disabled",true);}misys.hideTransactionAddonsDialog("customerReference");};function _c(){var _f=d.byId("checkField");if(_f){_f.innerHTML="";}};function _e(){_c();dj.byId("customerReference_details_description_nosend").set("value","");dj.byId("customerReference_details_description_nosend").blur;dj.byId("customerReference_details_reference_nosend").set("value","");dj.byId("customerReference_details_reference_nosend").blur;};d.mixin(m,{bind:function(){m.connect("checkCustomerReferenceButton","onClick",_1);m.connect("cancelCustomerReferenceButton","onClick",_d);m.connect("customerReference_details_reference_nosend","onBlur",_a);m.connect("customerReference_details_reference_nosend","onChange",_b);m.connect("customerReference_details_description_nosend","onBlur",_a);m.connect("customerReference_details_description_nosend","onChange",_a);m.setValidation("abbv_name",m.validateCharacters);},addCustomerReference:function(_10){if(misys.addTransactionAddon(_10)){_e();}else{if(dj.byId("customerDetailsEnabled").get("value")==="true"){dj.byId("addCustomerReferenceButton").set("disabled",true);}}},showCustomerReferenceDialog:function(_11,_12){if(dj.byId("customerDetailsEnabled").get("value")==="true"){if(!_12){d.query("#customerReferenceDialog .field").forEach(function(_13){d.style(_13,"display","block");});dj.byId("addCustomerReferenceButton").set("disabled",false);}else{dj.byId("addCustomerReferenceButton").set("disabled",true);}_e();}m.showTransactionAddonsDialog(_11);}});m._config=m._config||{};d.mixin(m._config,{xmlTransform:function(xml){var _14=m._config.xmlTagName,_15=_14?["<",_14,">"]:[],_16=[],dom=dojox.xml.DomParser.parse(xml),_17=dom.documentElement,_18="";for(var i=0,len=_17.childNodes.length;i<len;i++){_18=_17.childNodes[i];if(_18.nodeName&&_18.nodeName=="bank_abbv_name"){_16=(_18.childNodes[0])?_18.childNodes[0].nodeValue.split(","):[];d.forEach(_16,function(_19){if(_19){_15.push("<",_18.nodeName,">");_15.push(_19);_15.push("</",_18.nodeName,">");}});}else{_15.push("<",_18.nodeName,">");if(_18.childNodes[0]){_15.push(_18.childNodes[0].nodeValue);}_15.push("</",_18.nodeName,">");}}_15.push("</",_14,">");return _15.join("");}});})(dojo,dijit,misys);dojo.require("misys.client.binding.system.customer_reference_client");}