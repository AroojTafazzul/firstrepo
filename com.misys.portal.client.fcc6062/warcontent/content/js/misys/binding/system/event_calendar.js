/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.system.event_calendar"]){dojo._hasResource["misys.binding.system.event_calendar"]=true;dojo.provide("misys.binding.system.event_calendar");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.layout.ContentPane");dojo.require("dojo.data.ItemFileReadStore");dojo.require("misys.form.SimpleTextarea");dojo.require("dijit.form.DateTextBox");dojo.require("dijit.form.FilteringSelect");(function(d,dj,m){function _1(_2){if(_2.get("type")==="hidden"){return d.date.locale.format(m.localizeDate(_2),{selector:"date"});}return _2.get("displayedValue");};function _3(){if(!this.get("value")){return true;}var _4="";var _5=dj.byId("start_date");var _6=dj.byId("end_date");if(!m.compareDateFields(this,_6)){_4=m.getLocalization("startDateGreaterThanEndDateError",[_1(_5),_1(_6)]);_5.set("state","Error");dijit.hideTooltip(_5.domNode);dijit.showTooltip(_4,_5.domNode,0);return false;}return true;};function _7(){if(!this.get("value")){return true;}var _8="";var _9=dj.byId("start_date");var _a=dj.byId("end_date");if(!m.compareDateFields(_9,this)){_8=m.getLocalization("endDateLessThanStartDateError",[_1(_a),_1(_9)]);_a.set("state","Error");dijit.hideTooltip(_a.domNode);dijit.showTooltip(_8,_a.domNode,0);return false;}return true;};function _b(){var _c=dijit.byId("start_date").get("displayedValue");var _d=dijit.byId("end_date").get("displayedValue");var _e=dijit.byId("day_of_week").get("value");var _f=dijit.byId("day_of_month").get("value");var _10=false;var _11=true;var _12=dijit.byId("day_of_month");if(dijit.byId("date_recursive_type_2")&&dijit.byId("date_recursive_type_2").checked){_12=dijit.byId("day_of_week");_10=true;}if(_c!==""&&_d!==""&&(_e!==""||_f!=="")){m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/ValidateRecurringCalendarDateEvent"),handleAs:"json",sync:true,content:{startDate:_c,endDate:_d,dayOfWeek:_e,dayOfMonth:_f,isWeekly:_10},load:function(_13,_14){if(_13.valid===false){_12.invalidMessage=m.getLocalization("invalidEventDate",[_12.displayedValue]);_11=false;}}});}return _11;};d.mixin(m,{bind:function(){var _15=-1,_16="";m.connect("end_date","onBlur",_7);m.connect("start_date","onBlur",_3);m.setValidation("day_of_week",_b);m.setValidation("day_of_month",_b);if(dj.byId("date_type_1")){m.connect("date_type_1","onChange",function(){m.toggleFields(this.get("checked"),["evt_date"],["evt_date"]);if(dj.byId("date_type_1").get("checked")){m.animate("fadeOut",d.byId("recursive_event_div"));dj.byId("date_recursive_type").reset();}if(dj.byId("date_type_2").get("checked")&&dj.byId("date_recursive_type_3").get("checked")){dj.byId("day_of_month").set("disabled",false);dj.byId("day_of_month").set("required",true);}else{dj.byId("day_of_month").set("required",false);dj.byId("day_of_month").set("disabled",true);}});}if(dj.byId("date_recursive_type_1")){m.connect("date_recursive_type_1","onChange",function(){if(dj.byId("date_recursive_type_1").get("checked")){dj.byId("date_recursive_type").set("value","01");}});}if(dj.byId("date_recursive_type_2")){m.connect("date_recursive_type_2","onChange",function(){m.toggleFields(this.get("checked"),["day_of_week"],["day_of_week"]);if(dj.byId("date_recursive_type_2").get("checked")){dj.byId("date_recursive_type").set("value","02");}});}if(dj.byId("date_recursive_type_3")){m.connect("date_recursive_type_3","onChange",function(){m.toggleFields(this.get("checked"),["day_of_month"],["day_of_month"]);if(dj.byId("date_recursive_type_3").get("checked")){dj.byId("date_recursive_type").set("value","03");}if(this.get("checked")){dj.byId("day_of_month").set("disabled",false);dj.byId("day_of_month").set("required",true);}else{dj.byId("day_of_month").set("required",false);dj.byId("day_of_month").set("disabled",true);}});}if(dj.byId("date_type_2")){m.connect("date_type_2","onChange",function(){m.toggleFields(this.get("checked"),["start_date","end_date","date_recursive_type_1","date_recursive_type_2","date_recursive_type_3"],["start_date","end_date","date_recursive_type_1","date_recursive_type_2","date_recursive_type_3"]);_16=function(){if(dj.byId("date_type_2").get("checked")&&dj.byId("date_recursive_type_3").get("checked")){dj.byId("day_of_month").set("disabled",false);dj.byId("day_of_month").set("required",true);m.toggleFields((dj.byId("date_type_2").get("checked")&&dj.byId("date_recursive_type_3").get("checked")),["day_of_month"],["day_of_month"]);}else{dj.byId("day_of_month").set("required",false);dj.byId("day_of_month").set("disabled",true);}};_15=500;setTimeout(_16,_15);if(dj.byId("date_type_2").get("checked")){m.animate("fadeIn",d.byId("recursive_event_div"));}});}},onFormLoad:function(){var _17=-1,_18="";if(dj.byId("date_type_1")){m.toggleFields(dj.byId("date_type_1").get("checked"),["evt_date"],["evt_date"]);var _19=new Date();_19.setDate(_19.getDate());dj.byId("evt_date").constraints.min=_19;}if(dj.byId("date_recursive_type_2")){m.toggleFields(dj.byId("date_recursive_type_2").get("checked"),["day_of_week"],["day_of_week"]);}if(dj.byId("date_type_2")){m.toggleFields(dj.byId("date_type_2").get("checked"),["start_date","end_date","date_recursive_type_1","date_recursive_type_2","date_recursive_type_3"],["start_date","end_date","date_recursive_type_1","date_recursive_type_2","date_recursive_type_3"]);_19=new Date();_19.setDate(_19.getDate());dj.byId("start_date").constraints.min=_19;dj.byId("end_date").constraints.min=_19;}if((dj.byId("date_type_2")&&dj.byId("date_recursive_type_3"))){_18=function(){m.toggleFields((dj.byId("date_type_2").get("checked")&&dj.byId("date_recursive_type_3").get("checked")),["day_of_month"],["day_of_month"]);};_17=500;setTimeout(_18,_17);}if(dj.byId("date_type_2")){if(dj.byId("date_type_2").get("checked")){m.animate("fadeIn",d.byId("recursive_event_div"));}else{m.animate("fadeOut",d.byId("recursive_event_div"));}}if(dj.byId("event_id")&&dj.byId("event_id").get("value")!==""){m.animate("fadeOut",d.byId("date_type_2_row"));m.animate("fadeOut",d.byId("date_type_1_radio_div"));}else{if(dj.byId("occurrence_id")&&dj.byId("occurrence_id").get("value")!==""){m.animate("fadeOut",d.byId("date_type_1_row"));m.animate("fadeOut",d.byId("date_type_2_radio_div"));}}},beforeSubmit:function(){if(dj.byId("date_type_1")){dj.byId("evt_date").focus();}if(dj.byId("date_type_2")){dj.byId("start_date").focus();dj.byId("end_date").focus();}_b();}});})(dojo,dijit,misys);dojo.require("misys.client.binding.system.event_calendar_client");}