/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.system.entity_mc"]){dojo._hasResource["misys.binding.system.entity_mc"]=true;dojo.provide("misys.binding.system.entity_mc");dojo.require("dijit.form.FilteringSelect");dojo.require("dijit.layout.TabContainer");dojo.require("misys.form.MultiSelect");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("misys.editor.plugins.ProductFieldChoice");dojo.require("misys.form.SimpleTextarea");dojo.require("dojo.data.ItemFileWriteStore");dojo.require("misys.grid.DataGrid");dojo.require("misys.grid.EnhancedGrid");dojo.require("misys.widget.Dialog");dojo.require("dojox.xml.DomParser");dojo.require("dojox.collections.ArrayList");dojo.require("dojox.grid.DataGrid");dojo.require("dojox.grid.EnhancedGrid");dojo.require("dojo.data.ItemFileReadStore");dojo.require("dojox.grid.enhanced.plugins.Pagination");(function(d,dj,m){d.mixin(m._config,{initReAuthParams:function(){var _1={productCode:"EM",subProductCode:"",transactionTypeCode:"01",entity:"",currency:"",amount:"",es_field1:"",es_field2:""};return _1;}});var _2="entity_list",_3="avail_list",_4=d.byId("entity-roles"),_5,_6,_7,_8,_9,_a,_b,_c=[],_d=[];var _e=[];var _f=false;function _10(_11){d.forEach(m._config.attachedBanks,function(_12){var _13=dj.byId("Customer_references_count_"+_12).get("value");if(dj.byId("Customer_references_count_"+_12)){var _14="";for(var i=1;i<=_13;i++){_14=dj.byId("custref_"+_12+"_"+i).get("value");if(m._config.entityReferencesMapping[_14]){var _15=m._config.entityReferencesMapping[_14];var _16=dj.byId("ref_enabled_"+_12+"_"+i);if(_16&&_15){_16.set("checked",true);_d.push(_14);}}}var url=[m.getServletURL("/screen/AjaxScreen/action/GetCustomeraccountsbyReferences")];url.push("?companyid=",_a,"&custrefs=",encodeURIComponent(_d));_28(url.join(""));if(_11){setTimeout(function(){_17(true);},2000);}else{setTimeout(function(){_17();},2000);}}});};function _18(_19){var _1a=[];d.forEach(m._config.attachedBanks,function(_1b){if(misys._config.entityReferencesBanks.indexOf(_1b)!==-1){var _1c="";var _1d=dj.byId("Customer_references_count_"+_1b).get("value");var _1e=[];for(var i=1;i<=_1d;i++){_1c=dj.byId("custref_"+_1b+"_"+i).get("value");if(m._config.entityReferencesMapping[_1c]){var _1f=m._config.entityReferencesMapping[_1c];if(dj.byId("ref_enabled_"+_1b+"_"+i)&&_1f){dj.byId("ref_enabled_"+_1b+"_"+i).set("checked",true);}var _20=_1b+"="+_1c;_1e.push(_20);}}_1e=_1e.join(",");_1a.push(_1e);}});_1a=_1a.join(",");var url=[m.getServletURL("/screen/AjaxScreen/action/GetCustomeraccountsbyReferencesMultiBank")];url.push("?companyid=",_a,"&bankcustrefarray=",encodeURIComponent(_1a));_28(url.join(""));if(_19){setTimeout(function(){_17(true);},2000);}else{setTimeout(function(){_17();},2000);}};function _21(dom,_22){var _23=dom.getElementsByTagName(_22)[0],_24=(_23)?_23.childNodes[0]:"",_25=(_24)?_24.nodeValue.split(","):[],_26=["<existing_roles>"];dojo.forEach(dojo.query("option",dijit.byId(_22).domNode),function(_27){_26.push("<roles_desc_record><role>",_27.value,"</role></roles_desc_record>");});_26.push("</existing_roles>");return _26.join("");};function _28(url){if(dj.byId("accounts_Grid")){var _29={identifier:"accounts_Id"};var _2a=new dojo.data.ItemFileWriteStore({jsId:"accountsList",url:url,data:_29});dj.byId("accounts_Grid").setStore(_2a);}};function _17(_2b){if(dj.byId("charging_account")){var _2c=[];dj.byId("accounts_Grid").store.fetch({query:{},onComplete:dojo.hitch(this,function(_2d,_2e){dojo.forEach(_2d,function(_2f){var _30=_2f["acc_num"];var ccy=_2f["ccy"];var _31=_2f["owner_type"]+"";var _32=_2f["bank_name"];if(!_f){_e.push(_2f);}if(_31!=="10"){_2c.push({name:_30+" ("+_32+")",value:_30,ccy:ccy,bank_name:_32});}},this);dj.byId("charging_account").store=new dojo.data.ItemFileWriteStore({data:{identifier:"value",label:"name",items:_2c}});dj.byId("charging_account").store.save();})});if((_2b&&dj.byId("charging_account_hidden"))||(_c.indexOf(dj.byId("charging_account").get("value"))>-1)){if(_c.length>0&&_c.indexOf(dj.byId("charging_account_hidden").get("value"))>-1){dj.byId("charging_account").set("value","");}else{dj.byId("charging_account").set("value",dj.byId("charging_account_hidden").get("value"));_c=[];}}}};function _33(_34,_35){m.xhrPost({url:misys.getServletURL("/screen/AjaxScreen/action/GetCustomeraccountsbyReferences"),handleAs:"json",sync:true,content:{Custrefs:_34,CompanyId:dj.byId("company_id").get("value"),bankname:_35},load:function(_36){dojo.forEach(_36.items,function(_37){_e.push(_37);});_39();},error:function(_38){console.error("[Couldnot Get Accounts  for customer] "+dj.byId("company_id").get("value"));}});};function _39(){if(dj.byId("accounts_Grid")){var _3a={identifier:"acc_num",label:"bank_name",items:_e};var _3b=new dojo.data.ItemFileWriteStore({data:_3a});dj.byId("accounts_Grid").setStore(_3b);}};function _3c(){if(dj.byId("subscription_package")){var _3d=dj.byId("subscription_package");m.xhrPost({url:misys.getServletURL("/screen/AjaxScreen/action/GetSubscriptionPackageDetails"),handleAs:"json",sync:true,content:{packageIdValue:_3d.get("value")},load:function(_3e){var _3f=_3e.packageDetails;dj.byId("stnd_charge_cur_code").setValue(_3f[0]);dj.byId("stnd_charge_amt").setValue(_3f[1]);_5=_3f[2];_9=_3f[3];_41();},error:function(_40){console.error("[Couldnot Get Subscription Package Details] "+_3d.get("value"));}});}};function _41(){if(dj.byId("charging_account")){charginAccCCy="";stdChargeCCy=dj.byId("stnd_charge_cur_code").get("value");chargingAccNo=dj.byId("charging_account").value;if(dj.byId("accounts-grid")){dj.byId("accounts-grid").store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(this,function(_42,_43){dojo.forEach(_42,function(_44){var _45=_44["account_number"][0];var ccy=_44["ccy"][0];if(_45===chargingAccNo){charginAccCCy=ccy;}},this);})});}if(charginAccCCy!==stdChargeCCy){dj.byId("special_charge_cur_code").set("required",true);dj.byId("special_charge_amt").set("required",true);}else{dj.byId("special_charge_cur_code").set("required",false);dj.byId("special_charge_amt").set("required",false);}}};function _46(_47){while(_47.hasChildNodes()){_47.removeChild(_47.lastChild);}};function _48(){var _49=dj.byId("entity_avail_list_nosend"),_4a=dj.byId("entity_role_list");_6=new dojox.collections.ArrayList();_7=new dojox.collections.ArrayList();_8=new dojox.collections.ArrayList();dojo.query("option",_49.containerNode).forEach(function(n){_6.add(n);_7.add(n);});dojo.query("option",_4a.containerNode).forEach(function(n){_6.add(n);_8.add(n);});};function _4b(){var _4c=dj.byId("entity_avail_list_nosend"),_4d=_4e();_46(dojo.byId("entity_avail_list_nosend"));_6.forEach(function(_4f){if(!_4d||!_4d.contains(_4f.value)){_4c.containerNode.appendChild(_4f);}},_6);};function _50(){var _51=dj.byId("entity_avail_list_nosend"),_52=dj.byId("entity_role_list"),_53=_4e();_46(dojo.byId("entity_avail_list_nosend"));_46(dojo.byId("entity_role_list"));_7.forEach(function(_54){if(!_53||!_53.contains(_54.value)){_51.containerNode.appendChild(_54);}},_7);_8.forEach(function(_55){if(!_53||!_53.contains(_55.value)){_52.containerNode.appendChild(_55);}},_8);};function _56(){var _57=[];if(dj.byId("company_type").get("value")==="02"||dj.byId("company_type").get("value")==="03"){_57=[{field:"acc_num",name:m.getLocalization("accountNumber"),width:"13%",noresize:true},{field:"bank_name",name:m.getLocalization("bankName"),width:"12%",noresize:true},{field:"displayed_owner_type",name:m.getLocalization("accountOwnerType"),width:"7%",noresize:true},{field:"acc_type",name:m.getLocalization("accountType"),width:"6%",noresize:true},{field:"acc_prod_typ",name:m.getLocalization("accountProductType"),width:"8%",noresize:true},{field:"ccy",name:m.getLocalization("accountCcy"),width:"5%",noresize:true},{field:"desc",name:m.getLocalization("accountDescription"),width:"10%",noresize:true},{field:"cust_acc_typ",name:m.getLocalization("custAccountType"),width:"7%",noresize:true},{field:"bank_id",name:m.getLocalization("bankId"),width:"5%",noresize:true},{field:"brch_no",name:m.getLocalization("branchNo"),width:"5%",noresize:true},{field:"nra",name:m.getLocalization("nra"),width:"5%",noresize:true},{field:"customerreference",name:m.getLocalization("custReference"),width:"10%",noresize:true},{field:"actv_flag",name:m.getLocalization("active"),width:"5%",noresize:true},{name:"Id",field:"accounts_Id",headerStyles:"display:none",cellStyles:"display:none",noresize:true}];}else{_57=[{field:"acc_num",name:m.getLocalization("accountNumber"),width:"13%",noresize:true},{field:"displayed_owner_type",name:m.getLocalization("accountOwnerType"),width:"7%",noresize:true},{field:"acc_type",name:m.getLocalization("accountType"),width:"6%",noresize:true},{field:"acc_prod_typ",name:m.getLocalization("accountProductType"),width:"8%",noresize:true},{field:"ccy",name:m.getLocalization("accountCcy"),width:"5%",noresize:true},{field:"desc",name:m.getLocalization("accountDescription"),width:"10%",noresize:true},{field:"cust_acc_typ",name:m.getLocalization("custAccountType"),width:"7%",noresize:true},{field:"bank_id",name:m.getLocalization("bankId"),width:"5%",noresize:true},{field:"brch_no",name:m.getLocalization("branchNo"),width:"5%",noresize:true},{field:"nra",name:m.getLocalization("nra"),width:"5%",noresize:true},{field:"customerreference",name:m.getLocalization("custReference"),width:"10%",noresize:true},{field:"actv_flag",name:m.getLocalization("active"),width:"5%",noresize:true},{name:"Id",field:"accounts_Id",headerStyles:"display:none",cellStyles:"display:none",noresize:true}];}if(d.byId("accounts_div")){var _58=new dojox.grid.DataGrid({query:{id:"*"},id:"accounts_Grid",structure:_57,autoHeight:true,noDataMessage:m.getLocalization("noAccountsFound"),selectionMode:"none",rowsPerPage:20,selectable:"true"},document.createElement("div"));d.byId("accounts_div").appendChild(_58.domNode);_58.startup();}};function _59(){var _5a=[];if(dj.byId("company_type").get("value")==="02"||dj.byId("company_type").get("value")==="03"){_5a=[{field:"acc_num",name:m.getLocalization("accountNumber"),width:"13%",noresize:true},{field:"bank_name",name:m.getLocalization("bankName"),width:"12%",noresize:true},{field:"displayed_owner_type",name:m.getLocalization("accountOwnerType"),width:"7%",noresize:true},{field:"acc_type",name:m.getLocalization("accountType"),width:"6%",noresize:true},{field:"acc_prod_typ",name:m.getLocalization("accountProductType"),width:"8%",noresize:true},{field:"ccy",name:m.getLocalization("accountCcy"),width:"5%",noresize:true},{field:"desc",name:m.getLocalization("accountDescription"),width:"10%",noresize:true},{field:"cust_acc_typ",name:m.getLocalization("custAccountType"),width:"7%",noresize:true},{field:"bank_id",name:m.getLocalization("bankId"),width:"5%",noresize:true},{field:"brch_no",name:m.getLocalization("branchNo"),width:"5%",noresize:true},{field:"nra",name:m.getLocalization("nra"),width:"5%",noresize:true},{field:"customerreference",name:m.getLocalization("custReference"),width:"10%",noresize:true},{field:"actv_flag",name:m.getLocalization("active"),width:"5%",noresize:true},{name:"Id",field:"accounts_Id",headerStyles:"display:none",cellStyles:"display:none",noresize:true}];}else{_5a=[{field:"acc_num",name:m.getLocalization("accountNumber"),width:"13%",noresize:true},{field:"displayed_owner_type",name:m.getLocalization("accountOwnerType"),width:"7%",noresize:true},{field:"acc_type",name:m.getLocalization("accountType"),width:"6%",noresize:true},{field:"acc_prod_typ",name:m.getLocalization("accountProductType"),width:"8%",noresize:true},{field:"ccy",name:m.getLocalization("accountCcy"),width:"5%",noresize:true},{field:"desc",name:m.getLocalization("accountDescription"),width:"10%",noresize:true},{field:"cust_acc_typ",name:m.getLocalization("custAccountType"),width:"7%",noresize:true},{field:"bank_id",name:m.getLocalization("bankId"),width:"5%",noresize:true},{field:"brch_no",name:m.getLocalization("branchNo"),width:"5%",noresize:true},{field:"nra",name:m.getLocalization("nra"),width:"5%",noresize:true},{field:"customerreference",name:m.getLocalization("custReference"),width:"10%",noresize:true},{field:"actv_flag",name:m.getLocalization("active"),width:"5%",noresize:true},{name:"Id",field:"accounts_Id",headerStyles:"display:none",cellStyles:"display:none",noresize:true}];}if(d.byId("accounts_div")){var _5b=new dojox.grid.EnhancedGrid({id:"accounts_Grid",structure:_5a,autoHeight:true,rowsPerPage:10,plugins:{pagination:{pageSizes:["10","25","50","100"],description:true,sizeSwitch:true,pageStepper:true,gotoButton:true,maxPageStep:7,position:"top"}}},document.createElement("div"));dojo.byId("accounts_div").appendChild(_5b.domNode);_5b.startup();}};function _4e(){if(dj.byId("subscription_package")){var _5c=new dojox.collections.ArrayList();if(_5c){for(var i=0;i<_9.length;i++){_5c.add(_9[i]);}return _5c;}}};function _5d(){var _5e=this.get("value");if(_5e!==""&&misys._config.entityArray&&misys._config.entityArray!==""){var _5f=misys._config.entityArray.split(",");if(_5f.indexOf(_5e)>=0){this.invalidMessage=misys.getLocalization("duplicateEntityAbbvName");this.set("state","Error");dj.hideTooltip(this.domNode);dj.showTooltip(misys.getLocalization("duplicateEntityAbbvName"),this.domNode,0);return false;}}return true;};function _60(){if(dj.byId("entity_address_line_1")){dj.byId("entity_address_line_1").set("readOnly",false);}if(dj.byId("entity_address_line_2")){dj.byId("entity_address_line_2").set("readOnly",false);}if(dj.byId("entity_address_line_3")){dj.byId("entity_address_line_3").set("readOnly",false);}if(dj.byId("entity_address_line_4")){dj.byId("entity_address_line_4").set("readOnly",false);}dj.byId("entity_alternative_address_line_1").set("readOnly",false);dj.byId("entity_alternative_address_line_2").set("readOnly",false);dj.byId("entity_alternative_address_line_3").set("readOnly",false);dj.byId("entity_alternative_address_line_4").set("readOnly",false);};d.mixin(m,{bind:function(){m.setValidation("bei",m.validateBEIFormat);m.setValidation("abbv_name",m.validateCharacters);m.setValidation("country_legalid",m.validateCountry);m.connect("add","onClick",function(){m.addMultiSelectItems(dijit.byId("entity_list"),dijit.byId("avail_list"));});m.connect("remove","onClick",function(){m.addMultiSelectItems(dijit.byId("avail_list"),dijit.byId("entity_list"));});if(dj.byId("charging_account")){m.connect("charging_account","onChange",_41);}m.connect("subscription_package","onChange",function(){_46(dojo.byId("entity_role_list"));_3c();_4b();});m.connect("enable_additional_role","onChange",function(){if(dj.byId("enable_additional_role").get("checked")){m.animate("fadeIn",_4);}else{m.animate("fadeOut",_4);}});m.connect("personal","onChange",function(){if(!dj.byId("personal").get("checked")){dj.byId("legal_id_type").set("value","");dj.byId("legal_id_no").set("value","");dj.byId("country_legalid").set("value","");}});m.connect("abbv_name","onChange",function(){m.checkEntityIdExists();});m.setValidation("account_ccy_cur_code",m.validateCurrency);m.setValidation("special_charge_cur_code",m.validateCurrency);m.setValidation("stnd_charge_cur_code",m.validateCurrency);m.connect("subscription_package","onMouseOver",function(){var _61=dj.byId("subscription_package");if(_5){m.showTooltip(_5,_61.domNode,10);}});d.forEach(m._config.attachedBanks,function(_62,idx){if(dj.byId("Customer_references_count_"+_62)){for(var k=1;k<=dj.byId("Customer_references_count_"+_62).value;k++){if(dj.byId("ref_enabled_"+_62+"_"+k)){m.connect("ref_enabled_"+_62+"_"+k,"onClick",function(){if(!this.get("checked")){var _63=m.getLocalization("entityCustomerReferenceWarning");m.dialog.show("CUSTOM-NO-CANCEL",_63,"Entity Reference Warning","","","","","");}});}}}});m.setValidation("email",m.validateEmailAddr);m.connect("special_charge_cur_code","onChange",function(){m.setCurrency(this,["special_charge_amt"]);var _64=this.get("value"),_65=dj.byId("charging_account").get("value"),_66;if(dj.byId("accounts-grid")&&dj.byId("accounts-grid").store){dj.byId("accounts-grid").store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(this,function(_67,_68){dojo.forEach(_67,function(_69){var _6a=_69["account_number"];var ccy=_69["ccy"];if(_6a===_65){_66=ccy[0];}},this);})});if(_66!==_64){var _6b=m.getLocalization("invalidSpecialChargeCurrency"),_6c=dj.byId("special_charge_cur_code");_6c.focus();_6c.set("state","Error");dijit.hideTooltip(_6c.domNode);dijit.showTooltip(_6b,_6c.domNode,0);}}});m.connect("stnd_charge_cur_code","onChange",function(){m.setCurrency(this,["stnd_charge_amt"]);});m.connect("account_product_type","onChange",function(){var _6d=dj.byId("bank_account_type").get("value"),_6e=dj.byId("account_product_type").get("value"),_6f="",_70=null,_71="99";if(_6d!==""&&_6e!==""){_6f=_6d+"-"+_6e;}if(m._config.bankAccountTypeMapping[_6f]){_70=m._config.bankAccountTypeMapping[_6f].accountDescription;}if(_70!==null&&_70!==""){dj.byId("account_desc").set("value",_70);}else{var _72=m.getLocalization("invalidAccountTypeProductType"),_73=dj.byId("account_desc");_73.state="Error";_73._setStateClass();dijit.setWaiState(_73.focusNode,"invalid","true");dijit.showTooltip(_72,_73.domNode,0);dj.byId("account_desc").set("value","");}if(m._config.accountTypeCodeMapping[_6f]){_71=m._config.accountTypeCodeMapping[_6f].accountTypeCode;}dj.byId("account_type").set("value",_71);});m.setValidation("country_legalid",m.validateCountry);m.setValidation("entity_country",m.validateCountry);var _74=dj.byId("total_value_added_services");if(_74){for(var i=1;i<=_74.get("value");i++){(function(_75){m.setValidation("service_stnd_charge_"+_75+"_cur_code",m.validateCurrency);m.setValidation("service_special_chge_"+_75+"_cur_code",m.validateCurrency);m.connect("service_stnd_charge_"+_75+"_cur_code","onChange",function(){m.setCurrency(this,["service_stnd_amt_"+_75]);});m.connect("service_special_chge_"+_75+"_cur_code","onChange",function(){m.setCurrency(this,["service_special_amt_"+_75]);});})(i);}}m.setValidation("abbv_name",m.validateCharactersExcludeSpace);m.connect("abbv_name","onKeyPress",function(e){if(e.keyCode===32||e.charCode===32){dojo.stopEvent(e);}});if(dj.byId("CompanyId")){_a=dj.byId("CompanyId").get("value");}d.forEach(m._config.attachedBanks,function(_76,idx){if(dj.byId("Customer_references_count_"+_76)){var _77=dj.byId("Customer_references_count_"+_76).get("value");var _78="";for(var cnt=1;cnt<=_77;cnt++){(function(idx){m.connect("ref_enabled_"+_76+"_"+idx,"onClick",function(){if(dj.byId("company_type").get("value")==="02"||dj.byId("company_type").get("value")==="03"){if(dj.byId("ref_enabled_"+_76+"_"+idx).get("checked")){if(d.byId("accounts_div")){d.byId("accounts_div").style.display="block";}_f=true;_78=dj.byId("custref_"+_76+"_"+idx).get("value");_d.push(_78);var _79=_76;_33(_d,_79);_d=[];setTimeout(function(){_17();},2000);}else{if(dj.byId("custref_"+_76+"_"+idx)){var _7a=dj.byId("custref_"+_76+"_"+idx).get("value");_e=_e.filter(function(_7b){if(_7b.customerreference[0]===_7a&&_7b.bank_name[0]===_76){_c.push(_7b.acc_num[0]);_f=true;return false;}else{_f=true;return true;}});_39();setTimeout(function(){_17();},2000);}}}else{if(dj.byId("ref_enabled_"+_76+"_"+idx).get("checked")){if(d.byId("accounts_div")){d.byId("accounts_div").style.display="block";}_78=dj.byId("custref_"+_76+"_"+idx).get("value");_d.push(_78);var url=[m.getServletURL("/screen/AjaxScreen/action/GetCustomeraccountsbyReferences")];url.push("?companyid=",_a,"&custrefs=",encodeURIComponent(_d));_28(url.join(""));setTimeout(function(){_17();},2000);}else{var _7c=dj.byId("custref_"+_76+"_"+idx).get("value");for(var j=0;j<_d.length;j++){if(_d[j]===_7c){_d.splice(j,1);}}var _7d=[m.getServletURL("/screen/AjaxScreen/action/GetCustomeraccountsbyReferences")];_7d.push("?companyid=",_a,"&custrefs=",encodeURIComponent(_d));_28(_7d.join(""));setTimeout(function(){_17();},2000);}}});})(cnt);}}});},onFormLoad:function(){if(dj.byId("charging_account")){_60();}var _7e=dj.byId("total_value_added_services");if(_7e){for(var i=1;i<=_7e.get("value");i++){m.setCurrency(dj.byId("service_stnd_charge_"+i+"_cur_code"),["service_stnd_amt_"+i]);m.setCurrency(dj.byId("service_special_chge_"+i+"_cur_code"),["service_special_amt_"+i]);}}m.setCurrency(dj.byId("stnd_charge_cur_code"),["stnd_charge_amt"]);m.setCurrency(dj.byId("special_charge_cur_code"),["special_charge_amt"]);_48();_3c();_50();if(dj.byId("Curr_mode")){_b=dj.byId("Curr_mode").get("value");}if(_b==="NEW"){if(d.byId("accounts_div")){d.byId("accounts_div").style.display="none";}}var _7f=true;var _80=dj.byId("company_type");_59();if(_80.get("value")==="01"){_10(_7f);}if(_80.get("value")!=="01"){_18(_7f);}}});m._config=m._config||{};d.mixin(m._config,{xmlTransform:function(xml){var _81=[dj.byId("entity_list"),dj.byId("avail_list")],_82=xml.indexOf("<"+_2+">"),_83=xml.indexOf("<"+_3+">"),_84=(_82!==-1)?xml.substring(_82+_2.length+2,xml.indexOf("</"+_2+">")).split(","):[],_85=(_83!==-1)?xml.substring(_83+_3.length+2,xml.indexOf("</"+_3+">")).split(","):[],_86=[],_87=dj.byId("total_value_added_services").value,dom=dojox.xml.DomParser.parse(xml);_86.push("<entity>");if(xml.indexOf("<"+"entity"+">")!==-1){_86.push(xml.substring(xml.indexOf("<"+"entity"+">")+8,xml.indexOf("</"+"entity"+">")));}for(var i=1;i<=_87;i++){if(dj.byId("select_service_"+i)&&dj.byId("select_service_"+i).get("checked")){_86.push("<value_added_services_"+i+">");_86.push(m.getDomNode(dom,"sevice_name_"+i));_86.push(m.getDomNode(dom,"service_std_chge_ccy_"+i));_86.push(m.getDomNode(dom,"service_stnd_charge_"+i));_86.push(m.getDomNode(dom,"service_chge_"+i+"_cur_code"));_86.push(m.getDomNode(dom,"service_special_charge_"+i));_86.push(m.getDomNode(dom,"service_special_charge_expiry_"+i));_86.push(m.getDomNode(dom,"service_subscription_waive_"+i));_86.push(m.getDomNode(dom,"service_waive_expiry_date"+i));_86.push(m.getDomNode(dom,"service_local_tax_"+i));_86.push("</value_added_services_"+i+">");}}d.forEach(m._config.attachedBanks,function(_88,idx){if(dj.byId("Customer_references_count_"+_88)){for(var k=1;k<=dj.byId("Customer_references_count_"+_88).value;k++){if(dj.byId("ref_enabled_"+_88+"_"+k)&&dj.byId("ref_enabled_"+_88+"_"+k).get("checked")){_86.push("<references>");_86.push("<bankabbvname>");_86.push(_88);_86.push("</bankabbvname>");_86.push("<bankid>");_86.push(dj.byId("bank_id_"+_88).get("value"));_86.push("</bankid>");_86.push("<reference>");var _89=dj.byId("custref_"+_88+"_"+k).get("value");var ref=_89.replace(/&/gi,"&amp;");_86.push(ref);_86.push("</reference>");_86.push("<description>");var _8a=dj.byId("custdesc_"+_88+"_"+k).get("value");var _8b=_8a.replace(/&/gi,"&amp;");_86.push(_8b);_86.push("</description>");_86.push("</references>");}}}});if(dj.byId("enable_additional_role")&&dj.byId("enable_additional_role").get("checked")&&dom.getElementsByTagName("entity_role_list").length>0){_86.push(_21(dom,"entity_role_list"));}_86.push("</entity>");return _86.join("");}});d.mixin(m,{getCIFDetails:function(){var _8c=dijit.byId("legal_id_type").getValue(),_8d=dijit.byId("legal_id_no").getValue(),_8e=dijit.byId("country_legalid").getValue();if(_8c===""){dijit.byId("legal_id_type").set("state","Error");}if(_8d===""){dijit.byId("legal_id_no").set("state","Error");}if(_8e===""){dijit.byId("country_legalid").set("state","Error");}},fncValidateAccountPopup:function(){dj.byId("accountOkButton").set("disabled",true);var _8f=["account_number","account_product_type","cust_account_type","bank_id","brch_no","account_desc"];var _90=dojo.every(_8f,function(id){var _91=dj.byId(id);if(_91){var _92=_91.get("value");if(_92===""||_91.state==="Error"){misys.showTooltip(misys.getLocalization("mandatoryFieldsError"),_91.domNode,["above","before"]);_91.state="Error";_91._setStateClass();dijit.setWaiState(_91.focusNode,"invalid","true");return false;}}return true;});dj.byId("accountOkButton").set("disabled",false);if(!_90){return false;}else{dj.byId("account-dialog-template").gridMultipleItemsWidget.updateData();dj.byId("accounts").dialog.hide();return true;}},toggleReferenceSection:function(_93,dir){var _94=d.byId("customer_bank_down_"+_93);var _95=d.byId("customer_bank_up_"+_93);if(dir==="down"&&d.style(_93,"display")==="none"){misys.animate("wipeIn",_93);d.style(_94,"display","none");d.style(_95,"display","inline");}else{if(dir==="up"&&d.style(_93,"display")!=="none"){misys.animate("wipeOut",_93);d.style(_95,"display","none");d.style(_94,"display","inline");}}}});d.ready(function(){d.require("misys.system.widget.Accounts");d.require("misys.system.widget.Account");});})(dojo,dijit,misys);dojo.require("misys.client.binding.system.entity_mc_client");}