/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.system.role_perm_mc"]){dojo._hasResource["misys.binding.system.role_perm_mc"]=true;dojo.provide("misys.binding.system.role_perm_mc");dojo.require("misys.form.MultiSelect");dojo.require("dijit.form.FilteringSelect");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("misys.form.SimpleTextarea");dojo.require("dijit.layout.ContentPane");dojo.require("misys.validation.common");dojo.require("misys.form.common");dojo.require("dojox.xml.DomParser");(function(d,dj,m){var _1,_2;function _3(){var _4=dj.byId("roletype");if(_4){if(this.get("value")==="04"){_4.set("value","");_4.store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_1}});}else{_4.store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_2}});}}};function _5(){var _6=dj.byId("roletype"),_7=d.byId("permission-details"),_8=dj.byId("permission_list"),_9=dj.byId("avail_list_nosend");if(d.style(_7,"position")==="absolute"){d.style(_7,"position","inherit");d.style(_7,"left",0);d.style(_7,"display","none");}if(_6&&_6.get("value")!=="01"){m.animate("fadeOut",_7,function(){_8.reset();_8.invertSelection();m.addMultiSelectItems(_9,_8);_9.reset();});}else{m.animate("fadeIn",_7);}};function _a(_b,_c){var _d=_b.getElementsByTagName(_c)[0],_e=(_d)?_d.childNodes[0]:"",_f=(_e)?_e.nodeValue.split(","):[],_10=["<existing_permissions>"];dojo.forEach(dojo.query("option",dijit.byId(_c).domNode),function(_11){_10.push("<permission_desc_record><permission>",_11.value,"</permission></permission_desc_record>");});_10.push("</existing_permissions>");return _10.join("");};d.mixin(m,{bind:function(){m.connect("roletype","onChange",_5);m.connect("roledest","onChange",_3);m.connect("add","onClick",function(){m.addMultiSelectItems(dj.byId("permission_list"),dj.byId("avail_list_nosend"));});m.connect("remove","onClick",function(){m.addMultiSelectItems(dj.byId("avail_list_nosend"),dj.byId("permission_list"));});m.setValidation("name",m.validateIllegalCharsInRolesCreation);m.setValidation("role_description",m.validateIllegalCharsInRolesCreation);},validateIllegalCharsInRolesCreation:function(){var _12="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-()/'  ";var _13;var _14=d.every(this.get("value"),function(_15){_13=_15;return (_12.indexOf(_15)<0)?false:true;});if(!_14){this.invalidMessage=m.getLocalization("illegalCharError",[_13]);}return _14;},onFormLoad:function(){_1=[];_2=[];_1.push({"name":m.getLocalization("role"),"value":"01"});_2.push({"name":m.getLocalization("role"),"value":"01"});_2.push({"name":m.getLocalization("authLevel"),"value":"02"});_5();},beforeSaveValidations:function(){var _16=true;var _17=dj.byId("name");if(_17&&_17.get("value")==""){_16=false;m._config.onSubmitErrorMsg=m.getLocalization("blankRoleCode");}return _16;},beforeSubmitValidations:function(){var _18=true;var _19=dj.byId("roletype");var _1a=dj.byId("roledest");if(_1a&&"S"+_1a.get("value")!=="S"&&_1a.get("value")==="04"&&_19&&"S"+_19.get("value")!=="S"&&_19.get("value")==="02"){m._config.onSubmitErrorMsg=m.getLocalization("invalidAuthorisationRole",[_19.get("displayedValue"),_1a.get("displayedValue")]);_18=false;}return _18;}});m._config=m._config||{};d.mixin(m._config,{xmlTransform:function(xml){var _1b=dj.byId("permission_list"),_1c="role",_1d="",_1e=m._config.xmlTagName,_1f=_1e?["<",_1e,">"]:[],dom=dojox.xml.DomParser.parse(xml),_20="";if(dj.byId("roletype")){_20=dj.byId("roletype").get("value");}if(dijit.byId("return_comments")){_1d=dijit.byId("return_comments").get("value");}_1f.push("<",_1c,">");_1f.push(m.getDomNode(dom,"brch_code"));_1f.push(m.getDomNode(dom,"name"));_1f.push(m.getDomNode(dom,"role_id"));_1f.push(m.getDomNode(dom,"role_description"));_1f.push(m.getDomNode(dom,"roledest"));_1f.push(m.getDomNode(dom,"roletype"));_1f.push("<return_comments>",_1d,"</return_comments>");_1f.push("</",_1c,">");if(_20==="01"&&dom.getElementsByTagName("permission_list").length>0){_1f.push(_a(dom,"permission_list"));}if(_1e){_1f.push("</",_1e,">");}return _1f.join("");}});})(dojo,dijit,misys);dojo.require("misys.client.binding.system.role_perm_mc_client");}