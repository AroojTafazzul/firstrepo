/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.system.company_mc"]){dojo._hasResource["misys.binding.system.company_mc"]=true;dojo.provide("misys.binding.system.company_mc");dojo.require("dojo.data.ItemFileReadStore");dojo.require("dijit.form.FilteringSelect");dojo.require("dijit.layout.TabContainer");dojo.require("misys.validation.login");dojo.require("misys.validation.password");dojo.require("misys.form.common");dojo.require("misys.form.addons");dojo.require("misys.validation.common");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("misys.form.SimpleTextarea");dojo.require("dijit.layout.ContentPane");dojo.require("misys.form.MultiSelect");dojo.require("dojox.xml.DomParser");dojo.require("dojox.xml.parser");(function(d,dj,m){var _1=true;function _2(_3,_4,_5,_6){var _7;if(dj.byId("owner_id").get("value")==="2"){_7={"items":[]};}else{_7={"identifier":"id","items":[]};}var _8=new dojo.data.ItemFileWriteStore({data:_7});var _9=dj.byId("default_reference");var _a=dj.byId("customer_reference");_a.store=null;d.forEach(m._config.availBanks,function(_b,_c){var _d=[],_e=[];var _f="customerReference_"+_b+"-master-table";var _10="customerReference_"+_b+"_row_";var _11=[];var _12=dojo.byId(_f);if(_12){dojo.query(" #"+_f+" > tbody > tr").forEach(function(_13,_14){var _15=dojo.attr(_13,"id");if(_15&&_15.indexOf(_10)!==-1){if(dojo.query(" #"+_f+" > tbody > tr#"+_15+" > td:first-child > div")[0]){var _16=dojox.html.entities.decode(dojo.query(" #"+_f+" > tbody > tr#"+_15+" > td:first-child > div")[0].innerHTML);if(!_3||(_3&&_16!==_3)){_d.push(_16);_e.push(_16);}}}});}for(var j=0;j<_d.length;j++){if((_e[j]&&_e[j]!=="")&&(_d[j]&&_d[j]!=="")){_8.newItem({"id":_e[j],"name":_d[j]});_11.push({"value":_e[j],"name":_d[j]});}}misys._config.custRefPerBank[_b]=_11;});_a.store=_8;if(_9){_9.store=_8;}if(_8&&_9){if((!_5&&_3)||(_5&&_3&&dj.byId("default_reference")&&_5==="delete")){if(_3===dj.byId("default_reference").get("value")){_9.set("displayedValue","");}}if(_8._arrayOfTopLevelItems.length===0){_9.set("displayedValue","");}}if(_4&&dj.byId("default_reference_hidden")&&_9){dj.byId("default_reference").set("value",dj.byId("default_reference_hidden").get("value"));}_17();};function _18(_19,_1a,_1b){if(m._config.isBankGroupLogin){_1c(_19,_1a,_1b);}else{_17(_19,_1a);}if(_19==="delete"){_2(_1a,null,_19,_1b);}else{_2();}};function _1d(){if(dj.byId("bank_abbv_name")&&m._config.accountTypesPerBank&&dj.byId("bank_account_type")){var _1e=dj.byId("bank_abbv_name").get("value"),_1f=dj.byId("bank_account_type"),_20=m._config.accountTypesPerBank[_1e];if(!misys._config.isOpenDialog){_1f.set("value","");_1f.store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:{}}});}if(_20){_1f.store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_20}});_1f.fetchProperties={sort:[{attribute:"name"}]};}}};function _21(){if(dj.byId("bank_abbv_name")&&m._config.customerAccountTypesPerBank&&dj.byId("cust_account_type")){var _22=dj.byId("bank_abbv_name").get("value"),_23=dj.byId("cust_account_type"),_24=m._config.customerAccountTypesPerBank[_22];if(!misys._config.isOpenDialog){_23.set("value","");_23.store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:{}}});}if(_24){_23.store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_24}});_23.fetchProperties={sort:[{attribute:"name"}]};}}};function _25(){if(dj.byId("bank_abbv_name")&&m._config.productTypesPerBank&&dj.byId("account_product_type")){var _26=dj.byId("bank_abbv_name").get("value"),_27=dj.byId("account_product_type"),_28=m._config.productTypesPerBank[_26];if(!misys._config.isOpenDialog){_27.set("value","");_27.store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:{}}});}if(_28){_27.store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_28}});_27.fetchProperties={sort:[{attribute:"name"}]};}}};function _29(){if(dj.byId("bank_abbv_name")&&misys._config.custRefPerBank&&dj.byId("customer_reference")){var _2a=dj.byId("bank_abbv_name").get("value"),_2b=dj.byId("customer_reference"),_2c=m._config.custRefPerBank[_2a];if(!misys._config.isOpenDialog){_2b.set("value","");_2b.store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:{}}});}if(_2c){_2b.store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_2c}});_2b.fetchProperties={sort:[{attribute:"name"}]};}}};function _2d(_2e,_2f){var _30=dj.byId("accounts-grid"),_31;if(_30){_31=_30.store;}if(_2e&&_2f&&_31){var _32=_31._arrayOfTopLevelItems.length;_31.fetch({query:{store_id:"*"},onComplete:function(_33,_34){dojo.forEach(_33,function(_35){if(_35.customer_reference[0]===_2e){_35.customer_reference[0]=_2f;_31.save(_35);}});if(_30){_30._refresh();}}});}};function _36(i){var _37=true;var _38="customer_reference_";var _39="nosend";var _3a="_details_back_office_";var _3b=dj.byId("duplicate_across_banks")?dj.byId("duplicate_across_banks").get("value"):"false";var _3c,_3d,_3e;var _3f=dj.byId("bank_name_abbv").get("value");var _40=dj.byId("company_id").get("value");var _41=m._config.currentAddonId;if(i===0){var str="customerReference_"+_3f+"_details_reference_"+_39;_3e=dj.byId(_38+_3f+"_details_reference_"+_41);}else{str="customerReference_"+_3f+_3a+i+"_"+_39;_3e=dj.byId(_38+_3f+_3a+i+"_"+_41);}_3c=dj.byId(str);var _42=_3e?_3e.get("value"):undefined;if(_3c){_3d=_3c.get("value");}else{_3d=undefined;}if(_42!==undefined||_3d!==undefined){var _43=(_42!==_3d);condition1=_43&&_3d!==undefined&&_44(_3d,_40,i,_43,_3f,_37);condition2=!_43&&_42!=undefined&&_44(_42,_40,i,_43,_3f,_37);}if(condition1||condition2){displayMessage=misys.getLocalization("DuplicateReferenceWarning");dj.hideTooltip(_3c.domNode);m.showTooltip(displayMessage,_3c.domNode,0,1000);}};function _44(_45,_46,_47,_48,_49,_4a){var _4b=false;var _4c="customer_reference_";var _4d="_details_back_office_";var _4e=dj.byId("duplicate_across_banks")?dj.byId("duplicate_across_banks").get("value"):"false";var _4f,_50,_51,_52,_53;if(_4e==="true"){if(_48){_52="customerReference_"+_49+"_row_";_53="customerReference_"+_49+"-master-table";_4f=dojo.byId(_53);_50=_4f?_4f.rows.length:0;for(var i=0;i<_50;i++){if(_47===0){_51=dj.byId(_4c+_49+"_details_reference_"+i);}else{_51=dj.byId(_4c+_49+_4d+_47+"_"+i);}if(_45&&_51&&_51.get("value").toUpperCase()===_45.toUpperCase()){_4b=true;}}}}else{d.forEach(m._config.availBanks,function(_54,idx){_52="customerReference_"+_54+"_row_";_53="customerReference_"+_54+"-master-table";_4f=dojo.byId(_53);_50=_4f?_4f.rows.length:0;var _55=false;if(_4f&&_45){if(!_48&&_54===_49){_55=true;}if(_4f&&!_55){for(var i=0;i<_50;i++){if(_47===0){_51=dj.byId(_4c+_54+"_details_reference_"+i);}else{_51=dj.byId(_4c+_54+_4d+_47+"_"+i);}if(_45&&_51&&_51.get("value").toUpperCase()===_45.toUpperCase()){_4b=true;}}}}});}if(!_4b){m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/ValidateDuplicateCustomerReference"),sync:true,handleAs:"json",content:{CUSTOMER_REFERENCE:_45,BANK_ID:_46,INDEX:_47,boType:misys._config.backOfficeConfig[_47],bank:_49,COMPANY_ID:dijit.byId("company_id").get("value"),FOR_WARNING_MESSAGE:_4a},load:function(_56,_57){_4b=_56.responseFlag;},error:function(_58,_59){console.error("[misys.grid._base] isDuplicateReferenceAdding error",_58);}});}return _4b;};function _5a(_5b,_5c){var _5d,_5e,_5f=false;_5d=dj.byId("accounts-grid");if(_5d){_5e=_5d.store;}if(_5b&&_5e){var _60=_5d.gridMultipleItemsWidget.dialog.storeId;var _61=_5e._arrayOfTopLevelItems.length;_5e.fetch({query:{store_id:"*"},onComplete:function(_62,_63){dojo.forEach(_62,function(_64){if(_64.account_number[0]===_5b&&_64.owner_type[0]===_5c){if(_64.store_id[0]!==_60){_5f=true;}}});}});}return _5f;};function _17(_65,_66){var _67;var _68;var _69=dj.byId("accounts-grid");var _6a=dj.byId("charge_account");if(_69){_67=_69.store;}if(_6a){_68=_6a.store;}if(_66&&_67){var _6b=_67._arrayOfTopLevelItems.length;if("delete"===_65&&_6a&&_68){var _6c=_68._arrayOfTopLevelItems.length;var _6d=_68._arrayOfTopLevelItems;var j=0;for(var i=0;i<_6c;i++){if(_67._arrayOfTopLevelItems[i].customer_reference[0]===_66){var k=i-j;if(_6d[k].name[0]===_67._arrayOfTopLevelItems[i].account_number[0]){_68.deleteItem(_6d[k]);j=j+1;}}}if(_68._arrayOfTopLevelItems.length===0){dj.byId("charge_account").set("value","");}else{dj.byId("charge_account").set("value",_68._arrayOfTopLevelItems[0].name[0]);}}_67.fetch({query:{store_id:"*"},onComplete:function(_6e,_6f){dojo.forEach(_6e,function(_70){if(_70.customer_reference[0]===_66){_67.deleteItem(_70);}});if(_67){_67.save();}}});}};function _1c(_71,_72,_73){var _74;var _75=dj.byId("accounts-grid");if(_75){_74=_75.store;}if(_72&&_74){var _76=_74._arrayOfTopLevelItems.length;_74.fetch({query:{store_id:"*"},onComplete:function(_77,_78){dojo.forEach(_77,function(_79){if(_79.bank_abbv_name[0]===_73&&_79.customer_reference[0]===_72){_74.deleteItem(_79);}});if(_74){_74.save();}}});}};function _7a(_7b,_7c){var _7d=_7b||"";var _7e="customerReference_"+_7b+"_details_back_office_"+_7c+"_nosend";var _7f=dj.byId(_7e);var _80=_7f?_7f.get("value"):"";var _81=(_7f&&_7f.get("state")==="Error")?true:false;var _82=_7b;var _83=new RegExp("^[0-9]{1,11}$");if(_81){return;}if(_80.length!==0){if((misys._config.backOfficeConfig[_7c]==="TMA"||misys._config.backOfficeConfig[_7c]==="LBO")?true:_83.test(_80)){m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/CustomerDetailsSearchAction"),handleAs:"json",content:{customer_reference:_80,boType:misys._config.backOfficeConfig[_7c],bank:_7b},load:function(_84,_85){_a8(_84,_7d,_7e);},error:function(_86,_87){console.error(_86);}});}else{dj.byId("customerReference_"+_7b+"_details_back_office_"+_7c+"_nosend").set("value","");var _88=misys.getLocalization("numericCustId");var _89=dj.byId("customerReference_"+_7b+"_details_back_office_"+_7c+"_nosend");_89.focus();_89.set("state","Error");dijit.showTooltip(_88,_89.domNode,0);_8a(_7b);}}if((misys._config.backOfficeConfig[_7c]!=="TMA"&&misys._config.backOfficeConfig[_7c]!=="LBO")&&(_80.length>10)){dj.byId("customerReference_"+_7b+"_details_back_office_"+_7c+"_nosend").set("value","");_88=misys.getLocalization("lengthTreasuryCustomerField");_89=dj.byId("customerReference_"+_7b+"_details_back_office_"+_7c+"_nosend");_89.focus();_89.set("state","Error");dijit.showTooltip(_88,_89.domNode,0);}if(_80.length===0){dj.byId("customerReference_"+_7b+"_details_back_office_"+_7c+"_nosend").set("value","");_88=misys.getLocalization("emptyField");_89=dj.byId("customerReference_"+_7b+"_details_back_office_"+_7c+"_nosend");_89.focus();_89.set("state","Error");dijit.showTooltip(_88,_89.domNode,0);_7d=_7d===""?"":"_"+_7d;var _8b=d.byId("check_details"+_7d);if(_8b){_8b.innerHTML="";}}};function _8c(){var _8d=dj.byId("attachment_max_upload_size");if(_8d){if(_8d.get("value")<0){return false;}var _8e=_8d.get("value")*1048576;var _8f=parseInt(dj.byId("upload_size_max").get("value")/1048576,10);if(_8e>dj.byId("upload_size_max").get("value")){_8d.invalidMessage=m.getLocalization("invalidMaxUploadSize",[_8f]);return false;}}return true;};function _90(){var _91=dj.byId("bank_abbv_name");misys._config.isOpenDialog=false;var _92=m._config.availBanks||new Array();if(_91){for(var j=0,len=_92.length;j<len;j++){var _93=_92[j];if(!dj.byId("bank_enabled_"+_93).get("checked")){if(misys._config.attachedBanks&&misys._config.attachedBanks.indexOf(_93)!==-1){misys._config.attachedBanks.splice(misys._config.attachedBanks.indexOf(_93),1);}}else{if(misys._config.attachedBanks&&misys._config.attachedBanks.indexOf(_93)===-1){misys._config.attachedBanks.push(_93);}}}var _94=[];for(var k=0,_95=misys._config.attachedBanks.length;k<_95;k++){var _96={"name":misys._config.attachedBanks[k],"value":misys._config.attachedBanks[k]};_94.push(_96);}if(_94){_91.store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_94}});_91.fetchProperties={sort:[{attribute:"name"}]};}}};function _97(_98){var _99=dijit.byId("proprietary_Separator").get("value");var _9a=dijit.byId(_98);var _9b;var _9c=_9a?_9a.get("value"):"";var _9d=_9c?_9c.split(_99):"";var _9e=_9d[0];var _9f=_9d[1];var _a0;var _a1=_9c.length;var _a2=_9c.indexOf(_99)===0||_9c.indexOf(_99)===_a1-1||_9c.indexOf(_99)===-1;var _a3=_9d&&_9d.length>2;if(_9c!==""&&(_a2||_a3)){_9a.state="Error";_9a._setStateClass();dj.setWaiState(_9a.focusNode,"invalid","true");dj.hideTooltip(_9a.domNode);dj.showTooltip(m.getLocalization("invalidPrtryIdTypeFormat",[_99]),_9a.domNode,0);_a0=function(){dj.hideTooltip(_9a.domNode);};setTimeout(_a0,5000);m._config.errorField=_9a;_9b=false;}else{if(_9e&&_9e.length>35||_9f&&_9f.length>35){_9a.state="Error";_9a._setStateClass();dj.setWaiState(_9a.focusNode,"invalid","true");dj.hideTooltip(_9a.domNode);dj.showTooltip(m.getLocalization("lengthTMAField"),_9a.domNode,0);_a0=function(){dj.hideTooltip(_9a.domNode);};setTimeout(_a0,5000);m._config.errorField=_9a;_9b=false;}else{m._config.errorField=null;_9b=true;}}return _9b;};function _a4(_a5){var _a6=dj.byId("customerReference_"+_a5+"_details_reference_nosend")?dj.byId("customerReference_"+_a5+"_details_reference_nosend"):"";var _a7="";if(m.customerRefDialogTempValue&&m.customerRefDialogTempValue!==_a6.get("value")){_a7=misys.getLocalization("resetAccountReferenceChange",[_a6.get("value")]);dj.hideTooltip(_a6.domNode);dj.showTooltip(_a7,_a6.domNode,0);}};function _a8(_a9,_aa,_ab){var _ac=_aa||"";_ac=_ac===""?"":"_"+_ac;var _ad=d.byId("check_details"+_ac),_ae="";switch(_a9.STATUS_CODE){case "OK":d.forEach(_a9.RESPONSE,function(_af){d.forEach(_af,function(res,_b0){if(_b0===0){_ae+="<span>"+res+"</span>";}else{if(res){_ae+="<br>"+res;_b3(_aa,_ab);}}});_ae+="<br><br>";});break;case "NOT_OK":_ae=_a9.ERROR_DETAILS;break;case "OK_DETAILS":d.forEach(_a9.RESPONSE,function(_b1){d.forEach(_b1,function(res,_b2){if(_b2===0){_ae+="<span>"+res+"</span>";_b3(_aa,_ab);}});_ae+="<br><br>";});break;default:break;}switch(_a9.isliquidityenabled){case "Y":dj.byId("customerReference_"+_aa+"_details_liquidityenabledflag_nosend").set("value","Y");break;case "N":dj.byId("customerReference_"+_aa+"_details_liquidityenabledflag_nosend").set("value","N");break;default:break;}_ad.innerHTML=_ae;_b4(_aa);if(_ae!=="<span>No Customer Details Found</span><br><br>"){_ad.setAttribute("display","inline-block");}};function _b4(_b5){var _b6=_b5||"";_b6=_b6===""?"":"_"+_b6;if(dj.byId("customerDetailsEnabled").get("value")==="true"){var _b7=d.byId("customerReference_"+_b5+"_details_back_office_2_nosend").value;if(dojo.trim(_b7).length!==0){if(d.byId("customerReference_"+_b5+"_details_nosend")===null&&d.byId("customerReference_"+_b5+"_details_description_nosend")===null){dj.byId("addCustomerReferenceButton_"+_b5).set("disabled",false);}else{dj.byId("addCustomerReferenceButton_"+_b5).set("disabled",true);}}else{dj.byId("addCustomerReferenceButton_"+_b5).set("disabled",false);}}};function _b8(_b9){_8a();_b4(_b9);};function _ba(_bb){var _bc=_bb||"";_bd(_bc);if(dj.byId("customerDetailsEnabled").get("value")==="true"){dj.byId("addCustomerReferenceButton_"+_bc).set("disabled",true);}misys.hideTransactionAddonsDialog("customerReference");};function _8a(_be){var _bf=_be||"";_bf=_bf===""?"":"_"+_bf;var _c0=d.byId("check_details"+_bf);if(_c0){_c0.innerHTML="";}};function _bd(_c1){_8a(_c1);dj.byId("customerReference_"+_c1+"_details_description_nosend").set("value","");dj.byId("customerReference_"+_c1+"_details_description_nosend").blur;dj.byId("customerReference_"+_c1+"_details_reference_nosend").set("value","");dj.byId("customerReference_"+_c1+"_details_reference_nosend").blur;};function _c2(dom,_c3,_c4){var _c5=dom.getElementsByTagName(_c3)[0],_c6=dom.getElementsByTagName(_c4)[0],_c7="",_c8=[],_c9=new Array();if(_c5){var _ca=_c5.childNodes[0];if(_ca&&_ca.nodeValue){_c7=_ca.nodeValue;}}if(_c6){var _cb=_c6.childNodes[0];if(_cb&&_cb.nodeValue){_c9=_cb.nodeValue.split(",");}}_c8.push("<group_record><group_abbv_name>",_c7,"</group_abbv_name>");if(_c9.length>0){dojo.forEach(_c9,function(_cc){if(_cc!==null&&_cc!==""){_c8.push("<existing_roles><role><name>",_cc,"</name></role></existing_roles>");}});}_c8.push("</group_record>");return _c8.join("");};function _cd(_ce){var _cf=[];if(_ce.length>0){dojo.forEach(_ce,function(_d0){if(_d0!==null&&_d0!==""){var _d1="bank_enabled_"+_d0;var _d2=dijit.byId(_d1).get("checked");if(_d2){var _d3=d.byId("bank_desc_"+_d0).innerHTML;var _d4=dojo.trim(_d3.split("(")[0]);_cf.push("<bank_desc_record><bank_abbv_name>",_d0,"</bank_abbv_name>");_cf.push("<bank_name>",_d4,"</bank_name>");_cf.push("</bank_desc_record>");}}});}return _cf.join("");};function _d5(_d6){var _d7=dj.byId("bank_enabled_"+_d6);var _d8=_d7.get("checked");if(_d8){m.toggleReferenceSection(_d6,"down");}else{if(m._config["customerReference_"+_d6+"Attached"]>0){var _d9="";if(m._config.isBankGroupLogin){_d9=misys.getLocalization("detachedBankHasCustRefAccounts");}else{_d9=misys.getLocalization("detachedBankHasCustRef");}dj.showTooltip(_d9,_d7.domNode,0);setTimeout(function(){dj.hideTooltip(_d7.domNode);},2000);}m.toggleReferenceSection(_d6,"up");}};function _da(_db){var _dc=dj.byId("bank_enabled_"+_db);var _dd=_dc.get("checked");if(!_dd){var _de;var _df=dj.byId("accounts-grid");if(_df){_de=_df.store;}if(_db&&_de){var _e0=_de._arrayOfTopLevelItems.length;_de.fetch({query:{store_id:"*"},onComplete:function(_e1,_e2){dojo.forEach(_e1,function(_e3){if(_e3.bank_abbv_name[0]===_db){_de.deleteItem(_e3);}});if(_de){_de.save();}}});}}};function _e4(_e5,_e6,_e7){if(dj.byId("checkCustomerReferenceButton_"+_e7+"_"+_e5)){if(dj.byId(_e6).get("value")!==""){var _e8=misys._config.CustomerReferenceChangedMap;var _e9;if(_e8[_e5]){_e9=_e8[_e5];if(_e9.indexOf(_e6)===-1){_e9.push(_e6);}}else{_e9=[];_e9.push(_e6);}_e8[_e5]=_e9;misys._config.CustomerReferenceChangedMap=_e8;}else{_b3(_e5,_e6);}}};function _b3(_ea,_eb){var _ec=misys._config.CustomerReferenceChangedMap;var _ed=_ec[_ea];if(_ed){var _ee=_ed.indexOf(_eb);if(_ee!==-1){_ed.splice(_ee,1);}_ec[_ea]=_ed;}};function _ef(_f0){var _f1=misys._config.CustomerReferenceChangedMap;_f1[_f0]=[];};function _f2(){m.checkConfirmPassword("password_value","password_confirm");};function _f3(){var _f4;var _f5;if(dojo.query("#liq_bank_row .content")[0]){_f4=dijit.byId(dojo.query("#liq_bank_row .content")[0]).innerHTML;}if(dojo.query("#liq_ref_row .content")[0]){_f5=dijit.byId(dojo.query("#liq_ref_row .content")[0]).innerHTML;}var _f6=dijit.byId("liq_bank")?dijit.byId("liq_bank").get("value"):_f4;var _f7=dijit.byId("liq_ref")?dijit.byId("liq_ref"):_f5;var _f8=(_f6!==""&&_f6!==undefined)?m._config.bankCustomerReference[_f6]:"";if(_f5===undefined){if(_f7){dijit.byId("liq_ref").displayedValue="";dijit.byId("liq_ref").set("value","");_f7.store=null;}if(_f8&&_f7!=undefined){_f7.store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_f8}});_f7.fetchProperties={sort:[{attribute:"name"}]};if(_f8.length==1){if(m._config.liquidityData==""||m._config.liquidityData==undefined){_f9();}_f7.set("value",_f8[0].value);_fa(_f6,_f8[0].value);}}}else{_fa(_f6,_f5);misys.toggleLiqReferenceSection("bank","down");}};function _fa(_fb,_fc){var _fd="";try{_fd=JSON.parse(misys._config.liquidityData[_fb][_fc]);var _fe=dojo.query("#ref_liq_bank .column-wrapper .field");var _ff="<ul style=\"display:table-cell;\">";var _100="<ul style=\"display:table-cell;\">";var _101="<ul style=\"display:table-cell;\">";var _102="<ul style=\"display:table-cell;\">";var _103="<ul style=\"display:table-cell;\">";var _104="<ul style=\"display:table-cell;\">";var _105="<ul style=\"display:table-cell;\">";var _106="<ul style=\"display:table-cell;\">";var _107="<ul style=\"display:table-cell;\">";var _108="<ul style=\"display:table-cell;\">";var _109="<ul style=\"display:table-cell;\">";var _10a="<ul style=\"display:table-cell;\">";misys._config.liquidityFileds.fields.forEach(function(item,_10b){var temp="";if(item==="structuretype"){if(_fd[item]!==""){m.animate("fadeIn",dojo.byId("structuretype_row"));dojo.byId("structuretype_row").removeAttribute("hidden");_fd[item].split(",").forEach(function(type){temp+="<li>"+type+"</li>";});}else{m.animate("fadeOut",dojo.byId("structuretype_row"));dojo.byId("structuretype_row").setAttribute("hidden",true);}_ff+=temp;temp="";return;}if(item==="executiontype"){if(_fd[item]!==""){m.animate("fadeIn",dojo.byId("executiontype_row"));dojo.byId("executiontype_row").removeAttribute("hidden");_fd[item].split(",").forEach(function(type){temp+="<li>"+type+"</li>";});}else{m.animate("fadeOut",dojo.byId("executiontype_row"));dojo.byId("executiontype_row").setAttribute("hidden",true);}_100+=temp;temp="";return;}if(item==="eventtriggertype"){if(_fd[item]!==""){m.animate("fadeIn",dojo.byId("balance_row"));dojo.byId("balance_row").removeAttribute("hidden");_fd[item].split(",").forEach(function(type){temp+="<li>"+type+"</li>";});}else{m.animate("fadeOut",dojo.byId("balance_row"));dojo.byId("balance_row").setAttribute("hidden",true);}_101+=temp;temp="";return;}if(item==="accounts"){if(_fd[item]!==""){m.animate("fadeIn",dojo.byId("accounts_row"));dojo.byId("accounts_row").removeAttribute("hidden");_fd[item].split(",").forEach(function(type){temp+="<li>"+type+"</li>";});}else{m.animate("fadeOut",dojo.byId("accounts_row"));dojo.byId("accounts_row").setAttribute("hidden",true);}_102+=temp;temp="";return;}if(item==="entitytype"){if(_fd[item]!==""){m.animate("fadeIn",dojo.byId("entity_type_row"));dojo.byId("entity_type_row").removeAttribute("hidden");temp="<li>"+_fd[item]+"</li>";}else{m.animate("fadeOut",dojo.byId("entity_type_row"));dojo.byId("entity_type_row").setAttribute("hidden",true);}_103+=temp;temp="";return;}if(item==="multibank"){if(_fd[item]!==""){m.animate("fadeIn",dojo.byId("multibank_row"));dojo.byId("multibank_row").removeAttribute("hidden");temp="<li>"+_fd[item]+"</li>";}else{m.animate("fadeOut",dojo.byId("multibank_row"));dojo.byId("multibank_row").setAttribute("hidden",true);}_104+=temp;temp="";return;}if(item==="interaccounttrack"){if(_fd[item]!==""){m.animate("fadeIn",dojo.byId("inter_account_track_row"));dojo.byId("inter_account_track_row").removeAttribute("hidden");temp="<li>"+_fd[item]+"</li>";}else{m.animate("fadeOut",dojo.byId("inter_account_track_row"));dojo.byId("inter_account_track_row").setAttribute("hidden",true);}_105+=temp;temp="";return;}if(item==="nonlive"){if(_fd[item]!==""){m.animate("fadeIn",dojo.byId("non_live_row"));dojo.byId("non_live_row").removeAttribute("hidden");temp="<li>"+_fd[item]+"</li>";}else{m.animate("fadeOut",dojo.byId("non_live_row"));dojo.byId("non_live_row").setAttribute("hidden",true);}_106+=temp;temp="";return;}if(item==="crossborder"){if(_fd[item]!==""){m.animate("fadeIn",dojo.byId("cross_border_row"));dojo.byId("cross_border_row").removeAttribute("hidden");temp="<li>"+_fd[item]+"</li>";}else{m.animate("fadeOut",dojo.byId("cross_border_row"));dojo.byId("cross_border_row").setAttribute("hidden",true);}_107+=temp;temp="";return;}if(item==="multicurrency"){if(_fd[item]!==""){m.animate("fadeIn",dojo.byId("multi_currency_row"));dojo.byId("multi_currency_row").removeAttribute("hidden");temp="<li>"+_fd[item]+"</li>";}else{m.animate("fadeOut",dojo.byId("multi_currency_row"));dojo.byId("multi_currency_row").setAttribute("hidden",true);}_108+=temp;temp="";return;}if(item==="currency"){if(_fd[item]!==""){m.animate("fadeIn",dojo.byId("currency_row"));dojo.byId("currency_row").removeAttribute("hidden");_fd[item].split(",").forEach(function(type){temp+="<li>"+type+"</li>";});}else{m.animate("fadeOut",dojo.byId("currency_row"));dojo.byId("currency_row").setAttribute("hidden",true);}_109+=temp;temp="";return;}if(item==="sweepback"){if(_fd[item]!==""){m.animate("fadeIn",dojo.byId("sweep_back_row"));dojo.byId("sweep_back_row").removeAttribute("hidden");_fd[item].split(",").forEach(function(type){temp+="<li>"+type+"</li>";});}else{m.animate("fadeOut",dojo.byId("sweep_back_row"));dojo.byId("sweep_back_row").setAttribute("hidden",true);}_10a+=temp;temp="";return;}});_ff+="</ul>";_100+="</ul>";_101+="</ul>";_102+="</ul>";_103+="</ul>";_104+="</ul>";_105+="</ul>";_106+="</ul>";_107+="</ul>";_108+="</ul>";_10a+="</ul>";_109+="</ul>";dojo.query("#structuretype_row .content")[0].innerHTML=_ff;dojo.query("#currency_row .content")[0].innerHTML=_109;dojo.query("#executiontype_row .content")[0].innerHTML=_100;dojo.query("#balance_row .content")[0].innerHTML=_101;dojo.query("#accounts_row .content")[0].innerHTML=_102;dojo.query("#entity_type_row .content")[0].innerHTML=_103;dojo.query("#multibank_row .content")[0].innerHTML=_104;dojo.query("#inter_account_track_row .content")[0].innerHTML=_105;dojo.query("#non_live_row .content")[0].innerHTML=_106;dojo.query("#cross_border_row .content")[0].innerHTML=_107;dojo.query("#multi_currency_row .content")[0].innerHTML=_108;dojo.query("#sweep_back_row .content")[0].innerHTML=_10a;}catch(e){console.error("JSON Parse Exception occured in misys._config.liquidityData[bankName]");}};function _f9(){var _10c;if(dj.byId("company_id")&&dj.byId("company_id").get("value")!==""){_10c=dj.byId("company_id").get("value");}if(_10c&&_10c!==""){m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/GetLiquidityFeaturesAction"),handleAs:"json",sync:true,content:{company_id:_10c,company_name:dj.byId("abbv_name").get("value")},load:function(data){m._config.liquidityData=data;}});}};d.mixin(m,{addCustomerReference:function(_10d,_10e,_10f){var _110=false;var _111=misys._config.CustomerReferenceChangedMap[_10f];if(_111&&_111.length>0){var _112=dj.byId(_111[0]);displayMessage=misys.getLocalization("invalidCustomerReference");_112.focus();_112.set("state","Error");dj.hideTooltip(_112.domNode);dj.showTooltip(displayMessage,_112.domNode,0);return;}var _113=_10f||"";var _114=m._config.currentAddonId;var _115="customerReference_"+_113+"-master-table";var _116="customerReference_"+_113+"_row_";var _117=dojo.byId(_115);var _118,_119;var _11a=dj.byId("customerReference_"+_113+"_details_reference_nosend");if(_11a){_119=_11a.get("value");}var _11b=_113;var _11c="customerReference";var _11d="customer_reference_";var _11e="_details_back_office_";var _11f="nosend";var _120=[];_120.push(_11a);var _121=true;for(var j=1;j<10;j++){var str=_11c+"_"+_11b+_11e+j+"_"+_11f;var _122=dj.byId(str);if(_122&&_122.get("state")==="Error"){_121=false;break;}_120.push(_122);}if(!_121){return;}var _123,_124;function _125(ref){return function(){_2(ref,null,null,_113);};};for(var i=0;i<_120.length;i++){var _126,_127,_128;if(i===0){_128=dj.byId(_11d+_11b+"_details_reference_"+_114);}else{_128=dj.byId(_11d+_11b+_11e+i+"_"+_114);}_118=_128?_128.get("value"):undefined;_126=_120[i];if(_126){_127=_126.get("value");}else{_127=undefined;}if(_118!==undefined||_127!==undefined){var _129=(_118!==_127);_123=_129&&_127!==undefined&&_44(_127,_10e,i,_129,_11b,_110);_124=!_129&&_118!=undefined&&_44(_118,_10e,i,_129,_11b,_110);}if(_123||_124){displayMessage=misys.getLocalization("duplicateCustomerReference",[_126.get("value")]);_126.focus();_126.set("state","Error");dj.hideTooltip(_126.domNode);dj.showTooltip(displayMessage,_126.domNode,0);break;}}if(!(_123||_124)){if(misys.addTransactionAddon(_10d)){_bd(_113);if(_118&&_119&&_118!==_119&&_114!==""){_2d(_118,_119);setTimeout(_125(_118),1000);}else{setTimeout(_125(null),1000);}}else{if(dj.byId("customerDetailsEnabled").get("value")==="true"){dj.byId("addCustomerReferenceButton_"+_113).set("disabled",true);}}}},showCustomerReferenceDialog:function(type,_12a,_12b,_12c){var _12d=_12c||"";_12d=_12d===""?"":"_"+_12d;if(dj.byId("customerDetailsEnabled").get("value")==="true"){if(!_12a){d.query("#customerReferenceDialog"+_12d+" .field").forEach(function(_12e){d.style(_12e,"display","block");});dj.byId("addCustomerReferenceButton"+_12d).set("disabled",false);}else{dj.byId("addCustomerReferenceButton"+_12d).set("disabled",true);}_bd(_12d);}m.customerRefDialogTempValue=undefined;_ba(_12c);m.showTransactionAddonsDialog(type+_12d,null,_12c);},bind:function(){m.setValidation("bei",m.validateBEIFormat);m.connect("liq_ref","onChange",function(){var _12f;if(dojo.query("#liq_bank_row .content")[0]){_12f=dijit.byId(dojo.query("#liq_bank_row .content")[0]).innerHTML;}var _130=dijit.byId("liq_bank")?dijit.byId("liq_bank").get("value"):_12f;var _131=dijit.byId("liq_ref").get("value");if(_130!==""&&_131!==""){_fa(_130,_131);misys.toggleLiqReferenceSection("bank","down");}});m.connect("liq_bank","onChange",_f3);m.connect("liq_bank","onChange",function(){if(dijit.byId("liq_ref")&&dijit.byId("liq_ref").get("value")===""&&!_1){misys.animate("wipeIn","liq_no_data");misys.animate("wipeOut","ref_liq_bank");}_1=false;});m.setValidation("email",m.validateSingleEmailAddr);m.setValidation("crm_email",m.validateSingleEmailAddr);m.setValidation("web_address",m.validateWebAddr);m.setValidation("password_value",m.validatePassword);m.setValidation("password_value",m.validateChangePasswordNP);m.setValidation("password_confirm",m.validateChangePasswordCP);m.setValidation("_country",m.validateCountry);m.setValidation("base_cur_code",m.validateCurrency);m.setValidation("phone",m.validatePhoneOrFax);m.setValidation("fax",m.validatePhoneOrFax);m.setValidation("account_ccy_cur_code",m.validateCurrency);m.setValidation("country_legalid",m.validateCountry);m.setValidation("liquidity_ccy_cur_code",m.validateCurrency);m.setValidation("account_number",m.validateUserAccountNumber);m.setValidation("attachment_max_upload_size",_8c);m.setValidation("address_line_1",m.validateSwiftAddressCharacters);m.setValidation("address_line_2",m.validateSwiftAddressCharacters);m.setValidation("dom",m.validateSwiftAddressCharacters);m.connect("password_value","onBlur",_f2);m.setValidation("rmGroup",m.checkRMGroupExists);m.connect("abbv_name","onKeyPress",function(e){if(e.keyCode===32||e.charCode===32){dojo.stopEvent(e);}});m.connect("create_admin","onClick",function(){m.toggleFields(this.get("checked"),null,["password_value","password_confirm"]);});misys.connect("add_bank","onClick",function(){misys.addMultiSelectItems(dj.byId("bank_list"),dj.byId("avail_bank_list_nosend"));});misys.connect("remove_bank","onClick",function(){misys.addMultiSelectItems(dj.byId("avail_bank_list_nosend"),dj.byId("bank_list"));});m.connect("abbv_name","onChange",function(){m.checkAbbvNameExists();});var _132=dj.byId("bank_name_abbv").get("value");var _133=dj.byId("customerReference_"+_132+"_details_reference_nosend");m.connect(_133,"onBlur",function(){_36(0);});var _134=dj.byId("customerReference_"+_132+"_details_back_office_1_nosend");m.connect(_134,"onBlur",function(){_36(1);});var _135=dj.byId("customerReference_"+_132+"_details_back_office_2_nosend");m.connect(_135,"onBlur",function(){_36(2);});var _136=dj.byId("customerReference_"+_132+"_details_back_office_3_nosend");m.connect(_136,"onBlur",function(){_36(3);});var _137=dj.byId("customerReference_"+_132+"_details_back_office_4_nosend");m.connect(_137,"onBlur",function(){_36(4);});var _138=dj.byId("customerReference_"+_132+"_details_back_office_5_nosend");m.connect(_138,"onBlur",function(){_36(5);});var _139=dj.byId("customerReference_"+_132+"_details_back_office_6_nosend");m.connect(_139,"onBlur",function(){_36(6);});var _13a=dj.byId("customerReference_"+_132+"_details_back_office_7_nosend");m.connect(_13a,"onBlur",function(){_36(7);});var _13b=dj.byId("customerReference_"+_132+"_details_back_office_8_nosend");m.connect(_13b,"onBlur",function(){_36(8);});var _13c=dj.byId("customerReference_"+_132+"_details_back_office_9_nosend");m.connect(_13c,"onBlur",function(){_36(9);});m.connect("bank_abbv_name","onChange",_1d);m.connect("bank_abbv_name","onChange",_25);m.connect("bank_abbv_name","onChange",_29);m.connect("bank_abbv_name","onChange",_21);m.connect("addCustomerButton","onClick",_90);m.connect("bank_account_type","onChange",function(){if(dj.byId("bank_previous_account_type").get("value")==="checked"){dj.byId("bank_previous_account_type").set("value","");}else{dj.byId("account_product_type").set("value","");}});m.connect("account_product_type","onChange",function(){var _13d=dj.byId("bank_account_type").get("value"),_13e=dj.byId("account_product_type").get("value"),_13f="",_140=null,_141="99";if(m._config.isBankGroupLogin&&dj.byId("bank_abbv_name")&&dj.byId("bank_abbv_name").get("value")!==""){if(_13d!==""&&_13e!==""){_13f=dj.byId("bank_abbv_name").get("value")+"-"+_13d+"-"+_13e;}}else{if(_13d!==""&&_13e!==""){_13f=_13d+"-"+_13e;}}if(!m._config.isBankGroupLogin&&m._config.bankAccountTypeMapping[_13f]){_140=m._config.bankAccountTypeMapping[_13f].accountDescription;}else{if(m._config.isBankGroupLogin&&m._config.perBankAccountProductTypeMappingDesc[_13f]){_140=m._config.perBankAccountProductTypeMappingDesc[_13f].accountDescription;}}if(_140!==null&&_140!==""){dj.byId("account_desc").set("value",_140);dj.byId("account_desc").set("disabled","true");}else{var _142=m.getLocalization("invalidAccountTypeProductType"),_143=dj.byId("account_desc");_143.state="Error";_143._setStateClass();dj.setWaiState(_143.focusNode,"invalid","true");dj.showTooltip(_142,_143.domNode,0);dj.byId("account_desc").set("value","");}if(!m._config.isBankGroupLogin&&m._config.accountTypeCodeMapping[_13f]){_141=m._config.accountTypeCodeMapping[_13f].accountTypeCode;}else{if(m._config.isBankGroupLogin&&m._config.perBankAccountTypeCodeMapping[_13f]){_141=m._config.perBankAccountTypeCodeMapping[_13f].accountTypeCode;}}dj.byId("account_type").set("value",_141);});misys.connect("frequency_select_all","onChange",function(){if(dj.byId("frequency_select_all")&&dj.byId("frequency_select_all").get("checked")){for(i=0;i<m._config.liquidity_frequency_record_count;i++){frequencyId=m._config.frequencyIdArray[i];if(dj.byId("frequency_"+frequencyId)&&dj.byId("frequency_"+frequencyId).get("disabled")===false){dj.byId("frequency_"+frequencyId).set("checked",true);}}}else{if(dj.byId("frequency_select_all")&&dj.byId("frequency_select_all").get("checked")===false){for(i=0;i<m._config.liquidity_frequency_record_count;i++){frequencyId=m._config.frequencyIdArray[i];if(dj.byId("frequency_"+frequencyId)){dj.byId("frequency_"+frequencyId).set("checked",false);}}}}});misys.connect("balance_type_select_all","onChange",function(){if(dj.byId("balance_type_select_all")&&dj.byId("balance_type_select_all").get("checked")){for(i=0;i<m._config.liquidity_balance_type_count;i++){balTypeId=m._config.balTypeIdArray[i];if(dj.byId("balance_type_"+balTypeId)&&dj.byId("balance_type_"+balTypeId).get("disabled")===false){dj.byId("balance_type_"+balTypeId).set("checked",true);}}}else{if(dj.byId("balance_type_select_all")&&dj.byId("balance_type_select_all").get("checked")===false){for(i=0;i<m._config.liquidity_balance_type_count;i++){balTypeId=m._config.balTypeIdArray[i];if(dj.byId("balance_type_"+balTypeId)){dj.byId("balance_type_"+balTypeId).set("checked",false);}}}}});},onFormLoad:function(){if(m._config.liquidityData==undefined||m._config.liquidityData==""){_f9();}_f3();misys._config.CustomerReferenceChangedMap=new Object();_90();var _144=dj.byId("create_admin"),_145=true;if(_144){m.toggleFields(_144.get("checked"),null,["password_value","password_confirm"]);}if(dijit.byId("check_duplicate_file")&&dijit.byId("abbv_name")&&dijit.byId("abbv_name").get("value")===""){dijit.byId("check_duplicate_file").set("checked",true);}if(dojo.byId("liq_bank")){dojo.byId("liq_bank").setAttribute("disabled",true);}if(dojo.byId("liq_ref")){dojo.byId("liq_ref").setAttribute("disabled",true);}dojo.forEach(m._config.availBanks,function(_146,idx){_2(null,_145,null,_146);m.connect("cancelCustomerReferenceButton_"+_146,"onClick",function(){_ba(_146);_ef(_146);});m.connect("bank_enabled_"+_146,"onChange",function(){_d5(_146);});m.connect("bank_enabled_"+_146,"onChange",function(){_da(_146);});var _147="checkCustomerReferenceButton_1_"+_146;if(dijit.byId(_147)){m.connect(_147,"onClick",function(){_7a(_146,1);});}var _148="checkCustomerReferenceButton_2_"+_146;if(dijit.byId(_148)){m.connect(_148,"onClick",function(){_7a(_146,2);});}var _149="checkCustomerReferenceButton_3_"+_146;if(dijit.byId(_149)){m.connect(_149,"onClick",function(){_7a(_146,3);});}var _14a="checkCustomerReferenceButton_4_"+_146;if(dijit.byId(_14a)){m.connect(_14a,"onClick",function(){_7a(_146,4);});}var _14b="checkCustomerReferenceButton_5_"+_146;if(dijit.byId(_14b)){m.connect(_14b,"onClick",function(){_7a(_146,5);});}var _14c="checkCustomerReferenceButton_6_"+_146;if(dijit.byId(_14c)){m.connect(_14c,"onClick",function(){_7a(_146,6);});}var _14d="checkCustomerReferenceButton_7_"+_146;if(dijit.byId(_14d)){m.connect(_14d,"onClick",function(){_7a(_146,7);});}var _14e="checkCustomerReferenceButton_8_"+_146;if(dijit.byId(_14e)){m.connect(_14e,"onClick",function(){_7a(_146,8);});}var _14f="checkCustomerReferenceButton_9_"+_146;if(dijit.byId(_14f)){m.connect(_14f,"onClick",function(){_7a(_146,9);});}var _150="customerReference_"+_146+"_details_back_office_1_nosend";if(dijit.byId(_150)){m.connect(_150,"onBlur",function(){_e4(_146,_150,"1");});}var _151="customerReference_"+_146+"_details_back_office_2_nosend";if(dijit.byId(_151)){m.connect(_151,"onBlur",function(){_e4(_146,_151,"2");});}var _152="customerReference_"+_146+"_details_back_office_3_nosend";if(dijit.byId(_152)){m.connect(_152,"onBlur",function(){_e4(_146,_152,"3");});}var _153="customerReference_"+_146+"_details_back_office_4_nosend";if(dijit.byId(_153)){m.connect(_153,"onBlur",function(){_e4(_146,_153,"4");});}var _154="customerReference_"+_146+"_details_back_office_5_nosend";if(dijit.byId(_154)){m.connect(_154,"onBlur",function(){_e4(_146,_154,"5");});}var _155="customerReference_"+_146+"_details_back_office_6_nosend";if(dijit.byId(_155)){m.connect(_155,"onBlur",function(){_e4(_146,_155,"6");});}var _156="customerReference_"+_146+"_details_back_office_8_nosend";if(dijit.byId(_156)){m.connect(_156,"onBlur",function(){_e4(_146,_156,"8");});}if(misys._config.backOfficeIndexConfig["TMA"]){var _157="customerReference_"+_146+"_details_back_office_"+misys._config.backOfficeIndexConfig["TMA"]+"_nosend";dijit.byId(_157).set("maxLength",71);if(dijit.byId(_157)){dijit.byId(_157).set("maxLength",71);m.connect(_157,"onBlur",function(){_97(_157);});m.connect(_157,"onChange",function(){_97(_157);});m.connect(_157,"onKeyPress",function(e){if(e.keyCode===32||e.charCode===32){dojo.stopEvent(e);}});}}m.connect("customerReference_"+_146+"_details_reference_nosend","onBlur",function(){_b4(_146);});m.connect("customerReference_"+_146+"_details_reference_nosend","onChange",function(){_b8(_146);});m.connect("customerReference_"+_146+"_details_description_nosend","onBlur",function(){_b4(_146);});m.connect("customerReference_"+_146+"_details_description_nosend","onChange",function(){_b4(_146);});m.connect("customerReference_"+_146+"_details_reference_nosend","onBlur",function(){_a4(_146);});});},beforeSubmitValidations:function(){_8c();if(dj.byId("attachment_max_upload_size")&&dj.byId("attachment_max_upload_size").get("state")==="Error"){dj.byId("attachment_max_upload_size").focus();return false;}else{return true;}},beforeSaveValidations:function(){var _158=dijit.byId("abbv_name").get("value");if(!(_158.length>0)){m._config.onSubmitErrorMsg=m.getLocalization("custAbbvNameEmptyError");dijit.byId("abbv_name").focus();return false;}else{return true;}}});m._config=m._config||{};d.mixin(m._config,{xmlTransform:function(xml){if(xml.indexOf("<static_phrase>")!==-1||xml.indexOf("<phrase>")!==-1){return xml;}var _159=new Array("company_role_list","bank_role_list","company_auth_level","bank_auth_level","entity_role_list"),_15a=new Array("bank_auth_level","company_auth_level","entity_auth_level"),_15b=dj.byId("bank_list"),_15c="static_company_info",_15d="",_15e=m._config.xmlTagName,_15f=_15e?["<",_15e,">"]:[],dom=dojox.xml.parser.parse(xml);dojo.forEach(_159,function(id){if(dj.byId(id)){var _160=dj.byId(id);if(_160&&_160.declaredClass.indexOf("MultiSelect")!==-1){_160.reset();_160.invertSelection();}}});_15f.push("<",_15c,">");var _161=xml.substring(_15e.length+2,(xml.length-_15e.length-3));_15f.push(_161);_15f.push("</",_15c,">");var _162=m._config.availBanks||new Array();_15f.push("<","references_record",">");_15f.push("<","customer_references",">");var _163=m.getDomValue(dom,"default_reference"),_164=m.getDomValue(dom,"abbv_name"),_165=misys._config.coreReferenceFields||[],_166=misys._config.customReferenceFields||[],_167=_165.concat(_166);for(var j=0,len=_162.length;j<len;j++){var _168=_162[j];if(!dj.byId("bank_enabled_"+_168).get("checked")){continue;}var rows=d.byId("customerReference_"+_168+"-master-table").rows.length;var _169=[];var _16a=dom.getElementsByTagName("static_company");for(var i=0;i<_16a[0].childNodes.length;i++){if(_16a[0].childNodes[i].nodeName!==null&&_16a[0].childNodes[i].nodeName.match("customer_reference_"+_168+"_details_reference_")){var _16b=_16a[0].childNodes[i].nodeName;_169.push(_16b.substring(_16b.indexOf("customer_reference_"+_168+"_details_reference_")+("customer_reference_"+_168+"_details_reference_").length));}}if(_169.length>0){dojo.forEach(_169,function(item,_16c){_15f.push("<","customer_reference",">");if(dj.byId("customer_reference_"+_168+"_details_reference_"+item)){_15f.push("<bank_abbv_name>",_168,"</bank_abbv_name>");_15f.push("<customer_abbv_name>",_164,"</customer_abbv_name>");var _16d;for(var i=0;i<_167.length;i++){_16d=m.getDomValue(dom,"customer_reference_"+_168+"_details_"+_167[i]+"_"+item);_15f.push("<"+_167[i]+">",_16d,"</"+_167[i]+">");}var _16e="N";if(_163===m.getDomValue(dom,"customer_reference_"+_168+"_details_reference_"+item)){_16e="Y";}_15f.push("<default_reference>",_16e,"</default_reference>");var _16f=m.getDomValue(dom,"customer_reference_"+_168+"_details_"+"liquidityenabledflag_"+item);_15f.push("<liquidityenabledflag>",_16f,"</liquidityenabledflag>");}_15f.push("</","customer_reference",">");});}}_15f.push("</","customer_references",">");_15f.push("</","references_record",">");var _170=dom.getElementsByTagName("account");_15f.push("<","accounts",">");if(_170.length>0){for(var k=0;k<_170.length;k++){_15f.push("<","account",">");for(var x=0;x<_170[k].childNodes.length;x++){var _171=_170[k].childNodes[x].nodeName;if(_170[k].childNodes[x].childNodes.length>0){var _172=_170[k].childNodes[x].childNodes[0].nodeValue;var _173=dojo.isString(_172)?dojox.html.entities.encode(_172,dojox.html.entities.html):_172;_15f.push("<"+_171+">",_173,"</"+_171+">");}}_15f.push("</","account",">");}}_15f.push("</","accounts",">");if(!(document.getElementById("frequency_list")===null)){var _174=frequency_list.childNodes.length-1;_15f.push("<","liquidity_frequency",">");if(_174>0){for(var a=1;a<=_174;a++){_15f.push("<","frequency_"+a,">");if(dj.byId("frequency_"+a)&&dj.byId("frequency_"+a).get("value")==="on"){_15f.push("true");}else{_15f.push("false");}_15f.push("</","frequency_"+a,">");}}_15f.push("</","liquidity_frequency",">");}if(!(document.getElementById("balance_type_list")===null)){var _175=balance_type_list.childNodes.length-1;_15f.push("<","liquidity_balance_type",">");if(_175>0){for(var p=1;p<=_175;p++){_15f.push("<","balance_type_"+p,">");if(dj.byId("balance_type_"+p)&&dj.byId("balance_type_"+p).get("value")==="on"){_15f.push("true");}else{_15f.push("false");}_15f.push("</","balance_type_"+p,">");}}_15f.push("</","liquidity_balance_type",">");}dojo.forEach(_159,function(id){if(dom.getElementsByTagName(id).length>0){var _176="bank";if(id.indexOf("bank")===-1){_176="company";}_15f.push(_c2(dom,_176+"_group_abbv_name",id));}});_15f.push(_cd(_162));if(_15e){_15f.push("</",_15e,">");}return _15f.join("");}});d.mixin(m,{fncValidateAccountPopup:function(){dj.byId("accountOkButton").set("disabled",true);var _177=["account_number","bank_account_type","account_product_type","owner_type","account_ccy_cur_code","cust_account_type","account_desc","customer_reference"];var _178=dojo.every(_177,function(id){var _179=dj.byId(id);if(_179){var _17a=_179.get("value");if(_17a===""||_179.state==="Error"){misys.showTooltip(misys.getLocalization("mandatoryFieldsError"),_179.domNode,["above","before"]);_179.state="Error";_179._setStateClass();dj.setWaiState(_179.focusNode,"invalid","true");return false;}}return true;});dj.byId("accountOkButton").set("disabled",false);var _17b=dj.byId("account_number");var _17c=dj.byId("owner_type");var _17d=dj.byId("displayed_owner_type");var _17e;if(_17b&&_17b.get("value")!==""&&_5a(_17b.get("value"),_17c.get("value"))){if(_17c.get("value")==="01"){_17e=misys.getLocalization("Owner_Type_01");}else{if(_17c.get("value")==="10"){_17e=misys.getLocalization("Owner_Type_10");}}displayMessage=misys.getLocalization("duplicateAccountNumber",[_17b.get("value"),_17e]);dj.showTooltip(displayMessage,_17b.domNode,0);_17b.set("state","Error");_17b._setStateClass();_17b.setWaiState(_17b.focusNode,"invalid","true");_178=false;}if(_17d&&_17c&&_17c.get("value")!==""){if(_17c.get("value")==="01"){_17d.set("value",misys.getLocalization("Owner_Type_01"));}else{if(_17c.get("value")==="10"){_17d.set("value",misys.getLocalization("Owner_Type_10"));}}}if(!_178){return false;}else{dj.byId("account-dialog-template").gridMultipleItemsWidget.updateData();dj.byId("accounts").dialog.hide();return true;}},fncDeleteCustomerReferenceRow:function(type,id,_17f,_180,_181){var _182=id;var _183=_181||"";var _184=type+"_row_"+_182;var _185=d.byId(_184);if(_185.children[0].childNodes[0].childNodes[0]){reference=_185.children[0].childNodes[0].childNodes[0].nodeValue;}else{if(_185.children[0].childNodes[0]){reference=_185.children[0].childNodes[0].nodeValue;}}m.deleteTransactionAddon(type,id,_17f,null,function(){_18("delete",reference,_183);});},toggleLiqReferenceSection:function(_186,dir){var _187=d.byId("liq_reference_list_down_"+_186);var _188=d.byId("liq_reference_list_up_"+_186);if(dir==="down"){if(d.style("ref_liq_"+_186,"display")==="none"){if(dijit.byId("liq_bank")&&dijit.byId("liq_ref")&&(dijit.byId("liq_bank").get("value")===""||dijit.byId("liq_ref").get("value")==="")){misys.animate("wipeIn","liq_no_data");}else{misys.animate("wipeIn","ref_liq_"+_186);misys.animate("wipeOut","liq_no_data");}d.style(_187,"display","none");d.style(_188,"display","inline");}}else{if(dir==="up"&&_188){if(d.style("ref_liq_"+_186,"display")!=="none"){misys.animate("wipeOut","ref_liq_"+_186);}if(d.style("liq_no_data","display")!=="none"){misys.animate("wipeOut","liq_no_data");}d.style(_188,"display","none");d.style(_187,"display","inline");}}},toggleReferenceSection:function(_189,dir){var _18a=d.byId("reference_list_down_"+_189);var _18b=d.byId("reference_list_up_"+_189);if(dir==="down"){if(d.style("bank_custref_"+_189,"display")==="none"&&dj.byId("bank_enabled_"+_189)&&dj.byId("bank_enabled_"+_189).get("checked")){misys.animate("wipeIn","bank_custref_"+_189);d.style(_18a,"display","none");d.style(_18b,"display","inline");}}else{if(dir==="up"){if(d.style("bank_custref_"+_189,"display")!=="none"){misys.animate("wipeOut","bank_custref_"+_189);d.style(_18b,"display","none");d.style(_18a,"display","inline");}}}},toggleViewLiqReferenceSection:function(_18c,dir){var _18d=d.byId("reference_list_down_"+_18c);var _18e=d.byId("reference_list_up_"+_18c);if(dir==="down"){if(d.style("bank_custref_"+_18c,"display")==="none"){misys.animate("wipeIn","bank_custref_"+_18c);d.style(_18d,"display","none");d.style(_18e,"display","inline");}}else{if(dir==="up"){if(d.style("bank_custref_"+_18c,"display")!=="none"){misys.animate("wipeOut","bank_custref_"+_18c);d.style(_18e,"display","none");d.style(_18d,"display","inline");}}}}});d.ready(function(){d.require("misys.system.widget.Accounts");d.require("misys.system.widget.Account");});})(dojo,dijit,misys);dojo.require("misys.client.binding.system.company_mc_client");}