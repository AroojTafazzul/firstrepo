/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.system.alert"]){dojo._hasResource["misys.binding.system.alert"]=true;dojo.provide("misys.binding.system.alert");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.FilteringSelect");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.RadioButton");dojo.require("dijit.form.ValidationTextBox");dojo.require("misys.widget.Dialog");dojo.require("dijit.TooltipDialog");dojo.require("dojo.data.ItemFileWriteStore");dojo.require("misys.form.CurrencyTextBox");dojo.require("misys.form.addons");dojo.require("misys.form.common");dojo.require("misys.validation.common");(function(d,dj,m){function _1(_2){var _3=dj.byId("issuer_abbv_name"+_2+"_1"),_4=dj.byId("issuer_abbv_name"+_2+"_2"),_5=dj.byId("issuer_abbv_name"+_2+"_3"),_6=dj.byId("issuer_abbv_name"+_2+"_4"),_7;if(dijit.byId("is_customer")&&dijit.byId("is_customer").get("value")==="Y"){_7=dj.byId("issuer_abbv_name"+_2+"_5");}if(!_3){return true;}if(dijit.byId("is_customer")&&dijit.byId("is_customer").get("value")==="Y"){if(!_3.get("checked")&&!_4.get("checked")&&!_5.get("checked")&&!_6.get("checked")&&_7!=undefined&&!_7.get("checked")){m.showTooltip(m.getLocalization("recipientMandatory"),_3.domNode,["before"]);return false;}}else{if(!_3.get("checked")&&!_4.get("checked")&&!_5.get("checked")&&!_6.get("checked")){m.showTooltip(m.getLocalization("recipientMandatory"),_3.domNode,["before"]);return false;}}return true;};function _8(){m.connect(dj.byId("prod_code01"),"onClick",function(){this.focus();});m.connect(dj.byId("sub_prod_code01"),"onClick",function(){this.focus();});m.connect(dj.byId("tnx_type_code01"),"onClick",function(){this.focus();});m.connect(dj.byId("prod_stat_code01"),"onClick",function(){this.focus();});m.connect(dj.byId("tnx_amount_sign01"),"onClick",function(){this.focus();});m.connect(dj.byId("prod_code02"),"onClick",function(){this.focus();});m.connect(dj.byId("sub_prod_code02"),"onClick",function(){this.focus();});m.connect(dj.byId("tnx_type_code02"),"onClick",function(){this.focus();});m.connect(dj.byId("prod_stat_code02"),"onClick",function(){this.focus();});m.connect(dj.byId("tnx_amount_sign02"),"onClick",function(){this.focus();});};function _9(_a,_b){var _c=[],_d=[],_e=[],_f="";if(dj.byId("prod_stat_code"+_b)){var _10={"identifier":"id","items":[]},_11=new dojo.data.ItemFileWriteStore({data:_10});_f=dj.byId("prod_stat_code"+_b);_f.store=null;if(misys._config&&misys._config.productStatusesCollection&&misys._config.productStatusesCollection[_a]){_e=misys._config.productStatusesCollection[_a];}dojo.forEach(_e,function(_12,_13){var _14=_12.split(";");_c[_13]=_14[0];_d[_13]=_14[1];});for(var j=0;j<_c.length;j++){_11.newItem({"id":_c[j],"name":_d[j]});}_f.store=_11;_f.set("value","");}};function _15(_16){if(_16){d.forEach(_16.split(","),function(_17){if(!dojox.validate.isEmailAddress(_17)){var _18=m.getLocalization("invalidEmailAddressError"),_19=dijit.byId("address01");_19.focus();_19.set("state","Error");dijit.hideTooltip(_19.domNode);dijit.showTooltip(_18,_19.domNode,0);}});}};function _1a(_1b,_1c){var _1d=dj.byId(_1b).get("value"),_1e=dj.byId(_1c),_1f=(_1d==="*")?"ALL":_1d,_20=m._config.subProductsCollection[_1f];_1e.set("value","");if(_20&&_1f!=="*"&&_20.length===1){if(dj.byId(_1c)){m.animate("fadeOut",d.byId(_1c+"_row"));dj.byId(_1c).set("required",false);}}else{if(dj.byId(_1c)){m.animate("fadeIn",d.byId(_1c+"_row"));m.toggleRequired(_1c,true);}}if(_20){_1e.store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_20}});_1e.fetchProperties={sort:[{attribute:"name"}]};}else{_1e.store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:[{value:"*",name:"*"}]}});}};function _21(_22,_23){var _24=[],_25=[],_26=true,_27=dijit.byId("tnx_type_code01");_27.store=null;if(_22==="LC"||_22==="BG"||_22==="SI"||_22==="PO"||_22==="EC"){_24=["*",m.getLocalization("new"),m.getLocalization("amend"),m.getLocalization("message"),m.getLocalization("reporting")];_25=["*","01","03","13","15"];}else{if(_22==="EL"||_22==="SG"||_22==="TF"||_22==="IC"||_22==="SR"||_22==="SE"||_22==="FA"||_22==="SO"||_22==="FT"){_24=["*",m.getLocalization("new"),m.getLocalization("message"),m.getLocalization("reporting")];_25=["*","01","13","15"];}else{if(_22==="EL"||_22==="SG"||_22==="TF"||_22==="IC"||_22==="SR"||_22==="SE"||_22==="FA"||_22==="SO"){_24=["*",m.getLocalization("financeRequest")];_25=["*","63"];}else{if(_22==="IN"||_22==="IP"){_24=["*",m.getLocalization("new"),m.getLocalization("message"),m.getLocalization("reporting"),m.getLocalization("financeRequest"),m.getLocalization("invoiceSettle")];_25=["*","01","13","15","63","85"];}else{if(_22==="IO"){_24=["*",m.getLocalization("new"),m.getLocalization("baselineMatch"),m.getLocalization("baselineMismatch"),m.getLocalization("baselineResubmit"),m.getLocalization("close"),m.getLocalization("paymentRequest"),m.getLocalization("intentToPay"),m.getLocalization("amendRequest"),m.getLocalization("amend"),m.getLocalization("reporting")];_25=["*","01","64","65","31","38","55","49","32","03","15"];}else{if(_22==="EA"){_24=["*",m.getLocalization("initialBaseline"),m.getLocalization("baselineResubmit"),m.getLocalization("close"),m.getLocalization("baselineMatch"),m.getLocalization("baselineMismatch"),m.getLocalization("amend")];_25=["*","30","31","38","64","65","03"];}else{if(_22=="LN"){_24=["*",m.getLocalization("new"),m.getLocalization("payment"),m.getLocalization("amend"),m.getLocalization("reporting")];_25=["*","01","61","03","15"];}else{if(_22==="FB"){_24=["*",m.getLocalization("new"),m.getLocalization("amend"),m.getLocalization("reporting")];_25=["*","01","03","15"];}else{if(_22==="BK"||_22==="FT"){_24=["*",m.getLocalization("new"),m.getLocalization("reporting")];_25=["*","01","15"];}else{_24=["*",m.getLocalization("new"),m.getLocalization("message"),m.getLocalization("amend"),m.getLocalization("reporting")];_25=["*","01","13","03","15"];}}}}}}}}}var _28={"identifier":"id","items":[]};var _29=new dojo.data.ItemFileWriteStore({data:_28});for(var j=0;j<_24.length;j++){_29.newItem({"id":_25[j],"name":_24[j]});}_27.store=_29;_27.set("value","");};function _2a(_2b){if(dj.byId("tnx_amount_sign"+_2b).get("value")!=="*"){dj.byId("tnx_currency"+_2b).set("required",true);dj.byId("tnx_amount"+_2b).set("required",true);}else{dj.byId("tnx_currency"+_2b).set("value","");dj.byId("tnx_amount"+_2b).set("value","");dj.byId("tnx_currency"+_2b).set("required",false);dj.byId("tnx_amount"+_2b).set("required",false);}m.connect("tnx_currency"+_2b,"onBlur",function(){dj.byId("tnx_currency"+_2b).set("value",dj.byId("tnx_currency"+_2b).getValue().toUpperCase());});m.setValidation("tnx_currency"+_2b,m.validateCurrency);m.connect("tnx_currency"+_2b,"onChange",function(){m.setCurrency(this,["tnx_amount"+_2b]);});if(dj.byId("tnx_amount_sign"+_2b).get("value")!==""&&dj.byId("tnx_amount_sign"+_2b).get("value")!=="*"){m.animate("fadeIn",d.byId("amount-id-"+_2b));}else{m.animate("fadeOut",d.byId("amount-id-"+_2b));}};function _2c(_2d,_2e){var _2f=dj.byId(_2d);if(_2f&&_2f.validate()&&_1(_2e)){_2f.execute();_2f.hide();m.isFormDirty=true;}};d.mixin(m,{bind:function(){m.setValidation("address01",m.validateEmailAddr);m.setValidation("address02",m.validatePhoneOrFax);d.query("input[id^=\"prod_code\"]").forEach(function(_30){m.connect(_30.id,"onChange",function(){_9(dj.byId(_30.id).get("value"),_30.id.substring("prod_code".length));});});if(dojo.isIE){_8();}m.connect("prod_code01","onChange",function(){if(dijit.byId("prod_code01")&&dijit.byId("prod_code01").get("value")!==""){var _31=dijit.byId("prod_code01").get("value");_21(_31,dijit.byId("tnx_type_code01").get("value"));_1a("prod_code01","sub_prod_code01");if(misys._config.alerts&&(misys._config.alerts.tempSubProductCode||misys._config.alerts.tempTypeCode||misys._config.alerts.tempProdStatCode)){dijit.byId("sub_prod_code01").set("value",misys._config.alerts.tempSubProductCode);dijit.byId("tnx_type_code01").set("value",misys._config.alerts.tempTypeCode);dijit.byId("prod_stat_code01").set("value",misys._config.alerts.tempProdStatCode);misys._config.alerts.tempSubProductCode="";misys._config.alerts.tempTypeCode="";misys._config.alerts.tempProdStatCode="";}}});m.connect("prod_code02","onChange",function(){if(dijit.byId("prod_code02")){var _32=dijit.byId("prod_code02").get("value");_21(_32,dijit.byId("tnx_type_code02").get("value"));_1a("prod_code02","sub_prod_code02");if(misys._config.alerts&&(misys._config.alerts.tempSubProductCode&&misys._config.alerts.tempTypeCode&&misys._config.alerts.tempProdStatCode)){dijit.byId("sub_prod_code02").set("value",misys._config.alerts.tempSubProductCode);dijit.byId("tnx_type_code02").set("value",misys._config.alerts.tempTypeCode);dijit.byId("prod_stat_code02").set("value",misys._config.alerts.tempProdStatCode);misys._config.alerts.tempSubProductCode="";misys._config.alerts.tempTypeCode="";misys._config.alerts.tempProdStatCode="";}}});dojo.query(".issuer_abbv_name .dijitCheckBoxInput").forEach(function(_33){var _34=_33.id;if(_34.indexOf("issuer_abbv_name01")!==-1){m.connect(_33.id,"onClick",function(){var _35=_33.id;var _36=_35.substring(19);switch(_36){case "4":m.toggleFields(this.get("checked"),["alertlanguage01","address01"],["alertlanguage01","address01"]);m.animate("fadeIn",d.byId("language-address-id-01"));m.animate("fadeOut",d.byId("contact-person-id-01"));break;case "5":m.toggleFields(false,["alertlanguage01","address01"],["alertlanguage01","address01"]);if(dijit.byId("is_customer")&&dijit.byId("is_customer").get("value")==="Y"){if(dijit.byId("contact_person01")&&dijit.byId("contact_address01")){if(this.checked){if(dijit.byId("01entity")&&dijit.byId("01entity").get("value")!==""){dijit.byId("contact_person01").set("value",m._config.entityEmailCollection[dijit.byId("01entity").get("value")].alertContactPerson);dijit.byId("contact_address01").set("value",m._config.entityEmailCollection[dijit.byId("01entity").get("value")].alertEmail);if(dijit.byId("contact_address01").get("value")===""){m.animate("fadeOut",d.byId("language-address-id-01"));m.animate("fadeOut",d.byId("contact-person-id-01"));m.dialog.show("ERROR",m.getLocalization("emailIdEmpty"));}}else{if(dijit.byId("01entity")&&dijit.byId("01entity").get("value")===""){dijit.byId("contact_person01").set("value","");dijit.byId("contact_address01").set("value","");if(dijit.byId("contact_address01").get("value")===""){m.animate("fadeOut",d.byId("language-address-id-01"));m.animate("fadeOut",d.byId("contact-person-id-01"));m.dialog.show("ERROR",m.getLocalization("emailIdEmpty"));}}else{dijit.byId("contact_person01").set("value",m._config.entityEmailCollection["*"].alertContactPerson);dijit.byId("contact_address01").set("value",m._config.entityEmailCollection["*"].alertEmail);if(dijit.byId("contact_address01").get("value")===""){m.animate("fadeOut",d.byId("language-address-id-01"));m.animate("fadeOut",d.byId("contact-person-id-01"));m.dialog.show("ERROR",m.getLocalization("emailIdEmpty"));}}}}}else{dijit.byId("contact_person01").set("value","");dijit.byId("contact_address01").set("value","");}}m.animate("fadeOut",d.byId("language-address-id-01"));m.animate("fadeIn",d.byId("contact-person-id-01"));m.connect("alert01-dialog-template","onHide",function(){m.animate("fadeOut",d.byId("language-address-id-01"));m.animate("fadeIn",d.byId("contact-person-id-01"));});break;default:m.toggleFields(false,["alertlanguage01","address01"],["alertlanguage01","address01"]);m.animate("fadeOut",d.byId("language-address-id-01"));m.animate("fadeOut",d.byId("contact-person-id-01"));break;}});}});m.connect("issuer_abbv_name02_4","onChange",function(){m.toggleFields(this.get("checked"),["alertlanguage02","address02"],["alertlanguage02","address02"]);if(this.get("value")==="*"){m.animate("fadeIn",d.byId("language-address-id-02"));}else{m.animate("fadeOut",d.byId("language-address-id-02"));}});m.connect("01entity","onChange",function(){if(dijit.byId("is_customer")&&dijit.byId("is_customer").get("value")==="Y"){if(dijit.byId("01entity")&&dijit.byId("01entity").get("value")!==""){if(dijit.byId("issuer_abbv_name01_5")&&dijit.byId("issuer_abbv_name01_5").get("checked")){dijit.byId("contact_person01").set("value",m._config.entityEmailCollection[dijit.byId("01entity").get("value")].alertContactPerson);dijit.byId("contact_address01").set("value",m._config.entityEmailCollection[dijit.byId("01entity").get("value")].alertEmail);m.animate("fadeOut",d.byId("language-address-id-01"));m.animate("fadeIn",d.byId("contact-person-id-01"));if(dijit.byId("contact_address01").get("value")===""){m.animate("fadeOut",d.byId("contact-person-id-01"));}}}}});m.connect("tnx_amount_sign01","onChange",function(){_2a("01");});m.connect("tnx_amount_sign02","onChange",function(){_2a("02");});m.connect("tnx_amount_sign03","onChange",function(){_2a("03");});m.connect("address01","onBlur",function(){if(dijit.byId("address01")&&dijit.byId("address01").get("value")!==""){m.setValidation("address01",m.validateEmailAddr);}});},getProductLabel:function(_37,_38){if(!_38){return "*";}if((m._config.productsCollection[_38.prod_code])){return m._config.productsCollection[_38.prod_code];}return "*";},getSubProductLabel:function(_39,_3a){if(!_3a){return "*";}var _3b=m._config.subProductsCollection[_3a.prod_code];for(var i=0;i<=50;i++){if(_3b&&_3b[i]){if(_3b[i].value instanceof Array){if(_3b[i].value[0]===_3a.sub_prod_code[0]){return _3b[i].name[0];}}else{if(_3b[i].value===_3a.sub_prod_code[0]){return _3b[i].name;}}}else{return "*";}}return "*";},getAmountLabel:function(_3c,_3d){if(!_3d){return "*";}if(_3d.tnx_amount_sign[0]!=="01"&&_3d.tnx_amount_sign[0]!=="02"){return "*";}else{var _3e;if(_3d.tnx_amount_sign[0]==="01"){_3e="<";}else{if(_3d.tnx_amount_sign[0]==="02"){_3e=">";}}}var _3f=d.cldr.monetary.getData(_3d.tnx_currency);var _40=isNaN(_3d.tnx_amount)?_3d.tnx_amount:dojo.currency.format(_3d.tnx_amount,{round:_3f.round,places:_3f.places});return _3e+" "+_3d.tnx_currency+" "+_40;},getAddressLabel:function(_41,_42){if(!_42){return "*";}return _42.issuer_abbv_name!="*"?m._config.recipientCollection[_42.issuer_abbv_name]:_42.address;},getTypeLabel:function(_43,_44){if(!_44){return "*";}return m._config.typesCollection[_44.tnx_type_code];},getProdStatCode:function(_45,_46){if(!_46){return "*";}return m._config.productStatCodeCollection[_46.prod_stat_code];}});m._config=m._config||{};d.mixin(m._config,{initReAuthParams:function(){var _47={productCode:"SA",subProductCode:"",transactionTypeCode:"01",entity:"",currency:"",amount:"",es_field1:"",es_field2:""};return _47;}});m.dialog=m.dialog||{};d.mixin(m.dialog,{submitAlert:function(_48,_49){if(dijit.byId("issuer_abbv_name01_5")){if(dijit.byId("issuer_abbv_name01_5").get("checked")&&dijit.byId("contact_address01").get("value")===""){m.dialog.show("ERROR",m.getLocalization("emailIdEmpty"));}else{_2c(_48,_49);}}else{_2c(_48,_49);}}});function _4a(_4b){var _4c=dj.byId(_4b);_4c.fetchProperties={sort:[{attribute:"name"}]};};d.ready(function(){d.require("misys.admin.widget.Alerts");d.require("misys.admin.widget.Alert");d.require("misys.admin.widget.AlertEntity");});d.subscribe("ready",function(){if(dijit.byId("prod_code01")){_4a("prod_code01");}if(dijit.byId("prod_code02")){_4a("prod_code02");}if(dijit.byId("tnx_type_code01")){_4a("tnx_type_code01");}if(dijit.byId("tnx_type_code02")){_4a("tnx_type_code02");}if(dijit.byId("prod_stat_code01")){_4a("prod_stat_code01");}if(dijit.byId("prod_stat_code02")){_4a("prod_stat_code02");}});})(dojo,dijit,misys);dojo.require("misys.client.binding.system.alert_client");}