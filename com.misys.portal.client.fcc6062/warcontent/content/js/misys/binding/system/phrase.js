/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.system.phrase"]){dojo._hasResource["misys.binding.system.phrase"]=true;dojo.provide("misys.binding.system.phrase");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.layout.ContentPane");dojo.require("dojo.data.ItemFileReadStore");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.editor.plugins.ProductFieldChoice");(function(d,dj,m){function _1(){var _2=dj.byId("product_code").get("value"),_3=dj.byId("category"),_4=m._config.productCategoryMap[_2],_5=dj.byId("category_code_hidden")?dj.byId("category_code_hidden").get("value"):"";if(!misys._config.isModified){_3.set("value","");}if(_2!==""){if(_4){_3.store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_4}});_3.fetchProperties={sort:[{attribute:"value"}]};}else{_4=m._config.productCategoryMap["ALL"];_3.store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_4}});_3.fetchProperties={sort:[{attribute:"value"}]};}if(_5!==""){_3.set("value",_5);}}};function _6(){var _7=dj.byId("phrase_type").get("value"),_8=dj.byId("product_code"),_9=m._config.phraseTypesProductMap[_7],_a=dj.byId("product_code_hidden")?dj.byId("product_code_hidden").get("value"):"";if(!misys._config.isModified){_8.set("value","");}if(_9){_8.store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_9}});_8.fetchProperties={sort:[{attribute:"name"}]};}if(_a!==""){_8.set("value",_a);}};function _b(_c){d.require("misys.report.definitions.report_all_candidates");d.require("misys.report.definitions.report_lc_phrase_candidate");initialiseProductArrays("lc");d.require("misys.report.definitions.report_si_phrase_candidate");initialiseProductArrays("si");};function _d(){var _e=dj.byId("phrase_type");var _f=dj.byId("product_code")?dj.byId("product_code").get("value"):"";var _10=d.byId("static-text-editor");var _11=d.byId("rich-text-editor");if(_e&&_e.get("value")==="02"&&_f!==""){_b(_f);_12(_f+"Tnx","dynamic_text");m.animate("fadeOut",_10);m.animate("fadeIn",_11);dj.byId("static_text").set("required",false);}else{m.animate("fadeOut",_11);m.animate("fadeIn",_10);dj.byId("dynamic_text")?dj.byId("dynamic_text").set("required",false):"";}};function _12(_13,_14){var _15=dj.byId(_14);if(!_15){var _16=d.byId(_14);var _17=d.byId("rteContent").innerHTML;_15=new dj.Editor({id:_14,name:_14,rows:"13",cols:"40",maxSize:"300",plugins:[{name:"misys.editor.plugins.ProductFieldChoice",command:"misysEditorPluginsProductFieldChoice",product:_13}]},_16);_17=_17.replace(/&lt;/g,"<");_17=_17.replace(/&gt;/g,">");_17=_17.replace(/&amp;/g,"&");_17=_17.replace(/&quot;/g,"\"");_15.set("value",_17?_17:"");}};d.mixin(m,{bind:function(){m.setValidation("abbv_name",m.validateCharactersExcludeSpace);m.setValidation("description",m.validateBlackListChar);m.setValidation("static_text",m.validateBlackListChar);m.connect("phrase_type","onChange",_6);m.connect("product_code","onChange",_d);m.connect("product_code","onChange",_1);},onFormLoad:function(){if(dj.byId("phrase_type")&&dj.byId("phrase_type").get("value")==="02"){var _18=d.byId("static-text-editor");var _19=d.byId("rich-text-editor");m.animate("fadeOut",_18);m.animate("fadeIn",_19);dj.byId("static_text").set("required",false);}_6();_1();},beforeSaveValidations:function(){m.setValidation("abbv_name",m.validateCharactersExcludeSpace);m.setValidation("description",m.validateBlackListChar);m.setValidation("static_text",m.validateBlackListChar);if((dj.byId("phrase_type")&&dj.byId("phrase_type").get("value")==="02"&&dj.byId("dynamic_text")&&dj.byId("dynamic_text").get("value")==="")){m._config.onSubmitErrorMsg=m.getLocalization("dynamicTextEmptyError");return false;}else{if(dj.byId("phrase_type")&&dj.byId("phrase_type").get("value")==="01"&&dj.byId("static_text")&&dj.byId("static_text").get("value")===""){m._config.onSubmitErrorMsg=m.getLocalization("dynamicTextEmptyError");return false;}else{if((dj.byId("phrase_type")&&dj.byId("phrase_type").get("value")==="02"&&dj.byId("dynamic_text")&&(dj.byId("dynamic_text").get("value")!=="")&&!m.validateBlackListCharInDynamicRTE(dj.byId("dynamic_text")))){m._config.onSubmitErrorMsg=m.getLocalization("focusOnErrorAlert");return false;}else{return true;}}}},beforeSubmitValidations:function(){m.setValidation("abbv_name",m.validateCharactersExcludeSpace);m.setValidation("description",m.validateBlackListChar);m.setValidation("static_text",m.validateBlackListChar);if((dj.byId("phrase_type")&&dj.byId("phrase_type").get("value")==="02"&&dj.byId("dynamic_text")&&dj.byId("dynamic_text").get("value")==="")){m._config.onSubmitErrorMsg=m.getLocalization("dynamicTextEmptyError");return false;}else{if(dj.byId("phrase_type")&&dj.byId("phrase_type").get("value")==="01"&&dj.byId("static_text")&&dj.byId("static_text").get("value")===""){m._config.onSubmitErrorMsg=m.getLocalization("dynamicTextEmptyError");return false;}else{if((dj.byId("phrase_type")&&dj.byId("phrase_type").get("value")==="02"&&dj.byId("dynamic_text")&&(dj.byId("dynamic_text").get("value")!=="")&&!m.validateBlackListCharInDynamicRTE(dj.byId("dynamic_text")))){m._config.onSubmitErrorMsg=m.getLocalization("focusOnErrorAlert");return false;}else{return true;}}}}});})(dojo,dijit,misys);dojo.require("misys.client.binding.system.phrase_client");}