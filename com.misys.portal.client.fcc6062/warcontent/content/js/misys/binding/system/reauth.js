/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.system.reauth"]){dojo._hasResource["misys.binding.system.reauth"]=true;dojo.provide("misys.binding.system.reauth");dojo.require("misys.validation.common");(function(d,dj,m){var _1="reauth_dialog";function _2(s){var _3=8;var _4=0;function _5(x,y){var _6=(x&65535)+(y&65535);var _7=(x>>16)+(y>>16)+(_6>>16);return (_7<<16)|(_6&65535);};function S(X,n){return (X>>>n)|(X<<(32-n));};function R(X,n){return (X>>>n);};function Ch(x,y,z){return ((x&y)^((~x)&z));};function _8(x,y,z){return ((x&y)^(x&z)^(y&z));};function _9(x){return (S(x,2)^S(x,13)^S(x,22));};function _a(x){return (S(x,6)^S(x,11)^S(x,25));};function _b(x){return (S(x,7)^S(x,18)^R(x,3));};function _c(x){return (S(x,17)^S(x,19)^R(x,10));};function _d(m,l){var K=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298);var _e=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225);var W=new Array(64);var a,b,c,d,e,f,g,h,i,j;var T1,T2;m[l>>5]|=128<<(24-l%32);m[((l+64>>9)<<4)+15]=l;for(var x=0;x<m.length;x+=16){a=_e[0];b=_e[1];c=_e[2];d=_e[3];e=_e[4];f=_e[5];g=_e[6];h=_e[7];for(var y=0;y<64;y++){if(y<16){W[y]=m[y+x];}else{W[y]=_5(_5(_5(_c(W[y-2]),W[y-7]),_b(W[y-15])),W[y-16]);}T1=_5(_5(_5(_5(h,_a(e)),Ch(e,f,g)),K[y]),W[y]);T2=_5(_9(a),_8(a,b,c));h=g;g=f;f=e;e=_5(d,T1);d=c;c=b;b=a;a=_5(T1,T2);}_e[0]=_5(a,_e[0]);_e[1]=_5(b,_e[1]);_e[2]=_5(c,_e[2]);_e[3]=_5(d,_e[3]);_e[4]=_5(e,_e[4]);_e[5]=_5(f,_e[5]);_e[6]=_5(g,_e[6]);_e[7]=_5(h,_e[7]);}return _e;};function _f(str){var bin=Array();var _10=(1<<_3)-1;for(var i=0;i<str.length*_3;i+=_3){bin[i>>5]|=(str.charCodeAt(i/_3)&_10)<<(24-i%32);}return bin;};function _11(_12){_12=_12.replace(/\r\n/g,"\n");var _13="";for(var n=0;n<_12.length;n++){var c=_12.charCodeAt(n);if(c<128){_13+=String.fromCharCode(c);}else{if((c>127)&&(c<2048)){_13+=String.fromCharCode((c>>6)|192);_13+=String.fromCharCode((c&63)|128);}else{_13+=String.fromCharCode((c>>12)|224);_13+=String.fromCharCode(((c>>6)&63)|128);_13+=String.fromCharCode((c&63)|128);}}}return _13;};function _14(_15){var _16=_4?"0123456789ABCDEF":"0123456789abcdef";var str="";for(var i=0;i<_15.length*4;i++){str+=_16.charAt((_15[i>>2]>>((3-i%4)*8+4))&15)+_16.charAt((_15[i>>2]>>((3-i%4)*8))&15);}return str;};s=_11(s);return _14(_d(_f(s),s.length*_3));};function _17(_18){var _19=(""+_18+"").replace(/[^\d]/g,"");_19=_19.split("").reverse().join("");if(_19.length>=8){_19=_19.substring(0,8);}return _19;};function _1a(_1b){var _1c=(""+_1b+"").replace(/[^\d]/g,"");if(_1c.length==0){return "0000";}else{if(_1c.length==1){return "000"+_1c;}else{if(_1c.length==2){return "00"+_1c;}else{if(_1c.length==3){return "0"+_1c;}else{if((_1c.length>=4)&&(_1c.length<8)){return _1c;}else{return _1c.substring(0,8);}}}}}};function _1d(_1e){_1e.hide();var _1f=dj.findWidgets(dojo.byId("reauth_dialog_content"));dojo.forEach(_1f,function(w){w.destroyRecursive(false);});dojo.empty("reauth_dialog_content");var _20=dj.byId("realform_operation");if(_20&&_20.get("value")!==""){_20.set("value","");}if(dj.byId("alertDialog")){dj.byId("alertDialog").hide();}};d.mixin(m._config,{addESFields:function(_21,_22){if(dj.byId("es_field1")){dj.byId("es_field1").set("value",_1a(_21));dojo.byId("es_field1_value").innerHTML=_1a(_21);}if(dj.byId("es_field2")){dj.byId("es_field2").set("value",_1a(_22));dojo.byId("es_field2_value").innerHTML=_1a(_22);}},getESIGNFeildForBulk:function(_23){var _24="";for(var i=0;i<_23.length;i++){var v1=_23[i].esf1_amount;var v2=_23[i].esf2_account;var _25=v1+""+v2;_25=(""+_25+"").replace(/[^\d]/g,"");_24=_24+""+_25;}var _26=_2(_24);return _17(_26);}});d.subscribe("ready",function(){var _27=dj.byId(_1);m.setValidation("reauth_password",m.validatePassword);if(_27){var pwd=dj.byId("reauth_password");m.dialog.connect(_27,"onShow",function(){if(m._config.reauth_otp_response_valid&&m._config.reauth_otp_response_valid===true){pwd.set("required",true);}});m.dialog.connect(_27,"onHide",function(){pwd.set("value","");pwd.set("required",false);});m.dialog.connect(_27,"onKeyPress",function(evt){if(evt.keyCode==d.keys.ESCAPE){d.stopEvent(evt);_1d(_27);}});m.dialog.connect("doReauthentication","onClick",function(){if(_27.validate()){if(d.isFunction(m._config.reauthSubmit)){_27.hide();m._config.reauthSubmit();}else{var _28=dj.byId("reauth_password")?dj.byId("reauth_password").get("value"):"";var _29=_28;_29=amdp.encrypt("{\"hash\":false}",dj.byId("ra_e2ee_pubkey").get("value"),dj.byId("ra_e2ee_server_random").get("value"),_28);dj.byId("reauth_otp_response").set("value",_29);dj.byId("reauth_e2ee_pubkey").set("value",dj.byId("ra_e2ee_pubkey").get("value"));dj.byId("reauth_e2ee_server_random").set("value",dj.byId("ra_e2ee_server_random").get("value"));dj.byId("reauth_e2ee_pki").set("value",dj.byId("ra_e2ee_pki").get("value"));dj.byId("TransactionData").set("value",m.formToXML());_27.hide();dj.byId("realform").submit();}}},_1);m.dialog.connect("cancelReauthentication","onClick",function(){_1d(_27);},_1);}});})(dojo,dijit,misys);dojo.require("misys.client.binding.system.reauth_client");}