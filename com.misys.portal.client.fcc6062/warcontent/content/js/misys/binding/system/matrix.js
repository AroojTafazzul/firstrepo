/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.system.matrix"]){dojo._hasResource["misys.binding.system.matrix"]=true;dojo.provide("misys.binding.system.matrix");dojo.require("dojo.data.ItemFileReadStore");dojo.require("dijit.form.FilteringSelect");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("misys.form.addons");(function(d,dj,m){function _1(){var _2=dojo.query("tr","role-master-table");if(!_2[1]){m._config.onSubmitErrorMsg=m.getLocalization("mandatoryMinimumAuthorisationLevelError");return false;}else{return true;}};function _3(){var _4=dojo.byId("amtTypeDiv"),_5=m.isVisible(_4);if(dj.byId("tnx_type_code")&&dj.byId("tnx_type_code").get("value")==="14"){m.animate("wipeIn",_4);}else{dj.byId("amt_type_1").set("checked",true);dj.byId("amt_type_2").set("checked",false);if(_5){m.animate("wipeOut",_4);}}};function _6(){var _7=dojo.byId("accDiv"),_8=m.isVisible(_7);var _9=dj.byId("product_code")?dj.byId("product_code").get("value"):"";var _a=dj.byId("sub_product_code")?dj.byId("sub_product_code").get("value"):"";if(_9==="SE"&&!(_a==="DT")||(_9==="FT"&&!(_a==="TINT"||_a==="TTPT"))||(_9==="BK"&&_a!=="LNRPN")||(_9==="TD"&&_a!=="TRTD")){m.animate("wipeIn",_7);if(m._config.company_type==="03"){m.toggleRequired("account_no",true);}}else{if(_8){m.animate("wipeOut",_7);if(m._config.company_type==="03"){m.toggleRequired("account_no",false);}}}};function _b(){if(dj.byId("isSwift2019Enabled").get("value")&&(dj.byId("product_code").get("value")==="BG"||dj.byId("product_code").get("value")==="BR")){var _c=dojo.byId("productTypeDiv"),_d=m.isVisible(_c);var _e=dojo.byId("tenorDiv"),_f=m.isVisible(_e);var _10=dj.byId("product_code")?dj.byId("product_code").get("value"):"";var _11=dj.byId("sub_product_code")?dj.byId("sub_product_code").get("value"):"";var _12=dj.byId("product_type_code_hidden"),_13=false;var _14=dj.byId("tenor_type_code_hidden"),_15=false;if(_12&&_12.get("value")!==""&&_14&&_14.get("value")!==""){_13=true;_15=true;}if((_10==="BG"||_10==="BR")&&!(_11==="STBY")){m.animate("wipeIn",_c);m.animate("wipeIn",_e);if(m._config.company_type==="03"){m.toggleRequired("product_type_code",true);m.toggleRequired("tenor_type_code",true);}}else{if(_d&&_f){m.animate("wipeOut",_c);m.animate("wipeOut",_e);if(m._config.company_type==="03"||m._config.company_type==="01"){m.toggleRequired("product_type_code",false);m.toggleRequired("tenor_type_code",false);}}}dj.byId("product_type_code").set("displayedValue","");dj.byId("tenor_type_code").set("displayedValue","");if(_13&&_15&&!(_11==="STBY")){dj.byId("product_type_code").set("displayedValue",_12.get("value"));dj.byId("tenor_type_code").set("displayedValue",_14.get("value"));}m.connect("sub_product_code","onChange",function(){if(dj.byId("product_type_code")){dj.byId("product_type_code").set("value","");}if(dj.byId("tenor_type_code")){dj.byId("tenor_type_code").set("value","");}});}};function _16(_17){var _18=dj.byId("product_code"),_19=dj.byId("product_code_hidden")?dj.byId("product_code_hidden").get("value"):"",_1a=dj.byId("account_no");if(_19=="FT"||_19=="SE"||_19==="BK"||_19==="TD"){if(_1a){_1a.set("required",true);}}else{if(_1a){_1a.set("required",false);}}if(_17=="LOAD"){_18.set("value",_19);}else{if(_1a){_1a.set("value","");}}_18.fetchProperties={sort:[{attribute:"name"}]};};function _1b(){var _1c=[],_1d=[],_1e=true,_1f=false,_20=dj.byId("product_code")?dj.byId("product_code").get("value"):"",_21=(_20==="*")?"ALL":_20,_22=(_21!=="")?m._config.SubTnxTypeCollection[_21]:"",_23=dj.byId("tnx_type_code")?dj.byId("tnx_type_code").get("value"):"",_24=dj.byId("sub_tnx_type_code_hidden")?dj.byId("sub_tnx_type_code_hidden").get("value"):"",_25=dj.byId("sub_tnx_type_code");if(_25){_25.set("displayedValue","");_25.store=null;}var _26=dojo.byId("subTnxTypeDiv"),_27=m.isVisible(_26);if(_25){_25.set("displayedValue","");}if(m._config.company_type==="03"&&_22&&_23){if(_22[0][_23]){var _28=_22[0][_23];if(_28.name&&_28.name.length===1&&_28.name==="*"&&_28.value==="*"){_1f=false;}else{if(_28.length>1){_1f=true;_25.set("displayedValue","");m.animate("wipeIn",_26);m.toggleRequired("sub_tnx_type_code",true);dojo.forEach(_28,function(_29,_2a){_1c[_2a]=_29.name;_1d[_2a]=_29.value;});}}}else{_1f=false;}}else{_1f=false;}if(!_1f){_1c[0]="*";_1d[0]="*";}var _2b={"identifier":"id","items":[]};var _2c=new dojo.data.ItemFileWriteStore({data:_2b});for(var j=0;j<_1c.length;j++){_2c.newItem({"id":_1d[j],"name":_1c[j]});}if(_25){_25.store=_2c;}if(m._config.isLoading){if(_25){_25.set("displayedValue",_24);}if(dj.byId("sub_tnx_type_code_hidden")){dj.byId("sub_tnx_type_code_hidden").set("value","");}m._config.isLoading=false;}else{if(!_1f&&_24!=="*"){dj.byId("sub_tnx_type_code").set("value","*");}else{if(_24==""){dj.byId("sub_tnx_type_code").set("displayedValue","");}}}if(!_1f){m.toggleRequired("sub_tnx_type_code",false);m.animate("wipeOut",_26);}};function _2d(){var _2e=dj.byId("product_code")?dj.byId("product_code").get("value"):"",_2f=dj.byId("sub_product_code"),_30=(_2e==="*")?"ALL":_2e,_31=(_30!=="")?m._config.SubProductsCollection[_30]:"",_32=dj.byId("sub_product_code_hidden")?dj.byId("sub_product_code_hidden").get("value"):"",_33=dj.byId("account_no");if(_2e==="SE"){m.animate("wipeOut",d.byId("limit_amount"));m.toggleRequired("lmt_amt",false);m.toggleRequired("lmt_cur_code",false);dj.byId("lmt_amt").set("value","");dj.byId("lmt_cur_code").set("value","");m.toggleRequired("min_lmt_amt",false);dj.byId("min_lmt_amt").set("value","");}else{m.animate("wipeIn",d.byId("limit_amount"));m.animate("wipeIn",d.byId("limit_min_amount"));m.toggleRequired("lmt_amt",true);m.toggleRequired("lmt_cur_code",true);}if(_2f){_2f.set("displayedValue","");_2f.store=null;}if(_31){_2f.store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_31}});_2f.fetchProperties={sort:[{attribute:"name"}]};}if(m._config.isLoading){_2f.set("displayedValue",_32);m._config.isLoading=false;}else{if(_33){_33.set("value","");}}};function _34(){var _35=dj.byId("product_code")?dj.byId("product_code").get("value"):"",_36=dj.byId("tenor_type_code"),_37=(_35==="*")?"ALL":_35,_38=(_37!=="")?m._config.tenorTypeProductList[_37]:"",_39=dj.byId("tenor_type_code_hidden")?dj.byId("tenor_type_code_hidden").get("value"):"";if(_36){_36.set("value","");}if(_38){_36.store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_38}});_36.fetchProperties={sort:[{attribute:"value"}]};m.animate("wipeIn",d.byId("tenorDiv"));m.toggleRequired("tenor_type_code",true);if(m._config.isLoading){_36.set("displayedValue",_39);m._config.isLoading=false;}}else{m.animate("wipeOut",d.byId("tenorDiv"));m.toggleRequired("tenor_type_code",false);}};function _3a(){var _3b=dj.byId("product_code")?dj.byId("product_code").get("value"):"",_3c=dj.byId("product_type_code"),_3d=(_3b==="*")?"ALL":_3b,_3e=(_3d!=="")?m._config.productTypeCodeList[_3d]:"",_3f=dj.byId("product_type_code_hidden")?dj.byId("product_type_code_hidden").get("value"):"";if(_3c){_3c.set("value","");}if(_3e){_3c.store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_3e}});_3c.fetchProperties={sort:[{attribute:"value"}]};m.animate("wipeIn",d.byId("productTypeDiv"));m.toggleRequired("product_type_code",true);if(m._config.isLoading){_3c.set("displayedValue",_3f);m._config.isLoading=false;}}else{m.animate("wipeOut",d.byId("productTypeDiv"));m.toggleRequired("product_type_code",false);}};function _40(){var _41=dj.byId("entity");if(_41&&_41.get("type")==="hidden"){_41.set("value","");}};function _42(){if(dj.byId("min_lmt_amt").get("value")>=dj.byId("lmt_amt").get("value")){misys.dialog.show("ERROR",misys.getLocalization("minAmountValidationMessage"),"",function(){dj.byId("min_lmt_amt").set("state","Error");});return false;}if(dj.byId("min_lmt_amt").get("value")<dj.byId("lmt_amt").get("value")){dj.byId("min_lmt_amt").set("state","");return true;}};function _43(){if(dj.byId("lmt_amt")){dj.byId("lmt_amt").set("displayedValue",m._config.lmt_amt);m.setCurrency(dijit.byId("iso_code"),["lmt_amt"]);}if(dj.byId("min_lmt_amt")){dj.byId("min_lmt_amt").set("displayedValue",m._config.min_lmt_amt);if(isNaN(dj.byId("min_lmt_amt").get("value"))){dj.byId("min_lmt_amt").set("value",0);}m.setCurrency(dijit.byId("iso_code"),["min_lmt_amt"]);}};d.mixin(m._config,{initReAuthParams:function(){var _44={productCode:"AM",subProductCode:"",transactionTypeCode:"01",entity:"",currency:"",amount:"",es_field1:"",es_field2:""};return _44;}});d.mixin(m,{bind:function(){m.connect("product_code","onChange",_2d);m.connect("product_code","onChange",_6);m.connect("product_code","onChange",function(){if(dj.byId("product_code").get("value")!==""&&dj.byId("tnx_type_code").get("value")!==""){_1b();}});m.connect("product_code","onChange",function(){if(dj.byId("product_type_code")){_3a();}else{m.animate("wipeOut",d.byId("productTypeDiv"));}});m.connect("product_code","onChange",function(){if(dj.byId("tenor_type_code")&&dj.byId("tenor_type_code")){_34();}else{m.animate("wipeOut",d.byId("tenorDiv"));}});m.connect("tnx_type_code","onChange",function(){if(dj.byId("product_code").get("value")!==""&&dj.byId("tnx_type_code").get("value")!==""){_1b();}});m.connect("sub_product_code","onChange",_6);if(dj.byId("isSwift2019Enabled")&&dj.byId("isSwift2019Enabled").get("value")){m.connect("sub_product_code","onChange",_b);}m.connect("sub_product_code","onChange",function(){var _45=dj.byId("account_no_hidden"),_46=false;if(_45&&_45.get("value")!==""){_46=true;dj.byId("account_no_hidden").set("value","");}if(dj.byId("account_no")&&!_46){dj.byId("account_no").set("value","");}if(dj.byId("sub_product_code").get("value")=="MUPS"&&dj.byId("lmt_cur_code").get("value")==""){dj.byId("lmt_cur_code").set("value","INR");}});m.setValidation("lmt_cur_code",m.validateCurrency);m.connect("lmt_cur_code","onChange",function(){m.setCurrency(this,["lmt_amt"]);});m.connect("lmt_cur_code","onChange",function(){m.setCurrency(this,["min_lmt_amt"]);});m.connect("min_lmt_amt","onChange",function(){if(dj.byId("lmt_amt").get("value")!==""&&dj.byId("min_lmt_amt").get("value")!==""){_42();}});m.connect("min_lmt_amt","onBlur",function(){if(dj.byId("lmt_amt").get("value")!==""&&dj.byId("min_lmt_amt").get("value")!==""){_42();}if(isNaN(dj.byId("min_lmt_amt").get("value"))){dj.byId("min_lmt_amt").set("value",0);}m.setCurrency(dijit.byId("iso_code"),["min_lmt_amt"]);});m.connect("lmt_amt","onChange",function(){if(dj.byId("lmt_amt").get("value")!==""&&dj.byId("min_lmt_amt")&&dj.byId("min_lmt_amt").get("value")!==""){_42();}});m.connect("lmt_amt","onBlur",function(){if(dj.byId("lmt_amt").get("value")!==""&&dj.byId("min_lmt_amt")&&dj.byId("min_lmt_amt").get("value")!==""){_42();}if(isNaN(dj.byId("lmt_amt").get("value"))){dj.byId("lmt_amt").set("value","");}m.setCurrency(dijit.byId("iso_code"),["lmt_amt"]);});m.connect("account_img","onClick",function(){var _47=dj.byId("company_id").get("value");var _48="";if(dj.byId("product_code")&&dj.byId("sub_product_code")&&dj.byId("product_code").get("value")!==""&&dj.byId("sub_product_code").get("value")!==""){_48=dj.byId("product_code").get("value")+":"+dj.byId("sub_product_code").get("value");}m.showSearchUserAccountsDialog("companyaccountwildcard","['','','account_no', '', '','','']","","entity","",_48,"width:750px;height:400px;",m.getLocalization("ListOfAccountsTitleMessage"),"",_47);});},onFormLoad:function(){m.setCurrency(dj.byId("lmt_cur_code"),["lmt_amt"]);m.setCurrency(dj.byId("lmt_cur_code"),["min_lmt_amt"]);_43();if(m._config.company_type==="03"){var _49=dj.byId("product_code").get("value");if(_49==="FT"||_49==="SE"||_49==="BK"||_49==="TD"){m.animate("wipeIn",d.byId("accDiv"));m.toggleRequired("account_no",true);}else{m.animate("wipeOut",d.byId("accDiv"));m.toggleRequired("account_no",false);}}if(dj.byId("sub_tnx_type_code")&&dj.byId("sub_tnx_type_code").get("value")!==""){m.animate("wipeOut",d.byId("subProductDiv"));}else{m.animate("wipeIn",d.byId("subProductDiv"));}if(dj.byId("product_code")){_16("");_3a();_34();}else{m.animate("wipeOut",d.byId("productTypeDiv"));}m._config.isLoading=true;if(dj.byId("product_code_hidden")&&dj.byId("product_code_hidden").get("value")!==""){dj.byId("product_code").set("displayedValue",dj.byId("product_code_hidden").get("value"));_2d();}m._config.isLoading=true;if(dj.byId("tenor_type_code_hidden")&&dj.byId("tenor_type_code_hidden").get("value")!==""){_34();}m._config.isLoading=true;if(dj.byId("product_type_code_hidden")&&dj.byId("product_type_code_hidden").get("value")!==""){_3a();}m._config.isLoading=true;if(m._config.company_type==="03"&&dj.byId("sub_tnx_type_code_hidden").get("value")!==""){dj.byId("sub_tnx_type_code").set("displayedValue",dj.byId("sub_tnx_type_code_hidden").get("value"));}if(m._config.company_type==="03"&&dj.byId("sub_tnx_type_code_hidden").get("value")!==""){dj.byId("sub_tnx_type_code").set("displayedValue",dj.byId("sub_tnx_type_code_hidden").get("value"));}if(m._config.company_type==="03"&&dj.byId("account_no_hidden").get("value")!==""){dj.byId("account_no").set("displayedValue",dj.byId("account_no_hidden").get("value"));}_1b();},beforeSubmitValidations:function(){return _1();}});})(dojo,dijit,misys);dojo.require("misys.client.binding.system.matrix_client");}