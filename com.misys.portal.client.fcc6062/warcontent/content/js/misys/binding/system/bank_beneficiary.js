/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.system.bank_beneficiary"]){dojo._hasResource["misys.binding.system.bank_beneficiary"]=true;dojo.provide("misys.binding.system.bank_beneficiary");dojo.require("misys.grid._base");dojo.require("dojo.data.ItemFileReadStore");dojo.require("dijit.layout.TabContainer");dojo.require("dojox.grid.DataGrid");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.layout.ContentPane");dojo.require("dojo.data.ItemFileReadStore");dojo.require("dijit.layout.TabContainer");dojo.require("misys.validation.login");dojo.require("misys.openaccount.FormOpenAccountEvents");dojo.require("misys.validation.password");dojo.require("misys.form.MultiSelect");(function(d,dj,m){var _1=m.getServletURL("/screen/AjaxScreen/action/CheckExistingCounterpartyProgramAssociationAction");var _2="Counterparty Program Association validated";m._config.onLoadShowBenExistingMsg=true;m._config.markPrtryIdFieldAsDisabled=false;function _3(_4){var _5=d.byId("counterparty-products"),_6=dj.byId("notification_enabled").get("checked"),_7=[];if(_6){m.animate("fadeIn",_5);}else{m.animate("fadeOut",_5);}d.query("[id*='counterparty_permission_']").query("[id]").forEach(function(_8){_7.push(_8.id);});m.toggleFields(_6,_7,null,_4);};function _9(){var _a=dj.byId("account");if(_a&&_a.get("value")===""){_a.set("state","Error");dj.showTooltip(m.getLocalization("mandatoryAcctNumberMessage"),_a.domNode,0);var _b=function(){dj.hideTooltip(_a.domNode);};setTimeout(_b,4500);}};function _c(){var _d=d.byId("open_account_fields_div");var _e=dj.byId("fscm_enabled");var _f=dj.byId("reset_password");if(_e&&_e.get("checked")){if(_d){m.animate("fadeIn",_d);_10(false,true);}if(_f){var _11=dj.byId("password_value");var _12=dj.byId("password_confirm");if(_f.get("checked")&&_11&&_12){_11.set("disabled",false);_12.set("disabled",false);m.toggleRequired("password_value",true);m.toggleRequired("password_confirm",true);}else{if(_11&&_12){_11.set("value","");_12.set("value","");_11.set("disabled",true);_12.set("disabled",true);m.toggleRequired("password_value",false);m.toggleRequired("password_confirm",false);}}}m.toggleRequired("_country",true);}else{if(_d){m.animate("fadeOut",_d);_10(true,false);}m.toggleRequired("_country",false);}};function _10(_13,_14){var _15=["erp_id","legal_id_no","account","bank_iso_code","bank_name","bank_address_line_1","bank_address_line_2","bank_dom","account_type"];d.forEach(_15,function(_16){var _17=dj.byId(_16);if(_17){if(_16!=="bank_address_line_2"&&_16!=="bank_dom"&&_16!=="erp_id"&&_16!=="legal_id_no"&&_16!=="bank_iso_code"&&_16!=="account_type"){m.toggleRequired(_16,_14);}if(_13){_17.set("value","");}}});};function _18(){var _19;_19=dj.byId("fscm_enabled");var _1a=dj.byId("beneficiary_id").get("value");if(_19!==""&&!_19.get("checked")){m.xhrPost({url:_1,handleAs:"json",sync:true,content:{beneficiaryId:_1a},load:_1b});}};function _1b(_1c){var _1d=null;if(dj.byId("fscm_enabled")){_1d=dj.byId("fscm_enabled");}var _1e="";if(_1c.items.valid===false){_1e=m.getLocalization("counterpartyProgramAssociationExists");if(null!=_1d){_1d.focus();_1d.set("checked",true);dj.showTooltip(_1e,_1d.domNode,0);setTimeout(function(){dj.hideTooltip(_1d.domNode);},4000);}}else{}};function _1f(){var _20=dj.byId("buyer_role");var _21=dj.byId("beneficiary_id").get("value");if(_20&&!_20.get("checked")){m.xhrPost({url:_1,handleAs:"json",sync:true,content:{beneficiaryId:_21},load:_22});}};function _22(_23){var _24=null;if(dj.byId("buyer_role")){_24=dj.byId("buyer_role");}var _25="";if(_23.items.valid===false){_25=m.getLocalization("buyerRoleDisableMsg");if(null!=_24){_24.focus();_24.set("checked",true);dj.showTooltip(_25,_24.domNode,0);setTimeout(function(){dj.hideTooltip(_24.domNode);},4000);}}else{}};function _26(){var _27=dj.byId("seller_role");var _28=dj.byId("beneficiary_id").get("value");if(_27&&!_27.get("checked")){m.xhrPost({url:_1,handleAs:"json",sync:true,content:{beneficiaryId:_28},load:_29});}};function _29(_2a){var _2b=null;if(dj.byId("seller_role")){_2b=dj.byId("seller_role");}var _2c="";if(_2a.items.valid===false){_2c=m.getLocalization("sellerRoleDisableMsg");if(null!=_2b){_2b.focus();_2b.set("checked",true);dj.showTooltip(_2c,_2b.domNode,0);setTimeout(function(){dj.hideTooltip(_2b.domNode);},4000);}}else{}};function _2d(_2e){var _2f=dj.byId("prtry_id_type_flag");var _30=dj.byId("prtry_id_type");var _31=_2e;if(_2f&&_30){var _32=dj.byId("access_opened");var _33=dj.byId("fscm_enabled");var _34=((_33&&_33.get("checked"))||(_32&&_32.get("checked")));if(_31&&_34){_30.set("required",false);_30.set("value","");}if(_34){if(_2f.get("checked")&&!_2f.get("disabled")){_30.set("required",false);_30.set("value","");}_2f.set("checked",false);_2f.set("disabled",true);}else{if(_30.get("value")){_2f.set("checked",true);if(m._config.markPrtryIdFieldAsDisabled){_2f.set("disabled",true);}else{_2f.set("disabled",false);}}else{_2f.set("checked",false);_2f.set("disabled",false);}}}};function _35(){m.checkConfirmPassword("password_value","password_confirm");};function _36(){var _37=dj.byId("fscm_enabled");var _38=dj.byId("credit_note_enabled");var _39=dj.byId("buyer_role");var _3a=dj.byId("seller_role");var _3b=dj.byId("access_opened");if(_37&&!dj.byId("fscm_enabled").get("checked")){if(_38){_38.set("checked",false);}if(_39){_39.set("checked",false);}if(_3a){_3a.set("checked",false);}if(_3b){_3b.set("checked",false);}}};d.mixin(m._config,{xmlTransform:function(xml){var _3c="<existing_cur_list>",_3d=dj.byId("corr_bank_currency_exist_nosend");if(_3d){var _3e=_3d.domNode.options;for(var i=0;i<_3e.length;i++){_3c=_3c.concat("<existing_cur_details>");_3c=_3c.concat("<currency_description>"+_3e[i].text+"</currency_description>");_3c=_3c.concat("<currency_code>"+_3e[i].value+"</currency_code>");_3c=_3c.concat("</existing_cur_details>");}_3c=_3c.concat("</existing_cur_list>");var _3f=xml.substring(xml.indexOf("<corr_bank_currency_exist_nosend>"),(xml.indexOf("</corr_bank_currency_exist_nosend>")+34));xml=xml.replace(_3f,_3c);}return xml;}});d.mixin(m,{bind:function(){m.connect("abbv_name","onKeyPress",function(e){if(e.keyCode===32||e.charCode===32){dojo.stopEvent(e);}});m.connect("abbv_name","onBlur",function(e){var _40=this;var _41=this.get("value");var _42=/^[0-9a-zA-Z]+$/;if(!_41.match(_42)){_40.set("state","Error");dj.showTooltip(m.getLocalization("cptyAbbvNameFormatError",[_41]),_40.domNode,0);setTimeout(function(){dj.hideTooltip(_40.domNode);},5000);}});m.connect("abbv_name","onChange",function(e){var _43=this;var _44=this.get("value");var _45=dj.byId("prtry_id_type_flag");var _46=dj.byId("prtry_id_type");var _47=d.byId("prtry_id_type_div");if(_45&&_46&&_44!=""){m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/CheckStaticBeneficiaryAction"),handleAs:"json",sync:true,content:{cpty_abbv_name:_44},load:function(_48){if(_48.items.prtryIdType){m._config.markPrtryIdFieldAsDisabled=_48.items.markAsDisabled;_46.set("value",_48.items.prtryIdType);if(_48.items.markAsDisabled){_46.set("disabled",true);_46.set("required",false);}else{_46.set("disabled",false);_46.set("required",true);}_2d(false);if(m._config.onLoadShowBenExistingMsg){dj.showTooltip(m.getLocalization("beneficiaryAlreadyExist",[_44]),_43.domNode,0);setTimeout(function(){dj.hideTooltip(_43.domNode);},5000);}}else{if(_46.get("disabled")||_45.get("checked")){_46.set("value","");}_45.set("checked",false);_2d(true);}}});}});m.setValidation("password_value",misys.validateChangePasswordNP);m.setValidation("password_confirm",misys.validateChangePasswordCP);m.connect("password_value","onBlur",_35);m.connect("reset_password","onChange",function(){if(dijit.byId("reset_password")&&dijit.byId("reset_password").get("checked")){if(dijit.byId("password_value")&&dijit.byId("password_confirm")){dijit.byId("password_value").set("disabled",false);dijit.byId("password_confirm").set("disabled",false);m.toggleRequired("password_value",true);m.toggleRequired("password_confirm",true);}}else{if(dijit.byId("password_value")&&dijit.byId("password_confirm")){dijit.byId("password_value").set("value","");dijit.byId("password_confirm").set("value","");dijit.byId("password_value").set("disabled",true);dijit.byId("password_confirm").set("disabled",true);m.toggleRequired("password_value",false);m.toggleRequired("password_confirm",false);}}});m.setValidation("web_address",m.validateWebAddr);m.setValidation("bei",m.validateBEIFormat);m.setValidation("bank_iso_code",m.validateBICFormat);m.setValidation("iso_code",m.validateBICFormat);m.setValidation("phone",m.validatePhoneOrFax);m.setValidation("fax",m.validatePhoneOrFax);m.setValidation("_country",m.validateCountry);m.setValidation("address_line_1",m.validateSwiftAddressCharacters);m.setValidation("address_line_2",m.validateSwiftAddressCharacters);m.setValidation("dom",m.validateSwiftAddressCharacters);m.connect("post_code","onBlur",function(){dj.byId("swift_address_address_line_1").set("value",this.get("value"));});m.connect("address_line_1","onBlur",function(){dj.byId("address_address_line_1").set("value",this.get("value"));});m.connect("account_type","onChange",function(){m.onChangeSellerAccountType("form_settlement","account","account_type");_9();});m.connect("account","onBlur",function(){m.onBlurSellerAccount("form_settlement","account","account_type");_9();});m.connect("fscm_enabled","onChange",function(){_18();_36();_c();_2d(false);});m.connect("buyer_role","onChange",function(){_1f();});m.connect("seller_role","onChange",function(){_26();});m.connect("access_opened","onChange",function(){_2d(false);});m.connect("access_credit_note_product","onChange",function(){_2d(false);});m.connect("prtry_id_type_flag","onChange",function(){var _49=dj.byId("prtry_id_type");var _4a=d.byId("prtry_id_type_div");if(this.get("checked")&&this.get("disabled")&&_49.get("value")){_49.set("disabled",true);_49.set("required",false);m.animate("fadeIn",_4a);}else{if(this.get("checked")){_49.set("disabled",false);_49.set("required",true);m.animate("fadeIn",_4a);}else{_49.set("required",false);if(!_49.get("disabled")){_49.set("value","");}_49.set("disabled",true);m.animate("fadeOut",_4a);}}});m.connect("prtry_id_type","onBlur",function(){var _4b=this;var _4c=_4b.get("value");if(_4b&&!_4b.get("disabled")&&_4c){var _4d=dj.byId("abbv_name");var _4e=_4d?_4d.get("value"):"";var _4f=dj.byId("prtry_id_type_flag");var _50=dj.byId("prtry_id_type");var _51=d.byId("prtry_id_type_div");var _52=dj.byId("prtry_id_type_separator");var _53=_52?_52.get("value"):"";var _54=_4c.split(_53);var _55=_54[0];var _56=_54[1];var _57=_4c.length;var _58=(_4c.indexOf(_53)<1||_4c.indexOf(_53)===_57-1);var _59=_54&&_54.length>2;if(_4c&&(_58||_59)){_4b.set("state","Error");dj.hideTooltip(_4b.domNode);dj.showTooltip(m.getLocalization("invalidPrtryIdTypeFormat",[_53]),_4b.domNode,0);}if(_55&&_55.length>35||_56&&_56.length>35){_4b.set("state","Error");dj.hideTooltip(_4b.domNode);dj.showTooltip(m.getLocalization("lengthTMAField"),_4b.domNode,0);}if(_4f&&_50&&_4c!=""&&!_58){m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/CheckStaticBeneficiaryAction"),handleAs:"json",sync:true,content:{cpty_abbv_name:_4e,prtry_id_type:_4c},load:function(_5a){if(_5a.items.isDuplicate){_4b.set("value","");_4b.set("state","Error");dj.hideTooltip(_4b.domNode);dj.showTooltip(m.getLocalization("duplicatePrtryIdType"),_4b.domNode,0);}}});}}});m.connect("autoacceptance_day","onBlur",function(){var _5b=dj.byId("autoacceptance_day");if(_5b&&_5b.get("value")===0){_5b.set("state","Error");dj.hideTooltip(_5b.domNode);dj.showTooltip(m.getLocalization("autoacceptanceDayGreaterthanZero"),_5b.domNode,0);}});},addCurrencyMultiSelectItems:function(_5c){var _5d,_5e;if(_5c){_5d=dj.byId("corr_bank_currency_exist_nosend");_5e=dj.byId("corr_bank_currency_avail_nosend");}else{_5d=dj.byId("corr_bank_currency_avail_nosend");_5e=dj.byId("corr_bank_currency_exist_nosend");}_5d.addSelected(_5e);_5e.focus();_5d.focus();},onFormLoad:function(){var _5f=dj.byId("access_opened");var _60=dijit.byId("abbv_name");if(_5f){m.toggleFields(_5f.get("checked"),["notification_enabled"],null,true);}var _61=dj.byId("notification_enabled");if(_61){_3(true);}_c();m._config.onLoadShowBenExistingMsg=false;_60.onChange();_2d(false);m._config.onLoadShowBenExistingMsg=true;},beforeSubmitValidations:function(){var _62=dj.byId("prtry_id_type_flag");var _63=dj.byId("prtry_id_type");var _64=true;var _65="";_2d(true);if(_62&&_63&&_62.get("checked")&&!_62.get("disabled")&&_63.get("value")){_63.onBlur();}if(_63&&_63.get("state")=="Error"){_64=false;}if(dj.byId("fscm_enabled")&&dj.byId("fscm_enabled").get("checked")){var _66=dj.byId("buyer_role")?dj.byId("buyer_role").get("checked"):"";var _67=dj.byId("seller_role")?dj.byId("seller_role").get("checked"):"";if((_66!==""&&!_66)&&(_67!==""&&!_67)){_65=m.getLocalization("counterpartyRoleIsRequired");m._config.onSubmitErrorMsg=_65;_64=false;}}return _64;}});})(dojo,dijit,misys);dojo.require("misys.client.binding.system.bank_beneficiary_client");}