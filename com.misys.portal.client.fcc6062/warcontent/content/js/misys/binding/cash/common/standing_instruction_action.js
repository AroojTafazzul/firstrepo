/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.cash.common.standing_instruction_action"]){dojo._hasResource["misys.binding.cash.common.standing_instruction_action"]=true;dojo.provide("misys.binding.cash.common.standing_instruction_action");dojo.require("misys.grid.EnhancedGrid");dojo.require("misys.binding.cash.opics.si_popup_management");(function(d,dj,m){var _1;d.mixin(m,{_fncClearTable:function(_2){d.query("#"+_2+" .dojoxGridRowSelector").forEach(function(_3){d.removeClass(_3,"dijitRadioChecked");});d.query("#"+_2+" .dojoxGridRowSelected").forEach(function(_4){d.removeClass(_4,"dojoxGridRowSelected");});if(dj.byId(_2)){dj.byId(_2).selection.clear();}},_fncConnectSSIFields:function(_5){m.connect("intermediary_bank","onChange",function(){m._fncChangeIntermediaryRequiredFieldsOnChange(_5);});m.connect("intermediary_bank_city","onChange",function(){m._fncChangeIntermediaryRequiredFieldsOnChange(_5);});m.connect("intermediary_bank_country","onChange",function(){m._fncChangeIntermediaryRequiredFieldsOnChange(_5);});m.connect("intermediary_bank_street","onChange",function(){m._fncChangeIntermediaryRequiredFieldsOnChange(_5);});m.connect("intermediary_bank_instruction_1","onChange",function(){m._fncCheckSpecialRoutingInstructionFields(_5);});m.connect("intermediary_bank_instruction_2","onChange",function(){m._fncCheckSpecialRoutingInstructionFields(_5);});m.connect("intermediary_bank_instruction_3","onChange",function(){m._fncCheckSpecialRoutingInstructionFields(_5);});m.connect("intermediary_bank_instruction_4","onChange",function(){m._fncCheckSpecialRoutingInstructionFields(_5);});m.connect("intermediary_bank_instruction_5","onChange",function(){m._fncCheckSpecialRoutingInstructionFields(_5);});m.connect("intermediary_bank_instruction_6","onChange",function(){m._fncCheckSpecialRoutingInstructionFields(_5);});m.connect("free_additional_details_line_1_input","onChange",function(){m._fncCheckPaymentDetailsFields(_5);});m.connect("free_additional_details_line_2_input","onChange",function(){m._fncCheckPaymentDetailsFields(_5);});m.connect("free_additional_details_line_3_input","onChange",function(){m._fncCheckPaymentDetailsFields(_5);});m.connect("free_additional_details_line_4_input","onChange",function(){m._fncCheckPaymentDetailsFields(_5);});},_fncCheckSpecialRoutingInstructionFields:function(_6){var _7=_6+"intermediary_bank_instruction_";var _8=[];var i=1;var _9=_7+i;for(i=1;i<=6;i++){_8.push(_7+i);if(dj.byId(_7+i).get("value")!==""){_9=_7+i;}}d.forEach(_8,function(_a,i){var _b=dj.byId(_a);var _c=_b.get("value");if(_c===""&&_a<_9){_b.set("required",true);}else{_b.set("required",false);}});},_fncCheckPaymentDetailsFields:function(_d){var _e=[_d+"free_additional_details_line_1_input",_d+"free_additional_details_line_2_input",_d+"free_additional_details_line_3_input",_d+"free_additional_details_line_4_input"];var _f=_e[0];d.forEach(_e,function(_10){if(dj.byId(_10).get("value")!==""){_f=_10;}});d.forEach(_e,function(_11,i){var _12=dj.byId(_11);var _13=_12.get("value");if(_13===""&&_11<_f){_12.set("required",true);}else{_12.set("required",false);}});},_fncDisplayStoredBankInstruction:function(_14){var _15=_14;if(_15!=null&&_15!==""){_15=_15+"_";}else{_15="";}var _16=dj.byId(_15+"bank_instruction_indicator").get("value");var _17=dj.byId(_15+"beneficiary_name").get("value");if(_16!=null&&_16!==""){d.style(_15+"bank_instruction_field",{"display":"block"});d.style(_15+"free_format_field",{"display":"none"});dj.byId(_15+"instructions_type_1").set("checked",true);dj.byId(_15+"instructions_type_2").set("checked",false);}else{if(_17!=null&&_17!==""){d.style(_15+"bank_instruction_field",{"display":"none"});d.style(_15+"free_format_field",{"display":"block"});dj.byId(_15+"instructions_type_1").set("checked",false);dj.byId(_15+"instructions_type_2").set("checked",true);m.fncfreeformatbeneficiary(_14);}else{d.style(_15+"bank_instruction_field",{"display":"block"});d.style(_15+"free_format_field",{"display":"none"});dj.byId(_15+"instructions_type_1").set("checked",true);dj.byId(_15+"instructions_type_2").set("checked",false);}}},_fncSwitchBankPaymentInstructionsFields:function(_18,_19,_1a,_1b,_1c,_1d,_1e){var _1f=_1e;if(_1f!=null&&_1f!==""){_1f=_1f+"_";}else{_1f="";}if(d.style(_1f+_18,"display")==="block"&&d.style(_1f+_19,"display")==="none"){return;}m.dialog.show("CONFIRMATION",m.getLocalization("clearMessage"),"",function(){if(_1a!=null&&_1b!=null&&_1c!=null){d.style(_1f+_1a,{"display":"block"});d.style(_1f+_1b,{"display":"none"});d.style(_1f+_1c,{"display":"none"});}m.animate("fadeOut",d.byId(_1f+_19));if(_1e==null){_1e="";}var _20=0;if(_19==="bank_instruction_field"){_20=2;}else{if(_19==="free_format_field"){_20=3;}}m.performClear(_1e,_20,false);m.animate("fadeIn",d.byId(_1f+_18));if(_18==="bank_instruction_field"){dj.byId(_1f+"bankPaymentGrid").resize();}m._fncChangePaymentTypeRequired(_18,_19,_1e);},function(){m.connect(dj.byId("cancelButton"),"onClick",function(){dj.byId(_1d).set("checked",true);});});},fncfreeformataddlinstructions:function(_21){var _22=_21;if(_22!=null&&_22!==""){_22=_22+"_";}else{_22="";}d.style(_22+"freeformatbeneficiary",{"display":"block"});d.style(_22+"freeformataddlinstructions",{"display":"block"});d.style(_22+"freeformatpaymentdetails",{"display":"block"});},fncfreeformatpaymentdetails:function(_23){var _24=_23;if(_24!=null&&_24!==""){_24=_24+"_";}else{_24="";}d.style(_24+"freeformatbeneficiary",{"display":"block"});d.style(_24+"freeformataddlinstructions",{"display":"block"});d.style(_24+"freeformatpaymentdetails",{"display":"block"});},fncfreeformatbeneficiary:function(_25){var _26=_25;if(_26!=null&&_26!==""){_26=_26+"_";}else{_26="";}d.style(_26+"freeformatbeneficiary",{"display":"block"});d.style(_26+"freeformataddlinstructions",{"display":"block"});d.style(_26+"freeformatpaymentdetails",{"display":"block"});},_fncChangePaymentTypeRequired:function(_27,_28,_29){var _2a=_29;if(_2a!=null&&_2a!==""){_2a=_2a+"_";}else{_2a="";}if("free_format_field"===_27){m.toggleRequired(_2a+"payment_type",true);m.changeRequiredFieldsOnPaymentTypeChange(_29);}if("bank_instruction_field"===_27){m.toggleRequired(_2a+"payment_type",false);m.changeRequiredFieldsOnPaymentTypeChange(_29);}},_fncRemoveRequiredOnFields:function(_2b){d.query("#"+_2b+" input[aria-required=true]").forEach(function(_2c){dj.byId(dj.byId(_2c).id).set("required",false);});},_fncChangeRequiredFieldsOnChange:function(_2d,_2e){if(_2e!=null&&_2e!==""){_2e=_2e+"_";}else{_2e="";}var _2f=dj.byId(_2d).get("value");var _30=dj.byId(_2e+"payment_type").get("value");var _31;var _32;if(_2e+"beneficiary_account"===_2d){_31=[_2e+"beneficiary_address",_2e+"beneficiary_city",_2e+"beneficiary_country"];if(_2f===""){_32=false;}else{if(_30==="01"){_32=true;}}}else{if(_2e+"beneficiary_address"===_2d){_31=[_2e+"beneficiary_account"];if(_2f===""){_32=false;}else{if(_30==="01"){_32=true;}}}}},_fncChangeIntermediaryRequiredFieldsOnChange:function(_33){var _34=[_33+"intermediary_bank",_33+"intermediary_bank_street",_33+"intermediary_bank_city",_33+"intermediary_bank_country"];var _35=false;var _36=[_33+"intermediary_bank",_33+"intermediary_bank_city",_33+"intermediary_bank_country"];d.forEach(_34,function(_37){if(dj.byId(_37).get("value")!==""){_35=true;}});d.forEach(_36,function(_38){dj.byId(_38).set("required",_35);});},_fncChangeDisabledAdditionalDetailsFiels:function(_39,_3a){if(dj.byId(_39+"_line_1_input")){dj.byId(_39+"_line_1_input").set("disabled",_3a);}if(dj.byId(_39+"_line_2_input")){dj.byId(_39+"_line_2_input").set("disabled",_3a);}if(dj.byId(_39+"_line_3_input")){dj.byId(_39+"_line_3_input").set("disabled",_3a);}if(dj.byId(_39+"_line_4_input")){dj.byId(_39+"_line_4_input").set("disabled",_3a);}},_fncConstructCustomerPaymentGrid:function(_3b,_3c,_3d,_3e,_3f){var _40;if(_3e!=null&&_3e!==""){_3e=_3e+"_";}else{_3e="";}var _41=new d.data.ItemFileReadStore({data:_3b});var _42=[{field:"currency",name:"Ccy",width:"50px"},{field:"account",name:"Account",width:"100px",center:"true"},{field:"instruction_indicator",name:"Instruction ID",width:"auto"}];_40=new misys.grid.EnhancedGrid({query:{id:"*"},store:_41,id:_3c,name:_3c,structure:_42,height:"100px",noDataMessage:"No Instructions Found",xmlTagName:_3e+"customer_payment",onSelected:function(_43){_1=_40.selection.getSelected();m.selectIndex(_43,_3c,_3d);var xml=_40.toXML();},plugins:{indirectSelection:{name:"Select",width:"50px",styles:"text-align: center;"}},selectionMode:"single"},document.createElement("div"));d.byId(_3e+"customerPayment").appendChild(_40.domNode);_40.startup();},_fncConstructBankPaymentGrid:function(_44,_45,_46,_47,_48){var _49;if(_47!=null&&_47!==""){_47=_47+"_";}else{_47="";}var _4a=new d.data.ItemFileReadStore({data:_44});var _4b=[{field:"currency",name:"Ccy",width:"4%"},{field:"account",name:"Account",width:"15%"},{field:"instruction_indicator",name:"Instruction ID","text-align":"center",width:"10%"},{field:"beneficiary_institution",name:"Beneficiary",width:"15%"},{field:"beneficiary_bank_bic",name:"Beneficiary Swift ID",width:"10%"},{field:"beneficiary_account",name:"Beneficiary Account",width:"15%"},{field:"institution_account",name:"Beneficiary Bank",width:"15%"},{field:"account_with_institution_BIC",name:"Beneficiary Bank SWIFT ID",width:"12%"},{field:"action_link",name:" ",width:"4%",formatter:function(_4c){return "<img src= '"+misys.getContextualURL("content/images/preview.png")+"'//>";}}];if(!dj.byId(_47+"bankPaymentGrid")){d.style(_47+"bankPayment",{"display":"block"});_49=new misys.grid.EnhancedGrid({query:{id:"*"},store:_4a,id:_45,name:_45,structure:_4b,rowsPerPage:500,height:"170px",noDataMessage:"No Instructions Found",xmlTagName:_47+"bank_payment",onSelected:function(_4d){m._selectIndex(_4d,_45,_46,_47);var xml=_49.toXML();},plugins:{indirectSelection:{name:"Select",width:"50px",styles:"text-align: center;"}},selectionMode:"single"},document.createElement("div"));d.byId(_47+"bankPayment").appendChild(_49.domNode);d.connect(_49,"onRowClick",_49,function(evt){var idx=evt.rowIndex,_4e=evt.cell.field,_4f=this.getItem(idx);if(_4e==="action_link"){m.showSiDialog(_4f,_47);}});_49.startup();}else{d.style(_47+"bankPayment",{"display":"block"});m._fncClearTable(_47+"bankPaymentGrid");_49=dj.byId(_47+"bankPaymentGrid");d.byId(_47+"bankPayment").appendChild(_49.domNode);_49.setStore(_4a);_49.startup();}return _49;},_fncSetGridSelectedId:function(_50,_51){if(_50!=null&&_51!=null){var _52=dj.byId(_50);if(_51!=null){var _53=0;var len=_52.get("store")._arrayOfTopLevelItems.length;if((len===1)&&(_52.get("store")._arrayOfTopLevelItems[0].instruction_indicator==m.getLocalization("instructionComplete"))){_52.selection.select(0);}else{for(var i=0;i<len;i++){_53++;if(_52.get("store")._arrayOfTopLevelItems[i].instruction_indicator==_51){_52.scrollToRow(_53-1);_52.selection.select(_53-1+"");}}}}}},_selectIndex:function(_54,_55,_56,_57){return m.selectIndex(_54,_55,_56);},performClear:function(_58,_59,_5a){if(_58!=null&&_58!==""){_58=_58+"_";}else{_58="";}var _5b;if(_59===1){m._fncClearTable(_58+"customerPaymentGrid");dj.byId(_58+"payment_instructions_id").set("value","");}else{if(_59===2){m._fncClearTable(_58+"bankPaymentGrid");dj.byId(_58+"receipt_instructions_id").set("value","");_5b=d.query("#"+_58+"bank_instruction_field .dijitInputContainer input");m._fncChangeDisabledAdditionalDetailsFiels(_58+"additional_details",true);}else{if(_59===3){if(!_5a){m._fncRemoveRequiredOnFields(_58+"free_format_field");}_5b=d.query("#"+_58+"free_format_field .dijitInputContainer input");}}}d.forEach(_5b,function(_5c){if(!(_5c.id.match("payment_cur")!=null||_5c.id.match("payment_amt")!=null||_5c.id.match("payment_type")!=null)){_5c.value="";}if(_5c.id===("beneficiary_bank_bic")||_5c.id===("beneficiary_bank")||_5c.id===("beneficiary_bank_branch")||_5c.id===("beneficiary_bank_address")||_5c.id===("beneficiary_bank_city")||_5c.id===("beneficiary_bank_country")||_5c.id===("intermediary_bank_bic")||_5c.id===("intermediary_bank")||_5c.id===("intermediary_bank_street")||_5c.id===("intermediary_bank_city")||_5c.id===("intermediary_bank_country")){dj.byId(_5c.id).set("disabled",false);}if(_5c.id===("beneficiary_bank_bic")||_5c.id===("beneficiary_bank_branch")||_5c.id===("beneficiary_bank_address")||_5c.id===("intermediary_bank_bic")||_5c.id===("intermediary_bank")||_5c.id===("intermediary_bank_street")||_5c.id===("intermediary_bank_city")||_5c.id===("intermediary_bank_country")){m.toggleRequired(_5c.id,false);}if(_5c.id===("beneficiary_bank")||_5c.id===("beneficiary_bank_city")||_5c.id===("beneficiary_bank_country")){m.toggleRequired(_5c.id,true);}if(!dj.byId("swift_charges_type_1").checked){dj.byId("swift_charges_type_1").set("checked",true);}});},selectIndex:function(){return [];},changeRequiredFieldsOnPaymentTypeChange:function(_5d,_5e){if(_5d!=null&&_5d!==""){_5d=_5d+"_";}else{_5d="";}var _5f;var _60;var _61=dj.byId(_5d+"payment_type").get("value");if("01"===_61&&!_5e){_5f=[];if(document.getElementById("instructions_type_1")&&dj.byId("instructions_type_1").checked){_60=[];_5f=[_5d+"beneficiary_name",_5d+"beneficiary_bank",_5d+"beneficiary_bank_city",_5d+"beneficiary_bank_country",_5d+"beneficiary_address",_5d+"beneficiary_city",_5d+"beneficiary_country",_5d+"beneficiary_account",_5d+"beneficiary_address_2"];}else{_60=[_5d+"beneficiary_name",_5d+"beneficiary_bank",_5d+"beneficiary_bank_city",_5d+"beneficiary_bank_country",_5d+"beneficiary_address",_5d+"beneficiary_city",_5d+"beneficiary_country",_5d+"beneficiary_account"];}}else{if("02"===_61&&!_5e){_5f=[_5d+"beneficiary_bank",_5d+"beneficiary_bank_city",_5d+"beneficiary_bank_country"];_60=[_5d+"beneficiary_name",_5d+"beneficiary_address",_5d+"beneficiary_city",_5d+"beneficiary_country"];}else{_5f=[_5d+"beneficiary_name",_5d+"beneficiary_bank",_5d+"beneficiary_bank_city",_5d+"beneficiary_bank_country",_5d+"beneficiary_address",_5d+"beneficiary_city",_5d+"beneficiary_country",_5d+"beneficiary_account"];}}d.forEach(_5f,function(_62){m.toggleRequired(_62,false);});d.forEach(_60,function(_63){m.toggleRequired(_63,true);});},toggleBeneficiaryFields:function(_64,_65,_66,_67){var arr=["_bank","_bank_branch","_bank_address","_bank_city","_bank_country","_bank_street","_bank_street_2"];var _68;if(_64!==""){for(var _69=0;_69<arr.length;_69++){_68=_65+arr[_69];if(dj.byId(_68)){dj.byId(_68).set("required",false);dj.byId(_68).set("disabled",true);dj.byId(_68).set("value","");d.query("#"+_68+"_row label span").style("display","none");d.query("#"+_66).style("display","none");}}}else{for(_69=0;_69<arr.length;_69++){_68=_65+arr[_69];if(dj.byId(_68)){if(_67){dj.byId(_68).set("required",true);}dj.byId(_68).set("disabled",false);var _6a="#"+_68+"_row label span";d.query("#"+_68+"_row label span").style("display","inline-block");d.query("#"+_66).style("display","inline-block");}}}var _6b=["beneficiary_bank_branch","beneficiary_bank_address"];d.forEach(_6b,function(_6c){m.toggleRequired(_6c,false);});},toggleBICFields:function(_6d,_6e){if(_6d!==""){if(dj.byId(_6e)){dj.byId(_6e).set("disabled",true);dj.byId(_6e).set("value","");m.toggleRequired(_6e,false);}}else{if(dj.byId(_6e)){dj.byId(_6e).set("disabled",false);m.toggleRequired(_6e,true);}}var _6f=["intermediary_bank_bic"];d.forEach(_6f,function(_70){m.toggleRequired(_70,false);});}});})(dojo,dijit,misys);}