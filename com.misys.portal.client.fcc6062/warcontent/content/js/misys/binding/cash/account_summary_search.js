/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.cash.account_summary_search"]){dojo._hasResource["misys.binding.cash.account_summary_search"]=true;dojo.provide("misys.binding.cash.account_summary_search");dojo.require("misys.validation.common");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.Select");dojo.require("misys.form.common");dojo.require("misys.widget.Dialog");dojo.require("dijit.form.ValidationTextBox");(function(d,dj,m){var _1=true;function _2(){var _3=dj.byId("export_list");if(_3!="screen"){var _4="AccountSummary."+_3;dj.byId("filename").set("value",_4);}if(dj.byId("export_list").get("value")==="screen"){dj.byId("export_list").set("value","");}};function _5(){var _6=null;var _7=null;if(dj.byId("bank_abbv_name")){_7=dj.byId("bank_abbv_name");}if(dj.byId("entity")&&dj.byId("entity").get("value")!==""){_6=dj.byId("entity").get("value");}else{_6="All";}if(misys._config.entityBanksMap){var _8=null;_8=m._config.entityBanksMap[_6];if(_8&&_7){_7.store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_8}});_7.fetchProperties={sort:[{attribute:"name"}]};}}};function _9(){if(dj.byId("account_no")){dj.byId("account_no").set("value","");dj.byId("account_id").set("value","");}if(dj.byId("bank_abbv_name")){dj.byId("bank_abbv_name").set("value","");}_5();};function _a(){if(_1&&dj.byId("account_no")){dj.byId("account_no").set("value","");}_1=true;};function _b(_c,_d,_e){var _f=_d||misys.getLocalization("transactionPopupWindowTitle"),_10=_e||"width=800,height=500,resizable=yes,scrollbars=yes",_11=d.global.open(_c,_f,_10);if(!_11.opener){_11.opener=self;}_11.focus();};d.mixin(m,{bind:function(){m.connect("submit","onClick",m.submit);},submit:function(){if(dj.byId("entity")&&dj.byId("entity").get("value")===""){m.dialog.show("ERROR",m.getLocalization("entityNotSelectedError"));e.preventDefault();}else{if(dj.byId("export_list").get("value")==="screen"){dj.byId("export_list").set("value","");}if(dj.byId("bank_abbv_name")&&dj.byId("bank_abbv_name").get("value")===""){dj.byId("bank_abbv_name").set("required",false);}if(dj.byId("account_no").get("value")===""){dj.byId("account_id").set("value","");}if(dj.byId("export_list").get("value")===""){dj.byId("account_no").set("disabled",true);}dj.byId("TransactionSearchForm").submit();}},exportABSummaryListToFormat:function(_12){_12=_12.toUpperCase();var _13=dj.byId("entity")?dj.byId("entity").get("value"):"";var url=["/screen/AccountBalanceScreen?operation=LIST_BALANCES"];url.push("&export_list=",_12);url.push("&filename=","AccountSummary.pdf");url.push("&in_memory_export=","true");url.push("&type=","export");url.push("&entity=",_13);url.push("&account_no=",dj.byId("account_no").get("value"));url.push("&account_ccy=",dj.byId("account_ccy").get("value"));url.push("&bank_abbv_name=",dj.byId("bank_abbv_name").get("value"));_b(misys.getServletURL(url.join("")));},onFormLoad:function(){m.connect("export_list","onChange",_2);m.connect("entity","onBlur",function(){dj.byId("account_no").set("value","");dj.byId("account_no").set("displayedValue","");});m.setValidation("account_ccy",m.validateCurrency);m.toggleRequired("entity",true);m.connect("entity","onChange",_9);m.connect("bank_abbv_name","onChange",_a);m.connect("submit","onClick",m.submit);m.connect("account_no","onChange",function(){if(dj.byId("bank_abbv_name")&&dj.byId("account_no")&&dj.byId("account_no").get("value")!==""){if(dj.byId("bank_abbv_name")&&dj.byId("bank_abbv_name").get("value")===""){_1=false;}dj.byId("bank_abbv_name").set("value",m._config.customerBankName);}});m.connect("account_no","onBlur",function(){if(dj.byId("account_no")&&dj.byId("account_id")&&dj.byId("account_no").get("value")===""){dj.byId("account_id").set("value","");}});_5();if(dj.byId("bank_name_hidden")&&dj.byId("bank_name_hidden").get("value")!==""&&dj.byId("bank_abbv_name")){if(dj.byId("bank_abbv_name").get("value")===""){_1=false;}dj.byId("bank_abbv_name").set("value",dj.byId("bank_name_hidden").get("value"));}m.toggleRequired("entity",true);m.toggleRequired("bank_abbv_name",false);if(dj.byId("account_no").get("value")===""&&_1==="true"){m.dialog.show("ERROR",m.getLocalization("accountInputError"));return;}},checkEntityForAccount:function(_14,_15,_16,_17){if(dj.byId("entity")&&dj.byId("entity").get("value")===""){m.dialog.show("ERROR",m.getLocalization("entitynotselected"));return;}misys.showSearchUserAccountsDialog("useraccount","['','"+_14+"','"+_15+"','','','','','','','','','','customer_associated_bank']","","entity","","","width:650px;height:400px;",_16,_17);}});})(dojo,dijit,misys);dojo.require("misys.client.binding.cash.account_summary_search_client");}