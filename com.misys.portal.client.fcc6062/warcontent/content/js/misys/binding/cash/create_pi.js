/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.cash.create_pi"]){dojo._hasResource["misys.binding.cash.create_pi"]=true;dojo.provide("misys.binding.cash.create_pi");dojo.require("dojo.parser");dojo.require("dijit.layout.TabContainer");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("misys.form.PercentNumberTextBox");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.widget.Collaboration");dojo.require("misys.form.common");dojo.require("misys.form.file");dojo.require("misys.validation.common");dojo.require("misys.binding.cash.ft_common");dojo.require("misys.form.BusinessDateTextBox");dojo.require("misys.binding.core.beneficiary_advice_common");(function(d,dj,m){var _1=false;var _2=true;var _3=false;function _4(_5,_6){if(_5){if(dj.byId("reauth_dialog_content")){dj.byId("reauth_dialog_content").destroyRecursive();}dojo.byId("reauth_dialog_content").innerHTML=_5;dojo.parser.parse("reauth_dialog_content");var _7=dj.byId("reauth_dialog");_7.show();}else{alert("no need of reauth dialog");}};function _8(_9){var _a=function(){var _b=dijit.byId("ft_amt");_b.set("state","Error");m.defaultBindTheFXTypes();dj.byId("ft_amt").set("value","");if(dj.byId("ft_cur_code")&&!dj.byId("ft_cur_code").get("readOnly")){dj.byId("ft_cur_code").set("value","");}};m.dialog.show("ERROR",_9,"",function(){setTimeout(_a,500);});if(d.byId("fx-section")&&(d.style(d.byId("fx-section"),"display")!=="none")){m.animate("wipeOut",d.byId("fx-section"));}};function _c(){var _d=true;var _e="";var _f=dj.byId("fx_rates_type_2");var _10=dj.byId("fx_total_utilise_amt");var _11=dj.byId("ft_amt");if(_f.get("checked")&&_10&&!isNaN(_10.get("value"))&&_11&&!isNaN(_11.get("value"))){if(_11.get("value")<_10.get("value")){_e+=m.getLocalization("FXUtiliseAmtGreaterMessage");_d=false;}}m._config.onSubmitErrorMsg=_e;return _d;};function _12(){var _13=dj.byId("entity")?dj.byId("entity").get("value"):"",_14=dj.byId("applicant_act_name"),_15="";if(_13.get("value")===""||_14.get("value")===""){_15=misys.getLocalization("remittanceToolTip",[_13.get("value"),_14.get("value")]);if("S"+_13.get("value")==="S"){_13.focus();_13.set("state","Error");dj.hideTooltip(_13.domNode);dj.showTooltip(_15,_13.domNode,0);}if("S"+_14.get("value")==="S"){_14.focus();_14.set("state","Error");dj.hideTooltip(_14.domNode);dj.showTooltip(_15,_14.domNode,0);}}if(dj.byId("applicant_act_name").get("value")!==""){m.toggleSections();m.handleParametersConfigurations();m.showRecurring();}d.forEach(dojo.query(".piDisclaimer"),function(_16){m.animate("fadeOut",_16);});};var _17={};_17.fields=["beneficiary_name","beneficiary_name_2","beneficiary_name_3","beneficiary_address","beneficiary_city","beneficiary_dom","beneficiary_address_line_4","beneficiary_postal_code","beneficiary_country","pre_approved"];_17.toggleEditable=function(){d.forEach(this.fields,function(_18,i){if(dj.byId(_18)){dj.byId(_18).set("readOnly",false);}});};_17.toggleReadonly=function(_19){m.toggleFieldsReadOnly(this.fields,_19);};_17.clear=function(){d.forEach(this.fields,function(_1a,i){if(dj.byId(_1a)){dj.byId(_1a).set("value","");}});if(dj.byId("beneficiary_country_btn_img")){dj.byId("beneficiary_country_btn_img").set("disabled",false);}d.style("pre_approved_benificiary","display","none");};function _1b(){var _1c=dj.byId("applicant_act_pab").get("value");if(_1c==="Y"){_17.toggleReadonly(true);}else{_17.toggleReadonly(false);}d.style("pre_approved_benificiary","display","none");_17.clear();dj.byId("pre_approved_status").set("value","N");m.clearBeneficiaryAdviceFieldsForDefaultingFromBeneMaster();};function _1d(){var _1e=dj.byId("regexValue");var _1f=dj.byId("allowedProducts");var _20=dj.byId("product_type");var _21=_1e?dj.byId("regexValue").get("value"):"";var _22=_1f?dj.byId("allowedProducts").get("value"):"";var _23=_20?dj.byId("product_type").get("value"):"";var _24=dj.byId("beneficiary_name");var _25=_24?dj.byId("beneficiary_name").get("value"):"";var _26=dj.byId("beneficiary_name_2");var _27=_26?dj.byId("beneficiary_name_2").get("value"):"";var _28=dj.byId("beneficiary_name_3");var _29=_28?dj.byId("beneficiary_name_3").get("value"):"";var _2a=new RegExp(_21);var _2b=false;var _2c=false;var _2d=false;var _2e=m.getLocalization("invalidBeneficiaryName");if(_22.indexOf(_23)<0){if(_21!==null&&_21!==""&&_25!==""&&_25!==null){_2b=_2a.test(_25);if(!_2b){_24.set("state","Error");dj.hideTooltip(_24.domNode);dj.showTooltip(_2e,_24.domNode,0);}}if(_21!==null&&_21!==""&&_27!==""&&_27!==null){_2c=_2a.test(_27);if(!_2c){_26.set("state","Error");dj.hideTooltip(_26.domNode);dj.showTooltip(_2e,_26.domNode,0);}}if(_21!==null&&_21!==""&&_29!==""&&_29!==null){_2d=_2a.test(_29);if(!_2d){_28.set("state","Error");dj.hideTooltip(_28.domNode);dj.showTooltip(_2e,_28.domNode,0);}}}else{m._config.forceSWIFTValidation=false;}};function _2f(){var _30=dj.byId("beneficiary_name").get("value");_1d();if(_30!==""){if(dj.byId("pre_approved_status")&&dj.byId("pre_approved_status").get("value")==="Y"){if(m._config.non_pab_allowed){d.style("pre_approved_benificiary","display","inline");_17.toggleReadonly(true);}else{d.style("pre_approved_benificiary","display","none");}if(dj.byId("beneficiary_country_btn_img")){dj.byId("beneficiary_country_btn_img").set("disabled",true);}}else{d.style("pre_approved_benificiary","display","none");if((dj.byId("pre_approved")&&dj.byId("pre_approved").get("value")==="")||dj.byId("pre_approved").get("value")===null){_17.toggleReadonly(false);if(dj.byId("beneficiary_country_btn_img")){dj.byId("beneficiary_country_btn_img").set("disabled",false);}}else{_17.toggleReadonly(true);if(dj.byId("beneficiary_country_btn_img")){dj.byId("beneficiary_country_btn_img").set("disabled",true);}}}}};function _31(){if(dj.byId("adv_send_mode")){if(dj.byId("adv_send_mode").get("value")==="08"){d.style("delivery_mode_08_div","display","block");d.style("delivery_mode_09_div","display","none");m.toggleFields(false,null,["mailing_other_name_address","mailing_other_postal_code","mailing_other_country"]);m.toggleFields(true,null,["collecting_bank_code","collecting_branch_code","collectors_name","collectors_id"]);dj.byId("collecting_bank_code").set("readOnly",true);dj.byId("collecting_branch_code").set("readOnly",true);}else{if(dj.byId("adv_send_mode").get("value")==="09"){d.style("delivery_mode_09_div","display","block");d.style("delivery_mode_08_div","display","none");m.toggleFields(false,null,["collecting_bank_code","collecting_branch_code","collectors_name","collectors_id"]);m.toggleFields(true,null,["mailing_other_name_address","mailing_other_postal_code","mailing_other_country"]);}else{d.style("delivery_mode_08_div","display","none");d.style("delivery_mode_09_div","display","none");m.toggleFields(false,null,["collecting_bank_code","collecting_branch_code","collectors_name","collectors_id","mailing_other_name_address","mailing_other_postal_code","mailing_other_country"]);}}}};function _32(){var _33=dj.byId("applicant_act_pab").get("value");if(_33=="Y"){dj.byId("beneficiary_name").set("readOnly",true);if(dj.byId("beneficiary_country_btn_img")){dj.byId("beneficiary_country_btn_img").set("disabled",true);}}else{if(m._config.non_pab_allowed){dj.byId("beneficiary_name").set("readOnly",false);}else{dj.byId("beneficiary_name").set("readOnly",true);}if(dj.byId("beneficiary_country_btn_img")){dj.byId("beneficiary_country_btn_img").set("disabled",false);}}dojo.forEach(["pre_approved","ft_amt","beneficiary_account","beneficiary_address","beneficiary_city","","beneficiary_dom","pre_approved_status","","","cpty_bank_name","cpty_bank_address_line_1","cpty_bank_address_line_2","cpty_bank_dom","cpty_branch_address_line_1","cpty_branch_address_line_2","cpty_branch_dom","","","cpty_bank_swift_bic_code","cpty_bank_code","cpty_branch_code","cpty_branch_name","","beneficiary_name","beneficiary_name_2","beneficiary_name_3","beneficiary_address_line_4","bene_adv_beneficiary_id_no_send","bene_adv_mailing_name_add_1_no_send","bene_adv_mailing_name_add_2_no_send","bene_adv_mailing_name_add_3_no_send","bene_adv_mailing_name_add_4_no_send","bene_adv_mailing_name_add_5_no_send","bene_adv_mailing_name_add_6_no_send","bene_adv_postal_code_no_send","bene_adv_country_no_send","bene_email_1","bene_email_2","beneficiary_postal_code","beneficiary_country","bene_adv_fax_no_send","bene_adv_ivr_no_send","bene_adv_phone_no_send"],function(_34){if(dj.byId(_34)){dj.byId(_34).set("value","");}});if(d.byId("fx-section")&&(d.style(d.byId("fx-section"),"display")!=="none")){m.animate("wipeOut",d.byId("fx-section"));}if(d.byId("clear_img")){if(_33=="Y"&&d.style(d.byId("clear_img"),"display")!=="none"){m.animate("wipeOut",d.byId("clear_img"));}else{if(_33=="N"&&d.style(d.byId("clear_img"),"display")=="none"){m.animate("wipeIn",d.byId("clear_img"));}}}};function _35(){var _36=dj.byId("applicant_act_no").get("value");if(_36===""){m.dialog.show("ERROR",m.getLocalization("selectDebitFirst"));return;}var _37=dj.byId("entity")?dj.byId("entity").get("value"):"";m.showSearchDialog("beneficiary_accounts","['beneficiary_name','beneficiary_account','change_cur_code', 'beneficiary_address', 'beneficiary_city', 'beneficiary_address_line_4', 'beneficiary_dom', 'pre_approved_status', 'beneficiary_name_2', 'beneficiary_name_3', 'beneficiary_bank_name', 'beneficiary_bank_address_line_1', 'beneficiary_bank_address_line_2', 'beneficiary_bank_dom', 'beneficiary_branch_address_line_1', 'beneficiary_branch_address_line_2', 'beneficiary_branch_dom', 'beneficiary_bank_country', 'change_iso_code', 'beneficiary_bank_swift_bic_code', 'beneficiary_bank_code', 'beneficiary_branch_code', 'beneficiary_branch_name','pre_approved', 'change_threshold','change_threshold_curcode'"+",'bene_adv_beneficiary_id_no_send','bene_adv_mailing_name_add_1_no_send','bene_adv_mailing_name_add_2_no_send','bene_adv_mailing_name_add_3_no_send','bene_adv_mailing_name_add_4_no_send'"+",'bene_adv_mailing_name_add_5_no_send','bene_adv_mailing_name_add_6_no_send','bene_adv_postal_code_no_send','bene_adv_country_no_send','','','beneficiary_postal_code','beneficiary_country']",{product_type:dijit.byId("sub_product_code").get("value"),entity_name:_37,pabAccStat:dijit.byId("applicant_act_pab").get("value"),debitAcctNo:_36},"",dijit.byId("sub_product_code").get("value"),"width:710px;height:350px;",m.getLocalization("ListOfBeneficiriesTitleMessage"));m.clearBeneficiaryAdviceFieldsForDefaultingFromBeneMaster();};function _38(){var _39=null;var _3a=dj.byId("customer_bank").get("value");if(misys&&misys._config&&misys._config.businessDateForBank&&misys._config.businessDateForBank[_3a]&&misys._config.businessDateForBank[_3a][0]&&misys._config.businessDateForBank[_3a][0].value!==""){var _3b=misys._config.businessDateForBank[_3a][0].value;var _3c=_3b.substring(0,4);var _3d=_3b.substring(5,7);var _3e=_3b.substring(8,10);_3b=_3e+"/"+_3d+"/"+_3c;var _3f=new Date(_3c,_3d-1,_3e);if(dj.byId("option_for_app_date")&&(dj.byId("option_for_app_date").get("value")==="PIDD"||dj.byId("option_for_app_date").get("value")==="PICO")){dj.byId("appl_date").set("value",_3b);document.getElementById("appl_date_view_row").childNodes[1].innerHTML=_3b;dj.byId("appl_date_hidden").set("value",_3f);}dj.byId("todays_date").set("value",_3f);}if(!_1&&!_2){dj.byId("applicant_act_name").set("value","");dj.byId("applicant_act_no").set("value","");dj.byId("applicant_act_cur_code").set("value","");dj.byId("applicant_act_description").set("value","");dj.byId("applicant_act_pab").set("value","");dj.byId("applicant_reference").set("value","");dj.byId("adv_send_mode").set("value","");dj.byId("issuing_bank_abbv_name").set("value",_3a);_39=misys._config.customerBankDetails[_3a][0].value;dj.byId("issuing_bank_name").set("value",_39);}if(!_1){dj.byId("issuing_bank_abbv_name").set("value",_3a);_39=misys._config.customerBankDetails[_3a][0].value;dj.byId("issuing_bank_name").set("value",_39);}_1=false;if(dj.byId("customer_bank")&&_3a!==""){_2=false;if(dj.byId("issuing_bank_abbv_name").get("value")!==""){_39=misys._config.customerBankDetails[_3a][0].value;dj.byId("issuing_bank_name").set("value",_39);}}m.initializeFX(dj.byId("sub_product_code").get("value"),dj.byId("issuing_bank_abbv_name").get("value"));if(dj.byId("applicant_act_cur_code")&&dj.byId("applicant_act_cur_code").get("value")!==""&&dj.byId("ft_cur_code")&&dj.byId("ft_cur_code").get("value")!==""&&dj.byId("applicant_act_cur_code").get("value")!==dj.byId("ft_cur_code").get("value")&&!isNaN(dj.byId("ft_amt").get("value"))){m.onloadFXActions();}else{m.defaultBindTheFXTypes();}_40();};function _40(){var _41=dj.byId("sub_product_code").get("value");if(dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""&&m._config.fxParamData&&m._config.fxParamData[_41][dj.byId("issuing_bank_abbv_name").get("value")].isFXEnabled==="Y"){m.connect("ft_cur_code","onBlur",function(){m.setCurrency(this,["ft_amt"]);if(dj.byId("ft_cur_code").get("value")!==""&&!isNaN(dj.byId("ft_amt").get("value"))){m.fireFXAction();}else{m.defaultBindTheFXTypes();}});m.connect("ft_cur_code","onChange",function(){m.setCurrency(this,["ft_amt"]);if(dj.byId("ft_cur_code").get("value")!==""&&!isNaN(dj.byId("ft_amt").get("value"))){m.fireFXAction();}else{m.defaultBindTheFXTypes();}});m.connect("ft_amt","onBlur",function(){m.setTnxAmt(this.get("value"));var _42="";if(dj.byId("ft_cur_code")){_42=dj.byId("ft_cur_code").get("value");}if(!isNaN(dj.byId("ft_amt").get("value"))&&_42!==""){m.fireFXAction();}else{m.defaultBindTheFXTypes();}});}else{if(d.byId("fx-section")){d.style("fx-section","display","none");}}if(dijit.byId("ft_cur_code")&&dijit.byId("ft_amt")){misys.setCurrency(dijit.byId("ft_cur_code"),["ft_amt"]);}};function _43(){var _44=dj.byId("customer_bank");var _45=_44?_44.get("value"):"";var _46=dj.byId("sub_product_code")?dj.byId("sub_product_code").get("value"):"";var _47=dj.byId("adv_send_mode");var _48=dj.byId("issuing_bank_abbv_name");var _49=dj.byId("issuing_bank_name");if(_45!==""){if(_48){_48.set("value",_45);}if(misys._config.customerBankDetails&&_49){_49.set("value",misys._config.customerBankDetails[_45][0].value);}}if(misys._config.isMultiBank&&_45!==""&&_46!==""){m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/GetParamDataForPIAction"),handleAs:"json",sync:true,content:{customer_bank:_45,sub_product_code:_46},load:function(_4a,_4b){_47.set("store",new dojo.data.ItemFileReadStore({data:_4a.deliveryModes}));}});}};function _4c(){var _4d=dj.byId("customer_bank");var _4e=_4d?_4d.get("value"):"";var _4f=dj.byId("ft_cur_code");var _50=dijit.byId("sub_product_code");if(_4d){if(_4e===""){_4f.set("value","");}else{if(_4e!==""&&_4f&&_50&&_50.get("value")==="PICO"&&misys._config.bankBaseCurCode){_4f.set("value",misys._config.bankBaseCurCode[_4e]);}}}};function _51(){var _52=dj.byId("customer_bank");var _53=d.byId("recurring_payment_checkbox");if(_52&&_52.get("value")!==""&&misys._config.perBankRecurringAllowed){var _54=misys._config.perBankRecurringAllowed[_52.get("value")];if(_54==="Y"&&_53){m.animate("fadeIn",_53);}else{if(dj.byId("recurring_flag")){dj.byId("recurring_flag").set("checked",false);}if(_53){m.animate("fadeOut",_53);}if(d.byId("recurring_payment_div")){d.style("recurring_payment_div","display","none");}}}else{m.animate("fadeOut",_53);}};function _55(){var _56=dj.byId("applicant_act_cur_code").get("value");var _57=dj.byId("ft_cur_code").get("value");if(_56!==""&&_57!==""&&_56!==_57){if(dj.byId("sub_product_code").get("value")==="PICO"){m.dialog.show("ERROR",m.getLocalization("mismatchFrom"));}else{m.dialog.show("ERROR",m.getLocalization("crossCurrency"));}dj.byId("applicant_act_name").set("value","");dj.byId("applicant_act_cur_code").set("value","");if(dj.byId("sub_product_code").get("value")!=="PICO"){dj.byId("ft_cur_code").set("value","");}dj.byId("ft_amt").set("value","");return;}};d.mixin(m._config,{initReAuthParams:function(){var _58={productCode:"FT",subProductCode:dj.byId("sub_product_code")?dj.byId("sub_product_code").get("value"):"",transactionTypeCode:"01",entity:dj.byId("entity")?dj.byId("entity").get("value"):"",currency:dj.byId("ft_cur_code")?dj.byId("ft_cur_code").get("value"):"",amount:dj.byId("ft_amt")?m.trimAmount(dj.byId("ft_amt").get("value")):"",bankAbbvName:dj.byId("customer_bank")?dj.byId("customer_bank").get("value"):"",es_field1:dj.byId("ft_amt")?m.trimAmount(dj.byId("ft_amt").get("value")):"",es_field2:(dj.byId("beneficiary_account"))?dj.byId("beneficiary_account").get("value"):""};return _58;}});d.mixin(m,{fireFXAction:function(){if(m._config.fxParamData&&dj.byId("sub_product_code")&&dj.byId("sub_product_code").get("value")!==""&&dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""){var _59=m._config.fxParamData[dj.byId("sub_product_code").get("value")][dj.byId("issuing_bank_abbv_name").get("value")];if(m._config.fxParamData&&_59.isFXEnabled==="Y"){var _5a,_5b;var _5c=dj.byId("ft_cur_code").get("value");var _5d=dj.byId("ft_amt").get("value");var _5e=dj.byId("applicant_act_cur_code").get("value");var _5f=m._config.productCode;var _60="";if(dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""){_60=dj.byId("issuing_bank_abbv_name").get("value");}var _61=dj.byId("applicant_act_cur_code").get("value");var _62=false;if(_5c!==""&&_5f!==""&&_60!==""){if(_5c!==_5e){_5a=_5e;_5b=_5c;_61=_5e;}if(_5a&&_5a!==""&&_5b&&_5b!==""&&!isNaN(_5d)){if(d.byId("fx-section")&&(d.style(d.byId("fx-section"),"display")==="none")){m.animate("wipeIn",d.byId("fx-section"));}var _63=dj.byId("sub_product_code").get("value");m.fetchFXDetails(_5a,_5b,_5d,_5f,_60,_61,_62);if(dj.byId("fx_rates_type_1")&&dj.byId("fx_rates_type_1").get("checked")){if(isNaN(dj.byId("fx_exchange_rate").get("value"))||dj.byId("fx_exchange_rate_cur_code").get("value")===""||isNaN(dj.byId("fx_exchange_rate_amt").get("value"))||(_59.toleranceDispInd==="Y"&&(isNaN(dj.byId("fx_tolerance_rate").get("value"))||isNaN(dj.byId("fx_tolerance_rate_amt").get("value"))||dj.byId("fx_tolerance_rate_cur_code").get("value")===""))){_8(m.getLocalization("FXDefaultErrorMessage"));}}}else{if(d.byId("fx-section")&&(d.style(d.byId("fx-section"),"display")!=="none")){m.animate("wipeOut",d.byId("fx-section"));}m.defaultBindTheFXTypes();}}if(dj.byId("recurring_payment_enabled")&&dj.byId("recurring_payment_enabled").get("checked")&&dj.byId("fx_rates_type_2")){dj.byId("fx_rates_type_2").set("disabled",true);m.animate("wipeOut",d.byId("contracts_div"));}}}},bind:function(){m.setValidation("fx_tolerance_rate",m.validateToleranceAndExchangeRate);m.setValidation("fx_exchange_rate",m.validateToleranceAndExchangeRate);m.setValidation("template_id",m.validateTemplateId);m.connect("applicant_act_name","onChange",m.checkNickNameDiv);m.connect("beneficiary_name","onChange",m.checkBeneficiaryNicknameDiv);m.connect("applicant_act_no","onChange",_32);m.connect("entity","onClick",m.validateRequiredField);m.connect("applicant_act_name","onClick",m.validateRequiredField);m.connect("beneficiary_name","onClick",m.validateRequiredField);m.connect("beneficiary_address","onClick",m.validateRequiredField);m.connect("drawn_on_country","onClick",m.validateRequiredField);m.connect("customer_bank","onChange",function(){m.handleMultiBankRecurring(_3);_3=false;});m.bindRecurringFields();m.connect("entity","onChange",function(){dj.byId("applicant_act_name").set("value","");dj.byId("applicant_act_nickname").set("value","");_2=true;if(misys._config.isMultiBank&&dj.byId("customer_bank")){dj.byId("customer_bank").set("value","");m.populateCustomerBanks();_4c();}});m.connect("applicant_act_name","onChange",function(){var _64=dj.byId("currency_res").get("value");if(_64==="true"){_55();}});if(misys._config.isMultiBank){m.connect("customer_bank","onChange",function(){_4c();_38();_43();_51();});m.connect("applicant_act_name","onChange",function(){var _65=dj.byId("customer_bank");var _66=_65?_65.get("value"):"";var _67=dj.byId("applicant_act_name");if(_66!==m._config.customerBankName&&_67&&_67.get("value")!==""){_65.set("value",m._config.customerBankName);}var _68=dj.byId("currency_res").get("value");if(_68==="true"){_55();}});}m.connect("button_intrmdt_ok","onClick",_12);m.connect("beneficiary_img","onClick",_35);m.connect("clear_img","onClick",_1b);m.connect("beneficiary_name","onChange",_2f);m.setValidation("beneficiary_country",m.validateCountry);m.setValidation("mailing_other_country",m.validateCountry);m.setValidation("iss_date",m.validateCashProcessingDate);m.connect("iss_date","onClick",function(){m.clearDateCache();if(misys._config.isMultiBank){var _69;if(dijit.byId("customer_bank")){_69=dijit.byId("customer_bank").get("value");}if(_69!==""&&misys&&misys._config&&misys._config.businessDateForBank&&misys._config.businessDateForBank[_69][0]&&misys._config.businessDateForBank[_69][0].value!==""){var _6a=parseInt(misys._config.businessDateForBank[_69][0].value.substring(0,4),10);var _6b=parseInt(misys._config.businessDateForBank[_69][0].value.substring(5,7),10);var _6c=parseInt(misys._config.businessDateForBank[_69][0].value.substring(8,10),10);this.dropDown.currentFocus=new Date(_6a,_6b-1,_6c);}}});m.setValidation("ft_cur_code",m.validateCurrency);m.setValidation("drawn_on_country",m.validateCountry);m.setValidation("legal_country",m.drawn_on_country);m.connect("recurring_flag","onClick",m.showRecurring);m.connect("adv_send_mode","onChange",_31);var _6d=dj.byId("sub_product_code").get("value");if(dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""&&m._config.fxParamData&&m._config.fxParamData[_6d][dj.byId("issuing_bank_abbv_name").get("value")].isFXEnabled==="Y"){m.connect("ft_cur_code","onBlur",function(){m.setCurrency(this,["ft_amt"]);if(dj.byId("ft_cur_code").get("value")!==""&&!isNaN(dj.byId("ft_amt").get("value"))){m.fireFXAction();}else{m.defaultBindTheFXTypes();}});m.connect("ft_cur_code","onChange",function(){m.setCurrency(this,["ft_amt"]);if(dj.byId("ft_cur_code").get("value")!==""&&!isNaN(dj.byId("ft_amt").get("value"))){m.fireFXAction();}else{m.defaultBindTheFXTypes();}var _6e=dj.byId("currency_res").get("value");if(_6e==="true"&&dj.byId("sub_product_code").get("value")==="PIDD"){_55();}});m.connect("ft_amt","onBlur",function(){m.setTnxAmt(this.get("value"));if(!isNaN(dj.byId("ft_amt").get("value"))&&dj.byId("ft_cur_code").get("value")!==""){m.fireFXAction();}else{m.defaultBindTheFXTypes();}});}m.beneAdvBinding();},showFields:function(){var _6f=dj.byId("entity").domNode;if(dj.byId("entity").get("value")===""){dj.showTooltip(m.getLocalization("remittanceToolTip"),_6f,0);var _70=function(){dj.hideTooltip(_6f);};var _71=1000;setTimeout(_70,_71);return false;}var _72=dj.byId("applicant_act_name").domNode;if(dj.byId("applicant_act_name").get("value")===""){dj.showTooltip(m.getLocalization("remittanceToolTip"),_72,0);var _73=function(){dj.hideTooltip(_72);};var _74=1000;setTimeout(_73,_74);return false;}return true;},onFormLoad:function(){m.initForm();if(misys._config.nickname==="true"&&dj.byId("applicant_act_nickname")&&dj.byId("applicant_act_nickname").get("value")!==""&&d.byId("nickname")){m.animate("fadeIn",d.byId("nickname"));d.style("nickname","display","inline");d.byId("nickname").innerHTML=dj.byId("applicant_act_nickname").get("value");}else{m.animate("fadeOut",d.byId("applicant_act_nickname_row"));}if(misys._config.isMultiBank){m.populateCustomerBanks(true);var _75=dj.byId("customer_bank");var _76=dj.byId("customer_bank_hidden");var _77=dj.byId("entity");var _78=dj.byId("issuing_bank_abbv_name");var _79=dj.byId("issuing_bank_name");var _7a=dojo.byId("recurring_payment_checkbox");if(_75&&_76){_75.set("value",_76.get("value"));}if(_78&&_78.get("value")!==""){_1=true;_2=true;_75.set("value",_78.get("value"));_76.set("value",_78.get("value"));}if(_77&&_77.get("value")===""&&_75){_75.set("disabled",true);_75.set("required",false);}if(misys._config.perBankRecurringAllowed&&_7a&&_75){if(_75.get("value")===""){m.animate("fadeOut",_7a);}else{if(_75.get("value")!==""&&misys._config.perBankRecurringAllowed[_75.get("value")]!=="Y"){m.animate("fadeOut",_7a);}}}}m.checkBeneficiaryNicknameOnFormLoad();m.setCurrency(dj.byId("ft_cur_code"),["ft_amt"]);_31();if(dj.byId("recurring_payment_enabled")&&dj.byId("recurring_payment_enabled").get("checked")){dj.byId("recurring_flag").set("checked",true);m.showSavedRecurringDetails(false);}else{if(d.byId("recurring_payment_div")){d.style("recurring_payment_div","display","none");}m.hasRecurringPayment();m.showSavedRecurringDetails(false);}d.forEach(d.query(".piDisclaimer"),function(_7b){var _7c=dj.byId("sub_product_code").get("value")+"_"+"DISCLAIMER";if(dj.byId("sub_product_code")&&(_7b.id==_7c)){m.animate("fadeIn",_7c);}});var _7d=dj.byId("sub_product_code").get("value");if(!m._config.isMultiBank&&dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""&&m._config.fxParamData&&m._config.fxParamData[_7d][dj.byId("issuing_bank_abbv_name").get("value")].isFXEnabled==="Y"){m.initializeFX(dj.byId("sub_product_code").get("value"),dj.byId("issuing_bank_abbv_name").get("value"));if(dj.byId("applicant_act_cur_code")&&dj.byId("applicant_act_cur_code").get("value")!==""&&dj.byId("ft_cur_code")&&dj.byId("ft_cur_code").get("value")!==""&&dj.byId("applicant_act_cur_code").get("value")!==dj.byId("ft_cur_code").get("value")){m.onloadFXActions();}else{m.defaultBindTheFXTypes();}}if(d.byId("fx-section")){if(dj.byId("bulk_ref_id").get("value")!==""&&dj.byId("ft_cur_code").get("value")!==""&&!isNaN(dj.byId("ft_amt").get("value"))){m.initializeFX(dj.byId("sub_product_code").get("value"),dj.byId("issuing_bank_abbv_name").get("value"));m.fireFXAction();}else{if((dj.byId("fx_exchange_rate_cur_code")&&dj.byId("fx_exchange_rate_cur_code").get("value")!=="")||(dj.byId("fx_total_utilise_cur_code")&&dj.byId("fx_total_utilise_cur_code").get("value")!=="")){m.animate("wipeIn",d.byId("fx-section"));}else{d.style("fx-section","display","none");}}}m.beneAdvFormLoad();m.hasRecurringPayment();m.showSavedRecurringDetails(true);var _7e=dj.byId("applicant_act_pab").get("value");if(d.byId("clear_img")){if(_7e=="Y"&&d.style(d.byId("clear_img"),"display")!=="none"){m.animate("wipeOut",d.byId("clear_img"));}}},initForm:function(){var _7f=dj.byId("applicant_act_pab");if(_7f&&dj.byId("pre_approved_status")&&(_7f.get("value")==="Y"||dj.byId("pre_approved_status").get("value")==="Y")){if(m._config.non_pab_allowed){d.style("pre_approved_benificiary","display","inline");}else{d.style("pre_approved_benificiary","display","none");}_17.toggleReadonly(true);if(dj.byId("beneficiary_country_btn_img")){dj.byId("beneficiary_country_btn_img").set("disabled",true);}if(dj.byId("bank_iso_img")){dj.byId("bank_iso_img").set("disabled",true);}if(dj.byId("currency")){dj.byId("currency").set("disabled",true);}}else{if(dj.byId("pre_approved")&&(dj.byId("pre_approved").get("value")===""||(dj.byId("pre_approved")&&dj.byId("pre_approved").get("value")===null))){_17.toggleReadonly(false);if(dj.byId("beneficiary_country_btn_img")){dj.byId("beneficiary_country_btn_img").set("disabled",false);}if(dj.byId("bank_iso_img")){dj.byId("bank_iso_img").set("disabled",false);}if(dj.byId("currency")){dj.byId("currency").set("disabled",false);}}else{_17.toggleReadonly(true);if(dj.byId("beneficiary_country_btn_img")){dj.byId("beneficiary_country_btn_img").set("disabled",true);}if(dj.byId("bank_iso_img")){dj.byId("bank_iso_img").set("disabled",true);}if(dj.byId("currency")){dj.byId("currency").set("disabled",true);}}}if(d.byId("clear_img")){if(_7f==="Y"&&d.style(d.byId("clear_img"),"display")!=="none"){m.animate("wipeOut",d.byId("clear_img"));}}},beforeSaveValidations:function(){var _80=dj.byId("entity");if(_80&&_80.get("value")==""){return false;}else{return true;}},beforeSubmitValidations:function(){if(dj.byId("ft_amt")){if(!m.validateAmount((dj.byId("ft_amt"))?dj.byId("ft_amt"):0)){m._config.onSubmitErrorMsg=m.getLocalization("amountcannotbezero");dj.byId("ft_amt").set("value","");return false;}}if(dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""&&m._config.fxParamData&&m._config.fxParamData[dj.byId("sub_product_code").get("value")][dj.byId("issuing_bank_abbv_name").get("value")].isFXEnabled==="Y"){if(!m.fxBeforeSubmitValidation()){return false;}if(!_c()){return false;}}if(!m.isRecurringDetailsValidForSubmit()){return false;}var _81=dj.byId("applicant_act_no").get("value");var _82=m.checkAccountStatus(_81);if(!_82){m._config.onSubmitErrorMsg=misys.getLocalization("accountStatusError");return false;}if(!dj.byId("bulk_ref_id").get("value")){if(!m.beneAdvBeforeSubmitValidation()){return false;}var _83=false;var _84=dijit.byId("mode")?dijit.byId("mode").get("value"):"";if(_84==="DRAFT"){if(dj.byId("recurring_payment_enabled")&&dj.byId("recurring_payment_enabled").get("checked")){_83=m.validateHolidaysAndCutOffTime("issuing_bank_abbv_name","sub_product_code",_84,["Start Date"],["recurring_start_date"],"entity","ft_cur_code","ft_amt");}else{_83=m.validateHolidaysAndCutOffTime("issuing_bank_abbv_name","sub_product_code",_84,["Transfer Date"],["iss_date"],"entity","ft_cur_code","ft_amt");}}else{if(_84==="UNSIGNED"){if(dj.byId("recurring_payment_enabled")&&dj.byId("recurring_payment_enabled").get("value")==="Y"){_83=m.validateHolidaysAndCutOffTime("issuing_bank_abbv_name","sub_product_code_unsigned",_84,["Start Date"],["recurring_start_date_unsigned"],"display_entity_unsigned","ft_cur_code_unsigned","ft_amt_unsigned");}else{_83=m.validateHolidaysAndCutOffTime("issuing_bank_abbv_name","sub_product_code_unsigned",_84,["Transfer Date"],["iss_date_unsigned"],"display_entity_unsigned","ft_cur_code_unsigned","ft_amt_unsigned");}}else{m._config.onSubmitErrorMsg=m.getLocalization("technicalErrorWhileValidatingBusinessDays");_83=false;}}if(_83){m._config.holidayCutOffEnabled=false;}return _83;}else{return true;}},preDisplayAssigneeType:function(_85){var _86=m._config.task_mode||"userandbank";dojo.forEach(_85,function(_87){if(_87.description==="user_to_bank"&&dj.byId(_87.id)){if(_86==="userandbank"){dj.byId(_87.id).set("disabled",false);}else{dj.byId(_87.id).set("disabled",true);}}});}});})(dojo,dijit,misys);dojo.require("misys.client.binding.cash.create_pi_client");}