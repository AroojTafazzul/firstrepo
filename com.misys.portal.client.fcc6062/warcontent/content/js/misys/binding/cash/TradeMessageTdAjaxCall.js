/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.cash.TradeMessageTdAjaxCall"]){dojo._hasResource["misys.binding.cash.TradeMessageTdAjaxCall"]=true;dojo.provide("misys.binding.cash.TradeMessageTdAjaxCall");_fncAjaxGetRate=function(){m.xhrPost({url:misys.getServletURL("/screen/AjaxScreen/action/RequestForQuoteSearchActionTD"),handleAs:"json",content:{operation:"REQUEST",applicant_reference:fncGetGlobalVariable("applicant_reference"),interest_capitalisation:fncGetGlobalVariable("interest_capitalisation"),reason:fncGetGlobalVariable("reason"),original_trade_id:fncGetGlobalVariable("original_trade_id"),td_type:fncGetGlobalVariable("td_type"),td_cur_code:fncGetGlobalVariable("td_cur_code"),td_amt:fncGetGlobalVariable("td_amt"),inc_amt:fncGetGlobalVariable("inc_amt"),dec_amt:fncGetGlobalVariable("dec_amt"),value_date:fncGetGlobalVariable("input_value_date"),value_days:fncGetGlobalVariable("input_value_days"),remarks:fncGetGlobalVariable("remarks"),value_period:fncGetGlobalVariable("input_value_period"),maturity_date:fncGetGlobalVariable("input_maturity_date"),maturity_days:fncGetGlobalVariable("input_maturity_days"),maturity_period:fncGetGlobalVariable("input_maturity_period")},load:function(_1,_2){dijit.byId("loadingDialog").hide();var _3=_1.status;switch(_3){case 5:_fncGetData(_1);validity=_1.validity;_fncCountdown(validity);fncShowDetailField();break;case 6:fncSetGlobalVariable("trade_id",_1.trade_id);fncSetGlobalVariable("rec_id",_1.rec_id);misys.frequencyStore=_1.delay_frequency;misys.delayStore=_1.delay_timeout;_fncOpenDelayDialog(misys.frequencyStore,misys.delayStore);break;default:_fncManageErrors(_3);break;}},customError:function(_4,_5){dijit.byId("loadingDialog").hide();console.error("[TdAjaxCall] error retrieving quote");_fncManageErrors();}});};_fncPerformDelayRequest=function(_6,_7){if(_6>0){m.xhrPost({url:misys.getServletURL("/screen/AjaxScreen/action/RequestForQuoteSearchActionTD"),handleAs:"json",content:{operation:"DELAY",rec_id:fncGetGlobalVariable("rec_id"),applicant_reference:fncGetGlobalVariable("applicant_reference"),interest_capitalisation:fncGetGlobalVariable("interest_capitalisation"),reason:fncGetGlobalVariable("reason"),original_trade_id:fncGetGlobalVariable("original_trade_id"),td_type:fncGetGlobalVariable("td_type"),td_cur_code:fncGetGlobalVariable("td_cur_code"),td_amt:fncGetGlobalVariable("td_amt"),inc_amt:fncGetGlobalVariable("inc_amt"),dec_amt:fncGetGlobalVariable("dec_amt"),value_date:fncGetGlobalVariable("input_value_date"),value_days:fncGetGlobalVariable("input_value_days"),value_period:fncGetGlobalVariable("input_value_period"),remarks:fncGetGlobalVariable("remarks"),maturity_date:fncGetGlobalVariable("input_maturity_date"),maturity_days:fncGetGlobalVariable("input_maturity_days"),maturity_period:fncGetGlobalVariable("input_maturity_period"),trade_id:fncGetGlobalVariable("trade_id")},load:function(_8,_9){var _a=_8.status;switch(_a){case 5:_fncGetData(_8);fncCloseDelayDialog();validity=_8.validity;_fncCountdown(validity);fncShowDetailField();break;case 6:fncSetGlobalVariable("rec_id",_8.rec_id);_6--;misys.timer=setTimeout("_fncPerformDelayRequest('"+_6+"','"+_7+"')",(_7*1000));break;default:fncCloseDelayDialog();_fncManageErrors(_a,_8);break;}},customError:function(_b,_c){console.error("[TradeCreateTdAjaxCall] error retrieving quote");_fncManageErrors("",_b);}});}else{_stopCountDown(misys.timer);_fncShowContinuationElement();}};_fncCancelDelayRequest=function(){dijit.byId("buttonAcceptRequest").set("disabled",false);m.xhrPost({url:misys.getServletURL("/screen/AjaxScreen/action/RequestForQuoteSearchActionTD"),handleAs:"json",content:{operation:"CANCEL",applicant_reference:dijit.byId("applicant_reference").get("value"),trade_id:fncGetGlobalVariable("trade_id"),rec_id:fncGetGlobalVariable("rec_id"),td_type:fncGetGlobalVariable("td_type"),td_cur_code:fncGetGlobalVariable("td_cur_code"),td_amt:fncGetGlobalVariable("td_amt"),value_date:fncGetGlobalVariable("input_value_date"),value_days:fncGetGlobalVariable("input_value_days"),value_period:fncGetGlobalVariable("input_value_period"),maturity_date:fncGetGlobalVariable("input_maturity_date"),maturity_days:fncGetGlobalVariable("input_maturity_days"),maturity_period:fncGetGlobalVariable("input_maturity_period")},load:fncPerformClear,customError:function(_d,_e){console.error("[TdAjaxCall] error retrieving quote");misys.dialog.show("ERROR",misys.getLocalization("technicalError"));fncPerformClear();}});};fncCancelRequest=function(){dijit.byId("buttonAcceptRequest").set("disabled",false);m.xhrPost({url:misys.getServletURL("/screen/AjaxScreen/action/RequestForQuoteSearchActionTD"),handleAs:"json",content:{operation:"REJECT",applicant_reference:dijit.byId("applicant_reference").get("value"),trade_id:fncGetGlobalVariable("trade_id"),td_type:fncGetGlobalVariable("td_type"),rec_id:fncGetGlobalVariable("rec_id"),td_cur_code:fncGetGlobalVariable("td_cur_code"),td_amt:fncGetGlobalVariable("td_amt"),value_date:fncGetGlobalVariable("input_value_date"),value_days:fncGetGlobalVariable("input_value_days"),value_period:fncGetGlobalVariable("input_value_period"),maturity_date:fncGetGlobalVariable("input_maturity_date"),maturity_days:fncGetGlobalVariable("input_maturity_days"),maturity_period:fncGetGlobalVariable("input_maturity_period")},load:fncPerformClear,customError:function(_f,_10){console.error("[TdAjaxCall] error retrieving quote");misys.dialog.show("ERROR",misys.getLocalization("technicalError"));fncPerformClear();}});};_fncGetData=function(_11){dojo.query("#trade_id_report_row .content")[0].innerHTML=_11.trade_id;dojo.query("#maturity_report_row .content")[0].innerHTML=_11.maturity_date;dojo.query("#rate_report_row .content")[0].innerHTML=_11.rate;dojo.query("#interest_report_row .content")[0].innerHTML=_11.interest;dijit.byId("trade_id").set("value",_11.trade_id);dijit.byId("rec_id").set("value",_11.rec_id);dijit.byId("remarks").set("value",_11.remarks);dijit.byId("reversal_reason").set("value",_11.reason);fncSetGlobalVariable("trade_id",_11.trade_id);fncSetGlobalVariable("rec_id",_11.rec_id);dijit.byId("rate").set("value",_11.rate);dijit.byId("maturity_date").set("value",_11.maturity_date);dijit.byId("value_date").set("value",_11.value_date);dijit.byId("td_cur_code").set("value",_11.currency);dijit.byId("td_amt").set("value",_11.amount);dijit.byId("interest").set("value",_11.interest);};_fncManageErrors=function(_12,_13){var _14="";switch(_12){case 20:_14=misys.getLocalization("technicalError");break;default:_14=fncGetCommonMessageError(_12,_13);break;}misys.dialog.show("ERROR",_14,"",function(){fncPerformClear();return;});fncPerformClear();};dojo.require("misys.client.binding.cash.TradeMessageTdAjaxCall_client");}