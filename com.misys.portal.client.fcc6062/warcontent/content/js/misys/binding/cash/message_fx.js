/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.cash.message_fx"]){dojo._hasResource["misys.binding.cash.message_fx"]=true;dojo.provide("misys.binding.cash.message_fx");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.layout.ContentPane");dojo.require("dojo.data.ItemFileReadStore");dojo.require("dijit.form.DateTextBox");dojo.require("dijit.form.CurrencyTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.form.DateTermField");dojo.require("misys.form.DateOrTermField");dojo.require("misys.widget.Collaboration");dojo.require("misys.binding.cash.common.request_action");dojo.require("dojo.parser");dojo.require("dojo.date");(function(d,dj,m){d.mixin(m._config,{initReAuthParams:function(){var _1={productCode:"FX",subProductCode:dj.byId("sub_product_code")?dj.byId("sub_product_code").get("value"):"",transactionTypeCode:"13",entity:dj.byId("entity")?dj.byId("entity").get("value"):"",currency:"",amount:"",es_field1:"",es_field2:""};return _1;}});var _2=["input_split_value","input_split_amt","select_split_cur_code_CCY","select_split_cur_code_CTR_CCY"];var _3=["input_extend_value"];var _4=["input_uptake_value"];var _5=["input_takedown_value","input_takedown_amt"];var _6=["input_takedown_amt"];var _7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_1a,_1b,_1c,_1d,_1e,_1f,_20,_21,_22,_23,_24,_25;_fncInitUpdateVar=function(){_1d=dj.byId("ref_id").get("value");_1e=dj.byId("bo_ref_id").get("value");_1f=dj.byId("contract_type").get("value");_20=dj.byId("org_fx_amt").get("value");_21=dj.byId("org_fx_cur_code").get("value");_22=dj.byId("org_counter_amt").get("value");_23=dj.byId("org_counter_cur_code").get("value");_24=dj.byId("org_rate").get("value");_25=dj.byId("org_maturity_date").get("value");};_fncToggleAction=function(_26){_1c=_26;if(_26==="34"){_e="SPLIT";_fncEnableRequiredFields(_2);_fncDisabledRequiredFields(_3);_fncDisabledRequiredFields(_4);_fncDisabledRequiredFields(_5);m.animate("fadeIn",d.byId("split-details"));m.animate("fadeIn",d.byId("request-button"));m.animate("fadeIn",d.byId("split-trade-details"));m.animate("fadeOut",d.byId("extend-details"));m.animate("fadeOut",d.byId("submit-button"));m.animate("fadeOut",d.byId("uptake-details"));m.animate("fadeOut",d.byId("takedown-details"));}else{if(_26==="33"){_e="EXTEND";_fncDisabledRequiredFields(_2);_fncEnableRequiredFields(_3);_fncDisabledRequiredFields(_4);_fncDisabledRequiredFields(_5);m.animate("fadeIn",d.byId("extend-details"));m.animate("fadeIn",d.byId("request-button"));m.animate("fadeOut",d.byId("uptake-details"));m.animate("fadeOut",d.byId("split-details"));m.animate("fadeOut",d.byId("split-trade-details"));m.animate("fadeOut",d.byId("submit-button"));m.animate("fadeOut",d.byId("takedown-details"));}else{if(_26==="32"){_e="UPTAKE";_fncDisabledRequiredFields(_2);_fncDisabledRequiredFields(_3);_fncEnableRequiredFields(_4);_fncDisabledRequiredFields(_5);m.animate("fadeIn",d.byId("uptake-details"));m.animate("fadeIn",d.byId("request-button"));m.animate("fadeOut",d.byId("split-details"));m.animate("fadeOut",d.byId("split-trade-details"));m.animate("fadeOut",d.byId("extend-details"));m.animate("fadeOut",d.byId("submit-button"));m.animate("fadeOut",d.byId("takedown-details"));}else{if(_26==="31"){_e="TAKEDOWN";_fncDisabledRequiredFields(_2);_fncDisabledRequiredFields(_3);_fncDisabledRequiredFields(_4);_fncEnableRequiredFields(_5);m.animate("fadeOut",d.byId("uptake-details"));m.animate("fadeOut",d.byId("split-details"));m.animate("fadeOut",d.byId("split-trade-details"));m.animate("fadeOut",d.byId("extend-details"));m.animate("fadeOut",d.byId("request-button"));m.animate("fadeOut",d.byId("payment_split_legend"));m.animate("fadeIn",d.byId("takedown_legend"));m.animate("fadeIn",d.byId("takedown-details"));m.animate("fadeIn",d.byId("submit-button"));}else{if(_26==="93"){_e="TAKEDOWN";var _27=dojo.date.locale.parse(dj.byId("value_date").get("value"),{"locale":dojo.locale,"selector":"date"});_fncDisabledRequiredFields(_2);_fncDisabledRequiredFields(_3);_fncDisabledRequiredFields(_4);_fncDisabledRequiredFields(_5);_fncEnableRequiredFields(_6);dj.byId("input_takedown_value_date").set("value",_27);m.animate("fadeOut",d.byId("input_takedown_value_row"));m.animate("fadeOut",d.byId("uptake-details"));m.animate("fadeOut",d.byId("split-details"));m.animate("fadeOut",d.byId("split-trade-details"));m.animate("fadeOut",d.byId("extend-details"));m.animate("fadeOut",d.byId("request-button"));m.animate("fadeOut",d.byId("takedown_legend"));m.animate("fadeIn",d.byId("payment_split_legend"));m.animate("fadeIn",d.byId("takedown-details"));m.animate("fadeIn",d.byId("submit-button"));}else{m.animate("fadeOut",d.byId("split-details"));m.animate("fadeOut",d.byId("split-trade-details"));m.animate("fadeOut",d.byId("submit-button"));m.animate("fadeOut",d.byId("takedown-details"));m.animate("fadeOut",d.byId("uptake-details"));m.animate("fadeOut",d.byId("extend-details"));m.animate("fadeOut",d.byId("payment-split-details"));m.animate("fadeOut",d.byId("request-button"));_fncDisabledRequiredFields(_2);_fncDisabledRequiredFields(_3);_fncDisabledRequiredFields(_4);_fncDisabledRequiredFields(_5);}}}}}};_fncEnableRequiredFields=function(_28){var _29=_28;d.forEach(_29,function(id){var _2a=dj.byId(id);if(_2a){m.toggleRequired(_2a,true);_2a.set("disabled",false);}});};_fncDisabledRequiredFields=function(_2b){var _2c=_2b;d.forEach(_2c,function(id){var _2d=dj.byId(id);if(_2d){_2d.set("disabled",true);}});};_fncValidateAmount=function(_2e,_2f,_30,_31){_2f.invalidMessage=_2f.messages.invalidMessage;if(!_2f.validator(_2f.get("value"),_2f.constraints)){return false;}var _32=(_2f.state==="Error")?false:true;if(false===_2e||(true===_2e&&!_32)){_32=true;var _33=_2f.id;var _34=d.number.parse(dj.byId(_31).get("value"));var _35=_2f.get("value");if(!isNaN(_35)){if((_34-_35)<0){_2f.invalidMessage=m.getLocalization("amendAmountLessThanOriginalError");_32=false;}}}return _32;};_fncGetData=function(_36){d.query("#trade_id_report_row .content")[0].innerHTML=_36.trade_id;d.query("#org_amount_report_row .content")[0].innerHTML=_36.amount;d.query("#org_ctr_amount_report_row .content")[0].innerHTML=_36.counter_amount;d.query("#amount_report_row .content")[0].innerHTML=_36.updateAmount;d.query("#ctr_amount_report_row .content")[0].innerHTML=_36.updateCounterAmount;d.query("#rate_report_row .content")[0].innerHTML=_36.updateRate;d.query("#value_date_report_row .content")[0].innerHTML=_36.value_date;dj.byId("trade_id").set("value",_36.trade_id);dj.byId("rec_id").set("value",_36.rec_id);dj.byId("remarks").set("value",_36.remarks);_7=_36.trade_id;_8=_36.rec_id;dj.byId("tnx_ctr_amount").set("value",_36.updateCounterAmount);dj.byId("rate").set("value",_36.rate);dj.byId("value_date").set("value",_36.value_date);};_fncManageErrors=function(_37,_38){var _39="";var _3a;switch(_37){case 3:_39=m.getLocalization("errorFXRateRejected");break;case 28:_39=m.getLocalization("errorFXRateNoLongerValid");break;case 29:_39=m.getLocalization("errorFXUnknownCurrency");break;case 30:_39=m.getLocalization("errorFXUnknownCounterCurrency",[_38.conter_currency]);break;case 31:_39=m.getLocalization("errorFXServiceClosed");break;case 32:_39=m.getLocalization("errorFXServiceNotAuthorized");break;case 33:_39=m.getLocalization("errorFXDateNotValid");break;case 34:_39=m.getLocalization("errorFXCurrencyDateNotValid");break;case 35:_39=m.getLocalization("errorFXCounterCurrencyDateNotValid");break;default:_39=m.getCommonMessageError(_37,_38);break;}m.dialog.show("ERROR",_39);m.performClear();m.animate("fadeIn",d.byId("request-button"));};_setDateTermNumberAndCode=function(){dijit.byId("input_takedown_value_number").set("value",dijit.byId("input_takedown_value").getNumber());dijit.byId("input_takedown_value_code").set("value",dijit.byId("input_takedown_value").getCode());};_validateinputtakedownamt=function(){var _3b;var _3c=dojo.number.parse(dj.byId("org_fx_amt").get("value"));var _3d=dj.byId("input_takedown_amt").get("value");if(_3d>_3c){if(dojo.number.parse(dj.byId("sub_tnx_type_code").get("value"))===31){_3b=m.getLocalization("drawdownamountvalidation");}else{_3b=m.getLocalization("paymentsplitvalidation");}dj.byId("input_takedown_amt").set("state","Error");dj.hideTooltip(dj.byId("input_takedown_amt").domNode);dj.showTooltip(_3b,dj.byId("input_takedown_amt").domNode,0);return false;}else{if(_3d===0){_3b=m.getLocalization("amountcannotzero");dj.byId("input_takedown_amt").set("state","Error");dj.hideTooltip(dj.byId("input_takedown_amt").domNode);dj.showTooltip(_3b,dj.byId("input_takedown_amt").domNode,0);return false;}}return true;};d.mixin(m,{bind:function(){m.connect("sub_tnx_type_code","onChange",function(){_fncToggleAction(this.get("value"));});m.connect("select_split_cur_code_CCY","onChange",function(){if(dj.byId("select_split_cur_code_CCY").checked){dj.byId("input_split_cur_code").set("value",dj.byId("fx_cur_code").get("value"));}else{dj.byId("input_split_cur_code").set("value",dj.byId("counter_cur_code").get("value"));}});m.setValidation("input_split_amt",function(_3e){if(dj.byId("select_split_cur_code_CCY").checked){return _fncValidateAmount(_3e,this,"fx","fx_amt");}else{return _fncValidateAmount(_3e,this,"fx","counter_amt");}});m.connect("cancelDelayDialogButton","onClick",m.performClear("delayDialog"));m.connect("buttonAcceptRequest","onClick",m.acceptRate);m.connect("buttonCancelRequest","onClick",m.performCancelRequest);m.setValidation("input_extend_value_date",function(){return m.validateDate("input_extend_value","original_value_date","valueDateGreaterThanOrgValueDate",false);});m.setValidation("input_uptake_value_date",function(){return m.validateDate("input_split_value","original_value_date","valueDateGreaterThanOrgValueDate",true);});m.setValidation("input_takedown_value_date",function(){return m.validateDate("input_takedown_value","","DateLessThanDateOfDayError",false)&&m.validateDate("input_takedown_value","original_value_date","valueDateGreaterThanOrgValueDate",true)&&m.validateDate("input_takedown_value","option_date","valueDateSmallerThanOptionDate",false);});m.setValidation("input_takedown_value_number",function(){return m.validateTermNumber("input_takedown_value","","TermCodeError",false);});m.setValidation("input_split_remarks",m.validateAlphaNumericRemarks);m.setValidation("input_uptake_remarks",m.validateAlphaNumericRemarks);m.setValidation("input_extends_remarks",m.validateAlphaNumericRemarks);m.setValidation("input_takedown_remarks",m.validateAlphaNumericRemarks);m.connect("input_takedown_amt","onBlur",_validateinputtakedownamt);},onFormLoad:function(){m.fncDisableLoadingDialogClosing();_fncToggleAction(dj.byId("sub_tnx_type_code").get("value"));m.setCurrency(dj.byId("input_takedown_cur_code"),["input_takedown_amt"]);},performRequest:function(){if(m.checkFields()){m.doPerformRequest();m.animate("fadeOut",d.byId("request-button"));}},initVar:function(){_9=dj.byId("applicant_reference").get("value");_a=dj.byId("bo_ref_id").get("value");_b="FORWARD";_c=dj.byId("contract_type").get("value");_d=dj.byId("counter_cur_code").get("value");if(_e=="SPLIT"){_fncInitUpdateVar();if(dj.byId("select_split_cur_code_CCY").checked){_10=dj.byId("fx_cur_code").get("value");}else{_10=dj.byId("counter_cur_code").get("value");}_f=dj.byId("input_split_amt").get("value");_11=dj.byId("input_split_remarks").get("value");_12=dj.byId("input_split_value").getDate();_13=dj.byId("input_split_value").getNumber();_14=dj.byId("input_split_value").getCode();}else{if(_e=="EXTEND"){_fncInitUpdateVar();_10=dj.byId("fx_cur_code").get("value");_11=dj.byId("input_extends_remarks").get("value");_f=dj.byId("fx_amt").get("value");_12=dj.byId("input_extend_value").getDate();_13=dj.byId("input_extend_value").getNumber();_14=dj.byId("input_extend_value").getCode();}else{if(_e=="UPTAKE"){_fncInitUpdateVar();_10=dj.byId("fx_cur_code").get("value");_11=dj.byId("input_uptake_remarks").get("value");_f=dj.byId("fx_amt").get("value");_12=dj.byId("input_uptake_value").getDate();_13=dj.byId("input_uptake_value").getNumber();_14=dj.byId("input_uptake_value").getCode();}else{if(_e=="TAKEDOWN"){_fncInitUpdateVar();_10=dj.byId("input_takedown_cur_code").get("value");_11=dj.byId("input_takedown_remarks").get("value");_f=dj.byId("input_takedown_amt").get("value");_12=dj.byId("input_takedown_value").getDate();_13=dj.byId("input_takedown_value").getNumber();_14=dj.byId("input_takedown_value").getCode();}}}}},getRate:function(){m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/RequestForQuoteSearchActionFX"),handleAs:"json",content:{operation:"REQUESTUPDATE",applicant_reference:_9,original_deal_id:_a,ref_id:_1d,bo_ref_id:_1e,fx_contract_type:_1f,sub_tnx_type_code:_1c,fx_amt:_f,fx_cur_code:_10,remarks:_11,value_date:_12,value_days:_13,value_period:_14,fx_type:_b,contract_type:_c,counter_cur_code:_d,org_fx_cur_code:_21,org_fx_amt:_20,org_counter_cur_code:_23,org_counter_amt:_22,org_rate:_24,org_maturity_date:_25},load:function(_3f,_40){dj.byId("loadingDialog").hide();var _41=_3f.status;switch(_41){case 5:_fncGetData(_3f);validity=_3f.validity;m.countDown(validity);m.showDetailField();break;case 6:_7=_3f.trade_id;_8=_3f.rec_id;m.frequencyStore=_3f.delay_frequency;m.opicsFrequencyResponse=_3f.delay_frequency;m.delayStore=_3f.delay_timeout;m.openDelayDialog(m.frequencyStore,m.delayStore);break;default:_fncManageErrors(_41,_3f);break;}},customError:function(_42,_43){dj.byId("loadingDialog").hide();console.error("[FXMessageAjaxCall] error retrieving quote");_fncManageErrors("",_42);}});},performDelayRequest:function(){if(m.frequencyStore>0){m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/RequestForQuoteSearchActionFX"),handleAs:"json",content:{operation:"DELAY",ref_id:_1d,applicant_reference:_9,rec_id:_8,fx_amt:_f,fx_cur_code:_10,sub_tnx_type_code:_1c,remarks:_11,value_date:_12,value_days:_13,value_period:_14,trade_id:_7,fx_type:_b,contract_type:_c,counter_cur_code:_d},load:function(_44,_45){var _46=_44.status;switch(_46){case 5:_fncGetData(_44);m.closeDelayDialog();validity=_44.validity;m.countDown(validity);m.showDetailField();break;case 6:_8=_44.rec_id;m.frequencyStore--;m.timer=setTimeout("misys.performDelayRequest()",(m.delayStore*1000));break;default:m.closeDelayDialog();_fncManageErrors(_46,_44);break;}},customError:function(_47,_48){console.error("[FXMessageAjaxCall] error retrieving quote");_fncManageErrors("",_47);}});}else{m.stopCountDown(m.timer);m.showContinuationElement();}},performCancelDelayRequest:function(){m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/RequestForQuoteSearchActionFX"),handleAs:"json",content:{operation:"CANCEL",ref_id:_1d,applicant_reference:dj.byId("applicant_reference").get("value"),trade_id:_7,rec_id:_8,fx_type:_b,contract_type:_c,counter_cur_code:_d,fx_cur_code:_10,fx_amt:_f,value_date:_12,value_days:_13,value_period:_14,near_date:_15,near_days:_16,near_period:_17,near_amt:_18,remarks:_11,option_date:_19,option_days:_1a,option_period:_1b},load:function(_49,_4a){var _4b=_49.status;switch(_4b){case 7:m.dialog.show("CUSTOM-NO-CANCEL",m.getLocalization("confirmationCancelRequest"),m.getLocalization("confirmationCancelTitle"));break;default:_fncManageErrors(_4b,_49);break;}},customError:function(_4c,_4d){m.dialog.show("ERROR",m.getLocalization("technicalError"));m.performClear();}});},cancelRequest:function(){dj.byId("buttonAcceptRequest").set("disabled",false);m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/RequestForQuoteSearchActionFX"),handleAs:"json",content:{operation:"CANCEL",ref_id:_1d,applicant_reference:dj.byId("applicant_reference").get("value"),trade_id:_7,rec_id:_8,fx_amt:_f,fx_cur_code:_10,value_date:_12,value_days:_13,value_period:_14},load:m.performClear,customError:function(_4e,_4f){console.error("[FXMessageAjaxCall] error retrieving quote");m.dialog.show("ERROR",m.getLocalization("technicalError"));m.performClear();}});},getDisabledFields:function(){var _50=["issuing_bank_customer_reference","trade_id","issuing_bank_abbv_name","input_split_value","input_split_amt","input_extend_value","input_uptake_value","input_takedown_value","select_takedown_cur_code","select_split_cur_code","input_takedown_amt","input_split_remarks","input_extends_remarks","input_takedown_remarks","input_uptake_remarks","request_button","request_clear_button","dijit_form_Button_2","dijit_form_Button_3"];return _50;},getEnabledFields:function(){return m.getDisabledFields();},getHiddenFieldsToClear:function(){var _51=[];return _51;},getFieldsToClear:function(){var _52=["trade_id","input_split_amt","select_takedown_cur_code","select_split_cur_code","input_takedown_amt","input_split_remarks","input_extends_remarks","input_uptake_remarks","input_takedown_remarks"];return _52;},getDateTermFieldsToClear:function(){var _53=["input_split_value_date","input_split_value_code","input_extend_value_date","input_extend_value_code","input_uptake_value_date","input_uptake_value_code","input_takedown_value_date","input_takedown_value_code","input_takedown_value_number"];return _53;}});})(dojo,dijit,misys);dojo.require("misys.client.binding.cash.message_fx_client");}