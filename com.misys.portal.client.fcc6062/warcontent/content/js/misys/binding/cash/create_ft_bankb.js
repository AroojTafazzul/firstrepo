/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.cash.create_ft_bankb"]){dojo._hasResource["misys.binding.cash.create_ft_bankb"]=true;dojo.provide("misys.binding.cash.create_ft_bankb");dojo.require("dojo.parser");dojo.require("dijit.layout.TabContainer");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("misys.form.PercentNumberTextBox");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.widget.Collaboration");dojo.require("misys.form.common");dojo.require("misys.form.file");dojo.require("misys.validation.common");dojo.require("misys.binding.cash.ft_common");dojo.require("misys.form.BusinessDateTextBox");(function(d,dj,m){var _1=d.byId("fx-message-type");function _2(_3){var _4=function(){var _5=dijit.byId("ft_amt");_5.set("state","Error");m.defaultBindTheFXTypes();dj.byId("ft_amt").set("value","");if(dj.byId("ft_cur_code")&&!dj.byId("ft_cur_code").get("readOnly")){dj.byId("ft_cur_code").set("value","");}};m.dialog.show("ERROR",_3,"",function(){setTimeout(_4,500);});if(d.byId("fx-section")&&(d.style(d.byId("fx-section"),"display")!=="none")){m.animate("wipeOut",d.byId("fx-section"));}};function _6(){var _7=true;var _8="";var _9=dj.byId("fx_rates_type_2");var _a=dj.byId("fx_total_utilise_amt");var _b=dj.byId("ft_amt");var _c=m._config.fxParamData[dj.byId("sub_product_code").get("value")].fxParametersData.maxNbrContracts;if(_9&&_9.get("checked")&&_a&&!isNaN(_a.get("value"))&&_b&&!isNaN(_b.get("value"))&&_b.get("value")<_a.get("value")){_8+=m.getLocalization("FXUtiliseAmtGreaterMessage");_7=false;}m._config.onSubmitErrorMsg=_8;var _d=0;for(var j=1;j<=_c;j++){var _e="fx_contract_nbr_amt_"+j;_d=_d+dj.byId(_e).get("value");if(dj.byId(_e).get("state")==="Error"||_d.toFixed(2)>_a.get("value")){dj.byId(_e).set("state","Error");dj.byId(_e).focus();_7=false;}}return _7;};function _f(){var _10=dj.byId("notify_beneficiary").get("checked");var _11=dj.byId("notify_beneficiary_choice_1");var _12=dj.byId("notify_beneficiary_choice_2");var _13=dj.byId("notify_beneficiary_email");_11.set("disabled",!_10);_12.set("disabled",!_10);_13.set("disabled",!_10);_11.set("checked",false);_12.set("checked",false);_13.set("value","");var _14=d.byId("notify_beneficiary_email_node");var _15=d.byId("label_notify_beneficiary_choice_2");d.place(_14,_15,"after");m.toggleRequired("notify_beneficiary_email",_10);m.toggleRequired("notify_beneficiary_choice_1",_10);m.toggleRequired("notify_beneficiary_choice_2",_10);};function _16(){var _17=dj.byId("notify_beneficiary_choice_2").get("checked")&&!dj.byId("notify_beneficiary_choice_2").get("disabled");var _18=dj.byId("notify_beneficiary_email");var _19=dj.byId("notify_beneficiary_choice_1");var _1a=dj.byId("notify_beneficiary_choice_2");var _1b=d.byId("notify_beneficiary_email_node");var _1c=d.byId("label_notify_beneficiary_choice_1");var _1d=d.byId("label_notify_beneficiary_choice_2");var _1e=dj.byId("bene_email_1").get("value");if(!_1e){_1e=dj.byId("bene_email_2").get("value");}if(_17){d.place(_1b,_1d,"after");}else{if(!_1e){m.dialog.show("ERROR",m.getLocalization("noBeneficiaryEmail"));_1a.set("checked",true);}else{d.place(_1b,_1c,"after");}}if(_1e&&!_17){_18.set("value",_1e);_18.set("readOnly",true);}else{_18.set("value","");_18.set("readOnly",false);}};function _1f(){var _20=[],_21=[],_22=[],_23="";var _24;if(dj.byId("applicant_act_cur_code")&&dj.byId("applicant_act_cur_code").get("value")!==""){_24=dj.byId("applicant_act_cur_code").get("value");}if(_24&&dj.byId("ft_cur_code")){_23=dj.byId("ft_cur_code");_23.store=null;var _25={"identifier":"id","items":[]};var _26=new dojo.data.ItemFileWriteStore({data:_25});_26.newItem({"id":_24,"name":_24});_23.store=_26;}};function _27(){if(dj.byId("invoice_due_date_hidden")&&dj.byId("iss_date")){var _28=dj.byId("invoice_due_date_hidden").get("value");var _29=dj.byId("iss_date").get("value");_28=_28.split("/");_28=new Date(_28[2],_28[1]-1,_28[0]);if(_28<_29){m.dialog.show("ERROR",m.getLocalization("issDateGreaterThanInvoiceDate"));return false;}}return true;};function _2a(){if(dj.byId("invoice_due_amt_hidden")&&dj.byId("ft_amt")){var _2b=dj.byId("invoice_due_amt_hidden").get("value");var _2c=dj.byId("ft_amt").get("value");if(_2c>_2b){m.dialog.show("ERROR",m.getLocalization("ftAmtLesserThanInvoiceAmt"));return false;}}return true;};function _2d(){var _2e=dj.byId("applicant_act_no").get("value");if(_2e===""){m.dialog.show("ERROR",m.getLocalization("selectDebitFirst"));return;}var _2f=dijit.byId("sub_product_code").get("value");var _30="FT:"+_2f;m.showSearchUserAccountsDialog("useraccount","['beneficiary_name', 'beneficiary_account', 'beneficiary_account_id', 'beneficiary_act_cur_code', 'beneficiary_id','beneficiary_act_pab','beneficiary_act_product_types']","applicant_act_no","entity","credit",_30,"width:750px;height:400px;",m.getLocalization("ListOfAccountsTitleMessage"),"","","","","","","");};function _31(){dojo.forEach(["applicant_act_name","beneficiary_name","beneficiary_act_cur_code","beneficiary_account"],function(_32){if(dj.byId(_32)){dj.byId(_32).set("value","");}});if(d.byId("fx-section")&&(d.style(d.byId("fx-section"),"display")!=="none")){m.animate("wipeOut",d.byId("fx-section"));}};function _33(){var _34=dj.byId("applicant_act_no").get("value");_1f();dojo.forEach(["beneficiary_name","beneficiary_act_cur_code"],function(_35){if(dj.byId(_35)){dj.byId(_35).set("value","");}});};d.mixin(m._config,{initReAuthParams:function(){var _36={productCode:"FT",subProductCode:dj.byId("sub_product_code")?dj.byId("sub_product_code").get("value"):"",transactionTypeCode:"01",entity:dj.byId("entity")?dj.byId("entity").get("value"):"",currency:dj.byId("ft_cur_code")?dj.byId("ft_cur_code").get("value"):"",amount:dj.byId("ft_amt")?m.trimAmount(dj.byId("ft_amt").get("value")):"",es_field1:dj.byId("ft_amt")?m.trimAmount(dj.byId("ft_amt").get("value")):"",es_field2:(dj.byId("beneficiary_account"))?dj.byId("beneficiary_account").get("value"):""};return _36;}});d.mixin(m,{fireFXAction:function(){if(m._config.fxParamData&&dj.byId("sub_product_code")&&dj.byId("sub_product_code").get("value")!==""){var _37=m._config.fxParamData[dj.byId("sub_product_code").get("value")];if(m._config.fxParamData&&_37.fxParametersData.isFXEnabled==="Y"){var _38,_39;var _3a="";if(dj.byId("ft_cur_code")){_3a=dj.byId("ft_cur_code").get("value");}var _3b=dj.byId("ft_amt").get("value");var _3c=dj.byId("applicant_act_cur_code").get("value");var _3d=m._config.productCode;var _3e="";if(dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""){_3e=dj.byId("issuing_bank_abbv_name").get("value");}var _3f=dj.byId("applicant_act_cur_code").get("value");var _40=false;if(_3a!==""&&!isNaN(_3b)&&_3d!==""&&_3e!==""){if(_3a!==_3c){_38=_3c;_39=_3a;_3f=_3c;}if(_38&&_38!==""&&_39&&_39!==""){if(d.byId("fx-section")&&(d.style(d.byId("fx-section"),"display")==="none")){m.animate("wipeIn",d.byId("fx-section"));}m.fetchFXDetails(_38,_39,_3b,_3d,_3e,_3f,_40);if((dj.byId("fx_rates_type_1")&&dj.byId("fx_rates_type_1").get("checked"))&&(isNaN(dj.byId("fx_exchange_rate").get("value"))||dj.byId("fx_exchange_rate_cur_code").get("value")===""||isNaN(dj.byId("fx_exchange_rate_amt").get("value"))||(m._config.fxParamData[dj.byId("sub_product_code").get("value")].fxParametersData.toleranceDispInd==="Y"&&(isNaN(dj.byId("fx_tolerance_rate").get("value"))||isNaN(dj.byId("fx_tolerance_rate_amt").get("value"))||dj.byId("fx_tolerance_rate_cur_code").get("value")==="")))){_2(m.getLocalization("FXDefaultErrorMessage"));}}else{if(d.byId("fx-section")&&(d.style(d.byId("fx-section"),"display")!=="none")){m.animate("wipeOut",d.byId("fx-section"));}m.defaultBindTheFXTypes();}}}}},bind:function(){m.setValidation("iss_date",m.validateTransferDateCustomer);m.setValidation("template_id",m.validateTemplateId);m.connect("applicant_act_no","onChange",_33);m.connect("entity","onClick",m.validateRequiredField);m.connect("applicant_act_name","onClick",m.validateRequiredField);m.connect("beneficiary_name","onClick",m.validateRequiredField);m.connect("beneficiary_name","onChange",function(){if(dj.byId("ft_cur_code")&&!dj.byId("ft_cur_code").get("readOnly")){_1f();}});m.connect("beneficiary_act_cur_code","onChange",function(){if(dj.byId("ft_cur_code")&&!dj.byId("ft_cur_code").get("readOnly")){dj.byId("ft_cur_code").set("value",dj.byId("beneficiary_act_cur_code").get("value"));dj.byId("ft_amt").set("value","");_1f();}});m.bindRecurringFields();m.connect("ft_cur_code","onChange",function(){m.setCurrency(this,["ft_amt"]);});m.setValidation("beneficiary_act_cur_code",m.validateCurrency);m.connect("entity","onChange",function(){_31();m.setApplicantReference();});m.connect("beneficiary_img","onClick",_2d);m.connect("notify_beneficiary","onClick",_f);m.connect("notify_beneficiary_choice_1","onClick",_16);m.connect("notify_beneficiary_choice_2","onClick",_16);m.connect("recurring_flag","onClick",m.showRecurring);m.setValidation("notify_beneficiary_email",m.validateEmailAddr);var _41=dj.byId("sub_product_code").get("value");if(m._config.fxParamData&&m._config.fxParamData[_41].fxParametersData.isFXEnabled==="Y"){m.connect("ft_cur_code","onChange",function(){m.setCurrency(this,["ft_amt"]);if(dj.byId("ft_cur_code").get("value")!==""&&!isNaN(dj.byId("ft_amt").get("value"))){m.fireFXAction();}else{m.defaultBindTheFXTypes();}});m.connect("applicant_act_cur_code","onChange",function(){m.setCurrency(this,["ft_amt"]);if(dj.byId("ft_cur_code").get("value")!==""&&!isNaN(dj.byId("ft_amt").get("value"))){m.fireFXAction();}else{m.defaultBindTheFXTypes();}});m.connect("ft_amt","onBlur",function(){m.setTnxAmt(this.get("value"));var _42="";if(dj.byId("ft_cur_code")){_42=dj.byId("ft_cur_code").get("value");}if(!isNaN(dj.byId("ft_amt").get("value"))&&_42!==""){m.fireFXAction();}else{m.defaultBindTheFXTypes();}});}else{if(d.byId("fx-section")){d.style("fx-section","display","none");}}if(dijit.byId("ft_cur_code")&&dijit.byId("ft_amt")){misys.setCurrency(dijit.byId("ft_cur_code"),["ft_amt"]);}},onFormLoad:function(){if(dj.byId("entity")&&dj.byId("entity").get("value")!==""){dj.byId("applicant_name").set("value",dj.byId("entity").get("value"));}m.setCurrency(dj.byId("ft_cur_code"),["ft_amt"]);m.initForm();var _43=dijit.byId("mode")?dijit.byId("mode").get("value"):"";if(dj.byId("recurring_payment_enabled")&&dj.byId("recurring_payment_enabled").get("checked")){dj.byId("recurring_flag").set("checked",true);m.showSavedRecurringDetails(false);}else{if(d.byId("recurring_payment_div")){d.style("recurring_payment_div","display","none");}m.hasRecurringPayment();m.showSavedRecurringDetails(false);}if(dj.byId("applicant_act_product_types")&&dj.byId("applicant_act_no").get("value")!==""){m.toggleRequired("applicant_act_product_types",false);}var _44=dj.byId("notify_beneficiary_email");var _45=dj.byId("notify_beneficiary_choice");if(_44&&_44.get("value")!==""&&_45&&(_45.get("value")==="default_email")){dj.byId("bene_email_1").set("value",_44.get("value"));}if(dj.byId("notify_beneficiary")&&dj.byId("notify_beneficiary").get("checked")&&(_43==="DRAFT")){var _46=dj.byId("notify_beneficiary").get("checked");m.toggleRequired("notify_beneficiary_email",_46);m.toggleRequired("notify_beneficiary_choice_1",_46);m.toggleRequired("notify_beneficiary_choice_2",_46);if(dj.byId("notify_beneficiary_choice_1").get("checked")){var _47=d.byId("notify_beneficiary_email_node");var _48=d.byId("label_notify_beneficiary_choice_2");_16();if(dj.byId("notify_beneficiary_choice_2").get("checked")){d.place(_47,_48,"after");}}}var _49=dj.byId("applicant_act_cur_code");var _4a=dj.byId("beneficiary_act_cur_code");var _4b=dj.byId("ft_cur_code");if(m._config.fxParamData&&dj.byId("sub_product_code")&&dj.byId("sub_product_code").get("value")!==""){m.initializeFX(dj.byId("sub_product_code").get("value"));if(_49&&_49.get("value")!==""&&_4b&&_4b.get("value")!==""&&_4a&&(_49.get("value")!==_4b.get("value")||_4b.get("value")!==_4a.get("value"))){m.onloadFXActions();}else{m.defaultBindTheFXTypes();}}else{m.animate("fadeOut",_1);}var _4c=dj.byId("ft_cur_code");if(_4c){var _4d=_4c.get("displayedValue");_1f();_4c.set("displayedValue",_4d);}if(d.byId("fx-section")){if(dj.byId("bulk_ref_id").get("value")!==""&&dj.byId("ft_cur_code").get("value")!==""&&!isNaN(dj.byId("ft_amt").get("value"))){m.initializeFX(dj.byId("sub_product_code").get("value"));m.fireFXAction();}else{if((dj.byId("fx_exchange_rate_cur_code")&&dj.byId("fx_exchange_rate_cur_code").get("value")!=="")||(dj.byId("fx_total_utilise_cur_code")&&dj.byId("fx_total_utilise_cur_code").get("value")!=="")){m.animate("wipeIn",d.byId("fx-section"));}else{d.style("fx-section","display","none");}}}},initForm:function(){},beforeSaveValidations:function(){var _4e=dj.byId("entity");if(_4e&&_4e.get("value")===""){return false;}else{if(!_27()){m._config.onSubmitErrorMsg=m.getLocalization("issDateGreaterThanInvoiceDate");dj.byId("iss_date").set("value",null);return false;}if(!_2a()){m._config.onSubmitErrorMsg=m.getLocalization("ftAmtLesserThanInvoiceAmt");dj.byId("ft_amt").set("value",null);return false;}return true;}},beforeSubmitValidations:function(){if(!_2a()){m._config.onSubmitErrorMsg=m.getLocalization("ftAmtLesserThanInvoiceAmt");dj.byId("ft_amt").set("value",null);return false;}var _4f=dijit.byId("mode")?dijit.byId("mode").get("value"):"";var _50=false;if(!m.isRecurringDetailsValidForSubmit()){return _50;}if(dj.byId("ft_amt")&&!m.validateAmount((dj.byId("ft_amt"))?dj.byId("ft_amt"):0)){m._config.onSubmitErrorMsg=m.getLocalization("amountcannotzero");dj.byId("ft_amt").set("value","");return _50;}if(m._config.fxParamData&&m._config.fxParamData[dj.byId("sub_product_code").get("value")].fxParametersData.isFXEnabled==="Y"){if(!m.fxBeforeSubmitValidation()){return _50;}if(!_6()){return _50;}}if(!dj.byId("bulk_ref_id").get("value")){_50=false;if(_4f==="DRAFT"){if(dj.byId("recurring_payment_enabled")&&dj.byId("recurring_payment_enabled").get("checked")){_50=m.validateHolidaysAndCutOffTime("issuing_bank_abbv_name","sub_product_code",_4f,["Start Date"],["recurring_start_date"],"entity","ft_cur_code","ft_amt");}else{_50=m.validateHolidaysAndCutOffTime("issuing_bank_abbv_name","sub_product_code",_4f,["Transfer Date"],["iss_date"],"entity","ft_cur_code","ft_amt");}}else{if(_4f==="UNSIGNED"){if(dj.byId("recurring_payment_enabled")&&dj.byId("recurring_payment_enabled").get("value")==="Y"){_50=m.validateHolidaysAndCutOffTime("issuing_bank_abbv_name","sub_product_code_unsigned",_4f,["Start Date"],["recurring_start_date_unsigned"],"display_entity_unsigned","ft_cur_code_unsigned","ft_amt_unsigned");}else{_50=m.validateHolidaysAndCutOffTime("issuing_bank_abbv_name","sub_product_code_unsigned",_4f,["Transfer Date"],["iss_date_unsigned"],"display_entity_unsigned","ft_cur_code_unsigned","ft_amt_unsigned");}}else{m._config.onSubmitErrorMsg=m.getLocalization("technicalErrorWhileValidatingBusinessDays");}}if(_50){m._config.holidayCutOffEnabled=false;}return _50;}else{return true;}},showListOfBanks:function(){var _51=dijit.byId("sub_product_code").get("value");m.showSearchDialog("bank","['cpty_bank_name', 'cpty_bank_address_line_1', 'cpty_bank_address_line_2', 'cpty_bank_dom', 'cpty_bank_swift_bic_code', 'cpty_bank_contact_name', 'cpty_bank_phone', 'bank_country']",{swiftcode:false,bankcode:false},"","","width:710px;height:350px;",m.getLocalization("ListOfSwiftBanksTitleMessage"));}});})(dojo,dijit,misys);dojo.require("misys.client.binding.cash.create_ft_bankb_client");}