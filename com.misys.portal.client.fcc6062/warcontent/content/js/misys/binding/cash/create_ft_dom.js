/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.cash.create_ft_dom"]){dojo._hasResource["misys.binding.cash.create_ft_dom"]=true;dojo.provide("misys.binding.cash.create_ft_dom");dojo.require("dojo.parser");dojo.require("dijit.layout.TabContainer");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("misys.form.PercentNumberTextBox");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.widget.Collaboration");dojo.require("misys.form.common");dojo.require("misys.form.file");dojo.require("misys.validation.common");dojo.require("misys.binding.cash.ft_common");dojo.require("misys.form.BusinessDateTextBox");dojo.require("misys.binding.core.beneficiary_advice_common");dojo.require("misys.binding.common.create_fx_multibank");(function(d,dj,m){var _1=d.byId("fx-message-type");var _2=false;var _3=true;var _4=false;var _5="fx-section";function _6(_7){var _8=function(){var _9=dijit.byId("ft_amt");_9.set("state","Error");m.defaultBindTheFXTypes();dj.byId("ft_amt").set("value","");if(dj.byId("ft_cur_code")&&!dj.byId("ft_cur_code").get("readOnly")){dj.byId("ft_cur_code").set("value","");}};m.dialog.show("ERROR",_7,"",function(){setTimeout(_8,500);});if(d.byId(_5)&&(d.style(d.byId(_5),"display")!=="none")){m.animate("wipeOut",d.byId(_5));}};function _a(){var _b=dj.byId("cpty_branch_code"),_c=dj.byId("cpty_bank_code"),_d=dj.byId("cpty_bank_name"),_e=dj.byId("cpty_branch_name"),_f="";if(_c&&_b){if(!(_c.get("value")==="")&&!(_b.get("value")==="")){m.xhrPost({url:misys.getServletURL("/screen/AjaxScreen/action/ValidateBankBranchCodeAction"),handleAs:"json",sync:true,content:{bank_code:_c.get("value"),brnch_code:_b.get("value"),internal:"N"},load:function(_10,_11){if(_10.items.valid===false){_f=misys.getLocalization("invalidBankCodeBranchCode",[_c.get("value"),_b.get("value")]);_d.set("value","");_e.set("value","");_c.set("state","Error");_b.set("state","Error");dj.hideTooltip(_b.domNode);dj.showTooltip(_f,_b.domNode,0);}else{_d.set("value",_10.items.bankName);_e.set("value",_10.items.branchName);_b.set("readOnly",true);_c.set("readOnly",true);_d.set("readOnly",true);_e.set("readOnly",true);}},error:function(_12,_13){console.error("[Could not validate Bank Code Branch Code] "+_c.get("value")+","+_b.get("value"));console.error(_12);}});}else{_d.set("value","");_e.set("value","");if(dj.byId("bank_img")){dj.byId("bank_img").set("disabled",false);}}}};function _14(){var _15=true;var _16="";var _17=dj.byId("fx_rates_type_2");var _18=dj.byId("fx_total_utilise_amt");var _19=dj.byId("ft_amt");var _1a=m._config.fxParamData[dj.byId("sub_product_code").get("value")][dj.byId("issuing_bank_abbv_name").get("value")].maxNbrContracts;if(_17.get("checked")&&_18&&!isNaN(_18.get("value"))&&_19&&!isNaN(_19.get("value"))){if(_19.get("value")<_18.get("value")){_16+=m.getLocalization("FXUtiliseAmtGreaterMessage");_15=false;}}m._config.onSubmitErrorMsg=_16;if(_17.get("checked")&&_18&&_19){var _1b=0;for(var j=1;j<=_1a;j++){var _1c="fx_contract_nbr_amt_"+j;_1b=_1b+dj.byId(_1c).get("value");if(dj.byId(_1c).get("state")==="Error"||_1b.toFixed(2)>_18.get("value")){dj.byId(_1c).set("state","Error");dj.byId(_1c).focus();_15=false;}}}return _15;};var _1d,_1e={};_1e.fields=["beneficiary_name","beneficiary_account","beneficiary_act_cur_code","beneficiary_address","beneficiary_city","beneficiary_dom","cpty_bank_code","cpty_bank_name","cpty_bank_swift_bic_code","cpty_bank_address_line_1","cpty_bank_address_line_2","cpty_bank_dom","cpty_branch_code","cpty_branch_name","pre_approved"];_1e.toggleReadonly=function(_1f){m.toggleFieldsReadOnly(this.fields,_1f);};_1e.clear=function(){d.forEach(this.fields,function(_20,i){if(dj.byId(_20)){dj.byId(_20).set("value","");}});d.style("PAB","display","none");};function _21(){var _22=dj.byId("applicant_act_pab").get("value");if(_22=="Y"){_1e.toggleReadonly(true);}else{_1e.toggleReadonly(false);dj.byId("cpty_branch_name").set("readOnly",true);dj.byId("cpty_bank_name").set("readOnly",true);}d.style("PAB","display","none");_1e.clear();if(dj.byId("bank_img")){dj.byId("bank_img").set("disabled",false);}dj.byId("pre_approved_status").set("value","N");m.clearBeneficiaryAdviceFieldsForDefaultingFromBeneMaster();};function _23(){var _24=dj.byId("regexValue");var _25=dj.byId("allowedProducts");var _26=_24?dj.byId("regexValue").get("value"):"";var _27=_25?dj.byId("allowedProducts").get("value"):"";var _28="DOM";var _29=dj.byId("beneficiary_name");var _2a=_29?dj.byId("beneficiary_name").get("value"):"";var _2b=dj.byId("account_no");var _2c=_2b?dj.byId("account_no").get("value"):"";var _2d=new RegExp(_26);var _2e=false;var _2f=null;if(_27.indexOf(_28)<0){if(_26!==null&&_26!==""&&_2a!==""&&_2a!==null){_2e=_2d.test(_2a);if(!_2e){this.invalidMessage=m.getLocalization("invalidBeneficiaryName");return false;}}}else{m._config.forceSWIFTValidation=false;}return true;};function _30(){var _31=dj.byId("beneficiary_name").get("value");if(_31!==""){if(dj.byId("pre_approved_status")&&dj.byId("pre_approved_status").get("value")==="Y"){if(m._config.non_pab_allowed){d.style("PAB","display","inline");}else{d.style("PAB","display","none");}if(dj.byId("bank_img")){dj.byId("bank_img").set("disabled",true);}_1e.toggleReadonly(true);}else{d.style("PAB","display","none");if((dj.byId("pre_approved")&&dj.byId("pre_approved").get("value")==="")||(dj.byId("pre_approved")&&dj.byId("pre_approved").get("value")===null)){_1e.toggleReadonly(false);if(dj.byId("bank_img")){dj.byId("bank_img").set("disabled",false);}}else{_1e.toggleReadonly(true);if(dj.byId("bank_img")){dj.byId("bank_img").set("disabled",true);}}}}};function _32(){var _33=dj.byId("notify_beneficiary").get("checked");var _34=dj.byId("notify_beneficiary_choice_1");var _35=dj.byId("notify_beneficiary_choice_2");var _36=dj.byId("notify_beneficiary_email");_34.set("disabled",!_33);_35.set("disabled",!_33);_36.set("disabled",true);_34.set("checked",_33);_35.set("checked",false);_36.set("value","");var _37=d.byId("notify_beneficiary_email_node");var _38=d.byId("label_notify_beneficiary_choice_1");d.place(_37,_38,"after");var _39=dj.byId("bene_email_1").get("value");if(!_39){_39=dj.byId("bene_email_2").get("value");}if(_39&&_33){_36.set("value",_39);_36.set("readOnly",true);}if(!_39&&_33){if(dj.byId("beneficiary_name")&&dj.byId("beneficiary_name").get("value")===""){m.dialog.show("ERROR",m.getLocalization("noBeneficiaryEmail"));}_35.set("checked",true);var _3a=d.byId("label_notify_beneficiary_choice_2");d.place(_37,_3a,"after");_36.set("disabled",false);}m.toggleRequired("notify_beneficiary_email",_33);m.toggleRequired("notify_beneficiary_choice_1",_33);m.toggleRequired("notify_beneficiary_choice_2",_33);};function _3b(){var _3c=dj.byId("notify_beneficiary_choice_2").get("checked")&&!dj.byId("notify_beneficiary_choice_2").get("disabled");var _3d=dj.byId("notify_beneficiary_email");var _3e=dj.byId("notify_beneficiary_choice_1");var _3f=dj.byId("notify_beneficiary_choice_2");var _40=d.byId("notify_beneficiary_email_node");var _41=d.byId("label_notify_beneficiary_choice_1");var _42=d.byId("label_notify_beneficiary_choice_2");var _43=dj.byId("bene_email_1").get("value");if(!_43){_43=dj.byId("bene_email_2").get("value");}if(_3c){d.place(_40,_42,"after");_3d.set("disabled",false);}else{if(!_43){m.dialog.show("ERROR",m.getLocalization("noBeneficiaryEmail"));_3f.set("checked",true);_3d.set("disabled",false);}else{d.place(_40,_41,"after");}}if(_43&&!_3c){_3d.set("value",_43);_3d.set("readOnly",true);}else{_3d.set("value","");_3d.set("readOnly",false);_3d.set("disabled",false);}};function _44(){var _45=dj.byId("applicant_act_pab").get("value");if(_45=="Y"){dj.byId("beneficiary_name").set("readOnly",true);dj.byId("beneficiary_act_cur_code").set("readOnly",true);dj.byId("beneficiary_account").set("readOnly",true);dj.byId("cpty_bank_code").set("readOnly",true);dj.byId("cpty_branch_code").set("readOnly",true);dj.byId("cpty_branch_name").set("readOnly",true);dj.byId("cpty_bank_name").set("readOnly",true);if(dj.byId("bank_img")){dj.byId("bank_img").set("disabled",true);}}else{if(m._config.non_pab_allowed){dj.byId("beneficiary_name").set("readOnly",false);dj.byId("beneficiary_act_cur_code").set("readOnly",false);dj.byId("beneficiary_account").set("readOnly",false);dj.byId("cpty_bank_code").set("readOnly",false);dj.byId("cpty_branch_code").set("readOnly",false);dj.byId("cpty_branch_name").set("readOnly",true);dj.byId("cpty_bank_name").set("readOnly",true);}else{dj.byId("beneficiary_name").set("readOnly",true);dj.byId("beneficiary_act_cur_code").set("readOnly",true);dj.byId("beneficiary_account").set("readOnly",true);dj.byId("cpty_bank_code").set("readOnly",true);dj.byId("cpty_branch_code").set("readOnly",true);dj.byId("cpty_branch_name").set("readOnly",true);dj.byId("cpty_bank_name").set("readOnly",true);if(dj.byId("bank_img")){dj.byId("bank_img").set("disabled",true);}}}dojo.forEach(["pre_approved","ft_amt","beneficiary_account","beneficiary_act_cur_code","beneficiary_address","beneficiary_city","","beneficiary_dom","pre_approved_status","","","cpty_bank_name","cpty_bank_address_line_1","cpty_bank_address_line_2","cpty_bank_dom","cpty_branch_address_line_1","cpty_branch_address_line_2","cpty_branch_dom","","","cpty_bank_swift_bic_code","cpty_bank_code","cpty_branch_code","cpty_branch_name","","beneficiary_name","","","bene_adv_beneficiary_id_no_send","bene_adv_mailing_name_add_1_no_send","bene_adv_mailing_name_add_2_no_send","bene_adv_mailing_name_add_3_no_send","bene_adv_mailing_name_add_4_no_send","bene_adv_mailing_name_add_5_no_send","bene_adv_mailing_name_add_6_no_send","bene_adv_postal_code_no_send","bene_adv_country_no_send","bene_email_1","bene_email_2","beneficiary_postal_code","beneficiary_country","bene_adv_fax_no_send","bene_adv_ivr_no_send","bene_adv_phone_no_send"],function(_46){if(dj.byId(_46)){dj.byId(_46).set("value","");}});if(d.byId(_5)&&(d.style(d.byId(_5),"display")!=="none")){m.animate("wipeOut",d.byId(_5));}dj.byId("ft_cur_code").set("value",dj.byId("applicant_act_cur_code").get("value"));dj.byId("beneficiary_act_cur_code").set("value",dj.byId("applicant_act_cur_code").get("value"));d.style("PAB","display","none");if(d.byId("clear_img")){if(_45=="Y"&&d.style(d.byId("clear_img"),"display")!=="none"){m.animate("wipeOut",d.byId("clear_img"));}else{if(_45=="N"&&d.style(d.byId("clear_img"),"display")=="none"){m.animate("wipeIn",d.byId("clear_img"));}}}};function _47(){var _48=dj.byId("applicant_act_no").get("value");if(_48===""){m.dialog.show("ERROR",m.getLocalization("selectDebitFirst"));return;}var _49=dj.byId("entity")?dj.byId("entity").get("value"):"";var _4a=dijit.byId("sub_product_code").get("value");m.showSearchDialog("beneficiary_accounts","['beneficiary_name','beneficiary_account','beneficiary_act_cur_code', 'beneficiary_address', 'beneficiary_city', '', 'beneficiary_dom', 'pre_approved_status','','', "+"'cpty_bank_name', 'cpty_bank_address_line_1', 'cpty_bank_address_line_2', 'cpty_bank_dom', 'cpty_branch_address_line_1', 'cpty_branch_address_line_2', 'cpty_branch_dom','','', "+"'cpty_bank_swift_bic_code', 'cpty_bank_code', 'cpty_branch_code', 'cpty_branch_name','pre_approved', '','','bene_adv_beneficiary_id_no_send', "+"'bene_adv_mailing_name_add_1_no_send','bene_adv_mailing_name_add_2_no_send','bene_adv_mailing_name_add_3_no_send','bene_adv_mailing_name_add_4_no_send', "+"'bene_adv_mailing_name_add_5_no_send','bene_adv_mailing_name_add_6_no_send','bene_adv_postal_code_no_send','bene_adv_country_no_send','bene_email_1',"+"'bene_email_2','beneficiary_postal_code','beneficiary_country','bene_adv_fax_no_send', 'bene_adv_phone_no_send', 'beneficiary_nickname']",{product_type:_4a,entity_name:_49,pabAccStat:dijit.byId("applicant_act_pab").get("value"),debitAcctNo:_48},"",_4a,"width:710px;height:350px;",m.getLocalization("ListOfBeneficiriesTitleMessage"));if(dj.byId("pre_approved_status")&&dj.byId("pre_approved_status").get("value")==="Y"){if(dj.byId("bank_img")){dj.byId("bank_img").set("disabled",true);}if(dj.byId("bank_iso_img")){dj.byId("bank_iso_img").set("disabled",true);}}else{d.style("PAB","display","none");}};function _4b(){var _4c=null;var _4d=dj.byId("customer_bank").get("value");if(misys&&misys._config&&misys._config.businessDateForBank&&misys._config.businessDateForBank[_4d]&&misys._config.businessDateForBank[_4d][0]&&misys._config.businessDateForBank[_4d][0].value!==""){var _4e=misys._config.businessDateForBank[_4d][0].value;var _4f=_4e.substring(0,4);var _50=_4e.substring(5,7);var _51=_4e.substring(8,10);_4e=_51+"/"+_50+"/"+_4f;var _52=new Date(_4f,_50-1,_51);if(dj.byId("option_for_tnx")&&dj.byId("option_for_tnx").get("value")==="SCRATCH_DOM"){dj.byId("appl_date").set("value",_4e);document.getElementById("appl_date_view_row").childNodes[1].innerHTML=_4e;dj.byId("appl_date_hidden").set("value",_52);}dj.byId("todays_date").set("value",_52);}if(!_2&&!_3){dj.byId("applicant_act_name").set("value","");dj.byId("beneficiary_name").set("value","");dj.byId("beneficiary_act_cur_code").set("value","");dj.byId("beneficiary_account").set("value","");dj.byId("cpty_bank_code").set("value","");dj.byId("cpty_branch_code").set("value","");dj.byId("cpty_bank_name").set("value","");dj.byId("cpty_branch_name").set("value","");dj.byId("ft_cur_code").set("value","");dj.byId("ft_amt").set("value","");dj.byId("iss_date").set("value",null);dj.byId("issuing_bank_abbv_name").set("value",_4d);_4c=misys._config.customerBankDetails[_4d][0].value;dj.byId("issuing_bank_name").set("value",_4c);}if(!_2){dj.byId("issuing_bank_abbv_name").set("value",_4d);_4c=misys._config.customerBankDetails[_4d][0].value;dj.byId("issuing_bank_name").set("value",_4c);}_2=false;if(dj.byId("customer_bank")&&_4d!==""){_3=false;if(dj.byId("issuing_bank_abbv_name").get("value")!==""){_4c=misys._config.customerBankDetails[_4d][0].value;dj.byId("issuing_bank_name").set("value",_4c);}}m.initializeFX(dj.byId("sub_product_code").get("value"),dj.byId("issuing_bank_abbv_name").get("value"));if(dj.byId("applicant_act_cur_code")&&dj.byId("applicant_act_cur_code").get("value")!==""&&dj.byId("ft_cur_code")&&dj.byId("ft_cur_code").get("value")!==""&&dj.byId("applicant_act_cur_code").get("value")!==dj.byId("ft_cur_code").get("value")&&!isNaN(dj.byId("ft_amt").get("value"))){m.onloadFXActions();}else{m.defaultBindTheFXTypes();}_53();};function _54(){var _55=dj.byId("sub_product_code"),_56=dj.byId("beneficiary_account"),_57=dj.byId("beneficiary_act_cur_code");var _58=false;m.xhrPost({url:misys.getServletURL("/screen/AjaxScreen/action/ValidateBeneficiaryMasterAccount"),handleAs:"json",sync:true,content:{account_number:_56.get("value"),account_cur_code:_57.get("value"),sub_product_code:_55.get("value")},load:function(_59,_5a){switch(_59.items.StatusCode){case "OK":_57.set("value",_59.items.AcctCur);_58=true;break;case "ERR_INVALID_ACCOUNT_NUMBER":_1d=misys.getLocalization("invalidAccountNumber",[_56.get("value")]);_56.focus();_56.set("value","");_56.set("state","Error");dj.hideTooltip(_56.domNode);dj.showTooltip(_1d,_56.domNode,0);break;case "ERR_INVALID_INTERFACE_PROCESSING_ERROR":_1d=misys.getLocalization("accountValidationInterfaceError");_56.focus();_56.set("value","");_56.set("state","Error");dj.hideTooltip(_56.domNode);dj.showTooltip(_1d,_56.domNode,0);break;default:_1d=_59.items.StatusCodeMessage;_56.focus();_56.set("value","");_56.set("state","Error");dj.hideTooltip(_56.domNode);dj.showTooltip(_1d,_56.domNode,0);break;}},error:function(_5b,_5c){console.error("[Could not validate Beneficiary Account] "+_56.get("value"));console.error(_5b);}});return _58;};function _53(){var _5d=dj.byId("sub_product_code").get("value");if(m._config.fxParamData&&dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""&&m._config.fxParamData[_5d][dj.byId("issuing_bank_abbv_name").get("value")].isFXEnabled==="Y"){m.connect("ft_cur_code","onChange",function(){m.setCurrency(this,["ft_amt"]);if(dj.byId("ft_cur_code").get("value")!==""&&!isNaN(dj.byId("ft_amt").get("value"))){m.fireFXAction();}else{if(d.byId(_5)&&(d.style(d.byId(_5),"display")!=="none")){m.animate("wipeOut",d.byId(_5));}m.defaultBindTheFXTypes();}});m.connect("ft_cur_code","onChange",function(){m.setCurrency(this,["ft_amt"]);if(dj.byId("ft_cur_code").get("value")!==""&&!isNaN(dj.byId("ft_amt").get("value"))){m.fireFXAction();}else{m.defaultBindTheFXTypes();}});m.connect("ft_amt","onBlur",function(){m.setTnxAmt(this.get("value"));var _5e="";if(dj.byId("ft_cur_code")){_5e=dj.byId("ft_cur_code").get("value");}if(!isNaN(dj.byId("ft_amt").get("value"))&&_5e!==""){m.fireFXAction();}else{m.defaultBindTheFXTypes();}});}else{if(d.byId(_5)){d.style(_5,"display","none");}}if(dijit.byId("ft_cur_code")&&dijit.byId("ft_amt")){misys.setCurrency(dijit.byId("ft_cur_code"),["ft_amt"]);}};function _5f(){var _60=dj.byId("applicant_act_cur_code").get("value");var _61=dj.byId("beneficiary_act_cur_code").get("value");if(_60!==""&&_61!=""&&_60!==_61){m.dialog.show("ERROR",m.getLocalization("crossCurrency"));dj.byId("beneficiary_name").set("value","");dj.byId("beneficiary_account").set("value","");dj.byId("beneficiary_act_cur_code").set("value","");dj.byId("ft_cur_code").set("value","");dj.byId("cpty_bank_name").set("value","");dj.byId("cpty_bank_code").set("value","");dj.byId("cpty_branch_code").set("value","");dj.byId("cpty_branch_name").set("value","");return;}};d.mixin(m._config,{initReAuthParams:function(){var _62={productCode:"FT",subProductCode:dj.byId("sub_product_code").get("value"),transactionTypeCode:"01",entity:dj.byId("entity")?dj.byId("entity").get("value"):"",currency:dj.byId("ft_cur_code")?dj.byId("ft_cur_code").get("value"):"",amount:dj.byId("ft_amt")?m.trimAmount(dj.byId("ft_amt").get("value")):"",bankAbbvName:dj.byId("customer_bank")?dj.byId("customer_bank").get("value"):"",es_field1:dj.byId("ft_amt")?m.trimAmount(dj.byId("ft_amt").get("value")):"",es_field2:(dj.byId("beneficiary_account"))?dj.byId("beneficiary_account").get("value"):""};return _62;}});d.mixin(m,{fireFXAction:function(){if(m._config.fxParamData&&dj.byId("sub_product_code")&&dj.byId("sub_product_code").get("value")!==""&&dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""){var _63=m._config.fxParamData[dj.byId("sub_product_code").get("value")][dj.byId("issuing_bank_abbv_name").get("value")];if(m._config.fxParamData&&_63.isFXEnabled==="Y"){var _64,_65;var _66="";if(dj.byId("ft_cur_code")){_66=dj.byId("ft_cur_code").get("value");}var _67=dj.byId("ft_amt").get("value");var _68=dj.byId("applicant_act_cur_code").get("value");var _69=m._config.productCode;var _6a="";if(dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""){_6a=dj.byId("issuing_bank_abbv_name").get("value");}var _6b=dj.byId("applicant_act_cur_code").get("value");var _6c=false;if(_66!==""&&!isNaN(_67)&&_69!==""&&_6a!==""){if(_66!==_68){_64=_68;_65=_66;_6b=_68;}if(_64&&_64!==""&&_65&&_65!==""){if(d.byId(_5)&&(d.style(d.byId(_5),"display")==="none")){m.animate("wipeIn",d.byId(_5));}m.fetchFXDetails(_64,_65,_67,_69,_6a,_6b,_6c);if(dj.byId("fx_rates_type_1")&&dj.byId("fx_rates_type_1").get("checked")){if(isNaN(dj.byId("fx_exchange_rate").get("value"))||dj.byId("fx_exchange_rate_cur_code").get("value")===""||isNaN(dj.byId("fx_exchange_rate_amt").get("value"))||(m._config.fxParamData[dj.byId("sub_product_code").get("value")][dj.byId("issuing_bank_abbv_name").get("value")].toleranceDispInd==="Y"&&(isNaN(dj.byId("fx_tolerance_rate").get("value"))||isNaN(dj.byId("fx_tolerance_rate_amt").get("value"))||dj.byId("fx_tolerance_rate_cur_code").get("value")===""))){_6(m.getLocalization("FXDefaultErrorMessage"));}}}else{if(d.byId(_5)&&(d.style(d.byId(_5),"display")!=="none")){m.animate("wipeOut",d.byId(_5));}m.defaultBindTheFXTypes();}}}}},bind:function(){m.setValidation("iss_date",m.validateTransferDateCustomer);m.connect("applicant_act_name","onChange",m.checkNickNameDiv);m.connect("beneficiary_name","onChange",m.checkBeneficiaryNicknameDiv);m.setValidation("template_id",m.validateTemplateId);m.connect("iss_date","onClick",function(){m.clearDateCache();if(misys._config.isMultiBank){var _6d;if(dijit.byId("customer_bank")){_6d=dijit.byId("customer_bank").get("value");}if(_6d!==""&&misys&&misys._config&&misys._config.businessDateForBank&&misys._config.businessDateForBank[_6d][0]&&misys._config.businessDateForBank[_6d][0].value!==""){var _6e=parseInt(misys._config.businessDateForBank[_6d][0].value.substring(0,4),10);var _6f=parseInt(misys._config.businessDateForBank[_6d][0].value.substring(5,7),10);var _70=parseInt(misys._config.businessDateForBank[_6d][0].value.substring(8,10),10);this.dropDown.currentFocus=new Date(_6e,_6f-1,_70);}}});m.connect("applicant_act_no","onChange",_44);m.connect("entity","onClick",m.validateRequiredField);m.connect("applicant_act_name","onClick",m.validateRequiredField);m.connect("beneficiary_name","onClick",m.validateRequiredField);m.connect("beneficiary_act_cur_code","onClick",m.validateRequiredField);m.connect("beneficiary_account","onClick",m.validateRequiredField);m.connect("cpty_bank_code","onClick",m.validateRequiredField);m.connect("cpty_branch_code","onClick",m.validateRequiredField);m.connect("cpty_bank_name","onClick",m.validateRequiredField);m.connect("cpty_branch_name","onClick",m.validateRequiredField);dj.byId("sub_product_code").set("value","DOM");m.bindRecurringFields();m.connect("ft_cur_code","onChange",function(){if(dj.byId("iss_date")&&dj.byId("iss_date").get("value")!==""){dj.byId("iss_date").validate();}if(dj.byId("recurring_start_date")&&dj.byId("recurring_start_date").get("value")!==""){dj.byId("recurring_start_date").validate();}m.setCurrency(this,["ft_amt"]);});m.setValidation("ft_cur_code",m.validateCurrency);m.connect("beneficiary_account","onChange",_54);m.connect("beneficiary_act_cur_code","onChange",function(){if(dj.byId("ft_cur_code")&&!dj.byId("ft_cur_code").get("readOnly")){dj.byId("ft_cur_code").set("value",dj.byId("beneficiary_act_cur_code").get("value"));dj.byId("ft_amt").set("value","");}});m.connect("entity","onChange",function(){_3=true;dj.byId("applicant_act_name").set("value","");dj.byId("beneficiary_nickname").set("value","");dj.byId("beneficiary_name").set("value","");dj.byId("applicant_act_nickname").set("value","");dj.byId("beneficiary_act_cur_code").set("value","");dj.byId("beneficiary_account").set("value","");dj.byId("cpty_bank_code").set("value","");dj.byId("cpty_branch_code").set("value","");dj.byId("cpty_bank_name").set("value","");dj.byId("cpty_branch_name").set("value","");dj.byId("ft_cur_code").set("value","");dj.byId("ft_amt").set("value","");dj.byId("iss_date").set("value",null);if(misys._config.isMultiBank&&dj.byId("customer_bank")){dj.byId("customer_bank").set("value","");m.populateCustomerBanks();}});m.connect("customer_bank","onChange",function(){m.handleMultiBankRecurring(_4);_4=false;});if(dj.byId("bulk_ref_id")&&dj.byId("bulk_ref_id").get("value")!==""&&dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""){m.initializeFX(dj.byId("sub_product_code").get("value"),dj.byId("issuing_bank_abbv_name").get("value"));if(dj.byId("applicant_act_cur_code")&&dj.byId("applicant_act_cur_code").get("value")!==""&&dj.byId("ft_cur_code")&&dj.byId("ft_cur_code").get("value")!==""&&dj.byId("applicant_act_cur_code").get("value")!==dj.byId("ft_cur_code").get("value")&&!isNaN(dj.byId("ft_amt").get("value"))){m.onloadFXActions();}else{m.defaultBindTheFXTypes();}_53();}else{m.connect("customer_bank","onChange",_4b);}m.connect("applicant_act_name","onChange",function(){if(dj.byId("customer_bank")&&dj.byId("applicant_act_name")&&dj.byId("applicant_act_name").get("value")!==""){dj.byId("customer_bank").set("value",m._config.customerBankName);}});m.connect("clear_img","onClick",function(){_21();if(dj.byId("notify_beneficiary_email")){dj.byId("notify_beneficiary").set("checked",false);dj.byId("notify_beneficiary_choice_1").set("checked",false);dj.byId("notify_beneficiary_choice_2").set("checked",false);dj.byId("notify_beneficiary_choice_1").set("disabled",true);dj.byId("notify_beneficiary_choice_2").set("disabled",true);dj.byId("notify_beneficiary_email").set("value","");dj.byId("notify_beneficiary_email").set("disabled",true);dj.byId("bene_email_1").set("value","");dj.byId("bene_email_2").set("value","");}});m.connect("beneficiary_img","onClick",_47);m.setValidation("beneficiary_name",_23);m.connect("beneficiary_name","onChange",function(){_30();var _71=dj.byId("currency_res").get("value");if(_71==="true"){_5f();}if(dj.byId("notify_beneficiary_email")&&dj.byId("notify_beneficiary").get("checked")){if(dj.byId("notify_beneficiary_choice_1").get("checked")){if(dj.byId("bene_email_1").get("value")!==""){dj.byId("notify_beneficiary_email").set("value",dj.byId("bene_email_1").get("value"));}else{if(dj.byId("bene_email_2").get("value")!==""){dj.byId("notify_beneficiary_email").set("value",dj.byId("bene_email_2").get("value"));}else{dj.byId("notify_beneficiary").set("checked",false);dj.byId("notify_beneficiary_choice_1").set("checked",false);dj.byId("notify_beneficiary_email").set("value","");dj.byId("notify_beneficiary_email").set("disabled",true);}}}else{if(dj.byId("notify_beneficiary_choice_2").get("checked")){dj.byId("notify_beneficiary_email").set("value","");dj.byId("notify_beneficiary_choice_2").set("disabled",true);dj.byId("notify_beneficiary_choice_2").set("checked",false);dj.byId("notify_beneficiary").set("checked",false);}}}});m.connect("cpty_bank_code","onBlur",_a);m.connect("cpty_branch_code","onBlur",_a);m.connect("recurring_flag","onClick",function(){m.showRecurring();});m.connect("pre_approved_status","onChange",function(){var _72=dj.byId("beneficiary_name").get("value");if(dj.byId("pre_approved_status").get("value")==="N"){if(_72!==""){if(dj.byId("bank_img")){dj.byId("bank_img").set("disabled",true);}}else{if(dj.byId("bank_img")){dj.byId("bank_img").set("disabled",false);}}if(dj.byId("bank_iso_img")){dj.byId("bank_iso_img").set("disabled",false);}if(dj.byId("currency")){dj.byId("currency").set("disabled",false);}}var _73=dj.byId("sub_product_code");});m.connect("notify_beneficiary","onClick",_32);m.connect("notify_beneficiary_choice_1","onClick",_3b);m.connect("notify_beneficiary_choice_2","onClick",_3b);m.setValidation("notify_beneficiary_email",m.validateEmailAddr);m.connect("notify_beneficiary_email","onChange",m.validateNoOfEmails);var _74=dj.byId("sub_product_code").get("value");if(dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""&&m._config.fxParamData&&m._config.fxParamData[_74][dj.byId("issuing_bank_abbv_name").get("value")].isFXEnabled==="Y"){m.connect("ft_cur_code","onBlur",function(){m.setCurrency(this,["ft_amt"]);if(dj.byId("ft_cur_code").get("value")!==""&&!isNaN(dj.byId("ft_amt").get("value"))){m.fireFXAction();}else{m.defaultBindTheFXTypes();}});m.connect("ft_cur_code","onChange",function(){m.setTnxCurCode(dj.byId("ft_cur_code").get("value"));m.setCurrency(this,["ft_amt"]);if(dj.byId("ft_cur_code").get("value")!==""&&!isNaN(dj.byId("ft_amt").get("value"))){m.fireFXAction();}else{m.defaultBindTheFXTypes();}});m.connect("ft_amt","onBlur",function(){m.setTnxAmt(this.get("value"));var _75="";if(dj.byId("ft_cur_code")){_75=dj.byId("ft_cur_code").get("value");}if(!isNaN(dj.byId("ft_amt").get("value"))&&_75!==""){m.fireFXAction();}else{m.defaultBindTheFXTypes();}});}else{if(d.byId(_5)){d.style(_5,"display","none");}}if(dijit.byId("ft_cur_code")&&dijit.byId("ft_amt")){misys.setCurrency(dijit.byId("ft_cur_code"),["ft_amt"]);}},onFormLoad:function(){var _76=dijit.byId("mode")?dijit.byId("mode").get("value"):"";m.setCurrency(dj.byId("ft_cur_code"),["ft_amt"]);m.initForm();if(_76==="DRAFT"&&dj.byId("beneficiary_name")&&dj.byId("applicant_act_pab")&&dj.byId("applicant_act_pab").get("value")==="Y"&&dj.byId("beneficiary_name").value!==""){if(!m.validateBeneficiaryStatus()){dj.byId("beneficiary_name").set("state","Error");dj.showTooltip(m.getLocalization("beneficiaryIsInactive"),dj.byId("beneficiary_name").domNode,0);}}if(misys._config.nickname==="true"&&dj.byId("applicant_act_nickname")&&dj.byId("applicant_act_nickname").get("value")!==""&&d.byId("nickname")){m.animate("fadeIn",d.byId("nickname"));d.style("nickname","display","inline");d.byId("nickname").innerHTML=dj.byId("applicant_act_nickname").get("value");}else{m.animate("fadeOut",d.byId("applicant_act_nickname_row"));}m.checkBeneficiaryNicknameOnFormLoad();if(dj.byId("customer_bank")&&dj.byId("customer_bank").get("value")!==""&&misys&&misys._config&&misys._config.businessDateForBank&&misys._config.businessDateForBank[dj.byId("customer_bank").get("value")]&&misys._config.businessDateForBank[dj.byId("customer_bank").get("value")][0]&&misys._config.businessDateForBank[dj.byId("customer_bank").get("value")][0].value!==""){var _77=misys._config.businessDateForBank[dj.byId("customer_bank").get("value")][0].value;var _78=_77.substring(0,4);var _79=_77.substring(5,7);var _7a=_77.substring(8,10);_77=_7a+"/"+_79+"/"+_78;var _7b=new Date(_78,_79-1,_7a);if(dj.byId("option_for_tnx")&&dj.byId("option_for_tnx").get("value")==="SCRATCH"){dj.byId("appl_date").set("value",_77);document.getElementById("appl_date_view_row").childNodes[1].innerHTML=_77;if(dj.byId("appl_date_hidden")){dj.byId("appl_date_hidden").set("value",_7b);}}if(dj.byId("todays_date")){dj.byId("todays_date").set("value",_7b);}}if(dj.byId("notify_beneficiary")&&dj.byId("notify_beneficiary").get("checked")&&(_76==="DRAFT")){var _7c=dj.byId("notify_beneficiary").get("checked");m.toggleRequired("notify_beneficiary_email",_7c);m.toggleRequired("notify_beneficiary_choice_1",_7c);m.toggleRequired("notify_beneficiary_choice_2",_7c);if(dj.byId("notify_beneficiary_choice_1").get("checked")){var _7d=d.byId("notify_beneficiary_email_node");var _7e=d.byId("label_notify_beneficiary_choice_2");_3b();if(dj.byId("notify_beneficiary_choice_2").get("checked")){d.place(_7d,_7e,"after");}}}if(misys._config.isMultiBank){m.populateCustomerBanks(true);var _7f=dj.byId("customer_bank");var _80=dj.byId("customer_bank_hidden");var _81=dj.byId("entity");if(_7f&&_80){_7f.set("value",_80.get("value"));}if(dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""){_2=true;_3=true;_7f.set("value",dj.byId("issuing_bank_abbv_name").get("value"));_80.set("value",dj.byId("issuing_bank_abbv_name").get("value"));}if(_81&&_81.get("value")===""&&_7f){_7f.set("disabled",true);_7f.set("required",false);}if(misys._config.perBankRecurringAllowed&&dojo.byId("recurring_payment_checkbox")&&dj.byId("customer_bank")){if(dj.byId("customer_bank").get("value")===""){m.animate("fadeOut",dojo.byId("recurring_payment_checkbox"));}else{if(dj.byId("customer_bank").get("value")!==""&&misys._config.perBankRecurringAllowed[dj.byId("customer_bank").get("value")]!=="Y"){m.animate("fadeOut",dojo.byId("recurring_payment_checkbox"));}}}if(d.byId("server_message")&&d.byId("server_message").innerHTML!==""||dijit.byId("option_for_tnx")&&(dijit.byId("option_for_tnx").get("value")===""||dijit.byId("option_for_tnx").get("value")==="TEMPLATE")){_4=true;}if(dijit.byId("recurring_frequency")&&dijit.byId("customer_bank").get("value")!==""&&misys._config.perBankFrequency){var _82=misys._config.perBankFrequency[dijit.byId("customer_bank").get("value")];if(_82){dijit.byId("recurring_frequency").store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_82}});dijit.byId("recurring_frequency").fetchProperties={sort:[{attribute:"name"}]};}dijit.byId("recurring_frequency").set("value",dijit.byId("recurring_frequency")._lastQuery);}}if(dj.byId("applicant_act_product_types")&&dj.byId("applicant_act_no").get("value")!==""){m.toggleRequired("applicant_act_product_types",false);}var _83=dj.byId("notify_beneficiary_email");var _84=dj.byId("notify_beneficiary_choice");if(_83&&_83.get("value")!==""&&_84&&(_84.get("value")=="default_email")){dj.byId("bene_email_1").set("value",_83.get("value"));}if(dj.byId("recurring_payment_enabled")&&dj.byId("recurring_payment_enabled").get("checked")){dj.byId("recurring_flag").set("checked",true);m._config.clearOnSecondCall=true;m.showSavedRecurringDetails(false);}else{if(d.byId("recurring_payment_div")){d.style("recurring_payment_div","display","none");}m.hasRecurringPayment();m.showSavedRecurringDetails(false);}if(!m._config.isMultiBank&&dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""&&m._config.fxParamData&&dj.byId("sub_product_code")&&dj.byId("sub_product_code").get("value")!==""&&dj.byId("sub_product_code").get("value")!=="IBG"){m.initializeFX(dj.byId("sub_product_code").get("value"),dj.byId("issuing_bank_abbv_name").get("value"));if(dj.byId("applicant_act_cur_code")&&dj.byId("applicant_act_cur_code").get("value")!==""&&dj.byId("ft_cur_code")&&dj.byId("ft_cur_code").get("value")!==""&&dj.byId("applicant_act_cur_code").get("value")!==dj.byId("ft_cur_code").get("value")){m.onloadFXActions();}else{m.defaultBindTheFXTypes();}}else{m.animate("fadeOut",_1);}if(d.byId(_5)){if(dj.byId("bulk_ref_id").get("value")!==""&&dj.byId("ft_cur_code").get("value")!==""&&!isNaN(dj.byId("ft_amt").get("value"))){m.initializeFX(dj.byId("sub_product_code").get("value"),dj.byId("issuing_bank_abbv_name").get("value"));m.fireFXAction();}else{if((dj.byId("fx_exchange_rate_cur_code")&&dj.byId("fx_exchange_rate_cur_code").get("value")!=="")||(dj.byId("fx_total_utilise_cur_code")&&dj.byId("fx_total_utilise_cur_code").get("value")!=="")){m.animate("wipeIn",d.byId(_5));}else{d.style(_5,"display","none");}}}},initForm:function(){dj.byId("sub_product_code").set("value","DOM");var _85=dj.byId("applicant_act_pab").get("value");if(_85==="Y"||(dj.byId("pre_approved_status")&&dj.byId("pre_approved_status").get("value")==="Y")){if(m._config.non_pab_allowed){d.style("PAB","display","inline");}else{d.style("PAB","display","none");}_1e.toggleReadonly(true);if(dj.byId("bank_img")){dj.byId("bank_img").set("disabled",true);}if(dj.byId("bank_iso_img")){dj.byId("bank_iso_img").set("disabled",true);}if(dj.byId("currency")){dj.byId("currency").set("disabled",true);}}else{if((dj.byId("pre_approved")&&dj.byId("pre_approved").get("value")==="")||(dj.byId("pre_approved")&&dj.byId("pre_approved").get("value")===null)){_1e.toggleReadonly(false);if(dj.byId("bank_img")){dj.byId("bank_img").set("disabled",false);}if(dj.byId("bank_iso_img")){dj.byId("bank_iso_img").set("disabled",false);}if(dj.byId("currency")){dj.byId("currency").set("disabled",false);}}else{_1e.toggleReadonly(true);if(dj.byId("bank_img")){dj.byId("bank_img").set("disabled",true);}if(dj.byId("bank_iso_img")){dj.byId("bank_iso_img").set("disabled",true);}if(dj.byId("currency")){dj.byId("currency").set("disabled",true);}}}d.forEach(d.query(".CUR"),function(_86,i){d.style(_86,"display","inline");});dj.byId("beneficiary_mode").set("value","02");if(d.byId("clear_img")){if(_85=="Y"&&d.style(d.byId("clear_img"),"display")!=="none"){m.animate("wipeOut",d.byId("clear_img"));}}_a();},beforeSaveValidations:function(){var _87=dj.byId("entity");if(_87&&_87.get("value")===""){return false;}else{return true;}},beforeSubmitValidations:function(){var _88=dijit.byId("mode")?dijit.byId("mode").get("value"):"";if(_88==="DRAFT"){if(!_54()){return false;}}if(_88==="DRAFT"&&dj.byId("applicant_act_pab")&&dj.byId("applicant_act_pab").get("value")==="Y"&&!m.validateBeneficiaryStatus()){m._config.onSubmitErrorMsg=m.getLocalization("beneficiaryIsInactive");dj.byId("beneficiary_name").set("state","Error");return false;}if(dj.byId("ft_amt")){if(!m.validateAmount((dj.byId("ft_amt")))){m._config.onSubmitErrorMsg=m.getLocalization("amountcannotzero");dj.byId("ft_amt").set("value","");return false;}}if(!m.isRecurringDetailsValidForSubmit()){return false;}if(dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""&&m._config.fxParamData&&m._config.fxParamData[dj.byId("sub_product_code").get("value")][dj.byId("issuing_bank_abbv_name").get("value")].isFXEnabled==="Y"){if(!m.fxBeforeSubmitValidation()){return false;}if(!_14()){return false;}}var _89=dj.byId("applicant_act_no").get("value");var _8a=m.checkAccountStatus(_89);if(!_8a){m._config.onSubmitErrorMsg=misys.getLocalization("accountStatusError");return false;}if(!dj.byId("bulk_ref_id").get("value")){var _8b=false;if(_88==="DRAFT"){if(dj.byId("recurring_payment_enabled")&&dj.byId("recurring_payment_enabled").get("checked")){_8b=m.validateHolidaysAndCutOffTime("issuing_bank_abbv_name","sub_product_code",_88,["Start Date"],["recurring_start_date"],"entity","ft_cur_code","ft_amt");}else{_8b=m.validateHolidaysAndCutOffTime("issuing_bank_abbv_name","sub_product_code",_88,["Transfer Date"],["iss_date"],"entity","ft_cur_code","ft_amt");}}else{if(_88==="UNSIGNED"){if(dj.byId("recurring_payment_enabled")&&dj.byId("recurring_payment_enabled").get("value")==="Y"){_8b=m.validateHolidaysAndCutOffTime("issuing_bank_abbv_name","sub_product_code_unsigned",_88,["Start Date"],["recurring_start_date_unsigned"],"display_entity_unsigned","ft_cur_code_unsigned","ft_amt_unsigned");}else{_8b=m.validateHolidaysAndCutOffTime("issuing_bank_abbv_name","sub_product_code_unsigned",_88,["Transfer Date"],["iss_date_unsigned"],"display_entity_unsigned","ft_cur_code_unsigned","ft_amt_unsigned");}}else{m._config.onSubmitErrorMsg=m.getLocalization("technicalErrorWhileValidatingBusinessDays");_8b=false;}}if(_8b){m._config.holidayCutOffEnabled=false;}return _8b;}else{return true;}},showListOfBanks:function(){var _8c=dijit.byId("sub_product_code").get("value");m.showSearchDialog("bank","['cpty_bank_name', 'cpty_bank_address_line_1', 'cpty_bank_address_line_2', 'cpty_bank_dom', 'cpty_bank_swift_bic_code', 'cpty_bank_contact_name', 'cpty_bank_phone', 'bank_country']",{swiftcode:false,bankcode:false},"","","width:710px;height:350px;",m.getLocalization("ListOfSwiftBanksTitleMessage"));}});})(dojo,dijit,misys);dojo.require("misys.client.binding.cash.create_ft_dom_client");}