/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.cash.TradeCreateSpBinding"]){dojo._hasResource["misys.binding.cash.TradeCreateSpBinding"]=true;dojo.provide("misys.binding.cash.TradeCreateSpBinding");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("misys.form.SimpleTextarea");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("misys.widget.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.layout.ContentPane");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("dojo.data.ItemFileReadStore");dojo.require("misys.form.DateTermField");dojo.require("misys.binding.cash.request.AccountPopup");dojo.require("dojo.parser");misys._config=misys._config||{};dojo.mixin(misys._config,{fundingAccountAttached:0,receivingAccountAttached:0,editMode:false,currentId:""});var fncDoBinding=function(){fncSetGlobalVariable("concentrationAccountPopupFirstOpening","true");if(dijit.byId("concentration_account_no_img")){dijit.byId("concentration_account_no_img").set("onClick",function(){fncOpenAccountPopup("concentrationAccount","SWEEPING");});}fncSetGlobalVariable("fundingAccountPopupFirstOpening","true");if(dijit.byId("funding_acct_no_send_img")){dijit.byId("funding_acct_no_send_img").set("onClick",function(){fncOpenAccountPopup("fundingAccount","FUNDING_ACCT_SWEEPING",dijit.byId("concentration_account_cur_code").get("value"));});}fncSetGlobalVariable("receivingAccountPopupFirstOpening","true");if(dijit.byId("receiving_acct_no_send_img")){dijit.byId("receiving_acct_no_send_img").set("onClick",function(){fncOpenAccountPopup("receivingAccount","RECEIVING_ACCT_SWEEPING",dijit.byId("concentration_account_cur_code").get("value"));});}misys.connect("sweeping_method_deficit","onChange",function(){fncToggleMethodField("deficit");});misys.connect("sweeping_method_surplus","onChange",function(){fncToggleMethodField("surplus");});};var fncDoFormOnLoadEvents=function(){dijit.byId("max_balance_cur_code").set("disabled",true);dijit.byId("min_balance_cur_code").set("disabled",true);misys.animate("fadeOut","funding-currency-field");misys.animate("fadeOut","funding-attachments-accounts-field");misys.animate("fadeOut","receiving-currency-field");misys.animate("fadeOut","receiving-attachments-accounts-field");dijit.byId("funding_min_transfer_no_send_cur_code").set("disabled",true);dijit.byId("funding_keep_balance_no_send_cur_code").set("disabled",true);dijit.byId("receiving_min_transfer_no_send_cur_code").set("disabled",true);dijit.byId("receiving_keep_balance_no_send_cur_code").set("disabled",true);};var fncDoPreSubmitEvents=function(){var _1=dijit.byId("sweeping_method_deficit").checked||dijit.byId("sweeping_method_surplus").checked;if(!_1){misys.dialog.show("CUSTOM-NO-CANCEL",misys.getLocalization("noSweepingMethodLabel"),misys.getLocalization("noSweepingMethodTitle"));return false;}var _2=dijit.byId("frequency_daily").checked||dijit.byId("frequency_weekly").checked||dijit.byId("frequency_monthly").checked||dijit.byId("frequency_annually").checked;if(!_2){misys.dialog.show("CUSTOM-NO-CANCEL",misys.getLocalization("noSweepingFrequencyLabel"),misys.getLocalization("noSweepingFrequencyTitle"));return false;}if((dijit.byId("sweeping_method_deficit").checked&&dojo.style(dojo.byId("funding-account-notice"),"display")==="block")||(dijit.byId("sweeping_method_surplus").checked&&dojo.style(dojo.byId("receiving-account-notice"),"display")==="block")){misys.dialog.show("CUSTOM-NO-CANCEL",misys.getLocalization("noAccountLabel"),misys.getLocalization("noAccountTitle"));return false;}};var fncToggleMethodField=function(_3){if(_3==="deficit"){if(dijit.byId("sweeping_method_deficit").checked){misys.animate("fadeIn","funding-currency-field");misys.animate("fadeIn","funding-attachments-accounts-field");dijit.byId("min_balance_amt").set("required",true);}else{misys.animate("fadeOut","funding-currency-field");misys.animate("fadeOut","funding-attachments-accounts-field");dijit.byId("min_balance_amt").set("required",false);_fncCleanAddtionalAccount("funding");}}else{if(_3==="surplus"){if(dijit.byId("sweeping_method_surplus").checked){misys.animate("fadeIn","receiving-currency-field");misys.animate("fadeIn","receiving-attachments-accounts-field");dijit.byId("max_balance_amt").set("required",true);}else{misys.animate("fadeOut","receiving-currency-field");misys.animate("fadeOut","receiving-attachments-accounts-field");dijit.byId("max_balance_amt").set("required",false);_fncCleanAddtionalAccount("receiving");}}}};var fncOpenAddAccountPopup=function(_4,_5){if(dijit.byId("concentration_account_cur_code").get("value")===""){misys.dialog.show("CUSTOM-NO-CANCEL",misys.getLocalization("noConcentrationAccountLabel"),misys.getLocalization("noConcentrationAccountTitle"));}else{dijit.byId(_4+"_min_transfer_no_send_cur_code").set("value",dijit.byId("concentration_account_cur_code").get("value"));dijit.byId(_4+"_keep_balance_no_send_cur_code").set("value",dijit.byId("concentration_account_cur_code").get("value"));dijit.byId(_4+"_acct_no_send").reset();dijit.byId(_4+"_min_transfer_no_send_amt").reset();dijit.byId(_4+"_keep_balance_no_send_amt").reset();dijit.byId(_4+"accountDialog").show();}};fillAccountField=function(_6,_7){if(_6==="concentrationAccount"){dijit.byId("concentration_account_no").set("value",_7.account_no);dijit.byId("applicant_reference").set("value",_7.customer_ref);if(dijit.byId("concentration_account_cur_code").get("value")!=_7.cur_code){_fncCleanAddtionalAccount("funding");_fncCleanAddtionalAccount("receiving");}dijit.byId("concentration_account_cur_code").set("value",_7.cur_code);dijit.byId("min_balance_cur_code").set("value",_7.cur_code);dijit.byId("max_balance_cur_code").set("value",_7.cur_code);}else{if(_6==="fundingAccount"){dijit.byId("funding_acct_no_send").set("value",_7.account_no);}else{if(_6==="receivingAccount"){dijit.byId("receiving_acct_no_send").set("value",_7.account_no);}}}};_fncCleanAddtionalAccount=function(_8){dojo.query("#"+_8+"account-master-table tbody tr").forEach(function(_9){if(_9.id){var id=_9.id.charAt(_9.id.length-1);fncDeleteRow(id,_8);}});};var fncCancelAddAccount=function(_a){dijit.byId(_a+"accountDialog").hide();};var fncAddAccount=function(_b){var id=misys._config[_b+"AccountAttached"];while(dojo.byId(_b+"account_row_"+id)){id++;}if(isNaN(dijit.byId(_b+"_min_transfer_no_send_amt").get("value"))){dijit.byId(_b+"_min_transfer_no_send_amt").focus();return false;}if(isNaN(dijit.byId(_b+"_keep_balance_no_send_amt").get("value"))){dijit.byId(_b+"_keep_balance_no_send_amt").focus();return false;}if(dijit.byId(_b+"_acct_no_send").get("value")==""){misys.dialog.show("CUSTOM-NO-CANCEL",misys.getLocalization("noAccountLabel"),misys.getLocalization("noAccountTitle"));return false;}if(_fncIsAccountAlreadyPresent(_b)){misys.dialog.show("CUSTOM-NO-CANCEL",misys.getLocalization("accountAlreadySelectedLabel"),misys.getLocalization("accountAlreadySelectedTitle"));return false;}var _c=dijit.byId(_b+"accountDialog");if(_c){_c.hide();}_fncAddRow(id,_b);if(misys._config.editMode){fncDeleteRow(misys._config.currentId,_b);}misys._config.editMode=false;misys._config.currentId="";return true;};_fncIsAccountAlreadyPresent=function(_d){var _e=dijit.byId(_d+"_acct_no_send").get("value");if(dijit.byId("concentration_account_no").get("value")===_e){return true;}var _f=false;dojo.query("#"+_d+"account-master-table tbody tr td:first-child div").forEach(function(_10,_11){if(_10.innerHTML!=""&&_10.innerHTML==_e){_f=true;}});return _f;};_fncAddRow=function(id,_12){var _13=dojo.byId(_12+"account-master-table");if(_13.style.display=="none"){misys.animate("fadeIn",_13,misys._config.showTable);dojo.style(_13,"display",misys._config.showTable);dojo.style(dojo.byId(_12+"-account-notice"),"display","none");}var _14=_13.rows.length;var _15=_14;var row=_13.insertRow(_14);row.setAttribute("id",_12+"account_row_"+id);dojo.style(row,"display","none");dojo.style(row,"opacity",0);var _16=fncAccountGetCells(_12);dojo.forEach(_16,function(_17,_18,arr){dojo.create("div",{innerHTML:_17.value},row.insertCell(_18));});_fncAddEditingButtons(row,_16.length,id,_12);var _19=fncAccountGetHiddenFields(id,_12);dojo.forEach(_19,function(_1a){var _1b=new dijit.form.TextBox({id:_1a.name,name:_1a.name,readOnly:true,value:_1a.value,type:"hidden"}).placeAt(_12+"account_fields","last");});misys.animate("fadeIn",row,null,false,{display:misys._config.showTableRow});dojo.style(dojo.byId(_12+"-account-notice"),"display","none");misys._config[_12+"AccountAttached"]++;};var fncAccountGetCells=function(_1c){var _1d=dijit.byId(_1c+"_min_transfer_no_send_cur_code").get("value")+" "+dijit.byId(_1c+"_min_transfer_no_send_amt").get("value");var _1e=dijit.byId(_1c+"_keep_balance_no_send_cur_code").get("value")+" "+dijit.byId(_1c+"_keep_balance_no_send_amt").get("value");var _1f=[{name:"",value:dijit.byId(_1c+"_acct_no_send").get("value")},{name:"",value:_1d},{name:"",value:_1e}];return _1f;};var fncAccountGetHiddenFields=function(id,_20){var _21=[{name:_20+"_account_no_"+id,id:_20+"_acct_no_send",value:dijit.byId(_20+"_acct_no_send").get("value")},{name:_20+"_min_transfer_cur_code_"+id,id:_20+"_min_transfer_no_send_cur_code",value:dijit.byId(_20+"_min_transfer_no_send_cur_code").get("value")},{name:_20+"_min_transfer_amt_"+id,id:_20+"_min_transfer_no_send_amt",value:dijit.byId(_20+"_min_transfer_no_send_amt").get("value")},{name:_20+"_keep_balance_cur_code_"+id,id:_20+"_keep_balance_no_send_cur_code",value:dijit.byId(_20+"_keep_balance_no_send_cur_code").get("value")},{name:_20+"_keep_balance_amt_"+id,id:_20+"_keep_balance_no_send_amt",value:dijit.byId(_20+"_keep_balance_no_send_amt").get("value")},{name:_20+"_type_"+id,id:_20+"_type",value:_20},{name:_20+"_account_id_"+id,value:id}];return _21;};_fncAddEditingButtons=function(row,_22,id,_23){var _24=row.insertCell(_22);var _25=dojo.create("div",null,_24);var _26=dojo.create("div",null,_24);var _27=dojo.create("div",null,_26);var _28=dojo.create("div",null,_27,"last");var _29=new dijit.form.Button({label:"<img src='"+misys.getContextualURL(m._config.imagesSrc+m._config.imageStore.editIcon)+"' alt='Edit'>",onClick:function(){fncEditRow(id,_23);}},_25);dojo.addClass(_29.domNode,"noborder");dojo.create("p",{innerHTML:misys.getLocalization("deleteAccountConfirmation")},_27,"first");var _2a=new dijit.form.Button({label:misys.getLocalization("deleteMessage"),type:"submit"},_28);var _2b=new dijit.TooltipDialog({title:misys.getLocalization("deleteMessage"),execute:function(){fncDeleteRow(id,_23);}},_27);_2b.startup();var _2c=new dijit.form.DropDownButton({label:"<img src='"+misys.getContextualURL(m._config.imagesSrc+m._config.imageStore.deleteIcon)+"' alt='delete icon' title='"+misys.getLocalization("deleteAttachedAccountConfirmation")+"'/>"},_26);dojo.addClass(_2c.domNode,"noborder");_2c.startup();};var fncDeleteRow=function(id,_2d){var _2e=dojo.byId(_2d+"account-master-table");var _2f=dojo.byId(_2d+"account_row_"+id);dojo.fadeOut({"node":_2f,"duration":500}).play();var _30=function(){_2e.deleteRow(_2f.rowIndex);};setTimeout(_30,500);if(misys._config[_2d+"AccountAttached"]<=1){dojo.fadeOut({"node":_2e,"duration":500}).play();var _31=function(){dojo.style(_2e,"display","none");};setTimeout(_31,501);dojo.style(dojo.byId(_2d+"-account-notice"),"display","block");}var _32=fncAccountGetHiddenFields(id,_2d);dojo.forEach(_32,function(_33,_34,arr){if(dijit.byId(_33.name)){dijit.byId(_33.name).destroy();}});misys._config[_2d+"AccountAttached"]--;};var fncEditRow=function(id,_35){misys._config.editMode=true;misys._config.currentId=id;if(dijit.byId(_35+"_acct_no_send")){dijit.byId(_35+"_acct_no_send").set("value",dijit.byId(_35+"_account_no_"+id).value);}if(dijit.byId(_35+"_min_transfer_no_send_cur_code")){dijit.byId(_35+"_min_transfer_no_send_cur_code").set("value",dijit.byId(_35+"_min_transfer_cur_code_"+id).value);}if(dijit.byId(_35+"_min_transfer_no_send_amt")){dijit.byId(_35+"_min_transfer_no_send_amt").set("value",dijit.byId(_35+"_min_transfer_amt_"+id).value);}if(dijit.byId(_35+"_keep_balance_no_send_cur_code")){dijit.byId(_35+"_keep_balance_no_send_cur_code").set("value",dijit.byId(_35+"_keep_balance_cur_code_"+id).value);}if(dijit.byId(_35+"_keep_balance_no_send_amt")){dijit.byId(_35+"_keep_balance_no_send_amt").set("value",dijit.byId(_35+"_keep_balance_amt_"+id).value);}dijit.byId(_35+"accountDialog").show();};dojo.require("misys.client.binding.cash.TradeCreateSpBinding_client");}