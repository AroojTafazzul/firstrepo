/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.cash.create_ft_int"]){dojo._hasResource["misys.binding.cash.create_ft_int"]=true;dojo.provide("misys.binding.cash.create_ft_int");dojo.require("dojo.parser");dojo.require("dijit.layout.TabContainer");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("misys.form.PercentNumberTextBox");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.widget.Collaboration");dojo.require("misys.form.common");dojo.require("misys.form.file");dojo.require("misys.validation.common");dojo.require("misys.binding.cash.ft_common");dojo.require("misys.form.BusinessDateTextBox");dojo.require("misys.binding.common.create_fx_multibank");dojo.require("misys.binding.cash.paymentFees");(function(d,dj,m){var _1=d.byId("fx-message-type");var _2=false;var _3=true;var _4=false;var _5="<style='width:800px;height:1000px;overflow:auto;'>";var _6="<b><span class='legend'>";var _7="</span></b>";var _8="fx-section";function _9(){var _a="";_a=_a.concat(_5);_a=_a.concat(_6+m.getLocalization("generalDetails")+_7);var _b=dijit.byId("entity")?dijit.byId("entity").get("value"):"";var _c=m.getLocalization("entityDetails",[_b]);var _d=dijit.byId("applicant_act_name")?dijit.byId("applicant_act_name").get("value"):"";var _e=m.getLocalization("debitActDetails",[_d]);_a=_a+_c+_e;return _a;};function _f(){var _10="";_10=_10.concat(_5);_10=_10.concat(_6+m.getLocalization("transferToDetails")+_7);var _11=dijit.byId("beneficiary_name")?dijit.byId("beneficiary_name").get("value"):"";var _12=m.getLocalization("creditActDetails",[_11]);_10=_10+_12;return _10;};function _13(){var _14="";_14=_14.concat(_5);_14=_14.concat(_6+m.getLocalization("transactionDetails")+_7);var _15=dijit.byId("ft_amt")?dijit.byId("ft_amt").get("value"):"";var _16=dijit.byId("ft_cur_code")?dijit.byId("ft_cur_code").get("value"):"";var _17=m.getLocalization("transferAmtDetail",[_16,_15]);var _18=dijit.byId("iss_date")?dijit.byId("iss_date").get("value"):"";var _19=m.getLocalization("transferDateDetails",[_18]);_14=_14+_17+_19;return _14;};function _1a(_1b){var amt=_1b.totalFeeAmount;var ccy=_1b.debitAccountCurrency;var _1c=_1b.debitFeeAmount;var _1d=_1b.taxOnDebitFees;var _1e=_1b.taxOnTaxOnDebitFees;var _1f=_1b.agentFees;var _20=m.getLocalization("totalCharges",[ccy,amt]);var _21=m.getLocalization("debitFeeAmountCharges",[ccy,_1c]);var _22=m.getLocalization("taxOnDebitFeesCharges",[ccy,_1d]);var _23=m.getLocalization("taxOnTaxOnDebitFeesCharges",[ccy,_1e]);var _24=m.getLocalization("agentFeesCharges",[ccy,_1f]);var _25="";_25=_25.concat(_5);_25=_25.concat(_6+m.getLocalization("feesDetails")+_7);_25=_25+_20+_21+_22+_23+_24;return _25;};function _26(_27){var _28=function(){var _29=dijit.byId("ft_amt");_29.set("state","Error");m.defaultBindTheFXTypes();dj.byId("ft_amt").set("value","");if(dj.byId("ft_cur_code")&&!dj.byId("ft_cur_code").get("readOnly")){dj.byId("ft_cur_code").set("value","");}};m.dialog.show("ERROR",_27,"",function(){setTimeout(_28,500);});if(d.byId(_8)&&(d.style(d.byId(_8),"display")!=="none")){m.animate("wipeOut",d.byId(_8));}};function _2a(){var _2b=null;var _2c=dj.byId("customer_bank").get("value");if(misys&&misys._config&&misys._config.businessDateForBank&&misys._config.businessDateForBank[_2c]&&misys._config.businessDateForBank[_2c][0]&&misys._config.businessDateForBank[_2c][0].value!==""){var _2d=misys._config.businessDateForBank[_2c][0].value;var _2e=_2d.substring(0,4);var _2f=_2d.substring(5,7);var _30=_2d.substring(8,10);_2d=_30+"/"+_2f+"/"+_2e;var _31=new Date(_2e,_2f-1,_30);if(dj.byId("option_for_tnx")&&dj.byId("option_for_tnx").get("value")==="SCRATCH_INT"){dj.byId("appl_date").set("value",_2d);document.getElementById("appl_date_view_row").childNodes[1].innerHTML=_2d;dj.byId("appl_date_hidden").set("value",_31);}dj.byId("todays_date").set("value",_31);}if(!_2&&!_3){dj.byId("applicant_act_name").set("value","");dj.byId("applicant_act_no").set("value","");dj.byId("beneficiary_name").set("value","");dj.byId("ft_cur_code").set("value","");dj.byId("ft_amt").set("value","");dj.byId("iss_date").set("value",null);dj.byId("issuing_bank_abbv_name").set("value",_2c);_2b=misys._config.customerBankDetails[_2c][0].value;dj.byId("issuing_bank_name").set("value",_2b);m.setApplicantReference();}if(!_2){dj.byId("issuing_bank_abbv_name").set("value",dj.byId("customer_bank").get("value"));_2b=misys._config.customerBankDetails[dj.byId("customer_bank").get("value")][0].value;dj.byId("issuing_bank_name").set("value",_2b);}_2=false;if(dj.byId("customer_bank")&&dj.byId("customer_bank").get("value")!==""){_3=false;if(dj.byId("issuing_bank_abbv_name").get("value")!==""){_2b=misys._config.customerBankDetails[dj.byId("customer_bank").get("value")][0].value;dj.byId("issuing_bank_name").set("value",_2b);}}m.initializeFX(dj.byId("sub_product_code").get("value"),dj.byId("issuing_bank_abbv_name").get("value"));if(dj.byId("applicant_act_cur_code")&&dj.byId("applicant_act_cur_code").get("value")!==""&&dj.byId("ft_cur_code")&&dj.byId("ft_cur_code").get("value")!==""&&dj.byId("applicant_act_cur_code").get("value")!==dj.byId("ft_cur_code").get("value")&&!isNaN(dj.byId("ft_amt").get("value"))){m.onloadFXActions();}else{m.defaultBindTheFXTypes();}_32();};function _32(){var _33=dj.byId("sub_product_code").get("value");if(dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""&&m._config.fxParamData&&m._config.fxParamData[_33][dj.byId("issuing_bank_abbv_name").get("value")].isFXEnabled==="Y"){m.connect("ft_cur_code","onChange",function(){m.setCurrency(this,["ft_amt"]);if(dj.byId("ft_cur_code").get("value")!==""&&!isNaN(dj.byId("ft_amt").get("value"))){m.fireFXAction();}else{if(d.byId(_8)&&(d.style(d.byId(_8),"display")!=="none")){m.animate("wipeOut",d.byId(_8));}m.defaultBindTheFXTypes();}});m.connect("ft_cur_code","onChange",function(){if(dj.byId("iss_date")&&dj.byId("iss_date").get("value")!==""){dj.byId("iss_date").validate();}if(dj.byId("recurring_start_date")&&dj.byId("recurring_start_date").get("value")!==""){dj.byId("recurring_start_date").validate();}m.setCurrency(this,["ft_amt"]);if(dj.byId("ft_cur_code").get("value")!==""&&!isNaN(dj.byId("ft_amt").get("value"))){m.fireFXAction();}else{m.defaultBindTheFXTypes();}});m.connect("ft_amt","onBlur",function(){m.setTnxAmt(this.get("value"));var _34="";if(dj.byId("ft_cur_code")){_34=dj.byId("ft_cur_code").get("value");}if(!isNaN(dj.byId("ft_amt").get("value"))&&_34!==""){m.fireFXAction();}else{m.defaultBindTheFXTypes();}});}else{if(d.byId(_8)){d.style(_8,"display","none");}}if(dijit.byId("ft_cur_code")&&dijit.byId("ft_amt")){misys.setCurrency(dijit.byId("ft_cur_code"),["ft_amt"]);}};function _35(){var _36=true;var _37="";var _38=dj.byId("fx_rates_type_2");var _39=dj.byId("fx_total_utilise_amt");var _3a=dj.byId("ft_amt");var _3b=m._config.fxParamData[dj.byId("sub_product_code").get("value")][dj.byId("issuing_bank_abbv_name").get("value")].maxNbrContracts;if(_38.get("checked")&&_39&&!isNaN(_39.get("value"))&&_3a&&!isNaN(_3a.get("value"))){if(_3a.get("value")<_39.get("value")){_37+=m.getLocalization("FXUtiliseAmtGreaterMessage");_36=false;}}m._config.onSubmitErrorMsg=_37;if(_38.get("checked")&&_39&&_3a){var _3c=0;for(var j=1;j<=_3b;j++){var _3d="fx_contract_nbr_amt_"+j;_3c=_3c+dj.byId(_3d).get("value");if(dj.byId(_3d).get("state")==="Error"||_3c.toFixed(2)>_39.get("value")){dj.byId(_3d).set("state","Error");dj.byId(_3d).focus();_36=false;}}}return _36;};function _3e(){var _3f=dj.byId("notify_beneficiary").get("checked");var _40=dj.byId("notify_beneficiary_choice_1");var _41=dj.byId("notify_beneficiary_choice_2");var _42=dj.byId("notify_beneficiary_email");_40.set("disabled",!_3f);_41.set("disabled",!_3f);_42.set("disabled",!_3f);_40.set("checked",false);_41.set("checked",false);_42.set("value","");var _43=d.byId("notify_beneficiary_email_node");var _44=d.byId("label_notify_beneficiary_choice_2");d.place(_43,_44,"after");m.toggleRequired("notify_beneficiary_email",_3f);m.toggleRequired("notify_beneficiary_choice_1",_3f);m.toggleRequired("notify_beneficiary_choice_2",_3f);};function _45(){var _46=dj.byId("notify_beneficiary_choice_2").get("checked")&&!dj.byId("notify_beneficiary_choice_2").get("disabled");var _47=dj.byId("notify_beneficiary_email");var _48=dj.byId("notify_beneficiary_choice_2");var _49=d.byId("notify_beneficiary_email_node");var _4a=d.byId("label_notify_beneficiary_choice_1");var _4b=d.byId("label_notify_beneficiary_choice_2");var _4c=dj.byId("bene_email_1").get("value");if(!_4c){_4c=dj.byId("bene_email_2").get("value");}if(_46){d.place(_49,_4b,"after");}else{if(!_4c){m.dialog.show("ERROR",m.getLocalization("noBeneficiaryEmail"));_48.set("checked",true);}else{d.place(_49,_4a,"after");}}if(_4c&&!_46){_47.set("value",_4c);_47.set("readOnly",true);}else{_47.set("value","");_47.set("readOnly",false);}};function _4d(){var _4e="";var _4f,_50;if(dj.byId("applicant_act_cur_code")&&dj.byId("applicant_act_cur_code").get("value")!==""){_4f=dj.byId("applicant_act_cur_code").get("value");}if(dj.byId("beneficiary_act_cur_code")&&dj.byId("beneficiary_act_cur_code").get("value")){_50=dj.byId("beneficiary_act_cur_code").get("value");}if(_4f&&_50){if(dj.byId("ft_cur_code")){_4e=dj.byId("ft_cur_code");_4e.store=null;var _51={"identifier":"id","items":[]};var _52=new dojo.data.ItemFileWriteStore({data:_51});if(_4f!==_50){_52.newItem({"id":_4f,"name":_4f});_52.newItem({"id":_50,"name":_50});_4e.store=_52;}else{_52.newItem({"id":_50,"name":_50});_4e.store=_52;}dj.byId("ft_cur_code").set("displayedValue",_50);}}};function _53(){var _54=dj.byId("applicant_act_no").get("value");if(_54===""){m.dialog.show("ERROR",m.getLocalization("selectDebitFirst"));return;}var _55=dijit.byId("sub_product_code").get("value");var _56="FT:"+_55;m.showSearchUserAccountsDialog("useraccount","['beneficiary_name', 'beneficiary_account', 'beneficiary_account_id',"+"'beneficiary_act_cur_code', 'beneficiary_id','beneficiary_act_pab','beneficiary_act_product_types','','','','','beneficiary_account_nickname']","applicant_act_no","entity","credit",_56,"width:750px;height:400px;",m.getLocalization("ListOfAccountsTitleMessage"),"","","","","","","");};function _57(){dojo.forEach(["applicant_act_name","applicant_act_nickname","beneficiary_act_nickname","beneficiary_name","ft_cur_code","beneficiary_act_cur_code","ft_amt","beneficiary_account"],function(_58){if(dj.byId(_58)){dj.byId(_58).set("value","");}});if(d.byId(_8)&&(d.style(d.byId(_8),"display")!=="none")){m.animate("wipeOut",d.byId(_8));}};function _59(){var _5a=dj.byId("applicant_act_no").get("value");var _5b=dj.byId("beneficiary_account").get("value");if(_5a!==""&&_5b!==""&&_5a===_5b){m.dialog.show("ERROR",m.getLocalization("sameBeneficiaryApplicantError"));dj.byId("applicant_act_no").set("value","");dj.byId("applicant_act_name").set("value","");dj.byId("beneficiary_name").set("value","");dj.byId("beneficiary_account").set("value","");return;}else{_4d();}dojo.forEach(["beneficiary_name","ft_amt","beneficiary_act_cur_code"],function(_5c){if(dj.byId(_5c)){dj.byId(_5c).set("value","");}});};function _5d(){var _5e=dj.byId("applicant_act_no")?dj.byId("applicant_act_no").get("value"):"";var _5f=dj.byId("applicant_act_cur_code")?dj.byId("applicant_act_cur_code").get("value"):"";var amt=dj.byId("ft_amt")?dj.byId("ft_amt").get("value"):"";var cur=dj.byId("ft_cur_code")?dj.byId("ft_cur_code").get("value"):"";var _60=dj.byId("iss_date")?dj.byId("iss_date").get("value"):"";if(_60){_60=_60.toISOString();}var _61=dj.byId("productcode")?dj.byId("productcode").get("value"):"";var _62=dj.byId("sub_product_code")?dj.byId("sub_product_code").get("value"):"";var _63=dj.byId("issuing_bank_abbv_name")?dj.byId("issuing_bank_abbv_name").get("value"):"";var _64=dj.byId("company_id")?dj.byId("company_id").get("value"):"";var _65;var _66="";if(dj.byId("sub_product_code")&&dj.byId("sub_product_code").get("value")==="INT"){_65="BOOK";}else{if(dj.byId("sub_product_code")&&dj.byId("sub_product_code").get("value")==="MT101"){_65="SWIFT";}}var _67="SLEV";var _68=dj.byId("issuing_bank_iso_code")?dj.byId("issuing_bank_iso_code").get("value"):"";m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/GetFeeAPIAction"),handleAs:"json",sync:true,content:{accountIdentification:_5e,accountCurrency:_5f,bic:_68,amount:amt,currency:cur,valueDate:_60,clearingScheme:_65,ChargeBearer:_67,productcode:_61,sub_product_code:_62,bank_abbv_name:_63,company_id:_64},load:function(_69,_6a){if(_69.getFeeFlag===true&&_69.statusCode==="200"){dj.byId("payment_fee_amt").set("value",_69.totalFeeAmount);dj.byId("payment_fee_cur_code").set("value",_69.debitAccountCurrency);dj.byId("payment_fee_debit_amt").set("value",_69.debitFeeAmount);dj.byId("payment_tax_debit_fees").set("value",_69.taxOnDebitFees);dj.byId("payment_tax_debit_fees_tax").set("value",_69.taxOnTaxOnDebitFees);dj.byId("payment_fee_agent_amt").set("value",_69.agentFees);_66=_69;}else{if(dj.byId("payment_fee_amt")&&dj.byId("payment_fee_cur_code")&&dj.byId("payment_fee_amt").get("value")!==""){dj.byId("payment_fee_amt").set("value","");dj.byId("payment_fee_cur_code").set("value","");dj.byId("payment_fee_debit_amt").set("value","");dj.byId("payment_tax_debit_fees").set("value","");dj.byId("payment_tax_debit_fees_tax").set("value","");dj.byId("payment_fee_agent_amt").set("value","");}_66=_69;}},error:function(_6b,_6c){console.error("[misys.grid._base] GetProductConfirmPopUp error",_6b);}});return _66;};function _6d(){var _6e=dj.byId("applicant_act_cur_code").get("value");var _6f=dj.byId("beneficiary_act_cur_code").get("value");if(_6e!==""&&_6f!==""&&_6e!==_6f){m.dialog.show("ERROR",m.getLocalization("crossCurrency"));dj.byId("beneficiary_name").set("value","");dj.byId("beneficiary_account").set("value","");dj.byId("beneficiary_act_cur_code").set("value","");dj.byId("ft_cur_code").set("value","");return;}};d.mixin(m._config,{initReAuthParams:function(){var _70={productCode:"FT",subProductCode:dj.byId("sub_product_code").get("value"),transactionTypeCode:"01",entity:dj.byId("entity")?dj.byId("entity").get("value"):"",currency:dj.byId("ft_cur_code")?dj.byId("ft_cur_code").get("value"):"",amount:dj.byId("ft_amt")?m.trimAmount(dj.byId("ft_amt").get("value")):"",bankAbbvName:dj.byId("customer_bank")?dj.byId("customer_bank").get("value"):"",es_field1:dj.byId("ft_amt")?m.trimAmount(dj.byId("ft_amt").get("value")):"",es_field2:(dj.byId("beneficiary_account"))?dj.byId("beneficiary_account").get("value"):""};return _70;}});d.mixin(m,{fireFXAction:function(){if(dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""&&m._config.fxParamData&&dj.byId("sub_product_code")&&dj.byId("sub_product_code").get("value")!==""){var _71=m._config.fxParamData[dj.byId("sub_product_code").get("value")][dj.byId("issuing_bank_abbv_name").get("value")];if(m._config.fxParamData&&_71.isFXEnabled==="Y"){var _72,_73;var _74="";if(dj.byId("ft_cur_code")){_74=dj.byId("ft_cur_code").get("value");}var _75=dj.byId("ft_amt").get("value");var _76=dj.byId("applicant_act_cur_code").get("value");var _77=m._config.productCode;var _78="";if(dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""){_78=dj.byId("issuing_bank_abbv_name").get("value");}var _79=dj.byId("applicant_act_cur_code").get("value");var _7a=dj.byId("beneficiary_act_cur_code");var _7b=false;if(_74!==""&&!isNaN(_75)&&_77!==""&&_78!==""){if(_74!==_76){_72=_76;_73=_74;_79=_76;}else{if(_79&&_79!==""&&_74&&_74!==""&&_79===_74&&(_7a&&_7a.get("value")!==""&&_74!==_7a.get("value"))){_7b=true;_72=_74;_73=_7a.get("value");_79=_73;}}if(_72&&_72!==""&&_73&&_73!==""){if(d.byId(_8)&&(d.style(d.byId(_8),"display")==="none")){m.animate("wipeIn",d.byId(_8));}m.fetchFXDetails(_72,_73,_75,_77,_78,_79,_7b);if(dj.byId("fx_rates_type_1")&&dj.byId("fx_rates_type_1").get("checked")){if(isNaN(dj.byId("fx_exchange_rate").get("value"))||dj.byId("fx_exchange_rate_cur_code").get("value")===""||isNaN(dj.byId("fx_exchange_rate_amt").get("value"))||(m._config.fxParamData[dj.byId("sub_product_code").get("value")][dj.byId("issuing_bank_abbv_name").get("value")].toleranceDispInd==="Y"&&(isNaN(dj.byId("fx_tolerance_rate").get("value"))||isNaN(dj.byId("fx_tolerance_rate_amt").get("value"))||dj.byId("fx_tolerance_rate_cur_code").get("value")===""))){_26(m.getLocalization("FXDefaultErrorMessage"));}}}else{if(d.byId(_8)&&(d.style(d.byId(_8),"display")!=="none")){m.animate("wipeOut",d.byId(_8));}m.defaultBindTheFXTypes();}}}}},bind:function(){m.setValidation("iss_date",m.validateTransferDateCustomer);m.connect("applicant_act_name","onChange",m.checkNickNameDiv);m.connect("beneficiary_name","onChange",function(){if(misys._config.nickname==="true"){if(dj.byId("beneficiary_act_nickname")&&dj.byId("beneficiary_act_nickname").get("value")!==""&&d.byId("beneficiary_name_nickname_row")&&d.byId("ben_nickname")){d.style("ben_label","display","inline-block");d.byId("ben_nickname").innerHTML=dj.byId("beneficiary_act_nickname").get("value");d.byId("ben_nickname").value=dj.byId("beneficiary_act_nickname").get("value");d.style("ben_nickname","display","inline");m.animate("fadeIn",d.byId("beneficiary_name_nickname_row"));}else{if(d.byId("ben_nickname")){d.style("ben_nickname","display","none");}}}});m.connect("iss_date","onClick",function(){m.clearDateCache();if(misys._config.isMultiBank){var _7c;if(dijit.byId("customer_bank")){_7c=dijit.byId("customer_bank").get("value");}if(_7c!==""&&misys&&misys._config&&misys._config.businessDateForBank&&misys._config.businessDateForBank[_7c][0]&&misys._config.businessDateForBank[_7c][0].value!==""){var _7d=parseInt(misys._config.businessDateForBank[_7c][0].value.substring(0,4),10);var _7e=parseInt(misys._config.businessDateForBank[_7c][0].value.substring(5,7),10);var _7f=parseInt(misys._config.businessDateForBank[_7c][0].value.substring(8,10),10);this.dropDown.currentFocus=new Date(_7d,_7e-1,_7f);}}});m.setValidation("template_id",m.validateTemplateId);m.connect("applicant_act_no","onChange",_59);m.connect("customer_bank","onChange",function(){m.handleMultiBankRecurring(_4);_4=false;});if(dj.byId("bulk_ref_id")&&dj.byId("bulk_ref_id").get("value")!==""&&dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""){m.initializeFX(dj.byId("sub_product_code").get("value"),dj.byId("issuing_bank_abbv_name").get("value"));if(dj.byId("applicant_act_cur_code")&&dj.byId("applicant_act_cur_code").get("value")!==""&&dj.byId("ft_cur_code")&&dj.byId("ft_cur_code").get("value")!==""&&dj.byId("applicant_act_cur_code").get("value")!==dj.byId("ft_cur_code").get("value")&&!isNaN(dj.byId("ft_amt").get("value"))){m.onloadFXActions();}else{m.defaultBindTheFXTypes();}_32();}else{m.connect("customer_bank","onChange",_2a);}m.connect("entity","onClick",m.validateRequiredField);m.connect("applicant_act_name","onClick",m.validateRequiredField);m.connect("beneficiary_name","onClick",m.validateRequiredField);m.connect("beneficiary_name","onChange",function(){if(dj.byId("ft_cur_code")&&!dj.byId("ft_cur_code").get("readOnly")){_4d();}});m.connect("beneficiary_act_cur_code","onChange",function(){if(dj.byId("ft_cur_code")&&!dj.byId("ft_cur_code").get("readOnly")){dj.byId("ft_cur_code").set("value",dj.byId("beneficiary_act_cur_code").get("value"));dj.byId("ft_amt").set("value","");_4d();}});m.connect("beneficiary_name","onChange",m.validateMandatoryRemarks);dj.byId("sub_product_code").set("value","INT");m.bindRecurringFields();m.connect("ft_cur_code","onChange",function(){m.setCurrency(this,["ft_amt"]);m.validateMandatoryRemarks();});m.setValidation("beneficiary_act_cur_code",m.validateCurrency);m.connect("entity","onChange",function(){_57();_3=true;dj.byId("applicant_act_name").set("value","");dj.byId("ft_cur_code").set("value","");dj.byId("ft_amt").set("value","");dj.byId("iss_date").set("value",null);if(misys._config.isMultiBank&&dj.byId("customer_bank")){dj.byId("customer_bank").set("disabled",false);dj.byId("customer_bank").set("value","");m.populateCustomerBanks();}if(!misys._config.isMultiBank){m.setApplicantReference();}});m.connect("beneficiary_name","onChange",function(){var _80=dj.byId("currency_res").get("value");if(_80==="true"){_6d();}});m.connect("beneficiary_img","onClick",_53);m.connect("notify_beneficiary","onClick",_3e);m.connect("notify_beneficiary_choice_1","onClick",_45);m.connect("notify_beneficiary_choice_2","onClick",_45);m.connect("recurring_flag","onClick",m.showRecurring);m.connect("recurring_flag","onClick",function(){var _81=dj.byId("gpp_fee_config_flag")?dj.byId("gpp_fee_config_flag").get("value"):"false";var _82=dj.byId("gpp_fee_config_amt_cur_code")?dj.byId("gpp_fee_config_amt_cur_code").get("value"):"",_83=dj.byId("gpp_fee_config_amt_val")?dj.byId("gpp_fee_config_amt_val").get("value"):"";if(dj.byId("response_status")){dj.byId("response_status").set("value","");}if(dj.byId("recurring_flag").get("checked")===true){if(dj.byId("payment_fee_details")){dj.byId("payment_fee_details").set("value","");}if((_81==="true")){if(document.getElementById("NO_FEES_FOR_RECCURING_PAYMENT")){document.getElementById("NO_FEES_FOR_RECCURING_PAYMENT").style.display="block";}m.hideFeeDetailsForError();}}else{if((_81==="true")){m.hideAllDisclaimerMessages();dj.byId("add_fee_details_button").set("disabled",false);document.getElementById("FEE_DETAILS_CONFIRMATION_DISCLAIMER").style.display="block";if(dj.byId("is_view_fees_btn")){dj.byId("is_view_fees_btn").set("value","false");}}}});m.connect("applicant_act_name","onChange",function(){if(dj.byId("ft_cur_code")&&dj.byId("ft_cur_code").get("value")!==""){dj.byId("ft_cur_code").set("value","");var _84={"identifier":"id","items":[]};var _85=new dojo.data.ItemFileWriteStore({data:_84});dj.byId("ft_cur_code").set("store",_85);}});m.setValidation("notify_beneficiary_email",m.validateEmailAddr);var _86=dj.byId("sub_product_code").get("value");if(dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""&&m._config.fxParamData&&m._config.fxParamData[_86][dj.byId("issuing_bank_abbv_name").get("value")].isFXEnabled==="Y"){m.connect("ft_cur_code","onChange",function(){m.setTnxCurCode(dj.byId("ft_cur_code").get("value"));m.setCurrency(this,["ft_amt"]);if(dj.byId("ft_cur_code").get("value")!==""&&!isNaN(dj.byId("ft_amt").get("value"))){m.fireFXAction();}else{m.defaultBindTheFXTypes();}});m.connect("ft_amt","onBlur",function(){m.setTnxAmt(this.get("value"));var _87="";if(dj.byId("ft_cur_code")){_87=dj.byId("ft_cur_code").get("value");}if(!isNaN(dj.byId("ft_amt").get("value"))&&_87!==""){m.fireFXAction();}else{m.defaultBindTheFXTypes();}});}else{if(d.byId(_8)){d.style(_8,"display","none");}}if(dijit.byId("ft_cur_code")&&dijit.byId("ft_amt")){misys.setCurrency(dijit.byId("ft_cur_code"),["ft_amt"]);}m.connect("ft_amt","onChange",function(){var _88=dj.byId("gpp_fee_config_flag")?dj.byId("gpp_fee_config_flag").get("value"):"false";var _89=dj.byId("gpp_fee_config_amt_cur_code")?dj.byId("gpp_fee_config_amt_cur_code").get("value"):"",_8a=dj.byId("gpp_fee_config_amt_val")?dj.byId("gpp_fee_config_amt_val").get("value"):"";if(_88==="true"){if(dj.byId("payment_fee_details")){dj.byId("payment_fee_details").set("value","");}if(dj.byId("response_status")){dj.byId("response_status").set("value","");}if(dj.byId("is_view_fees_btn")){dj.byId("is_view_fees_btn").set("value","false");}document.getElementById("ft_fee_details_div").style.display="none";m.hideAllDisclaimerMessages();if(!(dj.byId("recurring_payment_enabled"))||(dj.byId("recurring_payment_enabled")&&dj.byId("recurring_payment_enabled").get("checked")===false)){dj.byId("add_fee_details_button").set("disabled",false);document.getElementById("FEE_DETAILS_CONFIRMATION_DISCLAIMER").style.display="block";}else{if((dj.byId("recurring_payment_enabled")&&dj.byId("recurring_payment_enabled").get("checked")===true)){document.getElementById("NO_FEES_FOR_RECCURING_PAYMENT").style.display="block";}}}});m.connect("ft_cur_code","onChange",function(){var _8b=dj.byId("gpp_fee_config_flag")?dj.byId("gpp_fee_config_flag").get("value"):"false";var _8c=dj.byId("gpp_fee_config_amt_cur_code")?dj.byId("gpp_fee_config_amt_cur_code").get("value"):"",_8d=dj.byId("gpp_fee_config_amt_val")?dj.byId("gpp_fee_config_amt_val").get("value"):"";if(_8b==="true"){if(dj.byId("payment_fee_details")){dj.byId("payment_fee_details").set("value","");}if(dj.byId("response_status")){dj.byId("response_status").set("value","");}if(dj.byId("is_view_fees_btn")){dj.byId("is_view_fees_btn").set("value","false");}document.getElementById("ft_fee_details_div").style.display="none";document.getElementById("fee_agent_details_div").style.display="none";document.getElementById("grand_total_fee_details").style.display="none";m.hideAllDisclaimerMessages();if(!(dj.byId("recurring_payment_enabled"))||(dj.byId("recurring_payment_enabled")&&dj.byId("recurring_payment_enabled").get("checked")===false)){dj.byId("add_fee_details_button").set("disabled",false);document.getElementById("FEE_DETAILS_CONFIRMATION_DISCLAIMER").style.display="block";}else{if((dj.byId("recurring_payment_enabled")&&dj.byId("recurring_payment_enabled").get("checked")===true)){document.getElementById("NO_FEES_FOR_RECCURING_PAYMENT").style.display="block";}}}});},onFormLoad:function(){m.setCurrency(dj.byId("ft_cur_code"),["ft_amt"]);m.initForm();var _8e=dijit.byId("mode")?dijit.byId("mode").get("value"):"";if(misys._config.nickname==="true"&&dj.byId("applicant_act_nickname")&&dj.byId("applicant_act_nickname").get("value")!==""&&d.byId("nickname")){m.animate("fadeIn",d.byId("nickname"));d.style("nickname","display","inline");d.byId("nickname").innerHTML=dj.byId("applicant_act_nickname").get("value");}else{if(misys._config.nickname==="true"&&dj.byId("beneficiary_act_nickname")&&dj.byId("beneficiary_act_nickname").get("value")!==""&&d.byId("ben_nickname")){m.animate("fadeIn",d.byId("ben_nickname"));d.style("ben_nickname","display","inline");d.byId("ben_nickname").innerHTML=dj.byId("beneficiary_act_nickname").get("value");}else{m.animate("fadeOut",d.byId("applicant_act_nickname_row"));m.animate("fadeOut",d.byId("beneficiary_name_nickname_row"));}}if(dj.byId("customer_bank")&&dj.byId("customer_bank").get("value")!==""&&misys&&misys._config&&misys._config.businessDateForBank&&misys._config.businessDateForBank[dj.byId("customer_bank").get("value")]&&misys._config.businessDateForBank[dj.byId("customer_bank").get("value")][0]&&misys._config.businessDateForBank[dj.byId("customer_bank").get("value")][0].value!==""){var _8f=misys._config.businessDateForBank[dj.byId("customer_bank").get("value")][0].value;var _90=_8f.substring(0,4);var _91=_8f.substring(5,7);var _92=_8f.substring(8,10);_8f=_92+"/"+_91+"/"+_90;var _93=new Date(_90,_91-1,_92);if(dj.byId("option_for_tnx")&&dj.byId("option_for_tnx").get("value")==="SCRATCH"){dj.byId("appl_date").set("value",_8f);document.getElementById("appl_date_view_row").childNodes[1].innerHTML=_8f;if(dj.byId("appl_date_hidden")){dj.byId("appl_date_hidden").set("value",_93);}}if(dj.byId("todays_date")){dj.byId("todays_date").set("value",_93);}}if(misys._config.isMultiBank){m.populateCustomerBanks(true);var _94=dj.byId("entity");var _95=dj.byId("customer_bank");if(!_94&&_95){_95.set("disabled",false);_95.set("required",true);}var _96=dj.byId("customer_bank_hidden");if(_95&&_96){_95.set("value",_96.get("value"));}if(dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""){_2=true;_3=true;_95.set("value",dj.byId("issuing_bank_abbv_name").get("value"));_96.set("value",dj.byId("issuing_bank_abbv_name").get("value"));}if(_94&&_94.get("value")===""&&_95){_95.set("disabled",true);_95.set("required",false);}if(misys._config.perBankRecurringAllowed&&dojo.byId("recurring_payment_checkbox")&&dj.byId("customer_bank")){if(dj.byId("customer_bank").get("value")===""){m.animate("fadeOut",dojo.byId("recurring_payment_checkbox"));}else{if(dj.byId("customer_bank").get("value")!==""&&misys._config.perBankRecurringAllowed[dj.byId("customer_bank").get("value")]!=="Y"){m.animate("fadeOut",dojo.byId("recurring_payment_checkbox"));}}}if(d.byId("server_message")&&d.byId("server_message").innerHTML!==""||dijit.byId("option_for_tnx")&&(dijit.byId("option_for_tnx").get("value")===""||dijit.byId("option_for_tnx").get("value")==="TEMPLATE")){_4=true;}if(dijit.byId("recurring_frequency")&&dijit.byId("customer_bank").get("value")!==""&&misys._config.perBankFrequency){var _97=misys._config.perBankFrequency[dijit.byId("customer_bank").get("value")];if(_97){dijit.byId("recurring_frequency").store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_97}});dijit.byId("recurring_frequency").fetchProperties={sort:[{attribute:"name"}]};}dijit.byId("recurring_frequency").set("value",dijit.byId("recurring_frequency")._lastQuery);}}else{m.setApplicantReference();}if(dj.byId("recurring_payment_enabled")&&dj.byId("recurring_payment_enabled").get("checked")){dj.byId("recurring_flag").set("checked",true);m._config.clearOnSecondCall=true;m.showSavedRecurringDetails(false);}else{if(d.byId("recurring_payment_div")){d.style("recurring_payment_div","display","none");}m.hasRecurringPayment();m.showSavedRecurringDetails(false);}if(dj.byId("applicant_act_product_types")&&dj.byId("applicant_act_no").get("value")!==""){m.toggleRequired("applicant_act_product_types",false);}var _98=dj.byId("notify_beneficiary_email");var _99=dj.byId("notify_beneficiary_choice");if(_98&&_98.get("value")!==""&&_99&&(_99.get("value")==="default_email")){dj.byId("bene_email_1").set("value",_98.get("value"));}if(dj.byId("notify_beneficiary")&&dj.byId("notify_beneficiary").get("checked")&&(_8e==="DRAFT")){var _9a=dj.byId("notify_beneficiary").get("checked");m.toggleRequired("notify_beneficiary_email",_9a);m.toggleRequired("notify_beneficiary_choice_1",_9a);m.toggleRequired("notify_beneficiary_choice_2",_9a);if(dj.byId("notify_beneficiary_choice_1").get("checked")){var _9b=d.byId("notify_beneficiary_email_node");var _9c=d.byId("label_notify_beneficiary_choice_2");_45();if(dj.byId("notify_beneficiary_choice_2").get("checked")){d.place(_9b,_9c,"after");}}}var _9d=dj.byId("applicant_act_cur_code");var _9e=dj.byId("beneficiary_act_cur_code");var _9f=dj.byId("ft_cur_code");if(!m._config.isMultiBank&&dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""&&m._config.fxParamData&&dj.byId("sub_product_code")&&dj.byId("sub_product_code").get("value")!==""){m.initializeFX(dj.byId("sub_product_code").get("value"),dj.byId("issuing_bank_abbv_name").get("value"));if(_9d&&_9d.get("value")!==""&&_9f&&_9f.get("value")!==""&&(_9d.get("value")!==_9f.get("value")||_9f.get("value")!==_9e.get("value"))){m.onloadFXActions();}else{m.defaultBindTheFXTypes();}}else{m.animate("fadeOut",_1);}if(d.byId(_8)){if(dj.byId("bulk_ref_id").get("value")!==""&&dj.byId("ft_cur_code").get("value")!==""&&!isNaN(dj.byId("ft_amt").get("value"))){m.initializeFX(dj.byId("sub_product_code").get("value"),dj.byId("issuing_bank_abbv_name").get("value"));m.fireFXAction();}else{if((dj.byId("fx_exchange_rate_cur_code")&&dj.byId("fx_exchange_rate_cur_code").get("value")!=="")||(dj.byId("fx_total_utilise_cur_code")&&dj.byId("fx_total_utilise_cur_code").get("value")!=="")){m.animate("wipeIn",d.byId(_8));}else{d.style(_8,"display","none");}}}var _a0=dj.byId("ft_cur_code");if(_a0){var _a1=_a0.get("displayedValue");_4d();_a0.set("displayedValue",_a1);}m.validateMandatoryRemarks();var _a2=dj.byId("gpp_fee_config_flag")?dj.byId("gpp_fee_config_flag").get("value"):"false";if(dj.byId("ft_amt")&&dj.byId("ft_amt").get("value")!=""){var _a3=(dojo.number.parse(dj.byId("ft_amt").get("value"))>0)?dojo.number.parse(dj.byId("ft_amt").get("value")):0;}if((dj.byId("recurring_payment_enabled")&&dj.byId("recurring_payment_enabled").get("checked")==true)&&_a2==="true"){document.getElementById("ftFeeFetails").style.display="block";document.getElementById("ft-fee-details-template").style.display="block";document.getElementById("NO_FEES_FOR_RECCURING_PAYMENT").style.display="block";}else{if(_a2==="true"){document.getElementById("ftFeeFetails").style.display="block";document.getElementById("ft-fee-details-template").style.display="block";document.getElementById("FEE_DETAILS_CONFIRMATION_DISCLAIMER").style.display="block";if(_8e==="DRAFT"&&_a3>0){if(dj.byId("is_view_fees_btn")){dj.byId("is_view_fees_btn").set("value","false");}}}}},initForm:function(){dj.byId("sub_product_code").set("value","INT");},setCustomConfirmMessage:function(){var _a4=dijit.byId("mode")?dijit.byId("mode").get("value"):"";if(_a4==="DRAFT"){var _a5=_5d();if(_a5.getFeeFlag==true&&_a5.statusCode!=="200"){var _a6=m.getLocalization("getFeeErrorResponse");m._config.globalSubmitConfirmationMsg=_a6;}else{if(_a5.getFeeFlag&&_a5.statusCode==="200"){var _a7=m.getLocalization("submitTransactionConfirmation");m._config.globalSubmitConfirmationMsg=_a7+_9()+_f()+_13()+_1a(_a5);}else{var _a8=m.getLocalization("submitTransactionConfirmation");m._config.globalSubmitConfirmationMsg=_a8;}}}},beforeSaveValidations:function(){if(dj.byId("payment_fee_details")){dj.byId("payment_fee_details").set("value","");}var _a9=dj.byId("entity");if(_a9&&_a9.get("value")===""){return false;}return true;},beforeSubmitValidations:function(){var _aa=dijit.byId("mode")?dijit.byId("mode").get("value"):"";if(!m.isRecurringDetailsValidForSubmit()){return false;}if(dj.byId("ft_amt")){if(!m.validateAmount((dj.byId("ft_amt"))?dj.byId("ft_amt"):0)){m._config.onSubmitErrorMsg=m.getLocalization("amountcannotzero");dj.byId("ft_amt").set("value","");return false;}}if(dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""&&m._config.fxParamData&&m._config.fxParamData[dj.byId("sub_product_code").get("value")][dj.byId("issuing_bank_abbv_name").get("value")].isFXEnabled==="Y"){if(!m.fxBeforeSubmitValidation()){return false;}if(!_35()){return false;}}if(dijit.byId("free_format_text")){if(dijit.byId("free_format_text").get("required")){var _ab=dijit.byId("free_format_text").get("value").trim();if(_ab.length===0){dj.byId("free_format_text").set("value","");dj.byId("free_format_text").set("state","Error");return false;}}}var _ac=dj.byId("applicant_act_no").get("value");var _ad=m.checkAccountStatus(_ac);if(!_ad){m._config.onSubmitErrorMsg=misys.getLocalization("accountStatusError");return false;}var _ae=0,_af="";if(dj.byId("to_currency_amount")){_ae=dj.byId("to_currency_amount").get("value");}if(dj.byId("to_currency")){_af=dj.byId("to_currency").get("value");}var _b0=dj.byId("gpp_fee_config_flag")?dj.byId("gpp_fee_config_flag").get("value"):"false";var _b1=dj.byId("gpp_fee_config_amt_cur_code")?dj.byId("gpp_fee_config_amt_cur_code").get("value"):"",_b2=dj.byId("gpp_fee_config_amt_val")?dj.byId("gpp_fee_config_amt_val").get("value"):"";if(_b0==="true"&&((((_b1===dj.byId("ft_cur_code").get("value"))||_b1==="*")&&(_b2>=dj.byId("ft_amt").get("value")))||((_b1===_af)&&((dojo.number.parse(_b2))>=_ae)))){if(dj.byId("payment_fee_details")){dj.byId("payment_fee_details").set("value","");}}if((dj.byId("recurring_flag")&&dj.byId("recurring_flag").get("checked")===false)&&_b0==="true"){if(dj.byId("is_view_fees_btn")&&dj.byId("is_view_fees_btn").get("value")!="true"){if(((_b1===dj.byId("ft_cur_code").get("value"))||_b1==="*")||(_b1!=dj.byId("ft_cur_code").get("value"))){if((dj.byId("payment_fee_details"))&&dj.byId("payment_fee_details").get("value")===""){m._config.onSubmitErrorMsg=m.getLocalization("feeChargesAreNotAccurate");return false;}}}}if(!dj.byId("bulk_ref_id").get("value")){var _b3=false;if(_aa==="DRAFT"){if(dj.byId("recurring_payment_enabled")&&dj.byId("recurring_payment_enabled").get("checked")){_b3=m.validateHolidaysAndCutOffTime("issuing_bank_abbv_name","sub_product_code",_aa,["Start Date"],["recurring_start_date"],"entity","ft_cur_code","ft_amt");}else{_b3=m.validateHolidaysAndCutOffTime("issuing_bank_abbv_name","sub_product_code",_aa,["Transfer Date"],["iss_date"],"entity","ft_cur_code","ft_amt");}}else{if(_aa==="UNSIGNED"){if(dj.byId("recurring_payment_enabled")&&dj.byId("recurring_payment_enabled").get("value")==="Y"){_b3=m.validateHolidaysAndCutOffTime("issuing_bank_abbv_name","sub_product_code_unsigned",_aa,["Start Date"],["recurring_start_date_unsigned"],"display_entity_unsigned","ft_cur_code_unsigned","ft_amt_unsigned");}else{_b3=m.validateHolidaysAndCutOffTime("issuing_bank_abbv_name","sub_product_code_unsigned",_aa,["Transfer Date"],["iss_date_unsigned"],"display_entity_unsigned","ft_cur_code_unsigned","ft_amt_unsigned");}}else{m._config.onSubmitErrorMsg=m.getLocalization("technicalErrorWhileValidatingBusinessDays");}}if(_b3){m._config.holidayCutOffEnabled=false;}return _b3;}else{return true;}},showListOfBanks:function(){m.showSearchDialog("bank","['cpty_bank_name', 'cpty_bank_address_line_1', 'cpty_bank_address_line_2', 'cpty_bank_dom',"+" 'cpty_bank_swift_bic_code', 'cpty_bank_contact_name', 'cpty_bank_phone', 'bank_country']",{swiftcode:false,bankcode:false},"","","width:710px;height:350px;",m.getLocalization("ListOfSwiftBanksTitleMessage"));}});})(dojo,dijit,misys);dojo.require("misys.client.binding.cash.create_ft_int_client");}