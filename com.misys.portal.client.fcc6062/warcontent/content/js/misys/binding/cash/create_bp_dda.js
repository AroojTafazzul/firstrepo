/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.cash.create_bp_dda"]){dojo._hasResource["misys.binding.cash.create_bp_dda"]=true;dojo.provide("misys.binding.cash.create_bp_dda");dojo.require("dojo.parser");dojo.require("dijit.layout.TabContainer");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("misys.widget.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("misys.form.PercentNumberTextBox");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.widget.Collaboration");dojo.require("misys.form.common");dojo.require("misys.form.file");dojo.require("misys.validation.common");dojo.require("misys.binding.cash.ft_common");dojo.require("misys.form.BusinessDateTextBox");(function(d,dj,m){function _1(){m.setTnxAmt(dj.byId("ft_amt").get("value"));};function _2(){var _3=dj.byId("entity"),_4=dj.byId("applicant_act_name"),_5="";if(_3&&(_3.get("value")===""||_4.get("value")==="")){_5=misys.getLocalization("remittanceToolTip",[_3.get("value"),_4.get("value")]);if("S"+_3.get("value")==="S"){_3.focus();_3.set("state","Error");dj.hideTooltip(_3.domNode);dj.showTooltip(_5,_3.domNode,0);}if("S"+_4.get("value")==="S"){_4.focus();_4.set("state","Error");dj.hideTooltip(_4.domNode);dj.showTooltip(_5,_4.domNode,0);}}else{if(dj.byId("applicant_act_name").get("value")!==""){m.toggleSections();m.showRecurring();}}if(misys._config.nickname==="true"){if(dj.byId("applicant_act_nickname")&&dj.byId("applicant_act_nickname").get("value")!==""){d.style("label","display","inline-block");m.animate("fadeIn",d.byId("nickname"));d.style("nickname","display","inline");d.byId("nickname").innerHTML=dj.byId("applicant_act_nickname").get("value");}else{m.animate("wipeOut",d.byId("applicant_act_nickname_row"));}}if(misys._config.isMultiBank&&dj.byId("issuing_bank")&&dj.byId("issuing_bank").get("value")!==""){dj.byId("issuing_bank_name").set("value",dj.byId("issuing_bank").get("value"));dj.byId("issuing_bank_abbv_name").set("value",dj.byId("issuing_bank").get("value"));}if(dj.byId("applicant_name")&&dj.byId("applicant_name").get("value")===""){dj.byId("applicant_name").set("value",_3.get("value"));}d.forEach(dojo.query(".bpddaDisclaimer"),function(_6){m.animate("fadeOut",_6);});};d.mixin(m._config,{initReAuthParams:function(){var _7={productCode:"FT",subProductCode:dj.byId("sub_product_code").get("value"),transactionTypeCode:"01",entity:(dj.byId("entity"))?dj.byId("entity").get("value"):"",currency:dj.byId("ft_cur_code")?dj.byId("ft_cur_code").get("value"):"",amount:dj.byId("ft_amt")?m.trimAmount(dj.byId("ft_amt").get("value")):"",es_field1:dj.byId("ft_amt")?m.trimAmount(dj.byId("ft_amt").get("value")):"",es_field2:(dj.byId("beneficiary_account"))?dj.byId("beneficiary_account").get("value"):""};return _7;}});d.mixin(m,{bind:function(){m.setValidation("iss_date",m.validateTransferDateCustomer);m.connect("application_act_name","onChange",function(){if(dj.byId("application_act_nickname_row")&&dj.byId("application_act_nickname_row").get("value")!==""){m.animate("fadeId",d.byId("nickname"));d.byId("nickname").innerHTML=dj.byId("applicant_act_nickname").get("value");}});m.connect("iss_date","onClick",function(){m.clearDateCache();if(misys._config.isMultiBank){var _8;if(dijit.byId("customer_bank")){_8=dijit.byId("customer_bank").get("value");}if(_8!==""&&misys&&misys._config&&misys._config.businessDateForBank&&misys._config.businessDateForBank[_8][0]&&misys._config.businessDateForBank[_8][0].value!==""){var _9=parseInt(misys._config.businessDateForBank[_8][0].value.substring(0,4),10);var _a=parseInt(misys._config.businessDateForBank[_8][0].value.substring(5,7),10);var _b=parseInt(misys._config.businessDateForBank[_8][0].value.substring(8,10),10);this.dropDown.currentFocus=new Date(_9,_a-1,_b);}}});m.setValidation("start_date",m.validateStartDate);m.setValidation("end_date",m.validateEndDate);m.connect("customer_bank","onChange",function(){var _c=dj.byId("customer_bank").get("value");dj.byId("customer_bank_hidden").set("value",dj.byId("customer_bank").get("value"));dj.byId("issuing_bank_abbv_name").set("value",dj.byId("customer_bank").get("value"));var _d=misys._config.customerBankDetails[_c][0].value;dj.byId("issuing_bank_name").set("value",_d);if(misys&&misys._config&&misys._config.businessDateForBank&&misys._config.businessDateForBank[_c]&&misys._config.businessDateForBank[_c][0]&&misys._config.businessDateForBank[_c][0].value!==""){var _e=misys._config.businessDateForBank[_c][0].value;var _f=_e.substring(0,4);var _10=_e.substring(5,7);var _11=_e.substring(8,10);_e=_11+"/"+_10+"/"+_f;var _12=new Date(_f,_10-1,_11);if(misys&&misys._config&&misys._config.option_for_app_date==="SCRATCH"){dj.byId("appl_date").set("value",_e);document.getElementById("appl_date_view_row").childNodes[1].innerHTML=_e;if(dj.byId("appl_date_hidden")){dj.byId("appl_date_hidden").set("value",_12);}}if(dj.byId("todays_date")){dj.byId("todays_date").set("value",_12);}}});m.bindRecurringFields();m.connect("ft_amt","onChange",_1);m.connect("entity","onClick",m.validateRequiredField);m.connect("applicant_act_name","onClick",m.validateRequiredField);m.connect("entity","onChange",function(){d.query("#display_entity_row div")[0].innerHTML=dj.byId("entity").get("value");dj.byId("applicant_act_name").set("value","");});m.connect("applicant_act_name","onChange",function(){d.query("#display_account_row div")[0].innerHTML=dj.byId("applicant_act_name").get("value");});m.connect("button_intrmdt_ok","onClick",_2);m.connect("action","onChange",function(){if(this.get("value")=="MODIFY"){m.animate("wipeIn",d.byId("dda-update-amount"));}else{m.animate("wipeOut",d.byId("dda-update-amount"));}});if(dijit.byId("ft_cur_code")&&dijit.byId("ft_amt")){misys.setCurrency(dijit.byId("ft_cur_code"),["ft_amt"]);}m.connect("recurring_flag","onClick",m.showRecurring);},showReference:function(_13){m.dialog.show("Alert",_13);},showFields:function(){if(dj.byId("entity")){var _14=dj.byId("entity").domNode;if(dj.byId("entity").get("value")===""){dj.showTooltip(m.getLocalization("remittanceToolTip"),_14,0);var _15=function(){dj.hideTooltip(_14);};var _16=1000;setTimeout(_15,_16);return false;}}var _17=dj.byId("transfer_from").domNode;if(dj.byId("transfer_from").get("value")===""){dj.showTooltip(m.getLocalization("remittanceToolTip"),_17,0);var _18=function(){dj.hideTooltip(_17);};var _19=1000;setTimeout(_18,_19);return false;}m.animate("wipeOut",d.byId("content1"),_showContent2);return true;},cancelAction:function(){if(dj.byId("entity")){dj.byId("entity").reset();}dj.byId("transfer_from").reset();dj.byId("recurring_flag").reset();},onFormLoad:function(){if(dj.byId("action")){dj.byId("action").set("value","MODIFY");}if(misys._config.isMultiBank){if(dj.byId("customer_bank")){var _1a=dj.byId("customer_bank").get("value");}dj.byId("customer_bank").set("value",dj.byId("customer_bank_hidden").get("value"));dj.byId("issuing_bank_abbv_name").set("value",dj.byId("customer_bank").get("value"));var _1b=misys._config.customerBankDetails[dj.byId("customer_bank").get("value")][0].value;dj.byId("issuing_bank_name").set("value",_1b);if(_1a!==""&&misys&&misys._config&&misys._config.businessDateForBank&&misys._config.businessDateForBank[_1a]&&misys._config.businessDateForBank[_1a][0]&&misys._config.businessDateForBank[_1a][0].value!==""){var _1c=misys._config.businessDateForBank[_1a][0].value;var _1d=_1c.substring(0,4);var _1e=_1c.substring(5,7);var _1f=_1c.substring(8,10);_1c=_1f+"/"+_1e+"/"+_1d;var _20=new Date(_1d,_1e-1,_1f);if(misys&&misys._config&&misys._config.option_for_app_date==="SCRATCH"){dj.byId("appl_date").set("value",_1c);document.getElementById("appl_date_view_row").childNodes[1].innerHTML=_1c;if(dj.byId("appl_date_hidden")){dj.byId("appl_date_hidden").set("value",_20);}}if(dj.byId("todays_date")){dj.byId("todays_date").set("value",_20);}}if(misys._config.perBankRecurringAllowed&&misys._config.perBankRecurringAllowed[dj.byId("customer_bank").get("value")]==="Y"){m.animate("fadeIn",dojo.byId("recurring_payment_checkbox_div"));}else{m.animate("fadeOut",dojo.byId("recurring_payment_checkbox_div"));}if(dijit.byId("recurring_frequency")&&dijit.byId("customer_bank").get("value")!==""&&misys._config.perBankFrequency){var _21=misys._config.perBankFrequency[dijit.byId("customer_bank").get("value")];if(_21){dijit.byId("recurring_frequency").store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_21}});dijit.byId("recurring_frequency").fetchProperties={sort:[{attribute:"name"}]};}dijit.byId("recurring_frequency").set("value",dijit.byId("recurring_frequency")._lastQuery);}}if(misys._config.nickname==="true"&&misys._config.option_for_app_date!=="SCRATCH"){if(dj.byId("applicant_act_nickname")&&dj.byId("applicant_act_nickname").get("value")===""){m.animate("wipeOut",d.byId("applicant_act_nickname_row"));m.animate("wipeOut",d.byId("nickname"));}}if(misys._config.singleBankRecurring&&misys._config.singleBankRecurring[dj.byId("sub_product_code").get("value")]==="Y"){m.animate("fadeIn",dojo.byId("recurring_payment_checkbox_div"));}else{m.animate("fadeOut",dojo.byId("recurring_payment_checkbox_div"));}if(dj.byId("recurring_payment_enabled")&&dj.byId("recurring_payment_enabled").get("checked")){dj.byId("recurring_flag").set("checked",true);m.showSavedRecurringDetails(false);}else{if(d.byId("recurring_payment_div")){d.style("recurring_payment_div","display","none");}m.hasRecurringPayment();m.showSavedRecurringDetails(false);}if(dj.byId("recurring_payment_enabled")&&dj.byId("recurring_payment_enabled").get("checked")){m.toggleFields(true,null,["recurring_start_date","recurring_frequency","recurring_end_date"],true,false);}m.setCurrency(dj.byId("ft_cur_code"),["ft_amt"]);m.setTnxAmt(dj.byId("ft_amt").get("value"));if(dj.byId("applicant_act_name")&&dj.byId("applicant_act_name").get("value")===""){d.style("content1","display","block");d.style("content2","display","none");}else{if(!dj.byId("action")){d.style("content1","display","none");d.style("content2","display","block");}m.initForm();var _22=dijit.byId("mode")?dijit.byId("mode").get("value"):"";if(dj.byId("sub_product_code").get("value")==="DDA"&&_22==="DRAFT"&&dj.byId("tnxtype").get("value")!=="03"){m.showRecurring();}}d.forEach(d.query(".bpddaDisclaimer"),function(_23){var _24=dj.byId("sub_product_code").get("value")+"_"+m.getLocalization("disclaimer");if(dj.byId("sub_product_code")&&(_23.id==_24)){m.animate("fadeIn",_24);}});m.showSavedRecurringDetails(true);},initForm:function(){if(dj.byId("action")){if(dj.byId("action").get("value")==="MODIFY"){m.animate("wipeIn",d.byId("dda-update-amount"));}else{m.animate("wipeOut",d.byId("dda-update-amount"));}}},beforeSaveValidations:function(){var _25=dj.byId("entity");var _26=false;if(_25&&_25.get("value")==""){return _26;}else{return !_26;}},beforeSubmitValidations:function(){var _27=dj.byId("sub_product_code").get("value");var _28=false;var _29=dijit.byId("mode")?dijit.byId("mode").get("value"):"";if(dj.byId("ft_amt")){if(!m.validateAmount((dj.byId("ft_amt"))?dj.byId("ft_amt"):0)){m._config.onSubmitErrorMsg=m.getLocalization("amountcannotzero");dj.byId("ft_amt").set("value","");return false;}}var _2a=dj.byId("applicant_act_no").get("value");var _2b=m.checkAccountStatus(_2a);if(!_2b){m._config.onSubmitErrorMsg=misys.getLocalization("accountStatusError");return false;}if(_27==="BILLP"||_27==="BILLS"){if(!m.isRecurringDetailsValidForSubmit()){return false;}if(_29==="DRAFT"){if(dj.byId("recurring_payment_enabled")&&dj.byId("recurring_payment_enabled").get("checked")){_28=m.validateHolidaysAndCutOffTime("issuing_bank_abbv_name","sub_product_code",_29,["Start Date"],["recurring_start_date"],"entity","ft_cur_code","ft_amt");}else{_28=m.validateHolidaysAndCutOffTime("issuing_bank_abbv_name","sub_product_code",_29,["Transfer Date"],["iss_date"],"entity","ft_cur_code","ft_amt");}}else{if(_29==="UNSIGNED"){if(dj.byId("recurring_payment_enabled")&&dj.byId("recurring_payment_enabled").get("value")==="Y"){_28=m.validateHolidaysAndCutOffTime("issuing_bank_abbv_name","sub_product_code_unsigned",_29,["Start Date"],["recurring_start_date_unsigned"],"display_entity_unsigned","ft_cur_code_unsigned","ft_amt_unsigned");}else{_28=m.validateHolidaysAndCutOffTime("issuing_bank_abbv_name","sub_product_code_unsigned",_29,["Transfer Date"],["iss_date_unsigned"],"display_entity_unsigned","ft_cur_code_unsigned","ft_amt_unsigned");}}else{m._config.onSubmitErrorMsg=m.getLocalization("technicalErrorWhileValidatingBusinessDays");console.error("Mode is unknown to validate Holidays and Cut-Off Time");}}return _28;}else{if(_27==="DDA"){if(_29==="DRAFT"){if(dj.byId("tnxtype").get("value")!=="03"){_28=m.validateHolidaysAndCutOffTime("issuing_bank_abbv_name","sub_product_code",_29,["Start Date","End Date"],["start_date","end_date"],"entity","ft_cur_code","ft_amt");}else{_28=true;}}else{if(_29==="UNSIGNED"){_28=m.validateHolidaysAndCutOffTime("issuing_bank_abbv_name","sub_product_code_unsigned",_29,["Start Date","End Date"],["start_date_unsigned","end_date_unsigned"],"display_entity_unsigned","ft_cur_code_unsigned","ft_amt_unsigned");}else{m._config.onSubmitErrorMsg=m.getLocalization("technicalErrorWhileValidatingBusinessDays");console.error("Mode is unknown to validate Holidays and Cut-Off Time");}}return _28;}}}});})(dojo,dijit,misys);dojo.require("misys.client.binding.cash.create_bp_dda_client");}