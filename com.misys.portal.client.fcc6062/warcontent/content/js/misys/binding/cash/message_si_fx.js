/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.cash.message_si_fx"]){dojo._hasResource["misys.binding.cash.message_si_fx"]=true;dojo.provide("misys.binding.cash.message_si_fx");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("misys.grid._base");dojo.require("dojo.data.ItemFileReadStore");dojo.require("dojo.parser");dojo.require("dojo.data.ItemFileReadStore");dojo.require("dijit.layout.TabContainer");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.layout.ContentPane");dojo.require("dijit.form.DateTextBox");dojo.require("dijit.form.CurrencyTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("dojox.grid.EnhancedGrid");dojo.require("dojox.grid.enhanced.plugins.Menu");dojo.require("dojox.grid.enhanced.plugins.NestedSorting");dojo.require("dojox.grid.enhanced.plugins.IndirectSelection");dojo.require("dojox.grid.cells.dijit");dojo.require("misys.binding.cash.common.request_action");dojo.require("misys.binding.common");dojo.require("misys.binding.cash.common.standing_instruction_action");(function(d,dj,m){d.mixin(m._config,{initReAuthParams:function(){var _1={productCode:"FX",subProductCode:dj.byId("sub_product_code")?dj.byId("sub_product_code").get("value"):"",transactionTypeCode:"13",entity:dj.byId("entity")?dj.byId("entity").get("value"):"",currency:"",amount:"",es_field1:"",es_field2:""};return _1;}});d.mixin(m,{bind:function(){if(dj.byId("beneficiary_country")){m.setValidation("beneficiary_country",m.validateCountry);}if(dj.byId("beneficiary_bank_country")){m.setValidation("beneficiary_bank_country",m.validateCountry);}if(dj.byId("ordering_cust_country")){m.setValidation("ordering_cust_country",m.validateCountry);}if(dj.byId("intermediary_bank_country")){m.setValidation("intermediary_bank_country",m.validateCountry);}m.connect("beneficiary_bank_bic","onBlur",function(){var _2="beneficiary";var _3=dj.byId("beneficiary_bank_bic").value;m.toggleBeneficiaryFields(_3,_2,"beneficiary_bank_country_btn_img",true);});m.connect("intermediary_bank_bic","onBlur",function(){var _4="intermediary";var _5=dj.byId("intermediary_bank_bic").value;m.toggleBeneficiaryFields(_5,_4,"intermediary_bank_country_btn_img",false);});m.connect("beneficiary_bank","onBlur",function(){var _6=dj.byId("beneficiary_bank").value;var _7="false";if(dj.byId("show_bic_code")){_7=dj.byId("show_bic_code").get("value");}if(_7==="true"){if(dj.byId("beneficiary_bank_bic")&&dj.byId("beneficiary_bank_bic").get("value")===""){m.toggleBICFields(_6,"beneficiary_bank_bic");}}else{m.toggleBICFields(_6,"beneficiary_bank_bic");}});m.connect("intermediary_bank","onBlur",function(){var _8=dj.byId("intermediary_bank").value;m.toggleBICFields(_8,"intermediary_bank_bic");});if(dijit.byId("receipt_completed_indicator")&&(dj.byId("receipt_completed_indicator").get("value")==="N"||dj.byId("receipt_completed_indicator").get("value")==="")){m.connect("instructions_type_1","onClick",function(){m._fncSwitchBankPaymentInstructionsFields("bank_instruction_field","free_format_field","instructions_type_2",null,null,"instructions_type_2",null);});m.connect("instructions_type_2","onClick",function(){m._fncSwitchBankPaymentInstructionsFields("free_format_field","bank_instruction_field","freeformatbeneficiary",null,null,"instructions_type_1");misys._populateSwiftFields();if(m._config.swift_allowed){misys._populateClearingCodes("beneficiary_bank");misys._populateClearingCodes("beneficiary");misys._populateClearingCodes("intermediary_bank");misys._populateClearingCodes("ordering_customer");}});m.connect("payment_type","onChange",function(){m.changeRequiredFieldsOnPaymentTypeChange("");});m.connect("beneficiary_account","onChange",function(){m._fncChangeRequiredFieldsOnChange("beneficiary_account","");});m.connect("beneficiary_address","onChange",function(){m._fncChangeRequiredFieldsOnChange("beneficiary_address","");});m._fncConnectSSIFields("");m.connect("freeformataddlinstructionslabel","onClick",function(){m.fncfreeformataddlinstructions(null);});m.connect("freeformatpaymentdetailslabel","onClick",function(){m.fncfreeformatpaymentdetails(null);});m.connect("freeformatbeneficiarylabel","onClick",function(){m.fncfreeformatbeneficiary(null);});}if("SWAP"===dj.byId("sub_product_code").get("value")){if(dijit.byId("near_receipt_completed_indicator")&&(dj.byId("near_receipt_completed_indicator").get("value")==="N"||dj.byId("near_receipt_completed_indicator").get("value")==="")){m.connect("near_instructions_type_1","onClick",function(){m._fncSwitchBankPaymentInstructionsFields("bank_instruction_field","free_format_field","near_instructions_type_2",null,null,null,"near");});m.connect("near_instructions_type_2","onClick",function(){m._fncSwitchBankPaymentInstructionsFields("free_format_field","bank_instruction_field","freeformatbeneficiary","freeformataddlinstructions","freeformatpaymentdetails","near_instructions_type_1","near");});m.connect("near_payment_type","onChange",function(){m.changeRequiredFieldsOnPaymentTypeChange("near");});m.connect("near_beneficiary_account","onChange",function(){_fncChangeRequiredFieldsOnChange("near_beneficiary_account","near");});m.connect("near_beneficiary_address","onChange",function(){_fncChangeRequiredFieldsOnChange("near_beneficiary_address","near");});m.connect("near_intermediary_bank","onChange",function(){_fncChangeRequiredFieldsOnChange("near_intermediary_bank","near");});m._fncConnectSSIFields("near_");m.connect("near_freeformataddlinstructionslabel","onClick",function(){m.fncfreeformataddlinstructions("near");});m.connect("near_freeformatpaymentdetailslabel","onClick",function(){m.fncfreeformatpaymentdetails("near");});m.connect("near_freeformatbeneficiarylabel","onClick",function(){m.fncfreeformatbeneficiary("near");});m.connect("far_instructions_type_1","onClick",function(){m._fncSwitchBankPaymentInstructionsFields("bank_instruction_field","free_format_field","far_instructions_type_2",null,null,null,"far");});m.connect("far_instructions_type_2","onClick",function(){m._fncSwitchBankPaymentInstructionsFields("free_format_field","bank_instruction_field","freeformatbeneficiary","freeformataddlinstructions","freeformatpaymentdetails","far_instructions_type_1","far");});m.connect("far_payment_type","onChange",function(){m.changeRequiredFieldsOnPaymentTypeChange("far");});m.connect("far_beneficiary_account","onChange",function(){_fncChangeRequiredFieldsOnChange("far_beneficiary_account","far");});m.connect("far_beneficiary_address","onChange",function(){_fncChangeRequiredFieldsOnChange("far_beneficiary_address","far");});m.connect("far_freeformataddlinstructionslabel","onClick",function(){m.fncfreeformataddlinstructions("far");});m.connect("far_freeformatpaymentdetailslabel","onClick",function(){m.fncfreeformatpaymentdetails("far");});m.connect("far_freeformatbeneficiarylabel","onClick",function(){m.fncfreeformatbeneficiary("far");});m._fncConnectSSIFields("far_");}}m.setValidation("beneficiary_bank_bic",m.validateBICFormat);m.setValidation("intermediary_bank_bic",m.validateBICFormat);},onFormLoad:function(){var _9=m._config.fx_si;dj.byId("rec_id").set("value",_9.rec_id);if(dj.byId("receipt_completed_indicator")&&(dj.byId("receipt_completed_indicator").get("value")==="N"||dj.byId("receipt_completed_indicator").get("value")==="")){d.style("bank_instruction_field",{"display":"block"});d.style("free_format_field",{"display":"none"});if(dj.byId("payment_type")){dj.byId("payment_type").set("required",false);}}var _a=dj.byId("sub_product_code").get("value");var _b;var _c;if(_a==="SWAP"){if(dijit.byId("near_receipt_completed_indicator")&&(dj.byId("near_receipt_completed_indicator").get("value")==="N"||dj.byId("near_receipt_completed_indicator").get("value")==="")){if(dj.byId("near_payment_type")){dj.byId("near_payment_type").set("required",false);}d.style("near_bank_instruction_field",{"display":"block"});d.style("near_free_format_field",{"display":"none"});}var _d={items:_9.near_payments};if(dijit.byId("near_payment_completed_indicator")&&(dj.byId("near_payment_completed_indicator").get("value")==="N"||dj.byId("near_payment_completed_indicator").get("value")==="")){m._fncConstructCustomerPaymentGrid(_d,"near_customerPaymentGrid","near_payment_instructions_id","near");m._fncSetGridSelectedId("near_customerPaymentGrid",dj.byId("near_customer_instruction_indicator").value);}var _e={items:_9.near_receipts};if(dijit.byId("near_receipt_completed_indicator")&&(dj.byId("near_receipt_completed_indicator").get("value")==="N"||dj.byId("near_receipt_completed_indicator").get("value")==="")){m._fncConstructBankPaymentGrid(_e,"near_bankPaymentGrid","near_receipt_instructions_id","near");m._fncSetGridSelectedId("near_bankPaymentGrid",dj.byId("near_bank_instruction_indicator").value);m._fncChangeDisabledAdditionalDetailsFiels("near_additional_details",true);_fncDisplayStoredBankInstruction("near");}_b={items:_9.payments};if(dj.byId("payment_completed_indicator")&&(dj.byId("payment_completed_indicator").get("value")==="N"||dj.byId("payment_completed_indicator").get("value")==="")){_fncConstructCustomerPaymentGrid(_b,"customerPaymentGrid","payment_instructions_id",null);m._fncSetGridSelectedId("customerPaymentGrid",dj.byId("customer_instruction_indicator").value);}_c={items:_9.receipts};if(dijit.byId("receipt_completed_indicator")&&(dj.byId("receipt_completed_indicator").get("value")==="N"||dj.byId("receipt_completed_indicator").get("value")==="")){d.style("bank_instruction_field",{"display":"block"});d.style("free_format_field",{"display":"none"});m._fncConstructBankPaymentGrid(_c,"bankPaymentGrid","receipt_instructions_id",null);m._fncSetGridSelectedId("bankPaymentGrid",dj.byId("bank_instruction_indicator").value);m._fncChangeDisabledAdditionalDetailsFiels("additional_details",true);_fncDisplayStoredBankInstruction(null);}}else{_b={items:_9.payments};if(dj.byId("payment_completed_indicator")&&(dj.byId("payment_completed_indicator").get("value")==="N"||dj.byId("payment_completed_indicator").get("value")==="")){m._fncConstructCustomerPaymentGrid(_b,"customerPaymentGrid","payment_instructions_id","",dj.byId("customer_instruction_indicator").value);m._fncSetGridSelectedId("customerPaymentGrid",dj.byId("customer_instruction_indicator").value);}_c={items:_9.receipts};if(dijit.byId("receipt_completed_indicator")&&(dj.byId("receipt_completed_indicator").get("value")==="N"||dj.byId("receipt_completed_indicator").get("value")==="")){d.style("bank_instruction_field",{"display":"block"});d.style("free_format_field",{"display":"none"});m._fncConstructBankPaymentGrid(_c,"bankPaymentGrid","receipt_instructions_id");m._fncChangeDisabledAdditionalDetailsFiels("additional_details",true);m._fncSetGridSelectedId("bankPaymentGrid",dj.byId("bank_instruction_indicator").value);m._fncDisplayStoredBankInstruction(null);}if(dj.byId("instructions_type_2")&&dj.byId("instructions_type_2").checked){m.changeRequiredFieldsOnPaymentTypeChange();misys._populateSwiftFields();if(m._config.swift_allowed){misys._populateClearingCodes("beneficiary_bank");misys._populateClearingCodes("beneficiary");misys._populateClearingCodes("intermediary_bank");misys._populateClearingCodes("ordering_customer");}}if(dj.byId("instructions_type_1")&&dj.byId("instructions_type_1").checked){m._fncChangePaymentTypeRequired("bank_instruction_field","free_format_field","");}}var _f,_10,_11;if(dj.byId("beneficiary_bank_bic")&&dj.byId("beneficiary_bank_bic").get("value")!==""){_f="beneficiary";_10=dj.byId("beneficiary_bank_bic").value;m.toggleBeneficiaryFields(_10,_f,"beneficiary_bank_country_btn_img",true);}else{if(dj.byId("beneficiary_bank")&&dj.byId("beneficiary_bank").get("value")!==""){_11=dj.byId("beneficiary_bank").value;m.toggleBICFields(_11,"beneficiary_bank_bic");}}if(dj.byId("intermediary_bank_bic")&&dj.byId("intermediary_bank_bic").get("value")!==""){_f="intermediary";_10=dj.byId("intermediary_bank_bic").value;m.toggleBeneficiaryFields(_10,_f,"intermediary_bank_country_btn_img",false);}else{if(dj.byId("intermediary_bank")&&dj.byId("intermediary_bank").get("value")!==""){_11=dj.byId("intermediary_bank").value;m.toggleBICFields(_11,"intermediary_bank_bic");}}},beforeSubmitValidations:function(){var _12;var _13;var _14;var _15;var _16;var _17;var _18=false;var _19="";if(dj.byId("customerPaymentGrid")){_12=dj.byId("customerPaymentGrid").store._arrayOfAllItems.length==0||(dj.byId("customerPaymentGrid").store._arrayOfAllItems.length!=0&&dj.byId("customerPaymentGrid").selection.selectedIndex!=-1);}else{_12=true;if(dj.byId("bankPaymentGrid")&&dj.byId("bankPaymentGrid").store._arrayOfAllItems.length==0&&dj.byId("instructions_type_1").checked){_18=true;}}if(dj.byId("bankPaymentGrid")){_13=dj.byId("bankPaymentGrid").store._arrayOfAllItems.length==0||(dj.byId("bankPaymentGrid").store._arrayOfAllItems.length!=0&&dj.byId("instructions_type_1").checked&&dj.byId("bankPaymentGrid").selection.selectedIndex!=-1)||dj.byId("instructions_type_2").checked;}else{_13=true;if(dj.byId("customerPaymentGrid")&&dj.byId("customerPaymentGrid").store._arrayOfAllItems.length==0){_12=false;}}if(dj.byId("customerPaymentGrid")&&dj.byId("bankPaymentGrid")&&dj.byId("customerPaymentGrid").store._arrayOfAllItems.length==0&&dj.byId("bankPaymentGrid").store._arrayOfAllItems.length==0&&dj.byId("instructions_type_1").checked){_12=false;_13=false;}if(dj.byId("near_customerPaymentGrid")){_14=dj.byId("near_customerPaymentGrid").store._arrayOfAllItems.length===0||(dj.byId("near_customerPaymentGrid").store._arrayOfAllItems.length!==0&&dj.byId("near_customerPaymentGrid").selection.selectedIndex!==-1);}else{_14=true;}if(dj.byId("near_bankPaymentGrid")){_15=dj.byId("near_bankPaymentGrid").store._arrayOfAllItems.length===0||(dj.byId("near_bankPaymentGrid").store._arrayOfAllItems.length!==0&&dj.byId("near_instructions_type_1").checked&&dj.byId("near_bankPaymentGrid").selection.selectedIndex!==-1)||dj.byId("near_instructions_type_2").checked;}else{_15=true;}if(dj.byId("far_customerPaymentGrid")){_16=dj.byId("far_customerPaymentGrid").store._arrayOfAllItems.length===0||(dj.byId("far_customerPaymentGrid").store._arrayOfAllItems.length!==0&&dj.byId("far_customerPaymentGrid").selection.selectedIndex!==-1);}else{_16=true;}if(dj.byId("far_bankPaymentGrid")){_17=dj.byId("far_bankPaymentGrid").store._arrayOfAllItems.length===0||(dj.byId("far_bankPaymentGrid").store._arrayOfAllItems.length!==0&&dj.byId("far_instructions_type_1").checked&&dj.byId("far_bankPaymentGrid").selection.selectedIndex!==-1)||dj.byId("far_instructions_type_2").checked;}else{_17=true;}_19=m.getLocalization("selectInstructionError");m._config.onSubmitErrorMsg=_19;var _1a=dojo.query("[class= 'dojoxGridRowTable']");var _1b="";if(_1a.length===2){_1b=m.getLocalization("attachOneInstruction");m._config.onSubmitErrorMsg=_1b;}if(_18){var _1c=m.getLocalization("attachFreeFormatInstruction");m._config.onSubmitErrorMsg=_1c;return false;}return _12&&_13&&_14&&_15&&_16&&_17;},selectIndex:function(_1d,_1e,_1f){var _20=dj.byId(_1e).selection.getSelected()[0].id;dj.byId(_1f).set("value",_20);if(_1e==="bankPaymentGrid"){m._fncChangeDisabledAdditionalDetailsFiels("additional_details",false);}else{if(_1e==="near_bankPaymentGrid"){m._fncChangeDisabledAdditionalDetailsFiels("near_additional_details",false);}else{if(_1e==="far_bankPaymentGrid"){m._fncChangeDisabledAdditionalDetailsFiels("far_additional_details",false);}}}}});})(dojo,dijit,misys);dojo.require("misys.client.binding.cash.message_si_fx_client");}