/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.cash.create_ft_meps"]){dojo._hasResource["misys.binding.cash.create_ft_meps"]=true;dojo.provide("misys.binding.cash.create_ft_meps");dojo.require("dojo.parser");dojo.require("dijit.layout.TabContainer");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("misys.form.PercentNumberTextBox");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.widget.Collaboration");dojo.require("misys.form.common");dojo.require("misys.form.file");dojo.require("misys.validation.common");dojo.require("misys.binding.cash.ft_common");dojo.require("misys.form.BusinessDateTextBox");dojo.require("misys.binding.core.beneficiary_advice_common");dojo.require("misys.binding.common.create_fx_multibank");(function(d,dj,m){var _1=d.byId("fx-message-type");var _2=false;var _3=false;var _4=true;var _5=false;var _6="fx-section";var _7="width:710px;height:350px;";function _8(){var _9=dj.byId("applicant_act_cur_code").get("value");var _a=dj.byId("ft_cur_code").get("value");if(_9!==""&&_a!==""&&_9!==_a){m.dialog.show("ERROR",m.getLocalization("mismatchFrom"));dj.byId("applicant_act_name").set("value","");dj.byId("applicant_act_cur_code").set("value","");dj.byId("applicant_act_no").set("value","");return;}};function _b(_c){var _d=function(){var _e=dijit.byId("ft_amt");_e.set("state","Error");m.defaultBindTheFXTypes();dj.byId("ft_amt").set("value","");if(dj.byId("ft_cur_code")&&!dj.byId("ft_cur_code").get("readOnly")){dj.byId("ft_cur_code").set("value","");}};m.dialog.show("ERROR",_c,"",function(){setTimeout(_d,500);});if(d.byId(_6)&&(d.style(d.byId(_6),"display")!=="none")){m.animate("wipeOut",d.byId(_6));}};function _f(){m.xhrPost({url:misys.getServletURL("/screen/AjaxScreen/action/GetUserAccountList"),handleAs:"json",sync:true,content:{context_value:"FT:MEPS",entity:dj.byId("entity")?dj.byId("entity").get("value"):""},load:function(_10,_11){if(_10.items.valid===true){dj.byId("applicant_act_cur_code").set("value",_10.items.currency);dj.byId("applicant_act_pab").set("value",_10.items.PAB);dj.byId("applicant_act_no").set("value",_10.items.accountNo);dj.byId("applicant_act_name").set("value",_10.items.accountName);_56();}},error:function(_12,_13){console.error("[Could not fetch userAccounts] ");console.error(_12);}});};function _14(){var _15=true;var _16="";var _17=dj.byId("fx_rates_type_2");var _18=dj.byId("fx_total_utilise_amt");var _19=dj.byId("ft_amt");var _1a=m._config.fxParamData[dj.byId("sub_product_code").get("value")][dj.byId("issuing_bank_abbv_name").get("value")].maxNbrContracts;if(_17.get("checked")&&_18&&!isNaN(_18.get("value"))&&_19&&!isNaN(_19.get("value"))){if(_19.get("value")<_18.get("value")){_16+=m.getLocalization("FXUtiliseAmtGreaterMessage");_15=false;}}m._config.onSubmitErrorMsg=_16;if(_17.get("checked")&&_18&&_19){var _1b=0;for(var j=1;j<=_1a;j++){var _1c="fx_contract_nbr_amt_"+j;_1b=_1b+dj.byId(_1c).get("value");if(dj.byId(_1c).get("state")==="Error"||_1b.toFixed(2)>_18.get("value")){dj.byId(_1c).set("state","Error");dj.byId(_1c).focus();_15=false;}}}return _15;};function _1d(){var _1e=dj.byId("sub_product_code").get("value");if(dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""&&m._config.fxParamData&&m._config.fxParamData[_1e][dj.byId("issuing_bank_abbv_name").get("value")].isFXEnabled==="Y"){m.connect("ft_cur_code","onBlur",function(){m.setCurrency(this,["ft_amt"]);if(dj.byId("ft_cur_code").get("value")!==""&&!isNaN(dj.byId("ft_amt").get("value"))){m.fireFXAction();}else{m.defaultBindTheFXTypes();}});m.connect("ft_cur_code","onChange",function(){if(dj.byId("iss_date")&&dj.byId("iss_date").get("value")!==""){dj.byId("iss_date").validate();}if(dj.byId("recurring_start_date")&&dj.byId("recurring_start_date").get("value")!==""){dj.byId("recurring_start_date").validate();}m.setCurrency(this,["ft_amt"]);if(dj.byId("ft_cur_code").get("value")!==""&&!isNaN(dj.byId("ft_amt").get("value"))){m.fireFXAction();}else{m.defaultBindTheFXTypes();}});m.connect("ft_amt","onBlur",function(){m.setTnxAmt(this.get("value"));var _1f="";if(dj.byId("ft_cur_code")){_1f=dj.byId("ft_cur_code").get("value");}if(!isNaN(dj.byId("ft_amt").get("value"))&&_1f!==""){m.fireFXAction();}else{m.defaultBindTheFXTypes();}});}else{if(d.byId(_6)){d.style(_6,"display","none");}}if(dijit.byId("ft_cur_code")&&dijit.byId("ft_amt")){misys.setCurrency(dijit.byId("ft_cur_code"),["ft_amt"]);}};var _20={},_21={},_22={},_23={};_20.fields=["beneficiary_name","beneficiary_address","beneficiary_city","beneficiary_dom","beneficiary_country","beneficiary_account","pre_approved"];_20.toggleReadonly=function(_24){m.toggleFieldsReadOnly(this.fields,_24);};_20.clear=function(){d.forEach(this.fields,function(_25,i){if(dj.byId(_25)){dj.byId(_25).set("value","");}});if(dj.byId("branch_address_flag")){dj.byId("branch_address_flag").set("checked",false);}if(dj.byId("cpty_bank_country_img")){dj.byId("cpty_bank_country_img").set("disabled",false);}d.style("PAB","display","none");};_21.fields=["cpty_bank_swift_bic_code","cpty_bank_name","cpty_bank_address_line_1","cpty_bank_address_line_2","cpty_bank_dom","cpty_bank_country","intermediary_bank_swift_bic_code","intermediary_bank_name","intermediary_bank_address_line_1","intermediary_bank_address_line_2","intermediary_bank_dom","intermediary_bank_country"];_21.clear=function(){d.forEach(this.fields,function(_26,i){if(dj.byId(_26)){dj.byId(_26).set("value","");}});};_23.fields=["cpty_bank_name","cpty_bank_address_line_1","cpty_bank_address_line_2","cpty_bank_dom","cpty_bank_country"];_23.clear=function(){d.forEach(this.fields,function(_27,i){if(dj.byId(_27)){dj.byId(_27).set("value","");}});};_22.fields=["intermediary_bank_name","intermediary_bank_address_line_1","intermediary_bank_address_line_2","intermediary_bank_dom","intermediary_bank_country"];_22.clear=function(){d.forEach(this.fields,function(_28,i){if(dj.byId(_28)){dj.byId(_28).set("value","");}});};function _29(){var _2a=dj.byId("applicant_act_pab").get("value");if(_2a=="Y"){_20.toggleReadonly(true);}else{_20.toggleReadonly(false);}dj.byId("pre_approved_status").set("value","");_20.clear();_21.clear();if(dj.byId("beneficiary_country_btn_img")){dj.byId("beneficiary_country_btn_img").set("disabled",false);}d.style("PAB","display","none");};function _2b(){var _2c=dj.byId("beneficiary_name").get("value");_5=false;if(_2c!==""){dj.byId("ft_amt").set("displayedValue","");if(dj.byId("pre_approved_status")&&dj.byId("pre_approved_status").get("value")==="Y"){if(m._config.non_pab_allowed){d.style("PAB","display","inline");}else{d.style("PAB","display","none");}if(dj.byId("intermediary_bank_swift_bic_code")&&dj.byId("intermediary_bank_swift_bic_code").get("value")!==""&&dj.byId("intermediary_bank_swift_bic_code").get("value")!==null){_5=true;if(dj.byId("inter_bank_iso_img")){dj.byId("inter_bank_iso_img").set("disabled",true);}dj.byId("has_intermediary").set("value","true");}else{dj.byId("has_intermediary").set("value","false");}if(dj.byId("bank_iso_img")){dj.byId("bank_iso_img").set("disabled",true);}if(dj.byId("cpty_bank_country_img")){dj.byId("cpty_bank_country_img").set("disabled",true);}if(dj.byId("cpty_bank_swift_bic_code")&&dj.byId("cpty_bank_swift_bic_code").get("value").length!==0){m.toggleFieldsReadOnly(["cpty_bank_swift_bic_code"],true);}if(dj.byId("intermediary_bank_swift_bic_code")&&dj.byId("intermediary_bank_swift_bic_code").get("value").length!==0){m.toggleFieldsReadOnly(["intermediary_bank_swift_bic_code"],true);}_20.toggleReadonly(true);m.toggleFieldsReadOnly(["beneficiary_bank_branch_address_line_1","beneficiary_bank_branch_address_line_2","beneficiary_bank_branch_dom"],true);if(dj.byId("beneficiary_iso_img")){dj.byId("beneficiary_iso_img").set("disabled",true);}if(dj.byId("cpty_bank_swift_bic_code")&&dj.byId("cpty_bank_swift_bic_code").get("value").length!==0){m.toggleFieldsReadOnly(["cpty_bank_swift_bic_code"],true);}if(dj.byId("beneficiary_country_btn_img")){dj.byId("beneficiary_country_btn_img").set("disabled",true);}}else{_20.toggleReadonly(false);d.style("PAB","display","none");m.toggleFieldsReadOnly(["beneficiary_swift_bic_code"],false);if(dj.byId("inter_bank_iso_img")){dj.byId("inter_bank_iso_img").set("disabled",false);}if(dj.byId("intermediary_bank_swift_bic_code")&&dj.byId("intermediary_bank_swift_bic_code").get("value")!==""&&dj.byId("intermediary_bank_swift_bic_code").get("value")!==null){_5=true;if(dj.byId("inter_bank_iso_img")){dj.byId("inter_bank_iso_img").set("disabled",true);}dj.byId("has_intermediary").set("value","true");}else{dj.byId("has_intermediary").set("value","false");}if((dj.byId("pre_approved")&&dj.byId("pre_approved").get("value")==="")||(dj.byId("pre_approved")&&dj.byId("pre_approved").get("value")===null)){_20.toggleReadonly(false);if(dj.byId("bank_iso_img")){dj.byId("bank_iso_img").set("disabled",false);}if(dj.byId("beneficiary_country_btn_img")){dj.byId("beneficiary_country_btn_img").set("disabled",false);}m.toggleFieldsReadOnly(["beneficiary_bank_branch_address_line_1","beneficiary_bank_branch_address_line_2","beneficiary_bank_branch_dom"],false);}else{_20.toggleReadonly(true);if(dj.byId("bank_iso_img")){dj.byId("bank_iso_img").set("disabled",true);}m.toggleFieldsReadOnly(["beneficiary_bank_branch_address_line_1","beneficiary_bank_branch_address_line_2","beneficiary_bank_branch_dom"],true);}if(dj.byId("beneficiary_swift_bic_code")&&dj.byId("beneficiary_swift_bic_code").get("value")!==""){m.toggleFieldsReadOnly(["beneficiary_name","beneficiary_address","beneficiary_city","beneficiary_dom"],true);}if(dj.byId("intermediary_bank_swift_bic_code")&&dj.byId("intermediary_bank_swift_bic_code").get("value")!==""){m.toggleFieldsReadOnly(["intermediary_bank_swift_bic_code","intermediary_bank_name","intermediary_bank_address_line_1","intermediary_bank_address_line_2","intermediary_bank_dom","intermediary_bank_country"],true);}if(dj.byId("beneficiary_country_btn_img")&&dj.byId("beneficiary_country").get("value")!==""&&dj.byId("beneficiary_country").get("value")!==null){dj.byId("beneficiary_country_btn_img").set("disabled",true);}if(dj.byId("cpty_bank_swift_bic_code")&&dj.byId("cpty_bank_swift_bic_code").get("value").length!==0){m.toggleFieldsReadOnly(["cpty_bank_swift_bic_code","cpty_bank_name","cpty_bank_address_line_1","cpty_bank_address_line_2","cpty_bank_dom","cpty_bank_country"],true);}if(dj.byId("intermediary_bank_swift_bic_code")&&dj.byId("intermediary_bank_swift_bic_code").get("value").length!==0){m.toggleFieldsReadOnly(["intermediary_bank_swift_bic_code","intermediary_bank_name","intermediary_bank_address_line_1","intermediary_bank_address_line_2","intermediary_bank_dom","intermediary_bank_country"],true);}}}};function _2d(){var _2e=dj.byId("applicant_act_no").get("value");var _2f=dj.byId("entity")?dj.byId("entity").get("value"):"";if(_2e===""){m.dialog.show("ERROR",m.getLocalization("selectDebitFirst"));return;}m.showSearchDialog("beneficiary_accounts","['beneficiary_name','beneficiary_account','ft_cur_code', 'beneficiary_address', 'beneficiary_city', 'change_address_line_3', 'beneficiary_dom', "+"'pre_approved_status', 'change_counterparty_name_2', 'change_counterparty_name_3', 'cpty_bank_name', 'cpty_bank_address_line_1', 'cpty_bank_address_line_2', "+"'cpty_bank_dom', 'beneficiary_bank_branch_address_line_1', 'beneficiary_bank_branch_address_line_2', 'beneficiary_bank_branch_dom', 'cpty_bank_country', "+"'beneficiary_swift_bic_code', 'cpty_bank_swift_bic_code', 'beneficiary_bank_code', 'beneficiary_branch_code', 'beneficiary_branch_name', "+"'pre_approved', 'change_threshold','change_threshold_curcode','bene_adv_beneficiary_id_no_send','bene_adv_mailing_name_add_1_no_send',"+"'bene_adv_mailing_name_add_2_no_send','bene_adv_mailing_name_add_3_no_send','bene_adv_mailing_name_add_4_no_send','bene_adv_mailing_name_add_5_no_send',"+"'bene_adv_mailing_name_add_6_no_send','bene_adv_postal_code_no_send','bene_adv_country_no_send','bene_email_1','bene_email_2', 'beneficiary_postal_code','beneficiary_country',"+"'bene_adv_fax_no_send', 'bene_adv_ivr_no_send','beneficiary_nickname', 'bene_adv_phone_no_send','intermediary_bank_swift_bic_code','intermediary_bank_name','intermediary_bank_address_line_1',"+"'intermediary_bank_address_line_2','intermediary_bank_dom','intermediary_bank_country']",{product_type:dijit.byId("sub_product_code").get("value"),entity_name:_2f,pabAccStat:dijit.byId("applicant_act_pab").get("value"),debitAcctNo:_2e},"",dijit.byId("sub_product_code").get("value"),_7,m.getLocalization("ListOfBeneficiriesTitleMessage"));};function _30(){var _31=true;if(dj.byId("cpty_bank_swift_bic_code")&&dj.byId("cpty_bank_swift_bic_code").get("value").length===0){_31=false;}_32("cpty_bank_swift_bic_code","readOnly",_31);_32("cpty_bank_country_img","disabled",_31);if((dj.byId("pre_approved")&&dj.byId("pre_approved").get("value")==="")||(dj.byId("pre_approved")&&dj.byId("pre_approved").get("value")===null)){_32("cpty_bank_swift_bic_code","readOnly",false);_32("cpty_bank_country_img","disabled",false);}_32("cpty_bank_name","readOnly",_31);_32("cpty_bank_address_line_1","readOnly",_31);_32("cpty_bank_address_line_2","readOnly",_31);_32("cpty_bank_dom","readOnly",_31);_32("cpty_bank_country","readOnly",_31);_32("bank_iso_img","disabled",false);m.toggleRequired("cpty_bank_name",true);m.toggleRequired("cpty_bank_address_line_1",true);m.toggleRequired("cpty_bank_country",true);};function _32(id,_33,_34){var _35=dj.byId(id);if(_35){_35.set(_33,_34);}};function _36(){var _37=true;if(dj.byId("intermediary_bank_swift_bic_code")&&dj.byId("intermediary_bank_swift_bic_code").get("value").length===0){_37=false;}_32("intermediary_bank_swift_bic_code","readOnly",_37);_32("intermediary_bank_name","readOnly",_37);_32("intermediary_bank_address_line_1","readOnly",_37);_32("intermediary_bank_address_line_2","readOnly",_37);_32("intermediary_bank_dom","readOnly",_37);_32("intermediary_bank_country","readOnly",_37);_32("inter_bank_iso_img","disabled",false);_32("intermediary_bank_country_img","disabled",_37);m.toggleRequired("intermediary_bank_swift_bic_code",_37);m.toggleRequired("intermediary_bank_name",_37);m.toggleRequired("intermediary_bank_address_line_1",_37);m.toggleRequired("intermediary_bank_address_line_2",false);m.toggleRequired("intermediary_bank_dom",false);m.toggleRequired("intermediary_bank_country",_37);if((dj.byId("pre_approved")&&dj.byId("pre_approved").get("value")==="")||(dj.byId("pre_approved")&&dj.byId("pre_approved").get("value")===null)){_32("intermediary_bank_swift_bic_code","readOnly",false);_32("intermediary_bank_country_img","disabled",false);m.toggleRequired("intermediary_bank_address_line_1",false);}};function _38(_39){var _3a=["beneficiary_bank_branch_address_line_1","beneficiary_bank_branch_address_line_2","beneficiary_bank_branch_dom"];var _3b=(dj.byId("beneficiary_name")&&dj.byId("beneficiary_name").get("readOnly"))?true:false;if(_39){if(((dj.byId("pre_approved_status")&&dj.byId("pre_approved_status").get("value")==="Y")||(dj.byId("pre_approved_status")&&dj.byId("pre_approved_status").get("value")==="N"))&&_3b){m.toggleFieldsReadOnly(_3a,true);}else{m.toggleFieldsReadOnly(_3a,false);dj.byId("branch_address_flag").set("disabled",false);dj.byId("branch_address_flag").set("readOnly",false);}m.toggleRequired("beneficiary_bank_branch_address_line_1",true);}else{m.toggleFieldsReadOnly(_3a,true,true);m.toggleRequired("beneficiary_bank_branch_address_line_1",false);}};function _3c(){if(dj.byId("branch_address_flag")){if((dj.byId("pre_approved_status")&&dj.byId("pre_approved_status").get("value")==="Y")||(dj.byId("pre_approved_status")&&dj.byId("pre_approved_status").get("value")==="N")){m.toggleFieldsReadOnly(["branch_address_flag","beneficiary_bank_branch_address_line_1","beneficiary_bank_branch_address_line_2","beneficiary_bank_branch_dom"],true);}else{if((dj.byId("pre_approved")&&dj.byId("pre_approved").get("value")==="")||(dj.byId("pre_approved")&&dj.byId("pre_approved").get("value")===null)){m.toggleFieldsReadOnly(["branch_address_flag","beneficiary_bank_branch_address_line_1","beneficiary_bank_branch_address_line_2","beneficiary_bank_branch_dom"],false);}else{m.toggleFieldsReadOnly(["branch_address_flag","beneficiary_bank_branch_address_line_1","beneficiary_bank_branch_address_line_2","beneficiary_bank_branch_dom"],true);}}}};function _3d(){var _3e=dj.byId("notify_beneficiary").get("checked");var _3f=dj.byId("notify_beneficiary_choice_1");var _40=dj.byId("notify_beneficiary_choice_2");var _41=dj.byId("notify_beneficiary_email");_3f.set("disabled",!_3e);_40.set("disabled",!_3e);_41.set("disabled",true);_3f.set("checked",_3e);_40.set("checked",false);_41.set("value","");var _42=d.byId("notify_beneficiary_email_node");var _43=d.byId("label_notify_beneficiary_choice_1");d.place(_42,_43,"after");var _44=dj.byId("bene_email_1").get("value");if(!_44){_44=dj.byId("bene_email_2").get("value");}if(_44&&_3e){_41.set("value",_44);_41.set("readOnly",true);}if(!_44&&_3e){if(dj.byId("beneficiary_name")&&dj.byId("beneficiary_name").get("value")===""){m.dialog.show("ERROR",m.getLocalization("noBeneficiaryEmail"));}_40.set("checked",true);var _45=d.byId("label_notify_beneficiary_choice_2");d.place(_42,_45,"after");_41.set("disabled",false);}m.toggleRequired("notify_beneficiary_email",_3e);m.toggleRequired("notify_beneficiary_choice_1",_3e);m.toggleRequired("notify_beneficiary_choice_2",_3e);};function _46(){var _47=dj.byId("notify_beneficiary_choice_2").get("checked")&&!dj.byId("notify_beneficiary_choice_2").get("disabled");var _48=dj.byId("notify_beneficiary_email");var _49=dj.byId("notify_beneficiary_choice_2");var _4a=d.byId("notify_beneficiary_email_node");var _4b=d.byId("label_notify_beneficiary_choice_1");var _4c=d.byId("label_notify_beneficiary_choice_2");var _4d=dj.byId("bene_email_1").get("value");if(!_4d){_4d=dj.byId("bene_email_2").get("value");}if(_47){d.place(_4a,_4c,"after");_48.set("disabled",false);}else{if(!_4d){m.dialog.show("ERROR",m.getLocalization("noBeneficiaryEmail"));_49.set("checked",true);_48.set("disabled",false);}else{d.place(_4a,_4b,"after");}}if(_4d&&!_47){_48.set("value",_4d);_48.set("readOnly",true);}else{_48.set("value","");_48.set("readOnly",false);_48.set("disabled",false);}};function _4e(){var _4f=null;var _50=dj.byId("customer_bank").get("value");if(misys&&misys._config&&misys._config.businessDateForBank&&misys._config.businessDateForBank[_50]&&misys._config.businessDateForBank[_50][0]&&misys._config.businessDateForBank[_50][0].value!==""){var _51=misys._config.businessDateForBank[_50][0].value;var _52=_51.substring(0,4);var _53=_51.substring(5,7);var _54=_51.substring(8,10);_51=_54+"/"+_53+"/"+_52;var _55=new Date(_52,_53-1,_54);if(dj.byId("option_for_app_date")&&dj.byId("option_for_app_date").get("value")==="SCRATCH"){dj.byId("appl_date").set("value",_51);document.getElementById("appl_date_view_row").childNodes[1].innerHTML=_51;if(dj.byId("appl_date_hidden")){dj.byId("appl_date_hidden").set("value",_55);}}if(dj.byId("todays_date")){dj.byId("todays_date").set("value",_55);}}if(!_2&&!_4){if(dj.byId("applicant_act_name")){dj.byId("applicant_act_name").set("value","");}if(dj.byId("applicant_act_no")){dj.byId("applicant_act_no").set("value","");}if(dj.byId("beneficiary_name")){dj.byId("beneficiary_name").set("value","");}if(dj.byId("beneficiary_act_cur_code")){dj.byId("beneficiary_act_cur_code").set("value","");}if(dj.byId("beneficiary_account")){dj.byId("beneficiary_account").set("value","");}if(dj.byId("cpty_bank_name")){dj.byId("cpty_bank_name").set("value","");}if(dj.byId("cpty_branch_name")){dj.byId("cpty_branch_name").set("value","");}if(dj.byId("ft_cur_code")){dj.byId("ft_cur_code").set("value","");}if(dj.byId("ft_amt")){dj.byId("ft_amt").set("value","");}if(dj.byId("iss_date")){dj.byId("iss_date").set("value",null);}if(dj.byId("issuing_bank_abbv_name")){dj.byId("issuing_bank_abbv_name").set("value",_50);}_4f=misys._config.customerBankDetails[_50][0].value;if(dj.byId("issuing_bank_name")){dj.byId("issuing_bank_name").set("value",_4f);}}if(!_2){dj.byId("issuing_bank_abbv_name").set("value",_50);_4f=misys._config.customerBankDetails[_50][0].value;dj.byId("issuing_bank_name").set("value",_4f);}_2=false;if(dj.byId("customer_bank")&&_50!==""){_4=false;if(dj.byId("issuing_bank_abbv_name").get("value")!==""){_4f=misys._config.customerBankDetails[_50][0].value;dj.byId("issuing_bank_name").set("value",_4f);}}m.initializeFX(dj.byId("sub_product_code").get("value"),dj.byId("issuing_bank_abbv_name").get("value"));if(dj.byId("applicant_act_cur_code")&&dj.byId("applicant_act_cur_code").get("value")!==""&&dj.byId("ft_cur_code")&&dj.byId("ft_cur_code").get("value")!==""&&dj.byId("applicant_act_cur_code").get("value")!==dj.byId("ft_cur_code").get("value")&&!isNaN(dj.byId("ft_amt").get("value"))){m.onloadFXActions();}else{m.defaultBindTheFXTypes();}_1d();};function _56(){var _57=dj.byId("applicant_act_pab").get("value");if(_57=="Y"){_20.toggleReadonly(true);}else{if(m._config.non_pab_allowed){_20.toggleReadonly(false);}else{_20.toggleReadonly(true);}}if(d.byId("clear_img")){if(_57=="Y"&&d.style(d.byId("clear_img"),"display")!=="none"){m.animate("wipeOut",d.byId("clear_img"));dj.byId("clear_img").setAttribute("disabled",true);}else{if(_57=="N"&&d.style(d.byId("clear_img"),"display")=="none"){m.animate("wipeIn",d.byId("clear_img"));dj.byId("clear_img").setAttribute("disabled",false);}}}};function _58(){dojo.forEach(["pre_approved","beneficiary_account","beneficiary_act_cur_code","beneficiary_address","beneficiary_city","beneficiary_dom","pre_approved_status","cpty_bank_name","cpty_bank_address_line_1","cpty_bank_address_line_2","cpty_bank_dom","cpty_branch_address_line_1","cpty_branch_address_line_2","cpty_branch_dom","cpty_bank_country","cpty_bank_swift_bic_code","cpty_bank_code","cpty_branch_code","cpty_branch_name","beneficiary_name","bene_adv_beneficiary_id_no_send","bene_adv_mailing_name_add_1_no_send","bene_adv_mailing_name_add_2_no_send","bene_adv_mailing_name_add_3_no_send","bene_adv_mailing_name_add_4_no_send","bene_adv_mailing_name_add_5_no_send","bene_adv_mailing_name_add_6_no_send","bene_adv_postal_code_no_send","bene_adv_country_no_send","bene_email_1","bene_email_2","beneficiary_postal_code","beneficiary_country","bene_adv_fax_no_send","bene_adv_ivr_no_send","bene_adv_phone_no_send","bene_adv_email_no_send1","bene_adv_email_no_send","ft_amt","intermediary_bank_swift_bic_code","intermediary_bank_name","intermediary_bank_address_line_1","intermediary_bank_address_line_2","intermediary_bank_dom","intermediary_bank_country","beneficiary_bank_branch_address_line_1","beneficiary_bank_branch_address_line_2","beneficiary_bank_branch_dom"],function(_59){if(dj.byId(_59)){dj.byId(_59).set("value","");}});if(d.byId(_6)&&(d.style(d.byId(_6),"display")!=="none")){m.animate("wipeOut",d.byId(_6));}d.style("PAB","display","none");m.setApplicantReference();};function _5a(_5b){var _5c=dj.byId("customerReference");var _5d=_5c?dj.byId("customerReference").get("value"):"";var _5e=new RegExp(_5d);var _5f=dj.byId("cust_ref_id");var _60=false;var _61=dj.byId(_5b);var _62=_61?_61.get("value"):"";var _63=null;if(_62!==""&&_62!==null){_60=_5e.test(_62);if(!_60){_63=m.getLocalization("invalidCustRef");_5f.set("state","Error");dj.hideTooltip(_5f.domNode);dj.showTooltip(_63,_5f.domNode,0);}}};function _64(){var _65=dj.byId("beneNameRegex");var _66=_65?dj.byId("beneNameRegex").get("value"):"";var _67=new RegExp(_66);var _68=false;var _69=dj.byId("beneficiary_name")?dj.byId("beneficiary_name").get("value"):"";if(_66!==null&&_66!==""){if(_69!==""&&_69!==null){_68=_67.test(_69);if(!_68){this.invalidMessage=m.getLocalization("invalidBeneficiaryNameforMeps");return false;}}}return true;};function _6a(){var _6b=dj.byId("intermediary_bank_country_img");var _6c=dj.byId("intermediary_bank_swift_bic_code");var _6d=true;if(dj.byId("intermediary_bank_swift_bic_code").get("value")!==""&&dj.byId("cpty_bank_swift_bic_code").get("value")!==""&&(dj.byId("intermediary_bank_swift_bic_code").get("value")===dj.byId("cpty_bank_swift_bic_code").get("value"))){var _6e="";_6e=misys.getLocalization("invalidIntermeditaryCode");_6c.set("state","Error");dj.hideTooltip(_6c.domNode);dj.showTooltip(_6e,_6c.domNode,0);_6b.set("disabled",false);_6d=false;}return _6d;};function _6f(_70){var _71=dj.byId("beneAddressRegex");var _72=_71?dj.byId("beneAddressRegex").get("value"):"";var _73=new RegExp(_72);var _74=false;var _75=null;var _76=dj.byId(_70);var _77=_76?dj.byId(_70).get("value"):"";if(_72!==null&&_72!==""&&_77!==""&&_77!==null){_74=_73.test(_77);if(!_74){_75=m.getLocalization("invalidBeneficiaryAddressFieldMeps");_76.set("state","Error");dj.hideTooltip(_76.domNode);dj.showTooltip(_75,_76.domNode,0);}}};function _78(){var _79=dj.byId("beneAcctRegex");var _7a=_79?dj.byId("beneAcctRegex").get("value"):"";var _7b=new RegExp(_7a);var _7c=dj.byId("beneficiary_account");var _7d=false;var _7e=_7c;var _7f=_7e?_7e.get("value"):"";var _80=null;if(_7a!==null&&_7a!==""){if(_7f!==""&&_7f!==null){_7d=_7b.test(_7f);if(!_7d){_80=m.getLocalization("invalidBeneficiaryAccountforMeps");_7c.set("state","Error");dj.hideTooltip(_7c.domNode);dj.showTooltip(_80,_7c.domNode,0);}}}};function _81(){var _82=dj.byId("cpty_bank_swift_bic_code"),_83=dj.byId("cpty_bank_name"),_84=dj.byId("cpty_bank_address_line_1"),_85=dj.byId("cpty_bank_address_line_2"),_86=dj.byId("cpty_bank_dom"),_87=dj.byId("cpty_bank_country"),_88=dj.byId("intermediary_flag"),_89="";var _8a=false;if(_82){if(_82.get("value")!==""){m.xhrPost({url:misys.getServletURL("/screen/AjaxScreen/action/ValidateBankMepsSWIFTCodeAction"),handleAs:"json",sync:true,content:{bank_code:_82.get("value")},load:function(_8b,_8c){if(_8b.items.valid===true){_8a=true;_83.set("value",_8b.items.bankName);_84.set("value",_8b.items.bankAddressLine1);_85.set("value",_8b.items.bankAddressLine2);_86.set("value",_8b.items.bankDom);_87.set("value",_8b.items.bankCountry);_88.set("value",_8b.items.intermediaryFlag);}else{_89=misys.getLocalization("invalidBankCode");_82.set("state","Error");dj.hideTooltip(_82.domNode);dj.showTooltip(_89,_82.domNode,0);_23.clear();}},error:function(_8d,_8e){console.error("[Could not validate Bank BIC Code] "+_82.get("value"));console.error(_8d);}});}else{_83.set("value","");_84.set("value","");_85.set("value","");_86.set("value","");_88.set("value","");}}return _8a;};function _8f(){var _90=dj.byId("intermediary_bank_swift_bic_code"),_91=dj.byId("intermediary_bank_name"),_92=dj.byId("intermediary_bank_address_line_1"),_93=dj.byId("intermediary_bank_address_line_2"),_94=dj.byId("intermediary_bank_dom"),_95=dj.byId("intermediary_bank_country"),_96="";var _97=false;if(_90){if(_90.get("value")!==""){m.xhrPost({url:misys.getServletURL("/screen/AjaxScreen/action/ValidateIntermediarySWIFTCodeAction"),handleAs:"json",sync:true,content:{bank_code:_90.get("value"),product_type:dj.byId("sub_product_code").get("value")},load:function(_98,_99){if(_98.items.valid===true){_97=true;if((dj.byId("pre_approved")&&dj.byId("pre_approved").get("value")==="")||(dj.byId("pre_approved")&&dj.byId("pre_approved").get("value")===null)){_91.set("value",_98.items.bankName);_92.set("value",_98.items.bankAddressLine1);_93.set("value",_98.items.bankAddressLine2);_94.set("value",_98.items.bankDom);_95.set("value",_98.items.bankCountry);}}else{_96=misys.getLocalization("invalidBankCode");_90.focus();_90.set("value","");_90.set("state","Error");dj.hideTooltip(_90.domNode);dj.showTooltip(_96,_90.domNode,0);_22.clear();}},error:function(_9a,_9b){console.error("[Could not validate Intermediary Swift Code] "+bank_code_field.get("value"));console.error(_9a);}});}else{_91.set("value","");_92.set("value","");_93.set("value","");_94.set("value","");}}return _97;};function _9c(_9d){var _9e="^[a-zA-Z0-9 \\,''().?\\/+-:]*$";var _9f=new RegExp(_9e);var _a0=false;var _a1=_9d?_9d.get("value"):"";var _a2=null;if(_a1!==""&&_a1!==null){_a0=_9f.test(_a1);if(!_a0){_a2=m.getLocalization("invalidCharBranchAddress");_9d.set("state","Error");dj.hideTooltip(_9d.domNode);dj.showTooltip(_a2,_9d.domNode,0);}}};function _a3(_a4){var _a5=dj.byId("beneAddressRegex");var _a6=_a5?dj.byId("beneAddressRegex").get("value"):"";var _a7=new RegExp(_a6);var _a8=false;var _a9=_a4?_a4.get("value"):"";var _aa=null;if(_a6!==null&&_a6!==""){if(_a9!==null){_a8=_a7.test(_a9);if(!_a8){_aa=m.getLocalization("invalidCharBranchAddress");_a4.set("state","Error");dj.hideTooltip(_a4.domNode);dj.showTooltip(_aa,_a4.domNode,0);}}}return _a8;};d.ready(function(){m._config.forceSWIFTValidation=true;});d.mixin(m._config,{initReAuthParams:function(){var _ab=dj.byId("entity")?dj.byId("entity").get("value"):"";var _ac={productCode:"FT",subProductCode:dj.byId("sub_product_code")?dj.byId("sub_product_code").get("value"):"",transactionTypeCode:"01",entity:_ab,currency:dj.byId("ft_cur_code")?dj.byId("ft_cur_code").get("value"):"",amount:dj.byId("ft_amt")?m.trimAmount(dj.byId("ft_amt").get("value")):"",bankAbbvName:dj.byId("customer_bank")?dj.byId("customer_bank").get("value"):"",es_field1:dj.byId("ft_amt")?m.trimAmount(dj.byId("ft_amt").get("value")):"",es_field2:(dj.byId("beneficiary_account"))?dj.byId("beneficiary_account").get("value"):""};return _ac;}});d.mixin(m,{fireFXAction:function(){if(m._config.fxParamData&&dj.byId("sub_product_code")&&dj.byId("sub_product_code").get("value")!==""&&dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""){var _ad=m._config.fxParamData[dj.byId("sub_product_code").get("value")][dj.byId("issuing_bank_abbv_name").get("value")];if(m._config.fxParamData&&_ad.isFXEnabled==="Y"){var _ae,_af;var _b0="";if(dj.byId("ft_cur_code")){_b0=dj.byId("ft_cur_code").get("value");}var _b1=dj.byId("ft_amt").get("value");var _b2=dj.byId("applicant_act_cur_code").get("value");var _b3=m._config.productCode;var _b4="";if(dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""){_b4=dj.byId("issuing_bank_abbv_name").get("value");}var _b5=dj.byId("applicant_act_cur_code").get("value");var _b6=false;if(_b0!==""&&!isNaN(_b1)&&_b3!==""&&_b4!==""){if(_b0!==_b2){_ae=_b2;_af=_b0;_b5=_b2;}if(_ae&&_af){if(d.byId(_6)&&(d.style(d.byId(_6),"display")==="none")){m.animate("wipeIn",d.byId(_6));}m.fetchFXDetails(_ae,_af,_b1,_b3,_b4,_b5,_b6);if(dj.byId("fx_rates_type_1")&&dj.byId("fx_rates_type_1").get("checked")){if(isNaN(dj.byId("fx_exchange_rate").get("value"))||dj.byId("fx_exchange_rate_cur_code").get("value")===""||isNaN(dj.byId("fx_exchange_rate_amt").get("value"))||(m._config.fxParamData[dj.byId("sub_product_code").get("value")][dj.byId("issuing_bank_abbv_name").get("value")].toleranceDispInd==="Y"&&(isNaN(dj.byId("fx_tolerance_rate").get("value"))||isNaN(dj.byId("fx_tolerance_rate_amt").get("value"))||dj.byId("fx_tolerance_rate_cur_code").get("value")===""))){_b(m.getLocalization("FXDefaultErrorMessage"));}}}else{if(d.byId(_6)&&(d.style(d.byId(_6),"display")!=="none")){m.animate("wipeOut",d.byId(_6));}m.defaultBindTheFXTypes();}}if(dj.byId("recurring_payment_enabled")&&dj.byId("recurring_payment_enabled").get("checked")&&dj.byId("fx_rates_type_2")){dj.byId("fx_rates_type_2").set("disabled",true);m.animate("wipeOut",d.byId("contracts_div"));}}}},bind:function(){m.setValidation("fx_tolerance_rate",m.validateToleranceAndExchangeRate);m.connect("beneficiary_name","onChange",m.checkBeneficiaryNicknameDiv);m.connect("applicant_act_name","onChange",m.checkNickNameDiv);m.connect("applicant_act_name","onChange",function(){var _b7=dj.byId("currency_res").get("value");if(_b7==="true"){_8();}});m.setValidation("template_id",m.validateTemplateId);m.setValidation("request_date",m.validateCashRequestDate);m.setValidation("iss_date",m.validateCashProcessingDate);m.connect("iss_date","onClick",function(){m.clearDateCache();if(misys._config.isMultiBank){var _b8;if(dijit.byId("customer_bank")){_b8=dijit.byId("customer_bank").get("value");}if(_b8!==""&&misys&&misys._config&&misys._config.businessDateForBank&&misys._config.businessDateForBank[_b8][0]&&misys._config.businessDateForBank[_b8][0].value!==""){var _b9=parseInt(misys._config.businessDateForBank[_b8][0].value.substring(0,4),10);var _ba=parseInt(misys._config.businessDateForBank[_b8][0].value.substring(5,7),10);var _bb=parseInt(misys._config.businessDateForBank[_b8][0].value.substring(8,10),10);this.dropDown.currentFocus=new Date(_b9,_ba-1,_bb);}}});m.setValidation("ft_cur_code",m.validateCurrency);m.setValidation("cpty_bank_country",m.validateCountry);m.setValidation("intermediary_bank_country",m.validateCountry);m.setValidation("beneficiary_country",m.validateCountry);m.setValidation("fx_exchange_rate",m.validateToleranceAndExchangeRate);m.setValidation("notify_beneficiary_email",m.validateEmailAddr);m.setValidation("cpty_bank_swift_bic_code",m.validateBICFormat);m.setValidation("intermediary_bank_swift_bic_code",m.validateBICFormat);m.connect("entity","onClick",m.validateRequiredField);m.connect("applicant_act_name","onClick",m.validateRequiredField);m.connect("beneficiary_name","onClick",m.validateRequiredField);m.connect("beneficiary_address","onClick",m.validateRequiredField);m.connect("beneficiary_account","onClick",m.validateRequiredField);m.connect("cpty_bank_name","onClick",m.validateRequiredField);m.connect("cpty_bank_address_line_1","onClick",m.validateRequiredField);m.connect("cpty_bank_country","onClick",m.validateRequiredField);m.connect("recurring_flag","onClick",m.showRecurring);m.setValidation("beneficiary_name",_64);m.connect("beneficiary_name","onChange",function(){_2b();if(dj.byId("notify_beneficiary_email")&&dj.byId("notify_beneficiary").get("checked")){if(dj.byId("notify_beneficiary_choice_1").get("checked")){if(dj.byId("bene_adv_email_no_send").get("value")!==""){dj.byId("notify_beneficiary_email").set("value",dj.byId("bene_adv_email_no_send").get("value"));}else{if(dj.byId("bene_adv_email_no_send1").get("value")!==""){dj.byId("notify_beneficiary_email").set("value",dj.byId("bene_adv_email_no_send1").get("value"));}else{dj.byId("notify_beneficiary").set("checked",false);dj.byId("notify_beneficiary_choice_1").set("checked",false);dj.byId("notify_beneficiary_email").set("value","");dj.byId("notify_beneficiary_email").set("disabled",true);}}}else{if(dj.byId("notify_beneficiary_choice_2").get("checked")){dj.byId("notify_beneficiary_email").set("value","");}}}});m.connect("beneficiary_img","onClick",_2d);m.connect("beneficiary_address","onBlur",function(){_6f(dj.byId("beneficiary_address"));});m.connect("beneficiary_city","onBlur",function(){_6f(dj.byId("beneficiary_city"));});m.connect("beneficiary_dom","onBlur",function(){_6f(dj.byId("beneficiary_dom"));});m.connect("cpty_bank_address_line_1","onBlur",function(){_6f(dj.byId("cpty_bank_address_line_1"));});m.connect("cpty_bank_address_line_2","onBlur",function(){_6f(dj.byId("cpty_bank_address_line_2"));});m.connect("cpty_bank_dom","onBlur",function(){_6f(dj.byId("cpty_bank_dom"));});m.connect("intermediary_bank_address_line_1","onBlur",function(){_6f(dj.byId("intermediary_bank_address_line_1"));});m.connect("intermediary_bank_address_line_2","onBlur",function(){_6f(dj.byId("intermediary_bank_address_line_2"));});m.connect("intermediary_bank_dom","onBlur",function(){_6f(dj.byId("intermediary_bank_dom"));});m.connect("cpty_bank_name","onBlur",function(){_6f(dj.byId("cpty_bank_name"));});m.connect("intermediary_bank_name","onBlur",function(){_6f(dj.byId("intermediary_bank_name"));});m.connect("beneficiary_account","onBlur",_78);m.connect("notify_beneficiary","onClick",_3d);m.connect("notify_beneficiary_choice_1","onClick",_46);m.connect("notify_beneficiary_choice_2","onClick",_46);m.connect("beneficiary_bank_branch_address_line_1","onBlur",function(){_9c(dj.byId("beneficiary_bank_branch_address_line_1"));});m.connect("cust_ref_id","onBlur",function(){_5a(dj.byId("cust_ref_id"));});m.connect("instruction_to_bank","onBlur",function(){_a3(dj.byId("instruction_to_bank"));});m.connect("payment_details_to_beneficiary","onBlur",function(){_a3(dj.byId("payment_details_to_beneficiary"));});m.connect("beneficiary_bank_branch_address_line_2","onBlur",function(){_9c(dj.byId("beneficiary_bank_branch_address_line_2"));});m.connect("beneficiary_bank_branch_dom","onBlur",function(){_9c(dj.byId("beneficiary_bank_branch_dom"));});m.connect("cpty_bank_swift_bic_code","onChange",_6a);m.connect("cpty_bank_swift_bic_code","onBlur",function(){if(dj.byId("cpty_bank_swift_bic_code")&&(dj.byId("cpty_bank_swift_bic_code").get("value").length===11||dj.byId("cpty_bank_swift_bic_code").get("value").length===8)){_81();}if(dj.byId("cpty_bank_swift_bic_code")&&dj.byId("cpty_bank_swift_bic_code").get("value").length===0){if((dj.byId("pre_approved")&&dj.byId("pre_approved").get("value")==="")||(dj.byId("pre_approved")&&dj.byId("pre_approved").get("value")===null)){m.toggleFieldsReadOnly(["cpty_bank_swift_bic_code","cpty_bank_name","cpty_bank_address_line_1","cpty_bank_address_line_2","cpty_bank_dom","cpty_bank_country"],false);dj.byId("beneficiary_bank_branch_address_line_1").set("readOnly",true);dj.byId("branch_address_flag").set("checked",false);dj.byId("cpty_bank_country_img").set("disabled",false);}_21.clear();}else{dj.byId("cpty_bank_country_img").set("disabled",true);m.toggleFieldsReadOnly(["cpty_bank_name","cpty_bank_address_line_1","cpty_bank_address_line_2","cpty_bank_dom","cpty_bank_country"],true);if(dj.byId("cpty_bank_swift_bic_code")&&dj.byId("cpty_bank_swift_bic_code").get("value").length<11&&dj.byId("cpty_bank_swift_bic_code").get("value").length>0&&dj.byId("cpty_bank_swift_bic_code").get("value").length!==8){_23.clear();}if(dj.byId("intermediary_flag")&&dj.byId("intermediary_flag").get("value")!=""){if(dj.byId("intermediary_flag").get("value")==="Y"){m.toggleRequired("intermediary_bank_swift_bic_code",true);m.toggleRequired("intermediary_bank_name",true);m.toggleRequired("intermediary_bank_address_line_1",true);m.toggleRequired("intermediary_bank_country",true);}else{if(dj.byId("intermediary_flag").get("value")==="N"){m.toggleRequired("intermediary_bank_swift_bic_code",false);m.toggleRequired("intermediary_bank_name",false);m.toggleRequired("intermediary_bank_country",false);m.toggleRequired("intermediary_bank_address_line_1",false);}}}}});m.connect("intermediary_bank_swift_bic_code","onChange",_6a);m.connect("intermediary_bank_swift_bic_code","onBlur",function(){var _bc=dj.byId("intermediary_bank_country_img");if(dj.byId("intermediary_bank_swift_bic_code")&&(dj.byId("intermediary_bank_swift_bic_code").get("value").length===11||dj.byId("intermediary_bank_swift_bic_code").get("value").length===8)){_8f();}if(dj.byId("intermediary_bank_swift_bic_code").get("value").length===0){m.toggleFieldsReadOnly(["intermediary_bank_swift_bic_code","intermediary_bank_name","intermediary_bank_address_line_1","intermediary_bank_address_line_2","intermediary_bank_dom","intermediary_bank_country"],false);_22.clear();}else{if((dj.byId("intermediary_bank_name").get("value")!==""||dj.byId("intermediary_bank_address_line_1").get("value")!==""||dj.byId("intermediary_bank_country").get("value")!=="")){m.toggleFieldsReadOnly(["intermediary_bank_name","intermediary_bank_address_line_1","intermediary_bank_address_line_2","intermediary_bank_dom","intermediary_bank_country"],true);}}if(_bc){if((dj.byId("intermediary_bank_swift_bic_code").get("value").length!==0&&_5)){if(dj.byId("intermediary_bank_country").get("value")!==""){_bc.set("disabled",true);}}else{_bc.set("disabled",false);}}});m.connect("intermediary_bank_country","onBlur",function(){var _bd=dj.byId("intermediary_bank_country_img");if((dj.byId("intermediary_bank_name").get("value")!==""||dj.byId("intermediary_bank_address_line_1").get("value")!==""||dj.byId("intermediary_bank_country").get("value")!=="")){m.toggleFieldsReadOnly(["intermediary_bank_name","intermediary_bank_address_line_1","intermediary_bank_address_line_2","intermediary_bank_dom","intermediary_bank_country"],true);}if(dj.byId("intermediary_bank_country").get("value")!==""){_bd.set("disabled",true);}});m.connect("branch_address_flag","onChange",function(){_38(this.get("checked"));});m.connect("beneficiary_bank_branch_address_line_1","onChange",function(){if(this.get("value")!==""){if(!dj.byId("branch_address_flag").get("checked")){dj.byId("branch_address_flag").set("checked",true);}}if(m._config.isBeneficiaryAccountsPopulated){if(this.get("value")===""){dj.byId("branch_address_flag").set("checked",false);}}});m.connect("pre_approved_status","onChange",function(){_3c();if(dj.byId("pre_approved_status").get("value")==="N"){if(dj.byId("bank_img")){dj.byId("bank_img").set("disabled",false);}if(dj.byId("bank_iso_img")){dj.byId("bank_iso_img").set("disabled",true);}if(dj.byId("currency")){dj.byId("currency").set("disabled",false);}if(dj.byId("cpty_bank_country_img")){if(dj.byId("cpty_bank_swift_bic_code").get("value").length===0){dj.byId("cpty_bank_country_img").set("disabled",false);}else{dj.byId("cpty_bank_country_img").set("disabled",true);}}}});m.connect("intermediary_bank_swift_bic_code","onBlur",function(){if(dj.byId("intermediary_bank_swift_bic_code").get("value").length!==0&&(_5||(dj.byId("has_intermediary")&&dj.byId("has_intermediary").get("value")=="true"))){dj.byId("intermediary_bank_country_img").set("disabled",true);dj.byId("inter_bank_iso_img").set("disabled",true);}else{dj.byId("intermediary_bank_country_img").set("disabled",false);dj.byId("inter_bank_iso_img").set("disabled",false);}});m.connect("entity","onChange",function(){if(!misys._config.isMultiBank){m.setApplicantReference();}_4=true;dj.byId("applicant_act_name").set("value","");if(dj.byId("recurring_flag")){dj.byId("recurring_flag").set("checked",false);}if(!misys._config.isMultiBank){m.setApplicantReference();}});m.connect("customer_bank","onChange",function(){m.handleMultiBankRecurring(_3);_3=false;});if(dj.byId("bulk_ref_id")&&dj.byId("bulk_ref_id").get("value")!==""&&dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""){m.initializeFX(dj.byId("sub_product_code").get("value"),dj.byId("issuing_bank_abbv_name").get("value"));if(dj.byId("applicant_act_cur_code")&&dj.byId("applicant_act_cur_code").get("value")!==""&&dj.byId("ft_cur_code")&&dj.byId("ft_cur_code").get("value")!==""&&dj.byId("applicant_act_cur_code").get("value")!==dj.byId("ft_cur_code").get("value")&&!isNaN(dj.byId("ft_amt").get("value"))){m.onloadFXActions();}else{m.defaultBindTheFXTypes();}_1d();}else{m.connect("customer_bank","onChange",_4e);}m.connect("applicant_act_name","onChange",function(){if(dj.byId("customer_bank")&&dj.byId("applicant_act_name")&&dj.byId("applicant_act_name").get("value")!==""){dj.byId("customer_bank").set("value",m._config.customerBankName);}_58();});m.connect("clear_img","onClick",function(){_29();if(dj.byId("notify_beneficiary_email")){dj.byId("notify_beneficiary").set("checked",false);dj.byId("notify_beneficiary_choice_1").set("checked",false);dj.byId("notify_beneficiary_choice_2").set("checked",false);dj.byId("notify_beneficiary_choice_1").set("disabled",true);dj.byId("notify_beneficiary_choice_2").set("disabled",true);dj.byId("notify_beneficiary_email").set("value","");dj.byId("notify_beneficiary_email").set("disabled",true);dj.byId("bene_email_1").set("value","");dj.byId("bene_email_2").set("value","");}_36();});m.connect("iss_date","onChange",function(){var _be=this.get("value");if(dj.byId("request_date")){if(dj.byId("request_date").get("value")===null||m.compareDateFields(dj.byId("request_date"),this)){dj.byId("request_date").set("value",_be);}}});m.connect("applicant_act_pab","onChange",_56);m.bindRecurringFields();m.connect("ft_cur_code","onBlur",function(){m.setCurrency(this,["ft_amt"]);});var _bf=dj.byId("sub_product_code").get("value");if(dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""&&m._config.fxParamData&&m._config.fxParamData[_bf][dj.byId("issuing_bank_abbv_name").get("value")].isFXEnabled==="Y"){m.connect("ft_cur_code","onBlur",function(){m.setCurrency(this,["ft_amt"]);if(dj.byId("ft_cur_code").get("value")!==""&&!isNaN(dj.byId("ft_amt").get("value"))){m.fireFXAction();}else{m.defaultBindTheFXTypes();}});m.connect("ft_cur_code","onChange",function(){m.setCurrency(this,["ft_amt"]);if(dj.byId("ft_cur_code").get("value")!==""&&!isNaN(dj.byId("ft_amt").get("value"))){m.fireFXAction();}else{m.defaultBindTheFXTypes();}});m.connect("ft_amt","onBlur",function(){m.setTnxAmt(this.get("value"));var _c0="";if(dj.byId("ft_cur_code")){_c0=dj.byId("ft_cur_code").get("value");}if(!isNaN(dj.byId("ft_amt").get("value"))&&_c0!==""){m.fireFXAction();}else{m.defaultBindTheFXTypes();}});}else{if(d.byId(_6)){d.style(_6,"display","none");}}if(dijit.byId("ft_cur_code")&&dijit.byId("ft_amt")){misys.setCurrency(dijit.byId("ft_cur_code"),["ft_amt"]);}},onFormLoad:function(){m.setCurrency(dj.byId("ft_cur_code"),["ft_amt"]);if(misys._config.nickname==="true"&&dj.byId("applicant_act_nickname")&&dj.byId("applicant_act_nickname").get("value")!==""&&d.byId("nickname")){m.animate("fadeIn",d.byId("nickname"));d.style("nickname","display","inline");d.byId("nickname").innerHTML=dj.byId("applicant_act_nickname").get("value");}else{m.animate("fadeOut",d.byId("applicant_act_nickname_row"));}var _c1=dijit.byId("mode")?dijit.byId("mode").get("value"):"";if(_c1==="DRAFT"&&dj.byId("beneficiary_name")&&dj.byId("applicant_act_pab")&&dj.byId("applicant_act_pab").get("value")==="Y"&&dj.byId("beneficiary_name").value!==""){if(!m.validateBeneficiaryStatus()){dj.byId("beneficiary_name").set("state","Error");dj.showTooltip(m.getLocalization("beneficiaryIsInactive"),dj.byId("beneficiary_name").domNode,0);}}if(dj.byId("ft_cur_code")){dj.byId("ft_cur_code").set("value","SGD");dj.byId("ft_cur_code").set("readOnly",true);}m.animate("fadeOut",dojo.byId("ft_amt_img"));if(d.byId("recurring_on_div")){d.style("recurring_on_div","display","none");}if(dj.byId("notify_beneficiary")&&dj.byId("notify_beneficiary").get("checked")&&(_c1==="DRAFT")){var _c2=dj.byId("notify_beneficiary").get("checked");m.toggleRequired("notify_beneficiary_email",_c2);m.toggleRequired("notify_beneficiary_choice_1",_c2);m.toggleRequired("notify_beneficiary_choice_2",_c2);if(dj.byId("notify_beneficiary_choice_1").get("checked")){var _c3=d.byId("notify_beneficiary_email_node");var _c4=d.byId("label_notify_beneficiary_choice_2");_46();if(dj.byId("notify_beneficiary_choice_2").get("checked")){d.place(_c3,_c4,"after");}}}if(dj.byId("customer_bank")&&dj.byId("customer_bank").get("value")!==""&&misys&&misys._config&&misys._config.businessDateForBank&&misys._config.businessDateForBank[dj.byId("customer_bank").get("value")]&&misys._config.businessDateForBank[dj.byId("customer_bank").get("value")][0]&&misys._config.businessDateForBank[dj.byId("customer_bank").get("value")][0].value!==""){var _c5=misys._config.businessDateForBank[dj.byId("customer_bank").get("value")][0].value;var _c6=_c5.substring(0,4);var _c7=_c5.substring(5,7);var _c8=_c5.substring(8,10);_c5=_c8+"/"+_c7+"/"+_c6;var _c9=new Date(_c6,_c7-1,_c8);if(dj.byId("option_for_tnx")&&dj.byId("option_for_tnx").get("value")==="SCRATCH"){dj.byId("appl_date").set("value",_c5);document.getElementById("appl_date_view_row").childNodes[1].innerHTML=_c5;if(dj.byId("appl_date_hidden")){dj.byId("appl_date_hidden").set("value",_c9);}}if(dj.byId("todays_date")){dj.byId("todays_date").set("value",_c9);}}if(dj.byId("notify_beneficiary").get("checked")&&dj.byId("notify_beneficiary_choice_1").get("checked")&&(dijit.byId("mode").value==="DRAFT")){var _ca=d.byId("notify_beneficiary_email_node");var _cb=d.byId("label_notify_beneficiary_choice_2");_46();if(dj.byId("notify_beneficiary_choice_2").get("checked")){d.place(_ca,_cb,"after");}}m.checkBeneficiaryNicknameOnFormLoad();if(misys._config.isMultiBank){m.populateCustomerBanks(true);var _cc=dj.byId("entity");var _cd=dj.byId("customer_bank");if(!_cc&&_cd){_cd.set("disabled",false);_cd.set("required",true);}var _ce=dj.byId("customer_bank_hidden");if(_cd&&_ce){_cd.set("value",_ce.get("value"));}if(d.byId("server_message")&&d.byId("server_message").innerHTML!==""||dijit.byId("option_for_tnx")&&(dijit.byId("option_for_tnx").get("value")==="REMITTANCE_CORP"||dijit.byId("option_for_tnx").get("value")==="REMITTANCE_FI"||dijit.byId("option_for_tnx").get("value")==="TEMPLATE")){_3=true;}if(dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""){_2=true;_4=true;_cd.set("value",dj.byId("issuing_bank_abbv_name").get("value"));_ce.set("value",dj.byId("issuing_bank_abbv_name").get("value"));}if(misys._config.perBankRecurringAllowed&&dojo.byId("recurring_payment_checkbox")&&dj.byId("customer_bank")){if(dj.byId("customer_bank").get("value")===""){m.animate("fadeOut",dojo.byId("recurring_payment_checkbox"));}else{if(dj.byId("customer_bank").get("value")!==""&&misys._config.perBankRecurringAllowed[dj.byId("customer_bank").get("value")]!=="Y"){m.animate("fadeOut",dojo.byId("recurring_payment_checkbox"));}}}if(_cc&&_cc.get("value")===""&&_cd){_cd.set("disabled",true);_cd.set("required",false);}if(dijit.byId("recurring_frequency")&&dijit.byId("customer_bank").get("value")!==""&&misys._config.perBankFrequency){var _cf=misys._config.perBankFrequency[dijit.byId("customer_bank").get("value")];if(_cf){dijit.byId("recurring_frequency").store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_cf}});dijit.byId("recurring_frequency").fetchProperties={sort:[{attribute:"name"}]};}dijit.byId("recurring_frequency").set("value",dijit.byId("recurring_frequency")._lastQuery);}}else{m.setApplicantReference();}d.forEach(d.query(".mepsDisclaimer"),function(_d0){var _d1=dj.byId("sub_product_code").get("value")+"_"+m.getLocalization("disclaimer");if(dj.byId("sub_product_code")&&(_d0.id==_d1)){m.animate("fadeIn",_d1);}});if((dj.byId("pre_approved")&&dj.byId("pre_approved").get("value")!=="")||(dj.byId("pre_approved")&&dj.byId("pre_approved").get("value")!==null)){if(dj.byId("beneficiary_country_btn_img")){dj.byId("beneficiary_country_btn_img").set("disabled",true);}}_30();_36();if(dj.byId("cpty_bank_swift_bic_code")&&(dj.byId("cpty_bank_swift_bic_code").get("value").length===11||dj.byId("cpty_bank_swift_bic_code").get("value").length===8)){_81();if(dj.byId("intermediary_flag")&&dj.byId("intermediary_flag").get("value")!=""){if(dj.byId("intermediary_flag").get("value")==="Y"){m.toggleRequired("intermediary_bank_swift_bic_code",true);m.toggleRequired("intermediary_bank_name",true);m.toggleRequired("intermediary_bank_address_line_1",true);m.toggleRequired("intermediary_bank_country",true);}else{if(dj.byId("intermediary_flag").get("value")==="N"){m.toggleRequired("intermediary_bank_swift_bic_code",false);m.toggleRequired("intermediary_bank_name",false);m.toggleRequired("intermediary_bank_country",false);m.toggleRequired("intermediary_bank_address_line_1",false);}}}}if(dj.byId("branch_address_flag")){if(dj.byId("cpty_bank_swift_bic_code")&&dj.byId("cpty_bank_swift_bic_code").get("value").length===0){dj.byId("branch_address_flag").set("checked",false);dj.byId("branch_address_flag").set("readOnly",true);}else{dj.byId("branch_address_flag").set("readOnly",false);if(dj.byId("branch_address_flag").get("checked")){m.toggleRequired("beneficiary_bank_branch_address_line_1",true);}else{m.toggleRequired("beneficiary_bank_branch_address_line_1",false);}}}_3c();m.initForm();dj.byId("payment_details_to_beneficiary").set("required",true);if(document.getElementById("mandatorySpan")==undefined){var _d2=dojo.create("span",{"id":"mandatorySpan","class":"required-field-symbol","innerHTML":"*"});d.parser.parse(_d2);dojo.place(_d2,dojo.byId("payment_details_to_beneficiary"),"before");}if(dj.byId("recurring_payment_enabled")&&dj.byId("recurring_payment_enabled").get("checked")){dj.byId("recurring_flag").set("checked",true);m._config.clearOnSecondCall=true;m.showSavedRecurringDetails(false);d.style("recurring_payment_div","display","block");}else{if(d.byId("recurring_payment_div")){d.style("recurring_payment_div","display","none");}m.hasRecurringPayment();m.showSavedRecurringDetails(false);}m.toggleSections();m.showRecurring();if(!m._config.isMultiBank&&dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""&&m._config.fxParamData&&dj.byId("sub_product_code")&&dj.byId("sub_product_code").get("value")!==""&&dj.byId("sub_product_code").get("value")!=="IBG"){m.initializeFX(dj.byId("sub_product_code").get("value"),dj.byId("issuing_bank_abbv_name").get("value"));if(dj.byId("applicant_act_cur_code")&&dj.byId("applicant_act_cur_code").get("value")!==""&&dj.byId("ft_cur_code")&&dj.byId("ft_cur_code").get("value")!==""&&dj.byId("applicant_act_cur_code").get("value")!==dj.byId("ft_cur_code").get("value")&&dj.byId("ft_amt")&&!isNaN(dj.byId("ft_amt").get("value"))){m.onloadFXActions();}else{m.defaultBindTheFXTypes();}}else{m.animate("fadeOut",_1);}if(d.byId(_6)){if(dj.byId("bulk_ref_id").get("value")!==""&&dj.byId("ft_cur_code").get("value")!==""&&!isNaN(dj.byId("ft_amt").get("value"))){m.initializeFX(dj.byId("sub_product_code").get("value"),dj.byId("issuing_bank_abbv_name").get("value"));m.fireFXAction();}else{if((dj.byId("fx_exchange_rate_cur_code")&&dj.byId("fx_exchange_rate_cur_code").get("value")!=="")||(dj.byId("fx_total_utilise_cur_code")&&dj.byId("fx_total_utilise_cur_code").get("value")!=="")){m.animate("wipeIn",d.byId(_6));}else{d.style(_6,"display","none");}}}if((dj.byId("iss_date")&&dj.byId("iss_date").get("value")!=="")&&(dj.byId("iss_date").get("value")!==null)){m.validateTransferDateWithCurrentDate(dj.byId("iss_date"));}_f();},initForm:function(){if(dj.byId("charge_option")&&dj.byId("charge_option").get("value")===""){dj.byId("charge_option").set("value","SHA");}dj.byId("sub_product_code").set("value","MEPS");var _d3=dj.byId("applicant_act_pab").get("value");if(d.byId("clear_img")){if(_d3=="Y"&&d.style(d.byId("clear_img"),"display")!=="none"){m.animate("wipeOut",d.byId("clear_img"));dj.byId("clear_img").setAttribute("disabled",true);}}if(_d3==="Y"||(dj.byId("pre_approved_status")&&dj.byId("pre_approved_status").get("value")==="Y")){_20.toggleReadonly(true);if(dj.byId("cpty_bank_country_img")){dj.byId("cpty_bank_country_img").set("disabled",true);}if(dj.byId("bank_iso_img")){dj.byId("bank_iso_img").set("disabled",true);}m.toggleFieldsReadOnly(["branch_address_flag","beneficiary_bank_branch_address_line_1","beneficiary_bank_branch_address_line_2","beneficiary_bank_branch_dom"],true);if(dj.byId("intermediary_bank_swift_bic_code").get("value").length!==0){dj.byId("inter_bank_iso_img").set("disabled",true);}}else{if((dj.byId("pre_approved")&&dj.byId("pre_approved").get("value")==="")||(dj.byId("pre_approved")&&dj.byId("pre_approved").get("value")===null)){_20.toggleReadonly(false);if(dj.byId("cpty_bank_country_img")){dj.byId("cpty_bank_country_img").set("disabled",false);}if(dj.byId("bank_iso_img")){dj.byId("bank_iso_img").set("disabled",false);}if(dj.byId("inter_bank_iso_img")){dj.byId("inter_bank_iso_img").set("disabled",false);}if(dj.byId("beneficiary_country_btn_img")){dj.byId("beneficiary_country_btn_img").set("disabled",false);}m.toggleFieldsReadOnly(["branch_address_flag","beneficiary_bank_branch_address_line_1","beneficiary_bank_branch_address_line_2","beneficiary_bank_branch_dom"],false);}else{_20.toggleReadonly(true);if(dj.byId("cpty_bank_country_img")){dj.byId("cpty_bank_country_img").set("disabled",true);}if(dj.byId("bank_iso_img")){dj.byId("bank_iso_img").set("disabled",true);}m.toggleFieldsReadOnly(["branch_address_flag","beneficiary_bank_branch_address_line_1","beneficiary_bank_branch_address_line_2","beneficiary_bank_branch_dom"],true);if(dj.byId("intermediary_bank_swift_bic_code").get("value").length!==0){dj.byId("inter_bank_iso_img").set("disabled",true);}}}},beforeSaveValidations:function(){var _d4=dj.byId("entity");var _d5=false;if(_d4&&_d4.get("value")==""){return _d5;}else{return !_d5;}},beforeSubmitValidations:function(){var _d6=dijit.byId("mode")?dijit.byId("mode").get("value"):"";if(_d6==="DRAFT"&&dj.byId("applicant_act_pab")&&dj.byId("applicant_act_pab").get("value")==="Y"&&!m.validateBeneficiaryStatus()){m._config.onSubmitErrorMsg=m.getLocalization("beneficiaryIsInactive");dj.byId("beneficiary_name").set("state","Error");return false;}if(dj.byId("cpty_bank_swift_bic_code")&&dj.byId("cpty_bank_swift_bic_code").get("value")!==""&&!_81()){return false;}if(dj.byId("intermediary_flag")&&dj.byId("intermediary_flag").get("value")!=""&&dj.byId("intermediary_flag").get("value")==="Y"){if(dj.byId("intermediary_bank_swift_bic_code").length===0||dj.byId("intermediary_bank_name").length===0||dj.byId("intermediary_bank_country").length===0){m.toggleRequired("intermediary_bank_swift_bic_code",true);m.toggleRequired("intermediary_bank_name",true);m.toggleRequired("intermediary_bank_address_line_1",true);m.toggleRequired("intermediary_bank_country",true);}}if(dj.byId("intermediary_bank_swift_bic_code")&&dj.byId("intermediary_bank_swift_bic_code").get("value")!==""&&!_8f()){return false;}if(dj.byId("intermediary_bank_swift_bic_code")&&dj.byId("intermediary_bank_swift_bic_code").get("value")!==""&&!_6a()){return false;}if(dj.byId("payment_details_to_beneficiary")&&dj.byId("payment_details_to_beneficiary").get("value")!==""&&!_a3(dj.byId("payment_details_to_beneficiary"))){return false;}if(dijit.byId("payment_details_to_beneficiary")){if(dijit.byId("payment_details_to_beneficiary").get("required")){var _d7=dijit.byId("payment_details_to_beneficiary").get("value").trim();if(_d7.length===0){dj.byId("payment_details_to_beneficiary").set("value","");dj.byId("payment_details_to_beneficiary").set("state","Error");return false;}}}if(dj.byId("ft_amt")){if(!m.validateAmount((dj.byId("ft_amt"))?dj.byId("ft_amt"):0)){m._config.onSubmitErrorMsg=m.getLocalization("amountcannotzero");dj.byId("ft_amt").set("value","");return false;}}if(!m.isRecurringDetailsValidForSubmit()){return false;}if(dj.byId("issuing_bank_abbv_name")&&dj.byId("issuing_bank_abbv_name").get("value")!==""&&m._config.fxParamData&&m._config.fxParamData[dj.byId("sub_product_code").get("value")][dj.byId("issuing_bank_abbv_name").get("value")].isFXEnabled==="Y"){if(!m.fxBeforeSubmitValidation()){return false;}if(!_14()){return false;}}var _d8=dj.byId("applicant_act_no").get("value");var _d9=m.checkAccountStatus(_d8);if(!_d9){m._config.onSubmitErrorMsg=misys.getLocalization("accountStatusError");return false;}if(!dj.byId("bulk_ref_id").get("value")){var _da=false;if(_d6==="DRAFT"){if(dj.byId("recurring_payment_enabled")&&dj.byId("recurring_payment_enabled").get("checked")){_da=m.validateHolidaysAndCutOffTime("issuing_bank_abbv_name","sub_product_code",_d6,["Start Date"],["recurring_start_date"],"entity","ft_cur_code","ft_amt");}else{_da=m.validateHolidaysAndCutOffTime("issuing_bank_abbv_name","sub_product_code",_d6,["Processing Date"],["iss_date"],"entity","ft_cur_code","ft_amt");}}else{if(_d6==="UNSIGNED"){if(dj.byId("recurring_payment_enabled")&&dj.byId("recurring_payment_enabled").get("value")==="Y"){_da=m.validateHolidaysAndCutOffTime("issuing_bank_abbv_name","sub_product_code_unsigned",_d6,["Start Date"],["recurring_start_date_unsigned"],"display_entity_unsigned","ft_cur_code_unsigned","ft_amt_unsigned");}else{_da=m.validateHolidaysAndCutOffTime("issuing_bank_abbv_name","sub_product_code_unsigned",_d6,["Processing Date"],["iss_date_unsigned"],"display_entity_unsigned","ft_cur_code_unsigned","ft_amt_unsigned");}}else{m._config.onSubmitErrorMsg=m.getLocalization("technicalErrorWhileValidatingBusinessDays");}}if(_da){m._config.holidayCutOffEnabled=false;}return _da;}else{return true;}},showProductBasedListOfBanksforMeps:function(){misys.showSearchDialog("bankBicCodeMEPS","[ 'cpty_bank_swift_bic_code', 'cpty_bank_name', '', 'cpty_bank_address_line_1', 'cpty_bank_address_line_2', 'cpty_bank_dom', 'cpty_bank_country', '','intermediary_flag']",{swiftcode:false,bankcode:false},"","",_7,m.getLocalization("ListOfBanksTitleMessage"),"","",true);},showIntermediaryBicCodesforMeps:function(){misys.showSearchDialog("intermediaryBicCodeMEPS","[ 'intermediary_bank_swift_bic_code', 'intermediary_bank_name', 'intermediary_bank_address_line_1', 'intermediary_bank_address_line_2', 'intermediary_bank_dom', 'intermediary_bank_country']",{swiftcode:false,bankcode:false},"","",_7,m.getLocalization("ListOfBanksTitleMessage"),"","",true);}});})(dojo,dijit,misys);dojo.require("misys.client.binding.cash.create_ft_meps_client");}