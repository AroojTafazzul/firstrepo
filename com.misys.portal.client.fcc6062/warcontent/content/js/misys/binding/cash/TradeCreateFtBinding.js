/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.cash.TradeCreateFtBinding"]){dojo._hasResource["misys.binding.cash.TradeCreateFtBinding"]=true;dojo.provide("misys.binding.cash.TradeCreateFtBinding");dojo.require("misys.form.common");dojo.require("misys.validation.common");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("misys.widget.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.layout.ContentPane");dojo.require("dojo.data.ItemFileReadStore");dojo.require("dojo.parser");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.form.addons");dojo.require("misys.form.file");dojo.require("dijit.layout.TabContainer");dojo.require("dojox.grid.DataGrid");dojo.require("dojox.grid.cells.dijit");dojo.require("misys.widget.Collaboration");dojo.require("misys.binding.cash.request.RequestAction");dojo.require("misys.binding.cash.request.AccountPopup");dojo.require("misys.binding.cash.TradeCreateFtAjaxCall");dojo.require("misys.binding.cash.TradeCreateFtPopupManagement");fncDoBinding=function(){var _1="";if(dijit.byId("ft_type")){_1=dijit.byId("ft_type").get("value");}fncSetGlobalVariable("ft_type",_1);misys.setValidation("template_id",misys.validateTemplateId);misys.setValidation("iss_date",misys.validateExecDate);if(_1==="01"||_1==="05"){misys.setValidation("ft_cur_code",function(){return _fncValidateCurrencies();});misys.connect("ft_amt","onBlur",function(){misys.setTnxAmt(this.get("value"));});}if(_1==="02"||_1==="05"){misys.setValidation("payment_cur_code",misys.validateCurrency);misys.connect("payment_cur_code","onChange",function(){misys.setCurrency(this,["ft_amt"]);});misys.connect("payment_amt","onBlur",function(){misys.setTnxAmt(this.get("value"));});}if(dijit.byId("ft_type").get("value")==="05"){misys.connect("transfer_account_cur_code","onChange",function(){dijit.byId("payment_cur_code").set("value",dijit.byId("transfer_account_cur_code").get("value"));});}misys.connect("input_cur_code","onBlur",misys.initFTCounterparties);misys.connect("issuing_bank_abbv_name","onChange",misys.populateReferences);if(dijit.byId("issuing_bank_abbv_name")){misys.connect("entity","onChange",function(){dijit.byId("issuing_bank_abbv_name").onChange();});}misys.connect("issuing_bank_customer_reference","onChange",misys.setApplicantReference);misys.setValidation("iss_date",function(){misys.validateDateGreaterThanHitched=dojo.hitch(this,misys.validateDateGreaterThan);return misys.validateDateGreaterThanHitched(false,"","executionDateLessThanDateofDay");});if(_1==="01"){misys.setValidation("applicant_act_no",function(){fncValidateAccountHitched=dojo.hitch(this,fncValidateAccount);return fncValidateAccountHitched("transfer_account");});misys.setValidation("transfer_account",function(){fncValidateAccountHitched=dojo.hitch(this,fncValidateAccount);return fncValidateAccountHitched("applicant_act_no");});}};fncDoFormOnLoadEvents=function(){var _2=fncGetGlobalVariable("ft_type");misys.setCurrency(dijit.byId("counterparty_details_ft_cur_code_nosend"),["counterparty_details_ft_amt_nosend"]);var _3=dijit.byId("issuing_bank_abbv_name");if(_3){_3.onChange();}var _4=dijit.byId("issuing_bank_customer_reference");if(_4){_4.onChange();}if(dijit.byId("submitButton")){dijit.byId("submitButton").set("onClick",function(){fncRequestFT();});}if(dijit.byId("submitButton2")){dijit.byId("submitButton2").set("onClick",function(){fncRequestFT();});}fncSetGlobalVariable("orderingAccountPopupFirstOpening","true");if(dijit.byId("applicant_act_no_img")){dijit.byId("applicant_act_no_img").set("onClick",function(){if(_2==="01"){fncOpenAccountPopup("orderingAccount","ACT_INTERNAL_ORDERING");}else{if(_2==="02"){fncOpenAccountPopup("orderingAccount","ACT_EXTERNAL_ORDERING");}else{if(_2==="05"){fncOpenAccountPopup("orderingAccount","ACT_EXTERNAL_ORDERING");}}}});}if(_2==="01"||_2==="05"){fncSetGlobalVariable("beneficiaryAccountPopupFirstOpening","true");dijit.byId("transfer_account_img").set("onClick",function(){if(_2==="01"){fncOpenAccountPopup("beneficiaryAccount","ACT_INTERNAL_BENEFICIARY");}else{if(_2==="05"){fncOpenAccountPopup("beneficiaryAccount","ACT_EXTERNAL_BENEFICIARY");}}});}misys.connect(dijit.byId("dealSummaryDialog"),"onKeyPress",function(_5){if(_5.keyCode===dojo.keys.ESCAPE){dojo.stopEvent(_5);}});misys.connect(dijit.byId("ft-waiting-Dialog"),"onKeyPress",function(_6){if(_6.keyCode===dojo.keys.ESCAPE){dojo.stopEvent(_6);}});};fncDoPreSubmitValidations=function(){var _7=fncGetGlobalVariable("ft_type");var _8=dijit.byId("applicant_act_no").get("value")!="";var _9=true;var _a=true;if(_7==="01"||_7==="05"){_9=dijit.byId("transfer_account").get("value")!="";}if(_7==="02"||_7==="05"){_a=dijit.byId("beneficiary_country").get("value")!=""&&dijit.byId("beneficiary_bank_country").get("value")!==""&&dijit.byId("payment_cur_code").get("value")!==""&&dijit.byId("payment_amt").get("value")!=="";}return _8&&_9&&_a;};fncRequestFT=function(){if(fncCheckFields()&&fncDoPreSubmitValidations()){if(fncGetGlobalVariable("ft_type")==="01"){fncFillVar();_fncAjaxRequestFT();}else{if(fncGetGlobalVariable("ft_type")==="02"){fncFillVar();_fncAjaxRequestFT();}else{if(fncGetGlobalVariable("ft_type")==="05"){fncFillVar();_fncAjaxRequestFT();}}}}};fncAcceptFT=function(){dijit.byId("option").set("value","ACCEPT");misys.submit("SUBMIT");};fncRejectFT=function(){if(misys.countdown){_stopCountDown(misys.countdown);}_fncAjaxCancelFT();};_fncOpenCounterPartyDialog=function(){if(dojo.byId("counterparty_row_0")==null){fncSetGlobalVariable("haveABeneficiaryAccount","false");}if(fncGetGlobalVariable("haveABeneficiaryAccount")==="false"){misys.showCounterpartyDialog("counterparty");}};_fncDoAddCounterpartyActions=function(){dijit.byId("counterparty_acct_no").set("value",dijit.byId("counterparty_details_act_no_nosend").get("value"));dijit.byId("counterparty_name").set("value",dijit.byId("counterparty_details_name_nosend").get("value"));dijit.byId("counterparty_cur_code").set("value",dijit.byId("counterparty_details_ft_cur_code_nosend").get("value"));var _b=fncDoAddCounterpartyActions("counterparty");if(_b){fncSetGlobalVariable("haveABeneficiaryAccount","true");}};fncValidateAccount=function(_c){var _d;if(_c==="applicant_act_no"){_d="creditAcctEqualsToDebitAcct";}else{_d="debitAcctEqualsToCreditAcct";}var _e=this.get("value");var _f=dijit.byId(_c).get("value");if(_f!==""&&(this.state!=="Error"||dijit.byId(_c).state!=="Error")){if(_e===_f){this.displayMessage(misys.getLocalization(_d,[_e,_f]));return false;}else{if(dijit.byId(_c).state==="Error"){dijit.byId(_c).validate();}}}return true;};_fncValidateCurrencies=function(){var _10=dijit.byId("ft_cur_code").get("value");var _11=dijit.byId("applicant_act_cur_code").get("value");var _12=dijit.byId("transfer_account_cur_code").get("value");if(_11!==""&&_12!==""&&this.state!=="Error"){if(_10!==_11&&_10!==_12){dijit.byId("ft_cur_code").invalidMessage=misys.getLocalization("transferCurrencyDifferentThanAccountsCurrencies",[_10,_11,_12]);return false;}}return true;};fncFillVar=function(){if(dijit.byId("applicant_reference_hidden")){fncSetGlobalVariable("applicant_reference",dijit.byId("applicant_reference_hidden").get("value"));}else{fncSetGlobalVariable("applicant_reference","");}fncSetGlobalVariable("ordering_account",dijit.byId("applicant_act_no").get("value"));fncSetGlobalVariable("ordering_currency",dijit.byId("applicant_act_cur_code").get("value"));fncSetGlobalVariable("execution_date",dijit.byId("iss_date").getDisplayedValue());fncSetGlobalVariable("remarks",dijit.byId("narrative_additional_instructions").get("value"));if(fncGetGlobalVariable("ft_type")==="01"){fncSetGlobalVariable("ft_amount",dijit.byId("ft_amt").get("value"));fncSetGlobalVariable("ft_cur_code",dijit.byId("ft_cur_code").get("value"));fncSetGlobalVariable("transfer_account",dijit.byId("transfer_account").get("value"));fncSetGlobalVariable("transfer_currency",dijit.byId("transfer_account_cur_code").get("value"));fncSetGlobalVariable("beneficiary_currency","");fncSetGlobalVariable("beneficiary_name","");fncSetGlobalVariable("beneficiary_address","");fncSetGlobalVariable("beneficiary_city","");fncSetGlobalVariable("beneficiary_country","");fncSetGlobalVariable("beneficiary_bank","");fncSetGlobalVariable("beneficiary_bank_routing_number","");fncSetGlobalVariable("beneficiary_bank_branch","");fncSetGlobalVariable("beneficiary_bank_address","");fncSetGlobalVariable("beneficiary_bank_city","");fncSetGlobalVariable("beneficiary_bank_country","");fncSetGlobalVariable("beneficiary_bank_account","");fncSetGlobalVariable("payment_currency","");fncSetGlobalVariable("payment_amount","");}if(fncGetGlobalVariable("ft_type")==="02"){fncSetGlobalVariable("ft_amount",dijit.byId("payment_amt").get("value"));fncSetGlobalVariable("ft_cur_code",dijit.byId("payment_cur_code").get("value"));fncSetGlobalVariable("transfer_account","");fncSetGlobalVariable("transfer_currency","");fncSetGlobalVariable("payment_currency","");fncSetGlobalVariable("payment_amount","");fncSetGlobalVariable("beneficiary_name",dijit.byId("beneficiary_name").get("value"));fncSetGlobalVariable("beneficiary_address",dijit.byId("beneficiary_address").get("value"));fncSetGlobalVariable("beneficiary_city",dijit.byId("beneficiary_city").get("value"));fncSetGlobalVariable("beneficiary_account",dijit.byId("counterparty_details_act_no").get("value"));fncSetGlobalVariable("beneficiary_bank",dijit.byId("account_with_bank_name").get("value"));fncSetGlobalVariable("beneficiary_country",dijit.byId("beneficiary_country").get("value"));fncSetGlobalVariable("beneficiary_bank_routing_number",dijit.byId("beneficiary_bank_routing_number").get("value"));fncSetGlobalVariable("beneficiary_bank_branch",dijit.byId("beneficiary_bank_branch").get("value"));fncSetGlobalVariable("beneficiary_bank_address",dijit.byId("beneficiary_bank_address").get("value"));fncSetGlobalVariable("beneficiary_bank_city",dijit.byId("account_with_bank_dom").get("value"));fncSetGlobalVariable("beneficiary_bank_country",dijit.byId("beneficiary_bank_country").get("value"));fncSetGlobalVariable("beneficiary_bank_account",dijit.byId("beneficiary_bank_account").get("value"));}if(fncGetGlobalVariable("ft_type")==="05"){fncSetGlobalVariable("ft_amount",dijit.byId("ft_amt").get("value"));fncSetGlobalVariable("ft_cur_code",dijit.byId("ft_cur_code").get("value"));fncSetGlobalVariable("transfer_currency",dijit.byId("transfer_account_cur_code").get("value"));fncSetGlobalVariable("transfer_account",dijit.byId("transfer_account").get("value"));fncSetGlobalVariable("payment_currency",dijit.byId("payment_cur_code").get("value"));fncSetGlobalVariable("payment_amount",dijit.byId("payment_amt").get("value"));fncSetGlobalVariable("beneficiary_name",dijit.byId("beneficiary_name").get("value"));fncSetGlobalVariable("beneficiary_address",dijit.byId("beneficiary_address").get("value"));fncSetGlobalVariable("beneficiary_city",dijit.byId("beneficiary_city").get("value"));fncSetGlobalVariable("beneficiary_account",dijit.byId("counterparty_details_act_no").get("value"));fncSetGlobalVariable("beneficiary_bank",dijit.byId("account_with_bank_name").get("value"));fncSetGlobalVariable("beneficiary_country",dijit.byId("beneficiary_country").get("value"));fncSetGlobalVariable("beneficiary_bank_routing_number",dijit.byId("beneficiary_bank_routing_number").get("value"));fncSetGlobalVariable("beneficiary_bank_branch",dijit.byId("beneficiary_bank_branch").get("value"));fncSetGlobalVariable("beneficiary_bank_address",dijit.byId("beneficiary_bank_address").get("value"));fncSetGlobalVariable("beneficiary_bank_city",dijit.byId("account_with_bank_dom").get("value"));fncSetGlobalVariable("beneficiary_bank_country",dijit.byId("beneficiary_bank_country").get("value"));fncSetGlobalVariable("beneficiary_bank_account",dijit.byId("beneficiary_bank_account").get("value"));}if(dijit.byId("open_chrg_brn_by_code_1").get("value")==="01"){fncSetGlobalVariable("fee_account",dijit.byId("applicant_act_no").get("value"));}else{if(dijit.byId("open_chrg_brn_by_code_2").get("value")==="02"){if(fncGetGlobalVariable("ft_type")=="01"||fncGetGlobalVariable("ft_type")==="05"){fncSetGlobalVariable("fee_account",dijit.byId("transfer_account").get("value"));}else{if(fncGetGlobalVariable("ft_type")==="02"){fncSetGlobalVariable("fee_account",dijit.byId("counterparty_details_act_no").get("value"));}}}else{if(dijit.byId("open_chrg_brn_by_code_3").get("value")==="03"){fncSetGlobalVariable("fee_account",dijit.byId("counterparty_details_act_no").get("value"));}}}};dojo.require("misys.client.binding.cash.TradeCreateFtBinding_client");}