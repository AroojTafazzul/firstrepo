/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.cash.paymentFees"]){dojo._hasResource["misys.binding.cash.paymentFees"]=true;dojo.provide("misys.binding.cash.paymentFees");dojo.require("dojo.parser");dojo.require("dijit.layout.TabContainer");dojo.require("dijit.form.DateTextBox");dojo.require("misys.form.CurrencyTextBox");dojo.require("dijit.form.NumberTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.Dialog");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.CheckBox");dojo.require("misys.form.PercentNumberTextBox");dojo.require("misys.form.SimpleTextarea");dojo.require("misys.widget.Collaboration");dojo.require("misys.form.common");dojo.require("misys.form.file");dojo.require("misys.validation.common");dojo.require("misys.binding.cash.ft_common");dojo.require("misys.form.BusinessDateTextBox");dojo.require("misys.binding.common.create_fx_multibank");(function(d,dj,m){function _1(_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d){if(_6==="DR"){var _e=document.getElementById("transaction_details_div");var _f=document.getElementById("fee_transaction_details_div");_f.style.display="block";var _10=_e.cloneNode(true);_10.id="transaction_details_div"+"_"+_b;var _11=_10.id;if(document.getElementById("debit_fee_name")){document.getElementById("debit_fee_name").id="debit_fee_name_0";}if(document.getElementById("debit_fee_amt")){document.getElementById("debit_fee_amt").id="debit_fee_amt_0";}if(document.getElementById("debit_tax_amount")){document.getElementById("debit_tax_amount").id="debit_tax_amount_0";}if(document.getElementById("debit_tax_on_tax_amt")){document.getElementById("debit_tax_on_tax_amt").id="debit_tax_on_tax_amt_0";}if(document.getElementById("debit_rebate_amt")){document.getElementById("debit_rebate_amt").id="debit_rebate_amt_0";}if(document.getElementById("debit_total_fee")){document.getElementById("debit_total_fee").id="debit_total_fee_0";}_f.appendChild(_10);if(document.getElementById(_11)){document.getElementById(_11).style.display="block";}var _12="debit_fee_name"+"_"+_b;var _13="debit_fee_amt"+"_"+_b;var _14="debit_tax_amount"+"_"+_b;var _15="debit_tax_on_tax_amt"+"_"+_b;var _16="debit_rebate_amt"+"_"+_b;var _17="debit_total_fee"+"_"+_b;document.getElementById("debit_fee_name").id=_12;document.getElementById(_12).value=_3;document.getElementById("debit_fee_amt").id=_13;document.getElementById(_13).value=_4.concat(" ").concat(dojo.currency.format(_5));document.getElementById("debit_tax_amount").id=_14;document.getElementById(_14).value=_4.concat(" ").concat(dojo.currency.format(_7));document.getElementById("debit_tax_on_tax_amt").id=_15;document.getElementById(_15).value=_4.concat(" ").concat(dojo.currency.format(_9));document.getElementById("debit_rebate_amt").id=_16;document.getElementById(_16).value=_2;document.getElementById("debit_total_fee").id=_17;document.getElementById(_17).value=_4.concat(" ").concat(dojo.currency.format(_d));if(document.getElementById("debit_fee_name_0")){document.getElementById("debit_fee_name_0").id="debit_fee_name";}if(document.getElementById("debit_fee_amt_0")){document.getElementById("debit_fee_amt_0").id="debit_fee_amt";}if(document.getElementById("debit_tax_amount_0")){document.getElementById("debit_tax_amount_0").id="debit_tax_amount";}if(document.getElementById("debit_tax_on_tax_amt_0")){document.getElementById("debit_tax_on_tax_amt_0").id="debit_tax_on_tax_amt";}if(document.getElementById("debit_rebate_amt_0")){document.getElementById("debit_rebate_amt_0").id="debit_rebate_amt";}if(document.getElementById("debit_total_fee_0")){document.getElementById("debit_total_fee_0").id="debit_total_fee";}}else{if(_6==="AF"){var _18=document.getElementById("agent_details_div");var _19=document.getElementById("fee_agent_details_div");_19.style.display="block";var _1a=_18.cloneNode(true);_1a.id="fee_agent_details_div"+"_"+_c;var _1b=_1a.id;if(document.getElementById("agent_fee_name")){document.getElementById("agent_fee_name").id="agent_fee_name_0";}if(document.getElementById("agent_fee_amt")){document.getElementById("agent_fee_amt").id="agent_fee_amt_0";}if(document.getElementById("agent_tax_amount")){document.getElementById("agent_tax_amount").id="agent_tax_amount_0";}if(document.getElementById("agent_tax_on_tax_amt")){document.getElementById("agent_tax_on_tax_amt").id="agent_tax_on_tax_amt_0";}if(document.getElementById("agent_rebate_amt")){document.getElementById("agent_rebate_amt").id="agent_rebate_amt_0";}if(document.getElementById("agent_total_fee")){document.getElementById("agent_total_fee").id="agent_total_fee_0";}_19.appendChild(_1a);if(document.getElementById(_1b)){document.getElementById(_1b).style.display="block";}var _1c="agent_fee_name"+"_"+_c;var _1d="agent_fee_amt"+"_"+_c;var _1e="agent_tax_amount"+"_"+_c;var _1f="agent_tax_on_tax_amt"+"_"+_c;var _20="agent_rebate_amt"+"_"+_c;var _21="agent_total_fee"+"_"+_c;document.getElementById("agent_fee_name").id=_1c;document.getElementById(_1c).value=_3;document.getElementById("agent_fee_amt").id=_1d;document.getElementById(_1d).value=_4.concat(" ").concat(dojo.currency.format(_5));document.getElementById("agent_tax_amount").id=_1e;document.getElementById(_1e).value=_4.concat(" ").concat(dojo.currency.format(_7));document.getElementById("agent_tax_on_tax_amt").id=_1f;document.getElementById(_1f).value=_4.concat(" ").concat(dojo.currency.format(_9));document.getElementById("agent_rebate_amt").id=_20;document.getElementById(_20).value=_2;document.getElementById("agent_total_fee").id=_21;document.getElementById(_21).value=_4.concat(" ").concat(dojo.currency.format(_d));if(document.getElementById("agent_fee_name_0")){document.getElementById("agent_fee_name_0").id="agent_fee_name";}if(document.getElementById("agent_fee_amt_0")){document.getElementById("agent_fee_amt_0").id="agent_fee_amt";}if(document.getElementById("agent_tax_amount_0")){document.getElementById("agent_tax_amount_0").id="agent_tax_amount";}if(document.getElementById("agent_tax_on_tax_amt_0")){document.getElementById("agent_tax_on_tax_amt_0").id="agent_tax_on_tax_amt";}if(document.getElementById("agent_rebate_amt_0")){document.getElementById("agent_rebate_amt_0").id="agent_rebate_amt";}if(document.getElementById("agent_total_fee_0")){document.getElementById("agent_total_fee_0").id="agent_total_fee";}}}};function _22(){var _23=document.getElementById("fee_transaction_details_div").children;var _24=document.getElementById("fee_agent_details_div").children;if(_23.length>1){for(var i=1;i<_23.length;i++){document.getElementById("fee_transaction_details_div").removeChild(_23[i]);}}if(_24.length>1){for(var j=1;j<_24.length;j++){document.getElementById("fee_agent_details_div").removeChild(_24[j]);}}m.getFeeforGPP();};function _25(_26,_27){var _28=".validate";var _29=(_27||d.query(_28)).reverse(),_2a=dj.byId("draft_term"),_2b=true;if(_2a){_2a.validate();}d.forEach(_29,function(_2c){var _2d=dj.byId(_2c.id);if(_2d._getState()!==""||_2d.state!==""){if(_26){_2d.validate();}_2b=false;}});return _2b;};d.mixin(m,{viewFeeDetails:function(){if(dj.byId("is_view_fees_btn")){dj.byId("is_view_fees_btn").set("value","true");}document.getElementById("ft_fee_details_div").style.display="block";var _2e=[function(){return true;}],_2f,_30;_2e.push(m.beforeSubmitValidations);_30=m.getLocalization("mandatoryFieldsToSubmitErrorFees");_2f=function(){_25(true);};if((d.every(_2e,function(f){return f();}))){var _31=dj.byId("gpp_fee_config_amt_cur_code")?dj.byId("gpp_fee_config_amt_cur_code").get("value"):"",_32=dj.byId("gpp_fee_config_amt_val")?dj.byId("gpp_fee_config_amt_val").get("value"):"";if(((_31===dj.byId("ft_cur_code").get("value"))||_31==="*")&&(_32<dj.byId("ft_amt").get("value"))){_22();}else{if((_31!=dj.byId("ft_cur_code").get("value"))){var amt=dj.byId("ft_amt")?dj.byId("ft_amt").get("value"):"";var cur=dj.byId("ft_cur_code")?dj.byId("ft_cur_code").get("value"):"";var _33=dj.byId("issuing_bank_abbv_name")?dj.byId("issuing_bank_abbv_name").get("value"):"";var _34,_35;m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/GetConvertedCurrencyAmount"),handleAs:"json",sync:true,content:{amount:amt,currency:cur,bank_abbv_name:_33,toCurrency:_31},load:function(_36,_37){if(_36!=false||_36!=""){_34=_36.toCurrencyAmount;_35=_36.toCurrency;if(dj.byId("to_currency")){dj.byId("to_currency").set("value",_35);}if(dj.byId("to_currency_amount")){dj.byId("to_currency_amount").set("value",_34);}if((_31===_35)&&((dojo.number.parse(_32))<_34)){_22();}else{m.hideFeeDetails();}}else{m.hideFeeDetailsForError();document.getElementById("XSL_FEE_DETILS_ERROR").style.display="block";}},error:function(_38,_39){console.error("[misys.grid._base] GetProductConfirmPopUp error",_38);}});}else{m.hideFeeDetails();}}}else{if(_30&&_30!=""){m.dialog.show("ERROR",_30,"",_2f);}}},getFeeforGPP:function(){var _3a=dj.byId("applicant_act_no")?dj.byId("applicant_act_no").get("value"):"";var _3b=dj.byId("applicant_act_cur_code")?dj.byId("applicant_act_cur_code").get("value"):"";var amt=dj.byId("ft_amt")?dj.byId("ft_amt").get("value"):"";var cur=dj.byId("ft_cur_code")?dj.byId("ft_cur_code").get("value"):"";var _3c=dj.byId("iss_date")?dj.byId("iss_date").get("value"):"";if(_3c){_3c=_3c.toISOString();}var _3d=dj.byId("productcode")?dj.byId("productcode").get("value"):"";var _3e=dj.byId("sub_product_code")?dj.byId("sub_product_code").get("value"):"";var _3f=dj.byId("issuing_bank_abbv_name")?dj.byId("issuing_bank_abbv_name").get("value"):"";var _40=dj.byId("company_id")?dj.byId("company_id").get("value"):"";var _41;var _42="";if(dj.byId("sub_product_code")){if((dj.byId("sub_product_code").get("value")==="INT")||dj.byId("sub_product_code").get("value")==="TPT"){_41="BOOK";}else{if(dj.byId("sub_product_code").get("value")==="MT103"){_41="SWIFT";}else{if(dj.byId("sub_product_code").get("value")==="RTGS"){_41="RTGS";}}}}var _43="SLEV";if(dj.byId("sub_product_code")&&(dj.byId("sub_product_code").get("value")==="MT103"||dj.byId("sub_product_code").get("value")==="RTGS")){_43=dj.byId("charge_option")?dj.byId("charge_option").get("value"):"";if(_43==="SHA"){_43="SHAR";}else{if(_43==="OUR"){_43="DEBT";}else{if(_43==="BEN"){_43="CRED";}}}}var _44=dj.byId("issuing_bank_iso_code")?dj.byId("issuing_bank_iso_code").get("value"):"";m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/GetFeeAPIAction"),handleAs:"json",sync:true,content:{accountIdentification:_3a,accountCurrency:_3b,bic:_44,amount:amt,currency:cur,valueDate:_3c,clearingScheme:_41,ChargeBearer:_43,productcode:_3d,sub_product_code:_3e,bank_abbv_name:_3f,company_id:_40,ft_tnx_data:m.formToXML()},load:function(_45,_46){if(_45.getFeeFlag===true&&_45.statusCode==="200"){document.getElementById("FEE_DETAILS_CONFIRMATION_DISCLAIMER").style.display="none";dj.byId("add_fee_details_button").set("disabled",true);if(dj.byId("response_status")){dj.byId("response_status").set("value",_45.statusCode);}var _47=[],_48=[],_49=[];var _4a,_4b,_4c,_4d,_4e,_4f,_50,_51,_52;_47=_45.feesInformation;_48=_45.taxInformation;_49=_45.taxOnTaxInformation;var _53=0,_54=0;var _55=0,_56=0;var _57={};var _58=[],_59=[];_57.DebitfeesInformation=_58;_57.AgentfeesInformation=_59;var _5a={};var _5b={};var _5c=0,_5d=0;var _5e=0,_5f=0;var _60=0,_61=0;var _62=true;for(var i=0;i<_47.length;i++){if(_47[i].feeName==""||_47[i].feeName==null||_47[i].feeName==undefined){_62=false;}if(_47[i].payingParty==="DR"){_60=_60+1;}else{if(_47[i].payingParty==="AF"){_61=_61+1;}}}if(_62==true){if(_47.length==1&&_47[0].payingParty=="CR"){m.hideFeeDetailsForCR();}else{for(i=0;i<_47.length;i++){_4a=_47[i].feeName;_4b=_47[i].feeCurrency;_4c=(_47[i].feeAmount);_4d=_47[i].payingParty;_4e=(_48[i].taxAmount);_51=_47[i].feeCurrency;_4f=(_49[i].taxOnTaxAmount);_52=_47[i].feeCurrency;_50=_48[i].rebate;_5c=(_4c+_4e+_4f);if((i===((_47.length)-1))&&_60>=1&&_61>=1){_5d=_55+_56+_5c;}if(_4d==="DR"){_55=_55+(_4c+_4e+_4f);_53=_53+1;if(_60>1&&_60===_53){_5e=_55;}_5a={"feeAmount":_4c.toFixed(2),"feeCurrency":_4b,"feeName":_4a,"taxAmount":_4e.toFixed(2),"taxOnTaxAmount":_4f.toFixed(2),"rebate":_50,"payingParty":"DR","totalFee":_5c.toFixed(2),"totalTransFee":_5e.toFixed(2),"GrandTotal":_5d.toFixed(2)};_57.DebitfeesInformation.push(_5a);}if(_4d==="AF"){_56=_56+(_4c+_4e+_4f);_54=_54+1;if(_61>1&&_61===_54){_5f=_56;}_5b={"feeAmount":_4c.toFixed(2),"feeCurrency":_4b,"feeName":_4a,"taxAmount":_4e.toFixed(2),"taxOnTaxAmount":_4f.toFixed(2),"rebate":_50,"payingParty":"AF","totalFee":_5c.toFixed(2),"totalAgentFee":_5f.toFixed(2),"GrandTotal":_5d.toFixed(2)};_57.AgentfeesInformation.push(_5b);}_1(_50,_4a,_4b,_4c.toFixed(2),_4d,_4e.toFixed(2),_51,_4f.toFixed(2),_52,_53,_54,_5c.toFixed(2));}if(dj.byId("payment_fee_details")){dj.byId("payment_fee_details").set("value",JSON.stringify(_57));}if(_53>1){if(document.getElementById("total_transaction_fee_details")){document.getElementById("total_transaction_fee_details").style.display="block";document.getElementById("total_transaction_fees").value=(_47[0].feeCurrency).concat(" ").concat(_55.toFixed(2));}}if(_54>1){if(document.getElementById("total_agent_fee_details")){document.getElementById("total_agent_fee_details").style.display="block";document.getElementById("total_agent_fees").value=(_47[0].feeCurrency).concat(" ").concat(_56.toFixed(2));}}if(_53>=1&&_54>=1){if(document.getElementById("grand_total_fee_details")){document.getElementById("grand_total_fee_details").style.display="block";document.getElementById("grand_total_fees").value=(_47[0].feeCurrency).concat(" ").concat(dojo.currency.format(_5d.toFixed(2)));}}m.showFeeDetailsSection();_42=_45;}}else{if(dj.byId("payment_fee_details")){dj.byId("payment_fee_details").set("value","");}m.hideFeeDetails();}}else{if(dj.byId("payment_fee_details")){dj.byId("payment_fee_details").set("value","");}if(dj.byId("response_status")){dj.byId("response_status").set("value","404");}m.hideFeeDetailsForError();document.getElementById("XSL_FEE_DETILS_ERROR").style.display="block";_42=_45;}},error:function(_63,_64){console.error("[misys.grid._base] GetProductConfirmPopUp error",_63);}});return _42;},hideFeeDetails:function(){document.getElementById("NO_FEE_DETAILS_DISCLAIMER").style.display="block";document.getElementById("FEE_DETAILS_DISCLAIMER").style.display="none";document.getElementById("fee_details_div").style.display="none";document.getElementById("FEE_CHARGES_DETAILS_DISCLAIMER").style.display="none";document.getElementById("grand_total_fee_details").style.display="none";document.getElementById("FEE_DETAILS_CONFIRMATION_DISCLAIMER").style.display="none";document.getElementById("NO_FEE_DETAILS_DISCLAIMER_BEN").style.display="none";dj.byId("add_fee_details_button").set("disabled",true);},hideFeeDetailsForError:function(){document.getElementById("NO_FEE_DETAILS_DISCLAIMER").style.display="none";document.getElementById("FEE_DETAILS_DISCLAIMER").style.display="none";document.getElementById("fee_details_div").style.display="none";document.getElementById("FEE_CHARGES_DETAILS_DISCLAIMER").style.display="none";document.getElementById("grand_total_fee_details").style.display="none";document.getElementById("FEE_DETAILS_CONFIRMATION_DISCLAIMER").style.display="none";document.getElementById("XSL_FEE_DETILS_ERROR").style.display="none";document.getElementById("NO_FEE_DETAILS_DISCLAIMER_BEN").style.display="none";dj.byId("add_fee_details_button").set("disabled",true);},hideAllDisclaimerMessages:function(){document.getElementById("NO_FEE_DETAILS_DISCLAIMER").style.display="none";document.getElementById("FEE_DETAILS_DISCLAIMER").style.display="none";document.getElementById("FEE_DETAILS_CONFIRMATION_DISCLAIMER").style.display="none";document.getElementById("FEE_CHARGES_DETAILS_DISCLAIMER").style.display="none";document.getElementById("NO_FEES_FOR_RECCURING_PAYMENT").style.display="none";document.getElementById("XSL_FEE_DETILS_ERROR").style.display="none";document.getElementById("NO_FEE_DETAILS_DISCLAIMER_BEN").style.display="none";},hideFeeDetailsForCR:function(){document.getElementById("NO_FEE_DETAILS_DISCLAIMER_BEN").style.display="block";document.getElementById("NO_FEE_DETAILS_DISCLAIMER").style.display="none";document.getElementById("FEE_DETAILS_DISCLAIMER").style.display="none";document.getElementById("FEE_DETAILS_CONFIRMATION_DISCLAIMER").style.display="none";document.getElementById("FEE_CHARGES_DETAILS_DISCLAIMER").style.display="none";document.getElementById("NO_FEES_FOR_RECCURING_PAYMENT").style.display="none";document.getElementById("XSL_FEE_DETILS_ERROR").style.display="none";},showFeeDetailsSection:function(){document.getElementById("FEE_DETAILS_DISCLAIMER").style.display="block";document.getElementById("fee_details_div").style.display="block";document.getElementById("NO_FEE_DETAILS_DISCLAIMER").style.display="none";document.getElementById("FEE_CHARGES_DETAILS_DISCLAIMER").style.display="block";document.getElementById("XSL_FEE_DETILS_ERROR").style.display="none";document.getElementById("NO_FEE_DETAILS_DISCLAIMER_BEN").style.display="none";}});})(dojo,dijit,misys);dojo.require("misys.client.binding.cash.paymentFees_client");}