/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.binding.cash.create_loan"]){dojo._hasResource["misys.binding.cash.create_loan"]=true;dojo.provide("misys.binding.cash.create_loan");(function(d,dj,m){function _1(_2,_3){if(dijit.byId("entity")){dojo.byId("entityIdTrancheDiv").innerHTML=dijit.byId("entity").get("value");}m.animate("wipeOut","loan_summary_div",function(){var _4=dijit.byId("loanTrancheGrid");var _5=new dojo.data.ItemFileReadStore({data:_2});_4.setStore(_5);_6();d.byId("accountNumberTrancheDiv").innerHTML=_2.items[0].ACCOUNT_NUMBER;d.byId("lineOfCreditTrancheDiv").innerHTML=_2.items[0].LINE_OF_CREDIT;d.byId("branchTrancheDiv").innerHTML=_2.items[0].BRANCH_NUMBER;d.byId("accountNameTrancheDiv").innerHTML=_2.items[0].ACCOUNT_NAME;dojo.byId("disbursementTotalContainerDiv").innerHTML=_2.items[0].DISBURSEMENT_AMT;d.style("loan_tranche_summary_div","display","block");d.style("loan_tranche_summary_div","overflow","visible");_4.resize();});};function _6(){var g=dijit.byId("loanTrancheGrid");var _7=[0];var _8=function(_9){dojo.forEach(g.views.views,function(v){dojo.style(v.rowNodes[_9],{"display":"none"});});};dojo.forEach(_7,_8);dojo.connect(g.views,"renderRow",function(_a){if(dojo.indexOf(_7,_a)>=0){_8(_a);}});};function _b(_c,_d){m.animate("wipeOut","loan_summary_div");m.animate("wipeOut","loan_tranche_summary_div",function(){misys.animate("wipeIn","loan_details_div");var _e=_c.items[0].AcctId;var _f,_10;_f=_e.substring(_e.length-5);_10=_e.substring(0,_e.length-5);d.byId("trancheNumDiv").innerHTML=_f;d.byId("acctIdDiv").innerHTML=_10;d.byId("prodTypeDiv").innerHTML=_c.items[0].ProdType;d.byId("disbursedAmtDiv").innerHTML=_c.items[0].DisbursedAmt;d.byId("termDiv").innerHTML=_c.items[0].Term;d.byId("intRateDiv").innerHTML=_c.items[0].IntRate;d.byId("immediatePastDuePrincipalAmtDiv").innerHTML=_c.items[0].ImmediatePastDuePrincipalAmt;d.byId("repmtDueImmediateDiv").innerHTML=_c.items[0].RepmtDueImmediate;d.byId("advancePmtDiv").innerHTML=_c.items[0].AdvancePmt;d.byId("lastRepmtAmtDiv").innerHTML=_c.items[0].LastRepmtAmt;d.byId("immediatePastDueChargesAmtDiv").innerHTML=_c.items[0].ImmediatePastDueChargesAmt;d.byId("immediatePastDueIntAmtDiv").innerHTML=_c.items[0].ImmediatePastDueIntAmt;d.byId("nextRepmtPastDuePrincipalAmtDiv").innerHTML=_c.items[0].NextRepmtPastDuePrincipalAmt;d.byId("nextRepmtPastDueIntAmtDiv").innerHTML=_c.items[0].NextRepmtPastDueIntAmt;d.byId("nextRepmtPastDueChargesAmtDiv").innerHTML=_c.items[0].NextRepmtPastDueChargesAmt;d.byId("loanAmtDueDate").innerHTML=_c.items[0].NextRepmtDueDt;d.byId("immediateLoanAmtTotalDiv").innerHTML=_c.items[0].TotalAmtImd;d.byId("loanAmtDueDateTotal").innerHTML=_c.items[0].TotalAmtDueDate;});};function _11(_12,_13){m.animate("wipeOut","loan_tranche_summary_div");var _14=dijit.byId("loanGrid");var _15=new dojo.data.ItemFileReadStore({data:_12});_14.setStore(_15);d.byId("divEqvOutPrincAmtSpan").innerHTML=_12.TOTAL_EQV_OUTSTANDING_PRINC_AMT;m.animate("wipeIn","loan_summary_div");d.style("loan_summary_grid_div","display","block");d.style("loan_summary_grid_div","overflow","visible");m.animate("wipeIn","totalDiv");_14.resize();};function _16(){var _17=dj.byId("export_list");if(_17!="screen"){var _18="LoanSummary."+_17;dj.byId("filename").set("value",_18);}};function _19(){if(d.byId(TransactionSearchForm)){m.connect(TransactionSearchForm,"onSubmit",function(e){var _1a=dj.byId(_exportListFieldId)?dj.byId(_exportListFieldId).get("value"):"screen";if(e&&_1a==="screen"){e.preventDefault();}if(this.isValid()){if(_1a!=="screen"){dj.byId(_filenameFieldId).set("value","inquiry."+_1a);return true;}else{m.grid.reloadForSearchTerms();return false;}}});}};d.mixin(m,{loanSummary:function(_1b,_1c,_1d,_1e,_1f,_20){m.animate("wipeOut","loan_summary_div");m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/GetLoanSummary"),handleAs:"json",sync:true,content:{acctNo:_1b,legalIdNo:_1c,legalIdType:_1d,legalOwnerCountry:_1e,bankId:_1f,branchNo:_20},load:function(_21,_22){_1(_21,_22);},customError:function(_23,_24){console.error(_23);}});return null;},loanTrancheDetails:function(_25,_26,_27,_28,_29,_2a,_2b){d.byId("trancheNumDiv").innerHTML=_2b;m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/GetLoanTrencheDetail"),handleAs:"json",sync:true,content:{acctNo:_25,legalIdNo:_26,legalIdType:_27,legalOwnerCountry:_28,bankId:_29,branchNo:_2a,trancheNo:_2b},load:function(_2c,_2d){_b(_2c,_2d);},customError:function(_2e,_2f){console.error(_2e);}});return null;},backToSummary:function(){m.animate("wipeOut","loan_tranche_summary_div");m.animate("wipeOut","loan_details_div");m.animate("wipeIn","loan_summary_div");},bind:function(){m.setValidation("acctCcy",m.validateCurrency);m.connect("entity","onChange",function(){dj.byId("account_no").set("value","");dj.byId("acctCcy").set("value",dj.byId("user_cur_code").get("value"));});m.connect("loanGrid","_onFetchComplete",function(){var _30=dijit.byId("acctCcy").get("value");var _31=dojo.byId("loanGridHdr6").children[0].innerHTML;if(!misys._config.loanGridEquTotalheaderName){misys._config.loanGridEquTotalheaderName=_31;}dijit.byId("loanGrid").layout.cells[6].name=misys._config.loanGridEquTotalheaderName+" ("+_30+")";});},onFormLoad:function(){m.toggleRequired("entity",true);m.connect("export_list","onChange",_16);}});})(dojo,dijit,misys);dojo.require("misys.client.binding.cash.create_loan_client");}