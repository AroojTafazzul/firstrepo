/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.liquidity.widget.BalGroups"]){dojo._hasResource["misys.liquidity.widget.BalGroups"]=true;dojo.provide("misys.liquidity.widget.BalGroups");dojo.require("misys.grid.GridMultipleItems");dojo.require("misys.liquidity.widget.BalGroup");dojo.require("misys.liquidity.widget.BalSubGroups");dojo.require("misys.constants");dojo.declare("misys.liquidity.widget.BalGroups",[misys.grid.GridMultipleItems],{data:{identifier:"store_id",label:"store_id",items:[]},templatePath:null,templateString:dojo.byId("balgroup-template")?dojo.byId("balgroup-template").innerHTML:"",dialogId:"balgroup-dialog-template",dialogAddItemTitle:misys.getLocalization("group-dialog"),xmlTagName:"BalGroups",xmlSubTagName:"BalGroup",gridColumns:["group_code","structure_code","description","frequency","frequency_label","balance_type","balance_type_label","currency","currency_label","minimum","rounding","group_order","company_id","structure_id","group_id","sub_group_identifiers"],propertiesMap:{group_code:{_fieldName:"group_code"},structure_code:{_fieldName:"structure_code"},description:{_fieldName:"description"},frequency:{_fieldName:"frequency"},frequency_label:{_fieldName:"frequency_label"},currency_label:{_fieldName:"currency_label"},balance_type:{_fieldName:"balance_type"},balance_type_label:{_fieldName:"balance_type_label"},currency:{_fieldName:"currency"},minimum:{_fieldName:"minimum"},rounding:{_fieldName:"rounding"},group_order:{_fieldName:"group_order"},company_id:{_fieldName:"company_id"},structure_id:{_fieldName:"structure_id"},group_id:{_fieldName:"group_id"},sub_group_identifiers:{_fieldName:"sub_group_identifiers",_type:"misys.liquidity.widget.BalSubGroups"}},layout:[{name:misys.getLocalization("cashPoolingbalanceGroupHeaderCode"),field:"group_code",width:"10%"},{name:misys.getLocalization("cashPoolingbalanceGroupHeaderDescription"),field:"description",width:"20%"},{name:misys.getLocalization("cashPoolingbalanceGroupHeaderFrequency"),field:"frequency_label",width:"10%"},{name:misys.getLocalization("cashPoolingbalanceGroupHeaderBalanceType"),field:"balance_type_label",width:"10%",classes:"align-center"},{name:misys.getLocalization("cashPoolingbalanceGroupHeaderCurrency"),field:"currency",width:"10%",classes:misys.constants.ALIGN_RIGHT_CLASS},{name:misys.getLocalization("cashPoolingbalanceGroupHeaderMinimum"),field:"minimum",width:"10%",classes:misys.constants.ALIGN_RIGHT_CLASS},{name:misys.getLocalization("cashPoolingbalanceGroupHeaderRounding"),field:"rounding",width:"10%",classes:misys.constants.ALIGN_RIGHT_CLASS},{name:misys.getLocalization("cashPoolingbalanceGroupHeaderOrder"),field:"group_order",width:"10%",classes:misys.constants.ALIGN_RIGHT_CLASS},{name:" ",field:"actions",formatter:misys.grid.formatReportActions,width:"10%"},{name:"Id",field:"store_id",headerStyles:"display:none",cellStyles:"display:none"}],typeMap:{"misys.liquidity.widget.BalSubGroups":{"type":Array,"deserialize":function(_1){var _2={};_2._type="misys.liquidity.widget.BalSubGroups";_2._values=_1;return _2;}}},mandatoryFields:["group_code","description","currency","Frequency","Balance Type"],startup:function(){this.inherited(arguments);},openDialogFromExistingItem:function(_3,_4){this.inherited(arguments);},resetDialog:function(_5,_6){this.inherited(arguments);},createDataGrid:function(){this.inherited(arguments);},addItem:function(_7){this.inherited(arguments);},updateData:function(_8){var _9=this.dialog.storeId;this._itemFields=this._retrieveItemFields();if(_9!==null&&_9!==undefined){this._itemFields["store_id"]=_9;}else{this._itemFields["store_id"]=dojox.uuid.generateRandomUuid();}var _a=this.checkMandatoryProperties(this._itemFields);var _b=this.checkSubItemsValidity();this._itemFields["is_valid"]=_a&&_b?"Y":"N";dojo.attr(this.itemsNode,"style",{display:"block"});dojo.attr(this.noItemLabelNode,"style",{display:"none"});if(this.grid){this.grid.store.fetch({query:{store_id:_9},onComplete:dojo.hitch(this,function(_c,_d){if(_c.length>0){var _e=_c[0];for(var _f in this._itemFields){var _10=this._itemFields[_f];if((_10!==null&&_10!==undefined)&&_f!=="store_id"){this.grid.store.setValue(_e,_f,_10);}if((_10!==null&&_10!==undefined)&&_f==="frequency"){var _11=misys.getFrequencyCodeData(_10);this.grid.store.setValue(_e,"frequency_label",_11);}if((_10!==null&&_10!==undefined)&&_f==="balance_type"){var _12=misys.getBalanceTypeCodeData(_10);this.grid.store.setValue(_e,"balance_type_label",_12);}}}else{if((this._itemFields.frequency!==null&&this._itemFields.frequency!==undefined)){var _13=misys.getFrequencyCodeData(this._itemFields.frequency);this._itemFields.frequency_label=_13;}if((this._itemFields.balance_type!==null&&this._itemFields.balance_type!==undefined)){var _14=misys.getBalanceTypeCodeData(this._itemFields.balance_type);this._itemFields.balance_type_label=_14;}this.grid.store.newItem(this._itemFields);}})});var _15=this.grid.selection.getSelected();if(_15.length){dojo.forEach(_15,function(_16){if(_16!==null){this.grid.selection.setSelected(_16,false);}},this);}}else{var _17=[this._itemFields];var _18={identifier:"store_id",label:"store_id",items:_17};this.store=new dojo.data.ItemFileWriteStore({data:_18,typeMap:this.typeMap});this.createDataGrid();}this.grid.store.save();this.grid.render();},performValidation:function(){if(this.validateDialog(true)&&misys.validateGroupCode()&&misys.validateDescription()){if(this.grid&&this.grid.store&&this.grid.store._arrayOfTopLevelItems){var _19=true;var _1a=true;var _1b=dijit.byId("group_code").get("value");var _1c=dijit.byId("group_order").get("value");var _1d=this.grid.gridMultipleItemsWidget.dialog.storeId;this.grid.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(this.grid,function(_1e,_1f){dojo.forEach(_1e,function(_20){if(_1d){if(_20.group_code[0].toUpperCase()===_1b.toUpperCase()&&(_20.store_id[0]!==_1d)){_19=false;dijit.byId("group_code").focus();dijit.byId("group_code").set("state","Error");dijit.hideTooltip(dijit.byId("group_code").domNode);misys.showTooltip(misys.getLocalization("balGroupCodeUniqueCheck"),dijit.byId("group_code").domNode);}if(parseInt(_20.group_order[0],10)===_1c&&(_20.store_id[0]!==_1d)){_1a=false;dijit.byId("group_order").focus();dijit.byId("group_order").set("state","Error");dijit.hideTooltip(dijit.byId("group_order").domNode);misys.showTooltip(misys.getLocalization("balGroupOrderUniqueCheck"),dijit.byId("group_order").domNode);}}else{if(_20.group_code[0].toUpperCase()===_1b.toUpperCase()){_19=false;dijit.byId("group_code").focus();dijit.byId("group_code").set("state","Error");dijit.hideTooltip(dijit.byId("group_code").domNode);misys.showTooltip(misys.getLocalization("balGroupCodeUniqueCheck"),dijit.byId("group_code").domNode);}else{if(parseInt(_20.group_order[0],10)===_1c){_1a=false;dijit.byId("group_order").focus();dijit.byId("group_order").set("state","Error");dijit.hideTooltip(dijit.byId("group_order").domNode);misys.showTooltip(misys.getLocalization("balGroupOrderUniqueCheck"),dijit.byId("group_order").domNode);}}}});})});if(_19&&_1a){this.inherited(arguments);}}else{this.inherited(arguments);}}}});}