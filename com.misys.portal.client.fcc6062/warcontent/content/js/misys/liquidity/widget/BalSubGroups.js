/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.liquidity.widget.BalSubGroups"]){dojo._hasResource["misys.liquidity.widget.BalSubGroups"]=true;dojo.provide("misys.liquidity.widget.BalSubGroups");dojo.require("misys.grid.GridMultipleItems");dojo.require("misys.liquidity.widget.BalSubGroup");dojo.require("misys.liquidity.widget.BalAccounts");dojo.require("misys.constants");dojo.declare("misys.liquidity.widget.BalSubGroups",[misys.grid.GridMultipleItems],{data:{identifier:"store_id",label:"store_id",items:[]},templatePath:null,templateString:dojo.byId("balsubgroup-template")?dojo.byId("balsubgroup-template").innerHTML:"",dialogId:"balsubgroup-dialog-template",dialogAddItemTitle:misys.getLocalization("subgroup-dialog"),xmlTagName:"balsubgroups",xmlSubTagName:"balsubgroup",gridColumns:["sub_group_code","group_code","company_id","subgrp_description","subGrpPivot","subgrppivot_label","subGrpType","subGrp_label","balance_target","low_target","high_target","sub_group_id","group_id","indirect","bal_account_identifiers"],propertiesMap:{sub_group_code:{_fieldName:"sub_group_code"},group_code:{_fieldName:"group_code"},company_id:{_fieldName:"company_id"},subgrp_description:{_fieldName:"subgrp_description"},subGrpPivot:{_fieldName:"subGrpPivot"},subgrppivot_label:{_fieldName:"subgrppivot_label"},subGrpType:{_fieldName:"subGrpType"},subGrp_label:{_fieldName:"subGrp_label"},balance_target:{_fieldName:"balance_target"},low_balance_target:{_fieldName:"low_balance_target"},high_balance_target:{_fieldName:"high_balance_target"},low_target:{_fieldName:"low_target"},high_target:{_fieldName:"high_target"},sub_group_id:{_fieldName:"sub_group_id"},group_id:{_fieldName:"group_id"},indirect:{_fieldName:"indirect"},bal_account_identifiers:{_fieldName:"bal_account_identifiers",_type:"misys.liquidity.widget.BalAccounts"}},layout:[{name:misys.getLocalization("cashPoolingbalanceSubGroupHeaderCode"),field:"sub_group_code",width:"15%"},{name:misys.getLocalization("cashPoolingbalanceSubGroupHeaderDescription"),field:"subgrp_description",width:"15%"},{name:misys.getLocalization("cashPoolingbalanceSubGroupHeaderPivot"),field:"subgrppivot_label",width:"10%"},{name:misys.getLocalization("cashPoolingbalanceSubGroupHeaderType"),field:"subGrp_label",width:"15%",classes:"align-center"},{name:misys.getLocalization("cashPoolingbalanceSubGroupHeaderBalanceLowTarget"),field:"low_balance_target",width:"10%",classes:misys.constants.ALIGN_RIGHT_CLASS},{name:misys.getLocalization("cashPoolingbalanceSubGroupHeaderBalanceMaxTarget"),field:"high_balance_target",width:"10%",classes:misys.constants.ALIGN_RIGHT_CLASS},{name:misys.getLocalization("cashPoolingbalanceSubGroupHeaderLowTarget"),field:"low_target",width:"10%",classes:misys.constants.ALIGN_RIGHT_CLASS},{name:misys.getLocalization("cashPoolingbalanceSubGroupHeaderMaxTarget"),field:"high_target",width:"10%",classes:misys.constants.ALIGN_RIGHT_CLASS},{name:misys.getLocalization("cashPoolingbalanceSubGroupHeaderIndirect"),field:"indirect",width:"10%",classes:misys.constants.ALIGN_RIGHT_CLASS},{name:" ",field:"actions",formatter:misys.grid.formatReportActions,width:"10%"},{name:"Id",field:"store_id",headerStyles:"display:none",cellStyles:"display:none"}],typeMap:{"misys.liquidity.widget.BalAccounts":{"type":Array,"deserialize":function(_1){var _2={};_2._type="misys.liquidity.widget.BalAccounts";_2._values=_1;return _2;}}},mandatoryFields:["sub_group_code","subgrp_description","balance_target","low_target","high_target","Type"],startup:function(){this.inherited(arguments);},openDialogFromExistingItem:function(_3,_4){this.inherited(arguments);},resetDialog:function(_5,_6){this.inherited(arguments);},createDataGrid:function(){this.inherited(arguments);},addItem:function(_7){this.inherited(arguments);},updateData:function(_8){var _9=this.dialog.storeId;this._itemFields=this._retrieveItemFields();if(_9!==null&&_9!==undefined){this._itemFields["store_id"]=_9;}else{this._itemFields["store_id"]=dojox.uuid.generateRandomUuid();}var _a=this.checkMandatoryProperties(this._itemFields);var _b=this.checkSubItemsValidity();this._itemFields["is_valid"]=_a&&_b?"Y":"N";dojo.attr(this.itemsNode,"style",{display:"block"});dojo.attr(this.noItemLabelNode,"style",{display:"none"});if(this.grid){this.grid.store.fetch({query:{store_id:_9},onComplete:dojo.hitch(this,function(_c,_d){if(_c.length>0){var _e=_c[0];for(var _f in this._itemFields){var _10=this._itemFields[_f];if((_10!==null&&_10!==undefined)&&_f!=="store_id"){this.grid.store.setValue(_e,_f,_10);}if((_10!==null&&_10!==undefined)&&_f==="subGrpType"){var _11=misys.getsubGroupTypeData(_10);this.grid.store.setValue(_e,"subGrp_label",_11);}}}else{if((this._itemFields.subGrpType!==null&&this._itemFields.subGrpType!==undefined)){var _12=misys.getsubGroupTypeData(this._itemFields.subGrpType);this._itemFields.subGrp_label=_12;}this.grid.store.newItem(this._itemFields);}})});var _13=this.grid.selection.getSelected();if(_13.length){dojo.forEach(_13,function(_14){if(_14!==null){this.grid.selection.setSelected(_14,false);}},this);}}else{var _15=[this._itemFields];var _16={identifier:"store_id",label:"store_id",items:_15};this.store=new dojo.data.ItemFileWriteStore({data:_16,typeMap:this.typeMap});this.createDataGrid();}this.grid.store.save();this.grid.render();},performValidation:function(){if(this.validateDialog(true)&&misys.validateSubGroupCode()&&misys.validateSubGrpDescription()&&misys.validateLowTargetBalances()&&misys.validateHighTargetBalances()){if(this.grid&&this.grid.store&&this.grid.store._arrayOfTopLevelItems){var _17=true;var _18=dijit.byId("sub_group_code").get("value");var _19=this.grid.gridMultipleItemsWidget.dialog.storeId;this.grid.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(this.grid,function(_1a,_1b){dojo.forEach(_1a,function(_1c){if(_19){if(_1c.sub_group_code[0].toUpperCase()===_18.toUpperCase()&&(_1c.store_id[0]!==_19)){_17=false;dijit.byId("sub_group_code").focus();dijit.byId("sub_group_code").set("state","Error");dijit.hideTooltip(dijit.byId("sub_group_code").domNode);misys.showTooltip(misys.getLocalization("balSubGroupCodeUniqueCheck"),dijit.byId("sub_group_code").domNode);}}else{if(_1c.sub_group_code[0].toUpperCase()===_18.toUpperCase()){_17=false;dijit.byId("sub_group_code").focus();dijit.byId("sub_group_code").set("state","Error");dijit.hideTooltip(dijit.byId("sub_group_code").domNode);misys.showTooltip(misys.getLocalization("balSubGroupCodeUniqueCheck"),dijit.byId("sub_group_code").domNode);}}});})});if(_17){this.inherited(arguments);}}else{this.inherited(arguments);}}}});}