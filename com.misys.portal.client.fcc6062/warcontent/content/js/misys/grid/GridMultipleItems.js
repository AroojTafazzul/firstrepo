/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.grid.GridMultipleItems"]){dojo._hasResource["misys.grid.GridMultipleItems"]=true;dojo.provide("misys.grid.GridMultipleItems");dojo.experimental("misys.grid.GridMultipleItems");dojo.require("dijit._Templated");dojo.require("dijit._Widget");dojo.require("dijit._Container");dojo.require("dojo.number");dojo.require("dojo.data.ItemFileWriteStore");dojo.require("dojox.uuid.generateRandomUuid");dojo.require("dojox.html.entities");dojo.require("misys.grid.DataGrid");dojo.declare("misys.grid.GridMultipleItems",[dijit._Widget,dijit._Templated,dijit._Container],{overrideDisplaymode:"edit",widgetsInTemplate:true,store:null,gridId:"",handle:[],name:"",grid:null,dialogId:"",dialog:null,dialogClassName:null,dialogAddItemTitle:"",dialogUpdateItemTitle:"",dialogViewItemTitle:"",requiredField:[],xmlTagName:"",xmlSubTagName:"",noItemLabel:"null",addButtonLabel:"null",openDialogFromExistingItemInitFunction:null,data:{},propertiesMap:{},typeMap:{},gridColumns:[],layout:[],headers:[],dataList:[],_itemFields:null,showMoveOptions:false,mandatoryFields:[],is_valid:"Y",state:"",getMandatoryProperties:function(_1){return (this.mandatoryFields?this.mandatoryFields:[]);},buildRendering:function(){if(!this.templateString){if(this.attachmentGroup&&this.attachmentGroup!=""){this.templateString=dojo.byId("file-attachment-template"+this.attachmentGroup).innerHTML;}else{if(dojo.byId("file-attachment-template")){this.templateString=dojo.byId("file-attachment-template").innerHTML;}}}this.inherited(arguments);},startup:function(){if(this.isWidgetToBeDestroyed(this.id)){return;}if(this._started){return;}this.name=this.id;if(this.dataList.length===0){this.dataList=this.createJsonItem();}else{dojo.forEach(this.dataList,function(_2){var _3=this.checkMandatoryProperties(_2);_2["is_valid"]=_3?"Y":"N";},this);}this.inherited(arguments);for(var i=0,_4=this.headers.length;i<_4;i++){this.layout[i].name=this.headers[i];}if(this.noItemLabel!=="null"&&this.noItemLabelNode){this.noItemLabelNode.innerHTML=this.noItemLabel;}if(this.overrideDisplaymode==="view"||this.overrideDisplaymode==="editonly"){if(this.addButtonNode){this.addButtonNode.set("style","display:none");}}else{if(this.addButtonLabel!=="null"&&this.addButtonNode){this.addButtonNode.set("label",this.addButtonLabel);}}this.gridColumns.push("store_id");this.gridColumns.push("is_valid");if(this.dataList.length>0){this.createDataStoreFromDataList();this.createDataGrid();}this.renderSections();this.destroyWidgets();this.collectRequiredField();this.setDialogFieldUnrequired();misys.connect(this.dialog,"onHide",this,"setDialogFieldUnrequired");misys.connect(this.dialog,"onShow",this,"setDialogFieldRequired");dojo.addClass(this.dialog.domNode,"gridMultipleItems_"+this.overrideDisplaymode);},createDataStoreFromDataList:function(){this.data.items=this.buildStoreItem(this.dataList);this.store=new dojo.data.ItemFileWriteStore({data:this.data,typeMap:this.typeMap});},createAmendDataStoreFromText:function(_5){if(misys._config.editedItemIndex!=-1&&misys._config.editedItemIndex!=undefined&&this.data.items.length!=0){var _6=this.data.items;var _7=[];var _8=0;for(var _9=0;_9<this.data.items.length+1;_9++){if(_9===misys._config.editedItemIndex){_7.push(dojo.mixin({store_id:dojox.uuid.generateRandomUuid()},_5));}else{_7.push(dojo.mixin({store_id:dojox.uuid.generateRandomUuid()},_6[_8++]));}}this.data.items=_7;}else{this.data.items.push(dojo.mixin({store_id:dojox.uuid.generateRandomUuid()},_5));}this.store=new dojo.data.ItemFileWriteStore({data:this.data,typeMap:this.typeMap});misys._config.editedItemIndex=-1;},buildStoreItem:function(_a){var _b=[];for(var i=0,_c=this.dataList.length;i<_c;i++){var _d=_a[i];for(var _e in _d){if(dojo.isArray(_d[_e])){_d[_e]=this.buildStoreItem(_d[_e]);}}_b.push(dojo.mixin({store_id:dojox.uuid.generateRandomUuid()},_d));}return _b;},updateGridFromDataList:function(){for(var i=0,_f=this.dataList.length;i<_f;i++){var _10=this.dataList[i%l];if(!_10.store_id){_10=dojo.mixin({store_id:dojox.uuid.generateRandomUuid()},_10);}this.grid.store.fetch({query:{store_id:_10.store_id},onComplete:dojo.hitch(this,function(_11,_12){if(_11.length<=0){this.grid.store.newItem(_10);}})});}this.grid.store.save();this.renderAll();},onGridCreate:function(){},createDataGrid:function(){var _13=this.gridId;if(!_13){_13="grid-"+(this.xmlTagName?this.xmlTagName+"-":"")+dojox.uuid.generateRandomUuid();}this.grid=new misys.grid.DataGrid({jsId:_13,id:_13,store:this.store,structure:this.layout,autoHeight:true,selectionMode:"multiple",columnReordering:true,autoWidth:true,rowsPerpage:1000,initialWidth:"100%",canSort:function(){return true;},showMoveOptions:this.showMoveOptions},document.createElement("div"));this.grid.gridMultipleItemsWidget=this;misys.connect(this.grid,"onStyleRow",dojo.hitch(this,function(row){var _14=this.grid.getItem(row.index);if(_14&&_14.hasOwnProperty("is_valid")){var _15=dojo.isArray(_14.is_valid)?_14.is_valid[0]:_14.is_valid;if(_15&&_15!=="Y"){row.customStyles+="background-color: #F9F7BA !important";this.state="Error";}}this.grid.focus.styleRow(row);this.grid.edit.styleRow(row);}));this.addChild(this.grid);this.onGridCreate();},renderSections:function(){try{if(this.itemsNode){var _16=(this.grid&&this.grid.rowCount>0);dojo.attr(this.itemsNode,"style",{display:(_16?"block":"none")});if(document.getElementById("reporting_popup")){dojo.attr(this.itemsNode,"style",{width:"100%"});}}if(this.noItemLabelNode){var _17=(this.grid&&this.grid.rowCount===0)||(!this.grid);dojo.attr(this.noItemLabelNode,"style",{display:(_17?"block":"none")});}}catch(err){}},openDialogFromExistingItem:function(_18,_19){misys.dialog.isActive=false;var _1a=_18[0];this.checkDialog();if(this.overrideDisplaymode!=="view"){this.dialog.set("title",this.dialogUpdateItemTitle);}else{var _1b=this.dialogViewItemTitle||this.dialogUpdateItemTitle;this.dialog.set("title",_1b);}this.resetDialog();this.dialog.gridMultipleItemsWidget=this;this.dialog.execute=this.dialogExecute;this.dialog.gridMultipleItemsWidget=this;this.dialog.storeId=(dojo.isArray(_1a.store_id)?_1a.store_id[0]:_1a.store_id);var _1c=this.dialog.getChildren();for(var _1d in _1a){var _1e=(this.propertiesMap[_1d]&&this.propertiesMap[_1d]._fieldName?this.propertiesMap[_1d]._fieldName:_1d);if(_1d!=="store_id"){dojo.some(_1c,function(_1f){if(_1f.id===_1e||_1f.name===_1e){var _20=_1a[_1d];_20=dojo.isArray(_20)?_20[0]:_20;if(this.overrideDisplaymode==="view"){var _21=(!_20&&_20!==0)?"none":"block";if(_1f&&_1f.id&&dojo.byId(_1f.id+"_row")){dojo.style(_1f.id+"_row","display",_21);}}if(_1f.isInstanceOf(misys.grid.GridMultipleItems)){if(_1f.grid){_1f.grid.destroy();}if(dojo.isObject(_20)&&_20._values&&dojo.isArray(_20._values)){_1f.dataList=dojo.clone(_20._values);_1f.createDataStoreFromDataList();_1f.createDataGrid();var key=_1a.store_id+"_"+_1d;if(this.handle&&!this.handle[key]){this.handle[key]=misys.connect(this.dialog,"onShow",_1f,"renderAll");}}}else{var _22=_1f.declaredClass;switch(_22){case "dijit.form.DateTextBox":_1f.set("displayedValue",_20);break;case "dijit.form.CheckBox":_1f.set("checked",_20==="Y"?true:false);break;case "dijit.form.RadioButton":var _23=dojo.query("[name='"+_1f.name+"']",this.dialog.domNode);dojo.some(_23,function(_24){var _25=dijit.byNode(_24.parentNode);if(_25.params.value===_20){_25.set("checked",true);return true;}});break;case "dijit.form.NumberTextBox":if(_20!=null&&_20!==""&&_20!=="NaN"){_1f.set("value",_20,false);}break;case "misys.form.MultiSelect":_1f.domNode.innerHTML=[];if(_20!==""){var arr=_20.split(",");for(i=0;i<arr.length;i++){var op=dojo.create("option");op.innerHTML=arr[i];op.value=arr[i];_1f.domNode.appendChild(op);}}break;default:_1f.set("value",_20);break;}if(this.overrideDisplaymode==="view"){_1f.set("readOnly",true);}return true;}}return false;},this);}}if(_1a&&_1a.product_name&&_1a.product_name[0]){_1a.product_name[0]=dojox.html.entities.encode(_1a.product_name[0],dojox.html.entities.html);}if(_1a&&_1a.cust_ref_id&&_1a.cust_ref_id[0]){_1a.cust_ref_id[0]=dojox.html.entities.encode(_1a.cust_ref_id[0],dojox.html.entities.html);}if(_1a&&_1a.other_type&&_1a.other_type[0]){_1a.other_type[0]=dojox.html.entities.encode(_1a.other_type[0],dojox.html.entities.html);}if(this.openDialogFromExistingItemInitFunction!=null){this.openDialogFromExistingItemInitFunction(_1a);}this.dialog.show();setTimeout(dojo.hitch(this,"activateDialog"),500);if(_1a.hasOwnProperty("is_valid")){var _26=(dojo.isArray(_1a.is_valid))?_1a.is_valid[0]:_1a.is_valid;if(_26!=="Y"){this.validateDialog(true);}}},editGridData:function(_27,_28){var _29=dojox.html.entities.decode(_27[0].content[0],dojox.html.entities.html);var _2a=function(){var i=0;dijit.byId("narrative_description_goods_popup").set("disabled",false);if(misys._config.codeword_enabled==true){if(_27[0].verb[0]=="REPALL"){dijit.byId("adr_3").set("disabled",false);dijit.byId("adr_3").set("value","REPALL");dijit.byId("adr_1").set("disabled",false);dijit.byId("adr_2").set("disabled",false);dijit.byId("narrative_description_goods_popup").set("value","/REPALL/"+_29);}if(_27[0].verb[0]=="DELETE"){dijit.byId("adr_2").set("disabled",false);dijit.byId("adr_2").set("value","DELETE");dijit.byId("adr_3").set("disabled",true);dijit.byId("narrative_description_goods_popup").set("value","/DELETE/"+_29);}if(_27[0].verb[0]=="ADD"){dijit.byId("adr_1").set("disabled",false);dijit.byId("adr_1").set("value","ADD");dijit.byId("adr_3").set("disabled",true);dijit.byId("narrative_description_goods_popup").set("value","/ADD/"+_29);}}else{dijit.byId("narrative_description_goods_popup").set("value",_29);}dijit.byId("amendments").grid.store.deleteItem(_27[0]);};misys.dialog.show("CONFIRMATION",misys.getLocalization("confirmEditGridRecord"),"",_2a);},activateDialog:function(){misys.dialog.isActive=true;},cloneArray:function(arr){var _2b=[];for(var _2c in arr){_2b[_2c]=arr[_2c];}return _2b;},checkDialog:function(){if(!this.dialog){var _2d=dijit.byId(this.dialogId);if(_2d){this.dialog=_2d;}else{var id=this.dialogId?this.dialogId:"dialog-"+(xmlTag?xmlTag+"-":"")+dojox.uuid.generateRandomUuid();var _2e=this.dialogClassName?this.dialogClassName:"misys.widget.Dialog";this.dialog=dojo.eval("new "+_2e+"({}, dojo.byId('"+id+"'))");this.dialog.set("refocus",false);this.dialog.set("draggable",false);dojo.addClass(this.dialog.domNode,"multipleItemDialog");this.dialog.startup();document.body.appendChild(this.dialog.domNode);}}return this.dialog;},dialogExecute:function(_2f){setTimeout(dojo.hitch(this.gridMultipleItemsWidget,"updateData"),500);},performValidation:function(){if(this.validateDialog()){this.dialog._onSubmit();}},addItem:function(_30){misys.dialog.isActive=false;this.checkDialog();this.dialog.set("title",this.dialogAddItemTitle);this.resetDialog();var _31=this.dialog.getChildren();dojo.some(_31,function(_32){if(_32.grid){_32.renderSections();}});this.dialog.gridMultipleItemsWidget=this;this.dialog.execute=this.dialogExecute;this.dialog.show();if(this._itemFields&&this._itemFields["product_name"]){this._itemFields["product_name"]=dojox.html.entities.encode(this._itemFields["product_name"],dojox.html.entities.html);}if(this._itemFields&&this._itemFields["cust_ref_id"]){this._itemFields["cust_ref_id"]=dojox.html.entities.encode(this._itemFields["cust_ref_id"],dojox.html.entities.html);}if(this._itemFields&&this._itemFields["other_type"]){this._itemFields["other_type"]=dojox.html.entities.encode(this._itemFields["other_type"],dojox.html.entities.html);}if(dojo.byId("pooling_enabled_row")){dojo.style(dojo.byId("pooling_enabled_row"),"display","none");}if(dojo.byId("sweeping_enabled_row")){dojo.style(dojo.byId("sweeping_enabled_row"),"display","none");}if(dojo.byId("charge_account_for_liq_row")){dojo.style(dojo.byId("charge_account_for_liq_row"),"display","none");}setTimeout(dojo.hitch(this,"activateDialog"),500);},setDialogFieldRequired:function(){misys.toggleFields(true,null,this.requiredField,true,true);},setDialogFieldUnrequired:function(){misys.toggleFields(false,null,this.requiredField,true,true);},resetDialog:function(){var _33=this.dialog.getChildren();dojo.forEach(_33,function(_34){var _35=_34.declaredClass;switch(_35){case "dijit.form.RadioButton":_34.set("checked",false);break;case "dijit.form.CheckBox":_34.set("checked",false);break;case "dijit.form.DateTextBox":_34.set("value",null);break;default:if(_34.get("type")==="hidden"){break;}_34.set("value","");_34.state="";if(_34._setStateClass){_34._setStateClass();}break;}_34._hasBeenBlurred=false;if(_34.grid&&_34.grid.declaredClass==="misys.grid.DataGrid"){_34.clear();}});if(this.dialog.gridMultipleItemsWidget){this.dialog.gridMultipleItemsWidget=null;}if(this.dialog.storeId){this.dialog.storeId=null;}for(elm in this.handle){dojo.disconnect(this.handle[elm]);}this.handle=[];},_retrieveItemFields:function(){var _36=this.dialog.getChildren();var _37={};for(var i=0,len=this.gridColumns.length;i<len;i++){var _38=this.gridColumns[i];var _39=(this.propertiesMap[_38]&&this.propertiesMap[_38]._fieldName?this.propertiesMap[_38]._fieldName:_38);_37=this._retrieveWidgetsValues(_36,_38,_39,_37);}return _37;},_retrieveWidgetsValues:function(_3a,_3b,_3c,_3d){dojo.some(_3a,function(_3e){if(_3e.id===_3c||_3e.name===_3c){var _3f="";var _40=_3e.declaredClass;if(_3e.isInstanceOf(misys.grid.GridMultipleItems)){_3f=this._extractJSON(_3e);if(_3f._values.is_valid&&_3f._values.is_valid==="N"){_3d.is_valid="N";}}else{switch(_40){case "dijit.form.DateTextBox":_3f=_3e.get("displayedValue");break;case "dijit.form.CheckBox":_3f=_3e.get("checked")===true?"Y":"N";break;case "dijit.form.RadioButton":var _41=dojo.query("[name='"+_3e.name+"']",this.dialog.domNode);dojo.some(_41,function(_42){var _43=dijit.byNode(_42.parentNode);var _44=_43.get("checked");if(_44){_3f=_43.params.value;return true;}});break;case "dijit.form.NumberTextBox":undefined;_3f=isNaN(_3e.get("value"))?"":_3e.get("value");break;case "misys.form.PercentNumberTextBox":undefined;_3f=isNaN(_3e.get("value"))?"":_3e.get("value");break;case "misys.form.SpreadTextBox":undefined;_3f=isNaN(_3e.get("value"))?"":_3e.get("value");break;case "misys.form.CurrencyTextBox":undefined;_3f=_3e.get("displayedValue");break;default:_3f=_3e.get("value");_3f+="";break;}}if(_3f==null){_3f="";}_3d[_3b]=_3f;return true;}else{if(_3e.declaredClass==="dijit.form.Form"){var _45=_3e.getChildren();_3d=this._retrieveWidgetsValues(_45,_3b,_3c,_3d);}}return false;},this);return _3d;},_extractJSON:function(_46){var _47=_46.declaredClass;var _48={_type:_47,_values:[]};if(_46&&_46.grid&&_46.grid.store){_46.store.fetch({query:{store_id:"*"},onComplete:function(_49,_4a){dojo.forEach(_49,function(_4b){_48._values.push(_46._cloneSingleItem(_4b));});}});}return _48;},_retrieveGridData:function(_4c,_4d){dojo.forEach(_4c,function(_4e){var _4f=_4e.declaredClass;if(_4e.grid){var _50=[];_4e.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(this,function(_51,_52){dojo.forEach(_51,function(_53){var _54=_4e._cloneSingleItem(_53);_50.push(_54);});})});_4d[_4f]=_50;}else{if(_4e.declaredClass==="dijit.form.Form"){var _55=_4e.getChildren();_4d=this._retrieveGridData(_55,_4d);}}},this);return _4d;},_cloneMultipleItems:function(_56){var _57=[];dojo.forEach(_56,function(_58){var _59=dojo.isArray(_58);_58=dojo.isArray(_58)?_58[0]:_58;var _5a={};for(var _5b in _58){if(dojo.some(this.gridColumns,function(_5c){return _5c==_5b;})){if(_5b.match("^misys.openaccount.widget.")=="misys.openaccount.widget."){var _5d=dojo.eval("new "+_5b+"()");var _5e=_5d._cloneItem(_58[_5b]);_5a[_5b]=_5e;}else{if(_5b.match("^_")!=="_"){_5a[_5b]=dojo.isArray(_58[_5b])?_58[_5b][0]:_58[_5b];}}}}_57.push(_5a);},this);return _57;},_cloneSingleItem:function(_5f){var _60=dojo.isArray(_5f);_5f=dojo.isArray(_5f)?_5f[0]:_5f;var _61={};for(var _62 in _5f){if(dojo.some(this.gridColumns,function(_63){return _63==_62;})){if(_62.match("^_")!=="_"){_61[_62]=dojo.isArray(_5f[_62])?_5f[_62][0]:_5f[_62];}}}return _60?[_61]:_61;},_cloneItemWithoutStoreId:function(_64){var _65=dojo.isArray(_64);_64=dojo.isArray(_64)?_64[0]:_64;var _66={};for(var _67 in _64){if(dojo.some(this.gridColumns,function(_68){return _68==_67;})){if(_67.match("^misys.openaccount.widget.")=="misys.openaccount.widget."){var _69=dojo.eval("new "+_67+"()");var _6a=_69._cloneItem(_64[_67]);_66[_67]=_6a;}else{if(_67!=="store_id"){if(_67.match("^_")!=="_"){_66[_67]=dojo.isArray(_64[_67])?_64[_67][0]:_64[_67];}}}}}return _65?[_66]:_66;},updateData:function(){var _6b=this.dialog.storeId;this._itemFields=this._retrieveItemFields();this._itemFields["store_id"]=(_6b!=null?_6b:dojox.uuid.generateRandomUuid());if(this._itemFields&&this._itemFields["product_name"]){this._itemFields["product_name"]=dojox.html.entities.encode(this._itemFields["product_name"],dojox.html.entities.html);}if(this._itemFields&&this._itemFields["cust_ref_id"]){this._itemFields["cust_ref_id"]=dojox.html.entities.encode(this._itemFields["cust_ref_id"],dojox.html.entities.html);}if(this._itemFields&&this._itemFields["other_type"]){this._itemFields["other_type"]=dojox.html.entities.encode(this._itemFields["other_type"],dojox.html.entities.html);}var _6c=this.checkMandatoryProperties(this._itemFields);var _6d=this.checkSubItemsValidity();this._itemFields["is_valid"]=_6c&&_6d?"Y":"N";dojo.attr(this.itemsNode,"style",{display:"block"});dojo.attr(this.noItemLabelNode,"style",{display:"none"});if(this.grid){this.grid.store.fetch({query:{store_id:_6b},onComplete:dojo.hitch(this,function(_6e,_6f){if(_6e.length>0){var _70=_6e[0];for(var _71 in this._itemFields){var _72=this._itemFields[_71];if((_72!=null&&_72!=undefined)&&_71!="store_id"){this.grid.store.setValue(_70,_71,_72);}}}else{this.grid.store.newItem(this._itemFields);}})});var _73=this.grid.selection.getSelected();if(_73.length){dojo.forEach(_73,function(_74){if(_74!==null){this.grid.selection.setSelected(_74,false);}},this);}}else{var _75=[this._itemFields];var _76={identifier:"store_id",label:"store_id",items:_75};this.store=new dojo.data.ItemFileWriteStore({data:_76,typeMap:this.typeMap});this.createDataGrid();}this.grid.store.save();this.grid.render();},createDataStoreFromNewItemCommand:function(_77){dojo.eval("this.data.items = [{store_id: '0', "+_77+"}]");this.store=new dojo.data.ItemFileWriteStore({data:this.data});},clear:function(){if(this.grid&&this.grid.store){this.grid.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(this,function(_78,_79){dojo.forEach(_78,function(_7a){this.grid.store.deleteItem(_7a);},this);})});this.grid.store.save();var _7b=this;setTimeout(function(){_7b.renderSections();_7b.grid.render();},200);}},renderAll:function(){this.renderSections();if(this.grid){this.grid.render();}},createItem:function(){if(this.hasChildren&&this.hasChildren()){var _7c=[];dojo.forEach(this.getChildren(),function(_7d){if(_7d.createItem){_7c.push(_7d.createItem());}},this);var _7e={};_7e[this.declaredClass]=_7c;return _7e;}return null;},toXML:function(){var xml=[];if(this.xmlTagName){xml.push("<",this.xmlTagName,">");}if(this.grid){this.grid.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(this,function(_7f,_80){xml.push(this.itemToXML(_7f,this.xmlSubTagName));})});}if(this.xmlTagName){xml.push("</",this.xmlTagName,">");}return xml.join("");},itemToXML:function(_81,_82){var xml=[];dojo.forEach(_81,function(_83){if(_83){if(_82){xml.push("<",_82,">");}for(var _84 in _83){var _85=dojo.isArray(_83[_84])?_83[_84][0]:_83[_84];if(dojo.isObject(_85)&&_85._type){var _86=_85._type;var _87=dojo.eval(_86);var _88=new _87({});xml.push("<",_88.xmlTagName,">");if(_85._values){xml.push(this.itemToXML(_85._values,_88.xmlSubTagName,xml));}else{if(_85._value){xml.push(this.itemToXML(_85._value,_88.xmlSubTagName,xml));}}xml.push("</",_88.xmlTagName,">");}else{if(_84!="store_id"&&_84.match("^_")!="_"){_85=dojo.isArray(_83[_84])?_83[_84][0]:_83[_84];_85+="";xml.push("<",_84,">",dojox.html.entities.encode(_85,dojox.html.entities.html),"</",_84,">");}}}if(_82){xml.push("</",_82,">");}}},this);return xml.join("");},createItemsFromJson:function(_89){var _8a;myData=dojo.fromJson(_89);this.dataList=[];for(_8a in myData.items){if(myData.items[_8a].ref_id){this.dataList.push(myData.items[_8a]);}}if(this.dataList.length>0){this.createDataStoreFromDataList();this.createDataGrid();}},createJsonItem:function(){var _8b=[];if(this.hasChildren&&this.hasChildren()){dojo.forEach(this.getChildren(),function(_8c){if(_8c.createJsonItem){var _8d=this.getMandatoryProperties(_8c);var _8e=_8c.createJsonItem(this.propertiesMap,_8d);_8b.push(_8e);if(this.get("is_valid")!=="N"){this.set("is_valid",_8e.is_valid?_8e.is_valid:"Y");}misys._widgetsToDestroy=misys._widgetsToDestroy||[];misys._widgetsToDestroy.push(_8c.id);}},this);}return _8b;},isWidgetToBeDestroyed:function(_8f){var _90=false;if(misys._widgetsToDestroy){dojo.some(misys._widgetsToDestroy,function(_91){if(_91===_8f.id){_90=true;return false;}});}return _90;},destroyWidgets:function(){if(misys._widgetsToDestroy){dojo.forEach(misys._widgetsToDestroy,function(_92){if(dijit.byId(_92)){dijit.byId(_92).destroyRecursive();}});}},validate:function(){if(this.store){var _93=dojo.some(this.store._arrayOfAllItems,function(_94){if(_94&&_94.is_valid){return _94.is_valid[0]!=="Y";}return false;});return !_93;}else{if(this.is_valid){return (this.is_valid==="Y");}}return true;},validateDialog:function(_95){var _96=true,_97=false,_98=this.dialog.getChildren();if(!_95){var _99=dojo.every(_98,function(w){return (w.disabled||!w.validate||w.validate());});this.is_valid=(_99)?"Y":"N";this.state=(_99)?"":"Error";_96=true;}else{dojo.some(_98,function(_9a){_9a._hasBeenBlurred=true;var _9b=_9a.disabled||!_9a.validate||_9a.validate();if(!_9b&&!_97){if(_9a.hasOwnProperty("parentTab")){dijit.byId(_9a.get("tabContainer")).selectChild(_9a.get("parentTab"));}dojo.window.scrollIntoView(_9a.containerNode||_9a.domNode);if(_9a.focus){_9a.focus();}_97=true;}if(!_9b){_96=false;}});}return _96;},collectRequiredField:function(){this.checkDialog();var _9c=this.dialog.getChildren();var _9d=[];dojo.some(_9c,function(_9e){if(_9e.required){_9d.push(_9e.id);}});this.requiredField=_9d;},checkMandatoryProperties:function(_9f){var _a0=this.getMandatoryProperties(_9f);var _a1=dojo.some(_a0,dojo.hitch(this,function(_a2){var _a3=_9f[_a2];if(typeof _a3!=="undefined"){_a3=dojo.isArray(_a3)?_a3[0]:_a3;return (_a3==null||_a3==="");}}));return !_a1;},checkSubItemsValidity:function(){for(var _a4 in this._itemFields){var _a5=this._itemFields[_a4];if(_a5._type&&_a5._values){var _a6=dojo.some(_a5._values,dojo.hitch(this,function(_a7){if(_a7.is_valid){var _a8=dojo.isArray(_a5)?_a7.is_valid[0]:_a7.is_valid;return (_a8==="N");}return false;}));if(_a6){return false;}}}return true;}});}