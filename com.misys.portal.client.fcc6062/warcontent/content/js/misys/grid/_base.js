/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.grid._base"]){dojo._hasResource["misys.grid._base"]=true;dojo.provide("misys.grid._base");dojo.require("dojo.data.ItemFileReadStore");dojo.require("dojo.currency");dojo.require("dojo.fx");(function(d,dj,m){function _1(_2,_3,_4,_5){_2=d.isArray(_2)?_2:[_2];var _6={"list_keys":_4},_7=d.byId("batchContainer"),_8;if(dj.byId("reauth_password")){d.mixin(_6,{"reauth_password":dj.byId("reauth_password").get("value")});}_8={url:m.getServletURL(_3),handleAs:"text",sync:true,content:_6,load:function(_9){_9=_9.replace(/\n/g,"<br>");_9=_9.replace(/\t/g,"&nbsp;&nbsp;&nbsp;");_7.innerHTML=_9;setTimeout(function(){m.animate("wipeIn","batchContainer");},500);m._config.groups=[];d.forEach(_2,function(g){g.setStore(g.store);d.hitch(g,"render")();m.connect(g,"_onFetchComplete",function(){g.selection.clear();});});}};if(_5){d.mixin(_8,{handle:_5});}m.xhrPost(_8);};function _a(_b,_c,_d,_e){var _f=dijit.byId("mode")?dijit.byId("mode").get("value"):"";var _10=dijit.byId("forwardHolidayButtonId")?dijit.byId("forwardHolidayButtonId"):new dj.form.Button({label:m.getLocalization("autoForwardMessage"),id:"forwardHolidayButtonId"});if(!dj.byId("holidayCutOffDialog")){d.require("misys.widget.Dialog");d.require("dijit.form.Button");var _11=new dj.Dialog({id:"holidayCutOffDialog",title:"Confirmation",draggable:false});var _12=d.create("div",{id:"holidayCutOffDialogContent"});var _13=d.create("div",{id:"dialogHolidayText"},_12,"first");var _14=d.create("div",{id:"holidayCutOffDialogButtons",style:"text-align:center;"},_12,"last");var _15=new dj.form.Button({label:m.getLocalization("cancelMessage"),id:"cancelHolidayButtonId"});d.place(_15.domNode,_14);_11.set("content",_12);}var _16=dj.byId("holidayCutOffDialog");if(_b===true){d.place(_10.domNode,d.byId("holidayCutOffDialogButtons"),"first");m.dialog.connect(dj.byId("forwardHolidayButtonId"),"onClick",function(){if(_d){_16.hide();m._config.doReauthSubmit(_e);_10.destroy();}else{_16.hide();m.xhrPost(_e);setTimeout(d.hitch(grid,"render"),100);}},_16.id);}else{_10.destroy();}if(d.byId("dialogHolidayText")){d.byId("dialogHolidayText").innerHTML=_c;d.byId("dialogHolidayText").innerHTML=d.byId("dialogHolidayText").innerHTML.replace(/\,/g,"");}m.dialog.connect(_16,"onKeyPress",function(evt){if(evt.keyCode==d.keys.ESCAPE){d.stopEvent(evt);}});m.dialog.connect(dj.byId("cancelHolidayButtonId"),"onClick",function(){m.dialog.hide();_10.destroy();_16.hide();},_16.id);m.dialog.connect(_16,"onHide",function(){_10.destroy();m.dialog.disconnect(_16);m.dialog.hide();});_16.show();};function _17(){var _18=true;if(dijit.byId("operation")&&dijit.byId("operation").get("value")==="LIST_FX_DEALS"){_18=false;}return _18;};m.grid=m.grid||{};d.mixin(m.grid,{setStore:function(_19,_1a,_1b){var _1c=_1b||_1a.args.grid,_1d;if(_1c){_1d=_1c.store;if(_1d&&_1d!==null){_1d.close();}_1c.setStore(new dojo.data.ItemFileReadStore({data:_19,urlPreventCache:true,clearOnClose:true}));}},setStoreURL:function(_1e,url,_1f){var _20=dj.byId(_1e),_21,_22,_23;if(_20){_23=_20.store;if(_23){_21=url||_23.url;_22=_1f||_20.queryOptions;_23.close();_23.url=_21;if(_23.declaredClass==="dojox.data.QueryReadStore"){_20.setStore(_23,_1f);}else{_20.setStore(_23,null,_1f);}}else{_20.setStore(new misys.data.ItemFileReadStore({url:url,urlPreventCache:true,clearOnClose:true}),null,_1f);}}},filter:function(_24,_25,_26){var _27=dj.byId(_24),_28=[],_29;if(_27&&(_25.length===_26.length)){d.forEach(_25,function(key,i){_29=dj.byId(_26[i]);if(_29){var _2a=_29.get("value");_2a=_2a.replace(/\\/g,"\\\\").replace(/'/g,"\\'");if(_2a!==""){_28.push(key,":'",_2a,"',");}}});_28=_28.join("");if(_28.charAt(_28.length-1)===","){_28=_28.substring(0,_28.length);}_27.queryOptions=d.mixin(_27.queryOptions,{ignoreCase:true});_27.filter(d.fromJson("{"+_28.substring(0,_28.length-1)+"}"),true);}},selectAll:function(){var _2b=d.byId("select_all_box").checked,_2c=d.query("input[type=checkbox]");for(var x=0,len=_2c.length;x<len;x++){_2c[x].checked=_2b;}},reloadForSearchTerms:function(){var _2d=dj.byId("TransactionSearchForm"),_2e=d.query(".dojoxGrid"),_2f=d.query(".gridContainer")[0],_30=/Date/,_31=/Time/,_32={},_33,_34,_35;for(var i=0,len=_2e.length;i<len;i++){if(!d.hasClass(_2e[i],"noReload")){_35=dj.byId(_2e[i].id);break;}}if(_35&&_2d){if(dojo.isFunction(_35.gotoFirstPage)&&_17()){_35.gotoFirstPage();}if(_2f){d.removeClass(_2f,"notready");}if(d.byId("divResults")){d.style("divResults","margin",0);}_33=_35.get("store");m.connect(_35,"_onFetchComplete",function(){setTimeout(function(){_35.resize();},500);});_34=_33.url;if(_34.indexOf("&")!==-1){_34=_34.substring(0,_34.indexOf("&"));}if(_34.indexOf("EventsSearchAction")!==-1){if(_34.indexOf("?")!==-1){_34=_34.substring(0,_34.indexOf("?"));}}_2d.getDescendants().forEach(function(_36,i){if(_36.name){var _37;if(_36.declaredClass=="dijit.form.RadioButton"){var _38=dojo.query("[name='"+_36.name+"']",_2d.domNode);d.some(_38,function(_39){var _3a=dj.byNode(_39.parentNode);if(_3a.checked){_37=_3a.params.value;}});}else{_37=_36.get("value");}if(_30.test(_36.declaredClass)||(_31.test(_36.declaredClass))){_37=_36.get("displayedValue");}if(_37===" "){_37="";}_32[_36.get("name")]=_37;}});_32["searchFlag"]=true;var _3b=_35.onSelectionClearedScript;if(_3b){d.eval(_3b);}if(_35.selection&&_35.get("selectionMode")!==""){_35.selection.clear();}_33.close();_33.url=_34;if(_32.list_keys){_32.list_keys="";}if(_33.declaredClass==="dojox.data.QueryReadStore"){_35.setStore(_33,_32);}else{_35.setStore(_33,null,_32);}}},onSelection:function(){if(this.selection.selectedIndex!=-1){var _3c=this.store.getValue(this.getItem(this.selection.selectedIndex),"onSelectionChangedScript");d.eval(_3c);this.updateRowStyles(this.selection.selectedIndex);}},getCellData:function(_3d,_3e){return this.grid.store.getValue(_3d,_3e);},formatJSLink:function(_3f){return (_3f&&d.isObject(_3f))?d.string.substitute("<a href='javascript:${href}'>${text}</a>",_3f):_3f;},formatSelectField:function(_40,_41){if(!_41){return this.defaultValue;}var _42=this.grid.store.getValue(_41,"box_ref"),_43=this.grid.store.getValue(_41,"box_checked")==="true";return "<input id='"+value+"' name='"+value+"' onclick='alert('To implement')' type='checkbox' "+_43?"checked='checked'":"";},formatGroupsAndAggregates:function(_44,idx){if(_44){return m.grid.formatHTML(_44);}else{return _44;}},formatSimpleHTML:function(_45){_45=_45.replace(/&amp;nbsp;/g,"&nbsp;");_45=_45.replace(/&amp;#x27;/g,"&#x27;");_45=_45.replace(/&amp;#x2F;/g,"&#x2F;");_45=_45.replace(/&amp;#34;/g,"&#34;");_45=_45.replace(/&amp;#x28;/g,"(");_45=_45.replace(/&amp;#x29;/g,")");_45=_45.replace(/&amp;#x26;/g,"&");return _45.replace(/&amp;amp;/g,"&amp;");},formatHTML:function(_46){return _46;},sanitizeHTMLDataForUI:function(_47){if(_47){_47=_47.replace(/<img/g,"&lt;img");_47=_47.replace(/>/g,"&gt;");}return _47;},formatHTMLInteger:function(_48){return _48;},formatDate:function(_49){var _4a=_49.indexOf(">");var _4b=_49.indexOf("<",1);return _49.substring(_4a+1,_4b);},formatFlagImage:function(_4c){var _4d=_4c.toLowerCase();if(misys._config.fbccVersion!==""||misys._config.fbccVersion!==null){return m.grid.formatHTML("<img src='"+m.getContextualURL(m._config.imagesSrc+"flags/")+_4d+".png?v="+misys._config.fbccVersion+"'alt='"+_4d+"'/>");}else{return m.grid.formatHTML("<img src='"+m.getContextualURL(m._config.imagesSrc+"flags/")+_4d+".png' alt='"+_4d+"'/>");}},formatCurrencyFlagImage:function(_4e){var _4f=_4e.toLowerCase().substring(0,2);if(misys._config.fbccVersion!==""||misys._config.fbccVersion!==null){return m.grid.formatHTML("<img src='"+m.getContextualURL(m._config.imagesSrc+"flags/")+_4f+".png?v="+misys._config.fbccVersion+"'alt='"+_4f+"'/>");}else{return m.grid.formatHTML("<img src='"+m.getContextualURL(m._config.imagesSrc+"flags/")+_4f+".png' alt='"+_4f+"'/>");}},formatSummary:function(_50,_51,_52,_53,_54){if(_50===0){return "";}var str;if(_51>=0){return _50;}if(_51===-1){str=m.getLocalization("totalPrefix")+" (${numItems} ${displayName})";}else{str="${numItems} ${displayName}";}return d.string.substitute(str,{numItems:_50,displayName:(_50===1)?_53:_54});},formatOperationsSummary:function(_55,_56){return m.grid.formatSummary(_55,_56,this,"Operation","Operations");},formatTypesSummary:function(_57,_58){return m.grid.formatSummary(_57,_58,this,"Type","Types");},formatDataSummary:function(_59,_5a){return (_59===0)?"":_59;},formatTitlesSummary:function(_5b,_5c){return m.grid.formatSummary(_5b,_5c,this,"Title","Titles");},formatURL:function(_5d){if(!window.isAccessibilityEnabled){return (_5d&&d.isObject(_5d))?d.string.substitute("<a href='${href}'>${text}</a>",_5d):_5d;}else{var _5e=misys.getLocalization("link");return (_5d&&d.isObject(_5d))?d.string.substitute("<a href='${href}' aria-labelledby='${href}_link_span'>${text}</a><span class='sr-only' id='${href}_link_span'>"+_5e+"</span>",_5d):_5d;}},formatReportActions:function(_5f,_60,_61){var _62=_61.grid.gridMultipleItemsWidget.overrideDisplaymode;var _63=_61.grid.gridMultipleItemsWidget.id;var _64=dojo.create("div");var div=dojo.create("div",{"class":"gridActions"},_64);if(_62&&_62=="view"){dojo.create("img",{"src":misys._config.context+misys._config.imagesSrc+"pic_text.gif","alt":"View",border:"0","type":"view"},div);}else{dojo.create("img",{"src":misys.getContextualURL(misys._config.imagesSrc+m._config.imageStore.editIcon),"title":"Edit","alt":"Edit","border":"0","type":"edit"},div);dojo.create("img",{"src":misys.getContextualURL(misys._config.imagesSrc+m._config.imageStore.deleteIcon),"title":"Delete","alt":"Delete","border":"0","type":"remove"},div);if(_63==="columns"){dojo.create("img",{"src":misys._config.context+misys._config.imagesSrc+"action-up.png","alt":"Move Up",border:"0","type":"moveup"},div);dojo.create("img",{"src":misys._config.context+misys._config.imagesSrc+"action-down.png","alt":"Move Down",border:"0","type":"movedown"},div);}}return _64.innerHTML;},formatAccountActions:function(_65,_66,_67){var _68=_67.grid.gridMultipleItemsWidget.overrideDisplaymode;var _69=_67.grid.gridMultipleItemsWidget.id;var _6a=dojo.create("div");var div=dojo.create("div",{"class":"gridActions"},_6a);if(_68&&_68=="view"){dojo.create("img",{"src":misys._config.context+misys._config.imagesSrc+"pic_text.gif","alt":"View",border:"0","type":"view"},div);}else{dojo.create("img",{"src":misys.getContextualURL(misys._config.imagesSrc+m._config.imageStore.editIcon),"title":"Edit","alt":"Edit","border":"0","type":"edit"},div);}return _6a.innerHTML;},formatDeleteActions:function(_6b,_6c,_6d){var _6e=_6d.grid.gridMultipleItemsWidget.overrideDisplaymode;var _6f=dojo.create("div");var div=dojo.create("div",{"class":"gridActions"},_6f);dojo.create("img",{"src":misys.getContextualURL(misys._config.imagesSrc+m._config.imageStore.deleteIcon),"alt":"Delete","border":"0","type":"remove"},div);return _6f.innerHTML;},formatCptyDeleteActions:function(_70,_71,_72){var _73=_72.grid.gridMultipleItemsWidget.overrideDisplaymode;var _74=dojo.create("div");var div=dojo.create("div",{"class":"gridActions"},_74);if(_72.grid._by_idx[_71]&&_72.grid._by_idx[_71].item&&_72.grid._by_idx[_71].item.cpty_showDelete[0]&&_72.grid._by_idx[_71].item.cpty_showDelete[0]==="true"){dojo.create("img",{"src":misys.getContextualURL(misys._config.imagesSrc+m._config.imageStore.deleteIcon),"alt":"Delete","border":"0","type":"remove"},div);}return _74.innerHTML;},formatActions:function(_75){return (_75&&d.isObject(_75)?_75.href:_75);},confirmDeleteRecords:function(_76,url){var _77=_76.selection.getSelected().length;var _78=_76.store._items.length;if(_77>0&&_78>0){m.dialog.show("CONFIRMATION",m.getLocalization("deleteTransactionsConfirmation",[_76.selection.getSelected().length]),"",function(){m.grid.processRecords(_76,url);});}else{m.dialog.show("ERROR",m.getLocalization("noTransactionsSelectedError"));}},confirmSubmitRecords:function(_79,url){var _7a=_79.selection.getSelected().length;var _7b=_79.store._items.length;if(_7a>0&&_7b>0){m.dialog.show("CONFIRMATION",m.getLocalization("submitTransactionsConfirmation",[_79.selection.getSelected().length]),"",function(){m.grid.processRecordsWithHolidayCutOffValidation(_79,url);});}else{m.dialog.show("ERROR",m.getLocalization("noTransactionsSelectedError"));}},confirmResendRecords:function(_7c,url){var _7d=_7c.selection.getSelected().length;var _7e=_7c.store._items.length;if(_7d>0&&_7e>0){m.dialog.show("CONFIRMATION",m.getLocalization("resendTransactionsConfirmation",[_7c.selection.getSelected().length]),"",function(){setTimeout(function(){m.grid.processRecords(_7c,url);},100);});}else{m.dialog.show("ERROR",m.getLocalization("noTransactionsSelectedError"));}},confirmCancelRecords:function(_7f,url,_80){var _81=d.byId("batchContainer"),_82=_7f.selection.getSelected(),_83="",_84=0,_85,xhr,_86=true;var _87=dj.byId("reauth_perform");m.animate("wipeOut",_81);if(_82.length){d.forEach(_82,function(_88){_85=_7f.store.getValues(_88,"box_ref");if("S"+_83!="S"){_83=_83+",";}_83=_83+_85;_84++;});if(_84>0){var _89=function(){var _8a={url:m.getServletURL(url),handleAs:"text",content:{list_keys:_83},load:function(_8b){_8b=_8b.replace(/\n/g,"<br>");_8b=_8b.replace(/\t/g,"&nbsp;&nbsp;&nbsp;");_81.innerHTML=_8b;m.animate("wipeIn","batchContainer");_7f.selection.clear();_7f.setStore(_7f.store);}};var _8c=function(){m.xhrPost(_8a);setTimeout(d.hitch(_7f,"render"),100);};if((_87&&_87.get("value")==="Y")&&d.isFunction(m._config.doReauthSubmit)){m._config.doReauthSubmit(_8a);}else{_8c();}};m.dialog.show("CONFIRMATION",m.getLocalization("cancelledTransactionsConfirmation",[_7f.selection.getSelected().length]),"",_89);}}else{m.dialog.show("ERROR",m.getLocalization("noTransactionsSelectedError"));}},confirmForwardRecords:function(_8d,url){var _8e=_8d.selection.getSelected().length;if(_8e>0){m.dialog.show("CONFIRMATION",m.getLocalization("forwardsTransactionConfirmation",[_8d.selection.getSelected().length]),"",function(){m.rocessRecords(_8d,url);});}else{m.dialog.show("ERROR",m.getLocalization("noTransactionsSelectedError"));}},processRecordsWithHolidayCutOffValidation:function(_8f,url){var _90=d.byId("batchContainer"),_91=_8f.selection.getSelected(),_92="",_93=0,_94,xhr,_95=true,_96,_97,_98,_99;var _9a=[];m.animate("wipeOut",_90);var _9b=dj.byId("reauth_perform");if(_91.length){d.forEach(_91,function(_9c){_94=_8f.store.getValues(_9c,"box_ref");if("S"+_92!="S"){_92=_92+",";}_92=_92+_94;_93++;});if(_93>0){m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/ValidateHolidayCutOffMultipleSubmission"),handleAs:"json",preventCache:true,sync:true,content:{list_keys:_92},load:function(_9d,_9e){_99=_9d.autoForwardEnabled;_95=_9d.isValid;_96=_9d.autoForwardTransactionDetails;_98=_9d.failedTransactionDetailsCutOff;_97=_9d.failedTransactionDetailsHolidays;},error:function(_9f,_a0){console.error("[misys.grid._base] processRecordsWithHolidayCutOffValidation error",_9f);}});if(_95){var _a1={url:m.getServletURL(url),handleAs:"text",content:{list_keys:_92},load:function(_a2){_a2=_a2.replace(/\n/g,"<br>");_a2=_a2.replace(/\t/g,"&nbsp;&nbsp;&nbsp;");_90.innerHTML=_a2;_8f.selection.clear();_8f.setStore(_8f.store);setTimeout(function(){m.animate("wipeIn","batchContainer");},1000);}};var _a3=function(){m.xhrPost(_a1);setTimeout(d.hitch(_8f,"render"),10000);};if((_9b&&_9b.get("value")==="Y")&&d.isFunction(m._config.doReauthSubmit)){m._config.doReauthSubmit(_a1);}else{_a3();}}else{if(_99&&_99==="N"){_9a=[];_9a.push("<div style='display:block;'>"+m.getLocalization("Cutoffdatepassed")+"<br/>");d.forEach(_96,function(_a4){_9a.push("<li>"+_a4+"</li>");});_9a.push("</div>");if((_9b&&_9b.get("value")==="Y")&&d.isFunction(m._config.doReauthSubmit)){_a3=function(){m._config.doReauthSubmit(_a1);};m.dialog.show("CUSTOM-NO-CANCEL",_9a.join(""),"",_a3);}else{m.dialog.show("CUSTOM-NO-CANCEL",_9a.join(""),"",callBack);}}else{_9a=[];if(_99){if(_98.length>0){_9a.push("<div <b>"+m.getLocalization("failedMultipleSubmissionCutOff")+"</b><br/>");d.forEach(_98,function(_a5){_9a.push("<li>"+_a5+"</li>");});_9a.push("</div>");}if(_97.length>0){_9a.push("<div style='display:block;'><b>"+m.getLocalization("failedMultipleSubmissionHoliday")+"</b><br/>");d.forEach(_97,function(_a6){_9a.push("<li>"+_a6+"</li>");});_9a.push("</div>");}_9a.push("<div style='display:block;'><b>"+m.getLocalization("autoForwardMultipleSubmission")+"</b><br/>");_9a.push("</div>");_a1={url:m.getServletURL(url),handleAs:"text",content:{list_keys:_92,autoForward:"Y"},load:function(_a7){_a7=_a7.replace(/\n/g,"<br>");_a7=_a7.replace(/\t/g,"&nbsp;&nbsp;&nbsp;");_90.innerHTML=_a7;m.animate("wipeIn","batchContainer");_8f.selection.clear();_8f.setStore(_8f.store);}};if((_9b&&_9b.get("value")==="Y")&&d.isFunction(m._config.doReauthSubmit)){_a(_99,_9a,true,_a1);}else{_a(_99,_9a,false,_a1);}}else{if(_98.length>0){_9a.push("<div style='display:block;'><b>"+m.getLocalization("failedMultipleSubmissionCutOff")+"</b><br/>");d.forEach(_98,function(_a8){_9a.push("<li>"+_a8+"</li>");});}if(_97.length>0){_9a.push("<div style='display:block;'><b>"+m.getLocalization("failedMultipleSubmissionHoliday")+"</b><br/>");d.forEach(_97,function(_a9){_9a.push("<li>"+_a9+"</li>");});}_a(_99,_9a,false,_a1);}}}}}},processDeletionOfBatch:function(_aa,url){var _ab=d.byId("batchContainer"),_ac=_aa.selection.getSelected(),_ad="",_ae=0,_af,xhr,_b0=true;m.animate("wipeOut",_ab);if(_ac.length){d.forEach(_ac,function(_b1){_af=_aa.store.getValues(_b1,"box_ref");if("S"+_ad!="S"){_ad=_ad+",";}_ad=_ad+_af;_ae++;});if(_ae>0){var _b2=function(){m.xhrPost({url:m.getServletURL(url),handleAs:"text",content:{list_keys:_ad},load:function(_b3){_b3=_b3.replace(/\n/g,"<br>");_b3=_b3.replace(/\t/g,"&nbsp;&nbsp;&nbsp;");_ab.innerHTML=_b3;m.animate("wipeIn","batchContainer");_aa.setStore(_aa.store);setTimeout(d.hitch(_aa,"render"),300);m.connect(_aa,"_onFetchComplete",function(){_aa.selection.clear();});}});};m.dialog.show("CONFIRMATION",m.getLocalization("batchSelectedDelete"),"",_b2);}}else{if(_ac.length===0){m.dialog.show("ERROR",m.getLocalization("noTransactionsSelectedError"));}}},processBatchingOfRecords:function(_b4,url){var _b5=d.byId("batchContainer"),_b6=_b4.selection.getSelected(),_b7="",_b8=0,_b9,xhr,_ba=true;m.animate("wipeOut",_b5);if(_b6.length){d.forEach(_b6,function(_bb){_b9=_b4.store.getValues(_bb,"box_ref");if("S"+_b7!="S"){_b7=_b7+",";}_b7=_b7+_b9;_b8++;});if(_b8>0){m.xhrPost({url:m.getServletURL("/screen/AjaxScreen/action/ValidateBatchCriteria"),handleAs:"json",preventCache:true,sync:true,content:{list_keys:_b7},load:function(_bc,_bd){_ba=_bc.isValid;},error:function(_be,_bf){console.error("[misys.grid._base] processBatchingOfRecords error",_be);}});if(!_ba){m.dialog.show("ERROR",m.getLocalization("batchTransactionsError"));}else{m.xhrPost({url:m.getServletURL(url),handleAs:"text",sync:true,content:{list_keys:_b7},load:function(_c0){_c0=_c0.replace(/\n/g,"<br>");_c0=_c0.replace(/\t/g,"&nbsp;&nbsp;&nbsp;");_b5.innerHTML=_c0;_b4.selection.clear();_b4.setStore(_b4.store);setTimeout(function(){m.animate("wipeIn","batchContainer");},3000);}});setTimeout(d.hitch(_b4,"render"),100);}}}else{if(_b6.length===0){m.dialog.show("ERROR",m.getLocalization("noTransactionsSelectedError"));}}},processRecords:function(_c1,url,_c2){var _c3=d.isArray(_c1)?_c1:[_c1],_c4=d.byId("batchContainer"),_c5=[],_c6="",_c7=0,_c8,_c9;m.animate("wipeOut",_c4);d.forEach(_c3,function(_ca){_c5=_ca.selection.getSelected();if(_c5&&_c5.length){d.forEach(_c5,function(_cb){_c8=_ca.store.getValues(_cb,"box_ref");if(_c6!==""){_c6+=", ";}_c6+=_c8;_c7++;});}});if(_c7>0){_1(_c3,url,_c6,_c2);}_c1.multipleSelectItems=new Object();},setListKey:function(_cc){var _cd="",_ce=_cc.selection.getSelected(),_cf=0,_d0=dj.byId("list_keys"),_d1;if(_ce.length){d.forEach(_ce,function(_d2){_d1=_cc.store.getValues(_d2,"box_ref");if(_cf!==0){_cd+=",";}_cd+=_d1;_cf++;});}if(_d0&&_d0!==null){_d0.set("value",_cd);}if(_cf===0&&dj.byId("export_list")&&dj.byId("export_list").get("value")==="zip"){m.dialog.show("ERROR",m.getLocalization("noTransactionsSelectedError"));e.preventDefault();}},beforeRow:function(_d3,_d4){if(_d4.length>=2){if(_d4[1]&&!_d4[1].hidden){_d4[1].hidden=true;}if(_d3===-1){if(!_d4.headerDisplayed){_d4.headerDisplayed=true;}else{_d4[1].hidden=true;if(_d4.length===3){_d4[2].hidden=true;}}}else{var _d5=this.grid.getItem(_d3);if(_d5){var _d6=this.grid.store.getValue(_d5,"_row_type");if(_d6===2||_d6===3){_d4[1].hidden=false;}else{if(_d6===4){_d4[1].hidden=false;_d4[2].hidden=false;}else{_d4[1].hidden=true;if(_d4.length===3){_d4[2].hidden=true;}}}}else{_d4[1].hidden=true;if(_d4.length===3){_d4[2].hidden=true;}}}}},validateSearchDateRange:function(){var _d7=dj.byId("range").get("value"),_d8=dj.byId("startdate"),end=dj.byId("enddate"),_d9=0;if(_d8&&end){_d9=d.date.difference(dj.byId("startdate").get("value"),dj.byId("enddate").get("value"),"day");}var _da;if(_d7==1){_da=31;}else{_da=92;}if(_d9<0||_d9>_da){var _db=false;if(_d7==1){m.connect("startdate","onChange",function(){if(!_db){var _dc=dojo.date.add(dj.byId("startdate").get("value"),"month",1);dijit.byId("enddate").set("value",_dc);_db=true;}});m.connect("enddate","onChange",function(){if(!_db){var _dd=dojo.date.add(dj.byId("enddate").get("value"),"month",-1);dijit.byId("startdate").set("value",_dd);_db=true;}});}else{if(_d7==3){m.connect("startdate","onChange",function(){if(!_db){var _de=dojo.date.add(dj.byId("startdate").get("value"),"month",3);dijit.byId("enddate").set("value",_de);_db=true;}});m.connect("enddate","onChange",function(){if(!_db){var _df=dojo.date.add(dj.byId("enddate").get("value"),"month",-3);dijit.byId("startdate").set("value",_df);_db=true;}});}else{this.invalidMessage=m.getLocalization("monthRangeValidityMessage",[_d7,dj.byId("startdate").get("displayedValue")]);return false;}}}return true;},redirect:function(_e0){var _e1=_e0.grid,_e2=_e1.getItem(_e0.rowIndex),url=_e1.store.getValue(_e2,"SCREEN");if(url){var _e3=m.getQueryParameterByName("productcode",url);var _e4=m.getQueryParameterByName("subproductcode",url);var _e5=[];if(misys._config.isBank==="false"&&misys._config.fccuiEnabled&&misys._config.fccuiEnabled==="true"&&m.isAngularProductUrl(_e3,_e4)){_e5.push("/productScreen?");_e5.push("refId=",m.getQueryParameterByName("referenceid",url));_e5.push("&tnxId=",m.getQueryParameterByName("tnxid",url));_e5.push("&productCode=",_e3);_e5.push("&subProductCode=",_e4);_e5.push("&mode=",m.getQueryParameterByName("mode",url));_e5.push("&tnxTypeCode=",m.getQueryParameterByName("tnxtype",url));_e5.push("&subTnxTypeCode=",m.getQueryParameterByName("subTnxTypeCode",url));window.location=m.getServletURL("").replace(/.$/,"#")+_e5.join("");}else{window.location=url;}}},noSortOnSecondColumn:function(_e6){return Math.abs(_e6)!==2;},toggleExpandedList:function(id,_e7){d.query("#"+id+" li").forEach(function(l,i){if(i>=_e7){d.toggleClass(l,"hide");}});d.toggleClass(id+"_show","hide");d.toggleClass(id+"_hide","hide");},noSortOnThirdColumn:function(_e8){return Math.abs(_e8)!==3;},noSortOnFourthColumn:function(_e9){return Math.abs(_e9)!==4;},noSortOnFifthColumn:function(_ea){return Math.abs(_ea)!==5;},noSortOnSixthColumn:function(_eb){return Math.abs(_eb)!==6;},noSortOnSeventhColumn:function(_ec){return Math.abs(_ec)!==7;},noSortOnEighthColumn:function(_ed){return Math.abs(_ed)!==8;},noSortOnNinthColumn:function(_ee){return Math.abs(_ee)!==9;},noSortOnEleventhColumn:function(_ef){return Math.abs(_ef)!==11;},noSortOnThirteenthColumn:function(_f0){return Math.abs(_f0)!==13;},noSortOnThirdFourthAndFifthColumn:function(_f1){return Math.abs(_f1)!==3&&Math.abs(_f1)!==4&&Math.abs(_f1)!==5;},noSortOnAllColumns:function(_f2){return false;},noSortOnThirdAndSeventhColumn:function(_f3){return Math.abs(_f3)!==3&&Math.abs(_f3)!==7;},noSortOnLastColumn:function(_f4){return Math.abs(_f4)!==this.layout.cellCount;},noSortEnabledOnColumn:function(_f5){return this.noSortColumnIndex.indexOf(_f5)===-1;},noSortColumnConfiguredOnHeader:function(_f6){var _f7=this;var _f8="";if(_f7.structure.cells[0][_f6-1]){_f8=_f7.structure.cells[0][_f6-1];if(_f7.selectionMode&&(_f7.selectionMode==="single"||_f7.selectionMode==="multiple")){_f8=_f7.structure.cells[0][_f6-2];}}if(_f7.structure.cells[1]){_f8=_f7.structure.cells[1][_f6-2];if(_f7.selectionMode&&(_f7.selectionMode==="single"||_f7.selectionMode==="multiple")){_f8=_f7.structure.cells[1][_f6-3];}}if(_f8){if(_f8["sort"]&&_f8["sort"]==="false"){return false;}else{return true;}}else{return true;}},sortAmountColumn:function(a,b){var _f9=a;var _fa=b;if(!_f9||_f9==""||_f9==null){_f9=0;}else{_f9=_f9.replace(/\./g,"");_f9=_f9.replace("/ /g","");_f9=_f9.replace(/\,/g,"");_f9=parseFloat(_f9);}if(!_fa||_fa==""||_fa==null){_fa=0;}else{_fa=_fa.replace(/\./g,"");_fa=_fa.replace("/ /g","");_fa=_fa.replace(/\,/g,"");_fa=parseFloat(_fa);}if(_f9>_fa){return 1;}if(_f9<_fa){return -1;}return 0;},sortAccountNumberColumn:function(a,b){var _fb=a.substring(a.indexOf(">",1)+1,a.indexOf("<",1));var _fc=b.substring(b.indexOf(">",1)+1,b.indexOf("<",1));if(_fb>_fc){return -1;}if(_fb<_fc){return 1;}return 0;},sortFloatColumn:function(a,b){var _fd=parseFloat(a);var _fe=parseFloat(b);if((isNaN(_fd)&&isNaN(_fe))||(_fd===_fe)){return 0;}else{if(isNaN(_fd)||(_fd>_fe)){return 1;}else{return -1;}}},sortLinkColumn:function(a,b){var _ff=a.substring(a.indexOf(">",1)+1,a.indexOf("<",1));var _100=b.substring(b.indexOf(">",1)+1,b.indexOf("<",1));if(_ff>_100){return 1;}if(_ff<_100){return -1;}return 0;},sortLinkDateColumn:function(a,b){var _101=a.substring(a.indexOf(">",1)+1,a.indexOf("<",1));var _102=b.substring(b.indexOf(">",1)+1,b.indexOf("<",1));return m.grid.sortDateColumn(_101,_102);},formatDateTimeColumn:function(_103){if(!_103.match(/^[0-9]+$/i)){return _103;}else{var _104=eval(_103);console.warn("formatDateTimeColumn has been called!!");var _105=dojo.date.locale.format(new Date(_104),{datePattern:m.getLocalization("g_strGlobalDateFormat"),selector:"date"});return _105;}},sortCaseSensetiveColumn:function(a,b){var A=a.toLowerCase();var B=b.toLowerCase();if(A>B){return 1;}if(A<B){return -1;}return 0;},sortOnAnchorDescriptionCaseSensetive:function(a,b){var _106=document.createElement("div");_106.innerHTML=a;var _107=_106.innerText;_106.innerHTML=b;var _108=_106.innerText;return misys.grid.sortCaseSensetiveColumn(_107,_108);},sortDateColumn:function(a,b){var _109=m.getLocalization("g_strGlobalDateFormat");var _10a=d.date.locale.parse(a,{selector:"date",datePattern:_109});var _10b=d.date.locale.parse(b,{selector:"date",datePattern:_109});return d.date.compare(_10a,_10b);},sortFormatDateColumn:function(a,b){var _10c=m.getLocalization("g_strGlobalDateFormat");var _10d=m.grid.formatDate(a);var _10e=m.grid.formatDate(b);var _10f=d.date.locale.parse(_10d,{selector:"date",datePattern:_10c});var _110=d.date.locale.parse(_10e,{selector:"date",datePattern:_10c});return d.date.compare(_10f,_110);},getURL:function(_111,item){if(!item||!item.i[this.field]){return this.defaultValue;}if(!item.i[this.field+"_uri"]){return this.grid.store.getValue(item,this.field);}return {text:this.grid.store.getValue(item,this.field),href:this.grid.store.getValue(item,this.field+"_uri")};},getActions:function(_112,item){if(!item){return this.defaultValue;}return {href:this.grid.store.getValue(item,this.field+"_uri")};},deleteRecords:function(){m.concatCheckboxes(m.getLocalization("deleteTransactionsConfirmation"));},loadRecords:function(){var _113=0;d.query(".gridCheckbox").forEach(function(_114){if(d.attr(_114,"checked")){_113++;}});if(_113>0){m.concatCheckboxes(m.getLocalization("loadRecordsConfirmation",[_113]));}else{m.dialog.show("ERROR",m.getLocalization("noTemplateSelectedError"));}},submitRecords:function(){m.concatCheckboxes(m.getLocalization("submitTransactionsConfirmation"));},submitOpenAccount:function(){var _115=function(){dj.byId("dijit_form_Button_3").set("disabled",false);};var _116=[];d.query(".dojoxGrid").forEach(function(g){_116.push(dj.byId(g.id));});var _117=dj.byId("referenceid")?dj.byId("referenceid").get("value"):"";var _118=dj.byId("tnxid")?dj.byId("tnxid").get("value"):"";var url="/screen/AjaxScreen/action/RunPOGroupSubmission?s=PurchaseOrderScreen&operation=SUBMIT&option=PO_FOLDER&mode=DRAFT&tnxtype=01";if(_117){url+="&referenceid="+_117;}if(_118){url+="&tnxid="+_118;}m.grid.processRecords(_116,url);},saveOpenAccount:function(){var _119=[];d.query(".dojoxGrid").forEach(function(g){_119.push(dj.byId(g.id));});var _11a=dj.byId("referenceid")?dj.byId("referenceid").get("value"):"";var _11b=dj.byId("tnxid")?dj.byId("tnxid").get("value"):"";var url="/screen/AjaxScreen/action/RunPOGroupSubmission?s=PurchaseOrderScreen&operation=SAVE&option=PO_FOLDER&mode=DRAFT&tnxtype=01";if(_11a){url+="&referenceid="+_11a;}if(_11b){url+="&tnxid="+_11b;}m.grid.processRecords(_119,url);},submitBankerGuarantee:function(){var _11c=[];d.query(".dojoxGrid").forEach(function(g){_11c.push(dj.byId(g.id));});var _11d=dijit.byId("referenceid")?dijit.byId("referenceid").get("value"):"";var _11e=dijit.byId("tnxid")?dijit.byId("tnxid").get("value"):"";var url="/screen/AjaxScreen/action/RunGroupBGDelete?s=BankerGuaranteeScreen&operation=DELETE&option=PRODUCTS_MAINTENANCE";if(_11d){url+="&referenceid="+_11d;}if(_11e){url+="&tnxid="+_11e;}m.grid.processRecords(_11c,url);},selectFolderRow:function(grid,_11f,_120){var _121=[],_122=false,_123,_124,_125,_126;if(_11f.i._row_type===0){_123=_11f.n;if(_123&&_123!=null){_124=d.indexOf(m._config.groups,_123);if(_124>-1){_125=m._config.groups[_124]+1;_126=m._config.groups[_124+1];_122=_120[_123];m._config.folderTotals=m._config.folderTotals||{};m._config.folderTotals[_11f.i._group_id]=0;for(;_125<_126;_125++){grid.selection.setSelected(_125,_122);_121.push(grid.getItem(_125));}}else{console.error("[grid/_base] Problem finding group Id index",groupId," group row number array",m._config.groups);}}}else{if(_11f.i._row_type===1){_121.push(_11f);}}},selectUnsignedFolderRow:function(grid,_127,_128){var _129=d.isArray(_127)?_127:[_127];},groupRecords:function(){m.concatCheckboxes(m.getLocalization("deleteRoutingSummariesConfirmation"));},printRecords:function(grid,url){var _12a=grid.selection.getSelected().length;var _12b=grid.store._items.length;if(_12a>0&&_12b>0){m.dialog.show("CONFIRMATION",m.getLocalization("printTransactionsConfirmation",[grid.selection.getSelected().length]),"",function(){var _12c=d.isArray(grid)?grid:[grid],_12d=[],keys="",_12e=0,_12f,_130;d.forEach(_12c,function(grid){_12d=grid.selection.getSelected();if(_12d&&_12d.length){d.forEach(_12d,function(_131){_12f=grid.store.getValues(_131,"box_ref");if(keys!==""){keys+=", ";}keys+=_12f;_12e++;});}});var _132={"list_keys":keys};var form=new dijit.form.Form({method:"POST",action:m.getServletURL(url),content:_132},"submitForm");var _133=new dijit.form.SimpleTextarea({name:"list_keys",style:"width:auto;visibility:hidden;"},"list_keys");_133.set("value",keys);form.domNode.appendChild(_133.domNode);document.body.appendChild(form.domNode);form.domNode.appendChild(dijit.byId("token").domNode);form.submit();d.forEach(_12c,function(g){g.setStore(g.store);d.hitch(g,"render")();m.connect(g,"_onFetchComplete",function(){g.selection.clear();});});});}else{m.dialog.show("ERROR",m.getLocalization("noTransactionsSelectedError"));}},selectAllRecords:function(_134){var i;for(i=0;i<dj.byId(_134).rowCount;i++){dj.byId(_134).selection.addToSelection(i);}},deselectAllRecords:function(_135){dj.byId(_135).selection.deselectAll();},reloadDialogGridForSearchTerms:function(_136,_137){var form=dj.byId(_136),grid=dj.byId(_137),_138=/Date/,_139=/Time/,_13a="?",_13b,_13c;if(grid&&form){if(dojo.byId("divResults")){d.style("divResults","margin",0);}_13b=grid.get("store");misys.connect(grid,"_onFetchComplete",function(){setTimeout(function(){grid.resize();},500);});_13c=_13b.url;if(_13c.indexOf("?listdef=")!==-1){if(_13c.indexOf("&")!==-1){_13a=_13c.substring(_13c.indexOf("?listdef="),_13c.indexOf("&"))+"&";}else{_13a=_13c.substring(_13c.indexOf("?listdef="))+"&";}}if(_13c.indexOf("&fields=")!==-1){var _13d=_13c.substring(_13c.indexOf("fields="));if(_13d.indexOf("&")!==-1){_13d=_13d.substring(_13d.indexOf("fields="),_13d.indexOf("&"));}_13a+=_13d+"&";}form.getDescendants().forEach(function(_13e,i){if(_13e.name){if(i!==0){_13a+="&";}var _13f=_13e.get("value");if(_138.test(_13e.declaredClass)||(_139.test(_13e.declaredClass))){_13f=_13e.get("displayedValue");}if(_13f===" "){_13f="";}_13a+=_13e.get("name")+"="+encodeURIComponent(_13f);}});if(grid.selection&&grid.get("selectionMode")!==""){grid.selection.clear();}if(_13b.url.indexOf("?")!==-1){_13c=_13b.url.substring(0,_13b.url.indexOf("?"));}_13b.close();_13b.url=_13c+_13a;grid.setStore(_13b);}},formatOpenAccountProductType:function(_140,item){var type=dojo.isArray(item.type)?item.type[0]:item.type;var _141=dojo.isArray(item.type_label)?item.type_label[0]:item.type_label;var _142=dojo.isArray(item.other_type)?item.other_type[0]:item.other_type;return (type=="OTHR"?_142:_141);},showGroups:function(_143,_144){m.grid.toggleAllGroups(_143,true);d.style(d.byId("open"+_144),"display","none");d.style(d.byId("close"+_144),"display","inline");},hideGroups:function(_145,_146){m.grid.toggleAllGroups(_145,false);d.style(d.byId("close"+_146),"display","none");d.style(d.byId("open"+_146),"display","inline");},toggleAllGroups:function(node,_147){var grid=dj.byId(node);if(grid&&"expandedGroups" in grid){for(var i=1,_148=grid.rowCount;i<=_148;i++){grid.expandedGroups[i]=_147;}}grid.update();},toggleAllGroupsWithTimeOut:function(node,_149){var grid=dj.byId(node);if(grid&&"expandedGroups" in grid){for(var i=1,_14a=grid.rowCount;i<=_14a;i++){grid.expandedGroups[i]=_149;}}else{setTimeout(function(){if(grid&&"expandedGroups" in grid){for(var i=1,_14a=grid.rowCount;i<=_14a;i++){grid.expandedGroups[i]=_149;}}},1000);}grid.update();},getGroupHeader:function(_14b,item){if(!item){return "undefined";}this.grid.expandedGroups=this.grid.expandedGroups||[];var _14c=this.grid.store.getValue(item,"_group_id"),show=(typeof this.grid.expandedGroups[_14c]!=="undefined"&&!this.grid.expandedGroups[_14c]);m._config.groups=m._config.groups||[];m._config.groups.push(_14b);return {groupId:_14c,show:show,name:this.grid.store.getValue(item,"_group_name"),gridId:this.grid.id,rowIndex:_14b};},getGroupFooter:function(_14d,item){if(!item){return "undefined";}return {name:this.grid.store.getValue(item,"_group_name"),value:this.grid.store.getValue(item,"_group_footer"),gridId:this.grid.id};},formatGroupFooter:function(_14e,idx){if(_14e&&d.isObject(_14e)){if(_14e.name==="_root"){return d.string.substitute("<b>${value}</b>",_14e);}return d.string.substitute("<i>${value}</i>",_14e);}else{return _14e;}},formatGroupHeader:function(_14f){if(_14f&&d.isObject(_14f)){if(_14f.name==="_root"){return "";}_14f.image=_14f.show?"closed.gif":"open.gif";return d.string.substitute("<img src='"+m.getContextualURL("/content/images/${image}")+"' onclick='misys.grid.toggleGroup(${show}, \"${groupId}\","+"\"${gridId}\")' height='11' width='11'> ${name}",_14f);}else{return _14f;}},setGroupBeforeRow:function(_150,_151){var _152=_151[2],_153=0,_154=1,item,_155,_156,_157;_151[_153].hidden=false;_151[_154].hidden=false;if(_152){_151[2].hidden=false;}if(_150<0){_151[_153].hidden=true;_151[_154].hidden=false;if(_152){_151[2].hidden=true;}return;}item=this.grid.getItem(_150);if(item){_155=this.grid.store.getValue(item,"_group_id");_156=this.grid.store.getValue(item,"_row_type");_157=this.grid.store.getValue(item,"_group_name");if(_156===0){if(_157==="_root"){_151[_153].hidden=true;}else{_151[_153].hidden=false;}_151[_154].hidden=true;if(_152){_151[2].hidden=true;}}else{if(_156===1){_151[_153].hidden=true;if(typeof this.grid.expandedGroups[_155]!="undefined"&&!this.grid.expandedGroups[_155]){_151[_154].hidden=true;}else{_151[_154].hidden=false;}if(_152){_151[2].hidden=true;}}else{if(_156===2){_151[_153].hidden=true;_151[_154].hidden=true;if(_152){_151[2].hidden=false;}}}}}},toggleGroup:function(_158,_159,_15a){var grid=dj.byId(_15a);grid.expandedGroups[_159]=_158;grid.sizeChange();}});d.mixin(m,{redirectWithConfirmation:function(_15b,_15c){if(_15c){m.dialog.show("CONFIRMATION",_15c,"",function(){window.location.href=_15b;});}else{window.location.href=_15b;}},toggleHistoryButton:function(type){var _15d;if(type==="STANDARD"){_15d=d.position(dj.byId("threadHistoryButton").domNode).h;d.style(dj.byId("threadHistoryButton").domNode,"display","none");d.style(dj.byId("historyButton").domNode,"display","block");}else{_15d=d.position(dj.byId("historyButton").domNode).h;d.style(dj.byId("threadHistoryButton").domNode,"display","block");d.style(dj.byId("historyButton").domNode,"display","none");}d.style("historyButtons","height",_15d+"px");},concatCheckboxes:function(_15e,_15f,_160){var keys="",_161=0,_162,_163;if(_15f){_162=dj.byId("TransactionSearchForm");_163=dj.byId("RealForm");d.query(".gridCheckbox").forEach(function(_164){if(d.attr(_164,"checked")){if(keys.length!==0){keys+=", ";}keys+=_164.id;_161++;}});if(keys.length>0){dj.byId("list_keys").set("value",keys);if(_160==="dissociate"){_163.set("action",m.getServletURL("/screen/BankSystemFeaturesScreen?operation="+"REMOVE_CUSTOMER_AS_COUNTERPARTY&option=CUSTOMER_COUNTERPARTY"));}_163.submit();}}else{m.dialog.show("CONFIRMATION",_15e,"",function(){m.concatCheckboxes(_15e,true,_160);});}},showTransactionUsersDialog:function(_165,_166,_167){var node=d.query(".grid")[0],grid,_168;if(node){grid=dj.byId(node.id);_168=grid.focus.rowIndex;if(grid.selection.isSelected(_168)){grid.selection.deselect(_168);}else{grid.selection.setSelected(_168,true);}}m.showSearchDialog("User","",_165,"AjaxScreen/action/GetValidationUsersPopup",_166,"width:700px;height:600px;overflow:auto;",_167,"","GetValidationUsersList");},toggleSearchGrid:function(){var _169=d.byId("actionDown");var _16a=d.byId("actionUp");var _16b=d.byId("searchCriteria");if(d.style("searchCriteria","display")==="none"){m.animate("wipeIn",_16b);d.style("actionDown","display","none");d.style("actionUp","display","block");if(window.isAccessibilityEnabled){d.style("actionUp","cursor","default");}else{d.style("actionUp","cursor","pointer");}}else{m.animate("wipeOut",_16b);d.style("actionUp","display","none");d.style("actionDown","display","block");if(window.isAccessibilityEnabled){d.style("actionDown","cursor","default");}else{d.style("actionDown","cursor","pointer");}}}});})(dojo,dijit,misys);}