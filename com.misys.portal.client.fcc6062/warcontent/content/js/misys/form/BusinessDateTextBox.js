/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.form.BusinessDateTextBox"]){dojo._hasResource["misys.form.BusinessDateTextBox"]=true;dojo.provide("misys.form.BusinessDateTextBox");dojo.experimental("misys.form.BusinessDateTextBox");dojo.require("misys.calendar.BusinessDatesCalendar");dojo.require("dijit.form.DateTextBox");var _isError=false;var _status;function _currencyCode(){if(dijit.byId(misys.curCodeWidgetId)){return dijit.byId(misys.curCodeWidgetId).get("value");}else{return "";}};function _countryCode(){if(dijit.byId(misys.countryWidgetId)){return dijit.byId(misys.countryWidgetId).get("value");}else{return "";}};function _productCode(){if(dijit.byId(misys.productCodeWidgetId)){return dijit.byId(misys.productCodeWidgetId).get("value");}else{return "";}};function _subProductCode(){if(dijit.byId(misys.subProductCodeWidgetId)){return dijit.byId(misys.subProductCodeWidgetId).get("value");}else{return "";}};function _bankAbbvName(){if(dijit.byId(misys.bankAbbvNameWidgetId)){return dijit.byId(misys.bankAbbvNameWidgetId).get("value");}else{return "";}};dojo.declare("misys.form.BusinessDateTextBox",[dijit.form.DateTextBox],{curCodeWidgetId:"",countryWidgetId:"",productCodeWidgetId:"",subProductCodeWidgetId:"",bankAbbvNameWidgetId:"",bankAbbvNameDynamic:"",postCreate:function(){this.inherited(arguments);dojo.mixin(misys,{curCodeWidgetId:this.curCodeWidgetId,countryWidgetId:this.countryWidgetId,productCodeWidgetId:this.productCodeWidgetId,subProductCodeWidgetId:this.subProductCodeWidgetId,bankAbbvNameWidgetId:this.bankAbbvNameWidgetId});},popupClass:"misys.calendar.BusinessDatesCalendar",validate:function(_1){var _2=this.inherited(arguments);if(_2&&!_1){_status=this._fncGetDateStatus(this.get("value"));var _3;var _4=this.get("value");var _5="";if(_4){var _6=_4.getMonth();_6=_6+1;var _7=_4.getFullYear();var _8=_4.getDate();_5=_8+"/"+_6+"/"+_7;var _9=dijit.byId(this.id);if(this.required){if(!_isError){if(!_status){if(_9.get("state")!="Error"){_3=misys.getLocalization("dateIsHoliday",[_5]);_9.set("state","Error");dijit.hideTooltip(this.domNode);dijit.showTooltip(_3,this.domNode,0);}}}else{if(_9.get("state")!="Error"){_3=misys.getLocalization("holidayValidateError",[_5]);_9.set("state","Error");dijit.hideTooltip(this.domNode);dijit.showTooltip(_3,this.domNode,0);}}}}}return _2;},_fncGetDateStatus:function(_a){if(!_a){return false;}var _b=true;var _c=_a;var _d=_c.getMonth();_d=_d+1;var _e=_c.getFullYear();var _f=_c.getDate();var _10=_f+"/"+_d+"/"+_e;misys.xhrPost({url:misys.getServletURL("/screen/AjaxScreen/action/GetDateStatus"),sync:true,handleAs:"json",content:{productCode:misys._config.productCode,subProductCode:_subProductCode(),currencyCode:_currencyCode(),countryCode:_countryCode(),bankAbbvName:_bankAbbvName(),date:_10},load:function(_11,_12){var _13=_11.closingDayResult;_isError=false;if(_13==false){_b=true;}else{_b=false;}},customError:function(_14,_15){console.error("[misys.Calendar.DateTextBox] Technical error while getting valid business day ");console.error(_14);_isError=true;}});return _b;}});}