/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.purchaseorder.FormPurchaseOrderEvents"]){dojo._hasResource["misys.purchaseorder.FormPurchaseOrderEvents"]=true;dojo.provide("misys.purchaseorder.FormPurchaseOrderEvents");(function(d,dj,m){var _1=function(_2){if(d.isString(_2)){return d.currency.parse(_2);}return _2;};var _3=function(){var _4=dj.byId("fake_total_amt").get("value");var _5=_1(_4);if(_5>=0){dj.byId("total_net_amt").set("value",_5);dj.byId("lc_amt").set("value",_5);}else{dj.byId("total_net_amt").set("value","");}};var _6=function(){var _7=dj.byId("line_item_total_amt").get("value");if("S"+_7=="S"){return;}var _8=_1(_7);if(_8<0){_8=0;}if(dj.byId("line_item_total_net_amt")){dj.byId("line_item_total_net_amt").set("value",_8);}m.computePOTotalAmount();};var _9=function(){dj.byId("line-items").clear();dj.byId("fake_total_cur_code").set("value","");dj.byId("total_net_cur_code").set("value","");};d.mixin(m,{toggleDisableButtons:function(){if(dj.byId("po_activated")&&dj.byId("po_activated").checked){if(dj.byId("lc_cur_code").get("value")!==""){var _a=dj.byId("po_activated");var _b=dj.byId("line-items");if(_b&&_b.addButtonNode&&_a){_b.addButtonNode.set("disabled",_a.get("value")===false);}dj.byId("lc_amt").set("readOnly",true);}else{misys.dialog.show("ERROR",misys.getLocalization("purchaseOrderCurrencyMustError"));dj.byId("po_activated").set("checked",false);}}else{_a=dj.byId("po_activated");_b=dj.byId("line-items");if(_b&&_b.addButtonNode&&_a){_b.addButtonNode.set("disabled",_a.get("value")===false);}if(dj.byId("lc_amt")){dj.byId("lc_amt").set("readOnly",false);}}},saveOldPOCurrency:function(){var _c=dj.byId("lc_cur_code");var _d=_c.get("value");_c.set("old_value",_d);},managePOCurrency:function(){if(dj.byId("lc_cur_code")){var _e=dj.byId("lc_cur_code").get("value");var _f=dj.byId("lc_cur_code").get("old_value");}if(_e===""){if(_f){misys.dialog.show("CONFIRMATION",misys.getLocalization("resetCurrencyConfirmation"),"",_9);misys.connect(dj.byId("cancelButton"),"onClick",function(){dj.byId("lc_cur_code").set("value",_f);});}}else{dj.byId("fake_total_cur_code").set("value",_e);dj.byId("total_net_cur_code").set("value",_e);if(dj.byId("tnx_cur_code")){dj.byId("tnx_cur_code").set("value",_e);}if(dj.byId("liab_total_cur_code")){dj.byId("liab_total_cur_code").set("value",_e);}if(dj.byId("total_net_inv_cur_code")){dj.byId("total_net_inv_cur_code").set("value",_e);}if(dj.byId("order_total_cur_code")){dj.byId("order_total_cur_code").set("value",_e);}if(dj.byId("accpt_total_cur_code")){dj.byId("accpt_total_cur_code").set("value",_e);}if(dj.byId("outstanding_total_cur_code")){dj.byId("outstanding_total_cur_code").set("value",_e);}if(dj.byId("pending_total_cur_code")){dj.byId("pending_total_cur_code").set("value",_e);}if(dj.byId("order_total_net_cur_code")){dj.byId("order_total_net_cur_code").set("value",_e);}if(dj.byId("accpt_total_net_cur_code")){dj.byId("accpt_total_net_cur_code").set("value",_e);}if(dj.byId("outstanding_total_net_cur_code")){dj.byId("outstanding_total_net_cur_code").set("value",_e);}if(dj.byId("pending_total_net_cur_code")){dj.byId("pending_total_net_cur_code").set("value",_e);}}},checkLineItemsCurrencyTotalCurrency:function(){var _10=misys.getLocalization("resetInvoicePayableCurrency");var _11=this,_12=false,_13;var _14=dj.byId("line-items");if(_14&&_14.store&&_14.store!=null&&_14.store._arrayOfAllItems.length>0){if(_14.grid&&_14.grid.store){_14.grid.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(this,function(_15,_16){d.some(_15,function(_17){var _18=_17;if(_18!==null&&_18.price_cur_code!=_11.get("value")){_12=true;_13=_18.price_cur_code;return false;}});if(_12){var _19=function(){d.forEach(_15,function(_1a){_14.grid.store.setValue(_1a,"price_cur_code",dj.byId("lc_cur_code").get("value"));_14.grid.store.setValue(_1a,"lc_cur_code",dj.byId("lc_cur_code").get("value"));_14.grid.store.setValue(_1a,"total_net_cur_code",dj.byId("lc_cur_code").get("value"));_14.grid.store.setValue(_1a,"total_cur_code",dj.byId("lc_cur_code").get("value"));},_14);_14.grid.store.save();setTimeout(function(){_14.renderSections();_14.grid.render();},200);};var _1b=function(){dj.byId("lc_cur_code").set("value",_13);};m.dialog.show("CONFIRMATION",_10,"","","","",_19,_1b);}})});}}},getTotalNetAmount:function(_1c,_1d){var _1e="";if(_1d&&_1d.total_net_amt!==""){if(typeof _1d.total_net_amt[0]==="string"){_1e=_1d.total_net_amt;}else{if(typeof _1d.total_net_amt[0]==="number"&&isFinite(_1d.total_net_amt[0])){_1e=dojo.currency.format(_1d.total_net_amt,{currency:dj.byId("line_item_total_net_cur_code").get("value")});_1e=_1e.replace(/[A-Za-z]+/g,"");}}}return _1e;},getQuantity:function(_1f,_20){var _21="";if(_20){var _22=_20.qty_unit_measr_label[0];var _23=_20.qty_val[0];_21=_23+" "+_22;}return _21;},getPriceAmount:function(_24,_25){var _26="";if(_25&&_25.price_amt!==""){if(typeof _25.price_amt[0]==="string"){_26=_25.price_amt;}else{if(typeof _25.price_amt[0]==="number"&&isFinite(_25.price_amt[0])){_26=dojo.currency.format(_25.price_amt,{currency:dj.byId("line_item_price_cur_code").get("value")});_26=_26.replace(/[A-Za-z]+/g,"");}}}return _26;},getPaymentType:function(_27,_28){var _29="";var _2a="";if(_28){if(_28.nb_days!==""){_2a=" (+"+_28.nb_days+" "+m.getLocalization("paymentDays")+")";}if(_28.code!==""){_29=_28.label+_2a;}else{if(_28.other_paymt_terms!==""){_29=_28.other_paymt_terms+_2a;}}}return _29;},getContactName:function(_2b,_2c){var _2d="";if(_2c){return m.getLocalization(_2c.name_prefix)+" "+_2c.name_value;}return _2d;},getPaymentAmountRate:function(_2e,_2f){var _30="";if(_2f){if(_2f.pct!==""){_30="+"+_2f.pct+"%";}else{if(_2f.amt!==""){if(typeof _2f.amt[0]==="string"){_30="+"+_2f.amt;}else{if(typeof _2f.amt[0]==="number"&&isFinite(_2f.amt[0])){_30="+"+dojo.currency.format(_2f.amt);}}}}}return _30;},getAmountRate:function(_31,_32){var _33="";if(_32){if(_32.rate!==""){_33="+"+_32.rate+"%";}else{if(_32.amt!==""){if(typeof _32.amt[0]==="string"){_33="+"+_32.amt;}else{if(typeof _32.amt[0]==="number"&&isFinite(_32.amt[0])){_33="+"+dojo.currency.format(_32.amt,{currency:dj.byId("adjustment_cur_code").get("value")});_33=_33.replace(/[A-Za-z]+/g,"");}}}}}return _33;},computeLineItemAmount:function(){var _34=dj.byId("line_item_total_cur_code").get("value");var _35=dj.byId("line_item_qty_val").get("value");var _36=dj.byId("line_item_qty_unit_measr_code").get("value");var _37=dj.byId("line_item_price_unit_measr_code").get("value");var _38=dj.byId("line_item_price_amt").get("value");var _39=dj.byId("line_item_total_amt").get("value");if(_38&&_35){_39=(_35*_38);if(_39.toString().split(".")[0].length>13){m.dialog.show("ERROR",m.getLocalization("lineItemNetAmountOutOfRange"));dj.byId("line_item_total_amt").set("value","");return;}dj.byId("line_item_total_amt").set("readonly",true);}else{_39="";dj.byId("line_item_total_amt").set("readonly",false);}dj.byId("line_item_total_amt").set("value",_39);_6();},fncUpdateDescriptionOfGoods:function(){var _3a=dj.byId("line-items");if(_3a&&_3a.store&&_3a.store!=null&&_3a.store._arrayOfAllItems.length>0){dj.byId("narrative_description_goods").set("value","");_3a.grid.store.fetch({query:{store_id:"*"},onComplete:d.hitch(this,function(_3b,_3c){for(var _3d in _3b){var _3e=_3b[_3d];var _3f=_3e.total_cur_code;var _40=_3e.qty_val;var _41=_3e.qty_unit_measr_code;var _42=_3e.price_unit_measr_code;var _43=_3e.price_amt;var _44=_3e.product_name;if(_3e.product_name){_44=dojox.html.entities.decode(String(_3e.product_name),dojox.html.entities.html);}var _45="";var _46="";if((_3e.qty_tol_pstv_pct)&&(_3e.qty_tol_pstv_pct)!==""&&!isNaN(_3e.qty_tol_pstv_pct)){_45="(Tolerance: +"+_3e.qty_tol_pstv_pct+")";}if((_3e.qty_tol_neg_pct)&&(_3e.qty_tol_neg_pct)!==""&&!isNaN(_3e.qty_tol_neg_pct)){_46="(Tolerance: -"+_3e.qty_tol_neg_pct+")";}if(_40&&_41&&_42&&_43&&_44){var _47=dj.byId("narrative_description_goods").get("value");var _48=_47+"\n\r+"+_40+"  "+_41+" of "+_44+"\n\r"+_45+_46+" at "+_43+" "+_3f+" per "+_42;dj.byId("narrative_description_goods").set("value",_48);}}})});}},computePOTotalAmount:function(){var _49=0;var _4a=dj.byId("line-items");if(_4a&&_4a.grid){_4a.grid.store.fetch({query:{store_id:"*"},onComplete:d.hitch(this,function(_4b,_4c){for(var _4d in _4b){var _4e=_4b[_4d];var _4f=dojo.isArray(_4e.total_net_amt)?_4e.total_net_amt[0]:_4e.total_net_amt;_49=_1(_49)+_1(_4f);}})});}if(_49>0){dj.byId("fake_total_amt").set("value",_49);dj.byId("lc_amt").set("value",_49);_3();}else{if(_49===0){dj.byId("fake_total_amt").set("value","0");dj.byId("total_net_amt").set("value","0");}else{dj.byId("fake_total_amt").set("value","");dj.byId("total_net_amt").set("value","");}}}});})(dojo,dijit,misys);}