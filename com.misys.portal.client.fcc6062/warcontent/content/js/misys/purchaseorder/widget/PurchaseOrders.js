/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.purchaseorder.widget.PurchaseOrders"]){dojo._hasResource["misys.purchaseorder.widget.PurchaseOrders"]=true;dojo.provide("misys.purchaseorder.widget.PurchaseOrders");dojo.require("misys.grid.GridMultipleItems");dojo.require("misys.purchaseorder.widget.PurchaseOrder");dojo.require("misys.purchaseorder.FormPurchaseOrderEvents");dojo.require("misys.validation.common");dojo.declare("misys.purchaseorder.widget.PurchaseOrders",[misys.grid.GridMultipleItems],{data:{identifier:"store_id",label:"store_id",items:[]},templatePath:null,templateString:dojo.byId("line-item-template").innerHTML,dialogId:"line-item-dialog-template",dialogAddItemTitle:misys.getLocalization("line-item-dialog"),xmlTagName:"lineItems",xmlSubTagName:"lineItem",gridColumns:["cust_ref_id","line_item_number","product_name","qty_val","qty_unit_measr_code","qty_unit_measr_label","qty_tol_pstv_pct","qty_tol_neg_pct","price_unit_measr_code","price_unit_measr_label","price_other_unit_measr","price_cur_code","price_amt","price_tol_pstv_pct","price_tol_neg_pct","total_cur_code","total_amt","total_net_cur_code","total_net_amt","qty_other_unit_measr","po_reference","ref_id"],propertiesMap:{cust_ref_id:{_fieldName:"line_item_nb"},po_reference:{_fieldName:"line_item_po_reference"},line_item_number:{_fieldName:"line_item_nb"},product_name:{_fieldName:"line_item_product_name"},qty_unit_measr_code:{_fieldName:"line_item_qty_unit_measr_code"},qty_unit_measr_label:{_fieldName:"line_item_qty_unit_measr_label"},qty_other_unit_measr:{_fieldName:"line_item_qty_unit_measr_other"},qty_val:{_fieldName:"line_item_qty_val"},qty_tol_pstv_pct:{_fieldName:"line_item_qty_tol_pstv_pct"},qty_tol_neg_pct:{_fieldName:"line_item_qty_tol_neg_pct"},price_unit_measr_code:{_fieldName:"line_item_price_unit_measr_code"},price_unit_measr_label:{_fieldName:"line_item_price_unit_measr_label"},price_other_unit_measr:{_fieldName:"line_item_price_other_unit_measr"},price_cur_code:{_fieldName:"line_item_price_cur_code"},price_amt:{_fieldName:"line_item_price_amt"},price_tol_pstv_pct:{_fieldName:"line_item_price_tol_pstv_pct"},price_tol_neg_pct:{_fieldName:"line_item_price_tol_neg_pct"},total_cur_code:{_fieldName:"line_item_total_cur_code"},total_amt:{_fieldName:"line_item_total_amt"},total_net_cur_code:{_fieldName:"line_item_total_net_cur_code"},total_net_amt:{_fieldName:"line_item_total_net_amt"},ref_id:{_fieldName:"ref_id"}},layout:[{name:"Number",field:"qty_val",width:"15%"},{name:"Unit Measure",get:misys.getUnitMesureLocalization,width:"15%"},{name:"Description",field:"product_name",width:"40%"},{name:"Amount",get:misys.getPriceAmount,width:"12%",classes:"align-right"},{name:"Currency",field:"price_cur_code",width:"8%",classes:"align-center"},{name:" ",field:"actions",formatter:misys.grid.formatReportActions,width:"10%"},{name:"Id",field:"store_id",headerStyles:"display:none",cellStyles:"display:none"}],mandatoryFields:["product_name","qty_unit_measr_code","qty_val","price_amt"],startup:function(){this.inherited(arguments);},openDialogFromExistingItem:function(_1,_2){if(_1&&_1[0]&&_1[0].product_name&&_1[0].product_name[0]){_1[0].product_name[0]=dojox.html.entities.decode(_1[0].product_name[0],dojox.html.entities.html);}this.inherited(arguments);},resetDialog:function(_3,_4){this.inherited(arguments);if(dijit.byId("lc_cur_code")){var _5=dijit.byId("lc_cur_code").get("value");dijit.byId("line_item_total_cur_code").set("value",_5);dijit.byId("line_item_price_cur_code").set("value",_5);dijit.byId("line_item_total_net_cur_code").set("value",_5);}},createDataGrid:function(){this.inherited(arguments);var _6=this.grid;misys.connect(_6,"onSet",misys.computeLineItemAmount);misys.connect(_6,"onNew",misys.computeLineItemAmount);misys.connect(_6.store,"onSet",function(){misys.fncUpdateDescriptionOfGoods();});misys.connect(_6.store,"onNew",function(){misys.fncUpdateDescriptionOfGoods();});misys.connect(_6,"onDelete",function(){misys.dialog.connect(dijit.byId("okButton"),"onMouseUp",function(){setTimeout(function(){dojo.hitch(misys,"computeLineItemAmount");if(misys._config._hasLineItemShipmentDate){misys._config._hasLineItemShipmentDate();}misys.computePOTotalAmount();misys.fncUpdateDescriptionOfGoods();},1000);},"alertDialog");});},addItem:function(_7){this.inherited(arguments);},updateData:function(_8){this.inherited(arguments);misys.computePOTotalAmount();if(misys._config._hasLineItemShipmentDate){misys._config._hasLineItemShipmentDate();}},performValidation:function(){if(this.validateDialog(true)){this.inherited(arguments);}},itemToXML:function(_9,_a){var _b=[];dojo.forEach(_9,function(_c){if(_c){if(_a){_b.push("<",_a,">");}for(var _d in _c){var _e=dojo.isArray(_c[_d])?_c[_d][0]:_c[_d];if(dojo.isObject(_e)&&_e._type){var _f=_e._type;var _10=dojo.eval(_f);var _11=new _10({});_b.push("<",_11.xmlTagName,">");_b.push(this.itemToXML(_e._values,_11.xmlSubTagName,_b));_b.push("</",_11.xmlTagName,">");}else{if(_d!="store_id"&&_d.match("^_")!="_"){_e=dojo.isArray(_c[_d])?_c[_d][0]:_c[_d];_e+="";_b.push("<",_d,">",_e,"</",_d,">");}}}if(_a){_b.push("</",_a,">");}}},this);return _b.join("");}});}