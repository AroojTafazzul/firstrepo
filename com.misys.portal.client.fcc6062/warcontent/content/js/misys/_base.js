/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys._base"]){dojo._hasResource["misys._base"]=true;dojo.provide("misys._base");dojo.require("dojo.parser");dojo.require("dijit.dijit");dojo.require("misys.widget.Dialog");dojo.require("dijit.Tooltip");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.Form");dojo.require("dijit.form.Button");dojo.require("dijit.form.CheckBox");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.ValidationTextBox");(function(d,dj,m){var _1=".widgetContainer",_2=".form",_3="focusonerror",_4="notready",_5="ready",_6=["alertDialog","xhrDialog","extDialog","collaborationWindow"],_7=1000,_8=2000,_9=50,_a=function(p1,p2){var _b=d.byId("MenuBuilder"),_c=d.query(".breadcrumb"),_d=6,_e;if(_c.length===1){if(!_b){_e=d.query(".col2");if(_e.length===1){_d=0;_b=_e[0];}}if(_b){d.style(_c[0],"width",(d.position(_b).w+_d)+"px");}}m.bind();if(m.client){if(m.client.registerValidations){m.client.registerValidations();}if(m.client.connectEventHandlers){m.client.connectEventHandlers();}}if(m._config.displayMode!=="view"){m.onFormLoad();if(m.client&&m.client.prepareScreen){m.client.prepareScreen();}}d.removeClass(d.body(),_4);setTimeout(function(){p1();},_7);setTimeout(function(){p2();d.publish("callbacksReady");},_8);},_f={error:function(_10,_11){switch(_11.xhr.status){case 401:if(dj.byId&&m.dialog){m.dialog.show("ERROR",m.getLocalization("authenticationError"));}break;default:if(this.customError){this.customError.apply(this,arguments);}break;}}},_12;function _13(_14,_15,_16){_14.invalidMessage=_14.messages.invalidMessage;if(!_14.validator(_14.textbox.value,_14.constraints)){return false;}var _17=(_14.state==="Error")?false:true;if((_15&&!_17)||!_15){return d.hitch(_14,_16)();}return _17;};function _18(_19){var _1a=false;if(window.isAccessibilityEnabled){_1a=true;}var _1b=new misys.widget.Dialog({id:"alertDialog",refocus:_1a,draggable:false,"class":"dialog"}),_1c=new misys.widget.Dialog({id:"xhrDialog",refocus:_1a,draggable:false}),_1d=new misys.widget.Dialog({id:"extDialog",refocus:_1a,draggable:false,"class":"narrativePaneContent"}),_1e=d.create("div"),_1f=d.create("div",{id:"dialogButtons","class":"dijitDialogPaneActionBar"});d.place(d.create("div",{id:"alertDialogContent"}),_1e);new dijit.ProgressBar({id:"dialogProgressBar",indeterminate:true}).placeAt(_1e);new dijit.form.Button({id:"okButton",label:m.getLocalization("okMessage")}).placeAt(_1f);new dijit.form.Button({id:"cancelButton",label:m.getLocalization("cancelMessage")}).placeAt(_1f);d.place(_1f,_1e);_1b.set("content",_1e);if(_19==="extDialog"){return _1d;}return _19==="alertDialog"?_1b:_1c;};function _20(_21){var _22=[];for(var i=1,len=_21.length;i<=len;i++){var _23=d.doc.createElement("input");d.attr(_23,"dojoType","dijit.form.RadioButton");_23.id="MulChoiceRadioBtn_"+i;_23.name="MulChoiceRadioBtn";_23.type="radio";_23.value="";var _24=d.doc.createElement("span");d.addClass(_24,"dialogLabelCheckBtn");_24.appendChild(_23);_24.innerHTML+=_21[i-1];var div=d.doc.createElement("div");div.id="MulChoiceRadio_row_"+i;d.addClass(div,"field");d.addClass(div,"radio");d.style(div,"margin-left","40px");div.appendChild(_24);_22.push(div);}return _22;};function _25(obj){var _26="&productCode=";var _27="&subProductCode=";var url=[];if(obj.mode==="DRAFT"){url.push("/productScreen?");url.push("refId=",obj.referenceid);url.push("&tnxId=",obj.tnxid);url.push(_26,obj.productcode);url.push(_27,obj.subproductcode);url.push("&tnxTypeCode=",obj.tnxtype);url.push("&mode=",obj.mode);url.push("&subTnxTypeCode=",obj.subtnxtype);}else{if(obj.mode==="UNSIGNED"){url.push("/reviewScreen?");url.push("referenceid=",obj.referenceid);url.push("&tnxid=",obj.tnxid);url.push(_26,obj.productcode);url.push(_27,obj.subproductcode);url.push("&mode=","view");url.push("&action=","approve");url.push("&operation=","LIST_INQUIRY");}else{if(obj.option==="HISTORY"){url.push("/reviewScreen?");url.push("referenceid=",obj.referenceid);url.push("&tnxid=",obj.tnxid);url.push(_26,obj.productcode);url.push(_27,obj.subproductcode);url.push("&mode=","view");url.push("&operation=",obj.operation);}}}window.open(m.getServletURL("").replace(/.$/,"#")+url.join(""),"_self");};d.mixin(m,{connections:[],connectionsById:{},onLoad:function(){return this._onLoad();},_onLoad:function(_28,_29){var _2a=document.getElementsByTagName("body")[0];_2a.style.display="block";var p1=_28||function(){},p2=_29||function(){};_12=d.subscribe(_5,function(){_a.call(this,p1,p2);d.unsubscribe(_12);});return this.parseWidgets();},parseWidgets:function(_2b){var _2c=_2b||_1,_2d=d.query(_2c),_2e=(_2d.length>0)?_2d:[0],len=_2e.length,_2f=new dojo.Deferred;d.forEach(_2e,function(_30,i){setTimeout(function(){d.parser.parse(_30);if(i>=(len-1)){try{d.parser.instantiate(d.query(_2));}catch(err){console.warn("An error occurred instantiating the page form.");console.warn("Note that forms should *not* be inside .widgetContainer ","<div>s, otherwise they will be instantiated *twice*");console.warn(err);}d.publish(_5);_2f.callback(true);}},i*_9);});return _2f;},connect:function(_31,_32,_33,_34){var _35=dj.byId(_31)||d.byId(_31),_36,_37;if(_35&&d.attr(_35,"type")!=="hidden"){_36=(_35.declaredClass)?_32:_32.toLowerCase();_37=d.connect(_35,_36,_33,_34);this.connections.push(_37);if(_35.id&&this.connectionsById){this.connectionsById[_35.id]=this.connectionsById[_35.id]||[];this.connectionsById[_35.id].push(_37);}}else{console.warn("[misys._base] Event binding failed for page element",_31);}return _37;},disconnect:function(_38){d.disconnect(_38);},disconnectById:function(_39){var _3a=dj.byId(_39)||d.byId(_39);if(_3a&&_3a.id){d.forEach(m.connectionsById[_3a.id],function(_3b){d.disconnect(_3b);});}},setValidation:function(_3c,fnc,_3d){var _3e=dj.byId(_3c);if(_3e&&_3e.get("type")!="hidden"){_3e.set(_3,true);var _3f=(_3d)?fnc:function(_40){return _13(_3e,_40,fnc);};_3e.isValid=_3f;if(/Select/.test(_3e.declaredClass)){m.connect(_3c,"onChange",function(){this.validate();});}}else{console.warn("[misys._base] Validation binding failed for page element",_3c);}},setLocalization:function(key,_41){m._config=m._config||{};if(!m._config.localization){m._config.localization=d.i18n.getLocalization(m._config.client,"common");}m._config.localization[key]=_41;},getLocalization:function(key,_42){var _43="";var str="";m._config=m._config||{};if(!m._config.localization){m._config.localization=d.i18n.getLocalization(m._config.client,"common");}if(!m._config.clientLocalization){m._config.clientLocalization=d.i18n.getLocalization(m._config.client,"client");}if(m._config.bankSpecificLocalizationEnabled==="true"){_43=m._config.bankAbbvNamePrefix+"-"+key;str=m._config.clientLocalization[_43]?m._config.clientLocalization[_43]:(m._config.localization[_43]?m._config.localization[_43]:(m._config.clientLocalization[key]?m._config.clientLocalization[key]:(m._config.localization[key]||"")));if(m._config.showKey==="true"&&key.substring(0,2)!=="g_"){str=_43?_43:key;}}else{str=m._config.clientLocalization[key]||"";if(str===""||str==null||str==undefined){str=m._config.localization[key]||"";}if(m._config.showKey==="true"&&key.substring(0,2)!=="g_"){str=key;}}return _42?d.string.substitute(str,_42):str;},xhrGet:function(_44){var _45={handleAs:"json",contentType:"application/json; charset=utf-8",preventCache:true};return d.xhrGet(d.mixin(_45,_f,_44));},xhrPost:function(_46){if(document.getElementById("_token")&&_46.form!=="popup_realform"&&_46.url.indexOf("AsyncScreen")==-1){_46.content=_46.content||{};d.mixin(_46.content,{token:document.getElementById("_token").getAttribute("value")});}var _47={};if(_46&&_46.content&&_46.content.fields){if(_46.content.fields.indexOf("%5B")>-1&&_46.content.fields.indexOf("%5D")>-1){}else{_46.content.fields=encodeURI(_46.content.fields);}}return d.xhrPost(d.mixin(_47,_f,_46));},animate:function(_48,_49,_4a,_4b,_4c,_4d){var _4e=dojo.fx.chain([]);if(_49){var _4f=d.isArray(_49)?_49:[d.byId(_49)],_50=d[_48]||d.fx[_48],_51={duration:500,display:"block"},_52=[],_53=function(){d.forEach(_4f,function(_54){if(_54){d.style(_54,"display",_51.display);}});};if(!_50){console.warn("[misys._base] Animation type",_48,"is not supported!","We only support fadeIn, fadeOut, wipeIn, wipeOut.","(you tried to animate node",_49,")");return _4e;}if(_4a&&!d.isFunction(_4a)){_4b=_4a;_4a=null;}_51=(_4c)?d.mixin(_51,_4c):_51;switch(_48){case "fadeIn":d.mixin(_51,{beforeBegin:_53});break;case "fadeOut":_51.display="none";d.mixin(_51,{onEnd:_53});break;case "wipeOut":_51.display="none";d.mixin(_51,{onEnd:_53});break;default:break;}d.forEach(_4f,function(_55){if(_55){if(d.isIE<=7&&!_4d){d.style(_55,"display",_51.display);d.style(_55,"filter","opacity(0)");d.style(_55,"filter","opacity(50)");d.forEach(d.query("> Div",_55),function(_56){if(_56&&_56.id&&_56.id!==""){d.byId(_56.id).style.filter="opacity(0)";d.byId(_56.id).style.filter="opacity(50)";}});}else{_52.push(_50(d.mixin(_51,{node:_55})));}}});if(d.isIE<=7&&!_4d){if(_4a&&d.isFunction(_4a)){_4a();}}else{_4e=d.fx.chain(_52);if(_4a&&d.isFunction(_4a)){d.connect(_4e,"onEnd",_4a);}if(!_4b){_4e.play();}}}return _4e;},getContextualURL:function(url){if(!this._config||this._config.context==null){console.warn("Unable to format a contextual URL for",url);throw {name:"InitializationError",message:"misys.getContextualURL has been called "+"before misys._config has been fully instantiated"};}var _57=d.trim(url);if(_57.indexOf("/")!==0){_57="/"+_57;}_57=this._config.context+_57;_57=(_57.indexOf("//")===0)?_57.substr(1):_57;return _57;},getServletURL:function(url){if(!this._config||this._config.context==null||this._config.servlet==null){console.warn("Unable to format a servlet URL for",url);throw {name:"InitializationError",message:"misys.getServletURL has been called "+"before misys._config has been fully instantiated"};}var _58=d.trim(url);if(_58.indexOf("/")!==0){_58="/"+_58;}_58=this._config.context+this._config.servlet+_58;_58=(_58.indexOf("//")===0)?_58.substr(1):_58;return _58;},bind:function(){},onFormLoad:function(){},beforeSubmit:function(){},_getFieldsInError:function(_59){var id=_59||"fakeform1",_5a=dj.byId(id),_5b=[];if(_5a){d.forEach(_5a.getDescendants(),function(w){if(w.state==="Error"){_5b.push(w);}});if(_5b.length>0){d.forEach(_5b,function(w){});return;}}return;},dialog:{connections:{},isActive:false,connect:function(_5c,_5d,_5e,_5f){var obj=dj.byId(_5c)||d.byId(_5c),_60=(_5f)?_5f:obj.id,_61,_62;if(obj&&d.attr(obj,"type")!=="hidden"){_61=(obj.declaredClass)?_5d:_5d.toLowerCase();_62=d.connect(obj,_61,null,_5e);if(!this.connections[_60]){this.connections[_60]=[];}this.connections[_60].push(_62);if(obj.id&&this.connectionsById){this.connectionsById[obj.id]=this.connectionsById[obj.id]||[];this.connectionsById[obj.id].push(_62);}}else{console.warn("[misys._base] Event binding failed for page element",obj);}return _62;},disconnect:function(_63){var _64=dj.byId(_63);if(_64){var _65=_64.id;if(this.connections[_65]&&this.connections[_65].length>0){d.forEach(this.connections[_65],d.disconnect);this.connections[_65]=[];}}},show:function(_66,_67,_68,_69,_6a,url,_6b,_6c,_6d){_66=_66.toUpperCase();if(_66==="EXTENDED-VIEW"){var _6e="extDialog",_6f=dj.byId(_6e)||_18(_6e);}else{_6e=(_66!=="HTML"&&_66!=="URL")?"alertDialog":"xhrDialog";_6f=dj.byId(_6e)||_18(_6e);}var _70=d.byId("dialogProgressBar"),_71=d.byId("dialogButtons"),_72=dj.byId("cancelButton").domNode,_73=d.byId("alertDialogContent");d.style(_70,"display","none");d.style(_70,"visibility","hidden");d.style(_71,"display","block");d.style(_72,"display","inline-block");d.toggleClass(_73,"errorDialog",_66==="ERROR");d.toggleClass(_73,"informationDialog",(_66!=="ERROR"&&_66!=="PROGRESS"));var _74=body.style;_74.overflow="hidden";switch(_66){case "ALERT":_68=m.getLocalization("alertMessage");break;case "ERROR":_68=m.getLocalization("errorMessage");d.style(_72,"display","none");break;case "CONFIRMATION":_68=m.getLocalization("confirmationMessage");break;case "PROGRESS":_68=m.getLocalization("progressMessage");d.style(_73,"height","auto");d.style(_70,"display","block");d.style(_70,"visibility","visible");d.style(_71,"display","none");break;case "URL":undefined;_6f.set("ioMethod",misys.xhrPost);_6f.set("ioArgs",{content:_6d});_6f.set("href",url);break;case "HTML":undefined;_6f.set("content",_67);break;case "EXTENDED-VIEW":undefined;_6f.set("content",_67);break;case "CUSTOM-NO-CANCEL":d.style(_72,"display","none");break;case "DATE-CONFLICT":_68=m.getLocalization("dateConflictMessage");d.style(_72,"display","none");break;default:_68=m.getLocalization("alertMessage");break;}_6f.set("title",_68);if(_66!=="URL"&&_66!=="HTML"&&_66!=="EXTENDED-VIEW"){_73.innerHTML=_67;d.style(_73,"height","auto");d.style(_73,"width","auto");}m.dialog.cancelCalled=false;if(_66!=="PROGRESS"&&_66!=="URL"){m.dialog.connect(dj.byId("okButton"),"onMouseUp",function(){if(_6b){if(m.unloadListener){window.onbeforeunload=m.unloadListener;m.isSystemButtonClicked=false;}_6b();}_6f.hide();},_6f.id);m.connect("okButton","onKeyDown",function(evt){if(evt.keyCode===d.keys.ENTER){if(_6b){if(m.unloadListener){window.onbeforeunload=m.unloadListener;m.isSystemButtonClicked=false;}_6b();}_6f.hide();}});if(_66!=="ERROR"&&_66!=="CUSTOM-NO-CANCEL"){misys.dialog.connect(dj.byId("cancelButton"),"onMouseUp",function(){m.dialog.cancelCalled=true;if(_6c){if(m.unloadListener){window.onbeforeunload=m.unloadListener;m.isSystemButtonClicked=false;}_6c();}_6f.hide();},_6f.id);m.connect("cancelButton","onKeyDown",function(evt){m.dialog.cancelCalled=true;if(evt.keyCode===d.keys.ENTER){if(_6c){if(m.unloadListener){window.onbeforeunload=m.unloadListener;m.isSystemButtonClicked=false;}_6c();}_6f.hide();}});}}m.dialog.connect(_6f,"onKeyPress",function(evt){if(evt.keyCode===d.keys.ESCAPE){d.stopEvent(evt);}});if(_6a){var evt=(url&&url!=="")?"onLoad":"onShow";m.dialog.connect(_6f,evt,_6a);}m.dialog.connect(_6f,"onHide",function(){_74.overflow="";setTimeout(function(){if(_69&&!m.dialog.cancelCalled){_69();}},300);if(!m.isSystemButtonClicked){if(m.unloadListener){window.onbeforeunload=m.unloadListener;}}m.dialog.disconnect(_6f);});return _6f.show();},hide:function(id){var _75=id||["alertDialog","xhrDialog"];d.forEach(_75,function(_76){var _77=dj.byId(_76);if(_77&&_77.get("open")){_77.hide();}});},showMultipleChoiceDialog:function(_78,_79,_7a,_7b){var _7c=dj.byId("alertDialog")||_18("alertDialog");var _7d=d.byId("dialogProgressBar"),_7e=d.byId("dialogButtons"),_7f=dj.byId("cancelButton").domNode,_80=d.byId("alertDialogContent");d.style(_7d,"display","none");d.style(_7d,"visibility","hidden");d.style(_7d,"display","none");d.style(_7d,"visibility","hidden");d.style(_7e,"display","block");d.style(_7f,"display","inline-block");d.style(_80,"display","block");d.style(_80,"width","480px");d.style(_80,"height","120px");_7c.set("title",_79);var _81=_20(_7a);_80.innerHTML=_78;for(var i=0,len=_81.length;i<len;i++){_80.appendChild(_81[i]);d.parser.parse("MulChoiceRadio_row_"+(i+1));}m.dialog.connect(dj.byId("okButton"),"onMouseUp",function(){for(var i=1,len=_81.length;i<=len;i++){if(dj.byId("MulChoiceRadioBtn_"+i).get("checked")){var _82=new dijit.form.Form({method:"POST",action:_7b[i-1]},"submitForm");_82.domNode.appendChild(dijit.byId("token").domNode);dojo.body().appendChild(_82.domNode);_82.submit();return;}}m.showTooltip(m.getLocalization("multipleChoiceError"),d.byId("MulChoiceRadioBtn_1"),["before"]);},_7c.id);m.dialog.connect(dj.byId("cancelButton"),"onMouseUp",function(){_7c.hide();m.dialog.disconnect(_7c);for(var i=0,len=_81.length;i<len;i++){_80.appendChild(_81[i]);dj.byId("MulChoiceRadioBtn_"+(i+1)).destroy();}},_7c.id);m.dialog.connect(_7c,"onKeyPress",function(evt){if(evt.keyCode==d.keys.ESCAPE){_7c.hide();m.dialog.disconnect(_7c);for(var i=0,len=_81.length;i<len;i++){_80.appendChild(_81[i]);dj.byId("MulChoiceRadioBtn_"+(i+1)).destroy();}}});_7c.show();}},post:function(_83){var _84,_85;var _86={};d.forEach(_83.params,function(_87){_86[_87.name]=_87.value;});if(misys._config.isBank==="false"&&misys._config.fccuiEnabled&&misys._config.fccuiEnabled==="true"&&m.isAngularProductUrl(_86.productcode,_86.subproductcode)){_25(_86);}else{var _88=false;var _89=false;var _8a=new dj.form.Form({action:_83.action,method:"POST",name:""+new Date().getTime()});d.place(_8a.domNode,d.body(),"last");var _8b=d.create("div",null,d.body());var obj="display:none";d.attr(_8b,"style",obj);d.place(_8b,_8a.domNode,"first");d.forEach(_83.params,function(_8c){d.create("input",_8c,_8b);if(_8c.name==="operation"&&_8c.value==="DELETE_FEATURES"){_88=true;}if(_8c.name==="option"&&_8c.value==="FAILED_UPLOADS"){_89=true;}});if(dj.byId("token")){dojo.create("input",{name:"token",value:dijit.byId("token").get("value")},_8b);}if(!_89){m.dialog.show("PROGRESS","");}if(d.isFunction(m._config.doReauthSubmit)){var _8d=dj.byId("reauth_perform");if(_8d&&_8d.get("value")==="Y"&&_88){m._config.doReauthSubmit(_8a);}else{_8a.submit();}}else{_8a.submit();}}},togglePortletContent:function(_8e){var _8f=_8e+"-show",_90=_8e+"-collapse",_91,_92=d.query("#"+_8e+" > .portlet-section-body");if(_92&&_92[0]){_91=_92[0];}if(_91){if(d.style(_91,"display")==="none"){m.animate("wipeIn",_91);d.style(_8f,"display","none");d.style(_90,"display","inline-block");d.style(_90,"cursor","pointer");}else{m.animate("wipeOut",_91);d.style(_90,"display","none");d.style(_8f,"display","inline-block");d.style(_8f,"cursor","pointer");}}}});if(!d.isFunction(String.prototype.replaceAll)){String.prototype.replaceAll=function(_93,_94){return d.map(this,function(_95){return _95==_93?_94:_95;}).join("");};}m._config=(m._config)||{};d.mixin(m._config,{imagesSrc:"/content/images/",imageStore:{editIcon:"edit.png",deleteIcon:"delete.png",downloadIcon:"download.png",warningIcon:"warning.png"},showTable:("table"),showTableRow:("table-row")});d.addOnWindowUnload(function(){try{d.forEach(m.connections,d.disconnect);d.forEach(_6,function(id){var obj=dj.byId?dj.byId(id):undefined;if(obj){obj.destroyRecursive();}});}catch(err){console.error("[misys._base] There was an error unloading an event");console.error(err);}});})(dojo,dijit,misys);}