/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.system.widget.Accounts"]){dojo._hasResource["misys.system.widget.Accounts"]=true;dojo.provide("misys.system.widget.Accounts");dojo.experimental("misys.system.widget.Accounts");dojo.require("misys.grid.GridMultipleItems");dojo.require("misys.system.widget.AccountDataGrid");dojo.declare("misys.system.widget.Accounts",[misys.grid.GridMultipleItems],{data:{identifier:"store_id",label:"store_id",items:[]},templatePath:null,templateString:dojo.byId("accounts-template").innerHTML,dialogId:"account-dialog-template",xmlTagName:"accounts",xmlSubTagName:"account",viewMode:"edit",gridColumns:["account_number","nickname","account_name","bank_abbv_name","displayed_owner_type","owner_type","type","ccy","nra","description","account_product_type","cust_account_type","bank_id","branch_code","account_type","existing_bib_account","created_dttm","routing_bic","customer_reference","actv_flag","start_date","end_date","principal_amount","maturity_amount","interest_rate_credit","interest_rate_debit","interest_rate_maturity","settlement_means","sweeping_enabled","pooling_enabled","charge_account_for_liq"],propertiesMap:{account_number:{_fieldName:"account_number"},nickname:{_fieldName:"nickname"},account_name:{_fieldName:"account_name"},bank_abbv_name:{_fieldName:"bank_abbv_name"},owner_type:{_fieldName:"owner_type"},displayed_owner_type:{_fieldName:"displayed_owner_type"},type:{_fieldName:"bank_account_type"},ccy:{_fieldName:"account_ccy_cur_code"},description:{_fieldName:"account_desc"},nra:{_fieldName:"account_nra"},account_product_type:{_fieldName:"account_product_type"},cust_account_type:{_fieldName:"cust_account_type"},bank_id:{_fieldName:"bank_id"},branch_code:{_fieldName:"branch_code"},account_type:{_fieldName:"account_type"},created_dttm:{_fieldName:"created_dttm"},routing_bic:{_fieldName:"routing_bic"},customer_reference:{_fieldName:"customer_reference"},actv_flag:{_fieldName:"act_actv_flag"},start_date:{_fieldName:"start_date"},end_date:{_fieldName:"end_date"},principal_amount:{_fieldName:"principal_amount"},maturity_amount:{_fieldName:"maturity_amount"},interest_rate_credit:{_fieldName:"interest_rate_credit"},interest_rate_debit:{_fieldName:"interest_rate_debit"},interest_rate_maturity:{_fieldName:"interest_rate_maturity"},settlement_means:{_fieldName:"settlement_means"},sweeping_enabled:{_fieldName:"sweeping_enabled"},pooling_enabled:{_fieldName:"pooling_enabled"},charge_account_for_liq:{_fieldName:"charge_account_for_liq"}},layout:[],resetDialog:function(){var _1=this.dialog.getChildren();dojo.forEach(_1,function(_2){var _3=_2.declaredClass;switch(_3){case "dijit.form.RadioButton":_2.set("checked",false);break;case "dijit.form.CheckBox":_2.set("checked",false);break;case "dijit.form.DateTextBox":_2.set("value",null);break;default:if(_2.get("type")==="hidden"){break;}_2.set("value","");_2.state="";if(_2._setStateClass){_2._setStateClass();}break;}_2._hasBeenBlurred=false;if(_2.grid&&_2.grid.declaredClass==="misys.grid.DataGrid"){_2.clear();}});if(this.dialog.gridMultipleItemsWidget){this.dialog.gridMultipleItemsWidget=null;}if(this.dialog.storeId){this.dialog.storeId=null;}for(var _4 in this.handle){if(this.handle.hasOwnProperty(_4)){dojo.disconnect(this.handle[_4]);}}this.handle=[];},startup:function(){if(this._started){return;}this.dataList=[];if(this.hasChildren()){dojo.forEach(this.getChildren(),function(_5){var _6={name_:_5.get("account_number_")};this.dataList.push(_6);},this);}if(dijit.byId("multiBank")&&dijit.byId("multiBank").get("value")==="Y"&&dijit.byId("account_delete_permission")&&dijit.byId("account_delete_permission").get("value")==="Y"){this.layout=[{name:"Account Number",field:"account_number",width:"15%",noresize:true},{name:"Bank",field:"bank_abbv_name",width:"15%",noresize:true},{name:"Account Owner Type",field:"displayed_owner_type",width:"7%",noresize:true},{name:"Account Type",field:"type",width:"7%",noresize:true},{name:"Account Product Type",field:"account_product_type",width:"9%",noresize:true},{name:"Ccy",field:"ccy",width:"5%",noresize:true},{name:"Description",field:"description",width:"18%",noresize:true},{name:"Customer Account Type",field:"cust_account_type",width:"7%",noresize:true},{name:"Bank Id",field:"bank_id",width:"5%",noresize:true},{name:"Branch No",field:"branch_code",width:"6%",noresize:true},{name:"NRA",field:"nra",width:"4%",noresize:true},{name:"Customer Reference",field:"customer_reference",width:"10%",noresize:true},{name:"Active",field:"actv_flag",width:"5%",noresize:true},{name:" ",field:"actions",formatter:misys.grid.formatReportActions,width:"7%",noresize:true},{name:"Id",field:"store_id",headerStyles:"display:none",cellStyles:"display:none",noresize:true},{name:"nickname",field:"nickname",headerStyles:"display:none",cellStyles:"display:none",noresize:true},{name:"Sweeping Enabled",field:"sweeping_enabled",headerStyles:"display:none",cellStyles:"display:none",noresize:true},{name:"Pooling Enabled",field:"pooling_enabled",headerStyles:"display:none",cellStyles:"display:none",noresize:true},{name:"Charge Account for Liquidity",field:"charge_account_for_liq",headerStyles:"display:none",cellStyles:"display:none",noresize:true}];}else{if(dijit.byId("multiBank")&&dijit.byId("multiBank").get("value")==="Y"&&dijit.byId("account_delete_permission")&&dijit.byId("account_delete_permission").get("value")==="N"){this.layout=[{name:"Account Number",field:"account_number",width:"15%",noresize:true},{name:"Bank",field:"bank_abbv_name",width:"15%",noresize:true},{name:"Account Owner Type",field:"displayed_owner_type",width:"7%",noresize:true},{name:"Account Type",field:"type",width:"7%",noresize:true},{name:"Account Product Type",field:"account_product_type",width:"9%",noresize:true},{name:"Ccy",field:"ccy",width:"5%",noresize:true},{name:"Description",field:"description",width:"18%",noresize:true},{name:"Customer Account Type",field:"cust_account_type",width:"7%",noresize:true},{name:"Bank Id",field:"bank_id",width:"5%",noresize:true},{name:"Branch No",field:"branch_code",width:"6%",noresize:true},{name:"NRA",field:"nra",width:"4%",noresize:true},{name:"Customer Reference",field:"customer_reference",width:"10%",noresize:true},{name:"Active",field:"actv_flag",width:"5%",noresize:true},{name:" ",field:"actions",formatter:misys.grid.formatAccountActions,width:"7%",noresize:true},{name:"Id",field:"store_id",headerStyles:"display:none",cellStyles:"display:none",noresize:true},{name:"nickname",field:"nickname",headerStyles:"display:none",cellStyles:"display:none",noresize:true}];}else{if(dijit.byId("account_delete_permission")&&dijit.byId("account_delete_permission").get("value")==="Y"){this.layout=[{name:"Account Number",field:"account_number",width:"15%",noresize:true},{name:"Account Owner Type",field:"displayed_owner_type",width:"7%",noresize:true},{name:"Account Type",field:"type",width:"7%",noresize:true},{name:"Account Product Type",field:"account_product_type",width:"9%",noresize:true},{name:"Ccy",field:"ccy",width:"5%",noresize:true},{name:"Description",field:"description",width:"18%",noresize:true},{name:"Customer Account Type",field:"cust_account_type",width:"7%",noresize:true},{name:"Bank Id",field:"bank_id",width:"5%",noresize:true},{name:"Branch No",field:"branch_code",width:"6%",noresize:true},{name:"NRA",field:"nra",width:"4%",noresize:true},{name:"Customer Reference",field:"customer_reference",width:"10%",noresize:true},{name:"Active",field:"actv_flag",width:"5%",noresize:true},{name:" ",field:"actions",formatter:misys.grid.formatReportActions,width:"7%",noresize:true},{name:"Id",field:"store_id",headerStyles:"display:none",cellStyles:"display:none",noresize:true},{name:"nickname",field:"nickname",headerStyles:"display:none",cellStyles:"display:none",noresize:true},{name:"Sweeping Enabled",field:"sweeping_enabled",headerStyles:"display:none",cellStyles:"display:none",noresize:true},{name:"Pooling Enabled",field:"pooling_enabled",headerStyles:"display:none",cellStyles:"display:none",noresize:true},{name:"Charge Account for Liquidity",field:"charge_account_for_liq",headerStyles:"display:none",cellStyles:"display:none",noresize:true}];}else{this.layout=[{name:"Account Number",field:"account_number",width:"15%",noresize:true},{name:"Account Owner Type",field:"displayed_owner_type",width:"7%",noresize:true},{name:"Account Type",field:"type",width:"7%",noresize:true},{name:"Account Product Type",field:"account_product_type",width:"9%",noresize:true},{name:"Ccy",field:"ccy",width:"5%",noresize:true},{name:"Description",field:"description",width:"18%",noresize:true},{name:"Customer Account Type",field:"cust_account_type",width:"7%",noresize:true},{name:"Bank Id",field:"bank_id",width:"5%",noresize:true},{name:"Branch No",field:"branch_code",width:"6%",noresize:true},{name:"NRA",field:"nra",width:"4%",noresize:true},{name:"Customer Reference",field:"customer_reference",width:"10%",noresize:true},{name:"Active",field:"actv_flag",width:"5%",noresize:true},{name:" ",field:"actions",formatter:misys.grid.formatAccountActions,width:"7%",noresize:true},{name:"Id",field:"store_id",headerStyles:"display:none",cellStyles:"display:none",noresize:true},{name:"nickname",field:"nickname",headerStyles:"display:none",cellStyles:"display:none",noresize:true}];}}}if((this.viewMode==="view"||(dijit.byId("account_maintenance_permission")&&dijit.byId("account_maintenance_permission").get("value")==="N"))&&(dijit.byId("multiBank")&&dijit.byId("multiBank").get("value")==="Y"||dijit.byId("owner_is_group")&&dijit.byId("owner_is_group").get("value")==="Y")){this.layout=[{name:"Account Number",field:"account_number",width:"15%",noresize:true},{name:"Bank",field:"bank_abbv_name",width:"15%",noresize:true},{name:"Account Owner Type",field:"displayed_owner_type",width:"6%",noresize:true},{name:"Account Type",field:"type",width:"6%",noresize:true},{name:"Account Product Type",field:"account_product_type",width:"9%",noresize:true},{name:"Ccy",field:"ccy",width:"5%",noresize:true},{name:"Description",field:"description",width:"20%",noresize:true},{name:"Customer Account Type",field:"cust_account_type",width:"7%",noresize:true},{name:"Bank Id",field:"bank_id",width:"5%",noresize:true},{name:"Branch No",field:"branch_code",width:"5%",noresize:true},{name:"NRA",field:"nra",width:"4%",noresize:true},{name:"Customer Reference",field:"customer_reference",width:"10%",noresize:true},{name:"Active",field:"actv_flag",width:"5%",noresize:true},{name:"Id",field:"store_id",headerStyles:"display:none",cellStyles:"display:none",noresize:true},{name:"Sweeping Enabled",field:"sweeping_enabled",headerStyles:"display:none",cellStyles:"display:none",noresize:true},{name:"Pooling Enabled",field:"pooling_enabled",headerStyles:"display:none",cellStyles:"display:none",noresize:true},{name:"Charge Account for Liquidity",field:"charge_account_for_liq",headerStyles:"display:none",cellStyles:"display:none",noresize:true}];}else{if(this.viewMode==="view"||(dijit.byId("account_maintenance_permission")&&dijit.byId("account_maintenance_permission").get("value")==="N")){this.layout=[{name:"Account Number",field:"account_number",width:"15%",noresize:true},{name:"Account Owner Type",field:"displayed_owner_type",width:"6%",noresize:true},{name:"Account Type",field:"type",width:"6%",noresize:true},{name:"Account Product Type",field:"account_product_type",width:"9%",noresize:true},{name:"Ccy",field:"ccy",width:"5%",noresize:true},{name:"Description",field:"description",width:"20%",noresize:true},{name:"Customer Account Type",field:"cust_account_type",width:"7%",noresize:true},{name:"Bank Id",field:"bank_id",width:"5%",noresize:true},{name:"Branch No",field:"branch_code",width:"5%",noresize:true},{name:"NRA",field:"nra",width:"4%",noresize:true},{name:"Customer Reference",field:"customer_reference",width:"10%",noresize:true},{name:"Active",field:"actv_flag",width:"5%",noresize:true},{name:"Id",field:"store_id",headerStyles:"display:none",cellStyles:"display:none",noresize:true},{name:"Sweeping Enabled",field:"sweeping_enabled",headerStyles:"display:none",cellStyles:"display:none",noresize:true},{name:"Pooling Enabled",field:"pooling_enabled",headerStyles:"display:none",cellStyles:"display:none",noresize:true},{name:"Charge Account for Liquidity",field:"charge_account_for_liq",headerStyles:"display:none",cellStyles:"display:none",noresize:true}];}}this.dataList=[];if(this.hasChildren()){dojo.forEach(this.getChildren(),function(_7){var _8={account_number:_7.get("account_number"),nickname:_7.get("nickname"),account_name:_7.get("account_name"),bank_abbv_name:_7.get("bank_abbv_name"),displayed_owner_type:_7.get("displayed_owner_type"),owner_type:_7.get("owner_type"),type:_7.get("type"),ccy:_7.get("ccy"),nra:_7.get("nra"),description:_7.get("description"),account_product_type:_7.get("account_product_type"),cust_account_type:_7.get("cust_account_type"),bank_id:_7.get("bank_id"),branch_code:_7.get("branch_code"),account_type:_7.get("account_type"),created_dttm:_7.get("created_dttm"),routing_bic:_7.get("routing_bic"),customer_reference:_7.get("customer_reference"),actv_flag:_7.get("actv_flag"),start_date:_7.get("start_date"),end_date:_7.get("end_date"),principal_amount:_7.get("principal_amount"),maturity_amount:_7.get("maturity_amount"),interest_rate_credit:_7.get("interest_rate_credit"),interest_rate_debit:_7.get("interest_rate_debit"),interest_rate_maturity:_7.get("interest_rate_maturity"),settlement_means:_7.get("settlement_means"),sweeping_enabled:_7.get("sweeping_enabled"),pooling_enabled:_7.get("pooling_enabled"),charge_account_for_liq:_7.get("charge_account_for_liq")};this.dataList.push(_8);},this);}this.inherited(arguments);misys.connect(this,"onCellClick",this,this.handleGridAction);},_retrieveAccounts:function(){var _9=[];this.grid.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(this,function(_a,_b){dojo.forEach(_a,function(_c){var _d=_c["account_number"];var _e=_c["ccy"];var _f=_c["owner_type"];if(_f!="10"){_9.push({name:_d,value:_d,ccy:_e});}},this);if(dijit.byId("charge_account")){dijit.byId("charge_account").store=new dojo.data.ItemFileWriteStore({data:{identifier:"value",items:_9}});}})});},checkDialog:function(){this.inherited(arguments);},updateData:function(){this.inherited(arguments);this._retrieveAccounts();},openDialogFromExistingItem:function(_10,_11){misys.dialog.isActive=false;misys._config.isOpenDialog=true;var _12=_10[0];var _13="";var _14="";var _15="";var _16="";var _17="";this.checkDialog();if(this.overrideDisplaymode!=="view"){this.dialog.set("title",this.dialogUpdateItemTitle);}else{var _18=this.dialogViewItemTitle||this.dialogUpdateItemTitle;this.dialog.set("title",_18);}this.resetDialog();this.dialog.gridMultipleItemsWidget=this;this.dialog.execute=this.dialogExecute;this.dialog.gridMultipleItemsWidget=this;this.dialog.storeId=(dojo.isArray(_12.store_id)?_12.store_id[0]:_12.store_id);if(_12.pooling_enabled[0]===""){dojo.style(dojo.byId("pooling_enabled_row"),"display","none");}else{dojo.style(dojo.byId("pooling_enabled_row"),"display","block");}if(_12.sweeping_enabled[0]===""){dojo.style(dojo.byId("sweeping_enabled_row"),"display","none");}else{dojo.style(dojo.byId("sweeping_enabled_row"),"display","block");}if(_12.charge_account_for_liq[0]===""){dojo.style(dojo.byId("charge_account_for_liq_row"),"display","none");}else{dojo.style(dojo.byId("charge_account_for_liq_row"),"display","block");}var _19=this.dialog.getChildren();for(var _1a in _12){var _1b=(this.propertiesMap[_1a]&&this.propertiesMap[_1a]._fieldName?this.propertiesMap[_1a]._fieldName:_1a);if(_1a!=="store_id"){dojo.some(_19,function(_1c){if(_1c.id===_1b||_1c.name===_1b){var _1d=_12[_1a];_1d=dojo.isArray(_1d)?_1d[0]:_1d;if(this.overrideDisplaymode==="view"){var _1e=(!_1d&&_1d!==0)?"none":"block";if(_1c&&_1c.id&&dojo.byId(_1c.id+"_row")){dojo.style(_1c.id+"_row","display",_1e);}}if(_1c.isInstanceOf(misys.grid.GridMultipleItems)){if(_1c.grid){_1c.grid.destroy();}if(dojo.isObject(_1d)&&_1d._values&&dojo.isArray(_1d._values)){_1c.dataList=dojo.clone(_1d._values);_1c.createDataStoreFromDataList();_1c.createDataGrid();var key=_12.store_id+"_"+_1a;if(this.handle&&!this.handle[key]){this.handle[key]=misys.connect(this.dialog,"onShow",_1c,"renderAll");}}}else{var _1f=_1c.declaredClass;switch(_1f){case "dijit.form.DateTextBox":_1c.set("displayedValue",_1d);break;case "dijit.form.CheckBox":_1c.set("checked",_1d==="Y"?true:false);break;case "dijit.form.RadioButton":var _20=dojo.query("[name='"+_1c.name+"']",this.dialog.domNode);dojo.some(_20,function(_21){var _22=dijit.byNode(_21.parentNode);if(_22.params.value===_1d){_22.set("checked",true);return true;}});break;case "dijit.form.NumberTextBox":if(_1d!=null&&_1d!==""&&_1d!=="NaN"){_1c.set("value",_1d,false);}break;case "misys.form.MultiSelect":_1c.domNode.innerHTML=[];if(_1d!==""){var arr=_1d.split(",");for(var i=0;i<arr.length;i++){var op=dojo.create("option");op.innerHTML=arr[i];op.value=arr[i];_1c.domNode.appendChild(op);}}break;default:_1c.set("value",_1d);if(_1c.id==="bank_abbv_name"){_13=_1d;}if(_1c.id==="bank_account_type"){_14=_1d;}if(_1c.id==="account_product_type"){_15=_1d;}if(_1c.id==="sweeping_enabled"){_15=_1d;}if(_1c.id==="pooling_enabled"){_15=_1d;}if(_1c.id==="charge_account_for_liq"){_15=_1d;}if(_1c.id==="customer_reference"){_16=_1d;}if(_1c.id==="cust_account_type"){_17=_1d;}break;}if(this.overrideDisplaymode==="view"){_1c.set("readOnly",true);}return true;}}return false;},this);}}if(misys._config.isBankGroupLogin){if(misys._config.accountTypesPerBank&&dijit.byId("bank_account_type")&&_13!==""){var _23=misys._config.accountTypesPerBank[_13];if(_23){dijit.byId("bank_account_type").store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_23}});dijit.byId("bank_account_type").fetchProperties={sort:[{attribute:"name"}]};}dijit.byId("bank_account_type").set("value",_14);}if(misys._config.productTypesPerBank&&dijit.byId("account_product_type")&&_13!==""){var _24=misys._config.productTypesPerBank[_13];if(_24){dijit.byId("account_product_type").store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_24}});dijit.byId("account_product_type").fetchProperties={sort:[{attribute:"name"}]};}dijit.byId("account_product_type").set("value",_15);}if(misys._config.custRefPerBank&&dijit.byId("customer_reference")&&_13!==""){var _25=misys._config.custRefPerBank[_13];if(_25){dijit.byId("customer_reference").store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_25}});dijit.byId("customer_reference").fetchProperties={sort:[{attribute:"name"}]};}dijit.byId("customer_reference").set("value",_16);}if(misys._config.customerAccountTypesPerBank&&dijit.byId("cust_account_type")&&_13!==""){var _26=misys._config.customerAccountTypesPerBank[_13];if(_26){dijit.byId("cust_account_type").store=new dojo.data.ItemFileReadStore({data:{identifier:"value",label:"name",items:_26}});dijit.byId("cust_account_type").fetchProperties={sort:[{attribute:"name"}]};}dijit.byId("cust_account_type").set("value",_17);}}if(this.openDialogFromExistingItemInitFunction!=null){this.openDialogFromExistingItemInitFunction(_12);}this.dialog.show();setTimeout(dojo.hitch(this,"activateDialog"),500);if(_12.hasOwnProperty("is_valid")){var _27=(dojo.isArray(_12.is_valid))?_12.is_valid[0]:_12.is_valid;if(_27!=="Y"){this.validateDialog(true);}}},activateDialog:function(){misys.dialog.isActive=true;misys._config.isOpenDialog=false;},createDataGrid:function(){var _28=this.gridId;if(_28===""){_28="grid-"+(this.xmlTagName!==""?this.xmlTagName+"-":"")+dojox.uuid.generateRandomUuid();}this.grid=new misys.system.widget.AccountsDataGrid({jsId:_28,id:_28,store:this.store,structure:this.layout,autoHeight:true,selectionMode:"multiple",columnReordering:true,autoWidth:true,canSort:function(){return true;},showMoveOptions:this.showMoveOptions,initialWidth:"100%"},document.createElement("div"));this.grid.gridMultipleItemsWidget=this;this.addChild(this.grid);this.onGridCreate();}});}