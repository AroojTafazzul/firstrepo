/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.system.widget.AccountDataGrid"]){dojo._hasResource["misys.system.widget.AccountDataGrid"]=true;dojo.provide("misys.system.widget.AccountDataGrid");dojo.experimental("misys.system.widget.AccountDataGrid");dojo.require("misys.grid.EnhancedGrid");dojo.require("dojox.grid.enhanced.plugins.Pagination");dojo.require("misys.grid.DataGrid");dojo.declare("misys.system.widget.AccountsDataGrid",[misys.grid.EnhancedGrid,misys.grid.DataGrid],{rowsPerPage:10,plugins:{paginationEnhanced:{pageSizes:["10","25","50","100"],description:true,sizeSwitch:true,pageStepper:true,gotoButton:true,maxPageStep:7,position:" top "}},handleGridAction:function(_1){var _2=0;if(_1.grid&&_1.grid.plugin("paginationEnhanced")&&_1.grid.plugin("paginationEnhanced").pageSize&&_1.grid.plugin("paginationEnhanced")._currentPage){_2=_1.grid.plugin("paginationEnhanced")._currentPage*_1.grid.plugin("paginationEnhanced").pageSize;}if(_1.target.tagName=="IMG"&&_1.target.attributes.type){if(_1.target.attributes.type.value=="edit"){if(dijit.byId("bank_previous_account_type")){dijit.byId("bank_previous_account_type").set("value","checked");}this.onEdit(_1,_2);}else{if(_1.target.attributes.type.value=="remove"){this.onDelete(_1);}}}},_deleteChargingAccount:function(_3){var _4=this.selection.getSelected(),_5,_6,_7=dijit.byId("charge_account");_7.store=null;var _8="";if(_7&&_7.store===null){this.inherited(arguments);var _9=[];dijit.byId("accounts-grid").store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(this,function(_a){dojo.forEach(_a,function(_b){var _c=_b["account_number"];var _d=_b["ccy"];if("S"+_8==="S"){_8=_c;}var _e=_b["owner_type"];if(_e!="10"){_9.push({name:_c,value:_c,ccy:_d});}},this);dijit.byId("charge_account").store=new dojo.data.ItemFileWriteStore({data:{identifier:"value",items:_9}});})});dijit.byId("charge_account").store.save();if(_3&&_7){_6=_7.get("value");if(_3===_6){_7.setDisplayedValue("");_7.focus();}}}},_editChargingAccount:function(_f){var _10=this.selection.getSelected(),_11,_12,_13=dijit.byId("charge_account");_13.store=null;var _14="";if(_13&&_13.store===null){this.inherited(arguments);var _15=[];dijit.byId("accounts-grid").store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(this,function(_16,_17){dojo.forEach(_16,function(_18){var _19=_18["account_number"];var ccy=_18["ccy"];if("S"+_14==="S"){_14=_19;}var _1a=_18["owner_type"];if(_1a!="10"){_15.push({name:_19,value:_19,ccy:ccy});}},this);dijit.byId("charge_account").store=new dojo.data.ItemFileWriteStore({data:{identifier:"value",items:_15}});})});dijit.byId("charge_account").store.save();if(_f&&_13){_12=_13.get("value");if(_f===_12){_13.setDisplayedValue("");}}}},onDelete:function(_1b){var _1c=this,_1d;var _1e=function(){var _1f=_1c.selection.getSelected();if(_1f.length){dojo.forEach(_1f,function(_20){if(_20!==null){_1c.selection.setSelected(_20,false);}},_1c);}_1c.selection.setSelected(_1b.rowIndex,true);_1f=_1c.selection.getSelected();if(_1f.length&&_1f[0].account_number){if(_1f[0].account_number[0]){_1d=_1f[0].account_number[0];}}if(_1f.length){dojo.forEach(_1f,function(_21){if(_21!==null){_1c.store.deleteItem(_21);}},_1c);_1c.store.save();}setTimeout(dojo.hitch(_1c.gridMultipleItemsWidget,"renderSections"),100);if(dijit.byId("charge_account")){_1c._deleteChargingAccount(_1d);}};misys.dialog.show("CONFIRMATION",misys.getLocalization("confirmDeletionAccountRecord"),"",_1e);},onEdit:function(_22,_23){var _24=this,_25;var _26=_24.selection.getSelected();if(_26.length&&_26[0].account_number){if(_26[0].account_number[0]){_25=_26[0].account_number[0];}}if(this.gridMultipleItemsWidget&&this.gridMultipleItemsWidget.dialogId){this.gridMultipleItemsWidget.dialogId="edit-account-dialog-template";}var _27=this.store;var id;_27.fetch({query:{store_id:"*"},sort:this.getSortProps(),onComplete:dojo.hitch(this,function(_28,_29){dojo.forEach(_28,function(_2a,_2b){if(_2b===_22.rowIndex+_23){id=_2a.store_id[0];}},this);})});_27.fetch({query:{store_id:id},onComplete:dojo.hitch(this.gridMultipleItemsWidget,"openDialogFromExistingItem")});if(dijit.byId("charge_account")){_24._editChargingAccount(_25);}}});dojo.extend(dojox.grid.enhanced.plugins.Pagination,{defaultRows:100});}