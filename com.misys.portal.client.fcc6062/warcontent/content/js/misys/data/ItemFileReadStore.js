/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.data.ItemFileReadStore"]){dojo._hasResource["misys.data.ItemFileReadStore"]=true;dojo.provide("misys.data.ItemFileReadStore");dojo.experimental("misys.data.ItemFileReadStore");dojo.require("dojo.data.ItemFileReadStore");dojo.declare("misys.data.ItemFileReadStore",dojo.data.ItemFileReadStore,{_fetchItems:function(_1,_2,_3){var _4=_1.serverQuery||_1.queryOptions||{};var _5=this,_6=function(_7,_8){var _9=[],i,_a;if(_7.query){var _b,_c=_7.queryOptions?_7.queryOptions.ignoreCase:false;var _d={};for(_a in _7.query){_b=_7.query[_a];if(typeof _b==="string"){_d[_a]=dojo.data.util.filter.patternToRegExp(_b,_c);}else{if(_b instanceof RegExp){_d[_a]=_b;}}}for(i=0;i<_8.length;++i){var _e=true;var _f=_8[i];if(_f===null){_e=false;}else{for(_a in _7.query){_b=_7.query[_a];if(!_5._containsValue(_f,_a,_b,_d[_a])){_e=false;}}}if(_e){_9.push(_f);}}_2(_9,_7);}else{if(_8){for(i=0;i<_8.length;++i){var _10=_8[i];if(_10!==null){_9.push(_10);}}}_2(_9,_7);}};if(this._loadFinished){_6(_1,this._getItemsArray(_1.queryOptions));}else{if(this._jsonFileUrl!==this._ccUrl){dojo.deprecated("misys.data.ItemFileReadStore: ","To change the url, set the url property of the store,"+" not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0");this._ccUrl=this._jsonFileUrl;this.url=this._jsonFileUrl;}else{if(this.url!==this._ccUrl){this._jsonFileUrl=this.url;this._ccUrl=this.url;}}if(this.data!=null){this._jsonData=this.data;this.data=null;}if(this._jsonFileUrl){if(this._loadInProgress){this._queuedFetches.push({args:_1,filter:_6});}else{this._loadInProgress=true;var _11={url:_5._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk,content:_4};var _12=misys.xhrPost(_11);_12.addCallback(function(_13){try{_5._getItemsFromLoadedData(_13);_5._loadFinished=true;_5._loadInProgress=false;_6(_1,_5._getItemsArray(_1.queryOptions));_5._handleQueuedFetches();}catch(e){_5._loadFinished=true;_5._loadInProgress=false;_3(e,_1);}});_12.addErrback(function(_14){_5._loadInProgress=false;_3(_14,_1);});var _15=null;if(_1.abort){_15=_1.abort;}_1.abort=function(){var df=_12;if(df&&df.fired===-1){df.cancel();df=null;}if(_15){_15.call(_1);}};}}else{if(this._jsonData){try{this._loadFinished=true;this._getItemsFromLoadedData(this._jsonData);this._jsonData=null;_6(_1,this._getItemsArray(_1.queryOptions));}catch(e){_3(e,_1);}}else{_3(new Error("misys.data.ItemFileReadStore: No JSON source data was provided as either URL or a nested Javascript object."),_1);}}}}});}