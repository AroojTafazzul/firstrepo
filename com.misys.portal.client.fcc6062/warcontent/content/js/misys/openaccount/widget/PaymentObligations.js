/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.openaccount.widget.PaymentObligations"]){dojo._hasResource["misys.openaccount.widget.PaymentObligations"]=true;dojo.provide("misys.openaccount.widget.PaymentObligations");dojo.experimental("misys.openaccount.widget.PaymentObligations");dojo.require("misys.grid.GridMultipleItems");dojo.require("misys.openaccount.widget.PaymentObligation");dojo.require("misys.openaccount.widget.BpoPaymentTerms");dojo.require("misys.openaccount.widget.DatagridBPO");dojo.declare("misys.openaccount.widget.PaymentObligations",[misys.grid.GridMultipleItems],{data:{identifier:"store_id",label:"store_id",items:[]},templatePath:null,templateString:dojo.byId("bank-payment-obligation-details-template")?dojo.byId("bank-payment-obligation-details-template").innerHTML:"",dialogId:"bank-payment-obligation-details-dialog-template",dialogAddItemTitle:misys.getLocalization("bank-payment-obligation-dialog"),xmlTagName:"bank_payment_obligation",xmlSubTagName:"PmtOblgtn",gridColumns:["obligor_bank","recipient_bank","payment_obligation_amount","payment_obligation_percent","payment_charges_amount","payment_charges_percent","payment_expiry_date","applicable_law_country","creditor_agent_bic","creditor_agent_name","creditor_street_name","creditor_post_code_identification","creditor_town_name","creditor_country_sub_div","creditor_country","creditor_account_type_code","creditor_account_type_prop","creditor_account_id_iban","creditor_account_id_bban","creditor_account_id_upic","creditor_account_id_prop","creditor_account_cur_code","creditor_account_name","creditor_account_iban","creditor_account_bban","creditor_account_upic","creditor_account_prop","creditor_act_type_code","creditor_act_type_prop","settlement_bic","settlement_name_address","buyer_bank_bpo","payment_obligations_paymnt_terms"],propertiesMap:{OblgrBK:{_fieldName:"obligor_bank"},RcptBk:{_fieldName:"recipient_bank"},XpryDt:{_fieldName:"payment_expiry_date"},AplblLaw:{_fieldName:"applicable_law_country"},ChrgsAmt:{_fieldName:"payment_charges_amount"},ChrgsPctg:{_fieldName:"payment_charges_percent"},OblgnAmt:{_fieldName:"payment_obligation_amount"},OblgnPctg:{_fieldName:"payment_obligation_percent"},Cd:{_fieldName:"payment_code"},NbOfDays:{_fieldName:"payment_nb_days"},Amt:{_fieldName:"payment_amount"},Pctg:{_fieldName:"payment_percent"},BIC:{_fieldName:"creditor_agent_bic"},Nm:{_fieldName:"creditor_agent_name"},StrtNm:{_fieldName:"creditor_street_name"},PstCdId:{_fieldName:"creditor_post_code_identification"},TwnNm:{_fieldName:"creditor_town_name"},CtrySubDvsn:{_fieldName:"creditor_country_sub_div"},Ctry:{_fieldName:"creditor_country"},CrAccTypCd:{_fieldName:"creditor_account_type_code"},Prtry:{_fieldName:"creditor_account_type_prop"},CrAccTyp:{_fieldName:"creditor_account_id_type"},Id:{_fieldName:"creditor_account_prop_account_id"},Ccy:{_fieldName:"creditor_account_cur_code"},ActNm:{_fieldName:"creditor_account_name"},buyer_bank_bpo:{_fieldName:"buyer_bank_bpo"},paymentTerms:{_fieldName:"payment_obligations_paymnt_terms",_type:"misys.openaccount.widget.BpoPaymentTerms"}},paymentCodeMap:{Cd:{_fieldName:"payment_code"},NbOfDays:{_fieldName:"payment_nb_days"}},settlementTermsMap:{BIC:{_fieldName:"creditor_agent_bic"}},creditorNameMap:{Nm:{_fieldName:"creditor_agent_name"}},creditorAddressMap:{StrtNm:{_fieldName:"creditor_street_name"},PstCdId:{_fieldName:"creditor_post_code_identification"},TwnNm:{_fieldName:"creditor_town_name"},CtrySubDvsn:{_fieldName:"creditor_country_sub_div"},Ctry:{_fieldName:"creditor_country"}},creditorAccountMap:{Ccy:{_fieldName:"creditor_account_cur_code"},Nm:{_fieldName:"creditor_account_name"}},paymentTermMap:{OthrPmtTerms:{_fieldName:"payment_other_term"}},extraPropertiesMap:{Amt:{_fieldName:"payment_obligation_amount"},Pctg:{_fieldName:"payment_obligation_percent"},ChrgsAmt:{_fieldName:"payment_charges_amount"},ChrgsPctg:{_fieldName:"payment_charges_percent"},XpryDt:{_fieldName:"payment_expiry_date"},AplblLaw:{_fieldName:"applicable_law_country"}},obligorBankMap:{BIC:{_fieldName:"obligor_bank"}},recipientBankMap:{BIC:{_fieldName:"recipient_bank"}},creditorAccountTypeMap:{Cd:{_fieldName:"creditor_account_type_code"},Prtry:{_fieldName:"creditor_account_type_prop"}},paymentTermAmountMap:{Amt:{_fieldName:"payment_amount"},Pctg:{_fieldName:"payment_percent"}},creditorAccountIdMap:{IBAN:{_fieldName:"creditor_account_id_iban"},BBAN:{_fieldName:"creditor_account_id_bban"},UPIC:{_fieldName:"creditor_account_id_upic"},PrtryAcct:{_fieldName:"creditor_account_id_prop"}},layout:[{name:"obligor_bank",field:"obligor_bank",width:"10%"},{name:"recipient_bank",field:"recipient_bank",width:"30%"},{name:" ",field:"actions",formatter:misys.grid.formatReportActions,width:"10%"},{name:"Id",field:"store_id",headerStyles:"display:none",cellStyles:"display:none"}],typeMap:{"misys.openaccount.widget.BpoPaymentTerms":{"type":Array,"deserialize":function(_1){var _2={};_2._type="misys.openaccount.widget.BpoPaymentTerms";_2._values=_1;return _2;}}},mandatoryFields:["obligor_bank","receipent_bank"],startup:function(){this.inherited(arguments);},openDialogFromExistingItem:function(_3,_4){this.inherited(arguments);if(dijit.byId("payment_obligation_amount")&&dijit.byId("oblg_amt")&&(dijit.byId("oblg_amt").get("checked")!=true)){dijit.byId("payment_obligation_amount").set("disabled",true);}else{if(dijit.byId("payment_obligation_amount")){dijit.byId("payment_obligation_amount").set("disabled",false);}}if(dijit.byId("payment_obligation_percent")&&dijit.byId("oblg_prct")&&(dijit.byId("oblg_prct").get("checked")!=true)){dijit.byId("payment_obligation_percent").set("disabled",true);}else{if(dijit.byId("payment_obligation_percent")){dijit.byId("payment_obligation_percent").set("disabled",false);}}if(dijit.byId("payment_other_rules")&&dijit.byId("other_rule")&&(dijit.byId("other_rule").get("checked")!=true)){dijit.byId("payment_other_rules").set("disabled",true);}else{if(dijit.byId("payment_other_rules")){dijit.byId("payment_other_rules").set("disabled",false);}}if(dijit.byId("creditor_agent_bic")&&dijit.byId("settlement_bic")&&(dijit.byId("settlement_bic").get("checked")!=true)){dijit.byId("creditor_agent_bic").set("disabled",true);}else{if(dijit.byId("creditor_agent_bic")){dijit.byId("creditor_agent_bic").set("disabled",false);}}if(dijit.byId("creditor_agent_name")&&dijit.byId("creditor_street_name")&&dijit.byId("creditor_post_code_identification")&&dijit.byId("creditor_town_name")&&dijit.byId("creditor_country_sub_div")&&dijit.byId("creditor_country")&&dijit.byId("settlement_name_address")&&(dijit.byId("settlement_name_address").get("checked")!=true)){dijit.byId("creditor_agent_name").set("disabled",true);dijit.byId("creditor_street_name").set("disabled",true);dijit.byId("creditor_post_code_identification").set("disabled",true);dijit.byId("creditor_town_name").set("disabled",true);dijit.byId("creditor_country_sub_div").set("disabled",true);dijit.byId("creditor_country").set("disabled",true);dijit.byId("creditor_agent_name").set("required",false);dijit.byId("creditor_post_code_identification").set("required",false);dijit.byId("creditor_town_name").set("required",false);dijit.byId("creditor_country").set("required",false);}else{if(dijit.byId("creditor_agent_name")&&dijit.byId("creditor_street_name")&&dijit.byId("creditor_post_code_identification")&&dijit.byId("creditor_town_name")&&dijit.byId("creditor_country_sub_div")&&dijit.byId("creditor_country")){dijit.byId("creditor_agent_name").set("disabled",false);dijit.byId("creditor_street_name").set("disabled",false);dijit.byId("creditor_post_code_identification").set("disabled",false);dijit.byId("creditor_town_name").set("disabled",false);dijit.byId("creditor_country_sub_div").set("disabled",false);dijit.byId("creditor_country").set("disabled",false);dijit.byId("creditor_agent_name").set("required",true);dijit.byId("creditor_post_code_identification").set("required",true);dijit.byId("creditor_town_name").set("required",true);dijit.byId("creditor_country").set("required",true);}}if(dijit.byId("buyer_bank_bpo")&&dijit.byId("buyer_bank_bpo").get("checked")===true){dijit.byId("buyer_bank_bpo").set("disabled",false);dijit.byId("obligor_bank").set("disabled",true);}else{if(dijit.byId("buyer_bank_bpo")&&dijit.byId("buyer_bank_bpo_added")&&dijit.byId("buyer_bank_bpo").get("checked")===false&&dijit.byId("buyer_bank_bpo_added").get("value")==="true"){dijit.byId("buyer_bank_bpo").set("disabled",true);dijit.byId("obligor_bank").set("disabled",false);}}if(dijit.byId("buyer_bank_bpo")&&dijit.byId("buyer_bank_bpo_added")&&dijit.byId("buyer_bank_bpo").get("checked")===false&&dijit.byId("buyer_bank_bpo_added").get("value")!="true"){dijit.byId("buyer_bank_bpo").set("disabled",false);dijit.byId("obligor_bank").set("disabled",false);}if(dijit.byId("obligor_bank")&&dijit.byId("obligor_bank_hidden")){dijit.byId("obligor_bank_hidden").set("value",dijit.byId("obligor_bank").get("value"));}if(dijit.byId("settlement_bic")&&dojo.byId("CreditorAgentBIC")&&dijit.byId("settlement_bic").get("checked")===true){dojo.style(dojo.byId("CreditorAgentBIC"),"display","block");}else{if(dojo.byId("CreditorAgentBIC")){dojo.style(dojo.byId("CreditorAgentBIC"),"display","none");}}if(dijit.byId("settlement_name_address")&&dojo.byId("CreditorAgentName")&&dijit.byId("settlement_name_address").get("checked")===true){dojo.style(dojo.byId("CreditorAgentName"),"display","block");}else{if(dojo.byId("CreditorAgentName")){dojo.style(dojo.byId("CreditorAgentName"),"display","none");}}if(dijit.byId("creditor_account_iban")&&dijit.byId("creditor_account_iban").get("checked")===true){dojo.style(dojo.byId("creditor_account_id_iban_row"),"display","block");dijit.byId("creditor_account_id_iban").set("required",true);}else{if(dijit.byId("creditor_account_iban")){dojo.style(dojo.byId("creditor_account_id_iban_row"),"display","none");dijit.byId("creditor_account_id_iban").set("required",false);}}if(dijit.byId("creditor_account_bban")&&dijit.byId("creditor_account_bban").get("checked")===true){dojo.style(dojo.byId("creditor_account_id_bban_row"),"display","block");dijit.byId("creditor_account_id_bban").set("required",true);}else{if(dijit.byId("creditor_account_bban")){dojo.style(dojo.byId("creditor_account_id_bban_row"),"display","none");dijit.byId("creditor_account_id_bban").set("required",false);}}if(dijit.byId("creditor_account_upic")&&dijit.byId("creditor_account_upic").get("checked")===true){dojo.style(dojo.byId("creditor_account_id_upic_row"),"display","block");dijit.byId("creditor_account_id_upic").set("required",true);}else{if(dijit.byId("creditor_account_upic")){dojo.style(dojo.byId("creditor_account_id_upic_row"),"display","none");dijit.byId("creditor_account_id_upic").set("required",false);}}if(dijit.byId("creditor_account_prop")&&dijit.byId("creditor_account_prop").get("checked")===true){dojo.style(dojo.byId("creditor_account_id_prop_row"),"display","block");dijit.byId("creditor_account_id_prop").set("required",true);}else{if(dijit.byId("creditor_account_prop")){dojo.style(dojo.byId("creditor_account_id_prop_row"),"display","none");dijit.byId("creditor_account_id_prop").set("required",false);}}if(dijit.byId("creditor_act_type_prop")&&dijit.byId("creditor_act_type_prop").get("checked")===true){dojo.style(dojo.byId("creditor_account_type_prop_row"),"display","block");dijit.byId("creditor_account_type_prop").set("required",true);}else{if(dijit.byId("creditor_act_type_prop")){dojo.style(dojo.byId("creditor_account_type_prop_row"),"display","none");dijit.byId("creditor_account_type_prop").set("required",false);}}if(dijit.byId("creditor_act_type_code")&&dijit.byId("creditor_act_type_code").get("checked")===true){dojo.style(dojo.byId("creditor_account_type_code_row"),"display","block");dijit.byId("creditor_account_type_code").set("required",true);}else{if(dijit.byId("creditor_act_type_code")){dojo.style(dojo.byId("creditor_account_type_code_row"),"display","none");dijit.byId("creditor_account_type_code").set("required",false);}}if(dijit.byId("recipient_bank")&&dijit.byId("recipient_bank").get("value")!==""&&dijit.byId("obligor_bank")&&dijit.byId("obligor_bank").get("value")!==""){if(dijit.byId("recipient_bank").get("value")===dijit.byId("obligor_bank").get("value")){dijit.byId("recipient_bank").focus();displayMessage=misys.getLocalization("obligorRecipientSameBICError");dijit.byId("recipient_bank").set("state","Error");dijit.hideTooltip(dj.byId("recipient_bank").domNode);dijit.showTooltip(displayMessage,dijit.byId("recipient_bank").domNode,0);}else{dijit.byId("recipient_bank").set("state","");}}},resetDialog:function(_5,_6){this.inherited(arguments);if(dijit.byId("seller_bank_bic")&&dijit.byId("recipient_bank")&&dijit.byId("seller_bank_bic").get("value")!=""){dijit.byId("recipient_bank").set("value",dijit.byId("seller_bank_bic").get("value"));dijit.byId("recipient_bank").set("disabled",true);}else{if(dijit.byId("seller_bank_bic")&&dijit.byId("seller_bank_bic").get("value")===""){dijit.byId("recipient_bank").set("disabled",false);}}if(dijit.byId("settlement_bic")&&dojo.byId("CreditorAgentBIC")&&dijit.byId("settlement_bic").get("checked")===true){dojo.style(dojo.byId("CreditorAgentBIC"),"display","block");}else{if(dojo.byId("CreditorAgentBIC")){dojo.style(dojo.byId("CreditorAgentBIC"),"display","none");}}if(dijit.byId("settlement_name_address")&&dojo.byId("CreditorAgentName")&&dijit.byId("settlement_name_address").get("checked")===true){dojo.style(dojo.byId("CreditorAgentName"),"display","block");}else{if(dojo.byId("CreditorAgentName")){dojo.style(dojo.byId("CreditorAgentName"),"display","none");}}if(dijit.byId("creditor_account_iban")&&dijit.byId("creditor_account_iban").get("checked")===true){dojo.style(dojo.byId("creditor_account_id_iban_row"),"display","block");}else{if(dojo.byId("creditor_account_id_iban_row")){dojo.style(dojo.byId("creditor_account_id_iban_row"),"display","none");}}if(dijit.byId("creditor_account_bban")&&dijit.byId("creditor_account_bban").get("checked")===true){dojo.style(dojo.byId("creditor_account_id_bban_row"),"display","block");}else{if(dojo.byId("creditor_account_id_bban_row")){dojo.style(dojo.byId("creditor_account_id_bban_row"),"display","none");}}if(dijit.byId("creditor_account_upic")&&dijit.byId("creditor_account_upic").get("checked")===true){dojo.style(dojo.byId("creditor_account_id_upic_row"),"display","block");}else{if(dojo.byId("creditor_account_id_upic_row")){dojo.style(dojo.byId("creditor_account_id_upic_row"),"display","none");}}if(dijit.byId("creditor_account_prop")&&dijit.byId("creditor_account_prop").get("checked")===true){dojo.style(dojo.byId("creditor_account_id_prop_row"),"display","block");}else{if(dojo.byId("creditor_account_id_prop_row")){dojo.style(dojo.byId("creditor_account_id_prop_row"),"display","none");}}if(dijit.byId("creditor_act_type_code")&&dijit.byId("creditor_act_type_code").get("checked")===true){dojo.style(dojo.byId("creditor_account_type_code_row"),"display","block");}else{if(dojo.byId("creditor_account_type_code_row")){dojo.style(dojo.byId("creditor_account_type_code_row"),"display","none");}}if(dijit.byId("creditor_act_type_prop")&&dijit.byId("creditor_act_type_prop").get("checked")===true){dojo.style(dojo.byId("creditor_account_type_prop_row"),"display","block");}else{if(dojo.byId("creditor_account_type_prop_row")){dojo.style(dojo.byId("creditor_account_type_prop_row"),"display","none");}}},addItem:function(_7){this.inherited(arguments);if(dijit.byId("buyer_bank_bpo")&&dijit.byId("buyer_bank_bpo_added")&&dijit.byId("buyer_bank_bpo").get("checked")===false&&dijit.byId("buyer_bank_bpo_added").get("value")==="true"){dijit.byId("buyer_bank_bpo").set("disabled",true);}else{if(dijit.byId("buyer_bank_bpo")&&dijit.byId("buyer_bank_bpo_added")&&dijit.byId("buyer_bank_bpo_added").get("value")!="true"){dijit.byId("buyer_bank_bpo").set("disabled",false);dijit.byId("obligor_bank").set("disabled",false);}}if(dijit.byId("buyer_bank_bpo")&&dijit.byId("buyer_bank_bpo").get("disabled")===true){dijit.byId("obligor_bank").set("disabled",false);}if(dijit.byId("obligor_bank")&&dijit.byId("obligor_bank_hidden")){dijit.byId("obligor_bank_hidden").set("value","");}if(dijit.byId("creditor_agent_bic")&&dijit.byId("settlement_bic")&&(dijit.byId("settlement_bic").get("checked")!=true)){dijit.byId("creditor_agent_bic").set("disabled",true);}else{if(dijit.byId("creditor_agent_bic")){dijit.byId("creditor_agent_bic").set("disabled",false);}}if(dijit.byId("creditor_agent_name")&&dijit.byId("creditor_street_name")&&dijit.byId("creditor_post_code_identification")&&dijit.byId("creditor_town_name")&&dijit.byId("creditor_country_sub_div")&&dijit.byId("creditor_country")&&dijit.byId("settlement_name_address")&&(dijit.byId("settlement_name_address").get("checked")!=true)){dijit.byId("creditor_agent_name").set("disabled",true);dijit.byId("creditor_street_name").set("disabled",true);dijit.byId("creditor_post_code_identification").set("disabled",true);dijit.byId("creditor_town_name").set("disabled",true);dijit.byId("creditor_country_sub_div").set("disabled",true);dijit.byId("creditor_country").set("disabled",true);}else{if(dijit.byId("creditor_agent_name")&&dijit.byId("creditor_street_name")&&dijit.byId("creditor_post_code_identification")&&dijit.byId("creditor_town_name")&&dijit.byId("creditor_country_sub_div")&&dijit.byId("creditor_country")){dijit.byId("creditor_agent_name").set("disabled",false);dijit.byId("creditor_street_name").set("disabled",false);dijit.byId("creditor_post_code_identification").set("disabled",false);dijit.byId("creditor_town_name").set("disabled",false);dijit.byId("creditor_country_sub_div").set("disabled",false);dijit.byId("creditor_country").set("disabled",false);}}if(dijit.byId("creditor_account_iban")&&dijit.byId("creditor_account_iban").get("checked")===true){dojo.style(dojo.byId("creditor_account_id_iban_row"),"display","block");dijit.byId("creditor_account_id_iban").set("required",true);}else{if(dijit.byId("creditor_account_iban")){dojo.style(dojo.byId("creditor_account_id_iban_row"),"display","none");dijit.byId("creditor_account_id_iban").set("required",false);}}if(dijit.byId("creditor_account_bban")&&dijit.byId("creditor_account_bban").get("checked")===true){dojo.style(dojo.byId("creditor_account_id_bban_row"),"display","block");dijit.byId("creditor_account_id_bban").set("required",true);}else{if(dijit.byId("creditor_account_bban")){dojo.style(dojo.byId("creditor_account_id_bban_row"),"display","none");dijit.byId("creditor_account_id_bban").set("required",false);}}if(dijit.byId("creditor_account_upic")&&dijit.byId("creditor_account_upic").get("checked")===true){dojo.style(dojo.byId("creditor_account_id_upic_row"),"display","block");dijit.byId("creditor_account_id_upic").set("required",true);}else{if(dijit.byId("creditor_account_upic")){dojo.style(dojo.byId("creditor_account_id_upic_row"),"display","none");dijit.byId("creditor_account_id_upic").set("required",false);}}if(dijit.byId("creditor_account_prop")&&dijit.byId("creditor_account_prop").get("checked")===true){dojo.style(dojo.byId("creditor_account_id_prop_row"),"display","block");dijit.byId("creditor_account_id_prop").set("required",true);}else{if(dijit.byId("creditor_account_prop")){dojo.style(dojo.byId("creditor_account_id_prop_row"),"display","none");dijit.byId("creditor_account_id_prop").set("required",false);}}if(dijit.byId("creditor_act_type_prop")&&dijit.byId("creditor_act_type_prop").get("checked")===true){dojo.style(dojo.byId("creditor_account_type_prop_row"),"display","block");dijit.byId("creditor_account_type_prop").set("required",true);}else{if(dijit.byId("creditor_act_type_prop")){dojo.style(dojo.byId("creditor_account_type_prop_row"),"display","none");dijit.byId("creditor_account_type_prop").set("required",false);}}if(dijit.byId("creditor_act_type_code")&&dijit.byId("creditor_act_type_code").get("checked")===true){dojo.style(dojo.byId("creditor_account_type_code_row"),"display","block");dijit.byId("creditor_account_type_code").set("required",true);}else{if(dijit.byId("creditor_act_type_code")){dojo.style(dojo.byId("creditor_account_type_code_row"),"display","none");dijit.byId("creditor_account_type_code").set("required",false);}}},updateData:function(_8){this.inherited(arguments);misys.updateOpenAccountExpiryDate();},performValidation:function(){var _9=true;if(dijit.byId("buyer_bank_bpo_added")&&dijit.byId("buyer_bank_bpo_added").get("value")!="true"&&dijit.byId("buyer_bank_bpo").get("checked")===true){dijit.byId("buyer_bank_bpo_added").set("value",true);}if(this.validateDialog(true)){if(dijit.byId("payment_obligation_amount")&&dijit.byId("payment_obligation_percent")&&isNaN(dijit.byId("payment_obligation_amount").get("value"))&&isNaN(dijit.byId("payment_obligation_percent").get("value"))){_9=false;misys.dialog.show("ERROR",misys.getLocalization("amountOrPercentageReq"),"",function(){dijit.byId("payment_obligation_amount").set("disabled",false);dijit.byId("payment_obligation_amount").focus();});}var _a=dijit.byId("payment_obligations_paymnt_terms");if(!(_a&&_a.store&&_a.store._arrayOfTopLevelItems.length>0)){_9=false;misys.dialog.show("ERROR",misys.getLocalization("addBpoPaymentTerm"),"",function(){dijit.byId("dijit_form_Button_96")?dijit.byId("dijit_form_Button_96").focus():"";});}if(dijit.byId("creditor_account_id_iban")&&dijit.byId("creditor_account_id_iban").get("value")===""&&dijit.byId("creditor_account_id_bban")&&dijit.byId("creditor_account_id_bban").get("value")===""&&dijit.byId("creditor_account_id_upic")&&dijit.byId("creditor_account_id_upic").get("value")===""&&dijit.byId("creditor_account_id_prop")&&dijit.byId("creditor_account_id_prop").get("value")===""){_9=false;misys.dialog.show("ERROR",misys.getLocalization("mandatoryCreditorAccountError"));}if(_9){this.inherited(arguments);}}},createJsonItem:function(){var _b=[];if(this.hasChildren&&this.hasChildren()){dojo.forEach(this.getChildren(),function(_c){if(_c.createItem){var _d=_c.createItem();_b.push(_d);if(this.get("is_valid")!=="N"){this.set("is_valid",_d.is_valid?_d.is_valid:"Y");}misys._widgetsToDestroy=misys._widgetsToDestroy||[];misys._widgetsToDestroy.push(_c.id);}},this);}return _b;},toXML:function(){var _e=[];if(this.xmlTagName){_e.push("<",this.xmlTagName,">");}_e.push("<bpo><![CDATA[");if(this.grid){this.grid.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(this,function(_f,_10){_e.push(this.itemToXML(_f,this.xmlSubTagName));})});}_e.push("]]></bpo>");_e.push("<bpo_xml>");if(this.grid){this.grid.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(this,function(_11,_12){_e.push(this.itemToXML(_11,this.xmlSubTagName));})});}_e.push("</bpo_xml>");if(this.xmlTagName){_e.push("</",this.xmlTagName,">");}return _e.join("");},createDataGrid:function(){var _13=this.gridId;if(!_13){_13="grid-"+(this.xmlTagName?this.xmlTagName+"-":"")+dojox.uuid.generateRandomUuid();}this.grid=new misys.openaccount.widget.DatagridBPO({jsId:_13,id:_13,store:this.store,structure:this.layout,autoHeight:true,selectionMode:"multiple",columnReordering:true,autoWidth:true,initialWidth:"100%",canSort:function(){return true;},showMoveOptions:this.showMoveOptions},document.createElement("div"));this.grid.gridMultipleItemsWidget=this;misys.connect(this.grid,"onStyleRow",dojo.hitch(this,function(row){var _14=this.grid.getItem(row.index);if(_14&&_14.hasOwnProperty("is_valid")){var _15=dojo.isArray(_14.is_valid)?_14.is_valid[0]:_14.is_valid;if(_15&&_15!=="Y"){row.customStyles+="background-color: #F9F7BA !important";this.state="Error";}}this.grid.focus.styleRow(row);this.grid.edit.styleRow(row);}));this.addChild(this.grid);this.onGridCreate();},itemToXML:function(_16,_17){var xml=[];var _18="";var _19="";var _1a="";var _1b="";var _1c="";var _1d="";var _1e="";var _1f="";var _20="";var _21="";var _22="";var _23="";var _24="";var _25="";var _26=false;dojo.forEach(_16,function(_27){_21="";_1f="";_20="";_18="";_19="";_1a="";_1b="";_1c="";_1e="";_23="";_22="";_24="";_25="<PmtTerms>";_1d="";_21=_21.concat("<Prtry>");_1f=_1f.concat("<OblgrBk>");_20=_20.concat("<RcptBk>");_18=_18.concat("<Chrgs>");_19=_19.concat("<PmtCd>");_1a=_1a.concat("<NmAndAdr>");_1b=_1b.concat("<SttlmTerms><CdtrAgt>");_1e=_1e.concat("<Adr>");_23=_23.concat("<Tp>");_22=_22.concat("<Id>");if(_27){if(_17){xml.push("<",_17,">");}for(var _28 in _27){_26=false;if(_28!="store_id"&&_28.match("^_")!="_"){if(_28==="payment_obligations_paymnt_terms"){if(_27[_28][0]===""){_19=_19.concat("</PmtCd>");_25=_25.concat(_19).concat("</PmtTerms>");}else{var _29=_27[_28][0]._values.length;var _2a=_27[_28][0]._values;if(_29===0){_25=_25.concat("</PmtTerms>");}for(var j=0;j<_29;j++){var _2b="";if(j>0){_1d="";_19="";_1d=_1d.concat("<PmtTerms>");_19=_19.concat("<PmtCd>");}var _2c=_2a[j];for(var _2d in _2c){_26=false;value=_2c[_2d];value+="";for(var _2e in this.paymentCodeMap){if(this.paymentCodeMap[_2e]._fieldName===_2d){_19=_19.concat("<").concat(_2e).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_2e).concat(">");_26=true;break;}}if(_26===true){continue;}for(var _2f in this.paymentTermMap){if(this.paymentTermMap[_2f]._fieldName===_2d){_1d=_1d.concat("<").concat(_2f).concat(">").concat(dojox.html.entities.encode(value.toString(),dojox.html.entities.html)).concat("</").concat(_2f).concat(">");_26=true;break;}}if(_26===true){continue;}for(var _30 in this.paymentTermAmountMap){if(this.paymentTermAmountMap[_30]._fieldName===_2d&&"Amt"===_30&&value!==""){var _31=dijit.byId("total_net_cur_code")?dijit.byId("total_net_cur_code").get("value"):"";_2b=_2b.concat("<").concat(_30," Ccy=\"",_31,"\"").concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_30).concat(">");}else{if(this.paymentTermAmountMap[_30]._fieldName===_2d&&value!==""){_2b=_2b.concat("<").concat(_30).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_30).concat(">");}}}if(_26===true){continue;}}_19=_19.concat("</PmtCd>");_25=_25.concat(_1d).concat(_19).concat(_2b).concat("</PmtTerms>");}}}value=dojo.isArray(_27[_28])?_27[_28][0]:_27[_28];value+="";if(_28==="buyer_bank_bpo"){xml.push("<",_28,">",dojox.html.entities.encode(value,dojox.html.entities.html),"</",_28,">");}for(var _32 in this.obligorBankMap){if(this.obligorBankMap[_32]._fieldName===_28){_1f=_1f.concat("<").concat(_32).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_32).concat(">");_26=true;break;}}if(_26===true){continue;}for(var _33 in this.recipientBankMap){if(this.recipientBankMap[_33]._fieldName===_28){_20=_20.concat("<").concat(_33).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_33).concat(">");_26=true;break;}}if(_26===true){continue;}for(var _34 in this.extraPropertiesMap){if(this.extraPropertiesMap[_34]._fieldName===_28){if(_34==="XpryDt"&&value!==""){var _35=value.split("/");var _36=new Date(_35[2],(_35[1]-1),_35[0]);value=dojo.date.stamp.toISOString(_36,{selector:"date"});}if(("Amt"===_34||"ChrgsAmt"===_34)&&value!==""){var _37=dijit.byId("total_net_cur_code")?dijit.byId("total_net_cur_code").get("value"):"";_24=_24.concat("<",_34," Ccy=\"",_37,"\"",">",dojox.html.entities.encode(value,dojox.html.entities.html),"</",_34,">");}else{if(value!==""){_24=_24.concat("<",_34,">",dojox.html.entities.encode(value,dojox.html.entities.html),"</",_34,">");}}_26=true;break;}}if(_26===true){continue;}for(var _38 in this.settlementTermsMap){if(this.settlementTermsMap[_38]._fieldName===_28){_1b=_1b.concat("<").concat(_38).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_38).concat(">");_26=true;break;}}if(_26===true){continue;}for(var _39 in this.creditorNameMap){if(this.creditorNameMap[_39]._fieldName===_28){_1a=_1a.concat("<").concat(_39).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_39).concat(">");_26=true;break;}}if(_26===true){continue;}for(var _3a in this.creditorAddressMap){if(this.creditorAddressMap[_3a]._fieldName===_28){_1e=_1e.concat("<").concat(_3a).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_3a).concat(">");_26=true;break;}}if(_26===true){continue;}for(var _3b in this.creditorAccountIdMap){if(this.creditorAccountIdMap[_3b]._fieldName===_28){if(_3b=="PrtryAcct"&&value!=""){_22=_22.concat("<").concat(_3b).concat(">").concat("<Id>").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</Id>").concat("</").concat(_3b).concat(">");}else{_22=_22.concat("<").concat(_3b).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_3b).concat(">");}_26=true;break;}}if(_26===true){continue;}for(var _3c in this.creditorAccountTypeMap){if(this.creditorAccountTypeMap[_3c]._fieldName===_28){_23=_23.concat("<").concat(_3c).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_3c).concat(">");_26=true;break;}}if(_26===true){continue;}for(var _3d in this.creditorAccountMap){if(this.creditorAccountMap[_3d]._fieldName===_28){_1c=_1c.concat("<").concat(_3d).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_3d).concat(">");_26=true;break;}}if(_26===true){continue;}}}_1e=_1e.concat("</Adr>");_1a=_1a.concat(_1e);_1a=_1a.concat("</NmAndAdr>");_23=_23.concat("</Tp>");_22=_22.concat("</Id>");var _3e="<CdtrAcct>";_3e=_3e.concat(_22).concat(_23).concat(_1c).concat("</CdtrAcct>");_1b=_1b.concat(_1a).concat("</CdtrAgt>").concat(_3e).concat("</SttlmTerms>");_1f=_1f.concat("</OblgrBk>");_20=_20.concat("</RcptBk>");xml.push(_1f,_20,_24,_25,_1b);if(_17){xml.push("</",_17,">");}}},this);return xml.join("");}});}