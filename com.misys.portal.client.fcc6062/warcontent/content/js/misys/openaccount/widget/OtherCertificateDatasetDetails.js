/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.openaccount.widget.OtherCertificateDatasetDetails"]){dojo._hasResource["misys.openaccount.widget.OtherCertificateDatasetDetails"]=true;dojo.provide("misys.openaccount.widget.OtherCertificateDatasetDetails");dojo.experimental("misys.openaccount.widget.OtherCertificateDatasetDetails");dojo.require("misys.grid.GridMultipleItems");dojo.require("misys.openaccount.widget.OtherCertificateDatasetDetail");dojo.require("misys.openaccount.widget.OtherCertificateSubmittrBics");dojo.declare("misys.openaccount.widget.OtherCertificateDatasetDetails",[misys.grid.GridMultipleItems],{data:{identifier:"store_id",label:"store_id",items:[]},handle:null,templatePath:null,templateString:dojo.byId("other-certificate-ds-details-template").innerHTML,dialogId:"other-certificate-ds-details-dialog-template",xmlTagName:"other_certificate_dataset",xmlSubTagName:"OthrCertDataSetReqrd",gridColumns:["ocds_cert_type","ocds_cert_type_hidden","other_certificate_dataset_bic"],propertiesMap:{CertTp:{_fieldName:"ocds_cert_type"},OcdsCertTypeHidden:{_fieldName:"ocds_cert_type_hidden"},OtherCertificateBIC:{_fieldName:"other_certificate_dataset_bic",_type:"misys.openaccount.widget.OtherCertificateSubmittrBics"}},outerFieldsMap:{CertTp:{_fieldName:"ocds_cert_type"}},bicMap:{BIC:{_fieldName:"ocds_bic"}},typeMap:{"misys.openaccount.widget.OtherCertificateSubmittrBics":{"type":Array,"deserialize":function(_1){var _2={};_2._type="misys.openaccount.widget.OtherCertificateSubmittrBics";_2._values=_1;return _2;}}},layout:[{name:"ocds_cert_type_hidden",field:"ocds_cert_type_hidden",width:"90%"},{name:" ",field:"actions",formatter:misys.grid.formatReportActions,width:"10%"},{name:"Id",field:"store_id",headerStyles:"display:none",cellStyles:"display:none"}],mandatoryFields:[],startup:function(){this.inherited(arguments);},openDialogFromExistingItem:function(_3,_4){this.inherited(arguments);},resetDialog:function(_5,_6){this.inherited(arguments);},addItem:function(_7){this.inherited(arguments);},updateData:function(_8){this.inherited(arguments);},createDataGrid:function(){this.inherited(arguments);},createJsonItem:function(){var _9=[];if(this.hasChildren&&this.hasChildren()){dojo.forEach(this.getChildren(),function(_a){if(_a.createItem){var _b=_a.createItem();_9.push(_b);if(this.get("is_valid")!=="N"){this.set("is_valid",_b.is_valid?_b.is_valid:"Y");}misys._widgetsToDestroy=misys._widgetsToDestroy||[];misys._widgetsToDestroy.push(_a.id);}},this);}return _9;},toXML:function(){var _c=[];if(this.xmlTagName){_c.push("<",this.xmlTagName,">");}_c.push("<![CDATA[");if(this.grid){this.grid.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(this,function(_d,_e){_c.push(this.itemToXML(_d,this.xmlSubTagName));})});}_c.push("]]>");if(this.xmlTagName){_c.push("</",this.xmlTagName,">");}return _c.join("");},itemToXML:function(_f,_10){var xml=[];dojo.forEach(_f,function(_11){certXml="";if(_11){if(_10){xml.push("<",_10,">");}for(var _12 in _11){if(_12!="store_id"&&_12.match("^_")!="_"){if(_12==="other_certificate_dataset_bic"&&_11[_12][0]._values){var _13=_11[_12][0]._values.length;var _14=_11[_12][0]._values;for(var i=0;i<_13;i++){var p1=_14[i];for(var _15 in p1){value=p1[_15];value+="";for(var _16 in this.bicMap){if(this.bicMap[_16]._fieldName===_15){xml.push("<Submitr>");xml.push("<",_16,">",dojox.html.entities.encode(value,dojox.html.entities.html),"</",_16,">");xml.push("</Submitr>");break;}}}}}value=dojo.isArray(_11[_12])?_11[_12][0]:_11[_12];value+="";for(var _17 in this.outerFieldsMap){if(this.outerFieldsMap[_17]._fieldName===_12){certXml=certXml.concat("<").concat(_17).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_17).concat(">");break;}}}}xml.push(certXml);if(_10){xml.push("</",_10,">");}}},this);return xml.join("");},createItemsFromJson:function(_18){this.inherited(arguments);},performValidation:function(){var _19=true;if(this.validateDialog(true)){var _1a=dijit.byId("other_certificate_dataset_bic");if(!(_1a&&_1a.store&&_1a.store._arrayOfTopLevelItems.length>0)){_19=false;misys.dialog.show("ERROR",misys.getLocalization("bicCodeMandatoryError"));}if(_19){this.inherited(arguments);}}}});}