/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.openaccount.widget.InsuranceDatasetDetails"]){dojo._hasResource["misys.openaccount.widget.InsuranceDatasetDetails"]=true;dojo.provide("misys.openaccount.widget.InsuranceDatasetDetails");dojo.experimental("misys.openaccount.widget.InsuranceDatasetDetails");dojo.require("misys.grid.GridMultipleItems");dojo.require("misys.openaccount.widget.InsuranceDatasetDetail");dojo.require("misys.openaccount.widget.InsuranceSubmittrBics");dojo.require("misys.openaccount.widget.InsuranceRequiredClauses");dojo.declare("misys.openaccount.widget.InsuranceDatasetDetails",[misys.grid.GridMultipleItems],{data:{identifier:"store_id",label:"store_id",items:[]},handle:null,templatePath:null,templateString:dojo.byId("insurance-ds-details-template").innerHTML,dialogId:"insurance-ds-details-dialog-template",xmlTagName:"insurance_dataset",xmlSubTagName:"InsrncDataSetReqrd",gridColumns:["ids_match_issuer_name","ids_match_issuer_country","ids_identification","ids_identification_type","ids_match_iss_date","ids_match_amount","ids_match_transport","ids_match_assured_party","insurance_dataset_req_clause","insurance_dataset_bic"],propertiesMap:{Nm:{_fieldName:"ids_match_issuer_name"},Ctry:{_fieldName:"ids_match_issuer_country"},Id:{_fieldName:"ids_identification"},IdTp:{_fieldName:"ids_identification_type"},MtchIsseDt:{_fieldName:"ids_match_iss_date"},MtchTrnsprt:{_fieldName:"ids_match_transport"},MtchAmt:{_fieldName:"ids_match_amount"},MtchAssrdPty:{_fieldName:"ids_match_assured_party"},InsuranceBIC:{_fieldName:"insurance_dataset_bic",_type:"misys.openaccount.widget.InsuranceSubmittrBics"},ReqrdClauses:{_fieldName:"insurance_dataset_req_clause",_type:"misys.openaccount.widget.InsuranceRequiredClauses"}},matchIssuerMap:{Nm:{_fieldName:"ids_match_issuer_name"}},matchIssuerCtryMap:{Ctry:{_fieldName:"ids_match_issuer_country"}},propIdMap:{Id:{_fieldName:"ids_identification"},IdTp:{_fieldName:"ids_identification_type"}},outerFieldsMap:{MtchIsseDt:{_fieldName:"ids_match_iss_date"},MtchTrnsprt:{_fieldName:"ids_match_transport"}},outerAmtMap:{MtchAmt:{_fieldName:"ids_match_amount"}},bicMap:{BIC:{_fieldName:"ids_bic"}},ClausesReqrdMap:{ClausesReqrd:{_fieldName:"ids_clauses_required"}},matchAssuredPrtyMap:{MtchAssrdPty:{_fieldName:"ids_match_assured_party"}},typeMap:{"misys.openaccount.widget.InsuranceSubmittrBics":{"type":Array,"deserialize":function(_1){var _2={};_2._type="misys.openaccount.widget.InsuranceSubmittrBics";_2._values=_1;return _2;}},"misys.openaccount.widget.InsuranceRequiredClauses":{"type":Array,"deserialize":function(_3){var _4={};_4._type="misys.openaccount.widget.InsuranceRequiredClauses";_4._values=_3;return _4;}}},layout:[{name:"ids_match_issuer_name",field:"ids_match_issuer_name",width:"90%"},{name:" ",field:"actions",formatter:misys.grid.formatReportActions,width:"10%"},{name:"Id",field:"store_id",headerStyles:"display:none",cellStyles:"display:none"}],mandatoryFields:[],startup:function(){this.inherited(arguments);},openDialogFromExistingItem:function(_5,_6){this.inherited(arguments);},addItem:function(_7){this.inherited(arguments);},createJsonItem:function(){var _8=[];if(this.hasChildren&&this.hasChildren()){dojo.forEach(this.getChildren(),function(_9){if(_9.createItem){var _a=_9.createItem();_8.push(_a);if(this.get("is_valid")!=="N"){this.set("is_valid",_a.is_valid?_a.is_valid:"Y");}misys._widgetsToDestroy=misys._widgetsToDestroy||[];misys._widgetsToDestroy.push(_9.id);}},this);}return _8;},createDataGrid:function(){this.inherited(arguments);var _b=this.grid;var _c=dijit.byId("insurance-ds-details");misys.connect(_b,"onDelete",function(){misys.dialog.connect(dijit.byId("okButton"),"onMouseUp",function(){_c.addButtonNode.set("disabled",false);},"alertDialog");});},toXML:function(){var _d=[];if(this.xmlTagName){_d.push("<",this.xmlTagName,">");}_d.push("<![CDATA[");if(this.grid){this.grid.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(this,function(_e,_f){_d.push(this.itemToXML(_e,this.xmlSubTagName));})});}_d.push("]]>");if(this.xmlTagName){_d.push("</",this.xmlTagName,">");}return _d.join("");},itemToXML:function(_10,_11){var xml=[];var _12="";var _13="";dojo.forEach(_10,function(_14){_12="";_13="";clausesXml="";outerFieldsXml="";matchIssPrtyXml="";outerAmtXml="";mtchIssuerCtry="";_12=_12.concat("<MtchIssr>");_13=_13.concat("<PrtryId>");if(_14){if(_11){xml.push("<",_11,">");}for(var _15 in _14){if(_15!="store_id"&&_15.match("^_")!="_"){if(_15==="insurance_dataset_bic"&&_14[_15][0]._values){var _16=_14[_15][0]._values.length;var _17=_14[_15][0]._values;for(var i=0;i<_16;i++){var p1=_17[i];for(var _18 in p1){value=p1[_18];value+="";for(var _19 in this.bicMap){if(this.bicMap[_19]._fieldName===_18){xml.push("<Submitr>");xml.push("<",_19,">",dojox.html.entities.encode(value,dojox.html.entities.html),"</",_19,">");xml.push("</Submitr>");break;}}}}}if(_15==="insurance_dataset_req_clause"&&_14[_15][0]._values){var _1a=_14[_15][0]._values.length;var _1b=_14[_15][0]._values;for(var j=0;j<_1a;j++){var _1c=_1b[j];for(var _1d in _1c){value=_1c[_1d];value+="";for(var _1e in this.ClausesReqrdMap){if(this.ClausesReqrdMap[_1e]._fieldName===_1d){clausesXml=clausesXml.concat("<").concat(_1e).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_1e).concat(">");break;}}}}}value=dojo.isArray(_14[_15])?_14[_15][0]:_14[_15];value+="";for(var _1f in this.outerFieldsMap){if(this.outerFieldsMap[_1f]._fieldName===_15){if(value!=null&&value=="Y"){value="true";}else{value="false";}outerFieldsXml=outerFieldsXml.concat("<").concat(_1f).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_1f).concat(">");break;}}for(var _20 in this.matchIssuerMap){if(this.matchIssuerMap[_20]._fieldName===_15){_12=_12.concat("<").concat(_20).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_20).concat(">");break;}}for(var _21 in this.propIdMap){if(this.propIdMap[_21]._fieldName===_15){_13=_13.concat("<").concat(_21).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_21).concat(">");break;}}for(var _22 in this.matchAssuredPrtyMap){if(this.matchAssuredPrtyMap[_22]._fieldName===_15){matchIssPrtyXml=matchIssPrtyXml.concat("<").concat(_22).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_22).concat(">");break;}}for(var _23 in this.outerAmtMap){if(this.outerAmtMap[_23]._fieldName===_15){if(value!=null&&value=="Y"){value="true";}else{value="false";}outerAmtXml=outerAmtXml.concat("<").concat(_23).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_23).concat(">");break;}}for(var _24 in this.matchIssuerCtryMap){if(this.matchIssuerCtryMap[_24]._fieldName===_15){mtchIssuerCtry=mtchIssuerCtry.concat("<").concat(_24).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_24).concat(">");break;}}}}_13=_13.concat("</PrtryId>");_12=_12.concat(_13).concat(mtchIssuerCtry);_12=_12.concat("</MtchIssr>").concat(outerFieldsXml).concat(outerAmtXml).concat(clausesXml).concat(matchIssPrtyXml);xml.push(_12);if(_11){xml.push("</",_11,">");}}},this);return xml.join("");},createItemsFromJson:function(_25){this.inherited(arguments);},updateData:function(){this.inherited(arguments);dijit.byId("add_insurance_ds_button").set("disabled",true);},performValidation:function(){var _26=true;if(this.validateDialog(true)){var _27=dijit.byId("insurance_dataset_bic");if(!(_27&&_27.store&&_27.store._arrayOfTopLevelItems.length>0)){_26=false;misys.dialog.show("ERROR",misys.getLocalization("bicCodeMandatoryError"));}if(_26){this.inherited(arguments);}}}});}