/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.openaccount.widget.Taxes"]){dojo._hasResource["misys.openaccount.widget.Taxes"]=true;dojo.provide("misys.openaccount.widget.Taxes");dojo.experimental("misys.openaccount.widget.Taxes");dojo.require("misys.grid.GridMultipleItems");dojo.require("misys.openaccount.widget.Tax");dojo.declare("misys.openaccount.widget.Taxes",[misys.grid.GridMultipleItems],{data:{identifier:"store_id",label:"store_id",items:[]},templatePath:null,templateString:dojo.byId("taxes-template").innerHTML,dialogId:"tax-dialog-template",xmlTagName:"taxes",xmlSubTagName:"tax",gridColumns:["type","type_label","other_type","cur_code","amt","rate"],propertiesMap:{tnx_id:{_fieldName:"tnx_id"},ref_id:{_fieldName:"ref_id"},allowance_id:{_fieldName:"allowance_id"},type:{_fieldName:"tax_type"},type_label:{_fieldName:"tax_type_label"},other_type:{_fieldName:"tax_other_type"},cur_code:{_fieldName:"tax_cur_code"},amt:{_fieldName:"tax_amt"},rate:{_fieldName:"tax_rate"}},layout:[{name:"Tax Type",field:"type_label",width:"35%"},{name:"Ccy",field:"cur_code",width:"15%"},{name:"Amount/Rate",get:misys.getAmountRate,width:"40%"},{name:" ",field:"actions",formatter:misys.grid.formatReportActions,width:"10%"}],getMandatoryProperties:function(_1){var _2=[];_2.push("type");_2.push(_1.amt==""?"rate":"amt");return _2;},startup:function(){this.dataList=[];if(this.hasChildren()){dojo.forEach(this.getChildren(),function(_3){if(_3.createItem){var _4=_3.createItem();this.dataList.push(_4);}},this);}this.inherited(arguments);},openDialogFromExistingItem:function(_5,_6){if(misys._config.displayMode==="view"){misys.disconnectById("tax_amt");misys.disconnectById("tax_rate");}this.inherited(arguments);},resetDialog:function(_7){this.inherited(arguments);this.defaultTaxesCurrency();},defaultTaxesCurrency:function(){if(dijit.byId("total_cur_code")){dijit.byId("tax_cur_code").set("value",dijit.byId("total_cur_code").get("value"));}},createDataGrid:function(){this.inherited(arguments);var _8=this.grid;misys.connect(_8,"onDelete",function(){misys.dialog.connect(dijit.byId("okButton"),"onMouseUp",function(){if(dijit.byId("line_item_taxes")&&dijit.byId("line_item_taxes").grid){setTimeout(dojo.hitch(misys,"computeLineItemAmount"),1000);}else{if(dijit.byId("po-taxes")&&dijit.byId("po-taxes").grid){setTimeout(dojo.hitch(misys,"computePOTotalAmount"),1000);}}},"alertDialog");});},addItem:function(_9){if(this.id.match("^po-")=="po-"&&misys.checkLineItemChildrens()){misys.dialog.show("ERROR",misys.getLocalization("tooManyPODetailsError"));return;}else{if(this.id.match("^line_item_")=="line_item_"&&misys.checkPOChildrens()){misys.dialog.show("ERROR",misys.getLocalization("tooManyPODetailsError"));return;}}this.inherited(arguments);},createItemsFromJson:function(_a){this.inherited(arguments);},updateData:function(_b){this.inherited(arguments);if(dijit.byId("line_item_taxes")&&dijit.byId("line_item_taxes").grid){misys.computeLineItemAmount();}else{if(dijit.byId("po-taxes")&&dijit.byId("po-taxes").grid){misys.computePOTotalAmount();}}},performValidation:function(){if(this.validateDialog(true)){if(dijit.byId("tax_amt")&&isNaN(dijit.byId("tax_amt").get("value"))&&dijit.byId("tax_rate")&&isNaN(dijit.byId("tax_rate").get("value"))){misys.dialog.show("ERROR",misys.getLocalization("addAmtOrRate"));}else{this.inherited(arguments);}}misys.markFormDirty();}});}