/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.openaccount.widget.Adjustments"]){dojo._hasResource["misys.openaccount.widget.Adjustments"]=true;dojo.provide("misys.openaccount.widget.Adjustments");dojo.experimental("misys.openaccount.widget.Adjustments");dojo.require("misys.grid.GridMultipleItems");dojo.require("misys.openaccount.widget.Adjustment");dojo.declare("misys.openaccount.widget.Adjustments",[misys.grid.GridMultipleItems],{data:{identifier:"store_id",label:"store_id",items:[]},templatePath:null,templateString:dojo.byId("adjustments-template").innerHTML,dialogId:"adjustment-dialog-template",xmlTagName:"adjustments",xmlSubTagName:"adjustment",gridColumns:["type","type_label","other_type","direction","cur_code","amt","rate","cn_reference_id","discount_exp_date","type_hidden"],propertiesMap:{tnx_id:{_fieldName:"tnx_id"},ref_id:{_fieldName:"ref_id"},allowance_id:{_fieldName:"allowance_id"},type:{_fieldName:"adjustment_type"},type_label:{_fieldName:"adjustment_type_label"},other_type:{_fieldName:"adjustment_other_type"},direction:{_fieldName:"adjustment_direction"},direction_label:{_fieldName:"adjustment_direction_label"},cur_code:{_fieldName:"adjustment_cur_code"},amt:{_fieldName:"adjustment_amt"},rate:{_fieldName:"adjustment_rate"},type_hidden:{_fieldName:"type_hidden"},cn_reference_id:{_fieldName:"cn_reference_id"},discount_exp_date:{_fieldName:"discount_exp_date"}},layout:[{name:"Adjustment Type",field:"type",get:misys.getAdjustmentType,width:"35%"},{name:"Ccy",field:"cur_code",width:"15%"},{name:"Amount/Rate",field:"amt",get:misys.getAdjustmentAmountRate,width:"40%"},{name:" ",field:"actions",formatter:misys.grid.formatReportActions,width:"10%"}],getMandatoryProperties:function(_1){var _2=[];_2.push("type");if(_1&&_1.amt==""&&_1.rate==""){_2.push("amt");_2.push("cur_code");}return _2;},openDialogFromExistingItem:function(_3,_4){if(misys._config.displayMode==="view"){misys.disconnectById("adjustment_amt");misys.disconnectById("adjustment_rate");}if(_3&&_3[0]&&_3[0].other_type&&_3[0].other_type[0]){_3[0].other_type[0]=dojox.html.entities.decode(_3[0].other_type[0],dojox.html.entities.html);}this.inherited(arguments);},defaultAdjustmentCurrency:function(){if(dijit.byId("total_cur_code")){dijit.byId("adjustment_cur_code").set("value",dijit.byId("total_cur_code").get("value"));}},createDataGrid:function(){this.inherited(arguments);var _5=this.grid;misys.connect(_5,"onDelete",function(){misys.dialog.connect(dijit.byId("okButton"),"onMouseUp",function(){if(dijit.byId("line_item_adjustments")&&dijit.byId("line_item_adjustments").grid){setTimeout(dojo.hitch(misys,"computeLineItemAmount"),1000);}else{if(dijit.byId("po-adjustments")&&dijit.byId("po-adjustments").grid){setTimeout(dojo.hitch(misys,"computePOTotalAmount"),1000);}}},"alertDialog");});},resetDialog:function(_6){this.inherited(arguments);this.defaultAdjustmentCurrency();},addItem:function(_7){if(this.id.match("^po-")=="po-"&&misys.checkLineItemChildrens()){misys.dialog.show("ERROR",misys.getLocalization("tooManyPODetailsError"));return;}else{if(this.id.match("^line_item_")=="line_item_"&&misys.checkPOChildrens()){misys.dialog.show("ERROR",misys.getLocalization("tooManyPODetailsError"));return;}}this.inherited(arguments);},updateData:function(_8){this.inherited(arguments);if(dijit.byId("line_item_adjustments")&&dijit.byId("line_item_adjustments").grid){misys.computeLineItemAmount();}else{if(dijit.byId("po-adjustments")&&dijit.byId("po-adjustments").grid){misys.computePOTotalAmount();}}misys.markFormDirty();},performValidation:function(){var _9=new Date();if(this.validateDialog(true)){if(dijit.byId("adjustment_amt")&&isNaN(dijit.byId("adjustment_amt").get("value"))&&dijit.byId("adjustment_rate")&&isNaN(dijit.byId("adjustment_rate").get("value"))){misys.dialog.show("ERROR",misys.getLocalization("addAmtOrRate"));}else{if(dijit.byId("adjustment_direction_1").get("checked")!==true&&dijit.byId("adjustment_direction_2").get("checked")!==true){misys.dialog.show("ERROR",misys.getLocalization("selectAdjustmentDirectionError"));}else{if(dijit.byId("discount_exp_date")&&(dijit.byId("discount_exp_date").get("value")==null||dijit.byId("discount_exp_date").get("value")=="")&&dijit.byId("adjustment_type")&&dijit.byId("adjustment_type").get("value")=="DISC"){misys.dialog.show("ERROR",misys.getLocalization("expiryDateMandatoryError"));}else{if(dijit.byId("discount_exp_date")&&dijit.byId("discount_exp_date").get("value")!=null&&dijit.byId("discount_exp_date").get("value")!=""&&_9.setHours(0,0,0,0)>(dijit.byId("discount_exp_date").get("value")).setHours(0,0,0,0)){misys.dialog.show("ERROR",misys.getLocalization("selectExpiryDateError"));}else{this.inherited(arguments);}}}}}}});}