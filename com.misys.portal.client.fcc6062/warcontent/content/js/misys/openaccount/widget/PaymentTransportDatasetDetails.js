/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.openaccount.widget.PaymentTransportDatasetDetails"]){dojo._hasResource["misys.openaccount.widget.PaymentTransportDatasetDetails"]=true;dojo.provide("misys.openaccount.widget.PaymentTransportDatasetDetails");dojo.experimental("misys.openaccount.widget.PaymentTransportDatasetDetails");dojo.require("misys.grid.GridMultipleItems");dojo.require("misys.openaccount.widget.PaymentTransportDatasetDetail");dojo.require("misys.openaccount.widget.TransportDocumentReferences");dojo.require("misys.openaccount.widget.TransportedGoodsDetails");dojo.require("misys.openaccount.widget.ConsignmentQtyDetails");dojo.require("misys.openaccount.widget.ConsignmentVolDetails");dojo.require("misys.openaccount.widget.ConsignmentWeightDetails");dojo.declare("misys.openaccount.widget.PaymentTransportDatasetDetails",[misys.grid.GridMultipleItems],{data:{identifier:"store_id",label:"store_id",items:[]},handle:null,templatePath:null,templateString:dojo.byId("payment-transport-ds-details-template").innerHTML,dialogId:"payment-transport-ds-details-dialog-template",xmlTagName:"TrnsprtDataSet",gridColumns:["payment_tds_version","payment_tds_id","payment_tds_bic","payment_tds_prop_date","payment_tds_actual_date","payment_tds_dataset_transported_goods","payment_tds_dataset_transport_doc_ref","consignment_qty_details_id","consignment_vol_details_id","consignment_weight_details_id"],propertiesMap:{payment_tds_version:{_fieldName:"payment_tds_version"},payment_tds_id:{_fieldName:"payment_tds_id"},payment_tds_bic:{_fieldName:"payment_tds_bic"},payment_tds_prop_date:{_fieldName:"payment_tds_prop_date"},payment_tds_actual_date:{_fieldName:"payment_tds_actual_date"},transportedGoods:{_fieldName:"payment_tds_dataset_transported_goods",_type:"misys.openaccount.widget.TransportedGoodsDetails"},transportDocReference:{_fieldName:"payment_tds_dataset_transport_doc_ref",_type:"misys.openaccount.widget.TransportDocumentReferences"},consignmentQtyDtls:{_fieldName:"consignment_qty_details_id",_type:"misys.openaccount.widget.TransportDocumentReferences"},consignmentVolDtls:{_fieldName:"consignment_vol_details_id",_type:"misys.openaccount.widget.TransportDocumentReferences"},consignmentWeightDtls:{_fieldName:"consignment_weight_details_id",_type:"misys.openaccount.widget.TransportDocumentReferences"}},dataSetIdMap:{payment_tds_version:{_fieldName:"payment_tds_version"},payment_tds_id:{_fieldName:"payment_tds_id"},bic:{_fieldName:"payment_tds_bic"},payment_tds_prop_date:{_fieldName:"payment_tds_prop_date"},payment_tds_actual_date:{_fieldName:"payment_tds_actual_date"}},transportedGoodsMap:{payment_tds_po_ref_id:{_fieldName:"payment_tds_po_ref_id"},payment_tds_goods_desc:{_fieldName:"payment_tds_goods_desc"}},consgQtyMap:{pmt_tds_qty_unit_measr_code:{_fieldName:"pmt_tds_qty_unit_measr_code"},pmt_tds_qty_unit_measr_other:{_fieldName:"pmt_tds_qty_unit_measr_other"},pmt_tds_qty_val:{_fieldName:"pmt_tds_qty_val"}},consgVolMap:{pmt_tds_vol_unit_measr_code:{_fieldName:"pmt_tds_vol_unit_measr_code"},pmt_tds_vol_unit_measr_other:{_fieldName:"pmt_tds_vol_unit_measr_other"},pmt_tds_vol_val:{_fieldName:"pmt_tds_vol_val"}},consgWeightMap:{pmt_tds_weight_unit_measr_code:{_fieldName:"pmt_tds_weight_unit_measr_code"},pmt_tds_weight_unit_measr_other:{_fieldName:"pmt_tds_weight_unit_measr_other"},pmt_tds_weight_val:{_fieldName:"pmt_tds_weight_val"}},transportedDocRefMap:{payment_tds_doc_id:{_fieldName:"payment_tds_doc_id"},payment_tds_doc_iss_date:{_fieldName:"payment_tds_doc_iss_date"}},layout:[{name:"ID",field:"payment_tds_id",width:"30%"},{name:"Bic",field:"payment_tds_bic",width:"30%"},{name:"Version",field:"payment_tds_version",width:"30%"},{name:" ",field:"actions",formatter:misys.grid.formatReportActions,width:"10%"},{name:"Id",field:"store_id",headerStyles:"display:none",cellStyles:"display:none"}],typeMap:{"misys.openaccount.widget.TransportedGoodsDetails":{"type":Array,"deserialize":function(_1){var _2={};_2._type="misys.openaccount.widget.TransportedGoodsDetails";_2._values=_1;return _2;}},"misys.openaccount.widget.TransportDocumentReferences":{"type":Array,"deserialize":function(_3){var _4={};_4._type="misys.openaccount.widget.TransportDocumentReferences";_4._values=_3;return _4;}},"misys.openaccount.widget.ConsignmentWeightDetails":{"type":Array,"deserialize":function(_5){var _6={};_6._type="misys.openaccount.widget.ConsignmentWeightDetails";_6._values=_5;return _6;}},"misys.openaccount.widget.ConsignmentQtyDetails":{"type":Array,"deserialize":function(_7){var _8={};_8._type="misys.openaccount.widget.ConsignmentQtyDetails";_8._values=_7;return _8;}},"misys.openaccount.widget.ConsignmentVolDetails":{"type":Array,"deserialize":function(_9){var _a={};_a._type="misys.openaccount.widget.ConsignmentVolDetails";_a._values=_9;return _a;}}},mandatoryFields:["payment_tds_bic"],startup:function(){this.inherited(arguments);},openDialogFromExistingItem:function(_b,_c){this.inherited(arguments);},addItem:function(_d){this.inherited(arguments);},createDataGrid:function(){this.inherited(arguments);var _e=this.grid;var _f=dijit.byId("payment-transport-ds-details");misys.connect(_e,"onDelete",function(){misys.dialog.connect(dijit.byId("okButton"),"onMouseUp",function(){_f.addButtonNode.set("disabled",false);},"alertDialog");});},createJsonItem:function(){var _10=[];if(this.hasChildren&&this.hasChildren()){dojo.forEach(this.getChildren(),function(_11){if(_11.createItem){var _12=_11.createItem();_10.push(_12);if(this.get("is_valid")!=="N"){this.set("is_valid",_12.is_valid?_12.is_valid:"Y");}misys._widgetsToDestroy=misys._widgetsToDestroy||[];misys._widgetsToDestroy.push(_11.id);}},this);}return _10;},updateData:function(){this.inherited(arguments);dijit.byId("add_pymt_transport_ds_button").set("disabled",true);},toXML:function(){var xml=[];xml.push("<payment_transport_dataset>");xml.push("<![CDATA[");if(this.grid){this.grid.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(this,function(_13,_14){xml.push(this.itemToXML(_13));})});}xml.push("]]>");xml.push("</payment_transport_dataset>");return xml.join("");},itemToXML:function(_15){var xml=[];var _16="";dojo.forEach(_15,function(_17){dataSetIdentificationXML="";dataSetIdentificationXML=dataSetIdentificationXML.concat("<DataSetId>");transportedGoods="";transportedGoods=transportedGoods.concat("<TrnsprtdGoods>");transportDocRef="";transportDocRef=transportDocRef.concat("<TrnsprtDocRef>");consgWeight="";consgQty="";consgVol="";consgnXML="";consgnXML=consgnXML.concat("<Consgnmt>");if(_17){if(this.xmlTagName){xml.push("<",this.xmlTagName,">");}for(var _18 in _17){if(_18!="store_id"&&_18.match("^_")!="_"){value=dojo.isArray(_17[_18])?_17[_18][0]:_17[_18];value+="";for(var _19 in this.dataSetIdMap){if(this.dataSetIdMap[_19]._fieldName===_18){dataSetIdentificationXML=dataSetIdentificationXML.concat("<").concat(_19).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_19).concat(">");break;}}if(_18==="payment_tds_dataset_transported_goods"&&_17[_18][0]._values){var _1a=_17[_18][0]._values.length;var _1b=_17[_18][0]._values;for(var i=0;i<_1a;i++){transportedGoods=transportedGoods.concat("<TrnsprtdGoodsDtls>");var p2=_1b[i];for(var _1c in p2){value=p2[_1c];value+="";for(var _1d in this.transportedGoodsMap){if(this.transportedGoodsMap[_1d]._fieldName===_1c){transportedGoods=transportedGoods.concat("<").concat(_1d).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_1d).concat(">");break;}}}transportedGoods=transportedGoods.concat("</TrnsprtdGoodsDtls>");}}if(_18==="payment_tds_dataset_transport_doc_ref"&&_17[_18][0]._values){var _1e=_17[_18][0]._values.length;var _1f=_17[_18][0]._values;for(var k=0;k<_1e;k++){transportDocRef=transportDocRef.concat("<TrnsprtDocRefDtls>");var p1=_1f[k];for(var _20 in p1){value=p1[_20];value+="";for(var _21 in this.transportedDocRefMap){if(this.transportedDocRefMap[_21]._fieldName===_20){transportDocRef=transportDocRef.concat("<").concat(_21).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_21).concat(">");break;}}}transportDocRef=transportDocRef.concat("</TrnsprtDocRefDtls>");}}if(_18==="consignment_weight_details_id"&&_17[_18][0]._values){var _22=_17[_18][0]._values.length;var _23=_17[_18][0]._values;for(var l=0;l<_22;l++){consgWeight=consgWeight.concat("<TtlWght>");var p5=_23[l];for(var _24 in p5){value=p5[_24];value+="";for(var _25 in this.consgWeightMap){if(this.consgWeightMap[_25]._fieldName===_24){consgWeight=consgWeight.concat("<").concat(_25).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_25).concat(">");break;}}}consgWeight=consgWeight.concat("</TtlWght>");}}if(_18==="consignment_qty_details_id"&&_17[_18][0]._values){var _26=_17[_18][0]._values.length;var _27=_17[_18][0]._values;for(var m=0;m<_26;m++){consgQty=consgQty.concat("<TtlQty>");var p3=_27[m];for(var _28 in p3){value=p3[_28];value+="";for(var _29 in this.consgQtyMap){if(this.consgQtyMap[_29]._fieldName===_28){consgQty=consgQty.concat("<").concat(_29).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_29).concat(">");break;}}}consgQty=consgQty.concat("</TtlQty>");}}if(_18==="consignment_vol_details_id"&&_17[_18][0]._values){var _2a=_17[_18][0]._values.length;var _2b=_17[_18][0]._values;for(var n=0;n<_2a;n++){consgVol=consgVol.concat("<TtlVol>");var p4=_2b[n];for(var _2c in p4){value=p4[_2c];value+="";for(var _2d in this.consgVolMap){if(this.consgVolMap[_2d]._fieldName===_2c){consgVol=consgVol.concat("<").concat(_2d).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_2d).concat(">");break;}}}consgVol=consgVol.concat("</TtlVol>");}}}}dataSetIdentificationXML=dataSetIdentificationXML.concat("</DataSetId>");transportedGoods=transportedGoods.concat("</TrnsprtdGoods>");transportDocRef=transportDocRef.concat("</TrnsprtDocRef>");consgnXML=consgnXML.concat(consgQty).concat(consgVol).concat(consgWeight).concat("</Consgnmt>");xml.push(dataSetIdentificationXML);xml.push(transportedGoods);xml.push(transportDocRef);xml.push(consgnXML);if(this.xmlTagName){xml.push("</",this.xmlTagName,">");}}},this);return xml.join("");},createItemsFromJson:function(_2e){this.inherited(arguments);},performValidation:function(){var _2f=true;if(this.validateDialog(true)){var _30=dijit.byId("payment_tds_dataset_transport_doc_ref");if(!(_30&&_30.store&&_30.store._arrayOfTopLevelItems.length>0)){_2f=false;misys.dialog.show("ERROR",misys.getLocalization("transportDocRefError"));}var _31=dijit.byId("payment_tds_dataset_transported_goods");if(_2f&&!(_31&&_31.store&&_31.store._arrayOfTopLevelItems.length>0)){_2f=false;misys.dialog.show("ERROR",misys.getLocalization("transportGoodsError"));}if(_2f){this.inherited(arguments);}}}});}