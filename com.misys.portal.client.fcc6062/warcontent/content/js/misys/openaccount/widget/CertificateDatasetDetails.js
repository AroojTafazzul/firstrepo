/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["misys.openaccount.widget.CertificateDatasetDetails"]){dojo._hasResource["misys.openaccount.widget.CertificateDatasetDetails"]=true;dojo.provide("misys.openaccount.widget.CertificateDatasetDetails");dojo.experimental("misys.openaccount.widget.CertificateDatasetDetails");dojo.require("misys.grid.GridMultipleItems");dojo.require("misys.openaccount.widget.CertificateDatasetDetail");dojo.require("misys.openaccount.widget.CertificateSubmittrBics");dojo.require("misys.openaccount.widget.CertificateLineItemIdentifications");dojo.declare("misys.openaccount.widget.CertificateDatasetDetails",[misys.grid.GridMultipleItems],{data:{identifier:"store_id",label:"store_id",items:[]},handle:null,templatePath:null,templateString:dojo.byId("certificate-ds-details-template").innerHTML,dialogId:"certificate-ds-details-dialog-template",xmlTagName:"certificate_dataset",xmlSubTagName:"CertDataSetReqrd",gridColumns:["ceds_cert_type","ceds_cert_type_hidden","ceds_match_issuer_name","ceds_match_issuer_country","ceds_identification","ceds_identification_type","ceds_match_iss_date","ceds_match_insp_date","ceds_match_insp_ind","ceds_match_consignee","ceds_match_mf_issuer_name","ceds_match_mf_issuer_country","ceds_match_mf_identification","ceds_match_mf_identification_type","certificate_dataset_bic","certificate_dataset_line_item_id"],propertiesMap:{CertTp:{_fieldName:"ceds_cert_type"},Nm:{_fieldName:"ceds_match_issuer_name"},Ctry:{_fieldName:"ceds_match_issuer_country"},Id:{_fieldName:"ceds_identification"},IdTp:{_fieldName:"ceds_identification_type"},MtchIsseDt:{_fieldName:"ceds_match_iss_date"},MtchInspctnDt:{_fieldName:"ceds_match_insp_date"},AuthrsdInspctrInd:{_fieldName:"ceds_match_insp_ind"},MtchConsgn:{_fieldName:"ceds_match_consignee"},NmMF:{_fieldName:"ceds_match_mf_issuer_name"},CtryMF:{_fieldName:"ceds_match_mf_issuer_country"},IdMF:{_fieldName:"ceds_match_mf_identification"},IdTpMF:{_fieldName:"ceds_match_mf_identification_type"},CedsCertTypeHidden:{_fieldName:"ceds_cert_type_hidden"},CertificateBIC:{_fieldName:"certificate_dataset_bic",_type:"misys.openaccount.widget.CertificateSubmittrBics"},CertificateLineItemId:{_fieldName:"certificate_dataset_line_item_id",_type:"misys.openaccount.widget.CertificateLineItemIdentifications"}},matchManufacturerMap:{Nm:{_fieldName:"ceds_match_mf_issuer_name"}},matchManufacturerCtryMap:{Ctry:{_fieldName:"ceds_match_mf_issuer_country"}},propIdMapManufacturer:{Id:{_fieldName:"ceds_match_mf_identification"},IdTp:{_fieldName:"ceds_match_mf_identification_type"}},matchIssuerMap:{Nm:{_fieldName:"ceds_match_issuer_name"}},matchIssuerCtryMap:{Ctry:{_fieldName:"ceds_match_issuer_country"}},propIdMap:{Id:{_fieldName:"ceds_identification"},IdTp:{_fieldName:"ceds_identification_type"}},outerFieldsMap:{MtchIsseDt:{_fieldName:"ceds_match_iss_date"},MtchInspctnDt:{_fieldName:"ceds_match_insp_date"},AuthrsdInspctrInd:{_fieldName:"ceds_match_insp_ind"},MtchConsgn:{_fieldName:"ceds_match_consignee"}},bicMap:{BIC:{_fieldName:"ceds_bic"}},lineItemIdMap:{LineItmId:{_fieldName:"ceds_line_item_id"}},certpMap:{CertTp:{_fieldName:"ceds_cert_type"}},typeMap:{"misys.openaccount.widget.CertificateSubmittrBics":{"type":Array,"deserialize":function(_1){var _2={};_2._type="misys.openaccount.widget.CertificateSubmittrBics";_2._values=_1;return _2;}},"misys.openaccount.widget.CertificateLineItemIdentifications":{"type":Array,"deserialize":function(_3){var _4={};_4._type="misys.openaccount.widget.CertificateLineItemIdentifications";_4._values=_3;return _4;}}},layout:[{name:"ceds_cert_type_hidden",field:"ceds_cert_type_hidden",width:"90%"},{name:" ",field:"actions",formatter:misys.grid.formatReportActions,width:"10%"},{name:"Id",field:"store_id",headerStyles:"display:none",cellStyles:"display:none"}],mandatoryFields:[],startup:function(){this.inherited(arguments);},openDialogFromExistingItem:function(_5,_6){this.inherited(arguments);},addItem:function(_7){this.inherited(arguments);},createJsonItem:function(){var _8=[];if(this.hasChildren&&this.hasChildren()){dojo.forEach(this.getChildren(),function(_9){if(_9.createItem){var _a=_9.createItem();_8.push(_a);if(this.get("is_valid")!=="N"){this.set("is_valid",_a.is_valid?_a.is_valid:"Y");}misys._widgetsToDestroy=misys._widgetsToDestroy||[];misys._widgetsToDestroy.push(_9.id);}},this);}return _8;},toXML:function(){var _b=[];if(this.xmlTagName){_b.push("<",this.xmlTagName,">");}_b.push("<![CDATA[");if(this.grid){this.grid.store.fetch({query:{store_id:"*"},onComplete:dojo.hitch(this,function(_c,_d){_b.push(this.itemToXML(_c,this.xmlSubTagName));})});}_b.push("]]>");if(this.xmlTagName){_b.push("</",this.xmlTagName,">");}return _b.join("");},itemToXML:function(_e,_f){var xml=[];var _10="";var _11="";var _12="";var _13="";dojo.forEach(_e,function(_14){_10="";_11="";_12="";_13="";lineItemIdXml="";outerFieldsXml="";certXml="";mtchCtryXml="";mtchIssuerCtry="";_10=_10.concat("<MtchIssr>");_11=_11.concat("<PrtryId>");_12=_12.concat("<MtchManfctr>");_13=_13.concat("<PrtryId>");if(_14){if(_f){xml.push("<",_f,">");}for(var _15 in _14){if(_15!="store_id"&&_15.match("^_")!="_"){if(_15==="certificate_dataset_bic"&&_14[_15][0]._values){var _16=_14[_15][0]._values.length;var _17=_14[_15][0]._values;for(var i=0;i<_16;i++){var p1=_17[i];for(var _18 in p1){value=p1[_18];value+="";for(var _19 in this.bicMap){if(this.bicMap[_19]._fieldName===_18){xml.push("<Submitr>");xml.push("<",_19,">",dojox.html.entities.encode(value,dojox.html.entities.html),"</",_19,">");xml.push("</Submitr>");break;}}}}}if(_15==="certificate_dataset_line_item_id"&&_14[_15][0]._values){var _1a=_14[_15][0]._values.length;var _1b=_14[_15][0]._values;for(var j=0;j<_1a;j++){var _1c=_1b[j];for(var _1d in _1c){value=_1c[_1d];value+="";for(var _1e in this.lineItemIdMap){if(this.lineItemIdMap[_1e]._fieldName===_1d){lineItemIdXml=lineItemIdXml.concat("<").concat(_1e).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_1e).concat(">");break;}}}}}value=dojo.isArray(_14[_15])?_14[_15][0]:_14[_15];value+="";for(var _1f in this.outerFieldsMap){if(this.outerFieldsMap[_1f]._fieldName===_15){if(value!=null&&value=="Y"){value="true";}else{value="false";}outerFieldsXml=outerFieldsXml.concat("<").concat(_1f).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_1f).concat(">");break;}}for(var _20 in this.matchIssuerMap){if(this.matchIssuerMap[_20]._fieldName===_15){_10=_10.concat("<").concat(_20).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_20).concat(">");break;}}for(var _21 in this.propIdMap){if(this.propIdMap[_21]._fieldName===_15){_11=_11.concat("<").concat(_21).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_21).concat(">");break;}}for(var _22 in this.matchManufacturerMap){if(this.matchManufacturerMap[_22]._fieldName===_15){_12=_12.concat("<").concat(_22).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_22).concat(">");break;}}for(var _23 in this.propIdMapManufacturer){if(this.propIdMapManufacturer[_23]._fieldName===_15){_13=_13.concat("<").concat(_23).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_23).concat(">");break;}}for(var _24 in this.certpMap){if(this.certpMap[_24]._fieldName===_15){certXml=certXml.concat("<").concat(_24).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_24).concat(">");break;}}for(var _25 in this.matchManufacturerCtryMap){if(this.matchManufacturerCtryMap[_25]._fieldName===_15){mtchCtryXml=mtchCtryXml.concat("<").concat(_25).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_25).concat(">");break;}}for(var _26 in this.matchIssuerCtryMap){if(this.matchIssuerCtryMap[_26]._fieldName===_15){mtchIssuerCtry=mtchIssuerCtry.concat("<").concat(_26).concat(">").concat(dojox.html.entities.encode(value,dojox.html.entities.html)).concat("</").concat(_26).concat(">");break;}}}}_11=_11.concat("</PrtryId>");_10=_10.concat(_11).concat(mtchIssuerCtry);_10=_10.concat("</MtchIssr>").concat(outerFieldsXml);_13=_13.concat("</PrtryId>");_12=_12.concat(_13).concat(mtchCtryXml);_12=_12.concat("</MtchManfctr>").concat(lineItemIdXml);xml.push(certXml);xml.push(_10);xml.push(_12);if(_f){xml.push("</",_f,">");}}},this);return xml.join("");},createItemsFromJson:function(_27){this.inherited(arguments);},performValidation:function(){var _28=true;if(this.validateDialog(true)){var _29=dijit.byId("certificate_dataset_bic");if(!(_29&&_29.store&&_29.store._arrayOfTopLevelItems.length>0)){_28=false;misys.dialog.show("ERROR",misys.getLocalization("bicCodeMandatoryError"));}if(_28){this.inherited(arguments);}}}});}