/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojox.grid.EnhancedGrid"]){dojo._hasResource["dojox.grid.EnhancedGrid"]=true;dojo.provide("dojox.grid.EnhancedGrid");dojo.require("dojox.grid.DataGrid");dojo.require("dojox.grid.enhanced._PluginManager");dojo.requireLocalization("dojox.grid.enhanced","EnhancedGrid",null,"ROOT,ar,ca,cs,da,de,el,en,en-gb,es,fi,fr,fr-fr,he,hr,hu,it,ja,kk,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-tw");dojo.experimental("dojox.grid.EnhancedGrid");dojo.declare("dojox.grid.EnhancedGrid",dojox.grid.DataGrid,{plugins:null,noSortColumnIndex:null,multipleSelectItems:new Object(),pluginMgr:null,keepSelection:false,domIdArray:null,jsonArray:null,_pluginMgrClass:dojox.grid.enhanced._PluginManager,postMixInProperties:function(){this._nls=dojo.i18n.getLocalization("dojox.grid.enhanced","EnhancedGrid",this.lang);this.inherited(arguments);},postCreate:function(){this.pluginMgr=new this._pluginMgrClass(this);this.pluginMgr.preInit();this.inherited(arguments);this.pluginMgr.postInit();if(window.isAccessibilityEnabled){dojo.connect(this,"onCellFocus",function(_1,_2){if(_1.headerSelector){var _3=_1.view.getCellNode(_2,_1.index);if(_3){dojo.attr(_3,"aria-describedby",_1.grid.id+"_rowSelector_"+_2+"_a11y_text");}}_1.navigatable="true";});}},plugin:function(_4){return this.pluginMgr.getPlugin(_4);},startup:function(){this.inherited(arguments);this.pluginMgr.startup();},createSelection:function(){this.selection=new dojox.grid.enhanced.DataSelection(this);},canSort:function(_5,_6){return true;},doKeyEvent:function(e){try{var _7=this.focus.focusView;_7.content.decorateEvent(e);if(!e.cell){_7.header.decorateEvent(e);}}catch(e){}this.inherited(arguments);},doApplyCellEdit:function(_8,_9,_a){if(!_a){this.invalidated[_9]=true;return;}this.inherited(arguments);},mixin:function(_b,_c){var _d={};for(var p in _c){if(p=="_inherited"||p=="declaredClass"||p=="constructor"||_c["privates"]&&_c["privates"][p]){continue;}_d[p]=_c[p];}dojo.mixin(_b,_d);},_copyAttr:function(_e,_f){if(!_f){return;}return this.inherited(arguments);},_getHeaderHeight:function(){this.inherited(arguments);return dojo.marginBox(this.viewsHeaderNode).h;},_fetch:function(_10,_11){if(this.items){return this.inherited(arguments);}_10=_10||0;if(this.store&&!this._pending_requests[_10]){if(!this._isLoaded&&!this._isLoading){this._isLoading=true;this.showMessage(this.loadingMessage);}this._pending_requests[_10]=true;try{var req={start:_10,count:this.rowsPerPage,query:this.query,sort:this.getSortProps(),queryOptions:this.queryOptions,isRender:_11,onBegin:dojo.hitch(this,"_onFetchBegin"),onComplete:dojo.hitch(this,"_onFetchComplete"),onError:dojo.hitch(this,"_onFetchError")};this._storeLayerFetch(req);}catch(e){this._onFetchError(e,{start:_10,count:this.rowsPerPage});}}return 0;},_storeLayerFetch:function(req){this.store.fetch(req);},getCellByField:function(_12){return dojo.filter(this.layout.cells,function(_13){return _13.field==_12;})[0];},onMouseUp:function(e){},createView:function(){var _14=this.inherited(arguments);if(dojo.isMoz){var _15=function(_16,_17){for(var n=_16;n&&_17(n);n=n.parentNode){}return n;};var _18=function(_19){var _1a=_19.toUpperCase();return function(_1b){return _1b.tagName!=_1a;};};var _1c=_14.header.getCellX;_14.header.getCellX=function(e){var x=_1c.call(_14.header,e);var n=_15(e.target,_18("th"));if(n&&n!==e.target&&dojo.isDescendant(e.target,n)){x+=n.firstChild.offsetLeft;}return x;};}return _14;},destroy:function(){delete this._nls;this.selection.destroy();this.pluginMgr.destroy();this.inherited(arguments);}});dojo.provide("dojox.grid.enhanced.DataSelection");dojo.require("dojox.grid.enhanced.plugins._SelectionPreserver");dojo.declare("dojox.grid.enhanced.DataSelection",dojox.grid.DataSelection,{constructor:function(_1d){if(_1d.keepSelection){this.preserver=new dojox.grid.enhanced.plugins._SelectionPreserver(this);}},_range:function(_1e,_1f){this.grid._selectingRange=true;this.inherited(arguments);this.grid._selectingRange=false;this.onChanged();},deselectAll:function(_20){this.grid._selectingRange=true;this.inherited(arguments);this.grid._selectingRange=false;this.onChanged();},destroy:function(){if(this.preserver){this.preserver.destroy();}}});dojox.grid.EnhancedGrid.markupFactory=function(_21,_22,_23,_24){return dojox.grid._Grid.markupFactory(_21,_22,_23,dojo.partial(dojox.grid.DataGrid.cell_markupFactory,_24));};dojox.grid.EnhancedGrid.registerPlugin=function(_25,_26){dojox.grid.enhanced._PluginManager.registerPlugin(_25,_26);};}